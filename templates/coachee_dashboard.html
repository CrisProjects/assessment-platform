<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Coachee - Plataforma de Evaluación</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        /* CONTRASTE ULTRA ALTO VERSION - VERSION 1756492600 - AZUL LANDING PAGE HEADER */
        :root {
            /* Color Palette Inspired by Calm.com - Same as Landing */
            --calm-primary: #1E3A8A;        /* Deep Blue */
            --calm-secondary: #3B82F6;      /* Bright Blue */
            --calm-accent: #06B6D4;         /* Cyan */
            --calm-light: #EFF6FF;          /* Very Light Blue */
            --calm-dark: #1E293B;           /* Dark Slate */
            --calm-white: #FFFFFF;
            --calm-gray-50: #F8FAFC;
            --calm-gray-100: #F1F5F9;
            --calm-gray-600: #475569;
            --calm-gray-700: #334155;
            
            /* Extended color system for dashboard components */
            --calm-dark-blue: #1E3A8A;      /* Same as primary */
            --calm-medium-blue: #3B82F6;    /* Same as secondary */
            --calm-soft-blue: #93C5FD;      /* Light blue */
            --calm-accent-blue: #06B6D4;    /* Same as accent */
            --calm-mint-green: #10B981;     /* Success green */
            
            /* Background and surface colors */
            --calm-background: #F8FAFC;      /* Light gray background */
            --calm-surface: #FFFFFF;         /* Pure white surfaces */
            --calm-surface-elevated: #F1F5F9; /* Slightly elevated surface */
            --calm-border: rgba(59, 130, 246, 0.3); /* Blue border */
            --calm-border-light: rgba(59, 130, 246, 0.1); /* Light blue border */
            
            /* ULTRA HIGH CONTRAST Text Colors - MÁXIMA LEGIBILIDAD */
            --calm-text-primary: #000000;    /* Negro puro para máximo contraste */
            --calm-text-secondary: #0F172A;  /* Casi negro para secundario */
            --calm-text-muted: #1E293B;      /* Azul muy oscuro para muted */
            --calm-text-subtle: #334155;     /* Gris oscuro para subtle */
            
            /* Status colors using new palette */
            --calm-success: #10B981;         /* Success green */
            --calm-warning: #F59E0B;         /* Warning orange */
            --calm-danger: #EF4444;          /* Danger red */
            --calm-info: #3B82F6;            /* Info blue */
            
            /* Gradients */
            --calm-gradient-primary: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%);
            --calm-gradient-light: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);
            --calm-gradient-accent: linear-gradient(135deg, #06B6D4 0%, #0284C7 100%);
            
            /* Dashboard specific enhancements */
            --calm-glass-bg: rgba(30, 58, 138, 0.15);
            --calm-glass-border: rgba(59, 130, 246, 0.3);
            --calm-card-bg: rgba(255, 255, 255, 0.95);
            
            /* Gradients with Calm's serene feel */
            --primary-gradient: linear-gradient(135deg, var(--calm-primary) 0%, var(--calm-primary-light) 100%);
            --success-gradient: linear-gradient(135deg, var(--calm-secondary) 0%, var(--calm-secondary-light) 100%);
            --warning-gradient: linear-gradient(135deg, var(--calm-accent) 0%, var(--calm-accent-light) 100%);
            --danger-gradient: linear-gradient(135deg, var(--calm-danger) 0%, #FC8181 100%);
            --info-gradient: linear-gradient(135deg, var(--calm-info) 0%, var(--calm-primary-light) 100%);
            --background-gradient: linear-gradient(135deg, var(--calm-background) 0%, var(--calm-primary-ultra-light) 100%);
            
            /* Legacy variables for compatibility - SIMPLIFICADO */
            --surface: #ffffff;
            --surface-elevated: #f8f9fa;
            --text-primary: #333333;
            --text-secondary: #666666;
            --border-color: #dee2e6;
        }

        body {
            background: #f8f9fa !important;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            min-height: 100vh;
            line-height: 1.6;
            color: #333 !important;
            letter-spacing: -0.01em;
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(90, 103, 216, 0.08); /* Calm's signature blue with very low opacity */
            border-radius: 50%;
            animation: float 25s infinite linear; /* Slower, more peaceful animation */
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Custom header */
        .custom-header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--calm-border);
            position: relative;
            z-index: 2;
            box-shadow: 0 1px 20px rgba(90, 103, 216, 0.06); /* Softer shadow with new blue */
        }

        .custom-header .navbar-brand {
            color: var(--calm-text-primary) !important;
            font-weight: 600;
            font-size: 1.5rem;
        }

        .user-display {
            color: var(--calm-text-primary);
            font-weight: 500;
            background: var(--calm-surface-elevated);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            border: 1px solid var(--calm-border);
        }

        /* Logout button styles */
        .logout-btn {
            background: var(--calm-surface-elevated);
            border: 1px solid var(--calm-border);
            color: var(--calm-text-primary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-left: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: var(--calm-primary);
            border-color: var(--calm-primary);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.25); /* Updated with new primary color */
        }

        .logout-btn:active {
            transform: translateY(0);
        }

        /* Responsive styles for logout button */
        @media (max-width: 768px) {
            .logout-btn {
                margin-left: 0.5rem;
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .logout-btn .fa-sign-out-alt {
                margin-right: 0.3rem;
            }
            
            .user-display {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 576px) {
            .logout-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
            }
            
            .logout-btn span {
                display: none; /* Hide text on very small screens */
            }
            
            .logout-btn {
                margin-left: 0.3rem;
            }
        }

        /* Main container */
        .main-container {
            position: relative;
            z-index: 2;
            min-height: calc(100vh - 80px);
            padding: 2rem 1rem;
        }

        /* Dashboard cards */
        .dashboard-card {
            background: linear-gradient(135deg, #FFFFFF 0%, #EFF6FF 100%); /* FONDO AZUL CLARO COMO LANDING */
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(30, 58, 138, 0.15); /* SOMBRA MÁS AZUL */
            overflow: hidden;
            margin-bottom: 2rem;
            border: 2px solid var(--calm-primary); /* BORDE AZUL MÁS VISIBLE */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(30, 58, 138, 0.25); /* SOMBRA MÁS INTENSA */
        }

        .card-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, var(--calm-secondary) 100%); /* HEADER AZUL COMO LANDING */
            padding: 1.5rem;
            border-bottom: 1px solid var(--calm-border);
            color: #FFFFFF; /* TEXTO BLANCO PARA TODO EL HEADER */
        }

        .card-header h3 {
            margin: 0;
            color: #FFFFFF; /* TEXTO BLANCO PARA CONTRASTE CON AZUL */
            font-weight: 600;
        }

        .card-header * {
            color: #FFFFFF !important; /* FORZAR TEXTO BLANCO PARA TODOS LOS ELEMENTOS */
        }

        /* Sobrescribir clases de Bootstrap dentro de headers azules */
        .card-header .text-muted,
        .card-header .text-secondary,
        .card-header small,
        .card-header span {
            color: #FFFFFF !important; /* FORZAR BLANCO PARA TEXTO EN HEADERS AZULES */
        }

        /* Sobrescribir texto en pestañas con fondo azul */
        .nav-tabs .nav-link .text-muted,
        .nav-tabs .nav-link .text-secondary,
        .nav-tabs .nav-link small,
        .nav-tabs .nav-link span {
            color: #FFFFFF !important; /* FORZAR BLANCO PARA TEXTO EN PESTAÑAS AZULES */
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Navigation tabs */
        .nav-tabs {
            border-bottom: 2px solid var(--calm-primary);
            margin-bottom: 2rem;
            background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%); /* FONDO AZUL CLARO PARA CONTRASTE */
            border-radius: 12px 12px 0 0;
            padding: 0.5rem;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.1);
        }

        .nav-tabs .nav-link {
            border: none;
            border-radius: 8px;
            color: white !important; /* TEXTO BLANCO PARA TODOS LOS BOTONES */
            font-weight: 600;
            padding: 1rem 1.5rem;
            transition: all 0.3s ease;
            margin: 0 0.25rem;
            position: relative;
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important; /* FONDO AZUL OSCURO COMO LANDING */
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3);
        }

        .nav-tabs .nav-link:hover {
            color: white !important;
            background: linear-gradient(135deg, #1D4ED8 0%, #1E3A8A 100%) !important; /* AZUL MÁS OSCURO AL HOVER */
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.5);
        }

        .nav-tabs .nav-link.active {
            color: white !important;
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important; /* AZUL PROFUNDO PARA ACTIVO */
            border-bottom: none;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
        }

        /* Evaluaciones Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#evaluations-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#evaluations-tab:hover,
        .nav-tabs .nav-link#evaluations-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
            color: white !important;
        }

        /* Assessment Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#assessment-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#assessment-tab:hover,
        .nav-tabs .nav-link#assessment-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
            color: white !important;
        }

        /* Tareas Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#tasks-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#tasks-tab:hover,
        .nav-tabs .nav-link#tasks-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            color: white !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
        }

        /* Progreso Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#progress-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#progress-tab:hover,
        .nav-tabs .nav-link#progress-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            color: white !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
        }

        /* Iconos con animación */
        .nav-tabs .nav-link i {
            transition: transform 0.3s ease;
        }

        .nav-tabs .nav-link:hover i,
        .nav-tabs .nav-link.active i {
            transform: scale(1.1);
        }

        /* Buttons */
        .btn-primary-custom {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.2); /* Updated with new primary color */
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(90, 103, 216, 0.4); /* Updated with new primary color */
            color: white;
        }

        .btn-success-custom {
            background: var(--success-gradient);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-success-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(104, 211, 145, 0.4); /* Updated with new secondary/success color */
            color: white;
        }

        .btn-warning-custom {
            background: var(--warning-gradient);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-warning-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(237, 137, 54, 0.4); /* Updated with new accent/warning color */
            color: white;
        }

        /* Botones específicos para evaluaciones */
        .btn-evaluation {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-evaluation:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            color: white;
        }

        /* Botones específicos para tareas */
        .btn-task {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-task:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
            color: white;
        }

        /* Botones específicos para progreso */
        .btn-progress {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .btn-progress:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
            color: white;
        }

        /* Botones de outline para acciones secundarias */
        .btn-outline-evaluation {
            background: transparent;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #3b82f6;
            transition: all 0.3s ease;
        }

        .btn-outline-evaluation:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-outline-task {
            background: transparent;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #f59e0b;
            transition: all 0.3s ease;
        }

        .btn-outline-task:hover {
            background: #f59e0b;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-outline-progress {
            background: transparent;
            border: 2px solid #8b5cf6;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #8b5cf6;
            transition: all 0.3s ease;
        }

        .btn-outline-progress:hover {
            background: #8b5cf6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        /* Summary cards */
        .summary-card {
            background: var(--calm-surface);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--calm-border);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 20px rgba(90, 103, 216, 0.05); /* Updated with new primary color */
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(90, 103, 216, 0.1); /* Updated with new primary color */
        }

        .summary-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: white;
        }

        .summary-icon.primary {
            background: var(--primary-gradient);
        }

        .summary-icon.success {
            background: var(--success-gradient);
        }

        .summary-icon.warning {
            background: var(--warning-gradient);
        }

        .summary-icon.danger {
            background: var(--danger-gradient);
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .summary-label {
            color: var(--calm-text-muted); /* Usando color muted mejorado para mejor contraste */
            font-weight: 500;
        }

        /* Evaluation cards */
        .evaluation-item {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            color: #333;
        }

        .evaluation-item:hover {
            background: rgba(255, 255, 255, 1);
            border-color: rgba(0, 0, 0, 0.2);
        }

        .evaluation-score {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .evaluation-level {
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .evaluation-description {
            line-height: 1.4;
            background: #f8f9fa;
            padding: 0.75rem;
            border-radius: 6px;
            border-left: 3px solid #007bff;
            color: #555;
        }

        .evaluation-date {
            color: #666;
            font-size: 0.9rem;
        }
        
        /* OVERRIDE GLOBAL PARA FORZAR ESTILOS LIMPIOS */
        .glass-card,
        .card,
        .modal-content,
        [style*="background"],
        [class*="glass"] {
            background: white !important;
            backdrop-filter: none !important;
            border: 1px solid #dee2e6 !important;
            color: #333 !important;
        }
        
        .text-white,
        .text-white-50,
        .text-gradient {
            color: #333 !important;
        }
        
        .text-muted {
            color: #666 !important;
        }

        /* Task cards */
        .task-item {
            background: var(--surface-elevated);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .task-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .task-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .task-description {
            color: var(--calm-text-muted); /* Mejorado para mejor contraste */
            margin-bottom: 1rem;
        }

        .task-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .task-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .task-badge.priority-high {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .task-badge.priority-medium {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .task-badge.priority-low {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .task-badge.status-pending {
            background: rgba(156, 163, 175, 0.1);
            color: #6b7280;
            border: 1px solid rgba(156, 163, 175, 0.2);
        }

        .task-badge.status-in_progress {
            background: rgba(59, 130, 246, 0.1);
            color: #2563eb;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .task-badge.status-completed {
            background: rgba(16, 185, 129, 0.1);
            color: #059669;
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        /* Progress bars */
        .progress-container {
            margin: 1rem 0;
        }

        .progress-bar-custom {
            height: 8px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-fill.low {
            background: var(--danger-gradient);
        }

        .progress-fill.medium {
            background: var(--warning-gradient);
        }

        .progress-fill.high {
            background: var(--success-gradient);
        }

        /* Chart container */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            min-height: 350px;
            max-height: 500px;
            position: relative;
            overflow: visible;
        }
        
        /* Progress chart specific container */
        .progress-chart-wrapper {
            margin-bottom: 2rem;
        }
        
        .progress-chart-wrapper .chart-container {
            height: 350px;
            margin-bottom: 1rem;
        }
        
        /* Progress info card */
        .progress-info-card {
            margin-top: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .progress-info-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Progress tab specific styles */
        #progress .dashboard-card {
            margin-bottom: 2rem;
        }
        
        #progress .row {
            margin-bottom: 1.5rem;
        }
        
        #progress .row:last-child {
            margin-bottom: 0;
        }
        
        /* Responsive adjustments for progress section */
        @media (max-width: 991.98px) {
            .progress-chart-wrapper .chart-container {
                height: 300px;
            }
            
            #progress .col-lg-8,
            #progress .col-lg-4 {
                margin-bottom: 1.5rem;
            }
        }
        
        @media (max-width: 767.98px) {
            .progress-chart-wrapper .chart-container {
                height: 250px;
                padding: 1rem;
            }
            
            .progress-info-card {
                font-size: 0.9rem;
            }
            
            .progress-info-card .h4 {
                font-size: 1.25rem;
            }
            
            .progress-info-card .h5 {
                font-size: 1.1rem;
            }
        }

        /* Responsive Radar Chart Container */
        .radar-chart-container {
            position: relative;
            width: 100%;
            height: 350px; /* Base height */
            max-width: 100%;
            margin: 0 auto;
        }

        .radar-chart-container canvas {
            max-width: 100% !important;
            height: auto !important;
        }

        /* Mobile optimizations for radar chart */
        @media (max-width: 576px) {
            .radar-chart-container {
                height: 280px; /* Smaller on mobile but still prominent */
                padding: 0 0.5rem;
            }
        }

        @media (min-width: 577px) and (max-width: 768px) {
            .radar-chart-container {
                height: 320px; /* Medium size for tablets */
            }
        }

        @media (min-width: 769px) and (max-width: 991px) {
            .radar-chart-container {
                height: 350px; /* Standard size for larger tablets */
            }
        }

        @media (min-width: 992px) {
            .radar-chart-container {
                height: 380px; /* Largest size for desktop */
            }
        }

        /* Loading states */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner-border-custom {
            width: 3rem;
            height: 3rem;
            border: 0.3em solid rgba(102, 126, 234, 0.25);
            border-top-color: #667eea;
        }

        /* Empty states */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--calm-text-muted); /* Mejorado para mejor contraste */
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Assessment specific styles */
        .question-card {
            background: var(--surface-elevated);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1rem;
        }

        .question-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .question-text {
            color: var(--text-primary);
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .option-item {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--border-color) !important;
        }

        .option-item:hover {
            border-color: #667eea !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .option-item.bg-primary {
            border-color: #667eea !important;
            background: var(--primary-gradient) !important;
        }

        .option-item .form-check-input {
            margin-top: 0.125rem;
        }
        
        /* Auto-advance enhancements for assessment */
        .auto-advance-option {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid var(--calm-border-light) !important;
        }
        
        .auto-advance-option:hover {
            border-color: var(--calm-primary) !important;
            background-color: var(--calm-primary-ultra-light) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(98, 130, 227, 0.15);
        }
        
        .auto-advance-option.selected {
            border-color: var(--calm-primary) !important;
            background-color: var(--calm-primary) !important;
            color: white !important;
            transform: scale(1);
            box-shadow: 0 6px 16px rgba(98, 130, 227, 0.3);
        }
        
        .auto-advance-option.selected .form-check-label {
            color: white !important;
            font-weight: 600;
        }
        
        .auto-advance-option .form-check-input {
            display: none; /* Hide radio buttons for cleaner look */
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Loading state for buttons */
        .btn-primary-custom:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* Evaluation Details Modal Styles */
        #evaluationDetailsModal .modal-dialog {
            max-width: 95%;
        }
        
        #evaluationDetailsModal .modal-content {
            background: #ffffff;
            border: 1px solid #dee2e6;
            color: #333;
        }
        
        #evaluationDetailsModal .modal-header {
            background: #f8f9fa !important;
            border-bottom: 1px solid #dee2e6 !important;
            color: #333 !important;
        }
        
        #evaluationDetailsModal .modal-header .modal-title,
        #evaluationDetailsModal .modal-header h5 {
            color: #333 !important;
            font-weight: 700 !important;
        }
        
        #evaluationDetailsModal .modal-header i {
            color: #333 !important;
        }
        
        #evaluationDetailsModal .modal-body {
            background: #ffffff;
            color: #333;
        }
        
        #evaluationDetailsModal .card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #333;
        }
        
        #evaluationDetailsModal h4,
        #evaluationDetailsModal h5,
        #evaluationDetailsModal h6 {
            color: #333 !important;
        }
        
        /* ESTILOS PARA EL MODAL DE RESULTADOS DE EVALUACIÓN - MISMOS QUE EVALUATIONDETAILSMODAL */
        #assessmentResultsModal .modal-header.modal-header-dark,
        #assessmentResultsModal .modal-header,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header {
            background: var(--calm-primary) !important;
            background-color: var(--calm-primary) !important;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2) !important;
            padding: 1.25rem 1.5rem !important;
            color: #ffffff !important;
        }
        
        #assessmentResultsModal .modal-header .modal-title,
        #assessmentResultsModal .modal-header h5,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header .modal-title {
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 1.3rem !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
            letter-spacing: 0.5px !important;
        }
        
        #assessmentResultsModal .modal-header .modal-title i,
        #assessmentResultsModal .modal-header i,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header i {
            color: #ffffff !important;
            opacity: 1 !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
        }
        
        /* Forzar color blanco en TODOS los elementos del header con máxima especificidad */
        #assessmentResultsModal .modal-header,
        #assessmentResultsModal .modal-header h1,
        #assessmentResultsModal .modal-header h2,
        #assessmentResultsModal .modal-header h3,
        #assessmentResultsModal .modal-header h4,
        #assessmentResultsModal .modal-header h5,
        #assessmentResultsModal .modal-header h6,
        #assessmentResultsModal .modal-header span,
        #assessmentResultsModal .modal-header div:not(.d-flex):not(.gap-2) {
            color: #ffffff !important;
            background: transparent !important;
        }
        
        /* Asegurar que el contenedor de botones sea clickeable */
        #assessmentResultsModal .modal-header .d-flex,
        #assessmentResultsModal .modal-header .gap-2 {
            pointer-events: auto !important;
            z-index: 1000 !important;
        }
        
        /* Botones de la cabecera del modal de resultados */
        #assessmentResultsModal .modal-header .btn,
        #assessmentResultsModal .modal-header .btn-close,
        #assessmentResultsModal .modal-header .btn-secondary,
        #assessmentResultsModal .modal-header .btn-danger,
        #assessmentResultsModal .modal-header button {
            background-color: #6c757d !important;
            border: 1px solid #5a6268 !important;
            color: white !important;
            border-radius: 6px !important;
            padding: 8px 16px !important;
            transition: all 0.3s ease !important;
            font-weight: 600 !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            margin-left: 8px !important;
            pointer-events: auto !important;
            cursor: pointer !important;
            z-index: 999 !important;
            position: relative !important;
        }
        
        #assessmentResultsModal .modal-header .btn:hover,
        #assessmentResultsModal .modal-header .btn-close:hover,
        #assessmentResultsModal .modal-header .btn-secondary:hover,
        #assessmentResultsModal .modal-header .btn-danger:hover,
        #assessmentResultsModal .modal-header button:hover {
            background-color: #5a6268 !important;
            border-color: #4e555b !important;
            color: white !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
            pointer-events: auto !important;
            cursor: pointer !important;
        }
        
        /* Especificidad ultra-alta para el background del modal de resultados */
        body #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header.modal-header-dark,
        body #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header {
            background: #1E3A8A !important;
            background-color: #1E3A8A !important;
            color: #ffffff !important;
        }
        
        /* Estilos específicos para la sección de completado */
        #assessmentResultsModal .assessment-completion-section {
            background: linear-gradient(135deg, var(--calm-primary), var(--calm-secondary)) !important;
            color: white !important;
            padding: 2rem !important;
            border-radius: 12px !important;
            margin-bottom: 2rem !important;
            box-shadow: 0 4px 20px rgba(30, 58, 138, 0.3) !important;
        }
        
        #assessmentResultsModal .assessment-score-display {
            font-size: 3.5rem !important;
            font-weight: 800 !important;
            color: #ffffff !important;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        }
        
        #assessmentResultsModal .assessment-level-display {
            font-size: 1.5rem !important;
            font-weight: 600 !important;
            color: #ffffff !important;
            margin-top: 0.5rem !important;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.2) !important;
        }

        /* Estilos profesionales para recomendaciones categorizadas */
        .recommendations-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            border: 2px solid var(--calm-accent);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .recommendations-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white !important;
            padding: 1.5rem;
            border-bottom: 3px solid var(--calm-accent);
            position: relative;
        }
        
        .recommendations-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--calm-accent) 0%, #0ea5e9 50%, var(--calm-accent) 100%);
        }
        
        .recommendation-category {
            background: white;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .recommendation-category:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
            border-color: var(--calm-accent);
        }
        
        .category-header {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-bottom: 2px solid #e2e8f0;
            padding: 1rem 1.25rem;
            position: relative;
        }
        
        .category-title {
            font-weight: 700;
            color: var(--calm-primary);
            font-size: 1.1rem;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--calm-accent) 0%, #0ea5e9 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 0.75rem;
        }
        
        .score-badge {
            background: linear-gradient(135deg, var(--calm-secondary) 0%, var(--calm-accent) 100%);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .priority-indicator {
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-top: 15px solid;
        }
        
        .priority-high {
            border-top-color: #ef4444;
        }
        
        .priority-medium {
            border-top-color: #f59e0b;
        }
        
        .priority-low {
            border-top-color: #06b6d4;
        }
        
        .priority-growth {
            border-top-color: #10b981;
        }
        
        .category-content {
            padding: 1.25rem;
        }
        
        .recommendation-item {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--calm-accent);
            position: relative;
            transition: all 0.2s ease;
        }
        
        .recommendation-item:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-left-color: var(--calm-primary);
            transform: translateX(5px);
        }
        
        .recommendation-item:before {
            content: "✓";
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--calm-accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .recommendation-text {
            margin-left: 1.5rem;
            line-height: 1.6;
            color: #334155;
            font-weight: 500;
        }
        
        .general-recommendations {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }
        
        .general-recommendations .category-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white;
            border-bottom-color: var(--calm-primary);
        }
        
        .general-recommendations .category-title {
            color: white;
        }
        
        .strengths-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .strengths-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .strengths-category .category-title {
            color: white;
        }
        
        .strengths-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .strengths-category .recommendation-item:before {
            background: #10b981;
            content: "★";
        }
        
        .final-message {
            border: 2px solid #8b5cf6;
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
        }
        
        .final-message .category-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-bottom-color: #8b5cf6;
        }
        
        .final-message .category-title {
            color: white;
        }
        
        .final-message .recommendation-item {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-left-color: #8b5cf6;
        }
        
        /* Estilos especiales para subcategorías de dimensiones */
        .dimension-subcategory {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            margin-bottom: 2rem;
        }
        
        .subcategory-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white;
            padding: 1.25rem;
            border-bottom: 3px solid var(--calm-accent);
        }
        
        .subcategory-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .subcategory-info {
            flex: 1;
        }
        
        .subcategory-title {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }
        
        .subcategory-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .dimension-icon {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        .score-container {
            text-align: center;
        }
        
        .score-badge-large {
            display: block;
            font-size: 1.5rem;
            font-weight: 800;
            padding: 0.75rem 1.25rem;
            border-radius: 25px;
            margin-bottom: 0.25rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        .score-critical {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .score-needs-improvement {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .score-good {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }
        
        .score-excellent {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .score-level {
            font-size: 0.8rem;
            font-weight: 600;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .subcategory-content {
            padding: 1.5rem;
            background: white;
        }
        
        .dimension-item {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--calm-primary);
        }
        
        .dimension-item:hover {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-left-color: #1D4ED8;
        }
        
        .dimension-item:before {
            background: var(--calm-primary);
            content: "→";
        }
        
        .congratulations-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .congratulations-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .congratulations-category .category-title {
            color: white;
        }
        
        .congratulations-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .congratulations-category .recommendation-item:before {
            background: #10b981;
            content: "🎉";
        }
        
        .dimension-category {
            border: 2px solid var(--calm-primary);
        }
        
        .dimension-category .priority-indicator {
            display: none; /* Hide priority indicator for dimension subcategories */
        }
        
        /* Responsive adjustments for subcategories */
        @media (max-width: 768px) {
            .subcategory-title-container {
                flex-direction: column;
                text-align: center;
            }
            
            .score-badge-large {
                font-size: 1.25rem;
                padding: 0.5rem 1rem;
            }
        }

        .progress-bar-custom {
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-fill.high {
            background: var(--success-gradient);
        }

        .progress-fill.medium {
            background: var(--warning-gradient);
        }

        .progress-fill.low {
            background: var(--danger-gradient);
        }

        .dimension-score-card {
            transition: transform 0.2s ease;
        }

        .dimension-score-card:hover {
            transform: translateY(-2px);
        }

        .evaluation-section {
            border-left: 4px solid var(--primary-gradient);
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }

        .response-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        /* Improved Assessment Results Styles */
        .assessment-result-card {
            background: var(--calm-surface);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(90, 103, 216, 0.08);
            overflow: hidden;
            margin-bottom: 2rem;
            border: 1px solid var(--calm-border);
            transition: all 0.3s ease;
        }

        .assessment-result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(90, 103, 216, 0.12);
        }

        .assessment-result-header {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .assessment-result-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="60" cy="10" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="70" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="60" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
            pointer-events: none;
        }

        .assessment-score-display {
            font-size: 4rem;
            font-weight: 800;
            margin: 0.5rem 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
        }

        .assessment-level-display {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            opacity: 0.95;
            position: relative;
            z-index: 2;
        }

        .assessment-completion-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 1rem;
            position: relative;
            z-index: 2;
        }

        .assessment-result-body {
            padding: 2rem;
        }

        .assessment-interpretation {
            background: var(--calm-surface-elevated);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid var(--calm-primary);
        }

        .assessment-interpretation h5 {
            color: var(--calm-primary);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .assessment-interpretation p {
            color: var(--calm-text-secondary);
            line-height: 1.6;
            margin-bottom: 0;
        }

        .dimensions-overview {
            background: var(--calm-surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--calm-border);
        }

        .dimensions-overview h6 {
            color: var(--calm-text-primary);
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }

        .dimension-item {
            background: var(--calm-surface-elevated);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--calm-border);
            transition: all 0.2s ease;
        }

        .dimension-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.08);
        }

        .dimension-item:last-child {
            margin-bottom: 0;
        }

        .dimension-label {
            font-weight: 600;
            color: var(--calm-text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .dimension-score {
            font-weight: 700;
            color: var(--calm-primary);
        }

        .dimension-progress {
            background: var(--calm-border);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .dimension-progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease-in-out;
            background: var(--primary-gradient);
            position: relative;
        }

        .dimension-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .assessment-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .assessment-action-btn {
            background: var(--calm-surface-elevated);
            border: 2px solid var(--calm-border);
            color: var(--calm-text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .assessment-action-btn:hover {
            background: var(--calm-primary);
            border-color: var(--calm-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(90, 103, 216, 0.25);
        }

        .assessment-action-btn.primary {
            background: var(--primary-gradient);
            border-color: var(--calm-primary);
            color: white;
        }

        .assessment-action-btn.primary:hover {
            background: var(--calm-primary-dark);
            border-color: var(--calm-primary-dark);
            color: white;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .assessment-score-display {
                font-size: 3rem;
            }
            
            .assessment-level-display {
                font-size: 1.2rem;
            }
            
            .assessment-result-header {
                padding: 1.5rem;
            }
            
            .assessment-result-body {
                padding: 1.5rem;
            }
            
            .assessment-actions {
                flex-direction: column;
            }
            
            .assessment-action-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Utilities */
        .hidden { display: none !important; }
        .visible { display: block !important; }
        /* ========== FORZAR CONTRASTE GLOBAL - ANULAR BOOTSTRAP ========== */
        
        /* Anular todas las clases de texto claras de Bootstrap */
        .text-muted {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris claro */
        }
        
        .text-secondary {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris */
        }
        
        .text-light {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris claro */
        }
        
        /* Forzar contraste en summary cards */
        .summary-card {
            background: #FFFFFF !important; /* Fondo blanco puro */
            border: 2px solid var(--calm-primary) !important; /* Borde azul visible */
            box-shadow: 0 4px 20px rgba(30, 58, 138, 0.15) !important;
        }
        
        .summary-card .summary-number {
            color: var(--calm-primary) !important; /* Azul para números */
            font-weight: 800 !important;
        }
        
        .summary-card .summary-label {
            color: var(--calm-text-primary) !important; /* Negro para etiquetas */
            font-weight: 600 !important;
        }
        
        /* Forzar contraste en evaluation cards */
        .evaluation-item {
            background: #FFFFFF !important;
            border: 2px solid var(--calm-border) !important;
        }
        
        .evaluation-item .text-muted,
        .evaluation-item .small {
            color: var(--calm-text-muted) !important;
        }
        
        /* Task cards con mejor contraste */
        .task-item {
            background: #FFFFFF !important;
            border: 2px solid var(--calm-border) !important;
        }
        
        .task-item .text-muted {
            color: var(--calm-text-muted) !important;
        }
        
        /* Botones con contraste mejorado */
        .btn-outline-evaluation,
        .btn-outline-task,
        .btn-outline-progress {
            background: #FFFFFF !important;
            border-width: 2px !important;
            font-weight: 700 !important;
        }
        
        /* Asegurar que los iconos sean visibles */
        .summary-icon {
            border: 2px solid currentColor !important;
            background: rgba(255, 255, 255, 0.9) !important;
        }
        
        .summary-icon.primary {
            color: var(--calm-primary) !important;
            background: rgba(30, 58, 138, 0.1) !important;
        }
        
        .summary-icon.success {
            color: var(--calm-mint-green) !important;
            background: rgba(16, 185, 129, 0.1) !important;
        }
        
        .summary-icon.warning {
            color: #F59E0B !important;
            background: rgba(245, 158, 11, 0.1) !important;
        }
        
        .summary-icon.danger {
            color: #EF4444 !important;
            background: rgba(239, 68, 68, 0.1) !important;
        }
        
        /* Headers de cards más legibles */
        .card-header p {
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        /* ========== FIN FORZAR CONTRASTE ========== */

        /* === SISTEMA DE TEMAS PARA COACHEE DASHBOARD === */
        /* Tema Día (por defecto) */
        :root {
            --theme-bg-primary: var(--calm-gradient-primary);
            --theme-bg-secondary: var(--calm-light);
            --theme-text-primary: var(--calm-white);
            --theme-text-secondary: var(--calm-gray-600);
            --theme-text-muted: rgba(255, 255, 255, 0.7);
            --theme-card-bg: rgba(255, 255, 255, 0.1);
            --theme-card-border: rgba(255, 255, 255, 0.2);
            --theme-shadow: var(--calm-shadow-soft);
            --theme-glass-bg: rgba(30, 58, 138, 0.08);
            --theme-glass-border: rgba(59, 130, 246, 0.12);
        }

        /* Tema Noche - COPIADO DEL COACH DASHBOARD */
        [data-theme="dark"] {
            /* Tema oscuro con tonos azulados del landing page */
            --theme-bg-primary: #3B82F6;        /* Bright Blue principal */
            --theme-bg-secondary: #3B82F6;      /* Bright Blue secundario */
            --theme-bg-card: rgba(51, 65, 85, 0.9);  /* Cards con tono azulado */
            --theme-text-primary: #F8FAFC;
            --theme-text-secondary: #CBD5E1;
            --theme-text-muted: #94A3B8;
            --theme-border-primary: rgba(148, 163, 184, 0.2);
            --theme-border-secondary: rgba(148, 163, 184, 0.3);
            --theme-shadow: rgba(30, 58, 138, 0.2);  /* Sombras con tinte azul */
            --theme-accent: #3B82F6;             /* Azul del landing page */
            --theme-accent-hover: #60A5FA;       /* Azul más claro al hover */
        }

        /* Aplicar variables a elementos base */
        [data-theme="dark"] body {
            background: var(--theme-bg-primary) !important;
            color: var(--theme-text-primary) !important;
            transition: background-color 0.3s ease, color 0.3s ease !important;
        }

        /* === ESTILOS PARA TEMA NOCTURNO MEJORADOS === */
        [data-theme="dark"] .glass-card {
            background: rgba(59, 130, 246, 0.85) !important;  /* Azul principal #3B82F6 con transparencia */
            border-color: rgba(59, 130, 246, 0.3) !important;  /* Borde azul */
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15) !important;  /* Sombra azul */
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .glass-card:hover {
            background: rgba(59, 130, 246, 0.95) !important;  /* Azul más sólido en hover */
            border-color: rgba(59, 130, 246, 0.4) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.25) !important;
        }

        [data-theme="dark"] .glass-card h3,
        [data-theme="dark"] .glass-card h4,
        [data-theme="dark"] .glass-card h5,
        [data-theme="dark"] .glass-card h6 {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .glass-card .text-muted {
            color: var(--theme-text-muted) !important;
        }

        [data-theme="dark"] .text-white-50 {
            color: var(--theme-text-secondary) !important;
        }

        [data-theme="dark"] .btn-outline-light {
            border-color: #06B6D4 !important;
            color: #06B6D4 !important;
            background: rgba(6, 182, 212, 0.1) !important;
        }

        [data-theme="dark"] .btn-outline-light:hover {
            background-color: rgba(6, 182, 212, 0.2) !important;
            border-color: #0284C7 !important;
            color: #0284C7 !important;
        }

        [data-theme="dark"] .btn-outline-light i {
            color: #06B6D4 !important;
        }

        [data-theme="dark"] .btn-outline-light:hover i {
            color: #0284C7 !important;
        }

        [data-theme="dark"] .btn-primary {
            background: linear-gradient(135deg, #3B82F6, #3B82F6) !important;  /* Bright Blue uniforme */
            border-color: #3B82F6 !important;
            color: #FFFFFF !important;
        }

        [data-theme="dark"] .btn-primary:hover {
            background: linear-gradient(135deg, #3B82F6, #2563EB) !important;  /* Hover con variación sutil */
            border-color: #3B82F6 !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        [data-theme="dark"] .btn-outline-primary {
            color: #3B82F6 !important;
            border-color: #3B82F6 !important;
            background: transparent !important;
        }

        [data-theme="dark"] .btn-outline-primary:hover {
            background: #3B82F6 !important;
            border-color: #3B82F6 !important;
            color: white !important;
        }

        [data-theme="dark"] .modal-content {
            background: rgba(51, 65, 85, 0.95) !important;  /* Azul grisáceo */
            border-color: rgba(59, 130, 246, 0.2) !important;  /* Borde azul suave */
            box-shadow: 0 20px 40px rgba(30, 58, 138, 0.25) !important;  /* Sombra azulada */
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .modal-header {
            border-color: rgba(59, 130, 246, 0.2) !important;
            background: rgba(51, 65, 85, 0.95) !important;
        }

        [data-theme="dark"] .modal-footer {
            border-color: rgba(59, 130, 246, 0.2) !important;
            background: rgba(51, 65, 85, 0.95) !important;
        }

        [data-theme="dark"] .modal-title {
            color: var(--theme-text-primary) !important;
        }

        /* Estilos específicos para asegurar que todos los textos sean visibles en modo noche */
        [data-theme="dark"] .card-header h3,
        [data-theme="dark"] .card-header h4,
        [data-theme="dark"] .card-header h5,
        [data-theme="dark"] .card-header h6 {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .evaluation-item h6 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Estilo para títulos de evaluaciones disponibles (h5) */
        [data-theme="dark"] .evaluation-item h5 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Override específico para evaluaciones disponibles dentro del card-body */
        [data-theme="dark"] #availableEvaluations .evaluation-item h5,
        [data-theme="dark"] .card-body .evaluation-item h5 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Estilos para evaluaciones completadas - mantener colores originales */
        [data-theme="dark"] .evaluation-score.text-success,
        [data-theme="dark"] .evaluation-level.text-success {
            color: #10B981 !important; /* Verde más brillante para modo noche */
            font-weight: bold !important;
        }

        [data-theme="dark"] .evaluation-score.text-warning,
        [data-theme="dark"] .evaluation-level.text-warning {
            color: #F59E0B !important; /* Amarillo más brillante para modo noche */
            font-weight: bold !important;
        }

        [data-theme="dark"] .evaluation-score.text-danger,
        [data-theme="dark"] .evaluation-level.text-danger {
            color: #EF4444 !important; /* Rojo más brillante para modo noche */
            font-weight: bold !important;
        }

        /* Override más específico para evaluaciones completadas */
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-success,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-success {
            color: #10B981 !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-warning,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-warning {
            color: #F59E0B !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-danger,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-danger {
            color: #EF4444 !important;
            font-weight: bold !important;
        }

        /* Estilos para tareas asignadas en modo noche */
        [data-theme="dark"] .task-item .task-title {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] .task-item .task-description {
            color: #2d3748 !important;
        }

        [data-theme="dark"] .task-item .text-muted,
        [data-theme="dark"] .task-item small {
            color: #4a5568 !important;
        }

        [data-theme="dark"] .task-badge {
            color: #1a1a1a !important;
            background: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid #4a5568 !important;
        }

        /* Estilos específicos para badges de prioridad en modo noche */
        [data-theme="dark"] .task-badge.priority-high {
            background: #FED7D7 !important;
            color: #C53030 !important;
        }

        [data-theme="dark"] .task-badge.priority-medium {
            background: #FEEBC8 !important;
            color: #DD6B20 !important;
        }

        [data-theme="dark"] .task-badge.priority-low {
            background: #C6F6D5 !important;
            color: #38A169 !important;
        }

        /* Estilos para badges de estado en modo noche */
        [data-theme="dark"] .task-badge.status-pending {
            background: #BEE3F8 !important;
            color: #2B6CB0 !important;
        }

        [data-theme="dark"] .task-badge.status-in_progress {
            background: #FEEBC8 !important;
            color: #DD6B20 !important;
        }

        [data-theme="dark"] .task-badge.status-completed {
            background: #C6F6D5 !important;
            color: #38A169 !important;
        }

        /* Override específico para contenedor de tareas */
        [data-theme="dark"] #tasksContainer .task-item h5,
        [data-theme="dark"] #tasksContainer .task-item .task-title {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #tasksContainer .task-item p,
        [data-theme="dark"] #tasksContainer .task-item .task-description {
            color: #2d3748 !important;
        }

        [data-theme="dark"] .dashboard-card h3 {
            color: var(--theme-text-primary) !important;
        }

        /* Corregir el problema específico del card-header que fuerza texto blanco */
        [data-theme="dark"] .card-header,
        [data-theme="dark"] .card-header *,
        [data-theme="dark"] .card-header .text-muted,
        [data-theme="dark"] .card-header .text-secondary,
        [data-theme="dark"] .card-header small,
        [data-theme="dark"] .card-header span {
            color: #000000 !important;
        }

        /* Aplicar color negro oscuro y bold para h3 en card-header - MÁS ESPECÍFICO */
        [data-theme="dark"] .dashboard-card .card-header h3,
        [data-theme="dark"] .card-header h3.mb-0 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Override final super específico para el texto "Evaluación de Asertividad" */
        [data-theme="dark"] #assessment .dashboard-card .card-header h3,
        [data-theme="dark"] .tab-pane .dashboard-card .card-header h3 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Excepciones para elementos que deben mantener su color */
        [data-theme="dark"] .btn,
        [data-theme="dark"] .badge,
        [data-theme="dark"] .progress-bar,
        [data-theme="dark"] .evaluation-score {
            color: inherit !important;
        }

        /* Formularios en tema nocturno */
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .form-select {
            background: rgba(51, 65, 85, 0.8) !important;
            border-color: rgba(59, 130, 246, 0.3) !important;
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .form-control:focus,
        [data-theme="dark"] .form-select:focus {
            background: rgba(51, 65, 85, 0.9) !important;
            border-color: #3B82F6 !important;
            color: var(--theme-text-primary) !important;
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25) !important;
        }

        [data-theme="dark"] .form-control::placeholder {
            color: var(--theme-text-muted) !important;
        }

        /* Badges en tema nocturno */
        [data-theme="dark"] .badge.bg-primary {
            background-color: #3B82F6 !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .badge.bg-success {
            background-color: #10B981 !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .badge.bg-warning {
            background-color: #F59E0B !important;
            color: #0F172A !important;
        }

        [data-theme="dark"] .badge.bg-danger {
            background-color: #EF4444 !important;
            color: #F8FAFC !important;
        }

        /* Progress bars en tema nocturno */
        [data-theme="dark"] .progress {
            background-color: rgba(30, 41, 59, 0.5) !important;
        }

        /* Tablas en tema nocturno */
        [data-theme="dark"] .table {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .table-striped > tbody > tr:nth-of-type(odd) > td {
            background-color: rgba(30, 41, 59, 0.3) !important;
        }

        /* Canvas/gráficos en tema nocturno */
        [data-theme="dark"] canvas {
            filter: brightness(0.9) contrast(1.1);
        }

        /* Botón de cambio de tema específico para coachee dashboard */
        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #FFFFFF;
            border: 3px solid #3B82F6;
            color: #3B82F6;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            z-index: 1050;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(10deg);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
            background: #3B82F6;
            color: #FFFFFF;
        }

        /* Estilos específicos para modo noche */
        [data-theme="dark"] .theme-toggle {
            background: #1E293B;
            border: 3px solid #F59E0B;
            color: #F59E0B;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4);
        }

        [data-theme="dark"] .theme-toggle:hover {
            background: #F59E0B;
            color: #1E293B;
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.6);
        }

        .theme-toggle .icon {
            transition: all 0.3s ease;
            position: absolute;
        }

        [data-theme="dark"] .theme-toggle .sun-icon {
            opacity: 1;
            transform: rotate(0deg);
        }

        [data-theme="dark"] .theme-toggle .moon-icon {
            opacity: 0;
            transform: rotate(180deg);
        }

        :root .theme-toggle .moon-icon {
            opacity: 1;
            transform: rotate(0deg);
        }

        :root .theme-toggle .sun-icon {
            opacity: 0;
            transform: rotate(-180deg);
        }

        /* Transiciones suaves */
        body,
        .glass-card,
        .card,
        .btn,
        .form-control,
        .form-select,
        .modal-content {
            transition: all 0.3s ease;
        }

        /* === MEJORAS COMPREHENSIVAS PARA MODO NOCHE === */
        
        /* Mejoras para títulos y encabezados en modo noche */
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6 {
            color: #F8FAFC !important;
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        /* Mejoras para texto general en modo noche */
        [data-theme="dark"] p,
        [data-theme="dark"] span,
        [data-theme="dark"] div,
        [data-theme="dark"] label {
            color: #E2E8F0 !important;
            text-shadow: none !important;
        }

        /* Mejoras para enlaces en modo noche */
        [data-theme="dark"] a {
            color: #60A5FA !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] a:hover {
            color: #93C5FD !important;
            text-decoration: underline !important;
        }

        /* Mejoras para botones en modo noche */
        [data-theme="dark"] .btn {
            background: rgba(59, 130, 246, 0.9) !important;
            border: 1px solid rgba(59, 130, 246, 0.6) !important;
            color: #FFFFFF !important;
            text-shadow: none !important;
            backdrop-filter: none !important;
        }

        [data-theme="dark"] .btn:hover {
            background: rgba(59, 130, 246, 1) !important;
            border-color: rgba(59, 130, 246, 0.8) !important;
            color: #FFFFFF !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4) !important;
        }

        /* Mejoras para botones secundarios en modo noche */
        [data-theme="dark"] .btn-secondary {
            background: rgba(148, 163, 184, 0.6) !important;
            border-color: rgba(148, 163, 184, 0.4) !important;
            color: #FFFFFF !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.8) !important;
            color: #FFFFFF !important;
        }

        /* Estilos adicionales para cards y elementos específicos */
        [data-theme="dark"] .card {
            background: var(--theme-bg-card) !important;
            border-color: rgba(59, 130, 246, 0.2) !important;
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .card-header {
            background: var(--theme-bg-card) !important;
            border-bottom-color: rgba(59, 130, 246, 0.2) !important;
        }

        [data-theme="dark"] .card-body {
            background: var(--theme-bg-card) !important;
        }

        [data-theme="dark"] .navbar {
            background: var(--theme-bg-primary) !important;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2) !important;
        }

        [data-theme="dark"] .navbar-brand {
            color: var(--theme-text-primary) !important;
        }

        /* Estilos finales globales */
        [data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, 
        [data-theme="dark"] h4, [data-theme="dark"] h5, [data-theme="dark"] h6,
        [data-theme="dark"] p, [data-theme="dark"] span, [data-theme="dark"] div {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .text-dark {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .bg-light, [data-theme="dark"] .bg-white {
            background: var(--theme-bg-card) !important;
        }

        [data-theme="dark"] .form-control:focus,
        [data-theme="dark"] .form-select:focus {
            background: rgba(30, 41, 59, 0.95) !important;
            border-color: #3B82F6 !important;
            box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.4) !important;
            color: #FFFFFF !important;
        }

        /* Mejoras para tablas en modo noche */
        [data-theme="dark"] .table {
            background: rgba(30, 41, 59, 0.6) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .table th {
            background: rgba(59, 130, 246, 0.2) !important;
            color: #F8FAFC !important;
            border-color: rgba(148, 163, 184, 0.3) !important;
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        [data-theme="dark"] .table td {
            border-color: rgba(148, 163, 184, 0.2) !important;
            color: #E2E8F0 !important;
        }

        /* Mejoras para badges en modo noche */
        [data-theme="dark"] .badge {
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        /* Mejoras para alerts en modo noche */
        [data-theme="dark"] .alert {
            background: rgba(30, 41, 59, 0.9) !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            color: #F8FAFC !important;
            backdrop-filter: none !important;
        }

        [data-theme="dark"] .alert-info {
            background: rgba(59, 130, 246, 0.2) !important;
            border-color: rgba(59, 130, 246, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-success {
            background: rgba(16, 185, 129, 0.2) !important;
            border-color: rgba(16, 185, 129, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-warning {
            background: rgba(245, 158, 11, 0.2) !important;
            border-color: rgba(245, 158, 11, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-danger {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: rgba(239, 68, 68, 0.4) !important;
            color: #F8FAFC !important;
        }

        /* Mejoras para dropdowns en modo noche */
        [data-theme="dark"] .dropdown-menu {
            background: rgba(30, 41, 59, 0.98) !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            backdrop-filter: none !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6) !important;
        }

        [data-theme="dark"] .dropdown-item {
            color: #E2E8F0 !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] .dropdown-item:hover {
            background: rgba(59, 130, 246, 0.3) !important;
            color: #F8FAFC !important;
        }

        /* Mejoras para scrollbars en modo noche */
        [data-theme="dark"] ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 4px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.6);
            border-radius: 4px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.8);
        }

        /* === ELIMINACIÓN TOTAL DE EFECTOS BLUR EN MODO NOCHE === */
        
        /* Override general para eliminar todos los backdrop-filter y filter blur en modo noche */
        [data-theme="dark"] *,
        [data-theme="dark"] *::before,
        [data-theme="dark"] *::after {
            backdrop-filter: none !important;
        }
        
        /* Específicamente para elementos que pueden tener blur */
        [data-theme="dark"] .glass-card,
        [data-theme="dark"] .card,
        [data-theme="dark"] .modal-content,
        [data-theme="dark"] .navbar,
        [data-theme="dark"] .btn,
        [data-theme="dark"] .alert,
        [data-theme="dark"] .dropdown-menu,
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .badge {
            backdrop-filter: none !important;
            filter: none !important;
        }
        
        /* Asegurar que el texto sea completamente nítido */
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6,
        [data-theme="dark"] p,
        [data-theme="dark"] span,
        [data-theme="dark"] div,
        [data-theme="dark"] label,
        [data-theme="dark"] a,
        [data-theme="dark"] button {
            text-rendering: optimizeLegibility !important;
            -webkit-font-smoothing: antialiased !important;
            -moz-osx-font-smoothing: grayscale !important;
        }
    </style>
</head>
<body>
    <!-- Animated background particles -->
    <div class="particles">
        <!-- Particles will be generated by JavaScript -->
    </div>

    <!-- Header -->
    <nav class="navbar custom-header">
        <div class="container-fluid">
            <span class="navbar-brand">
                <i class="fas fa-tachometer-alt me-2"></i>
                Dashboard Coachee
            </span>
            <div class="d-flex align-items-center">
                <!-- Botones de navegación eliminados del navbar -->
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <div class="container-fluid">
            <!-- Welcome Section -->
            <div class="dashboard-card">
                <div class="card-header">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h3>
                                <i class="fas fa-home me-2"></i>
                                <span id="welcomeMessage">¡Bienvenido!</span>
                            </h3>
                            <p class="mb-0 text-muted" id="userInfo">Cargando información...</p>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-primary-custom me-2" onclick="refreshDashboard()">
                                <i class="fas fa-sync-alt me-2"></i>
                                Actualizar
                            </button>
                            <button class="btn btn-primary-custom" onclick="logout()" title="Cerrar Sesión">
                                <i class="fas fa-sign-out-alt me-2"></i>
                                Cerrar Sesión
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Cards -->
            <div class="row" id="summaryCards">
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="summary-card">
                        <div class="summary-icon primary">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <div class="summary-number" id="totalEvaluations">-</div>
                        <div class="summary-label">Evaluaciones Completadas</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="summary-card">
                        <div class="summary-icon success">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="summary-number" id="latestScore">-</div>
                        <div class="summary-label">Última Puntuación</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="summary-card">
                        <div class="summary-icon warning">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="summary-number" id="pendingTasks">-</div>
                        <div class="summary-label">Tareas Pendientes</div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="summary-card">
                        <div class="summary-icon danger">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="summary-number" id="overdueTasks">-</div>
                        <div class="summary-label">Tareas Vencidas</div>
                    </div>
                </div>
            </div>

            <!-- Navigation Tabs -->
            <ul class="nav nav-tabs" id="mainTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="evaluations-tab" data-bs-toggle="tab" data-bs-target="#evaluations" type="button" role="tab">
                        <i class="fas fa-clipboard-list me-2"></i>
                        Evaluaciones
                    </button>
                </li>
                <li class="nav-item" role="presentation" id="assessment-tab-item" style="display: none;">
                    <button class="nav-link" id="assessment-tab" data-bs-toggle="tab" data-bs-target="#assessment" type="button" role="tab">
                        <i class="fas fa-play-circle me-2"></i>
                        Evaluación Activa
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="tasks-tab" data-bs-toggle="tab" data-bs-target="#tasks" type="button" role="tab">
                        <i class="fas fa-tasks me-2"></i>
                        Tareas
                    </button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="progress-tab" data-bs-toggle="tab" data-bs-target="#progress" type="button" role="tab">
                        <i class="fas fa-chart-area me-2"></i>
                        Progreso
                    </button>
                </li>
            </ul>

            <!-- Tab Content -->
            <div class="tab-content" id="mainTabContent">
                <!-- Evaluations Tab -->
                <div class="tab-pane fade show active" id="evaluations" role="tabpanel">
                    <div class="row">
                        <!-- Available Evaluations -->
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h3 class="mb-0">
                                        <i class="fas fa-plus-circle me-2"></i>
                                        Evaluaciones Disponibles
                                    </h3>
                                </div>
                                <div class="card-body" id="availableEvaluations">
                                    <div class="loading-spinner">
                                        <div class="spinner-border spinner-border-custom" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Completed Evaluations -->
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-history me-2"></i>
                                        Evaluaciones Completadas
                                    </h3>
                                </div>
                                <div class="card-body" id="completedEvaluations">
                                    <div class="loading-spinner">
                                        <div class="spinner-border spinner-border-custom" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assessment Tab (Hidden by default) -->
                <div class="tab-pane fade" id="assessment" role="tabpanel">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>
                                <i class="fas fa-clipboard-check me-2"></i>
                                Evaluación de Asertividad
                            </h3>
                            <div class="progress mt-3">
                                <div class="progress-bar" role="progressbar" id="assessmentProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="card-body" id="assessmentContainer">
                            <div id="questionContainer">
                                <!-- Questions will be loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Assessment Results Modal -->
                    <div class="modal fade" id="assessmentResultsModal" tabindex="-1" aria-labelledby="assessmentResultsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <div class="modal-header modal-header-dark">
                                    <h5 class="modal-title" id="assessmentResultsModalLabel">
                                        <i class="fas fa-check-circle me-2"></i>
                                        ¡Evaluación Completada!
                                    </h5>
                                    <div class="d-flex align-items-center gap-2">
                                        <button type="button" class="btn btn-light btn-sm" onclick="printEvaluationReport()" title="Imprimir Reporte">
                                            <i class="fas fa-print me-1"></i>
                                            Imprimir
                                        </button>
                                        <button type="button" class="btn btn-outline-light btn-sm" data-bs-dismiss="modal" title="Cerrar">
                                            <i class="fas fa-times me-1"></i>
                                            Cerrar
                                        </button>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                </div>
                                <div class="modal-body" id="assessmentResultsContent">
                                    <div class="assessment-completion-section text-center mb-4">
                                        <div class="assessment-score-display" id="assessmentScore">0%</div>
                                        <h3 class="assessment-level-display" id="assessmentLevel">Nivel de Asertividad</h3>
                                    </div>
                                    <div id="assessmentInterpretation">
                                        <!-- Results interpretation will be loaded here -->
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" onclick="finishAssessment()">
                                        <i class="fas fa-check me-2"></i>
                                        Finalizar y Volver
                                    </button>
                                    <button type="button" class="btn btn-primary-custom" onclick="viewDetailedResults()">
                                        <i class="fas fa-chart-radar me-2"></i>
                                        Ver Análisis Completo
                                    </button>
                                    <button type="button" class="btn btn-progress" onclick="printEvaluationReport()">
                                        <i class="fas fa-print me-2"></i>
                                        Imprimir Reporte
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tasks Tab -->
                <div class="tab-pane fade" id="tasks" role="tabpanel">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>
                                <i class="fas fa-tasks me-2"></i>
                                Mis Tareas Asignadas
                            </h3>
                        </div>
                        <div class="card-body" id="tasksContainer">
                            <div class="loading-spinner">
                                <div class="spinner-border spinner-border-custom" role="status">
                                    <span class="visually-hidden">Cargando tareas...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progress Tab -->
                <div class="tab-pane fade" id="progress" role="tabpanel">
                    <div class="row">
                        <!-- Evaluation History Chart -->
                        <div class="col-lg-8">
                            <div class="progress-chart-wrapper">
                                <div class="dashboard-card">
                                    <div class="card-header">
                                        <h3>
                                            <i class="fas fa-chart-line me-2"></i>
                                            Historial de Evaluaciones
                                        </h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container">
                                            <canvas id="progressChart"></canvas>
                                        </div>
                                        <!-- La tarjeta de progreso se insertará aquí dinámicamente -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Statistics -->
                        <div class="col-lg-4">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-calculator me-2"></i>
                                        Estadísticas
                                    </h3>
                                </div>
                                <div class="card-body" id="statisticsContainer">
                                    <div class="loading-spinner">
                                        <div class="spinner-border spinner-border-custom" role="status">
                                            <span class="visually-hidden">Cargando estadísticas...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Latest Evaluation Details -->
                    <div class="row">
                        <div class="col-12">
                            <div class="dashboard-card" id="latestEvaluationDetails">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-bullseye me-2"></i>
                                        Última Evaluación - Análisis Detallado
                                    </h3>
                                </div>
                                <div class="card-body" id="latestEvaluationContainer">
                                    <div class="loading-spinner">
                                        <div class="spinner-border spinner-border-custom" role="status">
                                            <span class="visually-hidden">Cargando análisis...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1060;">
        <div id="toastNotification" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">Notificación</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <!-- Toast message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Task Progress Modal -->
    <div class="modal fade" id="taskProgressModal" tabindex="-1" aria-labelledby="taskProgressModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskProgressModalLabel">
                        <i class="fas fa-tasks me-2"></i>
                        Actualizar Progreso de Tarea
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="taskProgressForm">
                        <input type="hidden" id="taskId" />
                        
                        <div class="mb-3">
                            <label for="taskStatus" class="form-label">Estado de la Tarea</label>
                            <select class="form-select" id="taskStatus" required>
                                <option value="pending">Pendiente</option>
                                <option value="in_progress">En Progreso</option>
                                <option value="completed">Completada</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="taskProgress" class="form-label">Progreso (%)</label>
                            <input type="range" class="form-range" id="taskProgress" min="0" max="100" value="0">
                            <div class="d-flex justify-content-between">
                                <span>0%</span>
                                <span id="progressValue">0%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="taskNotes" class="form-label">Notas (Opcional)</label>
                            <textarea class="form-control" id="taskNotes" rows="3" placeholder="Añade comentarios sobre tu progreso..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-task" onclick="saveTaskProgress()">
                        <i class="fas fa-save me-2"></i>
                        Guardar Progreso
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Evaluation Details Modal -->
    <div class="modal fade" id="evaluationDetailsModal" tabindex="-1" aria-labelledby="evaluationDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header modal-header-dark">
                    <h5 class="modal-title" id="evaluationDetailsModalLabel">
                        <i class="fas fa-chart-radar me-2"></i>
                        Detalles de Evaluación
                    </h5>
                    <div class="d-flex align-items-center gap-2">
                        <button type="button" class="btn btn-light btn-sm" onclick="printEvaluationReport()" title="Imprimir Reporte">
                            <i class="fas fa-print me-1"></i>
                            Imprimir
                        </button>
                        <button type="button" class="btn btn-outline-light btn-sm" data-bs-dismiss="modal" title="Cerrar">
                            <i class="fas fa-times me-1"></i>
                            Cerrar
                        </button>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body" id="evaluationDetailsContent">
                    <div class="loading-spinner">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Cargando detalles...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-progress" onclick="printEvaluationReport()">
                        <i class="fas fa-print me-2"></i>
                        Imprimir Reporte
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API configuration
        const API_BASE_URL = window.location.origin;
        
        // Application state
        let currentUser = null;
        let dashboardData = null;
        let evaluationsData = null;
        let tasksData = null;
        let progressChart = null;

        // Assessment state
        let questions = [];
        let currentQuestionIndex = 0;
        let answers = {};
        let isAssessmentActive = false;

        // Logout function
        async function logout() {
            try {
                // Show loading state
                const logoutBtn = document.querySelector('.logout-btn');
                const originalContent = logoutBtn.innerHTML;
                logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Cerrando...';
                logoutBtn.disabled = true;

                // Call logout API
                const response = await fetch(`${API_BASE_URL}/api/logout`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                // Always redirect to access page regardless of API response
                window.location.href = '/dashboard-selection';
                
            } catch (error) {
                console.error('Error during logout:', error);
                // Even if there's an error, redirect to access page
                window.location.href = '/dashboard-selection';
            }
        }

        // Initialize particles animation
        function createParticles() {
            const particlesContainer = document.querySelector('.particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.width = particle.style.height = (Math.random() * 4 + 2) + 'px';
                particle.style.animationDuration = (Math.random() * 10 + 20) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Toast notification system
        function showToast(message, type = 'info') {
            const toastElement = document.getElementById('toastNotification');
            const toastBody = toastElement.querySelector('.toast-body');
            const toastHeader = toastElement.querySelector('.toast-header');
            
            // Update icon
            const icon = toastHeader.querySelector('i');
            switch (type) {
                case 'success':
                    icon.className = 'fas fa-check-circle text-success me-2';
                    break;
                case 'error':
                    icon.className = 'fas fa-exclamation-circle text-danger me-2';
                    break;
                case 'warning':
                    icon.className = 'fas fa-exclamation-triangle text-warning me-2';
                    break;
                default:
                    icon.className = 'fas fa-info-circle text-primary me-2';
            }
            
            toastBody.textContent = message;
            
            const toast = new bootstrap.Toast(toastElement, {
                autohide: true,
                delay: 5000
            });
            toast.show();
        }

        // Load user profile
        async function loadUserProfile() {
            try {
                console.log('🔍 Cargando perfil de usuario...');
                
                // Verificar que los elementos existen antes de continuar
                const userNameElement = document.getElementById('userName');
                const welcomeMessageElement = document.getElementById('welcomeMessage');
                
                if (!userNameElement || !welcomeMessageElement) {
                    console.error('❌ Elementos userName o welcomeMessage no encontrados en el DOM');
                    return;
                }
                
                const response = await fetch(`${API_BASE_URL}/api/user/my-profile`);
                const data = await response.json();
                
                console.log('📡 Respuesta de API:', { status: response.status, data });
                
                if (response.ok && data.success) {
                    currentUser = data.profile;
                    console.log('✅ Perfil cargado:', data.profile);
                    
                    const fullName = data.profile.full_name || 'Usuario';
                    userNameElement.textContent = fullName;
                    welcomeMessageElement.textContent = `¡Bienvenido, ${fullName}!`;
                    
                    console.log('✅ Mensaje de bienvenida actualizado:', `¡Bienvenido, ${fullName}!`);
                    console.log('✅ userName actualizado:', fullName);
                    
                    // Verificar que se aplicaron los cambios
                    setTimeout(() => {
                        console.log('🔍 Verificación post-actualización:');
                        console.log('  - userName.textContent:', userNameElement.textContent);
                        console.log('  - welcomeMessage.textContent:', welcomeMessageElement.textContent);
                    }, 100);
                } else {
                    throw new Error(data.error || 'Error obteniendo perfil');
                }
            } catch (error) {
                console.error('❌ Error cargando perfil:', error);
                
                // Manejo seguro de errores
                const userNameElement = document.getElementById('userName');
                const welcomeMessageElement = document.getElementById('welcomeMessage');
                
                if (userNameElement) userNameElement.textContent = 'Usuario';
                if (welcomeMessageElement) welcomeMessageElement.textContent = '¡Bienvenido!';
                
                showToast('Error cargando perfil de usuario', 'error');
            }
        }

        // Load dashboard summary
        async function loadDashboardSummary() {
            try {
                console.log('Fetching dashboard summary from:', `${API_BASE_URL}/api/coachee/dashboard-summary`);
                const response = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                
                console.log('Response status:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Raw API response data:', data);
                
                if (data && data.summary) {
                    dashboardData = data.summary;
                    console.log('Dashboard data set to:', dashboardData);
                    updateSummaryCards();
                    updateUserInfo();
                } else {
                    console.error('Formato de datos inesperado:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                console.error('Error cargando resumen:', error);
                showToast('Error cargando resumen del dashboard: ' + error.message, 'error');
                
                // Inicializar con datos vacíos para evitar errores
                dashboardData = {
                    evaluation_summary: { total_completed: 0 },
                    latest_evaluation: null,
                    tasks_summary: { pending: 0, overdue: 0 },
                    coachee: {}
                };
                updateSummaryCards();
                updateUserInfo();
            }
        }

        // Update summary cards
        function updateSummaryCards() {
            if (!dashboardData) return;
            
            // Actualizar elementos del DOM de manera segura
            const totalEvaluationsElement = document.getElementById('totalEvaluations');
            const latestScoreElement = document.getElementById('latestScore');
            const pendingTasksElement = document.getElementById('pendingTasks');
            const overdueTasksElement = document.getElementById('overdueTasks');
            
            if (totalEvaluationsElement) {
                totalEvaluationsElement.textContent = 
                    (dashboardData.evaluation_summary && dashboardData.evaluation_summary.total_completed) || '0';
            }
            
            if (latestScoreElement) {
                latestScoreElement.textContent = 
                    (dashboardData.latest_evaluation && dashboardData.latest_evaluation.total_score) ? 
                    `${Math.round(dashboardData.latest_evaluation.total_score)}%` : '-';
            }
            
            if (pendingTasksElement) {
                pendingTasksElement.textContent = 
                    (dashboardData.tasks_summary && dashboardData.tasks_summary.pending) || '0';
            }
            
            if (overdueTasksElement) {
                overdueTasksElement.textContent = 
                    (dashboardData.tasks_summary && dashboardData.tasks_summary.overdue) || '0';
            }
        }

        // Update user info
        function updateUserInfo() {
            if (!dashboardData) return;
            
            const userInfoElement = document.getElementById('userInfo');
            if (!userInfoElement) return;
            
            const coacheeData = dashboardData.coachee;
            
            if (coacheeData && coacheeData.joined_at) {
                const joinedDate = new Date(coacheeData.joined_at).toLocaleDateString('es-ES');
                userInfoElement.textContent = `Miembro desde: ${joinedDate}`;
            } else if (coacheeData && coacheeData.email) {
                userInfoElement.textContent = coacheeData.email;
            } else {
                userInfoElement.textContent = 'Información no disponible';
            }
        }

        // Load evaluations data
        async function loadEvaluations() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluations`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data && typeof data === 'object') {
                    evaluationsData = data; // Ahora contiene {available: {}, completed: []}
                    renderAvailableEvaluations();
                    renderCompletedEvaluations();
                } else {
                    console.error('Formato de datos inesperado:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                console.error('Error cargando evaluaciones:', error);
                showToast('Error cargando evaluaciones: ' + error.message, 'error');
                
                // Inicializar con datos vacíos
                evaluationsData = { available: {}, completed: [] };
                
                // Show error in both containers
                document.getElementById('availableEvaluations').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando evaluaciones disponibles</p></div>';
                document.getElementById('completedEvaluations').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando historial de evaluaciones</p></div>';
            }
        }

        // Helper function to get assertativeness level
        function getAssertativenessLevel(score) {
            if (score >= 80) return 'Muy Asertivo';
            if (score >= 65) return 'Asertivo';
            if (score >= 50) return 'Moderadamente Asertivo';
            if (score >= 35) return 'Poco Asertivo';
            return 'Muy Poco Asertivo';
        }

        // Render available evaluations
        function renderAvailableEvaluations() {
            const container = document.getElementById('availableEvaluations');
            
            // Verificar si hay un mensaje específico (sin coach o sin invitación)
            if (evaluationsData && evaluationsData.message) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-user-tie"></i>
                        <p>${evaluationsData.message}</p>
                    </div>
                `;
                return;
            }
            
            if (!evaluationsData || !evaluationsData.available || Object.keys(evaluationsData.available).length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>No hay evaluaciones disponibles</p></div>';
                return;
            }
            
            let html = '';
            Object.values(evaluationsData.available).forEach(evaluation => {
                html += `
                    <div class="evaluation-item">
                        <h5 class="mb-3">${evaluation.title}</h5>
                        <p class="text-muted mb-3">${evaluation.description}</p>
                        <div class="row mb-3">
                            <div class="col-sm-6">
                                <small class="text-muted">
                                    <i class="fas fa-question-circle me-1"></i>
                                    ${evaluation.total_questions} preguntas
                                </small>
                            </div>
                            <div class="col-sm-6">
                                <small class="text-muted">
                                    <i class="fas fa-user-tie me-1"></i>
                                    Coach: ${evaluation.coach_name || 'No asignado'}
                                </small>
                            </div>
                        </div>
                        <button class="btn btn-evaluation w-100" onclick="startEvaluation('${evaluation.id}')">
                            <i class="fas fa-play me-2"></i>
                            Comenzar Evaluación
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Render completed evaluations
        function renderCompletedEvaluations() {
            const container = document.getElementById('completedEvaluations');
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-clipboard-list"></i><p>Aún no has completado ninguna evaluación</p></div>';
                return;
            }
            
            let html = '';
            evaluationsData.completed.forEach(evaluation => {
                const score = evaluation.score || 0;
                const scoreColor = score >= 75 ? '#28a745' : 
                                  score >= 50 ? '#ffc107' : '#dc3545';
                
                html += `
                    <div class="evaluation-item">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="mb-0" style="color: #333;">Evaluación de Asertividad</h6>
                            <span class="evaluation-score" style="color: ${scoreColor};">${Math.round(score)}%</span>
                        </div>
                        <div class="evaluation-level mb-2" style="color: ${scoreColor}; font-weight: 600;">${getAssertativenessLevel(score)}</div>
                        <div class="evaluation-description mb-2">${evaluation.result_text || 'Evaluación completada con éxito'}</div>
                        <div class="evaluation-date">${formatDate(evaluation.completed_at)}</div>
                        <button class="btn btn-sm btn-primary mt-2" onclick="viewEvaluationDetails(${evaluation.id})">
                            <i class="fas fa-eye me-1"></i>
                            Ver Detalles
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Load tasks data
        async function loadTasks() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/tasks`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (Array.isArray(data)) {
                    tasksData = data; // La API devuelve directamente el array
                    renderTasks();
                } else {
                    console.error('Formato de datos inesperado para tareas:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                console.error('Error cargando tareas:', error);
                showToast('Error cargando tareas: ' + error.message, 'error');
                
                // Inicializar con datos vacíos
                tasksData = [];
                
                document.getElementById('tasksContainer').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando tareas</p></div>';
            }
        }

        // Render tasks
        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            
            if (!tasksData || tasksData.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-tasks"></i><p>No tienes tareas asignadas</p></div>';
                return;
            }
            
            let html = '';
            tasksData.forEach(task => {
                const priorityClass = `priority-${task.priority}`;
                const statusClass = `status-${task.status}`;
                const progressClass = task.progress_percentage >= 75 ? 'high' : 
                                     task.progress_percentage >= 25 ? 'medium' : 'low';
                
                html += `
                    <div class="task-item">
                        <div class="task-header">
                            <div class="flex-grow-1">
                                <h5 class="task-title">${task.title}</h5>
                                <p class="task-description">${task.description}</p>
                            </div>
                        </div>
                        
                        <div class="task-meta">
                            <span class="task-badge ${priorityClass}">
                                <i class="fas fa-flag me-1"></i>
                                ${task.priority}
                            </span>
                            <span class="task-badge ${statusClass}">
                                <i class="fas fa-circle me-1"></i>
                                ${getStatusLabel(task.status)}
                            </span>
                            ${task.category ? `<span class="task-badge"><i class="fas fa-tag me-1"></i>${task.category}</span>` : ''}
                            ${task.due_date ? `<span class="task-badge"><i class="fas fa-calendar me-1"></i>${formatDate(task.due_date)}</span>` : ''}
                        </div>
                        
                        <div class="progress-container">
                            <div class="d-flex justify-content-between mb-1">
                                <small>Progreso</small>
                                <small>${Math.round(task.progress_percentage)}%</small>
                            </div>
                            <div class="progress-bar-custom">
                                <div class="progress-fill ${progressClass}" style="width: ${task.progress_percentage}%"></div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <small class="text-muted">
                                Coach: ${task.coach.full_name}
                                ${task.last_update ? `• Actualizado: ${formatDate(task.last_update)}` : ''}
                            </small>
                            <button class="btn btn-sm btn-task" onclick="openTaskProgressModal(${task.id})">
                                <i class="fas fa-edit me-1"></i>
                                Actualizar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Load evaluation history for progress chart
        async function loadEvaluationHistory() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-history`);
                const data = await response.json();
                
                if (response.ok) {
                    renderProgressChart(data.history);
                    renderStatistics(data.statistics);
                    renderLatestEvaluationDetails(data.history);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error cargando historial:', error);
                showToast('Error cargando historial de evaluaciones', 'error');
                
                document.getElementById('statisticsContainer').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando estadísticas</p></div>';
            }
        }

        // Render progress chart
        function renderProgressChart(history) {
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            if (progressChart) {
                progressChart.destroy();
            }
            
            // Limpiar cualquier tarjeta de progreso anterior
            const existingProgressInfo = document.querySelector('.progress-info-card');
            if (existingProgressInfo) {
                existingProgressInfo.remove();
            }
            
            if (!history || history.length === 0) {
                const chartContainer = document.querySelector('#progressChart').parentElement;
                chartContainer.innerHTML = '<div class="empty-state text-center py-5"><i class="fas fa-chart-line mb-3" style="font-size: 3rem; color: #6B8DA6;"></i><p class="h5 text-muted">No hay datos de evaluaciones para mostrar</p><p class="text-muted">Completa tu primera evaluación para ver tu progreso</p></div>';
                return;
            }
            
            // Preparar datos para el gráfico (ya están ordenados cronológicamente desde el backend)
            const labels = history.map((eval, index) => {
                const date = new Date(eval.completed_at);
                const dateStr = date.toLocaleDateString('es-ES', { 
                    day: '2-digit', 
                    month: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                return `Evaluación ${index + 1}\n${dateStr}`;
            });
            
            const scores = history.map(eval => Math.round(eval.total_score));
            
            // Colores dinámicos para mostrar progreso
            const pointColors = scores.map((score, index) => {
                if (index === 0) return '#6B8DA6'; // Primer punto en azul suave
                const prevScore = scores[index - 1];
                if (score > prevScore) return '#A0D8CC'; // Mejora - verde menta
                else if (score < prevScore) return '#F56565'; // Empeora - coral suave
                else return '#6B8DA6'; // Sin cambio - azul
            });
            
            // Configuración del gráfico con mejoras visuales
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Puntuación de Asertividad (%)',
                        data: scores,
                        borderColor: '#6282E3',
                        backgroundColor: 'rgba(98, 130, 227, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.3,
                        pointBackgroundColor: pointColors,
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 3,
                        pointRadius: 8,
                        pointHoverRadius: 12,
                        pointHoverBorderWidth: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: {
                                    size: 14,
                                    weight: 'bold'
                                },
                                color: '#243447'
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(36, 52, 71, 0.95)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#6282E3',
                            borderWidth: 2,
                            cornerRadius: 10,
                            displayColors: false,
                            titleFont: {
                                size: 14,
                                weight: 'bold'
                            },
                            bodyFont: {
                                size: 13
                            },
                            callbacks: {
                                title: function(context) {
                                    const index = context[0].dataIndex;
                                    const eval_data = history[index];
                                    const date = new Date(eval_data.completed_at);
                                    return `Evaluación ${index + 1} - ${date.toLocaleDateString('es-ES', {
                                        year: 'numeric',
                                        month: 'long',
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}`;
                                },
                                label: function(context) {
                                    const score = context.parsed.y;
                                    const index = context.dataIndex;
                                    const eval_data = history[index];
                                    
                                    let result = [`Puntuación: ${Math.round(score)}%`];
                                    
                                    // Mostrar nivel de asertividad
                                    if (eval_data.assertiveness_level) {
                                        result.push(`Nivel: ${eval_data.assertiveness_level}`);
                                    }
                                    
                                    // Mostrar comparación con evaluación anterior
                                    if (index > 0) {
                                        const prevScore = scores[index - 1];
                                        const difference = score - prevScore;
                                        const arrow = difference > 0 ? '↗️' : difference < 0 ? '↘️' : '➡️';
                                        const color = difference > 0 ? 'Mejora' : difference < 0 ? 'Retroceso' : 'Sin cambio';
                                        result.push(`${arrow} ${color}: ${difference > 0 ? '+' : ''}${difference}%`);
                                    }
                                    
                                    return result;
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(160, 216, 204, 0.3)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#4A6C85',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                },
                                maxRotation: 45
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            grid: {
                                color: 'rgba(160, 216, 204, 0.2)',
                                lineWidth: 1
                            },
                            ticks: {
                                color: '#4A6C85',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                },
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            borderJoinStyle: 'round'
                        }
                    }
                }
            });
            
            // Añadir información de progreso debajo del gráfico si hay múltiples evaluaciones
            if (history.length >= 2) {
                const latestScore = scores[scores.length - 1];
                const previousScore = scores[scores.length - 2];
                const improvement = latestScore - previousScore;
                const improvementPercent = Math.round((improvement / previousScore) * 100);
                
                // Limpiar cualquier tarjeta de progreso anterior
                const existingProgressInfo = document.querySelector('.progress-info-card');
                if (existingProgressInfo) {
                    existingProgressInfo.remove();
                }
                
                const progressInfo = document.createElement('div');
                progressInfo.className = 'progress-info-card mt-3 p-3 rounded';
                progressInfo.style.backgroundColor = improvement >= 0 ? 'rgba(160, 216, 204, 0.15)' : 'rgba(245, 101, 101, 0.15)';
                progressInfo.style.border = `2px solid ${improvement >= 0 ? '#A0D8CC' : '#F56565'}`;
                
                const icon = improvement > 0 ? '📈' : improvement < 0 ? '📉' : '📊';
                const trend = improvement > 0 ? 'Mejora' : improvement < 0 ? 'Retroceso' : 'Sin cambio';
                const trendColor = improvement >= 0 ? 'text-success' : 'text-danger';
                
                progressInfo.innerHTML = `
                    <div class="row align-items-center">
                        <div class="col-md-6">
                            <h6 class="mb-2">${icon} Progreso Reciente</h6>
                            <div class="d-flex align-items-center">
                                <span class="h5 me-2 mb-0">${Math.round(previousScore)}%</span>
                                <i class="fas fa-arrow-right mx-2 text-muted"></i>
                                <span class="h4 ${trendColor} mb-0">${Math.round(latestScore)}%</span>
                            </div>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <div class="${trendColor}">
                                <strong>${trend}: ${improvement > 0 ? '+' : ''}${improvement} puntos</strong>
                            </div>
                            <small class="text-muted">
                                ${improvement !== 0 ? `(${improvementPercent > 0 ? '+' : ''}${improvementPercent}% relativo)` : ''}
                            </small>
                        </div>
                    </div>
                `;
                
                // Insertar en el card-body después del chart-container
                const cardBody = document.querySelector('#progressChart').closest('.card-body');
                cardBody.appendChild(progressInfo);
            }
        }

        // Render statistics
        function renderStatistics(statistics) {
            const container = document.getElementById('statisticsContainer');
            
            if (!statistics) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-calculator"></i><p>No hay estadísticas disponibles</p></div>';
                return;
            }
            
            let trendIcon = '';
            let trendColor = '';
            let trendText = '';
            
            if (statistics.improvement_trend === 'improving') {
                trendIcon = 'fas fa-arrow-up';
                trendColor = 'text-success';
                trendText = 'Mejorando';
            } else if (statistics.improvement_trend === 'declining') {
                trendIcon = 'fas fa-arrow-down';
                trendColor = 'text-danger';
                trendText = 'Descendiendo';
            } else if (statistics.improvement_trend === 'stable') {
                trendIcon = 'fas fa-minus';
                trendColor = 'text-warning';
                trendText = 'Estable';
            } else {
                trendIcon = 'fas fa-question';
                trendColor = 'text-muted';
                trendText = 'Sin datos';
            }
            
            container.innerHTML = `
                <div class="mb-4">
                    <h6 class="mb-2">Total de Evaluaciones</h6>
                    <div class="h4 text-primary">${statistics.total_evaluations || 0}</div>
                </div>
                
                <div class="mb-4">
                    <h6 class="mb-2">Puntuación Promedio</h6>
                    <div class="h4 text-success">${statistics.average_score ? Math.round(statistics.average_score) : '-'}${statistics.average_score ? '%' : ''}</div>
                </div>
                
                <div class="mb-4">
                    <h6 class="mb-2">Última Puntuación</h6>
                    <div class="h4 text-info">${statistics.latest_score ? Math.round(statistics.latest_score) : '-'}${statistics.latest_score ? '%' : ''}</div>
                </div>
                
                <div class="mb-4">
                    <h6 class="mb-2">Tendencia</h6>
                    <div class="h5 ${trendColor}">
                        <i class="${trendIcon} me-2"></i>
                        ${trendText}
                    </div>
                </div>
            `;
        }

        // Render latest evaluation details
        function renderLatestEvaluationDetails(history) {
            const container = document.getElementById('latestEvaluationContainer');
            
            if (!history || history.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-bullseye"></i><p>No hay evaluaciones completadas</p></div>';
                return;
            }
            
            const latest = history[history.length - 1];
            const dimensions = latest.dimensional_scores;
            
            container.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-4">Puntuación General</h5>
                        <div class="text-center mb-4">
                            <div class="h1 text-primary">${Math.round(latest.total_score)}%</div>
                            <div class="h6 text-muted">${latest.assertiveness_level}</div>
                            <div class="small text-secondary mb-2">${latest.result_description || ''}</div>
                            <small class="text-muted">Completado el ${formatDate(latest.completed_at)}</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5 class="mb-4">Análisis por Dimensiones</h5>
                        ${Object.entries(dimensions).map(([key, value]) => {
                            const progressClass = value >= 75 ? 'high' : value >= 25 ? 'medium' : 'low';
                            const dimensionLabel = getDimensionLabel(key);
                            
                            return `
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small>${dimensionLabel}</small>
                                        <small>${Math.round(value)}%</small>
                                    </div>
                                    <div class="progress-bar-custom">
                                        <div class="progress-fill ${progressClass}" style="width: ${value}%"></div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // Open task progress modal
        function openTaskProgressModal(taskId) {
            const task = tasksData.find(t => t.id === taskId);
            if (!task) return;
            
            document.getElementById('taskId').value = taskId;
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('taskProgress').value = task.progress_percentage;
            document.getElementById('progressValue').textContent = Math.round(task.progress_percentage) + '%';
            document.getElementById('taskNotes').value = '';
            
            // Update progress display when slider changes
            const progressSlider = document.getElementById('taskProgress');
            progressSlider.oninput = function() {
                document.getElementById('progressValue').textContent = this.value + '%';
            };
            
            const modal = new bootstrap.Modal(document.getElementById('taskProgressModal'));
            modal.show();
        }

        // Save task progress
        async function saveTaskProgress() {
            const taskId = document.getElementById('taskId').value;
            const status = document.getElementById('taskStatus').value;
            const progress = parseInt(document.getElementById('taskProgress').value);
            const notes = document.getElementById('taskNotes').value;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/tasks/${taskId}/progress`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: status,
                        progress_percentage: progress,
                        notes: notes
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showToast('Progreso actualizado exitosamente', 'success');
                    
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('taskProgressModal'));
                    modal.hide();
                    
                    // Refresh tasks
                    await loadTasks();
                    await loadDashboardSummary();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error actualizando progreso:', error);
                showToast('Error actualizando progreso: ' + error.message, 'error');
            }
        }

        // Start evaluation
        async function startEvaluation(evaluationType) {
            try {
                showToast('Iniciando evaluación...', 'info');
                
                // Reset assessment state
                questions = [];
                currentQuestionIndex = 0;
                answers = {};
                isAssessmentActive = true;
                
                // Show assessment tab
                document.getElementById('assessment-tab-item').style.display = 'block';
                
                // Switch to assessment tab
                const assessmentTab = new bootstrap.Tab(document.getElementById('assessment-tab'));
                assessmentTab.show();
                
                // Load questions
                await loadAssessmentQuestions();
                
                showToast('¡Evaluación iniciada! Las preguntas avanzan automáticamente al seleccionar una respuesta.', 'success');
                
            } catch (error) {
                console.error('Error starting assessment:', error);
                showToast('Error iniciando evaluación: ' + error.message, 'error');
            }
        }

        // Load assessment questions
        async function loadAssessmentQuestions() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/questions`, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        window.location.href = '/login?role=coachee';
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.questions && data.questions.length > 0) {
                    questions = data.questions;
                    showAssessmentQuestion();
                } else {
                    throw new Error('No se encontraron preguntas válidas');
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                showToast('Error cargando preguntas: ' + error.message, 'error');
            }
        }

        // Show current assessment question
        function showAssessmentQuestion() {
            if (currentQuestionIndex >= questions.length) {
                completeAssessment();
                return;
            }
            
            const question = questions[currentQuestionIndex];
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            
            // Update progress bar
            document.getElementById('assessmentProgress').style.width = progress + '%';
            
            // Opciones estándar para escala Likert de asertividad
            const likertOptions = [
                'Totalmente en desacuerdo',
                'En desacuerdo',
                'Neutral',
                'De acuerdo',
                'Totalmente de acuerdo'
            ];
            
            // Create question HTML
            document.getElementById('questionContainer').innerHTML = `
                <div class="question-card">
                    <div class="question-title mb-3">
                        <i class="fas fa-question-circle me-2"></i>
                        Pregunta ${currentQuestionIndex + 1} de ${questions.length}
                    </div>
                    <div class="question-text mb-4">${question.text}</div>
                    <div class="options-container mb-4">
                        ${likertOptions.map((option, index) => `
                            <div class="form-check mb-3 p-3 border rounded option-item auto-advance-option" onclick="selectAssessmentOption(${index + 1})">
                                <input class="form-check-input" type="radio" name="question${currentQuestionIndex}" value="${index + 1}" id="option${index}">
                                <label class="form-check-label w-100" for="option${index}">
                                    ${option}
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="text-center">
                        <button class="btn btn-primary-custom btn-lg manual-next-btn" onclick="nextAssessmentQuestion()" style="display: none;">
                            <i class="fas fa-${currentQuestionIndex === questions.length - 1 ? 'flag-checkered' : 'arrow-right'} me-2"></i>
                            ${currentQuestionIndex === questions.length - 1 ? 'Finalizar Evaluación' : 'Siguiente Pregunta'}
                        </button>
                    </div>
                </div>
            `;
            
            // Add fade-in animation to new question
            const questionCard = document.querySelector('.question-card');
            if (questionCard) {
                questionCard.style.opacity = '0';
                questionCard.style.transition = 'opacity 0.4s ease-in';
                setTimeout(() => {
                    questionCard.style.opacity = '1';
                }, 50);
            }
        }

        // Select assessment option
        function selectAssessmentOption(value) {
            // Remove previous selections
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('bg-primary', 'text-white', 'selected');
                item.classList.add('bg-light');
            });
            
            // Mark selected option
            const selectedOption = document.querySelector(`input[value="${value}"]`);
            if (selectedOption) {
                selectedOption.checked = true;
                const optionItem = selectedOption.closest('.option-item');
                optionItem.classList.remove('bg-light');
                optionItem.classList.add('bg-primary', 'text-white', 'selected');
                
                // Add visual feedback with animation
                optionItem.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    optionItem.style.transform = 'scale(1)';
                }, 150);
                
                // Show brief loading state
                const nextButton = document.querySelector('.btn-primary-custom');
                if (nextButton) {
                    nextButton.disabled = true;
                    nextButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Procesando...';
                }
                
                // Store the answer immediately
                answers[currentQuestionIndex] = parseInt(value);
                
                // Auto-advance to next question after a brief delay
                setTimeout(() => {
                    autoAdvanceQuestion();
                }, 800); // 800ms delay for better UX
            }
        }
        
        // Auto-advance to next question
        function autoAdvanceQuestion() {
            // Add fade-out animation to current question
            const questionCard = document.querySelector('.question-card');
            if (questionCard) {
                questionCard.style.transition = 'opacity 0.3s ease-out';
                questionCard.style.opacity = '0';
                
                setTimeout(() => {
                    currentQuestionIndex++;
                    if (currentQuestionIndex < questions.length) {
                        showAssessmentQuestion();
                    } else {
                        // Complete assessment
                        completeAssessment();
                    }
                }, 300); // Wait for fade-out animation
            }
        }

        // Move to next assessment question (manual fallback)
        function nextAssessmentQuestion() {
            const selected = document.querySelector(`input[name="question${currentQuestionIndex}"]:checked`);
            
            if (!selected) {
                showToast('Por favor selecciona una respuesta', 'warning');
                return;
            }
            
            // Store answer if not already stored
            if (answers[currentQuestionIndex] === undefined) {
                answers[currentQuestionIndex] = parseInt(selected.value);
            }
            
            // Use the same auto-advance logic
            autoAdvanceQuestion();
        }

        // Complete assessment
        async function completeAssessment() {
            try {
                showToast('Procesando evaluación...', 'info');
                
                console.log('Answers object:', answers);
                console.log('Questions array:', questions);
                
                if (Object.keys(answers).length === 0) {
                    throw new Error('No hay respuestas guardadas');
                }
                
                // Convert answers to the format expected by the API
                const responses = [];
                for (const [questionIndex, answer] of Object.entries(answers)) {
                    const question = questions[parseInt(questionIndex)];
                    if (question && question.id) {
                        responses.push({
                            question_id: question.id,
                            selected_option: answer
                        });
                    }
                }
                
                console.log('Converted responses:', responses);
                
                if (responses.length === 0) {
                    throw new Error('No se pudieron procesar las respuestas');
                }
                
                // Create user data for assessment
                const userData = {
                    age: 25, // Default age
                    gender: 'no_especificado'
                };
                
                const requestBody = {
                    age: userData.age,
                    gender: userData.gender,
                    responses: responses
                };
                
                console.log('Request body:', requestBody);
                
                // Send assessment data
                const response = await fetch(`${API_BASE_URL}/api/save_assessment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                console.log('API response:', data);
                
                if (response.ok && data.success) {
                    showAssessmentResults(data);
                } else {
                    throw new Error(data.error || 'Error guardando evaluación');
                }
                
            } catch (error) {
                console.error('Assessment completion error:', error);
                showToast('Error completando evaluación: ' + error.message, 'error');
            }
        }

        // Show assessment results
        function showAssessmentResults(data) {
            console.log('showAssessmentResults received:', data);
            
            // Extract result data from the correct location
            const result = data.result || data;
            const evaluationId = result.id;
            const score = Math.round(result.score);
            const resultText = result.result_text || '';
            
            // Store the result_id and data for detailed view
            window.lastEvaluationId = evaluationId;
            window.lastAssessmentData = result; // Store complete result data
            
            console.log('Stored evaluation ID:', evaluationId);
            console.log('Stored assessment data:', result);
            
            if (!evaluationId) {
                console.error('No evaluation ID found in response:', data);
                showToast('Error: No se encontró el ID de la evaluación', 'error');
                return;
            }
            
            // Hide question container and reset assessment state
            document.getElementById('assessmentContainer').style.display = 'none';
            isAssessmentActive = false; // Reset assessment state
            
            showToast('¡Evaluación completada exitosamente!', 'success');
            
            // Mostrar directamente el modal de detalles de evaluación con los datos recién completados
            setTimeout(() => {
                viewEvaluationDetails(evaluationId);
            }, 1000); // Aumentar el tiempo para asegurar que los datos se guardan completamente
        }

        // Helper function to format dimension names
        function formatDimensionName(dimension) {
            const dimensionNames = {
                'comunicacion': 'Comunicación',
                'derechos': 'Defensa de Derechos',
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza',
                'opiniones': 'Expresión de Opiniones'
            };
            return dimensionNames[dimension] || dimension.charAt(0).toUpperCase() + dimension.slice(1);
        }

        // View detailed results immediately after completing assessment
        async function viewDetailedResults() {
            console.log('viewDetailedResults called');
            console.log('lastEvaluationId:', window.lastEvaluationId);
            console.log('lastAssessmentData:', window.lastAssessmentData);
            
            if (window.lastEvaluationId) {
                try {
                    // If we have the assessment data in memory, use it immediately
                    if (window.lastAssessmentData && window.lastAssessmentData.dimensional_scores) {
                        console.log('Using cached assessment data');
                        await viewEvaluationDetails(window.lastEvaluationId);
                    } else {
                        console.log('Fetching fresh evaluation details from server');
                        await viewEvaluationDetails(window.lastEvaluationId);
                    }
                } catch (error) {
                    console.error('Error in viewDetailedResults:', error);
                    showToast('Error al cargar los detalles de la evaluación', 'error');
                }
            } else {
                console.error('No evaluation ID available');
                showToast('Error: No se encontró el ID de la evaluación. Intenta refrescar la página.', 'error');
                
                // Try to find the most recent evaluation as fallback
                try {
                    await loadEvaluations();
                    const completedEvals = evaluationsData?.completed || [];
                    if (completedEvals.length > 0) {
                        const latestEval = completedEvals[0];
                        console.log('Using latest evaluation as fallback:', latestEval.id);
                        await viewEvaluationDetails(latestEval.id);
                    } else {
                        showToast('No se encontraron evaluaciones completadas', 'warning');
                    }
                } catch (fallbackError) {
                    console.error('Fallback failed:', fallbackError);
                    showToast('No se pudieron cargar las evaluaciones', 'error');
                }
            }
        }

        // Finish assessment and return to dashboard
        function finishAssessment() {
            // Reset assessment state
            isAssessmentActive = false;
            
            // Hide assessment tab
            document.getElementById('assessment-tab-item').style.display = 'none';
            
            // Cerrar el modal de detalles de evaluación si está abierto
            const evaluationDetailsModal = bootstrap.Modal.getInstance(document.getElementById('evaluationDetailsModal'));
            if (evaluationDetailsModal) {
                evaluationDetailsModal.hide();
            }
            
            // Show assessment container
            document.getElementById('assessmentContainer').style.display = 'block';
            
            // Switch back to evaluations tab
            const evaluationsTab = new bootstrap.Tab(document.getElementById('evaluations-tab'));
            evaluationsTab.show();
            
            // Refresh data
            refreshDashboard();
            
            showToast('Evaluación finalizada. Los datos se han actualizado.', 'success');
        }
        
        // View evaluation details
        async function viewEvaluationDetails(evaluationId) {
            try {
                console.log('Loading evaluation details for ID:', evaluationId);
                
                // Mostrar el modal
                const modal = new bootstrap.Modal(document.getElementById('evaluationDetailsModal'));
                modal.show();
                
                // Cargar detalles de la evaluación
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-details/${evaluationId}`);
                const data = await response.json();
                
                console.log('API response:', data);
                
                if (response.ok) {
                    // La API devuelve {success: true, evaluation: {...}}
                    if (data.success && data.evaluation) {
                        renderEvaluationDetails(data.evaluation);
                    } else {
                        throw new Error('Estructura de datos inesperada');
                    }
                } else {
                    throw new Error(data.error || 'Error desconocido');
                }
            } catch (error) {
                console.error('Error cargando detalles de evaluación:', error);
                document.getElementById('evaluationDetailsContent').innerHTML = 
                    '<div class="text-center text-danger"><i class="fas fa-exclamation-triangle"></i><p>Error cargando detalles de la evaluación</p></div>';
                showToast('Error cargando detalles de la evaluación: ' + error.message, 'error');
            }
        }

        function renderEvaluationDetails(evaluation) {
            console.log('renderEvaluationDetails called with:', evaluation);
            console.log('Current cached data:', window.lastAssessmentData);
            console.log('Last evaluation ID:', window.lastEvaluationId);
            
            const container = document.getElementById('evaluationDetailsContent');
            
            // Si tenemos datos de la evaluación más reciente (cuando se acaba de completar)
            const currentData = window.lastAssessmentData;
            const useCurrent = currentData && window.lastEvaluationId && 
                             window.lastEvaluationId === evaluation.id;
            
            console.log('Using current cached data:', useCurrent);
            
            const data = useCurrent ? currentData : evaluation;
            const dimensionalScores = useCurrent ? currentData.dimensional_scores : evaluation.dimensional_scores;
            const recommendations = evaluation.recommendations || []; // SIEMPRE usar datos del servidor para recomendaciones
            const detailedAnalysis = useCurrent ? currentData.detailed_analysis : evaluation.detailed_analysis;
            
            console.log('Final data to use:', data);
            console.log('Dimensional scores:', dimensionalScores);
            console.log('Recommendations from server:', recommendations);
            console.log('Recommendations count:', recommendations ? recommendations.length : 0);
            
            const html = `
                <!-- Resumen General -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-body text-center">
                                <h4 class="mb-3" style="color: #333;">Análisis Completo de Asertividad</h4>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="h2" style="color: #007bff;">${Math.round(data.score || evaluation.score)}%</div>
                                        <div style="color: #666;">Puntuación Total</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h4" style="color: #28a745;">${getAssertiveLevelFromScore(data.score || evaluation.score)}</div>
                                        <div style="color: #666;">Nivel de Asertividad</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h6" style="color: #333;">${formatDate(data.completed_at || evaluation.completed_at)}</div>
                                        <div style="color: #666;">Fecha de Completado</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h6" style="color: #333;">${data.total_questions || evaluation.total_questions}</div>
                                        <div style="color: #666;">Preguntas Respondidas</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Gráfico Radar y Análisis Dimensional -->
                <div class="row mb-4">
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-radar me-2"></i>Radar de Competencias</h5>
                            </div>
                            <div class="card-body">
                                <div class="radar-chart-container" style="position: relative; height: 300px;">
                                    <canvas id="radarChart" width="300" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-bar me-2"></i>Puntuaciones por Dimensión</h5>
                            </div>
                            <div class="card-body">
                                <div id="dimensionalScoresContainer">
                                    ${generateDimensionalScoresHTML(dimensionalScores)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                ${detailedAnalysis ? generateDetailedAnalysisHTML(detailedAnalysis) : ''}
                ${recommendations && recommendations.length > 0 ? generateRecommendationsHTML(recommendations) : ''}
                
                <!-- Respuestas Detalladas -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border-0" style="background: var(--surface-elevated);">
                            <div class="card-header">
                                <h5><i class="fas fa-list me-2"></i>Respuestas Detalladas</h5>
                            </div>
                            <div class="card-body">
                                ${generateResponsesHTML(evaluation.responses || [])}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            
            // Crear el gráfico radar después de insertar el HTML
            setTimeout(() => {
                createRadarChart(dimensionalScores);
            }, 100);
        }

        function generateDimensionalScoresHTML(dimensionalScores) {
            if (!dimensionalScores) return '<p style="color: #666;">No hay datos dimensionales disponibles.</p>';
            
            let html = '';
            for (const [dimension, score] of Object.entries(dimensionalScores)) {
                const dimensionName = formatDimensionName(dimension);
                const percentage = Math.round(score);
                let colorClass = 'danger';
                if (percentage >= 70) colorClass = 'success';
                else if (percentage >= 50) colorClass = 'warning';
                
                html += `
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <strong style="color: #333;">${dimensionName}</strong>
                            <span class="badge bg-${colorClass}">${percentage}%</span>
                        </div>
                        <div class="progress" style="height: 10px; background: #e9ecef;">
                            <div class="progress-bar bg-${colorClass}" style="width: ${percentage}%"></div>
                        </div>
                        <small style="color: #666;">${getDimensionDescription(dimension, percentage)}</small>
                    </div>
                `;
            }
            return html;
        }

        function generateDetailedAnalysisHTML(analysis) {
            let html = '<div class="row mb-4">';
            
            // Fortalezas
            if (analysis.strengths && analysis.strengths.length > 0) {
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #28a745 !important;">
                            <div class="card-header" style="background: #d4edda; color: #155724;">
                                <h6 class="mb-0"><i class="fas fa-star me-2"></i>Fortalezas Identificadas</h6>
                            </div>
                            <div class="card-body">
                `;
                
                analysis.strengths.forEach(strength => {
                    html += `
                        <div class="d-flex align-items-start mb-3">
                            <div class="flex-shrink-0">
                                <span class="badge bg-success rounded-pill">${Math.round(strength.score)}%</span>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                <strong style="color: #333;">${strength.name}</strong>
                                <p class="mb-0 small" style="color: #666;">${strength.description}</p>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Áreas de mejora
            if (analysis.improvement_areas && analysis.improvement_areas.length > 0) {
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #ffc107 !important;">
                            <div class="card-header" style="background: #fff3cd; color: #856404;">
                                <h6 class="mb-0"><i class="fas fa-target me-2"></i>Áreas de Mejora</h6>
                            </div>
                            <div class="card-body">
                `;
                
                analysis.improvement_areas.forEach(area => {
                    const priorityClass = area.priority === 'high' ? 'danger' : 'warning';
                    html += `
                        <div class="d-flex align-items-start mb-3">
                            <div class="flex-shrink-0">
                                <span class="badge bg-${priorityClass} rounded-pill">${Math.round(area.score)}%</span>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                <strong style="color: #333;">${area.name}</strong> 
                                <span class="badge bg-${priorityClass} ms-1">${area.priority}</span>
                                <p class="mb-0 small" style="color: #666;">${area.description}</p>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        function generateRecommendationsHTML(recommendations) {
            if (!recommendations || recommendations.length === 0) return '';
            
            // Check if recommendations is an array of strings or objects
            const isStringArray = recommendations.length > 0 && typeof recommendations[0] === 'string';
            
            let html = `
                <div class="recommendations-container mt-4">
                    <div class="recommendations-header">
                        <h5 class="mb-0">
                            <i class="fas fa-lightbulb me-2"></i>
                            Plan de Desarrollo Personalizado
                        </h5>
                        <small class="opacity-90 mt-1 d-block">
                            Recomendaciones categorizadas basadas en tu evaluación de asertividad
                        </small>
                        <div class="recommendations-stats">
                            <div class="stat-item">
                                <i class="fas fa-chart-line me-1"></i>
                                Basado en tu puntuación
                            </div>
                            <div class="stat-item">
                                <i class="fas fa-target me-1"></i>
                                Objetivos específicos
                            </div>
                        </div>
                    </div>
                    <div class="p-4">
            `;
            
            if (isStringArray) {
                // Parse and categorize string-based recommendations
                const categories = parseRecommendationsIntoCategories(recommendations);
                
                // Render each category
                Object.entries(categories).forEach(([categoryKey, categoryData]) => {
                    html += renderRecommendationCategory(categoryKey, categoryData);
                });
                
            } else {
                // Handle object format with improved categorization
                const categorizedRecs = categorizeObjectRecommendations(recommendations);
                
                // Render each category
                Object.entries(categorizedRecs).forEach(([categoryKey, categoryData]) => {
                    html += renderRecommendationCategory(categoryKey, categoryData);
                });
            }
            
            html += `
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function parseRecommendationsIntoCategories(recommendations) {
            const categories = {};
            let currentCategory = null;
            let currentCategoryData = null;
            let currentSubcategory = null;
            
            recommendations.forEach((item, index) => {
                const trimmed = item.trim();
                if (!trimmed) return;
                
                // Detect subcategory patterns like "**Habilidades de Comunicación** (Puntuación: 20.0%)"
                const subcategoryMatch = trimmed.match(/^\*\*(.*?)\*\*\s*\(Puntuación:\s*(\d+(?:\.\d+)?)%\)/);
                if (subcategoryMatch) {
                    // Save previous category if exists
                    if (currentCategory && currentCategoryData) {
                        categories[currentCategory] = currentCategoryData;
                    }
                    
                    const subcategoryTitle = subcategoryMatch[1];
                    const score = parseFloat(subcategoryMatch[2]);
                    currentCategory = subcategoryTitle.toLowerCase().replace(/[^a-z0-9]/g, '_');
                    
                    currentCategoryData = {
                        title: subcategoryTitle,
                        subtitle: `Puntuación actual: ${score}%`,
                        items: [],
                        type: 'dimension',
                        icon: getDimensionIconFromTitle(subcategoryTitle),
                        score: score,
                        priority: getScorePriority(score),
                        isSubcategory: true
                    };
                    return;
                }
                
                // Detect main category headers like "**Recomendaciones Generales:**"
                if (trimmed.startsWith('**') && trimmed.endsWith('**')) {
                    // Save previous category
                    if (currentCategory && currentCategoryData) {
                        categories[currentCategory] = currentCategoryData;
                    }
                    
                    const headerText = trimmed.replace(/\*\*/g, '').replace(/[:]*$/, '');
                    currentCategory = headerText.toLowerCase().replace(/[^a-z0-9]/g, '_');
                    
                    currentCategoryData = {
                        title: headerText,
                        items: [],
                        type: getCategoryTypeFromTitle(headerText),
                        icon: getCategoryIconFromTitle(headerText),
                        score: null,
                        priority: 'medium',
                        isSubcategory: false
                    };
                } else if (trimmed.startsWith('• ') || trimmed.startsWith('- ')) {
                    // Add item to current category
                    if (currentCategoryData) {
                        const itemText = trimmed.substring(2);
                        currentCategoryData.items.push(itemText);
                    }
                } else {
                    // Regular text - treat as standalone item or category description
                    if (currentCategoryData && trimmed.length > 15) {
                        currentCategoryData.items.push(trimmed);
                    } else if (!currentCategory && trimmed.length > 15) {
                        // Start a general category for orphaned recommendations
                        currentCategory = 'general_' + index;
                        currentCategoryData = {
                            title: 'Recomendación General',
                            items: [trimmed],
                            type: 'general',
                            icon: 'fas fa-info-circle',
                            score: null,
                            priority: 'medium',
                            isSubcategory: false
                        };
                    }
                }
            });
            
            // Save last category
            if (currentCategory && currentCategoryData) {
                categories[currentCategory] = currentCategoryData;
            }
            
            return categories;
        }
        
        function getDimensionIconFromTitle(title) {
            const titleLower = title.toLowerCase();
            if (titleLower.includes('comunicación')) return 'fas fa-comments';
            if (titleLower.includes('derechos')) return 'fas fa-shield-alt';
            if (titleLower.includes('opiniones')) return 'fas fa-bullhorn';
            if (titleLower.includes('conflictos')) return 'fas fa-handshake';
            if (titleLower.includes('autoconfianza') || titleLower.includes('autoestima')) return 'fas fa-user-check';
            if (titleLower.includes('asertividad')) return 'fas fa-balance-scale';
            return 'fas fa-lightbulb';
        }
        
        function getCategoryTypeFromTitle(title) {
            const titleLower = title.toLowerCase();
            if (titleLower.includes('fortaleza') || titleLower.includes('excelente')) return 'strength';
            if (titleLower.includes('general') || titleLower.includes('recomendación')) return 'general';
            if (titleLower.includes('recuerda') || titleLower.includes('final')) return 'final';
            if (titleLower.includes('trabajo') || titleLower.includes('¡excelente')) return 'congratulations';
            return 'dimension';
        }
        
        function getCategoryIconFromTitle(title) {
            const titleLower = title.toLowerCase();
            if (titleLower.includes('comunicación')) return 'fas fa-comments';
            if (titleLower.includes('derechos')) return 'fas fa-shield-alt';
            if (titleLower.includes('opiniones')) return 'fas fa-bullhorn';
            if (titleLower.includes('conflictos')) return 'fas fa-handshake';
            if (titleLower.includes('autoconfianza')) return 'fas fa-user-check';
            if (titleLower.includes('fortaleza')) return 'fas fa-star';
            if (titleLower.includes('general')) return 'fas fa-clipboard-list';
            if (titleLower.includes('recuerda')) return 'fas fa-heart';
            if (titleLower.includes('trabajo') || titleLower.includes('excelente')) return 'fas fa-trophy';
            return 'fas fa-lightbulb';
        }
        
        function getScorePriority(score) {
            if (score < 40) return 'high';
            if (score < 60) return 'medium';
            if (score < 80) return 'low';
            return 'growth';
        }
        
        function categorizeObjectRecommendations(recommendations) {
            const categories = {};
            
            recommendations.forEach((rec, index) => {
                const categoryKey = rec.dimension || 'general';
                const categoryType = rec.priority || 'medium';
                
                if (!categories[categoryKey]) {
                    categories[categoryKey] = {
                        title: formatDimensionName(rec.dimension) || 'Recomendación General',
                        items: [],
                        type: categoryType,
                        icon: getDimensionIcon(rec.dimension),
                        score: rec.score
                    };
                }
                
                categories[categoryKey].items.push(rec.recommendation);
            });
            
            return categories;
        }
        
        function renderRecommendationCategory(categoryKey, categoryData) {
            const { title, subtitle, items, type, icon, score, priority, isSubcategory } = categoryData;
            
            const categoryClass = getCategoryClassAdvanced(type, title, isSubcategory);
            const priorityIndicator = getPriorityIndicator(priority);
            
            // Special styling for subcategories (dimensions with scores)
            if (isSubcategory) {
                return `
                    <div class="recommendation-category dimension-subcategory ${categoryClass}">
                        ${priorityIndicator}
                        <div class="subcategory-header">
                            <div class="subcategory-title-container">
                                <div class="d-flex align-items-center">
                                    <div class="category-icon dimension-icon">
                                        <i class="${icon}"></i>
                                    </div>
                                    <div class="subcategory-info">
                                        <h6 class="subcategory-title">${title}</h6>
                                        <span class="subcategory-subtitle">${subtitle}</span>
                                    </div>
                                </div>
                                <div class="score-container">
                                    <div class="score-badge-large ${getScoreBadgeClass(score)}">${Math.round(score)}%</div>
                                    <div class="score-level">${getScoreLevel(score)}</div>
                                </div>
                            </div>
                        </div>
                        <div class="subcategory-content">
                            ${renderRecommendationItems(items, 'dimension')}
                        </div>
                    </div>
                `;
            }
            
            // Regular category rendering
            let html = `
                <div class="recommendation-category ${categoryClass}">
                    ${priorityIndicator}
                    <div class="category-header">
                        <div class="category-title">
                            <div class="d-flex align-items-center">
                                <div class="category-icon">
                                    <i class="${icon}"></i>
                                </div>
                                <div>
                                    <div>${title}</div>
                                    ${score ? `<div class="category-subtitle">Puntuación: ${Math.round(score)}%</div>` : ''}
                                </div>
                            </div>
                            ${score ? `<div class="score-badge">${Math.round(score)}%</div>` : ''}
                        </div>
                    </div>
                    <div class="category-content">
                        ${renderRecommendationItems(items, type)}
                    </div>
                </div>
            `;
            
            return html;
        }
        
        function renderRecommendationItems(items, categoryType) {
            let html = '';
            items.forEach(item => {
                html += `
                    <div class="recommendation-item ${categoryType}-item">
                        <div class="recommendation-text">${item}</div>
                    </div>
                `;
            });
            return html;
        }
        
        function getCategoryClassAdvanced(type, title, isSubcategory) {
            if (isSubcategory) return 'dimension-category';
            if (title.includes('Fortaleza') || type === 'strength') return 'strengths-category';
            if (title.includes('General') || type === 'general') return 'general-recommendations';
            if (title.includes('Recuerda') || type === 'final') return 'final-message';
            if (title.includes('Excelente') || type === 'congratulations') return 'congratulations-category';
            return '';
        }
        
        function getScoreBadgeClass(score) {
            if (score < 40) return 'score-critical';
            if (score < 60) return 'score-needs-improvement';
            if (score < 80) return 'score-good';
            return 'score-excellent';
        }
        
        function getScoreLevel(score) {
            if (score < 40) return 'Necesita Mejora';
            if (score < 60) return 'En Desarrollo';
            if (score < 80) return 'Competente';
            return 'Excelente';
        }
        
        function getCategoryType(title) {
            if (title.includes('Fortaleza') || title.includes('Excelente')) return 'strength';
            if (title.includes('General') || title.includes('Recomendación')) return 'general';
            if (title.includes('Recuerda') || title.includes('Final')) return 'final';
            return 'dimension';
        }
        
        function getCategoryIcon(title) {
            if (title.includes('Comunicación')) return 'fas fa-comments';
            if (title.includes('Derechos')) return 'fas fa-shield-alt';
            if (title.includes('Opiniones')) return 'fas fa-bullhorn';
            if (title.includes('Conflictos')) return 'fas fa-handshake';
            if (title.includes('Autoconfianza')) return 'fas fa-user-check';
            if (title.includes('Fortaleza')) return 'fas fa-star';
            if (title.includes('General')) return 'fas fa-clipboard-list';
            if (title.includes('Recuerda')) return 'fas fa-heart';
            return 'fas fa-lightbulb';
        }
        
        function getDimensionIcon(dimension) {
            const iconMap = {
                'comunicacion': 'fas fa-comments',
                'derechos': 'fas fa-shield-alt',
                'opiniones': 'fas fa-bullhorn',
                'conflictos': 'fas fa-handshake',
                'autoconfianza': 'fas fa-user-check',
                'general': 'fas fa-clipboard-list'
            };
            return iconMap[dimension] || 'fas fa-lightbulb';
        }
        
        function getCategoryClass(type, title) {
            if (title.includes('Fortaleza') || type === 'strength') return 'strengths-category';
            if (title.includes('General') || type === 'general') return 'general-recommendations';
            if (title.includes('Recuerda') || type === 'final') return 'final-message';
            return '';
        }
        
        function getPriorityIndicator(priority) {
            const priorityClass = `priority-${priority}`;
            return `<div class="priority-indicator ${priorityClass}"></div>`;
        }
        
        function extractScoreFromTitle(title) {
            const scoreMatch = title.match(/(\d+(?:\.\d+)?)%/);
            return scoreMatch ? parseFloat(scoreMatch[1]) : null;
        }

        function generateResponsesHTML(responses) {
            if (!responses || responses.length === 0) {
                return '<p class="text-muted">No hay respuestas detalladas disponibles.</p>';
            }
            
            const optionLabels = {
                1: 'Totalmente en desacuerdo',
                2: 'En desacuerdo', 
                3: 'Neutral',
                4: 'De acuerdo',
                5: 'Totalmente de acuerdo'
            };
            
            let html = '';
            responses.forEach((response, index) => {
                const scoreClass = response.selected_option >= 4 ? 'success' : 
                                  response.selected_option === 3 ? 'warning' : 'danger';
                
                html += `
                    <div class="border-start border-3 border-primary ps-3 mb-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <strong>Pregunta ${index + 1}:</strong>
                                <p class="mb-1">${response.question_text}</p>
                                <small class="text-${scoreClass}">
                                    <i class="fas fa-check-circle me-1"></i>
                                    ${optionLabels[response.selected_option]}
                                </small>
                            </div>
                            <span class="badge bg-${scoreClass} ms-2">${response.selected_option}/5</span>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }

        function getAssertiveLevelFromScore(score) {
            if (score >= 85) return 'Muy Asertivo';
            if (score >= 70) return 'Asertivo';
            if (score >= 50) return 'Moderadamente Asertivo';
            return 'Poco Asertivo';
        }

        function getDimensionDescription(dimension, score) {
            const descriptions = {
                'comunicacion': score >= 70 ? 'Excelente comunicación interpersonal' : 'Oportunidad de mejorar la comunicación',
                'derechos': score >= 70 ? 'Sabe defender sus derechos apropiadamente' : 'Necesita fortalecer la defensa de derechos',
                'opiniones': score >= 70 ? 'Expresa opiniones con confianza' : 'Puede mejorar la expresión de opiniones',
                'conflictos': score >= 70 ? 'Maneja conflictos efectivamente' : 'Requiere desarrollo en manejo de conflictos',
                'autoconfianza': score >= 70 ? 'Alta confianza en sí mismo/a' : 'Oportunidad de fortalecer autoconfianza'
            };
            return descriptions[dimension] || 'Área de desarrollo personal';
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('es-ES', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return dateString;
            }
        }

        // Refresh dashboard
        async function refreshDashboard() {
            showToast('Actualizando dashboard...', 'info');
            
            try {
                await Promise.all([
                    loadDashboardSummary(),
                    loadEvaluations(),
                    loadTasks()
                ]);
                
                showToast('Dashboard actualizado', 'success');
            } catch (error) {
                console.error('Error actualizando dashboard:', error);
                showToast('Error actualizando dashboard', 'error');
            }
        }

        // Variable global para almacenar el gráfico radar
        let radarChart = null;

        function createRadarChart(dimensionalScores) {
            const ctx = document.getElementById('radarChart');
            if (!ctx || !dimensionalScores) {
                console.warn('No se puede crear el radar chart: elemento canvas no encontrado o datos faltantes');
                return;
            }

            // Destruir gráfico existente si existe
            if (radarChart) {
                radarChart.destroy();
            }

            // Preparar datos para el gráfico radar
            const labels = [
                'Comunicación',
                'Derechos',
                'Opiniones',
                'Conflictos',
                'Autoconfianza'
            ];

            const dataValues = [
                dimensionalScores.comunicacion || 0,
                dimensionalScores.derechos || 0,
                dimensionalScores.opiniones || 0,
                dimensionalScores.conflictos || 0,
                dimensionalScores.autoconfianza || 0
            ];

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Nivel de Asertividad',
                        data: dataValues,
                        backgroundColor: 'rgba(98, 130, 227, 0.2)',
                        borderColor: 'rgba(98, 130, 227, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(98, 130, 227, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${Math.round(context.raw)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            min: 0,
                            ticks: {
                                stepSize: 20,
                                callback: function(value) {
                                    return value + '%';
                                },
                                color: '#6B8DA6',
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                color: 'rgba(107, 141, 166, 0.2)'
                            },
                            angleLines: {
                                color: 'rgba(107, 141, 166, 0.2)'
                            },
                            pointLabels: {
                                color: '#243447',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.2
                        }
                    }
                }
            });
        }

        function getStatusLabel(status) {
            const labels = {
                'pending': 'Pendiente',
                'in_progress': 'En Progreso',
                'completed': 'Completada',
                'cancelled': 'Cancelada'
            };
            return labels[status] || status;
        }

        function getDimensionLabel(key) {
            const labels = {
                'comunicacion': 'Comunicación Directa',
                'derechos': 'Defensa de Derechos',
                'opiniones': 'Expresión de Opiniones',
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza'
            };
            return labels[key] || key;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Tab change events
            document.querySelectorAll('#mainTabs button[data-bs-toggle="tab"]').forEach(tab => {
                tab.addEventListener('shown.bs.tab', function (event) {
                    const target = event.target.getAttribute('data-bs-target');
                    
                    // Load data when tabs are activated
                    if (target === '#evaluations' && !evaluationsData) {
                        loadEvaluations();
                    } else if (target === '#tasks') {
                        loadTasks(); // Siempre cargar tareas para mantener datos actualizados
                    } else if (target === '#progress') {
                        loadEvaluationHistory();
                    }
                });
            });

            // Modal close event listener
            const evaluationDetailsModal = document.getElementById('evaluationDetailsModal');
            if (evaluationDetailsModal) {
                evaluationDetailsModal.addEventListener('hidden.bs.modal', function () {
                    console.log('Modal cerrado - restableciendo estado del dashboard');
                    
                    // Reset assessment state completely
                    isAssessmentActive = false;
                    
                    // Ensure assessment tab is hidden
                    const assessmentTab = document.getElementById('assessment-tab-item');
                    if (assessmentTab) {
                        assessmentTab.style.display = 'none';
                    }
                    
                    // Ensure assessment container is visible
                    const assessmentContainer = document.getElementById('assessmentContainer');
                    if (assessmentContainer) {
                        assessmentContainer.style.display = 'block';
                    }
                    
                    // Switch to evaluations tab to ensure proper state
                    const evaluationsTab = document.getElementById('evaluations-tab');
                    if (evaluationsTab) {
                        const tabInstance = new bootstrap.Tab(evaluationsTab);
                        tabInstance.show();
                    }
                    
                    // Clear cached data
                    window.lastEvaluationId = null;
                    window.lastAssessmentData = null;
                    
                    // Force remove any modal backdrop that might be stuck
                    setTimeout(() => {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        backdrops.forEach(backdrop => {
                            console.log('Removing stuck backdrop:', backdrop);
                            backdrop.remove();
                        });
                        
                        // Remove modal-open class from body that might block interactions
                        document.body.classList.remove('modal-open');
                        
                        // Reset body styles that might affect scrolling/interaction
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                        
                        // Force refresh dashboard to ensure all elements are clickable
                        refreshDashboard();
                        
                        console.log('Dashboard completamente desbloqueado');
                    }, 100);
                    
                    console.log('Estado del dashboard restablecido completamente');
                });
            }
        }

        // Initialize application
        async function initializeApp() {
            console.log('Inicializando dashboard de coachee...');
            
            // Create animated particles
            createParticles();
            
            // Setup event listeners
            setupEventListeners();
            
            // Load initial data
            await loadUserProfile();
            await loadDashboardSummary();
            
            // Load data for active tab
            await loadEvaluations();
            await loadTasks();
            
            // Forzar actualización final del mensaje de bienvenida
            updateWelcomeMessage();
            
            console.log('Dashboard inicializado correctamente');
        }
        
        // Función para actualizar el mensaje de bienvenida
        function updateWelcomeMessage() {
            if (currentUser && currentUser.full_name) {
                const userNameElement = document.getElementById('userName');
                const welcomeMessageElement = document.getElementById('welcomeMessage');
                
                if (userNameElement) {
                    userNameElement.textContent = currentUser.full_name;
                    console.log('🔄 userName forzado a:', currentUser.full_name);
                }
                
                if (welcomeMessageElement) {
                    welcomeMessageElement.textContent = `¡Bienvenido, ${currentUser.full_name}!`;
                    console.log('🔄 welcomeMessage forzado a:', `¡Bienvenido, ${currentUser.full_name}!`);
                }
            }
        }

        // Función de emergencia para desbloquear el dashboard
        function forceUnlockDashboard() {
            console.log('🚨 EMERGENCIA: Desbloqueando dashboard forzadamente');
            
            // Reset all assessment states
            isAssessmentActive = false;
            
            // Hide assessment tab
            const assessmentTab = document.getElementById('assessment-tab-item');
            if (assessmentTab) {
                assessmentTab.style.display = 'none';
            }
            
            // Show assessment container
            const assessmentContainer = document.getElementById('assessmentContainer');
            if (assessmentContainer) {
                assessmentContainer.style.display = 'block';
            }
            
            // Force close all modals
            const allModals = document.querySelectorAll('.modal');
            allModals.forEach(modal => {
                const modalInstance = bootstrap.Modal.getInstance(modal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            });
            
            // Remove all modal backdrops
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(backdrop => {
                backdrop.remove();
            });
            
            // Remove modal-open class from body
            document.body.classList.remove('modal-open');
            
            // Reset body styles
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
            document.body.style.position = '';
            
            // Reset any stuck pointer-events
            document.body.style.pointerEvents = '';
            
            // Clear cached data
            window.lastEvaluationId = null;
            window.lastAssessmentData = null;
            
            // Switch to evaluations tab
            const evaluationsTab = document.getElementById('evaluations-tab');
            if (evaluationsTab) {
                const tabInstance = new bootstrap.Tab(evaluationsTab);
                tabInstance.show();
            }
            
            // Force refresh
            refreshDashboard();
            
            showToast('Dashboard desbloqueado forzadamente', 'success');
            console.log('✅ Dashboard completamente desbloqueado');
        }

        // Make it globally accessible for debugging
        window.forceUnlockDashboard = forceUnlockDashboard;

        // Validar visibilidad de evaluaciones
        async function validateEvaluationVisibility(assessmentId = null) {
            try {
                showToast('Validando visibilidad de evaluaciones...', 'info');
                
                const url = assessmentId 
                    ? `/api/coachee/validate-visibility?assessment_id=${assessmentId}`
                    : '/api/coachee/validate-visibility';
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin'
                });
                
                const data = await response.json();
                
                if (data.valid) {
                    showValidationResults(data, true);
                } else {
                    showValidationResults(data, false);
                }
                
            } catch (error) {
                console.error('Error validando visibilidad:', error);
                showToast('Error al validar visibilidad de evaluaciones', 'error');
            }
        }

        // Mostrar resultados de validación en modal
        function showValidationResults(data, isValid) {
            const modalHtml = `
                <div class="modal fade" id="validationModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header ${isValid ? 'bg-success' : 'bg-warning'} text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-${isValid ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
                                    Validación de Visibilidad de Evaluaciones
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ${generateValidationReport(data, isValid)}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                ${isValid ? '<button type="button" class="btn btn-primary" onclick="refreshDashboard()" data-bs-dismiss="modal">Actualizar Dashboard</button>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal existente si existe
            const existingModal = document.getElementById('validationModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('validationModal'));
            modal.show();
            
            // Mostrar toast con resultado
            if (isValid) {
                showToast(`Validación exitosa: ${data.available_assessments_count || 0} evaluaciones visibles`, 'success');
            } else {
                showToast(`Problema detectado: ${data.error}`, 'warning');
            }
        }

        // Generar reporte de validación
        function generateValidationReport(data, isValid) {
            let html = '';
            
            if (isValid && data.coachee) {
                html += `
                    <div class="alert alert-success">
                        <h6><i class="fas fa-user me-2"></i>Información del Coachee</h6>
                        <strong>Nombre:</strong> ${data.coachee.full_name}<br>
                        <strong>Usuario:</strong> ${data.coachee.username}<br>
                        <strong>Coach:</strong> ${data.coachee.coach_name || 'No asignado'}
                    </div>
                `;
                
                if (data.summary) {
                    html += `
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="card text-center ${data.summary.can_see_evaluations ? 'border-success' : 'border-warning'}">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.available_assessments_count || 0}</h5>
                                        <p class="card-text">Evaluaciones Disponibles</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center border-info">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.completed_assessments_count || 0}</h5>
                                        <p class="card-text">Evaluaciones Completadas</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center border-primary">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.total_assessments_checked || 0}</h5>
                                        <p class="card-text">Total Evaluaciones</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                if (data.assessments && data.assessments.length > 0) {
                    html += `
                        <h6><i class="fas fa-list me-2"></i>Detalle de Evaluaciones</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Evaluación</th>
                                        <th>Estado</th>
                                        <th>Preguntas</th>
                                        <th>Visible</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    data.assessments.forEach(assessment => {
                        const statusBadge = assessment.is_completed ? 'badge bg-success' : 
                                          assessment.visible ? 'badge bg-primary' : 'badge bg-secondary';
                        const statusText = assessment.is_completed ? 'Completada' : 
                                         assessment.visible ? 'Disponible' : 'No disponible';
                        const visibleIcon = assessment.visible ? 'fas fa-eye text-success' : 'fas fa-eye-slash text-muted';
                        
                        html += `
                            <tr>
                                <td><strong>${assessment.title}</strong></td>
                                <td><span class="${statusBadge}">${statusText}</span></td>
                                <td>${assessment.active_questions_count}</td>
                                <td><i class="${visibleIcon}"></i></td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            } else {
                html += `
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Problema Detectado</h6>
                        <strong>Error:</strong> ${data.error}<br>
                        ${data.details ? `<strong>Detalles:</strong> ${JSON.stringify(data.details, null, 2)}` : ''}
                    </div>
                `;
                
                if (data.error.includes('coach asignado')) {
                    html += `
                        <div class="alert alert-info">
                            <h6><i class="fas fa-info-circle me-2"></i>Solución Recomendada</h6>
                            <p>Para ver evaluaciones necesitas tener un coach asignado. Contacta al administrador del sistema para:</p>
                            <ul>
                                <li>Asignarte un coach</li>
                                <li>Verificar tu cuenta</li>
                                <li>Obtener acceso a evaluaciones</li>
                            </ul>
                        </div>
                    `;
                }
            }
            
            return html;
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // === SISTEMA DE TEMAS ===
        function initThemeSystem() {
            const themeToggle = document.getElementById('themeToggle');
            const html = document.documentElement;
            
            // Cargar tema guardado o usar el predeterminado
            const savedTheme = localStorage.getItem('theme') || 'light';
            setTheme(savedTheme);
            
            // Event listener para el botón de cambio de tema
            if (themeToggle) {
                themeToggle.addEventListener('click', toggleTheme);
            }
            
            function toggleTheme() {
                const currentTheme = html.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                setTheme(newTheme);
            }
            
            function setTheme(theme) {
                html.setAttribute('data-theme', theme);
                localStorage.setItem('theme', theme);
                
                // Actualizar el ícono del botón
                updateThemeIcon(theme);
                
                // Trigger evento personalizado para otros componentes
                window.dispatchEvent(new CustomEvent('themeChanged', { detail: theme }));
            }
            
            function updateThemeIcon(theme) {
                const sunIcon = document.querySelector('.sun-icon');
                const moonIcon = document.querySelector('.moon-icon');
                
                if (sunIcon && moonIcon) {
                    if (theme === 'dark') {
                        sunIcon.style.opacity = '1';
                        moonIcon.style.opacity = '0';
                    } else {
                        sunIcon.style.opacity = '0';
                        moonIcon.style.opacity = '1';
                    }
                }
            }
        }
        
        // Inicializar sistema de temas después de que se cargue todo
        setTimeout(initThemeSystem, 100);
    </script>
    
    <!-- Botón de cambio de tema -->
    <button id="themeToggle" class="theme-toggle" title="Cambiar tema">
        <i class="fas fa-sun icon sun-icon"></i>
        <i class="fas fa-moon icon moon-icon"></i>
    </button>
</body>
</html>
