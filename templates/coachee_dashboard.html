<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach/Dashboard</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts - Lobster Two & Pacifico -->
    <link href="https://fonts.googleapis.com/css2?family=Lobster+Two:wght@400;700&family=Pacifico&display=swap" rel="stylesheet">
    <!-- ‚ö° OPTIMIZACI√ìN FASE 2: Chart.js y PDF.js se cargan din√°micamente (lazy loading) -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script> -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script> -->
    <script>
        // Flags para lazy loading
        window.chartJsLoaded = false;
        window.pdfJsLoaded = false;
    </script>
    <script src="/static/js/recommendations.js?v={{ get_file_version('js/recommendations.js') }}"></script>
    <!-- CSS EXTERNOS NECESARIOS PARA SIDEBAR Y COMPONENTES -->
    <link rel="stylesheet" href="/static/css/instacoach-design-system.css?v={{ get_file_version('css/instacoach-design-system.css') }}">
    <link rel="stylesheet" href="/static/css/unified-dashboard.css?v={{ get_file_version('css/unified-dashboard.css') }}">
    
    <!-- ‚ö° OPTIMIZACI√ìN FASE 2: Motion.js removido (uso m√≠nimo, 11KB ahorrados) -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/motion@11.11.13/dist/motion.js"></script> -->
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        /* ============================================
           üé® PREMIUM ANIMATIONS & MICRO-INTERACTIONS
           ============================================ */
        
        /* Pulse animation for loading states */
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
                transform: scale(1);
            }
            50% {
                opacity: 0.8;
                transform: scale(0.98);
            }
        }
        
        /* Fade in animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Slide up animation */
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Scale in animation */
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* Premium Smooth Transitions */
        .transition-all {
            transition: all var(--transition-slow) var(--ease-smooth);
        }
        
        .transition-transform {
            transition: transform var(--transition-base) var(--ease-smooth);
        }
        
        .transition-colors {
            transition: background-color var(--transition-base) var(--ease-smooth),
                        border-color var(--transition-base) var(--ease-smooth),
                        color var(--transition-base) var(--ease-smooth);
        }
        
        .transition-bounce {
            transition: transform var(--transition-slower) var(--ease-bounce);
        }
        
        /* Focus visible for accessibility */
        *:focus-visible {
            outline: 2px solid #10b981;
            outline-offset: 2px;
            border-radius: 0.5rem;
        }
        
        /* Smooth scroll */
        html {
            scroll-behavior: smooth;
        }
        
        /* Button ripple effect */
        .btn-ripple {
            position: relative;
            overflow: hidden;
        }
        
        .btn-ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .btn-ripple:active::after {
            width: 300px;
            height: 300px;
        }
        
        /* Skeleton loading */
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        .skeleton {
            animation: shimmer 2s infinite linear;
            background: linear-gradient(
                to right,
                #f0f0f0 0%,
                #e0e0e0 20%,
                #f0f0f0 40%,
                #f0f0f0 100%
            );
            background-size: 1000px 100%;
        }
        
        /* Alpine.js x-cloak */
        [x-cloak] { display: none !important; }
        
        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(90, 103, 216, 0.08);
            border-radius: 50%;
            animation: float 25s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* ============================================
           üé® EXISTING STYLES
           ============================================ */
        
        /* ============================================
           üé® PREMIUM THEME VARIABLES - SaaS Professional
           ============================================ */
        :root {
            /* Light Theme - Primary Colors */
            --calm-primary: #1E3A8A;        /* Deep Blue */
            --calm-secondary: #3B82F6;      /* Bright Blue */
            --calm-accent: #06B6D4;         /* Cyan */
            --calm-light: #EFF6FF;          /* Very Light Blue */
            --calm-dark: #1E293B;           /* Dark Slate */
            --calm-white: #FFFFFF;
            --calm-gray-50: #F8FAFC;
            --calm-gray-100: #F1F5F9;
            
            /* Light Theme - Semantic Colors - MEJORADO CONTRASTE */
            --theme-bg-primary: #f8fafc;
            --theme-bg-secondary: #ffffff;
            --theme-bg-tertiary: #f1f5f9;
            --theme-text-primary: #0f172a;      /* M√°s oscuro: #1e293b ‚Üí #0f172a */
            --theme-text-secondary: #475569;    /* M√°s oscuro: #64748b ‚Üí #475569 */
            --theme-text-muted: #64748b;        /* M√°s oscuro: #94a3b8 ‚Üí #64748b */
            --theme-border: #e2e8f0;
            --theme-shadow: rgba(0, 0, 0, 0.1);
            --theme-shadow-lg: rgba(0, 0, 0, 0.15);
            
            /* Animation Timings */
            --transition-fast: 150ms;
            --transition-base: 200ms;
            --transition-slow: 300ms;
            --transition-slower: 400ms;
            --ease-smooth: cubic-bezier(0.4, 0, 0.2, 1);
            --ease-bounce: cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        /* Dark Theme Variables */
        [data-theme="dark"] {
            /* Dark Theme - Premium Deep Blues & Purples */
            --calm-primary: #6366f1;        /* Indigo */
            --calm-secondary: #8b5cf6;      /* Purple */
            --calm-accent: #06b6d4;         /* Cyan */
            --calm-light: #1e1b4b;          /* Deep Indigo */
            --calm-dark: #0f172a;           /* Darkest Slate */
            
            /* Dark Theme - Semantic Colors */
            --theme-bg-primary: #0f172a;    /* Darkest Slate */
            --theme-bg-secondary: #1e293b;  /* Dark Slate */
            --theme-bg-tertiary: #334155;   /* Medium Slate */
            --theme-text-primary: #f1f5f9;  /* Light Gray */
            --theme-text-secondary: #cbd5e1;/* Lighter Gray */
            --theme-text-muted: #94a3b8;    /* Muted Gray */
            --theme-border: #334155;        /* Border Gray */
            --theme-shadow: rgba(0, 0, 0, 0.5);
            --theme-shadow-lg: rgba(0, 0, 0, 0.7);
        }
        
        /* COLORES DE PRIORIDADES Y CATEGOR√çAS - COPIADOS DEL COACH DASHBOARD */
        .priority-high {
            border-top-color: #ef4444;
        }
        
        .priority-medium {
            border-top-color: #f59e0b;
        }
        
        .priority-low {
            border-top-color: #06b6d4;
        }
        
        .priority-growth {
            border-top-color: #10b981;
        }
        
        /* Estilos para dropdowns de tiempo en formato 24 horas */
        .time-select-24h {
            font-family: 'Courier New', monospace !important;
            font-weight: bold !important;
            font-size: 1.1em !important;
            text-align: center !important;
            color: #1E3A8A !important;
            background-color: #f8f9fa !important;
            border: 2px solid #e9ecef !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e") !important;
        }
        
        .time-select-24h:focus {
            border-color: #1E3A8A !important;
            box-shadow: 0 0 0 0.2rem rgba(30, 58, 138, 0.25) !important;
            background-color: white !important;
        }
        
        .time-select-24h option {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #1E3A8A;
            background-color: white;
            padding: 8px;
        }
        
        .time-select-24h option:hover {
            background-color: #f8f9fa !important;
        }
        
        .time-select-24h option:checked,
        .time-select-24h option:selected {
            background-color: #1E3A8A !important;
            color: white !important;
        }
        
        .time-input-24h {
            font-family: 'Courier New', monospace !important;
            font-weight: bold !important;
            font-size: 1.1em !important;
            letter-spacing: 1px !important;
            text-align: center !important;
            color: #1E3A8A !important;
            background-color: #f8f9fa !important;
            border: 2px solid #e9ecef !important;
        }
        
        .time-input-24h:focus {
            border-color: #1E3A8A !important;
            box-shadow: 0 0 0 0.2rem rgba(30, 58, 138, 0.25) !important;
            background-color: white !important;
        }
        
        .time-input-24h.is-valid {
            border-color: #28a745 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='m2.3 6.73 1.42 1.42 3.47-3.47'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right calc(0.375em + 0.1875rem) center !important;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem) !important;
        }
        
        .time-input-24h.is-invalid {
            border-color: #dc3545 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 4.2.4-.4.4.4-.4.4.4.4-.4.4-.4-.4-.4.4-.4-.4.4-.4-.4-.4.4-.4Z'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right calc(0.375em + 0.1875rem) center !important;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem) !important;
        }
        
        input[type="time"][data-format="24h"] {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1.1em;
            letter-spacing: 1px;
        }
        
        input[type="time"][data-format="24h"]::-webkit-calendar-picker-indicator {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="%23666" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-6V7h2v4h4v2z"/></svg>') no-repeat;
        }
        
        /* Asegurar que el formato sea siempre 24h */
        input[type="time"][data-format="24h"]::-webkit-datetime-edit-hour-field {
            color: #1E3A8A;
            font-weight: bold;
        }
        
        input[type="time"][data-format="24h"]::-webkit-datetime-edit-minute-field {
            color: #1E3A8A;
            font-weight: bold;
        }
        
        /* ESTILOS PARA SIDEBAR PANEL DE CONTROL - MODERNO (IGUAL QUE COACH) */
        .sidebar {
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid #f3f4f6;
            overflow: hidden;
            transition: box-shadow 0.3s ease;
            position: sticky;
            top: 0;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
            margin-top: -1rem; /* Reducido a un tercio: de -1.5rem a -1rem */
        }
        
        [data-theme="dark"] .sidebar {
            background: #1e293b;
            border-color: #334155;
        }
        
        .sidebar:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        [data-theme="dark"] .sidebar:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .sidebar .card-header {
            background: #ffffff;
            border: none;
            border-bottom: 1px solid #f3f4f6;
            padding: 2rem 1.75rem;
            position: relative;
        }
        
        [data-theme="dark"] .sidebar .card-header {
            background: #1e293b;
            border-bottom-color: #334155;
        }
        
        .sidebar .card-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 1.75rem;
            right: 1.75rem;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.05), transparent);
        }
        
        .sidebar .card-header h5 {
            color: #111827;
            font-weight: 600;
            font-size: 1.125rem;
            margin: 0;
            display: flex;
            align-items: center;
            letter-spacing: 0.3px;
        }
        
        [data-theme="dark"] .sidebar .card-header h5 {
            color: #f1f5f9;
        }
        
        .sidebar .card-header h5 i {
            margin-right: 0.75rem;
            font-size: 1.25rem;
            opacity: 0.95;
            color: #111827;
        }
        
        [data-theme="dark"] .sidebar .card-header h5 i {
            color: #f1f5f9;
        }
        
        .sidebar .card-header p {
            margin: 0.5rem 0 0 0;
            font-size: 0.8125rem;
            opacity: 0.85;
            color: #111827;
        }
        
        [data-theme="dark"] .sidebar .card-header p {
            color: #cbd5e1;
        }
        
        .sidebar .card-body {
            padding: 0.75rem 0.5rem;
        }
        
        .list-group-item {
            background: transparent;
            color: #4b5563;
            border: none;
            border-left: 2px solid transparent;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 0.9375rem;
            padding: 0.875rem 1.5rem;
            margin: 0.125rem 0.5rem;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
        }
        
        [data-theme="dark"] .list-group-item {
            color: #94a3b8;
        }
        
        .list-group-item:hover {
            background: #f9fafb;
            color: #667eea;
            border-left-color: #667eea;
            transform: translateX(2px);
        }
        
        [data-theme="dark"] .list-group-item:hover {
            background: #334155;
            color: #a78bfa;
            border-left-color: #a78bfa;
        }
        
        .list-group-item.active,
        .list-group-item-action.active {
            background: transparent !important;
            color: #4b5563 !important;
            font-weight: 600;
            border-left-color: #667eea !important;
        }
        
        [data-theme="dark"] .list-group-item.active,
        [data-theme="dark"] .list-group-item-action.active {
            background: rgba(167, 139, 250, 0.15) !important;
            color: #f1f5f9 !important;
            border-left-color: #a78bfa !important;
        }
        
        .list-group-item.active span,
        .list-group-item-action.active span {
            color: #4b5563 !important;
        }
        
        [data-theme="dark"] .list-group-item.active span,
        [data-theme="dark"] .list-group-item-action.active span {
            color: #f1f5f9 !important;
        }
        
        .list-group-item.active i,
        .list-group-item-action.active i {
            color: #667eea !important;
        }
        
        [data-theme="dark"] .list-group-item.active i,
        [data-theme="dark"] .list-group-item-action.active i {
            color: #a78bfa !important;
        }
        
        .list-group-item i {
            width: 18px;
            margin-right: 0.875rem;
            font-size: 0.9375rem;
            text-align: center;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }
        
        .list-group-item:hover i,
        .list-group-item.active i {
            opacity: 1;
        }
        
        /* CATEGOR√çAS DE RECOMENDACIONES */
        .general-recommendations {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }
        
        .general-recommendations .category-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: #0f172a !important;
            border-bottom-color: var(--calm-primary);
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
        }
        
        .general-recommendations .category-title {
            color: #0f172a !important;
        }
        
        .strengths-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .strengths-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: #0f172a !important;
            border-bottom-color: #10b981;
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
        }
        
        .strengths-category .category-title {
            color: #0f172a !important;
        }
        
        .strengths-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .strengths-category .recommendation-item:before {
            background: #10b981;
            content: "‚òÖ";
        }
        
        .final-message {
            border: 2px solid #8b5cf6;
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
        }
        
        .final-message .category-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: #0f172a !important;
            border-bottom-color: #8b5cf6;
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
        }
        
        .final-message .category-title {
            color: #0f172a !important;
        }
        
        .final-message .recommendation-item {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-left-color: #8b5cf6;
        }
        
        /* ESTILOS DE BODY Y FONDO - UNIFICADO CON TEMA DIN√ÅMICO */
        body {
            background: var(--theme-bg-primary) !important;
            color: var(--theme-text-primary) !important;
            transition: background var(--transition-slow) var(--ease-smooth),
                        color var(--transition-slow) var(--ease-smooth);
            overflow-x: hidden;
        }
        
        /* Container principal con z-index para aparecer sobre part√≠culas */
        .container-fluid {
            position: relative;
            z-index: 2;
        }
        
        /* Animated background particles - IGUAL QUE COACH */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            background: rgba(90, 103, 216, 0.08);
            border-radius: 50%;
            animation: float 25s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Cards y contenedores - Premium Theme Support */
        /* Excluir tarjetas de estad√≠sticas del estilo global */
        .card:not(.stats-card-mobile .card),
        .glass-card,
        .modal-content,
        .dashboard-card {
            background: var(--theme-bg-secondary) !important;
            border: 1px solid var(--theme-border) !important;
            color: var(--theme-text-primary) !important;
            box-shadow: 0 2px 4px var(--theme-shadow) !important;
            border-radius: 0.5rem !important;
            transition: background var(--transition-base) var(--ease-smooth),
                        border-color var(--transition-base) var(--ease-smooth),
                        box-shadow var(--transition-slow) var(--ease-smooth),
                        transform var(--transition-base) var(--ease-smooth);
            position: relative;
            z-index: 2;
        }
        
        /* Modal de evaluaci√≥n - Sin backdrop, con scroll de p√°gina */
        #evaluationDetailsModal {
            z-index: 9999 !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            overflow-y: auto !important;
            overflow-x: hidden !important;
            background: rgba(0, 0, 0, 0.5) !important;
            padding: 0 !important;
        }
        
        #evaluationDetailsModal.show {
            display: block !important;
            opacity: 1 !important;
            visibility: visible !important;
        }
        
        #evaluationDetailsModal .modal-dialog {
            margin: 2rem auto !important;
            pointer-events: auto !important;
            position: relative;
            width: 90%;
            max-width: 900px;
        }
        
        #evaluationDetailsModal .modal-content {
            background: white !important;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3) !important;
            pointer-events: auto !important;
            position: relative;
            border-radius: 12px;
        }
        
        #evaluationDetailsModal .modal-body {
            max-height: calc(100vh - 200px);
            overflow-y: auto !important;
        }
        
        /* Asegurar que no haya backdrop adicional */
        .modal-backdrop {
            display: none !important;
        }
        
        .card.bg-dark:not(.stats-card-mobile .card) {
            background: white !important;
            border: 1px solid #e2e8f0 !important;
        }
        
        .card.bg-dark .card-body:not(.stats-card-mobile .card-body) {
            background: white !important;
        }
    
        /* Textos */
        .text-white,
        .text-muted,
        .card.bg-dark .text-white,
        .card.bg-dark .text-muted {
            color: #1e293b !important;
        }
        
        [data-theme="dark"] .text-white,
        [data-theme="dark"] .text-muted,
        [data-theme="dark"] .card.bg-dark .text-white,
        [data-theme="dark"] .card.bg-dark .text-muted {
            color: #f1f5f9 !important;
        }
        
        .text-primary {
            color: var(--calm-secondary) !important;
        }
        
        .text-muted {
            color: #4b5563 !important;
        }
        
        [data-theme="dark"] .text-muted {
            color: #94a3b8 !important;
        }
        
        /* Mejora de contraste para textos en modo d√≠a */
        [data-theme="light"] .text-muted {
            color: #4b5563 !important;
        }
        
        [data-theme="light"] .text-success {
            color: #059669 !important;
        }
        
        [data-theme="light"] .text-warning {
            color: #d97706 !important;
        }
        
        [data-theme="light"] .text-danger {
            color: #dc2626 !important;
        }
        
        /* ========================================
           üé® CLASES PERSONALIZADAS - TAB DISPONIBILIDAD COACH
           ======================================== */
        
        /* Modo D√≠a - Textos oscuros legibles */
        .avail-card {
            color: #0f172a !important;
        }
        
        .avail-muted {
            color: #64748b !important;
        }
        
        .avail-success {
            color: #059669 !important;
        }
        
        .avail-warning {
            color: #d97706 !important;
        }
        
        /* Modo Noche - Textos claros */
        [data-theme="dark"] .avail-card {
            color: #e2e8f0 !important;
        }
        
        [data-theme="dark"] .avail-muted {
            color: #94a3b8 !important;
        }
        
        [data-theme="dark"] .avail-success {
            color: #10b981 !important;
        }
        
        [data-theme="dark"] .avail-warning {
            color: #fbbf24 !important;
        }
        
        /* ============================================ */
        /* HEADERS INTERNOS - THEME-AWARE */
        /* ============================================ */
        
        /* Card Header - Disponibilidad del Coach - Modo D√≠a */
        .avail-card-header,
        [data-theme="light"] .avail-card-header {
            background: #f9fafb !important;
            border-bottom: 2px solid #e5e7eb !important;
            position: relative;
            overflow: hidden;
        }
        
        .avail-card-header h6,
        [data-theme="light"] .avail-card-header h6 {
            color: #111827 !important;
            font-size: 0.875rem;
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .avail-icon-info,
        [data-theme="light"] .avail-icon-info {
            color: #3b82f6 !important;
            font-size: 1rem;
        }
        
        .avail-icon-lightbulb,
        [data-theme="light"] .avail-icon-lightbulb {
            color: #f59e0b !important;
            font-size: 1rem;
        }
        
        /* Card Header - Disponibilidad del Coach - Modo Noche */
        [data-theme="dark"] .avail-card-header {
            background: #1e293b !important;
            border-bottom: 2px solid #334155 !important;
        }
        
        [data-theme="dark"] .avail-card-header h6 {
            color: #ffffff !important;
            font-weight: 600;
        }
        
        [data-theme="dark"] .avail-icon-info {
            color: #60a5fa !important;
            font-size: 1rem;
        }
        
        [data-theme="dark"] .avail-icon-lightbulb {
            color: #fbbf24 !important;
            font-size: 1rem;
        }
        
        /* Card Body - Disponibilidad del Coach */
        .avail-card-body {
            background: #ffffff;
        }
        
        [data-theme="dark"] .avail-card-body {
            background: #0f172a !important;
        }
        
        /* Card Body - Session Request */
        .session-card-body {
            background: #ffffff;
        }
        
        [data-theme="dark"] .session-card-body {
            background: #0f172a !important;
        }
        
        /* Session Request Card Header - Modo D√≠a */
        .session-card-header,
        [data-theme="light"] .session-card-header {
            background: #f8f9fa !important;
            border-bottom: 2px solid #e5e7eb !important;
            position: relative;
            overflow: hidden;
        }
        
        .session-card-header h6,
        [data-theme="light"] .session-card-header h6 {
            color: #111827 !important;
            font-size: clamp(0.875rem, 3vw, 1rem);
            font-weight: 600;
            position: relative;
            z-index: 1;
        }
        
        .session-icon-calendar,
        [data-theme="light"] .session-icon-calendar {
            color: #667eea !important;
            font-size: 1rem;
        }
        
        /* Session Request Card Header - Modo Noche */
        [data-theme="dark"] .session-card-header {
            background: #1e293b !important;
            border-bottom: 2px solid #334155 !important;
        }
        
        [data-theme="dark"] .session-card-header h6 {
            color: #ffffff !important;
            font-weight: 600;
        }
        
        [data-theme="dark"] .session-icon-calendar {
            color: #818cf8 !important;
            font-size: 1rem;
        }
        
        /* Estilos para tarjetas de Mis Sesiones */
        .my-session-card {
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        .my-session-card-body {
            background: #ffffff;
            padding: 1.25rem;
        }
        
        .my-session-title {
            color: #111827 !important;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .my-session-text {
            color: #374151 !important;
            font-size: 0.95rem;
        }
        
        .my-session-text i {
            color: #6b7280;
        }
        
        .my-session-description {
            color: #6b7280 !important;
            font-size: 0.875rem;
        }
        
        /* Modo oscuro para tarjetas de Mis Sesiones */
        [data-theme="dark"] .my-session-card {
            background: #1e293b;
            border-color: #334155;
        }
        
        [data-theme="dark"] .my-session-card-body {
            background: #1e293b !important;
        }
        
        [data-theme="dark"] .my-session-title {
            color: #f1f5f9 !important;
        }
        
        [data-theme="dark"] .my-session-text {
            color: #cbd5e1 !important;
        }
        
        [data-theme="dark"] .my-session-text i {
            color: #94a3b8;
        }
        
        [data-theme="dark"] .my-session-description {
            color: #94a3b8 !important;
        }
        
        /* Botones con hover - Reemplazo de eventos inline */
        .btn-hover-primary {
            background: white;
            border: 1px solid #e5e7eb;
            color: #667eea;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-hover-primary:hover {
            background: #667eea !important;
            color: white !important;
        }
        
        .btn-hover-warning {
            background: white;
            border: 1px solid #e5e7eb;
            color: #f59e0b;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-hover-warning:hover {
            background: #f59e0b !important;
            color: white !important;
        }
        
        .btn-hover-success {
            background: white;
            border: 1px solid #e5e7eb;
            color: #10b981;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-hover-success:hover {
            background: #10b981 !important;
            color: white !important;
        }
        
        .btn-hover-danger {
            background: white;
            border: 1px solid #e5e7eb;
            color: #ef4444;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-hover-danger:hover {
            background: #ef4444 !important;
            color: white !important;
        }
        
        /* ============================================
           üé® DEVELOPMENT PLAN CARDS - THEME SUPPORT
           ============================================ */
        
        .dev-plan-card {
            background: white;
            border: 1.5px solid #e5e7eb;
            border-radius: 10px;
            padding: 0.875rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s ease;
            cursor: pointer;
            position: relative;
        }
        
        [data-theme="dark"] .dev-plan-card {
            background: #1e293b;
            border-color: #334155;
        }
        
        .dev-plan-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        [data-theme="dark"] .dev-plan-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .plan-toggle-btn {
            background: #f3f4f6;
            border: none;
            border-radius: 6px;
            padding: 0.35rem 0.5rem;
            color: #667eea;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        [data-theme="dark"] .plan-toggle-btn {
            background: #334155;
            color: #818cf8;
        }
        
        .plan-toggle-btn:hover {
            background: #667eea;
            color: white;
        }
        
        [data-theme="dark"] .plan-toggle-btn:hover {
            background: #818cf8;
            color: white;
        }
        
        .plan-objective-box {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.06) 0%, rgba(118, 75, 162, 0.06) 100%);
            border-left: 2px solid #667eea;
            border-radius: 5px;
            padding: 0.65rem 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        [data-theme="dark"] .plan-objective-box {
            background: linear-gradient(135deg, rgba(129, 140, 248, 0.15) 0%, rgba(167, 139, 250, 0.15) 100%);
            border-left-color: #818cf8;
        }
        
        .plan-objective-title {
            color: #667eea;
            font-weight: 700;
            margin-bottom: 0.35rem;
            display: flex;
            align-items: center;
            font-size: 0.8rem;
        }
        
        [data-theme="dark"] .plan-objective-title {
            color: #818cf8;
        }
        
        .plan-objective-text {
            color: #334155;
            font-size: 0.8rem;
            margin: 0;
            line-height: 1.4;
        }
        
        [data-theme="dark"] .plan-objective-text {
            color: #cbd5e1;
        }
        
        .plan-details-box {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 5px;
            padding: 0.65rem 0.75rem;
            margin-bottom: 0.5rem;
        }
        
        [data-theme="dark"] .plan-details-box {
            background: #0f172a;
            border-color: #334155;
        }
        
        .plan-indicators-box {
            background: #f0fdf4;
            border: 1.5px solid #86efac;
            border-radius: 5px;
            padding: 0.65rem 0.75rem;
        }
        
        [data-theme="dark"] .plan-indicators-box {
            background: rgba(34, 197, 94, 0.15);
            border-color: #22c55e;
        }
        
        .plan-indicators-title {
            color: #16a34a;
            font-weight: 600;
            margin-bottom: 0.35rem;
            display: flex;
            align-items: center;
            font-size: 0.75rem;
        }
        
        [data-theme="dark"] .plan-indicators-title {
            color: #4ade80;
        }
        
        .plan-indicators-text {
            color: #166534;
            margin: 0;
            line-height: 1.4;
            white-space: pre-wrap;
            font-size: 0.75rem;
        }
        
        [data-theme="dark"] .plan-indicators-text {
            color: #86efac;
        }
        
        .plan-action-card {
            background: #fafafa;
            border: 1px solid #e5e7eb;
            border-radius: 5px;
            padding: 0.5rem 0.65rem;
            margin-bottom: 0.4rem;
        }
        
        [data-theme="dark"] .plan-action-card {
            background: #0f172a;
            border-color: #334155;
        }
        
        .plan-action-text {
            color: #334155;
            font-weight: 500;
            margin-bottom: 0.25rem;
            font-size: 0.75rem;
            line-height: 1.3;
        }
        
        [data-theme="dark"] .plan-action-text {
            color: #cbd5e1;
        }
        
        /* Plan Area Badges - Color variants with theme support */
        .plan-area-badge {
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-weight: 600;
            font-size: 0.7rem;
            display: inline-block;
            line-height: 1.2;
            border: 1px solid;
        }
        
        .plan-area-badge-blue {
            background: #dbeafe;
            border-color: #3b82f6;
            color: #1e40af;
        }
        
        [data-theme="dark"] .plan-area-badge-blue {
            background: rgba(59, 130, 246, 0.2);
            border-color: #60a5fa;
            color: #93c5fd;
        }
        
        .plan-area-badge-green {
            background: #d1fae5;
            border-color: #22c55e;
            color: #166534;
        }
        
        [data-theme="dark"] .plan-area-badge-green {
            background: rgba(34, 197, 94, 0.2);
            border-color: #4ade80;
            color: #86efac;
        }
        
        .plan-area-badge-yellow {
            background: #fef3c7;
            border-color: #f59e0b;
            color: #92400e;
        }
        
        [data-theme="dark"] .plan-area-badge-yellow {
            background: rgba(245, 158, 11, 0.2);
            border-color: #fbbf24;
            color: #fcd34d;
        }
        
        /* Plan Number Badge */
        .plan-number-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 0.25rem 0.65rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-block;
        }
        
        [data-theme="dark"] .plan-number-badge {
            background: linear-gradient(135deg, #818cf8 0%, #a78bfa 100%);
        }
        
        /* ============================================
           üìä PROGRESS KPIs - THEME SUPPORT
           ============================================ */
        
        /* Progress KPI Cards */
        .progress-kpi-card {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.13) 0%, rgba(118, 75, 162, 0.13) 100%);
            border: 1px solid rgba(102, 126, 234, 0.27);
        }
        
        [data-theme="dark"] .progress-kpi-card {
            background: linear-gradient(135deg, rgba(129, 140, 248, 0.15) 0%, rgba(167, 139, 250, 0.15) 100%);
            border-color: rgba(129, 140, 248, 0.3);
        }
        
        .progress-kpi-card-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.13) 0%, rgba(5, 155, 105, 0.13) 100%);
            border: 1px solid rgba(16, 185, 129, 0.27);
        }
        
        [data-theme="dark"] .progress-kpi-card-success {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(21, 128, 61, 0.15) 100%);
            border-color: rgba(34, 197, 94, 0.3);
        }
        
        .progress-kpi-card-warning {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.13) 0%, rgba(217, 115, 0, 0.13) 100%);
            border: 1px solid rgba(245, 158, 11, 0.27);
        }
        
        [data-theme="dark"] .progress-kpi-card-warning {
            background: linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.15) 100%);
            border-color: rgba(251, 191, 36, 0.3);
        }
        
        /* KPI Values - Text color adjustments */
        .progress-kpi-value.text-primary {
            color: #667eea !important;
        }
        
        [data-theme="dark"] .progress-kpi-value.text-primary {
            color: #818cf8 !important;
        }
        
        .progress-kpi-value.text-success {
            color: #10b981 !important;
        }
        
        [data-theme="dark"] .progress-kpi-value.text-success {
            color: #22c55e !important;
        }
        
        .progress-kpi-value.text-warning {
            color: #f59e0b !important;
        }
        
        [data-theme="dark"] .progress-kpi-value.text-warning {
            color: #fbbf24 !important;
        }
        
        /* ============================================
           üìã TASKS/ACTIONS CARDS - THEME SUPPORT
           ============================================ */
        
        .task-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 1.25rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        [data-theme="dark"] .task-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border-color: #334155;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
        }
        
        .task-card:hover {
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.15);
            transform: translateY(-4px);
        }
        
        [data-theme="dark"] .task-card:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
        }
        
        .task-card-title {
            color: #0f172a;
            font-size: 1rem;
            font-weight: 700;
            line-height: 1.3;
            letter-spacing: -0.01em;
        }
        
        [data-theme="dark"] .task-card-title {
            color: #f1f5f9;
        }
        
        .task-progress-box {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 0.875rem;
        }
        
        [data-theme="dark"] .task-progress-box {
            background: #0f172a;
            border-color: #334155;
        }
        
        .task-progress-label {
            color: #6b7280;
            font-size: 0.8125rem;
            font-weight: 600;
        }
        
        [data-theme="dark"] .task-progress-label {
            color: #94a3b8;
        }
        
        .task-progress-value {
            color: #10b981;
            font-size: 0.875rem;
            font-weight: 700;
        }
        
        [data-theme="dark"] .task-progress-value {
            color: #4ade80;
        }
        
        /* Task Priority Badges */
        .task-priority-badge {
            padding: 0.3rem 0.625rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 700;
            white-space: nowrap;
            letter-spacing: 0.02em;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .task-priority-high {
            background: #fef2f2;
            color: #dc2626;
        }
        
        [data-theme="dark"] .task-priority-high {
            background: rgba(220, 38, 38, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(220, 38, 38, 0.3);
        }
        
        .task-priority-medium {
            background: #fffbeb;
            color: #f59e0b;
        }
        
        [data-theme="dark"] .task-priority-medium {
            background: rgba(245, 158, 11, 0.2);
            color: #fcd34d;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        
        .task-priority-low {
            background: #f0f9ff;
            color: #0284c7;
        }
        
        [data-theme="dark"] .task-priority-low {
            background: rgba(2, 132, 199, 0.2);
            color: #7dd3fc;
            border: 1px solid rgba(2, 132, 199, 0.3);
        }
        
        /* Task Status Badges */
        .task-status-badge {
            padding: 0.3rem 0.5rem;
            border-radius: 5px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.75rem;
        }
        
        .task-status-pending {
            background: #fffbeb;
            color: #d97706;
        }
        
        [data-theme="dark"] .task-status-pending {
            background: rgba(217, 119, 6, 0.2);
            color: #fbbf24;
            border: 1px solid rgba(217, 119, 6, 0.3);
        }
        
        .task-status-in_progress {
            background: #eff6ff;
            color: #3b82f6;
        }
        
        [data-theme="dark"] .task-status-in_progress {
            background: rgba(59, 130, 246, 0.2);
            color: #93c5fd;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .task-status-completed {
            background: #f0fdf4;
            color: #10b981;
        }
        
        [data-theme="dark"] .task-status-completed {
            background: rgba(16, 185, 129, 0.2);
            color: #6ee7b7;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .task-status-blocked {
            background: #fef2f2;
            color: #ef4444;
        }
        
        [data-theme="dark"] .task-status-blocked {
            background: rgba(239, 68, 68, 0.2);
            color: #fca5a5;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        /* Statistics Cards - Efectos Hover Modernos */
        .stats-card-clickable:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15) !important;
        }
        
        .stats-card-clickable {
            cursor: pointer;
        }
        
        /* Responsive Stats Cards */
        @media (max-width: 768px) {
            .stats-card-mobile .card-body {
                padding: 1rem !important;
            }
        }
        
        /* Botones */
        .btn-outline-light {
            border-color: #e2e8f0 !important;
            color: #1e293b !important;
            background: white !important;
        }
        
        [data-theme="dark"] .btn-outline-light {
            border-color: #334155 !important;
            color: #f1f5f9 !important;
            background: #1e293b !important;
        }
        
        .btn-outline-light:hover {
            background: #f1f5f9 !important;
            border-color: #e2e8f0 !important;
            color: #1e293b !important;
        }
        
        [data-theme="dark"] .btn-outline-light:hover {
            background: #334155 !important;
            border-color: #475569 !important;
            color: #f1f5f9 !important;
        }
    
        /* Botones - Premium Theme Support */
        .btn-primary {
            background: linear-gradient(135deg, var(--calm-secondary) 0%, var(--calm-primary) 100%) !important;
            border-color: var(--calm-secondary) !important;
            color: white !important;
            transition: transform var(--transition-base) var(--ease-smooth),
                        box-shadow var(--transition-base) var(--ease-smooth),
                        background var(--transition-base) var(--ease-smooth) !important;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
            filter: brightness(1.1);
        }
        
        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
        }
        
        .btn-secondary {
            background: var(--theme-bg-tertiary) !important;
            border-color: var(--theme-border) !important;
            color: var(--theme-text-primary) !important;
            transition: all var(--transition-base) var(--ease-smooth) !important;
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: var(--theme-border) !important;
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: #28a745 !important;
            border-color: #28a745 !important;
            color: white !important;
        }
        
        .btn-info {
            background: #17a2b8 !important;
            border-color: #17a2b8 !important;
            color: white !important;
        }
        
        /* HEADER STYLES - InstaCoach Design System */
        header h1.gradient-purple-text {
            font-family: 'Pacifico', cursive !important;
            font-size: 1.75rem !important;
            font-weight: 700 !important;
            letter-spacing: -0.4px !important;
            margin: 0 !important;
            background: linear-gradient(135deg, var(--purple-start) 0%, var(--purple-end) 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }
        
        /* ESTILOS GENERALES PARA DASHBOARD HEADER - ESTILO FEED */
        /* Header - UNIFICADO CON FEED - Con Soporte de Tema */
        .feed-header {
            background: var(--theme-bg-secondary);
            border-bottom: 1px solid var(--theme-border);
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: background var(--transition-base) var(--ease-smooth),
                        border-color var(--transition-base) var(--ease-smooth);
        }
        
        .feed-header h3 {
            font-family: 'Lobster Two', cursive !important;
            font-size: 32px !important;
            font-weight: 400 !important;
            margin: 0 !important;
            color: #0f172a !important; /* Color fijo oscuro para m√°ximo contraste */
            letter-spacing: 0.5px !important;
            line-height: 1.2 !important;
            transition: color var(--transition-base) var(--ease-smooth);
        }
        
        /* Dark theme override */
        [data-theme="dark"] .feed-header h3 {
            color: #f1f5f9 !important;
        }
        
        .feed-header p {
            color: var(--theme-text-secondary) !important;
            transition: color var(--transition-base) var(--ease-smooth);
        }
        
        /* Responsive font sizes for InstaCoach title */
        @media (max-width: 768px) {
            .feed-header h3 {
                font-size: 28px !important;
            }
        }
        
        @media (max-width: 576px) {
            .feed-header h3 {
                font-size: 24px !important;
            }
        }
        
        /* Extra specificity for h3 to override any Bootstrap or default styles */
        .feed-header > div > h3,
        #instacoach-title {
            font-family: 'Lobster Two', cursive !important;
            font-size: 32px !important;
        }
        
        @media (max-width: 768px) {
            .feed-header > div > h3,
            #instacoach-title {
                font-size: 28px !important;
            }
        }
        
        @media (max-width: 576px) {
            .feed-header > div > h3,
            #instacoach-title {
                font-size: 24px !important;
            }
        }
        
        .feed-header .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feed-header .user-avatar {
            width: 51px;
            height: 51px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 21px;
            font-weight: 600;
            overflow: hidden;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .feed-header .user-avatar:hover {
            transform: scale(1.08);
        }
        
        .feed-header .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* ============================================
           üé® UTILITY CLASSES - Better Contrast
           ============================================ */
        
        /* Text Colors - Optimized Contrast for Day/Night */
        .text-heading {
            color: #0f172a !important;
        }
        
        [data-theme="dark"] .text-heading {
            color: #f1f5f9 !important;
        }
        
        .text-subheading {
            color: #475569 !important;
        }
        
        [data-theme="dark"] .text-subheading {
            color: #cbd5e1 !important;
        }
        
        .text-body {
            color: #475569 !important;
        }
        
        [data-theme="dark"] .text-body {
            color: #cbd5e1 !important;
        }
        
        .text-muted-custom {
            color: #64748b !important;
        }
        
        [data-theme="dark"] .text-muted-custom {
            color: #94a3b8 !important;
        }
        
        /* Specific inline style overrides with theme support */
        .inline-text-dark {
            color: #0f172a !important;
        }
        
        [data-theme="dark"] .inline-text-dark {
            color: #f1f5f9 !important;
        }
        
        .inline-text-medium {
            color: #475569 !important;
        }
        
        [data-theme="dark"] .inline-text-medium {
            color: #cbd5e1 !important;
        }
        
        .inline-text-light {
            color: #64748b !important;
        }
        
        [data-theme="dark"] .inline-text-light {
            color: #94a3b8 !important;
        }
        
        /* ============================================
           üé® THEME-AWARE BACKGROUNDS
           ============================================ */
        
        /* Category Header Gradient Background */
        .category-header-bg {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%) !important;
        }
        
        [data-theme="dark"] .category-header-bg {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
        }
        
        /* Card Background - Pure white in light, dark slate in dark mode */
        .card-bg-theme {
            background: #ffffff !important;
        }
        
        [data-theme="dark"] .card-bg-theme {
            background: #1e293b !important;
        }
        
        /* Metadata Badge Background (with colored border) */
        .metadata-badge-bg-orange {
            background: #ffffff !important;
            border: 2px solid #fd7e14 !important;
        }
        
        [data-theme="dark"] .metadata-badge-bg-orange {
            background: rgba(253, 126, 20, 0.15) !important;
            border: 2px solid #fd7e14 !important;
        }
        
        .metadata-badge-bg-purple {
            background: #ffffff !important;
            border: 2px solid #8b5cf6 !important;
        }
        
        [data-theme="dark"] .metadata-badge-bg-purple {
            background: rgba(139, 92, 246, 0.15) !important;
            border: 2px solid #8b5cf6 !important;
        }
        
        /* Metadata Badge Text Colors */
        .metadata-text-orange {
            color: #fd7e14 !important;
        }
        
        [data-theme="dark"] .metadata-text-orange {
            color: #fb923c !important;
        }
        
        .metadata-text-purple {
            color: #8b5cf6 !important;
        }
        
        [data-theme="dark"] .metadata-text-purple {
            color: #a78bfa !important;
        }
        
        /* Coach Info Box - Tinted background */
        .coach-info-bg-orange {
            background: rgba(253, 126, 20, 0.15) !important;
            border: 1px solid #fd7e14 !important;
        }
        
        [data-theme="dark"] .coach-info-bg-orange {
            background: rgba(253, 126, 20, 0.25) !important;
            border: 1px solid #fb923c !important;
        }
        
        .coach-info-bg-purple {
            background: rgba(139, 92, 246, 0.15) !important;
            border: 1px solid #8b5cf6 !important;
        }
        
        [data-theme="dark"] .coach-info-bg-purple {
            background: rgba(139, 92, 246, 0.25) !important;
            border: 1px solid #a78bfa !important;
        }
        
        /* Card Header Icon Background */
        .card-header-bg-orange {
            background: rgba(253, 126, 20, 0.15) !important;
        }
        
        [data-theme="dark"] .card-header-bg-orange {
            background: rgba(253, 126, 20, 0.25) !important;
        }
        
        .card-header-bg-purple {
            background: rgba(139, 92, 246, 0.15) !important;
        }
        
        [data-theme="dark"] .card-header-bg-purple {
            background: rgba(139, 92, 246, 0.25) !important;
        }
        
        /* Pink/Magenta variants for #e83e8c */
        .metadata-badge-bg-pink {
            background: #ffffff !important;
            border: 2px solid #e83e8c !important;
        }
        
        [data-theme="dark"] .metadata-badge-bg-pink {
            background: rgba(232, 62, 140, 0.15) !important;
            border: 2px solid #ec4899 !important;
        }
        
        .metadata-text-pink {
            color: #e83e8c !important;
        }
        
        [data-theme="dark"] .metadata-text-pink {
            color: #ec4899 !important;
        }
        
        .coach-info-bg-pink {
            background: rgba(232, 62, 140, 0.15) !important;
            border: 1px solid #e83e8c !important;
        }
        
        [data-theme="dark"] .coach-info-bg-pink {
            background: rgba(232, 62, 140, 0.25) !important;
            border: 1px solid #ec4899 !important;
        }
        
        .card-header-bg-pink {
            background: rgba(232, 62, 140, 0.15) !important;
        }
        
        [data-theme="dark"] .card-header-bg-pink {
            background: rgba(232, 62, 140, 0.25) !important;
        }
        
        .feed-header .dropdown .btn-link {
            font-size: 20px;
            text-decoration: none;
            opacity: 0.9;
            transition: opacity 0.2s;
            color: #262626 !important;
        }
        
        .feed-header .dropdown .btn-link:hover {
            opacity: 1;
            color: #000000 !important;
        }
        
        .feed-header .dropdown-menu {
            min-width: 200px;
        }
        
        /* STATISTICS CARDS MEJORADAS - DISE√ëO MODERNO Y ATRACTIVO */
        /* .stats-card-mobile { margin-bottom removido } */
        
        /* Eliminar borde de los contenedores de iconos */
        .stats-card-mobile .card-body > div {
            border: none !important;
        }
        
        /* Estilos removidos - ahora se usan estilos inline en las tarjetas para mantener gradientes coloridos */
        
        /* TARJETA CLICKEABLE DE ESTAD√çSTICAS */
        .stats-card-clickable {
            transition: all 0.3s ease;
            user-select: none !important;
        }
        
        .stats-card-clickable:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
        }
        
        .stats-card-clickable:hover .fa-clipboard-check {
            color: #28a745 !important;
            transform: scale(1.1) !important;
        }
        
        .stats-card-clickable:hover .fa-tasks {
            color: #ffc107 !important;
            transform: scale(1.1) !important;
        }
        
        .stats-card-clickable:hover .fa-exclamation-triangle {
            color: #dc3545 !important;
            transform: scale(1.1) !important;
        }
        
        .stats-card-clickable:active {
            transform: translateY(-1px) !important;
            box-shadow: 0 6px 15px rgba(0,0,0,0.12) !important;
        }
        
        /* Borde superior removido */
        
        .stats-card-mobile .card-body {
            display: flex !important;
            flex-direction: column !important;
            justify-content: center !important;
            align-items: center !important;
            text-align: center !important;
            padding: 1.5rem 1rem !important;
            height: 100% !important;
            position: relative !important;
        }
        
        .stats-card-mobile .fa-2x {
            font-size: 2.25rem !important;
            margin-bottom: 0.75rem !important;
            opacity: 0.8 !important;
            transition: transform 0.2s ease !important;
        }
        
        .stats-card-mobile .card:hover .fa-2x {
            transform: scale(1.1) !important;
        }
        
        .stats-card-mobile h4 {
            font-size: 2rem !important;
            font-weight: 700 !important;
            margin-bottom: 0.25rem !important;
            line-height: 1.2 !important;
            color: #2c3e50 !important;
        }
        
        [data-theme="dark"] .stats-card-mobile h4 {
            color: #f1f5f9 !important;
        }
        
        .stats-card-mobile .text-muted {
            font-size: 0.8rem !important;
            font-weight: 500 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            color: #6c757d !important;
        }
        
        [data-theme="dark"] .stats-card-mobile .text-muted {
            color: #94a3b8 !important;
        }
        
        /* RESPONSIVE PARA ESTAD√çSTICAS - Removido para usar estilos inline */
        @media (max-width: 768px) {
            .stats-card-mobile {
                margin-bottom: 1rem;
            }
            
            /* SIDEBAR OPTIMIZADO PARA M√ìVIL */
            .sidebar {
                margin-bottom: 1.5rem !important;
            }
            
            .sidebar .card-header {
                padding: 1.25rem 1rem !important;
            }
            
            .sidebar .card-header h5 {
                font-size: 1rem !important;
            }
            
            .sidebar .card-header h5 i {
                font-size: 1.1rem !important;
                margin-right: 0.5rem !important;
            }
            
            .sidebar .card-header p {
                font-size: 0.75rem !important;
            }
            
            .sidebar .card-body {
                padding: 0.5rem 0.25rem !important;
            }
            
            .list-group-item {
                font-size: 0.875rem !important;
                padding: 0.75rem 1rem !important;
                margin: 0.125rem 0.25rem !important;
            }
            
            .list-group-item i {
                font-size: 0.875rem !important;
                margin-right: 0.625rem !important;
            }
            
            /* Estilos de card removidos - se usan inline para mantener gradientes */
        .stats-card-mobile:nth-child(4) .card::before {
            background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%) !important;
        }
            
            /* NAVEGACI√ìN OPTIMIZADA PARA M√ìVIL */
            .nav-tabs {
                border-bottom: 1px solid #e9ecef !important;
                margin-bottom: 1rem !important;
                flex-wrap: wrap !important;
                gap: 0.25rem !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1rem !important;
                font-size: 0.9rem !important;
                font-weight: 500 !important;
                color: #333 !important;
                background: #fff !important;
                border: 1px solid #dee2e6 !important;
                border-radius: 0.5rem !important;
                margin-bottom: 0.25rem !important;
                white-space: nowrap !important;
                text-align: center !important;
                min-height: 44px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.5rem !important;
            }
            
            .nav-tabs .nav-link:hover,
            .nav-tabs .nav-link.active,
            .nav-tabs .nav-link.active:hover,
            .nav-tabs .nav-link.active:focus,
            .nav-tabs .nav-link.active:active {
                background: #fff !important;
                color: #333 !important;
                border-color: #dee2e6 !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1rem !important;
                flex-shrink: 0 !important;
                color: #333 !important;
            }
            
            /* Nav-tabs - Mantener mismo color en modo d√≠a y noche */
            [data-theme="dark"] .nav-tabs .nav-link,
            [data-theme="dark"] .nav-tabs .nav-link:hover,
            [data-theme="dark"] .nav-tabs .nav-link.active,
            [data-theme="dark"] .nav-tabs .nav-link:focus,
            [data-theme="dark"] .nav-tabs .nav-link:active {
                background: #fff !important;
                color: #333 !important;
                border-color: #dee2e6 !important;
            }
            
            [data-theme="dark"] .nav-tabs .nav-link i {
                color: #333 !important;
            }
            
            /* Selectores espec√≠ficos para scheduleCoachTabs con m√°xima prioridad */
            #scheduleCoachTabs .nav-link,
            #scheduleCoachTabs .nav-link:hover,
            #scheduleCoachTabs .nav-link.active,
            #scheduleCoachTabs .nav-link:focus,
            #scheduleCoachTabs .nav-link:active,
            #scheduleCoachTabs .nav-link.active:hover,
            #scheduleCoachTabs .nav-link.active:focus,
            #scheduleCoachTabs .nav-link.active:active {
                background: #fff !important;
                background-color: #fff !important;
                color: #333 !important;
                border-color: #dee2e6 !important;
            }
            
            #scheduleCoachTabs .nav-link i {
                color: #333 !important;
            }
            
            [data-theme="dark"] #scheduleCoachTabs .nav-link,
            [data-theme="dark"] #scheduleCoachTabs .nav-link:hover,
            [data-theme="dark"] #scheduleCoachTabs .nav-link.active,
            [data-theme="dark"] #scheduleCoachTabs .nav-link:focus,
            [data-theme="dark"] #scheduleCoachTabs .nav-link:active {
                background: #fff !important;
                background-color: #fff !important;
                color: #333 !important;
                border-color: #dee2e6 !important;
            }
            
            [data-theme="dark"] #scheduleCoachTabs .nav-link i {
                color: #333 !important;
            }
            
            /* HEADERS DE CONTENIDO OPTIMIZADOS PARA M√ìVIL */
            .card-header:not(.stats-card-mobile .card-header) {
                padding: 1rem 1rem !important;
            }
            
            .card-header h3,
            .card-header h4,
            .card-header h5 {
                font-size: 1rem !important;
                margin-bottom: 0.25rem !important;
            }
            
            .card-header p,
            .card-header small {
                font-size: 0.75rem !important;
            }
            
            /* Tab content optimizado para m√≥vil */
            .tab-content {
                padding: 1rem 0 !important;
            }
            
            .tab-pane {
                animation: fadeIn 0.3s ease-in-out !important;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            /* SECCIONES DE TAREAS Y EVALUACIONES OPTIMIZADAS */
            .task-item,
            .evaluation-item {
                padding: 0.875rem !important;
                margin-bottom: 0.75rem !important;
                border-radius: 0.5rem !important;
            }
            
            .task-header,
            .evaluation-header {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 0.5rem !important;
            }
            
            .task-title,
            .evaluation-title {
                font-size: 0.9375rem !important;
                line-height: 1.3 !important;
            }
            
            .task-description,
            .evaluation-description {
                font-size: 0.8125rem !important;
                line-height: 1.4 !important;
                margin-top: 0.5rem !important;
            }
            
            .task-meta,
            .evaluation-meta {
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
                margin-top: 0.5rem !important;
            }
            
            .task-badge,
            .evaluation-badge {
                font-size: 0.7rem !important;
                padding: 0.25rem 0.5rem !important;
            }
            
            .task-progress {
                margin-top: 0.75rem !important;
            }
            
            .progress {
                height: 8px !important;
                border-radius: 4px !important;
            }
            
            .evaluation-score {
                font-size: 1.25rem !important;
                padding: 0.5rem !important;
            }
            
            .evaluation-level {
                font-size: 0.8125rem !important;
                padding: 0.375rem 0.625rem !important;
            }
            
            /* RECOMENDACIONES OPTIMIZADAS */
            .recommendation-item {
                padding: 0.75rem !important;
                margin-bottom: 0.625rem !important;
                font-size: 0.875rem !important;
                line-height: 1.5 !important;
            }
            
            .category-header {
                padding: 0.75rem 1rem !important;
            }
            
            .category-title {
                font-size: 0.9375rem !important;
            }
            
            /* Responsive padding progresivo */
            @media (min-width: 768px) {
                .category-header {
                    padding: 1rem 1.25rem !important;
                }
            }
            
            @media (min-width: 1024px) {
                .category-header {
                    padding: 1.25rem 1.5rem !important;
                }
            }
            
            .general-recommendations,
            .strengths-category,
            .final-message {
                margin-bottom: 1rem !important;
                border-radius: 0.75rem !important;
            }
            
            /* GR√ÅFICOS Y VISUALIZACIONES OPTIMIZADOS */
            .chart-container,
            .radar-chart-container {
                padding: 0.75rem !important;
                height: auto !important;
                min-height: 250px !important;
                max-height: 300px !important;
            }
            
            canvas {
                max-height: 250px !important;
                width: 100% !important;
                height: auto !important;
            }
            
            /* GRUPOS DE BOTONES OPTIMIZADOS */
            .btn-group {
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
                width: 100% !important;
            }
            
            .btn-group .btn {
                flex: 1 1 auto !important;
                min-width: 100px !important;
                white-space: nowrap !important;
            }
            
            /* Botones con texto oculto en m√≥vil */
            .btn .d-none.d-sm-inline {
                display: none !important;
            }
            
            @media (min-width: 576px) {
                .btn .d-none.d-sm-inline {
                    display: inline !important;
                }
            }
            
            /* SECCI√ìN "MIS ACCIONES Y METAS" OPTIMIZADA */
            #tasks .card-header {
                padding: 1rem 1.25rem !important;
            }
            
            #tasks .card-body {
                padding: 0.75rem !important;
            }
            
            /* PLANES DE DESARROLLO OPTIMIZADOS */
            #development-plan .card-header {
                padding: 1rem 1.25rem !important;
            }
            
            #development-plan .card-body {
                padding: 0.75rem !important;
            }
            
            #development-plan .task-item {
                padding: 0.75rem !important;
            }
            
            /* MODALES OPTIMIZADOS PARA M√ìVIL */
            .modal-dialog {
                margin: 6rem 1rem 1rem 1rem !important;
                max-width: calc(100vw - 2rem) !important;
                height: auto !important;
                max-height: calc(100vh - 7rem) !important;
                display: flex !important;
                align-items: flex-start !important;
            }
            
            .modal-content {
                max-height: calc(100vh - 2rem) !important;
                border-radius: 16px !important;
                border: none !important;
                box-shadow: 0 20px 60px rgba(0,0,0,0.15), 0 0 0 1px rgba(0,0,0,0.05) !important;
                display: flex !important;
                flex-direction: column !important;
                overflow: hidden !important;
            }
            
            .modal-header {
                background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%) !important;
                color: white !important;
                border-bottom: none !important;
                padding: 1.5rem !important;
                flex-shrink: 0 !important;
                position: relative !important;
            }
            
            .modal-header::after {
                content: '' !important;
                position: absolute !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                height: 3px !important;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent) !important;
            }
            
            .modal-title {
                color: white !important;
                font-weight: 600 !important;
                font-size: 1.15rem !important;
                letter-spacing: 0.3px !important;
                display: flex !important;
                align-items: center !important;
                gap: 0.75rem !important;
            }
            
            .modal-title i {
                font-size: 1.25rem !important;
                opacity: 0.95 !important;
            }
            
            .modal-header .btn-close {
                background: rgba(255, 255, 255, 0.2) !important;
                opacity: 1 !important;
                border-radius: 0.5rem !important;
                padding: 0.5rem !important;
                margin: 0 !important;
            }
            
            /* Animaci√≥n mejorada para m√≥vil - DESACTIVADA TEMPORALMENTE */
            /* .modal.fade .modal-dialog {
                transform: translateY(100%) !important;
                transition: transform 0.3s ease-out !important;
            }
            
            .modal.show .modal-dialog {
                transform: translateY(0) !important;
            } */
            
            /* BOTONES Y FORMULARIOS OPTIMIZADOS PARA M√ìVIL */
            .btn {
                min-height: 44px !important;
                padding: 0.75rem 1rem !important;
                font-size: 0.875rem !important;
            }
            
            .btn-sm {
                min-height: 40px !important;
                padding: 0.5rem 0.75rem !important;
                font-size: 0.8125rem !important;
            }
            
            /* Grupos de botones optimizados */
            .btn-group {
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
            }
            
            .btn-group .btn {
                flex: 1 1 auto !important;
                min-width: 120px !important;
            }
            
            /* Botones de texto oculto en m√≥vil - solo iconos */
            .btn .d-none.d-sm-inline {
                display: none !important;
            }
            
            @media (min-width: 576px) {
                .btn .d-none.d-sm-inline {
                    display: inline !important;
                }
            }
            
            /* FORMULARIOS OPTIMIZADOS PARA M√ìVIL */
            .form-control, .form-select {
                min-height: 44px !important;
                padding: 0.75rem 1rem !important;
                font-size: 0.95rem !important;
                border: 2px solid #e9ecef !important;
                border-radius: 0.5rem !important;
                background: #ffffff !important;
                transition: all 0.2s ease !important;
            }
            
            .form-control:focus, .form-select:focus {
                border-color: #007bff !important;
                box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.15) !important;
                outline: none !important;
                transform: scale(1.02) !important;
            }
            
            .form-label {
                font-weight: 600 !important;
                color: #495057 !important;
                margin-bottom: 0.5rem !important;
                font-size: 0.9rem !important;
            }
            
            .input-group {
                gap: 0.5rem !important;
            }
            
            .input-group-text {
                min-height: 44px !important;
                padding: 0.75rem 1rem !important;
                background: #f8f9fa !important;
                border: 2px solid #e9ecef !important;
                border-radius: 0.5rem !important;
                font-weight: 500 !important;
            }
            
            /* BADGES Y PILLS OPTIMIZADOS */
            .badge {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.75rem !important;
                font-weight: 600 !important;
                border-radius: 0.375rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
            }
            
            .badge-pill {
                border-radius: 10rem !important;
                padding: 0.375rem 0.75rem !important;
            }
            
            /* TIPOGRAF√çA Y ESPACIADO OPTIMIZADO PARA M√ìVIL - IGUALADO CON FEED */
            /* Se elimin√≥ font-size de body para usar defaults del navegador como Feed */
            
            /* Espaciado de secciones optimizado */
            .container-fluid {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }
            
            .row {
                margin-left: -0.5rem !important;
                margin-right: -0.5rem !important;
            }
            
            .col, [class*="col-"] {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
                margin-bottom: 1rem !important;
            }
            
            .mb-1 { margin-bottom: 0.5rem !important; }
            .mb-2 { margin-bottom: 0.75rem !important; }
            .mb-3 { margin-bottom: 1rem !important; }
            .mb-4 { margin-bottom: 1.5rem !important; }
            .mb-5 { margin-bottom: 2rem !important; }
            
            .mt-1 { margin-top: 0.5rem !important; }
            .mt-2 { margin-top: 0.75rem !important; }
            .mt-3 { margin-top: 1rem !important; }
            .mt-4 { margin-top: 1.5rem !important; }
            .mt-5 { margin-top: 2rem !important; }
            
            .py-1 { padding-top: 0.5rem !important; padding-bottom: 0.5rem !important; }
            .py-2 { padding-top: 0.75rem !important; padding-bottom: 0.75rem !important; }
            .py-3 { padding-top: 1rem !important; padding-bottom: 1rem !important; }
            .py-4 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
            .py-5 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
            
            /* Texto optimizado para legibilidad */
            .text-small { font-size: 0.8rem !important; }
            .text-large { font-size: 1.1rem !important; }
            .text-xs { font-size: 0.7rem !important; }
            
            .fw-light { font-weight: 300 !important; }
            .fw-normal { font-weight: 400 !important; }
            .fw-medium { font-weight: 500 !important; }
            .fw-semibold { font-weight: 600 !important; }
            .fw-bold { font-weight: 700 !important; }
            
            /* Lista y contenido mejorado */
            ul, ol {
                padding-left: 1.5rem !important;
                margin-bottom: 1rem !important;
            }
            
            li {
                margin-bottom: 0.25rem !important;
                line-height: 1.5 !important;
            }
            
            .list-unstyled {
                padding-left: 0 !important;
            }
            
            .list-unstyled li {
                margin-bottom: 0.5rem !important;
            }
        }

        /* SECCIONES DE TAREAS Y EVALUACIONES OPTIMIZADAS M√ìVIL */
        @media (max-width: 768px) {
            .task-item,
            .evaluation-item {
                padding: 0.875rem !important;
                margin-bottom: 0.75rem !important;
            }
            
            .task-header,
            .evaluation-header {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 0.5rem !important;
            }
            
            .task-title,
            .evaluation-title {
                font-size: 0.9375rem !important;
            }
            
            .task-description,
            .evaluation-description {
                font-size: 0.8125rem !important;
                line-height: 1.4 !important;
            }
            
            .task-meta,
            .evaluation-meta {
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
            }
            
            .task-badge,
            .evaluation-badge {
                font-size: 0.7rem !important;
                padding: 0.25rem 0.5rem !important;
            }
            
            /* Barra de progreso en tareas */
            .task-progress {
                margin-top: 0.75rem !important;
            }
            
            .progress {
                height: 8px !important;
            }
            
            /* SECCI√ìN DE RECOMENDACIONES OPTIMIZADA */
            .recommendation-item {
                padding: 0.75rem !important;
                margin-bottom: 0.625rem !important;
                font-size: 0.875rem !important;
            }
            
            .category-header {
                padding: 0.875rem 1rem !important;
            }
            
            .category-title {
                font-size: 0.9375rem !important;
            }
            
            /* GR√ÅFICOS Y VISUALIZACIONES OPTIMIZADOS */
            .chart-container,
            .radar-chart-container {
                padding: 0.75rem !important;
                height: auto !important;
                min-height: 250px !important;
            }
            
            canvas {
                max-height: 250px !important;
            }
        }
        
        /* OPTIMIZACI√ìN ESPEC√çFICA PARA TABLET (768px - 1024px) */
        @media (min-width: 768px) and (max-width: 1024px) {
            .container-fluid {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
            
            /* Cards de estad√≠sticas - estilos inline */
            .stats-card-mobile {
                margin-bottom: 1.5rem;
            }
            
            .stats-card-mobile h4 {
                font-size: 2.5rem !important;
                margin-bottom: 0.5rem !important;
            }
            
            .stats-card-mobile .text-muted {
                font-size: 0.9rem !important;
            }
            
            /* Gr√°ficos m√°s grandes en tablet */
            .chart-container {
                min-height: 350px !important;
                padding: 1.5rem !important;
            }
            
            .radar-chart-container {
                min-height: 400px !important;
            }
            
            /* Grid m√°s eficiente para contenido principal */
            .row > .col-lg-6 {
                margin-bottom: 2rem !important;
            }
            
            .row > .col-lg-12 {
                margin-bottom: 2rem !important;
            }
            
            /* Cards de evaluaciones optimizadas para tablet */
            .evaluation-item {
                padding: 1.75rem !important;
                margin-bottom: 1.5rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.08) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .evaluation-item::before {
                height: 5px !important;
                border-radius: 0 0 5px 5px !important;
            }
            
            .evaluation-item:hover {
                transform: translateY(-4px) !important;
                box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
            }
            
            .evaluation-score {
                font-size: 2.75rem !important;
                font-weight: 800 !important;
                margin-bottom: 0.75rem !important;
                text-align: center !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                -webkit-background-clip: text !important;
                -webkit-text-fill-color: transparent !important;
                background-clip: text !important;
            }
            
            .evaluation-level {
                font-size: 1.2rem !important;
                font-weight: 700 !important;
                text-align: center !important;
                margin-bottom: 1.25rem !important;
                color: #2c3e50 !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
            }
            
            .evaluation-description {
                padding: 1.5rem !important;
                font-size: 1rem !important;
                line-height: 1.6 !important;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
                border-radius: 0.75rem !important;
                border-left: 5px solid var(--calm-primary) !important;
                color: #495057 !important;
            }
            
            .evaluation-date {
                font-size: 0.9rem !important;
                color: #6c757d !important;
                font-weight: 500 !important;
                text-align: center !important;
                margin-top: 1.25rem !important;
                padding: 0.75rem !important;
                background: rgba(108, 117, 125, 0.1) !important;
                border-radius: 0.5rem !important;
            }
            
            /* Cards de tareas optimizadas para tablet */
            .task-item {
                padding: 1.75rem !important;
                margin-bottom: 1.5rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.08) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .task-item::before {
                width: 5px !important;
                background: linear-gradient(180deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                border-radius: 0 5px 5px 0 !important;
            }
            
            .task-item:hover {
                transform: translateY(-4px) !important;
                box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
            }
            
            .task-header {
                display: flex !important;
                justify-content: space-between !important;
                align-items: flex-start !important;
                margin-bottom: 1.25rem !important;
                gap: 1rem !important;
            }
            
            .task-title {
                font-size: 1.2rem !important;
                font-weight: 700 !important;
                color: #2c3e50 !important;
                line-height: 1.4 !important;
                flex: 1 !important;
            }
            
            .task-description {
                font-size: 1rem !important;
                color: #495057 !important;
                margin-bottom: 1.25rem !important;
                line-height: 1.6 !important;
                background: rgba(248, 249, 250, 0.8) !important;
                padding: 1rem !important;
                border-radius: 0.5rem !important;
                border-left: 4px solid var(--calm-accent) !important;
            }
            
            .task-meta {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 0.75rem !important;
                margin-bottom: 1.25rem !important;
                align-items: center !important;
            }
            
            .task-badge {
                padding: 0.5rem 1rem !important;
                font-size: 0.8rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
                min-height: 32px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .task-progress {
                margin-top: 1.25rem !important;
                padding: 1rem !important;
                background: rgba(233, 236, 239, 0.5) !important;
                border-radius: 0.5rem !important;
            }
            
            /* Modales optimizados para tablet */
            .modal-dialog {
                max-width: 900px !important;
                margin: 2rem auto !important;
            }
            
            .modal-xl {
                max-width: 1100px !important;
            }
            
            .modal-content {
                border-radius: 1rem !important;
                border: none !important;
                box-shadow: 0 15px 50px rgba(0,0,0,0.15) !important;
                overflow: hidden !important;
            }
            
            .modal-header {
                background: linear-gradient(135deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                color: white !important;
                border-bottom: none !important;
                padding: 1.5rem !important;
            }
            
            .modal-title {
                color: white !important;
                font-weight: 600 !important;
                font-size: 1.25rem !important;
            }
            
            .modal-header .btn-close {
                background: rgba(255, 255, 255, 0.2) !important;
                opacity: 1 !important;
                border-radius: 0.5rem !important;
                padding: 0.75rem !important;
                margin: 0 !important;
            }
            
            .modal-body {
                padding: 2rem !important;
                max-height: 70vh !important;
                overflow-y: auto !important;
            }
            
            .modal-footer {
                background: #f8f9fa !important;
                border-top: 1px solid #e9ecef !important;
                padding: 1.25rem 2rem !important;
                gap: 1rem !important;
            }
            
            .modal-footer .btn {
                min-height: 44px !important;
                padding: 0.75rem 2rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
            }
            
            /* Navegaci√≥n de pesta√±as mejorada para tablet */
            .nav-tabs {
                border-bottom: 2px solid #e9ecef !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1.5rem !important;
                font-size: 1rem !important;
                font-weight: 500 !important;
                color: #6c757d !important;
                border-radius: 0.5rem 0.5rem 0 0 !important;
                margin-right: 0.25rem !important;
                background: #f8f9fa !important;
                border: 1px solid #dee2e6 !important;
                border-bottom: none !important;
                transition: all 0.2s ease !important;
            }
            
            .nav-tabs .nav-link:hover,
            .nav-tabs .nav-link.active,
            .nav-tabs .nav-link.active:hover,
            .nav-tabs .nav-link.active:focus,
            .nav-tabs .nav-link.active:active {
                background: #fff !important;
                color: #333 !important;
                border-color: #dee2e6 !important;
            }
            
            /* ========== ANULAR BOOTSTRAP EN TABLET TAMBI√âN ========== */
            
            /* M√ÅXIMA ESPECIFICIDAD - Tablet nav-link effects */
            ul.nav.nav-tabs li.nav-item button.nav-link:active,
            ul.nav.nav-tabs li.nav-item button.nav-link.active:active,
            .nav-tabs .nav-item .nav-link:active,
            .nav-tabs .nav-item .nav-link.active:active,
            button.nav-link:active,
            button.nav-link.active:active {
                background: #fff !important;
                color: #333 !important;
                border-color: #dee2e6 !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1.1rem !important;
                margin-right: 0.5rem !important;
            }
            
            /* Espaciado mejorado entre secciones */
            .dashboard-card {
                margin-bottom: 2rem !important;
            }
            
            .tab-content {
                padding: 1.5rem !important;
            }
            
            /* Botones y formularios optimizados para tablet */
            .btn {
                min-height: 44px !important;
                padding: 0.75rem 1.5rem !important;
                font-size: 0.95rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                border: none !important;
                transition: all 0.2s ease !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.5rem !important;
                touch-action: manipulation !important;
            }
            
            .btn:hover, .btn:focus {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 16px rgba(0,0,0,0.15) !important;
            }
            
            .btn-lg {
                min-height: 52px !important;
                padding: 1rem 2.5rem !important;
                font-size: 1.1rem !important;
                font-weight: 700 !important;
            }
            
            .btn-sm {
                min-height: 40px;
                padding: 0.5rem 0.75rem;
            }
            
            /* Formularios optimizados para tablet */
            .form-control, .form-select {
                min-height: 44px !important;
                padding: 0.75rem 1.25rem !important;
                font-size: 1rem !important;
                border: 2px solid #e9ecef !important;
                border-radius: 0.5rem !important;
                transition: all 0.2s ease !important;
            }
            
            .form-control:focus, .form-select:focus {
                border-color: #007bff !important;
                box-shadow: 0 0 0 0.25rem rgba(0,123,255,0.15) !important;
                transform: scale(1.01) !important;
            }
            
            .form-label {
                font-weight: 600 !important;
                font-size: 0.95rem !important;
                margin-bottom: 0.75rem !important;
            }
            
            .input-group-text {
                min-height: 44px !important;
                padding: 0.75rem 1.25rem !important;
                font-size: 0.95rem !important;
            }
            
            .badge {
                padding: 0.5rem 1rem !important;
                font-size: 0.8rem !important;
                font-weight: 600 !important;
            }
            
            /* TIPOGRAF√çA Y ESPACIADO OPTIMIZADO PARA TABLET - IGUALADO CON FEED */
            /* Se elimin√≥ font-size de body para usar defaults del navegador como Feed */
            
            /* Espaciado de secciones optimizado para tablet */
            .container-fluid {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
            
            .row {
                margin-left: -1rem !important;
                margin-right: -1rem !important;
            }
            
            .col, [class*="col-"] {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            /* Margens y padding m√°s generosos */
            .mb-1 { margin-bottom: 0.75rem !important; }
            .mb-2 { margin-bottom: 1rem !important; }
            .mb-3 { margin-bottom: 1.5rem !important; }
            .mb-4 { margin-bottom: 2rem !important; }
            .mb-5 { margin-bottom: 2.5rem !important; }
            
            .py-1 { padding-top: 0.75rem !important; padding-bottom: 0.75rem !important; }
            .py-2 { padding-top: 1rem !important; padding-bottom: 1rem !important; }
            .py-3 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
            .py-4 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
            .py-5 { padding-top: 2.5rem !important; padding-bottom: 2.5rem !important; }
            
            /* Lista optimizada para tablet */
            ul, ol {
                padding-left: 2rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            li {
                margin-bottom: 0.5rem !important;
                line-height: 1.6 !important;
            }
        }

        /* ANIMACIONES Y TRANSICIONES SUAVES - EXPERIENCIA MEJORADA */
        
        /* Transiciones globales para elementos interactivos (excluye stats cards) */
        .card:not(.stats-card-mobile .card), .btn, .progress-bar, .form-control, .form-select, .modal-content, 
        .nav-link, .dropdown-menu, .alert, .badge, .task-item, .evaluation-item {
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1) !important;
        }
        
        /* Animaciones de hover mejoradas (excluye stats cards) */
        .card:not(.stats-card-mobile .card):hover, .btn:hover, .nav-link:hover, .task-item:hover, 
        .evaluation-item:hover {
            transition: all 0.2s ease-out !important;
        }
        
        /* Animaci√≥n de click/active para botones */
        .btn:active {
            transform: scale(0.98) !important;
            transition: transform 0.1s ease !important;
        }
        
        /* Eliminar TODOS los efectos en nav-links para evitar oscurecimiento */
        .nav-link:active,
        .nav-tabs .nav-link:active,
        .nav-tabs .nav-link.active:active {
            transform: none !important;
            box-shadow: inherit !important;
            opacity: 1 !important;
            filter: none !important;
            background: inherit !important;
            color: inherit !important;
            transition: none !important;
        }
        
        /* Forzar colores simples en todos los estados */
        .nav-tabs .nav-link.active:active {
            color: #333 !important;
            background: #fff !important;
        }
        
        /* ============ ANULAR BOOTSTRAP 5.3.3 COMPLETAMENTE ============ */
        
        /* M√ÅXIMA ESPECIFICIDAD - Anular Bootstrap nav-link effects */
        ul.nav.nav-tabs li.nav-item button.nav-link:active,
        ul.nav.nav-tabs li.nav-item button.nav-link.active:active,
        .nav-tabs .nav-item .nav-link:active,
        .nav-tabs .nav-item .nav-link.active:active,
        button.nav-link:active,
        button.nav-link.active:active {
            background: #fff !important;
            color: #333 !important;
            border-color: #dee2e6 !important;
        }
        
        /* Anular TODOS los efectos de Bootstrap en nav-links */
        .nav-link:active,
        .nav-link:focus,
        .nav-link:hover:active,
        .nav-tabs .nav-link:active,
        .nav-tabs .nav-link:focus,
        .nav-tabs .nav-link:hover:active {
            background-color: inherit !important;
            border-color: inherit !important;
            color: inherit !important;
            transform: none !important;
            box-shadow: none !important;
            opacity: 1 !important;
            filter: none !important;
        }
        
        /* FORZAR estilos simples en todos los estados */
        .nav-tabs .nav-link.active:active,
        .nav-tabs .nav-link.active:focus,
        .nav-tabs .nav-link.active:hover:active {
            background-color: #fff !important;
            border-color: #dee2e6 !important;
            color: #333 !important;
        }
        
        /* Eliminar highlight t√°ctil en dispositivos m√≥viles */
        .nav-link {
            -webkit-tap-highlight-color: transparent !important;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
            -khtml-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            outline: none !important;
        }
        
        .nav-link:focus {
            outline: none !important;
            box-shadow: none !important;
        }
        
        /* Animaci√≥n de entrada para cards */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }
        
        /* Animaciones removidas para stats cards - mantener estilos inline */
        
        .task-item {
            animation: slideInLeft 0.5s ease-out forwards;
        }
        
        .evaluation-item {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        
        /* Loading state para botones */
        .btn:disabled {
            position: relative;
            overflow: hidden;
        }
        
        .btn:disabled::before {
            content: '';
            position: absolute;
            top: 0;
            left: -200px;
            width: 200px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 1.5s infinite;
        }
        
        /* Animaci√≥n de progreso para barras */
        .progress-bar {
            transition: width 0.8s ease-out !important;
        }
        
        /* Mejoras para modales - DESACTIVADA TEMPORALMENTE */
        /* .modal.fade .modal-dialog {
            transform: translateY(-50px);
            transition: transform 0.3s ease-out;
        }
        
        .modal.show .modal-dialog {
            transform: translateY(0);
        } */
        
        /* Hover effects especiales */
        .nav-tabs .nav-link {
            position: relative;
            overflow: hidden;
        }
        
        .nav-tabs .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--calm-primary), var(--calm-secondary));
            transition: width 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover::before,
        .nav-tabs .nav-link.active::before {
            width: 100%;
        }
        
        /* Smooth scroll para navegaci√≥n */
        html {
            scroll-behavior: smooth;
        }
        
        /* TAMA√ëO BASE DE REM EN M√ìVIL - IGUALADO CON COACH DASHBOARD (sin reducci√≥n) */
        @media (max-width: 768px) {
            html {
                font-size: 16px; /* Mantener 16px igual que coach dashboard */
            }
        }
        
        @media (max-width: 576px) {
            html {
                font-size: 16px; /* Mantener 16px igual que coach dashboard */
            }
        }
        
        /* Micro-interacciones para badges */
        .task-badge, .badge {
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
        }
        
        .task-badge:hover, .badge:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
        }
        
        /* Animaci√≥n de focus para formularios */
        .form-control:focus, .form-select:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 0.2rem rgba(var(--calm-primary-rgb), 0.25) !important;
        }
        
        /* Stagger animation para listas */
        .task-item:nth-child(1) { animation-delay: 0.1s; }
        .task-item:nth-child(2) { animation-delay: 0.2s; }
        .task-item:nth-child(3) { animation-delay: 0.3s; }
        .task-item:nth-child(4) { animation-delay: 0.4s; }
        .task-item:nth-child(5) { animation-delay: 0.5s; }
        
        .evaluation-item:nth-child(1) { animation-delay: 0.1s; }
        .evaluation-item:nth-child(2) { animation-delay: 0.2s; }
        .evaluation-item:nth-child(3) { animation-delay: 0.3s; }
        .evaluation-item:nth-child(4) { animation-delay: 0.4s; }
        
        /* Reducir animaciones si el usuario prefiere menos movimiento */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(90, 103, 216, 0.08); /* Calm's signature blue with very low opacity */
            border-radius: 50%;
            animation: float 25s infinite linear; /* Slower, more peaceful animation */
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Custom header */
        .custom-header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--calm-border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 20px rgba(90, 103, 216, 0.06); /* Softer shadow with new blue */
        }

        .custom-header .navbar-brand {
            color: var(--calm-text-primary) !important;
            font-weight: 600;
            font-size: 1.5rem;
        }

        .user-display {
            color: var(--calm-text-primary);
            font-weight: 500;
            background: var(--calm-surface-elevated);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            border: 1px solid var(--calm-border);
        }

        /* Logout button styles */
        .logout-btn {
            background: var(--calm-surface-elevated);
            border: 1px solid var(--calm-border);
            color: var(--calm-text-primary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-left: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: var(--calm-primary);
            border-color: var(--calm-primary);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.25); /* Updated with new primary color */
        }

        .logout-btn:active {
            transform: translateY(0);
        }

        /* Responsive styles for logout button */
        @media (max-width: 768px) {
            .logout-btn {
                margin-left: 0.5rem;
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .logout-btn .fa-sign-out-alt {
                margin-right: 0.3rem;
            }
            
            .user-display {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 576px) {
            .logout-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
            }
            
            .logout-btn span {
                display: none; /* Hide text on very small screens */
            }
            
            .logout-btn {
                margin-left: 0.3rem;
            }
        }

        /* Main container */
        .main-container {
            position: relative;
            z-index: 2;
            min-height: calc(100vh - 80px);
            padding: 2rem 1rem;
        }

        /* Dashboard cards - OPTIMIZADO PARA M√ìVIL Y TABLET */
        .dashboard-card {
            background: linear-gradient(135deg, #FFFFFF 0%, #EFF6FF 100%) !important;
            border-radius: 16px !important;
            box-shadow: 0 8px 32px rgba(30, 58, 138, 0.15) !important;
            overflow: hidden !important;
            margin-bottom: 2rem !important;
            border: 2px solid var(--calm-primary) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
        }

        .dashboard-card:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 12px 40px rgba(30, 58, 138, 0.25) !important;
        }

        /* CARDS M√ìVIL OPTIMIZADAS */
        @media (max-width: 768px) {
            .dashboard-card {
                margin-bottom: 1.5rem !important;
                border-radius: 12px !important;
                box-shadow: 0 4px 16px rgba(30, 58, 138, 0.12) !important;
                border: 1px solid var(--calm-primary) !important;
            }
            
            .dashboard-card:hover {
                transform: translateY(-1px) !important;
                box-shadow: 0 6px 20px rgba(30, 58, 138, 0.18) !important;
            }
            
            /* Layout en columna para m√≥vil */
            .row .col-lg-6 {
                margin-bottom: 1rem !important;
            }
            
            .row .col-lg-6:last-child {
                margin-bottom: 0 !important;
            }
        }

        /* CARDS TABLET OPTIMIZADAS */
        @media (min-width: 768px) and (max-width: 1024px) {
            .dashboard-card {
                margin-bottom: 1.75rem !important;
                border-radius: 14px !important;
                box-shadow: 0 6px 24px rgba(30, 58, 138, 0.14) !important;
            }
            
            .dashboard-card:hover {
                transform: translateY(-1px) !important;
                box-shadow: 0 8px 28px rgba(30, 58, 138, 0.22) !important;
            }
        }

        /* GRID RESPONSIVO MEJORADO */
        @media (max-width: 992px) {
            .row {
                margin-left: 0 !important;
                margin-right: 0 !important;
            }
            
            /* Override for sidebar column only */
            .row > .col-md-3 {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }
            
            /* Keep content area at zero padding */
            .row > .col-md-9 {
                padding: 0 !important;
            }
        }

        /* Force col-md-9 to always have zero padding */
        .col-md-9 {
            padding: 0 !important;
        }
        
        @media (max-width: 768px) {
            .row > .col-md-3 {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
                margin-bottom: 1rem !important;
            }
            
            /* Keep content area at zero */
            .row > .col-md-9 {
                padding: 0 !important;
            }
        }

        .card-header:not(#development-plan .card *):not(#tasks .card *) {
            background: #ffffff !important;
            padding: 1.5rem !important;
            border-bottom: 1px solid #f3f4f6 !important;
            color: #111827 !important;
            border-radius: 16px 16px 0 0 !important;
        }

        .card-header h3 {
            margin: 0 !important;
            color: #111827 !important;
            font-weight: 600 !important;
            font-size: 1.25rem !important;
            line-height: 1.4 !important;
        }

        .card-header * {
            color: #111827 !important;
        }
        
        /* Override removido - Los colores inline tienen prioridad */
        /* Las reglas inline en cada secci√≥n controlan el color correctamente */

        /* CARD HEADERS M√ìVIL OPTIMIZADOS */
        @media (max-width: 768px) {
            .card-header:not(#development-plan .card *):not(#tasks .card *) {
                padding: 1rem 1.25rem !important;
                border-radius: 12px 12px 0 0 !important;
            }
            
            .card-header:not(#development-plan .card *):not(#tasks .card *) h3 {
                font-size: 1.1rem !important;
                font-weight: 700 !important;
                line-height: 1.3 !important;
            }
            
            .card-header:not(#development-plan .card *):not(#tasks .card *) i {
                font-size: 1rem !important;
                margin-right: 0.5rem !important;
            }
        }

        /* CARD HEADERS TABLET OPTIMIZADOS */
        @media (min-width: 768px) and (max-width: 1024px) {
            .card-header:not(#development-plan .card *):not(#tasks .card *) {
                padding: 1.25rem 1.5rem !important;
                border-radius: 14px 14px 0 0 !important;
            }
            
            .card-header:not(#development-plan .card *):not(#tasks .card *) h3 {
                font-size: 1.2rem !important;
                font-weight: 650 !important;
            }
            
            .card-header:not(#development-plan .card *):not(#tasks .card *) i {
                font-size: 1.1rem !important;
                margin-right: 0.6rem !important;
            }
        }

        /* CARD BODY RESPONSIVO */
        .card-body:not(#development-plan .card *):not(#tasks .card *) {
            padding: 1.5rem !important;
        }

        @media (max-width: 768px) {
            .card-body:not(#development-plan .card *):not(#tasks .card *) {
                padding: 1rem 1.25rem !important;
            }
        }

        @media (min-width: 768px) and (max-width: 1024px) {
            .card-body:not(#development-plan .card *):not(#tasks .card *) {
                padding: 1.25rem 1.5rem !important;
            }
        }

                    /* TAB CONTENT RESPONSIVO */
                    .tab-content {
                        padding: 0 !important;
                        margin-top: -1.05rem !important; /* Reducido 70% acumulado del espaciado original */
                    }

                    .tab-pane {
                        min-height: 400px !important;
                    }        /* CONTENIDO DE PESTA√ëAS M√ìVIL */
        @media (max-width: 768px) {
            .tab-content {
                padding: 0 !important;
            }
            
            .tab-pane {
                min-height: 300px !important;
            }
            
            /* Layout stack en m√≥vil */
            .tab-pane .row .col-lg-6 {
                width: 100% !important;
                margin-bottom: 1.5rem !important;
            }
            
            .tab-pane .row .col-lg-6:last-child {
                margin-bottom: 1rem !important;
            }
        }

        /* CONTENIDO DE PESTA√ëAS TABLET */
        @media (min-width: 768px) and (max-width: 1024px) {
            .tab-content {
                padding: 0.875rem 0 !important;
            }
            
            .tab-pane {
                min-height: 350px !important;
            }
            
            .tab-pane .row .col-lg-6 {
                margin-bottom: 1.25rem !important;
            }
        }

        /* LOADING STATES MEJORADOS */
        .loading-spinner {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            min-height: 200px !important;
            flex-direction: column !important;
        }

        .spinner-border-custom {
            color: var(--calm-primary) !important;
            width: 2.5rem !important;
            height: 2.5rem !important;
        }

        @media (max-width: 768px) {
            .loading-spinner {
                min-height: 150px !important;
            }
            
            .spinner-border-custom {
                width: 2rem !important;
                height: 2rem !important;
            }
        }

        /* Sobrescribir clases de Bootstrap dentro de headers azules */
        .card-header .text-muted,
        .card-header .text-secondary,
        .card-header small,
        .card-header span {
            color: #FFFFFF !important; /* FORZAR BLANCO PARA TEXTO EN HEADERS AZULES */
        }

        /* Sobrescribir texto en pesta√±as con fondo azul */
        .nav-tabs .nav-link .text-muted,
        .nav-tabs .nav-link .text-secondary,
        .nav-tabs .nav-link small,
        .nav-tabs .nav-link span {
            color: #FFFFFF !important; /* FORZAR BLANCO PARA TEXTO EN PESTA√ëAS AZULES */
        }

        .card-body {
            padding: 1.5rem;
        }

        /* ESTILOS PARA SECCI√ìN MI CONTENIDO - TARJETAS DE VIDEO */
        .content-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            padding: 1rem;
        }

        .content-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .content-card.viewed {
            opacity: 0.85;
        }

        .content-preview {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            background: #f5f5f5;
        }

        .content-preview .ratio {
            background: #000;
        }

        .content-preview iframe {
            width: 100%;
            height: 100%;
        }

        .content-title {
            color: #1e293b;
            font-size: 1rem;
        }

        [data-theme="dark"] .content-title {
            color: #f1f5f9 !important;
        }

        .content-info {
            flex: 1;
        }

        .content-description {
            color: #64748b;
        }

        .content-meta {
            color: #94a3b8;
            font-size: 0.875rem;
        }

        .content-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Responsive para tarjetas de contenido */
        @media (max-width: 768px) {
            .content-card {
                padding: 0.75rem;
            }

            .content-title {
                font-size: 0.9rem;
            }

            .content-actions {
                flex-direction: column;
            }

            .content-actions .btn {
                width: 100%;
            }
        }

        /* Navigation tabs - MEJORADO PARA M√ìVIL Y TABLET */
        .nav-tabs {
            border-bottom: 2px solid var(--calm-primary) !important;
            margin-bottom: 2rem !important;
            background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%) !important;
            border-radius: 12px 12px 0 0 !important;
            padding: 0.75rem !important;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.1) !important;
            overflow-x: auto !important;
            overflow-y: hidden !important;
            white-space: nowrap !important;
            -webkit-overflow-scrolling: touch !important;
        }

        .nav-tabs .nav-link {
            border: none !important;
            border-radius: 8px !important;
            color: white !important;
            font-weight: 600 !important;
            padding: 1rem 1.5rem !important;
            transition: all 0.3s ease !important;
            margin: 0 0.25rem !important;
            position: relative !important;
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3) !important;
            min-height: 48px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            text-decoration: none !important;
            flex-shrink: 0 !important;
        }

        .nav-tabs .nav-link:hover {
            color: white !important;
            background: linear-gradient(135deg, #1D4ED8 0%, #1E3A8A 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.5) !important;
        }

        .nav-tabs .nav-link.active {
            color: white !important;
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            border-bottom: none !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6) !important;
        }

        /* ESTILOS PARA SECCI√ìN MI CONTENIDO */
        #contentTabs .nav-link {
            padding: 0.625rem 1.25rem !important;
            font-size: 0.875rem !important;
            font-weight: 600 !important;
            border: 2px solid #e5e7eb !important;
            border-radius: 8px !important;
            background: #ffffff !important;
            color: #374151 !important;
            transition: all 0.2s ease !important;
        }
        
        #contentTabs .nav-link i {
            transition: color 0.2s ease !important;
        }
        
        #contentTabs .nav-link:hover {
            color: #1e40af !important;
            background: #eff6ff !important;
            border-color: #93c5fd !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.15) !important;
        }
        
        #contentTabs .nav-link.active {
            color: #ffffff !important;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
            border-color: #3b82f6 !important;
            font-weight: 700 !important;
            transform: none !important;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3) !important;
        }
        
        #contentTabs .nav-link.active i {
            color: #ffffff !important;
        }
        
        /* Eliminar efecto :active al hacer clic */
        #contentTabs .nav-link:active {
            color: inherit !important;
            background: inherit !important;
            border-color: inherit !important;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* Asegurar que los botones NO activos mantengan el texto oscuro */
        #contentTabs .nav-link:not(.active) {
            color: #374151 !important;
        }
        
        #contentTabs .nav-link:not(.active) span {
            color: #374151 !important;
        }
        
        #contentTabs {
            border-bottom: 2px solid #e5e7eb !important;
            gap: 0.75rem !important;
            background: #f9fafb !important;
            padding: 0.5rem !important;
            border-radius: 10px !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) !important;
        }
        
        /* Estilos para cards de documentos */
        .document-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.2s ease;
            cursor: pointer;
            height: 100%;
        }
        
        .document-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }
        
        .document-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }
        
        .document-title {
            font-size: 0.9375rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.375rem;
            line-height: 1.3;
        }
        
        /* ESTILOS OPTIMIZADOS PARA MODAL DE PROGRESO DE TAREAS */
        #taskProgressModal .modal-dialog {
            max-width: 600px !important;
            margin: auto !important;
            position: absolute !important;
            top: 67.5% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
        }
        
        #taskProgressModal .modal-content {
            border-radius: 16px !important;
            border: none !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
            overflow: hidden !important;
        }
        
        #taskProgressModal .modal-body {
            padding: 1.5rem 1.75rem !important;
            background: #fafafa !important;
        }
        
        #taskProgressModal .form-label {
            font-weight: 600 !important;
            color: #374151 !important;
            margin-bottom: 0.2rem !important;
            display: flex !important;
            align-items: center !important;
            font-size: 0.875rem !important;
        }
        
        #taskProgressModal .form-label i {
            margin-right: 0.5rem !important;
            color: #667eea !important;
        }
        
        #taskProgressModal .form-select,
        #taskProgressModal .form-control {
            border: 2px solid #e5e7eb !important;
            border-radius: 8px !important;
            padding: 0.625rem !important;
            font-size: 0.9375rem !important;
            transition: all 0.2s ease !important;
        }
        
        #taskProgressModal .form-select:focus,
        #taskProgressModal .form-control:focus {
            border-color: #667eea !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
            outline: none !important;
        }
        
        #taskProgressModal .form-range {
            height: 8px !important;
            border-radius: 4px !important;
            background: linear-gradient(to right, #10b981 0%, #10b981 var(--value), #e5e7eb var(--value), #e5e7eb 100%) !important;
        }
        
        #taskProgressModal .form-range::-webkit-slider-thumb {
            width: 20px !important;
            height: 20px !important;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            border: 3px solid white !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
        }
        
        #taskProgressModal .form-range::-moz-range-thumb {
            width: 20px !important;
            height: 20px !important;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            border: 3px solid white !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
        }
        
        #taskProgressModal #progressValue {
            font-weight: 700 !important;
            color: #10b981 !important;
            font-size: 1.125rem !important;
        }
        
        #taskProgressModal .modal-footer {
            padding: 0.75rem 1.75rem !important;
            background: white !important;
            border-top: 1px solid #e5e7eb !important;
            gap: 0.75rem !important;
        }
        
        #taskProgressModal .btn {
            padding: 0.625rem 1.25rem !important;
            font-weight: 600 !important;
            border-radius: 8px !important;
            font-size: 0.875rem !important;
            min-width: 100px !important;
            transition: background-color 0.2s ease, box-shadow 0.2s ease !important;
        }
        
        #taskProgressModal .btn-secondary {
            background: #f3f4f6 !important;
            color: #374151 !important;
            border: 1px solid #e5e7eb !important;
        }
        
        #taskProgressModal .btn-secondary:hover {
            background: #e5e7eb !important;
        }
        
        #taskProgressModal .btn-task {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            border: none !important;
            will-change: box-shadow;
        }
        
        #taskProgressModal .btn-task:hover {
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
        }
        
        /* RESPONSIVE PARA M√ìVIL */
        @media (max-width: 768px) {
            #taskProgressModal .modal-dialog {
                margin: 0.5rem !important;
                max-width: calc(100vw - 1rem) !important;
                width: calc(100vw - 1rem) !important;
                position: absolute !important;
                top: 67.5% !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
            }
            
            #taskProgressModal .modal-content {
                max-height: calc(100vh - 1rem) !important;
                display: flex !important;
                flex-direction: column !important;
            }
            
            #taskProgressModal .modal-body {
                padding: 1rem 1rem !important;
                overflow-y: auto !important;
                flex: 1 1 auto !important;
                -webkit-overflow-scrolling: touch !important;
            }
            
            #taskProgressModal .form-label {
                font-size: 0.75rem !important;
                margin-bottom: 0.25rem !important;
            }
            
            #taskProgressModal .form-select,
            #taskProgressModal .form-control {
                font-size: 0.8125rem !important;
                padding: 0.5rem !important;
            }
            
            #taskProgressModal .mb-2 {
                margin-bottom: 0.75rem !important;
            }
            
            #taskProgressModal textarea {
                min-height: 60px !important;
            }
            
            #taskProgressModal #progressValue {
                font-size: 0.875rem !important;
            }
            
            #taskProgressModal .modal-footer {
                padding: 0.75rem 1rem !important;
                flex-shrink: 0 !important;
                flex-wrap: nowrap !important;
                gap: 0.5rem !important;
            }
            
            #taskProgressModal .modal-footer .btn {
                flex: 1 1 auto !important;
                min-width: auto !important;
                padding: 0.5rem 0.75rem !important;
                font-size: 0.8125rem !important;
            }
        }
        
        /* RESPONSIVE PARA MI CONTENIDO - M√ìVILES */
        @media (max-width: 991.98px) {
            /* Vista previa en m√≥viles - altura mayor para PDFs */
            .document-preview-container {
                height: 400px !important;
            }
            
            /* Eliminar sticky en m√≥viles para mejor scroll */
            #content .col-lg-4 .card {
                position: static !important;
            }
        }
        
        @media (max-width: 767.98px) {
            /* Reducir a√∫n m√°s espacios en m√≥viles */
            #content .card {
                border-radius: 8px !important;
            }
            
            #content .list-group-item {
                padding: 0.5rem 0.875rem !important;
            }
            
            /* Thumbnails m√°s peque√±os en m√≥vil */
            #content .list-group-item > div > div:first-child {
                width: 70px !important;
                height: 44px !important;
            }
            
            /* Vista previa altura reducida en m√≥viles peque√±os */
            .document-preview-container {
                height: 350px !important;
            }
        }
        
        @media (max-width: 575.98px) {
            /* Ultra compacto para m√≥viles peque√±os */
            #content .card-header {
                padding: 0.625rem 0.875rem !important;
            }
            
            #content .card-header h6 {
                font-size: 0.8125rem !important;
            }
            
            /* Vista previa m√°s peque√±a en m√≥viles muy peque√±os */
            .document-preview-container {
                height: 300px !important;
            }
            
            /* Ocultar descripci√≥n en m√≥viles muy peque√±os */
            #content .d-none.d-md-block {
                display: none !important;
            }
        }
        
        /* RESPONSIVE PARA TABLET */
        @media (min-width: 769px) and (max-width: 1024px) {
            #taskProgressModal .modal-dialog {
                max-width: 540px !important;
                margin: 1.5rem auto !important;
            }
            
            #taskProgressModal .modal-body {
                padding: 1.75rem !important;
            }
        }
        
        .document-meta {
            font-size: 0.75rem;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .document-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .priority-urgente {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .priority-alta {
            background: #fff7ed;
            color: #ea580c;
            border: 1px solid #fed7aa;
        }
        
        .priority-normal {
            background: #f0fdf4;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }

        /* NAVEGACI√ìN M√ìVIL OPTIMIZADA */
        @media (max-width: 768px) {
            .nav-tabs {
                padding: 0.5rem !important;
                margin-bottom: 1.5rem !important;
                border-radius: 8px 8px 0 0 !important;
                scrollbar-width: none !important;
                -ms-overflow-style: none !important;
            }
            
            .nav-tabs::-webkit-scrollbar {
                display: none !important;
            }
            
            .nav-tabs .nav-item {
                display: inline-block !important;
                flex-shrink: 0 !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1rem !important;
                margin: 0 0.25rem !important;
                font-size: 0.9rem !important;
                min-width: auto !important;
                white-space: nowrap !important;
                min-height: 44px !important;
                border-radius: 6px !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1rem !important;
                margin-right: 0.5rem !important;
            }
            
            /* Scroll suave para pesta√±as */
            .nav-tabs {
                scroll-behavior: smooth !important;
            }
        }

        /* NAVEGACI√ìN TABLET OPTIMIZADA */
        @media (min-width: 768px) and (max-width: 1024px) {
            .nav-tabs {
                padding: 0.75rem !important;
                margin-bottom: 2rem !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.875rem 1.25rem !important;
                font-size: 0.95rem !important;
                margin: 0 0.25rem !important;
                min-height: 46px !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1.1rem !important;
                margin-right: 0.6rem !important;
            }
        }

        /* M√≥vil - mantener iconos y texto visible */
        @media (max-width: 480px) {
            .nav-tabs .nav-link {
                padding: 0.625rem 0.75rem !important;
                font-size: 0.85rem !important;
            }
            
            /* Mantener texto visible en m√≥vil
            .nav-tabs .nav-link span {
                display: none !important;
            }
            
            .nav-tabs .nav-link i {
                margin-right: 0 !important;
            }
            */
        }

        /* Evaluaciones Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#evaluations-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#evaluations-tab:hover,
        .nav-tabs .nav-link#evaluations-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
            color: white !important;
        }

        /* Assessment Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#assessment-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#assessment-tab:hover,
        .nav-tabs .nav-link#assessment-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
            color: white !important;
        }

        /* Tareas Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#tasks-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#tasks-tab:hover,
        .nav-tabs .nav-link#tasks-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            color: white !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
        }

        /* Progreso Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#progress-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#progress-tab:hover,
        .nav-tabs .nav-link#progress-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            color: white !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
        }

        /* Iconos con animaci√≥n */
        .nav-tabs .nav-link i {
            transition: transform 0.3s ease;
        }

        .nav-tabs .nav-link:hover i,
        .nav-tabs .nav-link.active i {
            transform: scale(1.1);
        }

        /* Buttons */
        .btn-primary-custom {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.2); /* Updated with new primary color */
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(90, 103, 216, 0.4); /* Updated with new primary color */
            color: white;
        }

        .btn-success-custom {
            background: var(--success-gradient);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-success-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(104, 211, 145, 0.4); /* Updated with new secondary/success color */
            color: white;
        }

        .btn-warning-custom {
            background: var(--warning-gradient);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-warning-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(237, 137, 54, 0.4); /* Updated with new accent/warning color */
            color: white;
        }

        /* Botones espec√≠ficos para evaluaciones */
        .btn-evaluation {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-evaluation:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            color: white;
        }

        /* Botones espec√≠ficos para tareas */
        .btn-task {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-task:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
            color: white;
        }

        /* Botones espec√≠ficos para progreso */
        .btn-progress {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .btn-progress:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
            color: white;
        }

        /* Botones de outline para acciones secundarias */
        .btn-outline-evaluation {
            background: transparent;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #3b82f6;
            transition: all 0.3s ease;
        }

        .btn-outline-evaluation:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-outline-task {
            background: transparent;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #f59e0b;
            transition: all 0.3s ease;
        }

        .btn-outline-task:hover {
            background: #f59e0b;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-outline-progress {
            background: transparent;
            border: 2px solid #8b5cf6;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #8b5cf6;
            transition: all 0.3s ease;
        }

        .btn-outline-progress:hover {
            background: #8b5cf6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        /* ESTILOS DE RECOMENDACIONES - COPIADOS DEL COACH DASHBOARD */
        .category-content {
            padding: 1.25rem;
        }
        
        .recommendation-item {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--calm-accent);
            position: relative;
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        [data-theme="dark"] .recommendation-item {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        
        .recommendation-item:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-left-color: var(--calm-primary);
            transform: translateX(5px) translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--bs-primary) !important;
        }
        
        [data-theme="dark"] .recommendation-item:hover {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
        }
        
        .recommendation-item:before {
            content: "‚úì";
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--calm-accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .recommendation-text {
            margin-left: 1.5rem;
            line-height: 1.6;
            color: #334155;
            font-weight: 500;
        }
        
        /* Estilos especiales para subcategor√≠as de dimensiones */
        .dimension-subcategory {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            margin-bottom: 2rem;
        }
        
        .subcategory-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: #0f172a !important;
            padding: 1.25rem;
            border-bottom: 3px solid var(--calm-accent);
        }
        
        [data-theme="dark"] .subcategory-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: #f1f5f9 !important;
            border-bottom-color: #60a5fa;
        }
        
        .subcategory-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .subcategory-info {
            flex: 1;
        }
        
        .subcategory-title {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: #0f172a !important;
        }
        
        [data-theme="dark"] .subcategory-title {
            color: #f1f5f9 !important;
        }

        /* ANIMACIONES - COPIADAS DEL COACH DASHBOARD */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .action-list li {
            position: relative;
            padding-left: 0.5rem;
        }
        
        .action-list li:before {
            content: "‚Üí";
            position: absolute;
            left: -0.5rem;
            color: var(--bs-primary);
            font-weight: bold;
        }
        
        .item-number {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Summary cards */
        .summary-card {
            background: var(--calm-surface);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--calm-border);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 20px rgba(90, 103, 216, 0.05); /* Updated with new primary color */
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(90, 103, 216, 0.1); /* Updated with new primary color */
        }

        .summary-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: white;
        }

        .summary-icon.primary {
            background: var(--primary-gradient);
        }

        .summary-icon.success {
            background: var(--success-gradient);
        }

        .summary-icon.warning {
            background: var(--warning-gradient);
        }

        .summary-icon.danger {
            background: var(--danger-gradient);
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .summary-label {
            color: var(--calm-text-muted); /* Usando color muted mejorado para mejor contraste */
            font-weight: 500;
        }

        /* EVALUATION CARDS MODERNIZADAS - DISE√ëO COLORIDO Y ATRACTIVO */
        .evaluation-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
            border: none !important;
            border-radius: 1rem !important;
            padding: 1.5rem !important;
            margin-bottom: 1.25rem !important;
            color: #333 !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .evaluation-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        }
        
        /* Headers coloridos para diferentes tipos de evaluaci√≥n */
        .evaluation-item[data-type="disc"]::before {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%) !important;
        }
        
        .evaluation-item[data-type="emotional"]::before {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%) !important;
        }
        
        .evaluation-item[data-type="leadership"]::before {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%) !important;
        }
        
        .evaluation-item[data-type="teamwork"]::before {
            background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%) !important;
        }
        
        .evaluation-item[data-type="assertiveness"]::before {
            background: linear-gradient(90deg, #fa709a 0%, #fee140 100%) !important;
        }

        .evaluation-item:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        }

        .evaluation-score {
            font-size: 2.25rem !important;
            font-weight: 700 !important;
            margin-bottom: 0.5rem !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        .evaluation-level {
            font-weight: 600 !important;
            margin-bottom: 1rem !important;
            color: #2c3e50 !important;
            font-size: 1.1rem !important;
        }

        .evaluation-description {
            line-height: 1.5 !important;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
            padding: 1rem !important;
            border-radius: 0.75rem !important;
            border-left: 4px solid var(--calm-primary) !important;
            color: #6c757d !important;
            font-size: 0.95rem !important;
        }

        .evaluation-date {
            color: #6c757d !important;
            font-size: 0.85rem !important;
            font-weight: 500 !important;
            margin-top: 1rem !important;
        }
        
        /* EVALUATION CARDS RESPONSIVE - M√ìVIL MEJORADO */
        @media (max-width: 768px) {
            .evaluation-item {
                padding: 1.5rem 1.25rem !important;
                margin-bottom: 1.25rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                transition: all 0.2s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .evaluation-item::before {
                height: 4px !important;
                border-radius: 0 0 4px 4px !important;
            }
            
            .evaluation-score {
                font-size: 2.5rem !important;
                font-weight: 800 !important;
                margin-bottom: 0.75rem !important;
                text-align: center !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                -webkit-background-clip: text !important;
                -webkit-text-fill-color: transparent !important;
                background-clip: text !important;
                line-height: 1.1 !important;
            }
            
            .evaluation-level {
                font-size: 1.1rem !important;
                font-weight: 700 !important;
                text-align: center !important;
                color: #2c3e50 !important;
                margin-bottom: 1rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
            }
            
            .evaluation-description {
                padding: 1.25rem !important;
                font-size: 0.95rem !important;
                line-height: 1.6 !important;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
                border-radius: 0.75rem !important;
                border-left: 4px solid var(--calm-primary) !important;
                color: #495057 !important;
                margin-bottom: 1rem !important;
            }
            
            .evaluation-date {
                font-size: 0.85rem !important;
                color: #6c757d !important;
                font-weight: 500 !important;
                text-align: center !important;
                padding: 0.5rem !important;
                background: rgba(108, 117, 125, 0.1) !important;
                border-radius: 0.5rem !important;
                margin-top: 1rem !important;
            }
            
            .evaluation-item:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.12) !important;
            }
            
            /* Estilos espec√≠ficos por tipo de evaluaci√≥n en m√≥vil */
            .evaluation-item[data-type="disc"] {
                background: linear-gradient(135deg, #ffffff 0%, #f3f2ff 100%) !important;
            }
            
            .evaluation-item[data-type="emotional"] {
                background: linear-gradient(135deg, #ffffff 0%, #fff0f5 100%) !important;
            }
            
            .evaluation-item[data-type="leadership"] {
                background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%) !important;
            }
            
            .evaluation-item[data-type="teamwork"] {
                background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%) !important;
            }
            
            .evaluation-item[data-type="assertiveness"] {
                background: linear-gradient(135deg, #ffffff 0%, #fffaf0 100%) !important;
            }
        }
        
        /* OVERRIDE GLOBAL PARA FORZAR ESTILOS LIMPIOS */
        .glass-card,
        .card,
        .modal-content,
        [style*="background"],
        [class*="glass"] {
            background: white !important;
            backdrop-filter: none !important;
            border: 1px solid #dee2e6 !important;
            color: #333 !important;
        }
        
        .text-white,
        .text-white-50,
        .text-gradient {
            color: #333 !important;
        }
        
        /* ANULAR REGLA PROBLEM√ÅTICA ESPEC√çFICAMENTE PARA GENERAL-RECOMMENDATIONS */
        .general-recommendations .text-white,
        .general-recommendations .text-white-50,
        .general-recommendations .text-gradient {
            color: white !important;
        }
        
        .text-muted {
            color: #666 !important;
        }

        /* TASK CARDS MODERNIZADAS - DISE√ëO ATRACTIVO Y FUNCIONAL */
        .task-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
            border: none !important;
            border-radius: 1rem !important;
            padding: 1.5rem !important;
            margin-bottom: 1.25rem !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .task-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--calm-primary) 0%, var(--calm-secondary) 100%);
        }
        
        .task-item:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 20px rgba(0,0,0,0.12) !important;
        }

        .task-header {
            display: flex !important;
            justify-content: space-between !important;
            align-items: flex-start !important;
            margin-bottom: 1rem !important;
        }

        .task-title {
            font-weight: 600 !important;
            color: #2c3e50 !important;
            margin-bottom: 0.5rem !important;
            font-size: 1.1rem !important;
            line-height: 1.4 !important;
        }

        .task-description {
            color: #6c757d !important;
            margin-bottom: 1rem !important;
            line-height: 1.5 !important;
            font-size: 0.95rem !important;
        }

        .task-meta {
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 0.75rem !important;
            margin-bottom: 1rem !important;
            align-items: center !important;
        }

        .task-badge {
            padding: 0.35rem 0.85rem !important;
            border-radius: 1rem !important;
            font-size: 0.75rem !important;
            font-weight: 600 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.3px !important;
            border: none !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: 0.25rem !important;
        }

        .task-badge.priority-high {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(238, 90, 36, 0.3) !important;
        }

        .task-badge.priority-medium {
            background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(254, 202, 87, 0.3) !important;
        }

        .task-badge.priority-low {
            background: linear-gradient(135deg, #48cae4 0%, #0077b6 100%) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(72, 202, 228, 0.3) !important;
        }

        .task-badge.status-pending {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%) !important;
            color: white !important;
        }

        .task-badge.status-in_progress {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%) !important;
            color: white !important;
        }

        .task-badge.status-completed {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%) !important;
            color: white !important;
        }

        /* TASK CARDS RESPONSIVE - M√ìVIL MEJORADO */
        @media (max-width: 768px) {
            .task-item {
                padding: 1.5rem 1.25rem !important;
                margin-bottom: 1.25rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08) !important;
                transition: all 0.2s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .task-item::before {
                width: 4px !important;
                background: linear-gradient(180deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                border-radius: 0 4px 4px 0 !important;
            }
            
            .task-header {
                display: flex !important;
                flex-direction: column !important;
                gap: 0.75rem !important;
                margin-bottom: 1rem !important;
            }
            
            .task-title {
                font-size: 1.1rem !important;
                font-weight: 700 !important;
                color: #2c3e50 !important;
                margin-bottom: 0 !important;
                line-height: 1.4 !important;
            }
            
            .task-description {
                font-size: 0.95rem !important;
                color: #495057 !important;
                margin-bottom: 1rem !important;
                line-height: 1.5 !important;
                background: rgba(248, 249, 250, 0.8) !important;
                padding: 0.75rem !important;
                border-radius: 0.5rem !important;
                border-left: 3px solid var(--calm-accent) !important;
            }
            
            .task-meta {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
                margin-bottom: 1rem !important;
                align-items: center !important;
            }
            
            .task-badge {
                padding: 0.4rem 0.8rem !important;
                font-size: 0.75rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
                min-height: 28px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .task-progress {
                margin-top: 1rem !important;
                padding: 0.75rem !important;
                background: rgba(233, 236, 239, 0.5) !important;
                border-radius: 0.5rem !important;
            }
            
            .task-item:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.12) !important;
            }
            
            /* Colores espec√≠ficos para diferentes estados de tareas */
            .task-item[data-status="pending"]::before {
                background: linear-gradient(180deg, #f39c12 0%, #e67e22 100%) !important;
            }
            
            .task-item[data-status="in-progress"]::before {
                background: linear-gradient(180deg, #3498db 0%, #2980b9 100%) !important;
            }
            
            .task-item[data-status="completed"]::before {
                background: linear-gradient(180deg, #2ecc71 0%, #27ae60 100%) !important;
            }
            
            .task-item[data-priority="high"] {
                background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%) !important;
                border-color: rgba(239, 68, 68, 0.1) !important;
            }
            
            .task-item[data-priority="medium"] {
                background: linear-gradient(135deg, #ffffff 0%, #fffbf0 100%) !important;
                border-color: rgba(245, 158, 11, 0.1) !important;
            }
            
            .task-item[data-priority="low"] {
                background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%) !important;
                border-color: rgba(34, 197, 94, 0.1) !important;
            }
        }

        /* CONTENT CARDS STYLES */
        .content-card {
            background: #ffffff;
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            height: 100%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 12px;
        }

        .content-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            z-index: 1;
        }

        .content-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .content-card:hover::before {
            transform: scaleX(1);
        }

        .content-card.viewed {
            border-color: rgba(34, 197, 94, 0.4);
        }

        .content-card.viewed::before {
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
        }

        /* Preview styles */
        .content-preview {
            position: relative;
            cursor: pointer;
        }

        .content-preview.has-embedded-video {
            cursor: default;
            /* pointer-events removido - bloqueaba clics en iframes */
        }

        .content-preview.has-embedded-video iframe {
            cursor: default;
        }

        .content-preview .ratio iframe {
            border-radius: 8px;
        }

        .duration-badge {
            position: relative;
            margin-top: 8px;
            display: inline-block;
        }

        .content-header {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .content-type-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .content-card.viewed .content-type-icon {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }

        .content-info {
            flex: 1;
            min-width: 0;
        }

        .content-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.4;
            word-wrap: break-word;
        }

        [data-theme="dark"] .content-info-text {
            color: #f1f5f9 !important;
        }

        .content-description {
            margin: 0.75rem 0;
            padding: 0.75rem;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 8px;
        }

        .content-description p {
            margin: 0;
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
        }

        .content-meta {
            margin: 0.75rem 0;
            font-size: 0.85rem;
            color: #64748b;
        }

        .content-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .content-actions .btn {
            border-radius: 8px;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .content-actions .btn:hover {
            transform: translateY(-1px);
        }

        /* Content responsive */
        @media (max-width: 768px) {
            .content-card {
                padding: 1rem;
            }
            
            .content-header {
                gap: 0.5rem;
            }
            
            .content-type-icon {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .content-title {
                font-size: 0.95rem;
            }
            
            .content-actions {
                gap: 0.25rem;
            }
            
            .content-actions .btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }

        /* Progress bars */
        .progress-container {
            margin: 1rem 0;
        }

        .progress-bar-custom {
            height: 8px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-fill.low {
            background: var(--danger-gradient);
        }

        .progress-fill.medium {
            background: var(--warning-gradient);
        }

        .progress-fill.high {
            background: var(--success-gradient);
        }

        /* Chart container */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            min-height: 350px;
            max-height: 500px;
            position: relative;
            overflow: visible;
        }
        
        /* Progress chart specific container */
        .progress-chart-wrapper {
            margin-bottom: 2rem;
        }
        
        .progress-chart-wrapper .chart-container {
            height: 350px;
            margin-bottom: 1rem;
        }
        
        /* Progress info card */
        .progress-info-card {
            margin-top: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .progress-info-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Progress tab specific styles */
        #progress .dashboard-card {
            margin-bottom: 2rem;
        }
        
        #progress .row {
            margin-bottom: 1.5rem;
        }
        
        #progress .row:last-child {
            margin-bottom: 0;
        }
        
        /* Responsive adjustments for progress section */
        @media (max-width: 991.98px) {
            .progress-chart-wrapper .chart-container {
                height: 300px;
            }
            
            #progress .col-lg-8,
            #progress .col-lg-4 {
                margin-bottom: 1.5rem;
            }
        }
        
        @media (max-width: 767.98px) {
            .progress-chart-wrapper .chart-container {
                height: 250px;
                padding: 1rem;
            }
            
            .progress-info-card {
                font-size: 0.9rem;
            }
            
            .progress-info-card .h4 {
                font-size: 1.25rem;
            }
            
            .progress-info-card .h5 {
                font-size: 1.1rem;
            }
        }

        /* Responsive Radar Chart Container */
        .radar-chart-container {
            position: relative;
            width: 100%;
            height: 350px; /* Base height */
            max-width: 100%;
            margin: 0 auto;
        }

        .radar-chart-container canvas {
            max-width: 100% !important;
            height: auto !important;
        }

        /* Mobile optimizations for radar chart */
        @media (max-width: 576px) {
            .radar-chart-container {
                height: 280px; /* Smaller on mobile but still prominent */
                padding: 0 0.5rem;
            }
        }

        @media (min-width: 577px) and (max-width: 768px) {
            .radar-chart-container {
                height: 320px; /* Medium size for tablets */
            }
        }

        @media (min-width: 769px) and (max-width: 991px) {
            .radar-chart-container {
                height: 350px; /* Standard size for larger tablets */
            }
        }

        @media (min-width: 992px) {
            .radar-chart-container {
                height: 380px; /* Largest size for desktop */
            }
        }

        /* Loading states */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner-border-custom {
            width: 3rem;
            height: 3rem;
            border: 0.3em solid rgba(102, 126, 234, 0.25);
            border-top-color: #667eea;
        }

        /* Empty states */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--calm-text-muted); /* Mejorado para mejor contraste */
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Assessment specific styles - MODERNIZADO */
        .question-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 16px;
            padding: 1.75rem;
            margin-bottom: 1rem;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(102, 126, 234, 0.1);
        }

        [data-theme="dark"] .question-card {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .question-title {
            font-weight: 600;
            color: #667eea;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 14px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 20px;
            border: 1px solid rgba(102, 126, 234, 0.2);
        }

        .question-text {
            color: #1e293b !important;
            font-size: 1.25rem;
            line-height: 1.6;
            font-weight: 600;
            margin-top: 1.25rem;
        }

        [data-theme="dark"] .question-text {
            color: #f1f5f9 !important;
        }

        .option-item {
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid #e2e8f0 !important;
            border-radius: 12px !important;
            background: white;
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .option-item {
            background: #0f172a;
            border-color: #334155 !important;
        }

        .option-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .option-item:hover::before {
            left: 100%;
        }

        .option-item .form-check-label {
            color: #334155 !important;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.25s ease;
        }

        [data-theme="dark"] .option-item .form-check-label {
            color: #cbd5e1 !important;
        }

        .option-item:hover {
            border-color: #667eea !important;
            transform: translateX(4px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2);
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
        }

        .option-item.bg-primary {
            border-color: #667eea !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            transform: translateX(4px) scale(1.02);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.35);
        }

        .option-item.bg-primary .form-check-label {
            color: white !important;
            font-weight: 600;
        }

        .option-item .form-check-input {
            margin-top: 0.125rem;
        }
        
        /* Auto-advance enhancements for assessment - MODERNIZADO */
        .auto-advance-option {
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid #e2e8f0 !important;
            border-radius: 12px !important;
            background: white;
            position: relative;
            overflow: hidden;
        }

        [data-theme="dark"] .auto-advance-option {
            background: #0f172a;
            border-color: #334155 !important;
        }

        .auto-advance-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: left 0.5s;
        }

        .auto-advance-option:hover::before {
            left: 100%;
        }

        .auto-advance-option .form-check-label {
            color: #334155 !important;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.25s ease;
        }

        [data-theme="dark"] .auto-advance-option .form-check-label {
            color: #cbd5e1 !important;
        }
        
        .auto-advance-option:hover {
            border-color: #667eea !important;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.05) 0%, rgba(118, 75, 162, 0.05) 100%);
            transform: translateX(4px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.2);
        }
        
        .auto-advance-option.selected {
            border-color: #667eea !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            transform: translateX(4px) scale(1.02);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.35);
        }
        
        .auto-advance-option.selected .form-check-label {
            color: white !important;
            font-weight: 600;
        }
        
        .auto-advance-option .form-check-input {
            display: none; /* Hide radio buttons for cleaner look */
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Loading state for buttons */
        .btn-primary-custom:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* ========================================
           MODAL DE DETALLES DE EVALUACI√ìN - CONSOLIDADO
           √öNICA FUENTE DE VERDAD PARA #evaluationDetailsModal
           ======================================== */
        
        /* Modal dialog - Tama√±o y espaciado solamente */
        #evaluationDetailsModal .modal-dialog {
            max-width: 900px;
        }
        
        @media (max-width: 992px) {
            #evaluationDetailsModal .modal-dialog {
                max-width: 720px;
            }
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .modal-dialog {
                max-width: calc(100% - 2rem);
                margin: 5rem auto 2rem auto !important;
            }
        }
        
        /* Mejoras para modales en m√≥vil - IGUAL QUE COACH DASHBOARD */
        @media (max-width: 575.98px) {
            .modal-dialog {
                margin: 0.5rem;
            }
            
            .modal-content {
                border-radius: 12px;
            }
            
            .modal-header {
                padding: 1rem;
            }
            
            .modal-title {
                font-size: 1.1rem;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            .modal-footer {
                padding: 1rem;
                gap: 0.5rem;
            }
        }
        
        /* ========================================
           MODAL DE EVALUACI√ìN - ESTILO FIGMA MODERNO
           ======================================== */
        
        /* Header del modal - Gradiente vibrante estilo Figma */
        #evaluationDetailsModal .modal-header.modal-header-dark {
            background: linear-gradient(135deg, #a855f7 0%, #ec4899 50%, #f97316 100%) !important;
            border-bottom: none !important;
            color: #ffffff !important;
            padding: 1.5rem 2rem !important;
            position: relative !important;
            border-radius: 1rem 1rem 0 0 !important;
            overflow: hidden !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark::before {
            content: '' !important;
            position: absolute !important;
            top: -50% !important;
            right: -10% !important;
            width: 200px !important;
            height: 200px !important;
            background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%) !important;
            border-radius: 50% !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark .modal-title {
            color: #ffffff !important;
            font-size: 1.375rem !important;
            font-weight: 700 !important;
            display: flex !important;
            align-items: center !important;
            gap: 0.75rem !important;
            position: relative !important;
            z-index: 1 !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark .modal-title i {
            color: #ffffff !important;
            font-size: 1.5rem !important;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2)) !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark .btn {
            background: rgba(255, 255, 255, 0.25) !important;
            border: none !important;
            color: white !important;
            backdrop-filter: blur(10px) !important;
            transition: all 0.3s ease !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark .btn:hover {
            background: rgba(255, 255, 255, 0.4) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2) !important;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .modal-header.modal-header-dark {
                padding: 0.875rem 1.25rem !important;
            }
            
            #evaluationDetailsModal .modal-header.modal-header-dark .modal-title {
                font-size: 1rem !important;
            }
        }
        
        /* Body del modal - Fondo limpio con scroll mejorado */
        #evaluationDetailsModal .modal-body {
            background: #f8fafc;
            color: #1e293b;
            padding: 1.5rem;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
            overflow-x: hidden;
        }

        [data-theme="dark"] .content-meta {
            color: #f1f5f9 !important;
        }
        
        #evaluationDetailsModal .modal-body::-webkit-scrollbar {
            width: 6px;
        }
        
        #evaluationDetailsModal .modal-body::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 3px;
        }
        
        #evaluationDetailsModal .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 3px;
        }
        
        #evaluationDetailsModal .modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #2563eb 0%, #1e40af 100%);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .modal-body {
                padding: 1.25rem;
                max-height: calc(100vh - 220px);
            }
        }
        
        @media (max-width: 576px) {
            #evaluationDetailsModal .modal-body {
                padding: 1rem;
            }
        }
        
        /* Cards dentro del modal - Dise√±o compacto con bordes sutiles */
        #evaluationDetailsModal .card:not([style*="background"]) {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            color: #1e293b;
            border-radius: 10px;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        [data-theme="dark"] .task-title {
            color: #f1f5f9 !important;
        }
        
        #evaluationDetailsModal .card:not([style*="background"]):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .card {
                margin-bottom: 0.875rem;
                border-radius: 8px;
            }
        }
        
        /* Headers de cards - Dise√±o limpio y compacto */
        #evaluationDetailsModal .card-header {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom: 1px solid #e2e8f0;
            padding: 0.75rem 1rem;
            border-radius: 10px 10px 0 0;
        }
        
        [data-theme="dark"] #evaluationDetailsModal .card-header {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-bottom: 1px solid #475569;
        }
        
        #evaluationDetailsModal .card-header h5,
        #evaluationDetailsModal .card-header h6 {
            margin: 0;
            font-size: 0.9375rem;
            font-weight: 600;
            color: #1e293b !important;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        [data-theme="dark"] .tasks-header {
            color: #f1f5f9 !important;
        }
        
        #evaluationDetailsModal .card-header i {
            color: #3b82f6 !important;
            font-size: 1rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .card-header {
                padding: 0.625rem 0.875rem;
            }
            
            #evaluationDetailsModal .card-header h5,
            #evaluationDetailsModal .card-header h6 {
                font-size: 0.875rem;
            }
        }
        
        #evaluationDetailsModal .card-body {
            padding: 1rem;
            background: #ffffff;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .card-body {
                padding: 0.875rem;
            }
        }
        
        /* Resultados DISC - Grid compacto y responsive */
        #evaluationDetailsModal .dimension-results {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .dimension-results {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.625rem;
            }
        }
        
        /* Tarjetas de dimensiones DISC - Dise√±o limpio y compacto */
        #evaluationDetailsModal .dimension-card {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        #evaluationDetailsModal .dimension-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .dimension-card {
                padding: 0.625rem;
            }
        }
        
        #evaluationDetailsModal .dimension-label {
            font-size: 0.8125rem;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 0.375rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .dimension-label {
                font-size: 0.75rem;
            }
        }
        
        #evaluationDetailsModal .dimension-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1e40af;
            line-height: 1;
            margin-bottom: 0.25rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .dimension-value {
                font-size: 1.5rem;
            }
        }
        
        #evaluationDetailsModal .dimension-percentage {
            font-size: 0.75rem;
            font-weight: 500;
            color: #94a3b8;
        }
        
        /* Recomendaciones - Lista limpia y legible */
        #evaluationDetailsModal .recommendation-item {
            background: #ffffff;
            border-left: 3px solid #3b82f6;
            padding: 0.75rem 0.75rem 0.75rem 1rem;
            margin-bottom: 0.625rem;
            font-size: 0.875rem;
            line-height: 1.6;
            color: #334155;
            display: flex;
            align-items: flex-start;
            gap: 0.625rem;
            border-radius: 0 6px 6px 0;
            transition: all 0.2s ease;
        }
        
        #evaluationDetailsModal .recommendation-item:hover {
            background: #f8fafc;
            border-left-color: #2563eb;
            transform: translateX(3px);
        }
        
        #evaluationDetailsModal .recommendation-item::before {
            content: "‚úì";
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            font-size: 0.6875rem;
            font-weight: 700;
            flex-shrink: 0;
            margin-top: 0.125rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .recommendation-item {
                font-size: 0.8125rem;
                padding: 0.625rem 0.625rem 0.625rem 0.875rem;
                margin-bottom: 0.5rem;
            }
            
            #evaluationDetailsModal .recommendation-item::before {
                width: 18px;
                height: 18px;
                font-size: 0.625rem;
            }
        }
        
        /* Categor√≠as de recomendaciones - Headers coloridos y compactos */
        #evaluationDetailsModal .category-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 0.625rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        #evaluationDetailsModal .category-header i {
            font-size: 1rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .category-header {
                padding: 0.5rem 0.875rem;
                font-size: 0.8125rem;
            }
        }
        
        #evaluationDetailsModal .strengths-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        #evaluationDetailsModal .opportunities-category .category-header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        #evaluationDetailsModal .final-message .category-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        /* Override para mantener el t√≠tulo de categor√≠a blanco */
        #evaluationDetailsModal .general-recommendations h6.category-title,
        #evaluationDetailsModal .category-header h6 {
            color: white !important;
            margin: 0;
        }
        
        /* Detalles adicionales - Filas limpias y compactas */
        #evaluationDetailsModal .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.625rem 0.875rem;
            background: #ffffff;
            border-left: 2px solid #e2e8f0;
            margin-bottom: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            border-radius: 0 6px 6px 0;
        }
        
        #evaluationDetailsModal .detail-row:hover {
            background: #f8fafc;
            border-left-color: #3b82f6;
            transform: translateX(2px);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .detail-row {
                font-size: 0.8125rem;
                padding: 0.5rem 0.75rem;
            }
        }
        
        @media (max-width: 576px) {
            #evaluationDetailsModal .detail-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
        }
        
        #evaluationDetailsModal .detail-label {
            font-weight: 600;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }
        
        #evaluationDetailsModal .detail-label i {
            color: #3b82f6;
            font-size: 0.875rem;
        }
        
        #evaluationDetailsModal .detail-value {
            font-weight: 700;
            color: #1e40af;
        }
        
        /* Loading spinner - Estado de carga limpio */
        #evaluationDetailsModal .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 250px;
            gap: 1rem;
            padding: 2rem;
        }
        
        #evaluationDetailsModal .spinner-border-custom {
            width: 2.5rem;
            height: 2.5rem;
            border-width: 0.25rem;
            color: #3b82f6;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .loading-spinner {
                min-height: 200px;
                padding: 1.5rem;
            }
            
            #evaluationDetailsModal .spinner-border-custom {
                width: 2rem;
                height: 2rem;
            }
        }
        
        /* Secciones colapsables - Interacci√≥n mejorada */
        #evaluationDetailsModal .collapse-toggle {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.625rem 0.875rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
            color: #334155;
            font-weight: 500;
        }
        
        #evaluationDetailsModal .collapse-toggle:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        
        #evaluationDetailsModal .collapse-toggle i {
            transition: transform 0.2s ease;
            color: #3b82f6;
        }
        
        #evaluationDetailsModal .collapse-toggle.collapsed i {
            transform: rotate(-90deg);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .collapse-toggle {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
        }
        
        /* Footer del modal - Botones compactos y modernos */
        #evaluationDetailsModal .modal-footer {
            background: #ffffff;
            border-top: 1px solid #e5e7eb;
            padding: 1rem 1.5rem;
            border-radius: 0 0 12px 12px;
            gap: 0.625rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .modal-footer {
                padding: 0.875rem 1.25rem;
                gap: 0.5rem;
            }
        }
        
        #evaluationDetailsModal .btn-modal-action {
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.625rem 1rem;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        #evaluationDetailsModal .btn-modal-action:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .btn-modal-action {
                font-size: 0.8125rem;
                padding: 0.5rem 0.875rem;
            }
        }
        
        @media (max-width: 576px) {
            #evaluationDetailsModal .btn-modal-action {
                flex: 1;
                justify-content: center;
                font-size: 0.8125rem;
            }
            
            #evaluationDetailsModal .btn-modal-action .btn-text-full {
                display: none !important;
            }
            
            #evaluationDetailsModal .btn-modal-action .btn-text-short {
                display: inline !important;
            }
            
            #evaluationDetailsModal .btn-modal-action:first-child {
                flex: 0 0 auto;
            }
        }
        
        #evaluationDetailsModal .btn-modal-action i {
            font-size: 1rem;
        }
        
        #evaluationDetailsModal .btn-modal-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        
        #evaluationDetailsModal .btn-modal-action:active {
            transform: translateY(0);
        }
        
        #evaluationDetailsModal .btn-outline-secondary {
            color: #64748b;
            border-color: #cbd5e1;
            background: #ffffff;
        }
        
        #evaluationDetailsModal .btn-outline-secondary:hover {
            color: #ffffff;
            background: #64748b;
            border-color: #64748b;
        }
        
        #evaluationDetailsModal .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: #ffffff;
        }
        
        #evaluationDetailsModal .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        /* ========================================
           CONTRASTE Y LEGIBILIDAD DEL TEXTO
           ======================================== */
        
        /* T√≠tulos y textos principales */
        #evaluationDetailsModal h4,
        #evaluationDetailsModal h5,
        #evaluationDetailsModal h6 {
            color: #1e293b !important;
            font-weight: 600;
        }

        [data-theme="dark"] .dropdown-item {
            color: #f1f5f9 !important;
        }
        
        /* Texto del cuerpo */
        #evaluationDetailsModal p,
        #evaluationDetailsModal .text-muted,
        #evaluationDetailsModal .recommendation-text {
            color: #334155 !important;
            line-height: 1.6;
        }

        [data-theme="dark"] .dropdown-item {
            color: #f1f5f9 !important;
        }
        
        /* Texto en cards con fondo blanco */
        #evaluationDetailsModal .card {
            color: #1e293b;
        }
        
        #evaluationDetailsModal .card p {
            color: #334155 !important;
        }
        
        /* Texto en badges y etiquetas */
        #evaluationDetailsModal .badge {
            font-weight: 600;
            padding: 0.375rem 0.625rem;
            border-radius: 6px;
        }
        
        /* Lista de elementos */
        #evaluationDetailsModal ul li,
        #evaluationDetailsModal ol li {
            color: #334155;
            line-height: 1.6;
        }

        [data-theme="dark"] .dropdown-item {
            color: #f1f5f9 !important;
        }
        
        /* Strong y bold text */
        #evaluationDetailsModal strong,
        #evaluationDetailsModal b {
            color: #1e293b;
            font-weight: 600;
        }
        
        /* Links dentro del modal */
        #evaluationDetailsModal a {
            color: #2563eb;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }
        
        #evaluationDetailsModal a:hover {
            color: #1e40af;
            text-decoration: underline;
        }

        [data-theme="dark"] .stats-label {
            color: #f1f5f9 !important;
        }
        
        /* Secciones con fondo gris - asegurar contraste */
        #evaluationDetailsModal .bg-light,
        #evaluationDetailsModal [class*="bg-gray"] {
            color: #1e293b !important;
        }
        
        #evaluationDetailsModal .bg-light p,
        #evaluationDetailsModal [class*="bg-gray"] p {
            color: #334155 !important;
        }
        
        /* ========================================
           FIN MODAL DE EVALUACI√ìN
           ======================================== */
        
        #evaluationDetailsModal .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        #evaluationDetailsModal .btn-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #3b82f6;
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        #evaluationDetailsModal .btn-info:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
            color: #ffffff;
        }
        
        /* Bot√≥n close mejorado en el header */
        #evaluationDetailsModal .btn-close-white {
            filter: brightness(0) invert(1);
            opacity: 0.9;
            width: 1.5rem;
            height: 1.5rem;
            background-size: 1rem;
            transition: all 0.2s ease;
            position: relative;
            z-index: 1;
        }
        
        #evaluationDetailsModal .btn-close-white:hover {
            opacity: 1;
            transform: scale(1.1) rotate(90deg);
        }
        
        @media (max-width: 576px) {
            #evaluationDetailsModal .btn-close-white {
                width: 1.25rem;
                height: 1.25rem;
                background-size: 0.875rem;
            }
        }
        
        /* ESTILOS PARA EL MODAL DE CONTACTAR COACH */
        /* Z-index stacking para modales anidados (Bootstrap 5 base: 1055) */
        
        /* Modal 1: Evaluaci√≥n (base) */
        #evaluationDetailsModal {
            z-index: 1055 !important;
        }
        
        /* Modal 2: Contactar Coach (superior) */
        #contactCoachModal {
            z-index: 1065 !important;
        }
        
        /* Backdrops: el segundo debe estar entre ambos modales */
        .modal-backdrop {
            z-index: 1050 !important; /* Bootstrap default para primer backdrop */
        }
        
        .modal-backdrop.show:last-of-type {
            z-index: 1060 !important; /* Segundo backdrop entre modal 1 y modal 2 */
        }
        
        .modal-header-coach {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            border-bottom: none !important;
            color: #ffffff !important;
            padding: 1.5rem 1.75rem !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .modal-header-coach::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.1) 0%, transparent 70%) !important;
            pointer-events: none !important;
        }
        
        .modal-header-coach::after {
            content: '' !important;
            position: absolute !important;
            bottom: 0 !important;
            left: 1.5rem !important;
            right: 1.5rem !important;
            height: 3px !important;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent) !important;
        }
        
        .modal-header-coach .modal-title {
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 1.35rem !important;
            letter-spacing: 0.3px !important;
            display: flex !important;
            align-items: center !important;
            gap: 1rem !important;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            position: relative !important;
            z-index: 1 !important;
        }
        
        .modal-header-coach .modal-title i {
            font-size: 1.5rem !important;
            opacity: 1 !important;
            animation: pulse-gentle 2s ease-in-out infinite !important;
        }
        
        @keyframes pulse-gentle {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }
        
        .modal-header-coach .modal-title span {
            position: relative !important;
        }
        
        /* ESTILOS PARA EL MODAL DE SOLICITAR PLAN DE DESARROLLO */
        .modal-header-development {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
            border-bottom: none !important;
            color: #ffffff !important;
            padding: 1.5rem 1.75rem !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .modal-header-development::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.15) 0%, transparent 60%) !important;
            pointer-events: none !important;
        }
        
        .modal-header-development::after {
            content: '' !important;
            position: absolute !important;
            bottom: 0 !important;
            left: 1.5rem !important;
            right: 1.5rem !important;
            height: 3px !important;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent) !important;
        }
        
        .modal-header-development .modal-title {
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 1.35rem !important;
            letter-spacing: 0.3px !important;
            display: flex !important;
            align-items: center !important;
            gap: 1rem !important;
            text-shadow: 0 2px 4px rgba(0,0,0,0.15) !important;
            position: relative !important;
            z-index: 1 !important;
        }
        
        .modal-header-development .modal-title i {
            font-size: 1.5rem !important;
            opacity: 1 !important;
            animation: pulse-gentle 2s ease-in-out infinite !important;
        }
        
        .modal-header-development .modal-title span {
            position: relative !important;
        }
        
        /* ESTILOS PARA EL MODAL DE RESULTADOS DE EVALUACI√ìN - MISMOS QUE EVALUATIONDETAILSMODAL */
        #assessmentResultsModal .modal-header.modal-header-dark,
        #assessmentResultsModal .modal-header,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header {
            background: var(--calm-primary) !important;
            background-color: var(--calm-primary) !important;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2) !important;
            padding: 1.25rem 1.5rem !important;
            color: #ffffff !important;
        }
        
        #assessmentResultsModal .modal-header .modal-title,
        #assessmentResultsModal .modal-header h5,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header .modal-title {
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 1.3rem !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
            letter-spacing: 0.5px !important;
        }
        
        #assessmentResultsModal .modal-header .modal-title i,
        #assessmentResultsModal .modal-header i,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header i {
            color: #ffffff !important;
            opacity: 1 !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
        }
        
        /* Forzar color blanco en TODOS los elementos del header con m√°xima especificidad */
        #assessmentResultsModal .modal-header,
        #assessmentResultsModal .modal-header h1,
        #assessmentResultsModal .modal-header h2,
        #assessmentResultsModal .modal-header h3,
        #assessmentResultsModal .modal-header h4,
        #assessmentResultsModal .modal-header h5,
        #assessmentResultsModal .modal-header h6,
        #assessmentResultsModal .modal-header span,
        #assessmentResultsModal .modal-header div:not(.d-flex):not(.gap-2) {
            color: #ffffff !important;
            background: transparent !important;
        }
        
        /* Asegurar que el contenedor de botones sea clickeable */
        #assessmentResultsModal .modal-header .d-flex,
        #assessmentResultsModal .modal-header .gap-2 {
            pointer-events: auto !important;
            z-index: 1000 !important;
        }
        
        /* Botones de la cabecera del modal de resultados */
        #assessmentResultsModal .modal-header .btn,
        #assessmentResultsModal .modal-header .btn-close,
        #assessmentResultsModal .modal-header .btn-secondary,
        #assessmentResultsModal .modal-header .btn-danger,
        #assessmentResultsModal .modal-header button {
            background-color: #6c757d !important;
            border: 1px solid #5a6268 !important;
            color: white !important;
            border-radius: 6px !important;
            padding: 8px 16px !important;
            transition: all 0.3s ease !important;
            font-weight: 600 !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            margin-left: 8px !important;
            pointer-events: auto !important;
            cursor: pointer !important;
            z-index: 999 !important;
            position: relative !important;
        }
        
        #assessmentResultsModal .modal-header .btn:hover,
        #assessmentResultsModal .modal-header .btn-close:hover,
        #assessmentResultsModal .modal-header .btn-secondary:hover,
        #assessmentResultsModal .modal-header .btn-danger:hover,
        #assessmentResultsModal .modal-header button:hover {
            background-color: #5a6268 !important;
            border-color: #4e555b !important;
            color: white !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
            pointer-events: auto !important;
            cursor: pointer !important;
        }
        
        /* Especificidad ultra-alta para el background del modal de resultados */
        body #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header.modal-header-dark,
        body #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header {
            background: #1E3A8A !important;
            background-color: #1E3A8A !important;
            color: #ffffff !important;
        }

        /* Estilos espec√≠ficos para el modal de video */
        #videoModal .modal-header {
            background: #1E3A8A !important;
            color: white !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        #videoModal .modal-header .modal-title {
            color: white !important;
            font-weight: 600 !important;
            flex-grow: 1 !important;
            margin-right: 1rem !important;
        }

        #videoModal .modal-header .btn-close {
            background: rgba(0, 0, 0, 0.6) !important;
            opacity: 1 !important;
            border-radius: 0.375rem !important;
            padding: 0.375rem !important;
            margin: 0 !important;
            margin-left: auto !important;
            border: none !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        #videoModal .modal-header .btn-close:hover {
            background: rgba(0, 0, 0, 0.8) !important;
            transform: scale(1.05) !important;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3) !important;
        }

        #videoModal .modal-header .btn-close span {
            color: white !important;
            font-size: 1.2rem !important;
            font-weight: bold !important;
            line-height: 1 !important;
        }
        
        /* Estilos espec√≠ficos para la secci√≥n de completado */
        #assessmentResultsModal .assessment-completion-section {
            background: linear-gradient(135deg, var(--calm-primary), var(--calm-secondary)) !important;
            color: white !important;
            padding: 2rem !important;
            border-radius: 12px !important;
            margin-bottom: 2rem !important;
            box-shadow: 0 4px 20px rgba(30, 58, 138, 0.3) !important;
        }
        
        #assessmentResultsModal .assessment-score-display {
            font-size: 3.5rem !important;
            font-weight: 800 !important;
            color: #ffffff !important;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        }
        
        #assessmentResultsModal .assessment-level-display {
            font-size: 1.5rem !important;
            font-weight: 600 !important;
            color: #ffffff !important;
            margin-top: 0.5rem !important;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.2) !important;
        }

        /* Estilos profesionales para recomendaciones categorizadas */
        .recommendations-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            border: 2px solid var(--calm-accent);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .recommendations-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white !important;
            padding: 1.5rem;
            border-bottom: 3px solid var(--calm-accent);
            position: relative;
        }
        
        .recommendations-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--calm-accent) 0%, #0ea5e9 50%, var(--calm-accent) 100%);
        }
        
        .recommendation-category {
            background: white;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .recommendation-category:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
            border-color: var(--calm-accent);
        }
        
        .category-header {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-bottom: 2px solid #e2e8f0;
            padding: 1rem 1.25rem;
            position: relative;
        }
        
        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--calm-accent) 0%, #0ea5e9 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 0.75rem;
        }
        
        .score-badge {
            background: linear-gradient(135deg, var(--calm-secondary) 0%, var(--calm-accent) 100%);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .priority-indicator {
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-top: 15px solid;
        }
        
        .priority-high {
            border-top-color: #ef4444;
        }
        
        .priority-medium {
            border-top-color: #f59e0b;
        }
        
        .priority-low {
            border-top-color: #06b6d4;
        }
        
        .priority-growth {
            border-top-color: #10b981;
        }
        
        .category-content {
            padding: 1.25rem;
        }
        
        .recommendation-item {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--calm-accent);
            position: relative;
            transition: all 0.2s ease;
        }
        
        [data-theme="dark"] .recommendation-item {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        
        .recommendation-item:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-left-color: var(--calm-primary);
            transform: translateX(5px);
        }
        
        [data-theme="dark"] .recommendation-item:hover {
            background: linear-gradient(135deg, #334155 0%, #475569 100%);
        }
        
        .recommendation-item:before {
            content: "‚úì";
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--calm-accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .recommendation-text {
            margin-left: 1.5rem;
            line-height: 1.6;
            color: #334155;
            font-weight: 500;
        }
        

        
        .strengths-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .strengths-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .strengths-category .category-title {
            color: white;
        }
        
        .strengths-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .strengths-category .recommendation-item:before {
            background: #10b981;
            content: "‚òÖ";
        }
        
        .final-message {
            border: 2px solid #8b5cf6;
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
        }
        
        .final-message .category-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: #0f172a !important;
            border-bottom-color: #8b5cf6;
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
        }
        
        .final-message .category-title {
            color: #0f172a !important;
        }
        
        .final-message .recommendation-item {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-left-color: #8b5cf6;
        }
        
        /* Estilos especiales para subcategor√≠as de dimensiones */
        .dimension-subcategory {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            margin-bottom: 2rem;
        }
        
        .subcategory-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: #0f172a !important;
            padding: 1.25rem;
            border-bottom: 3px solid var(--calm-accent);
        }
        
        [data-theme="dark"] .subcategory-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: #f1f5f9 !important;
            border-bottom-color: #60a5fa;
        }
        
        .subcategory-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .subcategory-info {
            flex: 1;
        }
        
        .subcategory-title {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: #0f172a !important;
        }
        
        [data-theme="dark"] .subcategory-title {
            color: #f1f5f9 !important;
        }
        
        .subcategory-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .dimension-icon {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        .score-container {
            text-align: center;
        }
        
        .score-badge-large {
            display: block;
            font-size: 1.5rem;
            font-weight: 800;
            padding: 0.75rem 1.25rem;
            border-radius: 25px;
            margin-bottom: 0.25rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        .score-critical {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .score-needs-improvement {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .score-good {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }
        
        .score-excellent {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .score-level {
            font-size: 0.8rem;
            font-weight: 600;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .subcategory-content {
            padding: 1.5rem;
            background: white;
        }
        
        .dimension-item {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--calm-primary);
        }
        
        .dimension-item:hover {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-left-color: #1D4ED8;
        }
        
        .dimension-item:before {
            background: var(--calm-primary);
            content: "‚Üí";
        }
        
        .congratulations-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .congratulations-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .congratulations-category .category-title {
            color: white;
        }
        
        .congratulations-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .congratulations-category .recommendation-item:before {
            background: #10b981;
            content: "üéâ";
        }
        
        .dimension-category {
            border: 2px solid var(--calm-primary);
        }
        
        .dimension-category .priority-indicator {
            display: none; /* Hide priority indicator for dimension subcategories */
        }
        
        /* Responsive adjustments for subcategories */
        @media (max-width: 768px) {
            .subcategory-title-container {
                flex-direction: column;
                text-align: center;
            }
            
            .score-badge-large {
                font-size: 1.25rem;
                padding: 0.5rem 1rem;
            }
        }

        .progress-bar-custom {
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-fill.high {
            background: var(--success-gradient);
        }

        .progress-fill.medium {
            background: var(--warning-gradient);
        }

        .progress-fill.low {
            background: var(--danger-gradient);
        }

        .dimension-score-card {
            transition: transform 0.2s ease;
        }

        .dimension-score-card:hover {
            transform: translateY(-2px);
        }

        .evaluation-section {
            border-left: 4px solid var(--primary-gradient);
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }

        .response-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        /* Improved Assessment Results Styles */
        .assessment-result-card {
            background: var(--calm-surface);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(90, 103, 216, 0.08);
            overflow: hidden;
            margin-bottom: 2rem;
            border: 1px solid var(--calm-border);
            transition: all 0.3s ease;
        }

        .assessment-result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(90, 103, 216, 0.12);
        }

        .assessment-result-header {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .assessment-result-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="60" cy="10" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="70" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="60" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
            pointer-events: none;
        }

        .assessment-score-display {
            font-size: 4rem;
            font-weight: 800;
            margin: 0.5rem 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
        }

        .assessment-level-display {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            opacity: 0.95;
            position: relative;
            z-index: 2;
        }

        .assessment-completion-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 1rem;
            position: relative;
            z-index: 2;
        }

        .assessment-result-body {
            padding: 2rem;
        }

        .assessment-interpretation {
            background: var(--calm-surface-elevated);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid var(--calm-primary);
        }

        .assessment-interpretation h5 {
            color: var(--calm-primary);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .assessment-interpretation p {
            color: var(--calm-text-secondary);
            line-height: 1.6;
            margin-bottom: 0;
        }

        .dimensions-overview {
            background: var(--calm-surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--calm-border);
        }

        .dimensions-overview h6 {
            color: var(--calm-text-primary);
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }

        .dimension-item {
            background: var(--calm-surface-elevated);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--calm-border);
            transition: all 0.2s ease;
        }

        .dimension-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.08);
        }

        .dimension-item:last-child {
            margin-bottom: 0;
        }

        .dimension-label {
            font-weight: 600;
            color: var(--calm-text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .dimension-score {
            font-weight: 700;
            color: var(--calm-primary);
        }

        .dimension-progress {
            background: var(--calm-border);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .dimension-progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease-in-out;
            background: var(--primary-gradient);
            position: relative;
        }

        .dimension-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .assessment-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .assessment-action-btn {
            background: var(--calm-surface-elevated);
            border: 2px solid var(--calm-border);
            color: var(--calm-text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .assessment-action-btn:hover {
            background: var(--calm-primary);
            border-color: var(--calm-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(90, 103, 216, 0.25);
        }

        .assessment-action-btn.primary {
            background: var(--primary-gradient);
            border-color: var(--calm-primary);
            color: white;
        }

        .assessment-action-btn.primary:hover {
            background: var(--calm-primary-dark);
            border-color: var(--calm-primary-dark);
            color: white;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .assessment-score-display {
                font-size: 3rem;
            }
            
            .assessment-level-display {
                font-size: 1.2rem;
            }
            
            .assessment-result-header {
                padding: 1.5rem;
            }
            
            .assessment-result-body {
                padding: 1.5rem;
            }
            
            .assessment-actions {
                flex-direction: column;
            }
            
            .assessment-action-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Utilities */
        .hidden { display: none !important; }
        .visible { display: block !important; }
        /* ========== FORZAR CONTRASTE GLOBAL - ANULAR BOOTSTRAP ========== */
        
        /* Anular todas las clases de texto claras de Bootstrap */
        .text-muted {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris claro */
        }
        
        .text-secondary {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris */
        }
        
        .text-light {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris claro */
        }
        
        /* Forzar contraste en summary cards */
        .summary-card {
            background: #FFFFFF !important; /* Fondo blanco puro */
            border: 2px solid var(--calm-primary) !important; /* Borde azul visible */
            box-shadow: 0 4px 20px rgba(30, 58, 138, 0.15) !important;
        }
        
        .summary-card .summary-number {
            color: var(--calm-primary) !important; /* Azul para n√∫meros */
            font-weight: 800 !important;
        }
        
        .summary-card .summary-label {
            color: var(--calm-text-primary) !important; /* Negro para etiquetas */
            font-weight: 600 !important;
        }
        
        /* Forzar contraste en evaluation cards */
        .evaluation-item {
            background: #FFFFFF !important;
            border: 2px solid var(--calm-border) !important;
        }
        
        .evaluation-item .text-muted,
        .evaluation-item .small {
            color: var(--calm-text-muted) !important;
        }
        
        /* Task cards con mejor contraste */
        .task-item {
            background: #FFFFFF !important;
            border: 2px solid var(--calm-border) !important;
        }
        
        .task-item .text-muted {
            color: var(--calm-text-muted) !important;
        }
        
        /* Botones con contraste mejorado */
        .btn-outline-evaluation,
        .btn-outline-task,
        .btn-outline-progress {
            background: #FFFFFF !important;
            border-width: 2px !important;
            font-weight: 700 !important;
        }
        
        /* Asegurar que los iconos sean visibles */
        .summary-icon {
            border: 2px solid currentColor !important;
            background: rgba(255, 255, 255, 0.9) !important;
        }
        
        .summary-icon.primary {
            color: var(--calm-primary) !important;
            background: rgba(30, 58, 138, 0.1) !important;
        }
        
        .summary-icon.success {
            color: var(--calm-mint-green) !important;
            background: rgba(16, 185, 129, 0.1) !important;
        }
        
        .summary-icon.warning {
            color: #F59E0B !important;
            background: rgba(245, 158, 11, 0.1) !important;
        }
        
        .summary-icon.danger {
            color: #EF4444 !important;
            background: rgba(239, 68, 68, 0.1) !important;
        }
        
        /* Headers de cards m√°s legibles */
        .card-header p {
            color: #111827 !important;
        }
        
        /* ========== FIN FORZAR CONTRASTE ========== */

        /* === SISTEMA DE TEMAS PARA COACHEE DASHBOARD === */
        /* Tema D√≠a (por defecto) */
        :root {
            --theme-bg-primary: var(--calm-gradient-primary);
            --theme-bg-secondary: var(--calm-light);
            --theme-text-primary: var(--calm-white);
            --theme-text-secondary: var(--calm-gray-600);
            --theme-text-muted: rgba(255, 255, 255, 0.7);
            --theme-card-bg: rgba(255, 255, 255, 0.1);
            --theme-card-border: rgba(255, 255, 255, 0.2);
            --theme-shadow: var(--calm-shadow-soft);
            --theme-glass-bg: rgba(30, 58, 138, 0.08);
            --theme-glass-border: rgba(59, 130, 246, 0.12);
        }

        /* Tema Noche - COPIADO DEL COACH DASHBOARD */
        [data-theme="dark"] {
            /* Tema oscuro con tonos azulados del landing page */
            --theme-bg-primary: #3B82F6;        /* Bright Blue principal */
            --theme-bg-secondary: #3B82F6;      /* Bright Blue secundario */
            --theme-bg-card: rgba(51, 65, 85, 0.9);  /* Cards con tono azulado */
            --theme-text-primary: #F8FAFC;
            --theme-text-secondary: #CBD5E1;
            --theme-text-muted: #94A3B8;
            --theme-border-primary: rgba(148, 163, 184, 0.2);
            --theme-border-secondary: rgba(148, 163, 184, 0.3);
            --theme-shadow: rgba(30, 58, 138, 0.2);  /* Sombras con tinte azul */
            --theme-accent: #3B82F6;             /* Azul del landing page */
            --theme-accent-hover: #60A5FA;       /* Azul m√°s claro al hover */
        }

        /* Aplicar variables a elementos base */
        [data-theme="dark"] body {
            background: var(--theme-bg-primary) !important;
            color: var(--theme-text-primary) !important;
            transition: background-color 0.3s ease, color 0.3s ease !important;
        }

        /* === ESTILOS PARA TEMA NOCTURNO MEJORADOS === */
        [data-theme="dark"] .glass-card {
            background: rgba(59, 130, 246, 0.85) !important;  /* Azul principal #3B82F6 con transparencia */
            border-color: rgba(59, 130, 246, 0.3) !important;  /* Borde azul */
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15) !important;  /* Sombra azul */
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .glass-card:hover {
            background: rgba(59, 130, 246, 0.95) !important;  /* Azul m√°s s√≥lido en hover */
            border-color: rgba(59, 130, 246, 0.4) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.25) !important;
        }

        [data-theme="dark"] .glass-card h3,
        [data-theme="dark"] .glass-card h4,
        [data-theme="dark"] .glass-card h5,
        [data-theme="dark"] .glass-card h6 {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .glass-card .text-muted {
            color: var(--theme-text-muted) !important;
        }

        [data-theme="dark"] .text-white-50 {
            color: var(--theme-text-secondary) !important;
        }

        [data-theme="dark"] .btn-outline-light {
            border-color: #06B6D4 !important;
            color: #06B6D4 !important;
            background: rgba(6, 182, 212, 0.1) !important;
        }

        [data-theme="dark"] .btn-outline-light:hover {
            background-color: rgba(6, 182, 212, 0.2) !important;
            border-color: #0284C7 !important;
            color: #0284C7 !important;
        }

        [data-theme="dark"] .btn-outline-light i {
            color: #06B6D4 !important;
        }

        [data-theme="dark"] .btn-outline-light:hover i {
            color: #0284C7 !important;
        }

        /* Botones - Tema Oscuro */
        [data-theme="dark"] .btn-primary {
            background: linear-gradient(135deg, #3B82F6, #3B82F6) !important;
            border-color: #3B82F6 !important;
            color: #FFFFFF !important;
        }

        [data-theme="dark"] .btn-primary:hover:not(:disabled) {
            background: linear-gradient(135deg, #3B82F6, #2563EB) !important;
            border-color: #3B82F6 !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        [data-theme="dark"] .btn-outline-primary {
            color: #3B82F6 !important;
            border-color: #3B82F6 !important;
            background: transparent !important;
        }

        [data-theme="dark"] .btn-outline-primary:hover:not(:disabled) {
            background: #3B82F6 !important;
            border-color: #3B82F6 !important;
            color: white !important;
        }

        [data-theme="dark"] .modal-content {
            background: rgba(51, 65, 85, 0.95) !important;  /* Azul gris√°ceo */
            border-color: rgba(59, 130, 246, 0.2) !important;  /* Borde azul suave */
            box-shadow: 0 20px 40px rgba(30, 58, 138, 0.25) !important;  /* Sombra azulada */
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .modal-header {
            border-color: rgba(59, 130, 246, 0.2) !important;
            background: rgba(51, 65, 85, 0.95) !important;
        }

        [data-theme="dark"] .modal-footer {
            border-color: rgba(59, 130, 246, 0.2) !important;
            background: rgba(51, 65, 85, 0.95) !important;
        }

        [data-theme="dark"] .modal-title {
            color: var(--theme-text-primary) !important;
        }

        /* Estilos espec√≠ficos para asegurar que todos los textos sean visibles en modo noche */
        [data-theme="dark"] .card-header h3,
        [data-theme="dark"] .card-header h4,
        [data-theme="dark"] .card-header h5,
        [data-theme="dark"] .card-header h6 {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .evaluation-item h6 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Estilo para t√≠tulos de evaluaciones disponibles (h5) */
        [data-theme="dark"] .evaluation-item h5 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Override espec√≠fico para evaluaciones disponibles dentro del card-body */
        [data-theme="dark"] #availableEvaluations .evaluation-item h5,
        [data-theme="dark"] .card-body .evaluation-item h5 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Estilos para evaluaciones completadas - mantener colores originales */
        [data-theme="dark"] .evaluation-score.text-success,
        [data-theme="dark"] .evaluation-level.text-success {
            color: #10B981 !important; /* Verde m√°s brillante para modo noche */
            font-weight: bold !important;
        }

        [data-theme="dark"] .evaluation-score.text-warning,
        [data-theme="dark"] .evaluation-level.text-warning {
            color: #F59E0B !important; /* Amarillo m√°s brillante para modo noche */
            font-weight: bold !important;
        }

        [data-theme="dark"] .evaluation-score.text-danger,
        [data-theme="dark"] .evaluation-level.text-danger {
            color: #EF4444 !important; /* Rojo m√°s brillante para modo noche */
            font-weight: bold !important;
        }

        /* Override m√°s espec√≠fico para evaluaciones completadas */
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-success,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-success {
            color: #10B981 !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-warning,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-warning {
            color: #F59E0B !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-danger,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-danger {
            color: #EF4444 !important;
            font-weight: bold !important;
        }

        /* Estilos para tareas asignadas en modo noche */
        [data-theme="dark"] .task-item .task-title {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] .task-item .task-description {
            color: #2d3748 !important;
        }

        [data-theme="dark"] .task-item .text-muted,
        [data-theme="dark"] .task-item small {
            color: #4a5568 !important;
        }

        [data-theme="dark"] .task-badge {
            color: #1a1a1a !important;
            background: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid #4a5568 !important;
        }

        /* Estilos espec√≠ficos para badges de prioridad en modo noche */
        [data-theme="dark"] .task-badge.priority-high {
            background: #FED7D7 !important;
            color: #C53030 !important;
        }

        [data-theme="dark"] .task-badge.priority-medium {
            background: #FEEBC8 !important;
            color: #DD6B20 !important;
        }

        [data-theme="dark"] .task-badge.priority-low {
            background: #C6F6D5 !important;
            color: #38A169 !important;
        }

        /* Estilos para badges de estado en modo noche */
        [data-theme="dark"] .task-badge.status-pending {
            background: #BEE3F8 !important;
            color: #2B6CB0 !important;
        }

        [data-theme="dark"] .task-badge.status-in_progress {
            background: #FEEBC8 !important;
            color: #DD6B20 !important;
        }

        [data-theme="dark"] .task-badge.status-completed {
            background: #C6F6D5 !important;
            color: #38A169 !important;
        }

        /* Override espec√≠fico para contenedor de tareas */
        [data-theme="dark"] #tasksContainer .task-item h5,
        [data-theme="dark"] #tasksContainer .task-item .task-title {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #tasksContainer .task-item p,
        [data-theme="dark"] #tasksContainer .task-item .task-description {
            color: #2d3748 !important;
        }

        [data-theme="dark"] .dashboard-card h3 {
            color: var(--theme-text-primary) !important;
        }

        /* Corregir el problema espec√≠fico del card-header que fuerza texto blanco */
        [data-theme="dark"] .card-header,
        [data-theme="dark"] .card-header *,
        [data-theme="dark"] .card-header .text-muted,
        [data-theme="dark"] .card-header .text-secondary,
        [data-theme="dark"] .card-header small,
        [data-theme="dark"] .card-header span {
            color: #000000 !important;
        }

        /* Aplicar color negro oscuro y bold para h3 en card-header - M√ÅS ESPEC√çFICO */
        [data-theme="dark"] .dashboard-card .card-header h3,
        [data-theme="dark"] .card-header h3.mb-0 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Override final super espec√≠fico para el texto "Evaluaci√≥n de Asertividad" */
        [data-theme="dark"] #assessment .dashboard-card .card-header h3,
        [data-theme="dark"] .tab-pane .dashboard-card .card-header h3 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Excepciones para elementos que deben mantener su color */
        [data-theme="dark"] .btn,
        [data-theme="dark"] .badge,
        [data-theme="dark"] .progress-bar,
        [data-theme="dark"] .evaluation-score {
            color: inherit !important;
        }

        /* Formularios en tema nocturno */
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .form-select {
            background: rgba(51, 65, 85, 0.8) !important;
            border-color: rgba(59, 130, 246, 0.3) !important;
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .form-control:focus,
        [data-theme="dark"] .form-select:focus {
            background: rgba(51, 65, 85, 0.9) !important;
            border-color: #3B82F6 !important;
            color: var(--theme-text-primary) !important;
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25) !important;
        }

        [data-theme="dark"] .form-control::placeholder {
            color: var(--theme-text-muted) !important;
        }

        /* Badges en tema nocturno */
        [data-theme="dark"] .badge.bg-primary {
            background-color: #3B82F6 !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .badge.bg-success {
            background-color: #10B981 !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .badge.bg-warning {
            background-color: #F59E0B !important;
            color: #0F172A !important;
        }

        [data-theme="dark"] .badge.bg-danger {
            background-color: #EF4444 !important;
            color: #F8FAFC !important;
        }

        /* Progress bars en tema nocturno */
        [data-theme="dark"] .progress {
            background-color: rgba(30, 41, 59, 0.5) !important;
        }

        /* Tablas en tema nocturno */
        [data-theme="dark"] .table {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .table-striped > tbody > tr:nth-of-type(odd) > td {
            background-color: rgba(30, 41, 59, 0.3) !important;
        }

        /* Canvas/gr√°ficos en tema nocturno */
        [data-theme="dark"] canvas {
            filter: brightness(0.9) contrast(1.1);
        }

        /* Transiciones suaves */
        body,
        .glass-card,
        .card,
        .btn,
        .form-control,
        .form-select,
        .modal-content {
            transition: all 0.3s ease;
        }

        /* === MEJORAS COMPREHENSIVAS PARA MODO NOCHE === */
        
        /* Mejoras para t√≠tulos y encabezados en modo noche */
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6 {
            color: #F8FAFC !important;
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        /* Mejoras para texto general en modo noche */
        [data-theme="dark"] p,
        [data-theme="dark"] span,
        [data-theme="dark"] div,
        [data-theme="dark"] label {
            color: #E2E8F0 !important;
            text-shadow: none !important;
        }

        /* ============================================ */
        /* DROPDOWN PERFIL - ESTILOS ESPEC√çFICOS */
        /* ============================================ */
        /* Sobrescribir cualquier estilo global de enlaces en el dropdown del perfil */
        #feedProfileMenu a[href*="coachee-profile"] {
            color: #4b5563 !important; /* Gris oscuro para Mi Perfil */
            text-decoration: none !important;
            text-shadow: none !important;
            font-weight: 400 !important;
            line-height: 1.5 !important;
            border: none !important;
            outline: none !important;
        }

        #feedProfileMenu a[href*="coachee-profile"]:hover {
            background: #f3f4f6 !important;
            color: #4b5563 !important;
            text-decoration: none !important;
        }

        #feedProfileMenu button {
            font-weight: 400 !important;
            line-height: 1.5 !important;
            border: none !important;
            outline: none !important;
        }

        #feedProfileMenu button:nth-of-type(1) {
            color: #4b5563 !important; /* Gris oscuro para Cambiar Contrase√±a */
        }

        #feedProfileMenu button:nth-of-type(1):hover {
            background: #f3f4f6 !important;
            color: #4b5563 !important;
        }

        #feedProfileMenu button:nth-of-type(2) {
            color: #ef4444 !important; /* Rojo para Cerrar Sesi√≥n */
        }

        #feedProfileMenu button:nth-of-type(2):hover {
            background: #fef2f2 !important;
            color: #f59e0b !important;
        }

        [data-theme="dark"] #feedProfileMenu a[href*="coachee-profile"] {
            color: #10b981 !important;
            text-decoration: none !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] #feedProfileMenu a[href*="coachee-profile"]:hover {
            background: #374151 !important;
            color: #10b981 !important;
            text-decoration: none !important;
        }

        [data-theme="dark"] #feedProfileMenu button:nth-of-type(1) {
            color: #3b82f6 !important;
        }

        [data-theme="dark"] #feedProfileMenu button:nth-of-type(1):hover {
            background: #374151 !important;
            color: #3b82f6 !important;
        }

        [data-theme="dark"] #feedProfileMenu button:nth-of-type(2) {
            color: #f59e0b !important;
        }

        [data-theme="dark"] #feedProfileMenu button:nth-of-type(2):hover {
            background: #374151 !important;
            color: #f59e0b !important;
        }

        /* Mejoras para botones en modo noche */
        [data-theme="dark"] .btn {
            background: rgba(59, 130, 246, 0.9) !important;
            border: 1px solid rgba(59, 130, 246, 0.6) !important;
            color: #FFFFFF !important;
            text-shadow: none !important;
            backdrop-filter: none !important;
        }

        [data-theme="dark"] .btn:hover {
            background: rgba(59, 130, 246, 1) !important;
            border-color: rgba(59, 130, 246, 0.8) !important;
            color: #FFFFFF !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4) !important;
        }

        /* Mejoras para botones secundarios en modo noche */
        [data-theme="dark"] .btn-secondary {
            background: rgba(148, 163, 184, 0.6) !important;
            border-color: rgba(148, 163, 184, 0.4) !important;
            color: #FFFFFF !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.8) !important;
            color: #FFFFFF !important;
        }

        /* Estilos adicionales para cards y elementos espec√≠ficos */
        [data-theme="dark"] .card {
            background: var(--theme-bg-card) !important;
            border-color: rgba(59, 130, 246, 0.2) !important;
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .card-header {
            background: var(--theme-bg-card) !important;
            border-bottom-color: rgba(59, 130, 246, 0.2) !important;
        }

        [data-theme="dark"] .card-body {
            background: var(--theme-bg-card) !important;
        }

        [data-theme="dark"] .navbar {
            background: var(--theme-bg-primary) !important;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2) !important;
        }

        [data-theme="dark"] .navbar-brand {
            color: var(--theme-text-primary) !important;
        }

        /* Estilos finales globales */
        [data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, 
        [data-theme="dark"] h4, [data-theme="dark"] h5, [data-theme="dark"] h6,
        [data-theme="dark"] p, [data-theme="dark"] span, [data-theme="dark"] div {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .text-dark {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .bg-light, [data-theme="dark"] .bg-white {
            background: var(--theme-bg-card) !important;
        }

        [data-theme="dark"] .form-control:focus,
        [data-theme="dark"] .form-select:focus {
            background: rgba(30, 41, 59, 0.95) !important;
            border-color: #3B82F6 !important;
            box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.4) !important;
            color: #FFFFFF !important;
        }

        /* Mejoras para tablas en modo noche */
        [data-theme="dark"] .table {
            background: rgba(30, 41, 59, 0.6) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .table th {
            background: rgba(59, 130, 246, 0.2) !important;
            color: #F8FAFC !important;
            border-color: rgba(148, 163, 184, 0.3) !important;
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        [data-theme="dark"] .table td {
            border-color: rgba(148, 163, 184, 0.2) !important;
            color: #E2E8F0 !important;
        }

        /* Mejoras para badges en modo noche */
        [data-theme="dark"] .badge {
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        /* Mejoras para alerts en modo noche */
        [data-theme="dark"] .alert {
            background: rgba(30, 41, 59, 0.9) !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            color: #F8FAFC !important;
            backdrop-filter: none !important;
        }

        [data-theme="dark"] .alert-info {
            background: rgba(59, 130, 246, 0.2) !important;
            border-color: rgba(59, 130, 246, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-success {
            background: rgba(16, 185, 129, 0.2) !important;
            border-color: rgba(16, 185, 129, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-warning {
            background: rgba(245, 158, 11, 0.2) !important;
            border-color: rgba(245, 158, 11, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-danger {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: rgba(239, 68, 68, 0.4) !important;
            color: #F8FAFC !important;
        }

        /* Mejoras para dropdowns en modo noche */
        [data-theme="dark"] .dropdown-menu {
            background: rgba(30, 41, 59, 0.98) !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            backdrop-filter: none !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6) !important;
        }

        [data-theme="dark"] .dropdown-item {
            color: #E2E8F0 !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] .dropdown-item:hover {
            background: rgba(59, 130, 246, 0.3) !important;
            color: #F8FAFC !important;
        }

        /* Mejoras para scrollbars en modo noche */
        [data-theme="dark"] ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 4px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.6);
            border-radius: 4px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.8);
        }

        /* === ELIMINACI√ìN TOTAL DE EFECTOS BLUR EN MODO NOCHE === */
        
        /* Override general para eliminar todos los backdrop-filter y filter blur en modo noche */
        [data-theme="dark"] *,
        [data-theme="dark"] *::before,
        [data-theme="dark"] *::after {
            backdrop-filter: none !important;
        }
        
        /* Espec√≠ficamente para elementos que pueden tener blur */
        [data-theme="dark"] .glass-card,
        [data-theme="dark"] .card,
        [data-theme="dark"] .modal-content,
        [data-theme="dark"] .navbar,
        [data-theme="dark"] .btn,
        [data-theme="dark"] .alert,
        [data-theme="dark"] .dropdown-menu,
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .badge {
            backdrop-filter: none !important;
            filter: none !important;
        }
        
        /* Asegurar que el texto sea completamente n√≠tido */
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6,
        [data-theme="dark"] p,
        [data-theme="dark"] span,
        [data-theme="dark"] div,
        [data-theme="dark"] label,
        [data-theme="dark"] a,
        [data-theme="dark"] button {
            text-rendering: optimizeLegibility !important;
            -webkit-font-smoothing: antialiased !important;
            -moz-osx-font-smoothing: grayscale !important;
        }

        /* Estilos para presentaci√≥n compacta de recomendaciones */
        .compact-recommendations .card {
            transition: all 0.2s ease;
        }
        
        .compact-recommendations .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15) !important;
        }
        
        .compact-recommendations .card-header {
            border-bottom: 2px solid #007bff;
        }
        
        .compact-recommendations .fw-bold {
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .compact-recommendations small {
            font-size: 0.8rem;
            line-height: 1.3;
        }
        
        .compact-recommendations .text-primary {
            color: #007bff !important;
            border-bottom: 1px solid rgba(0, 123, 255, 0.2);
            padding-bottom: 2px;
            margin-bottom: 8px !important;
        }
        
        .compact-recommendations .ms-3 {
            padding-left: 1rem;
            border-left: 2px solid #e9ecef;
            margin-left: 0.5rem;
        }
        
        .compact-recommendations .badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }
        
        /* ========== OPTIMIZACI√ìN M√ìVIL PARA MODAL DE EVALUACI√ìN ========== */
        
        /* NOTA: Estilos del modal #evaluationDetailsModal ya definidos arriba en l√≠nea 4295 */
        
        #evaluationDetailsModal .modal-content {
            border-radius: 12px;
            border: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            /* Modal de evaluaci√≥n debajo del header en m√≥vil */
            #evaluationDetailsModal {
                position: fixed !important;
                top: 100px !important; /* Margen superior optimizado */
                left: 0 !important;
                width: 100vw !important;
                height: calc(100vh - 100px) !important; /* Ajustado al nuevo top */
                margin: 0 !important;
                padding: 0 !important;
                z-index: 1060 !important;
                overflow-y: auto !important;
            }
            
            #evaluationDetailsModal .modal-dialog {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 auto 65px auto !important;
                height: 100% !important;
                max-height: 100% !important;
            }
            
            #evaluationDetailsModal .modal-content {
                height: 100% !important;
                max-height: 100% !important;
                border-radius: 0 !important;
                border: none;
                display: flex;
                flex-direction: column;
            }
            
            #evaluationDetailsModal .modal-header {
                padding: 15px;
                border-bottom: 1px solid #dee2e6;
                flex-shrink: 0;
                position: relative;
                z-index: 1;
            }
            
            #evaluationDetailsModal .modal-body {
                padding: 15px;
                overflow-y: auto;
                flex: 1;
                -webkit-overflow-scrolling: touch;
            }
            
            #evaluationDetailsModal .modal-footer {
                padding: 15px 15px 60px 15px; /* Padding inferior aumentado para ver botones */
                border-top: 1px solid #dee2e6;
                flex-shrink: 0;
                margin-bottom: 20px; /* Margen adicional en el footer */
            }
            
            /* Ajustar elementos internos del modal para m√≥vil */
            #evaluationDetailsModal .modal-title {
                font-size: 1.1rem;
                line-height: 1.3;
            }
            
            #evaluationDetailsModal .btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            #evaluationDetailsModal .table-responsive {
                font-size: 13px;
            }
            
            #evaluationDetailsModal .chart-container {
                height: 250px !important;
            }
        }
        
        /* Para pantallas muy peque√±as (m√≥viles en horizontal o muy peque√±os) */
        @media (max-width: 576px) {
            #evaluationDetailsModal .modal-header {
                padding: 10px;
            }
            
            #evaluationDetailsModal .modal-body {
                padding: 10px;
            }
            
            #evaluationDetailsModal .modal-footer {
                padding: 10px;
            }
            
            #evaluationDetailsModal .modal-title {
                font-size: 1rem;
            }
            
            #evaluationDetailsModal .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
        }

        /* ========== MEJORAS RESPONSIVAS PARA SCHEDULE COACH MODULE ========== */
        @media (max-width: 768px) {
            /* Schedule Coach - Pesta√±as responsivas */
            #scheduleCoachTabs {
                flex-wrap: nowrap !important;
                overflow-x: auto !important;
                border-bottom: 1px solid #dee2e6 !important;
                scrollbar-width: none !important; /* Firefox */
                -ms-overflow-style: none !important; /* IE/Edge */
            }
            
            #scheduleCoachTabs::-webkit-scrollbar {
                display: none !important; /* Chrome/Safari */
            }
            
            #scheduleCoachTabs .nav-item {
                flex-shrink: 0 !important;
            }
            
            #scheduleCoachTabs .nav-link {
                white-space: nowrap !important;
                padding: 8px 12px !important;
                font-size: 0.85rem !important;
            }
            
            /* Schedule Coach - Layout responsivo */
            #schedule-coach .col-lg-8,
            #schedule-coach .col-lg-4 {
                margin-bottom: 1rem !important;
            }
            
            /* Formulario de solicitud - Stack vertical en mobile */
            #sessionRequestForm .row.g-3 .col-md-6 {
                margin-bottom: 1rem !important;
            }
            
            #sessionRequestForm .form-label {
                font-size: 0.9rem !important;
                margin-bottom: 0.25rem !important;
            }
            
            #sessionRequestForm .form-control,
            #sessionRequestForm .form-select {
                font-size: 0.9rem !important;
                padding: 0.5rem !important;
            }
            
            #sessionRequestForm .form-text {
                font-size: 0.75rem !important;
            }
            
            /* Informaci√≥n del coach m√°s compacta */
            #coachAvailabilityInfo {
                padding: 0.75rem !important;
            }
            
            #coachAvailabilityInfo .list-group-item {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.85rem !important;
            }
            
            /* Tips para agendar m√°s compactos */
            #schedule-coach .card .list-unstyled li {
                margin-bottom: 0.75rem !important;
                font-size: 0.85rem !important;
            }
            
            /* Lista de sesiones responsiva */
            #mySessionsList .card {
                margin-bottom: 0.75rem !important;
            }
            
            #mySessionsList .card-body {
                padding: 0.75rem !important;
            }
            
            #mySessionsList .card-title {
                font-size: 1rem !important;
            }
            
            #mySessionsList .card-text {
                font-size: 0.85rem !important;
            }
            
            /* Botones de sesi√≥n m√°s compactos */
            #mySessionsList .btn-group {
                flex-direction: column !important;
                width: 100% !important;
            }
            
            #mySessionsList .btn-group .btn {
                border-radius: 0.375rem !important;
                margin-bottom: 0.25rem !important;
                font-size: 0.8rem !important;
                padding: 0.375rem 0.75rem !important;
            }
        }

        @media (max-width: 576px) {
            /* Mobile espec√≠fico para schedule coach */
            #scheduleCoachTabs .nav-link {
                padding: 6px 8px !important;
                font-size: 0.8rem !important;
            }
            
            #scheduleCoachTabs .nav-link i {
                margin-right: 4px !important;
            }
            
            /* Ocultar texto en iconos en pantallas muy peque√±as */
            #scheduleCoachTabs .nav-link .d-none {
                display: none !important;
            }
            
            /* Formulario m√°s compacto */
            #sessionRequestForm .card-body {
                padding: 0.75rem !important;
            }
            
            #sessionRequestForm .btn {
                width: 100% !important;
                padding: 0.75rem !important;
                font-size: 0.9rem !important;
            }
            
            /* Cards de informaci√≥n m√°s peque√±as */
            #schedule-coach .card-header h6 {
                font-size: 0.9rem !important;
            }
            
            #schedule-coach .card-body {
                padding: 0.75rem !important;
            }
            
            /* Lista de sesiones en mobile */
            #mySessionsList .card-body {
                padding: 0.5rem !important;
            }
            
            #mySessionsList .badge {
                font-size: 0.7rem !important;
            }
            
            /* Botones de acci√≥n stack vertical */
            #my-sessions-pane .d-flex {
                flex-direction: column !important;
                gap: 0.5rem !important;
            }
            
            #my-sessions-pane .d-flex .btn {
                width: 100% !important;
            }
        }

        /* Tablet espec√≠fico para schedule coach */
        @media (min-width: 769px) and (max-width: 1024px) {
            #schedule-coach .col-lg-4 {
                margin-top: 1rem !important;
            }
            
            #scheduleCoachTabs .nav-link {
                padding: 10px 16px !important;
            }
            
            /* Formulario en 2 columnas en tablet */
            #sessionRequestForm .row.g-3 {
                margin: 0 -0.5rem !important;
            }
            
            #sessionRequestForm .col-md-6 {
                padding: 0 0.5rem !important;
            }
            
            /* Cards de informaci√≥n lado a lado en tablet */
            #schedule-coach .col-lg-4 .card {
                margin-bottom: 1rem !important;
            }
        }

        /* Mejoras adicionales para mejor UX en todos los dispositivos */
        #schedule-coach .nav-tabs .nav-link,
        #schedule-coach .nav-tabs .nav-link.active,
        #schedule-coach .nav-tabs .nav-link:hover,
        #schedule-coach .nav-tabs .nav-link:focus {
            background-color: #fff !important;
            border-color: #dee2e6 !important;
            color: #333 !important;
        }
        
        #schedule-coach .tab-content {
            border: 1px solid var(--theme-border, #dee2e6) !important;
            border-top: none !important;
            border-radius: 0 0 0.375rem 0.375rem !important;
            background-color: var(--theme-card-bg, #fff) !important;
            padding: 1rem !important;
        }
        
        @media (max-width: 768px) {
            #schedule-coach .tab-content {
                padding: 0.75rem !important;
            }
        }
        /* Document card styles */
        .document-card {
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
            height: 100%;
        }
        
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15) !important;
            border-color: #007bff;
        }
        
        .document-card .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #dee2e6;
            padding: 0.75rem;
            min-height: 60px;
            display: flex;
            align-items: center;
        }
        
        .document-card .card-body {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }
        
        .document-files .border {
            transition: all 0.2s ease;
            background-color: #f8f9fa;
        }
        
        .document-files .border:hover {
            background-color: #e3f2fd;
            border-color: #007bff !important;
        }
        
        /* Utility classes for better text handling */
        .min-width-0 {
            min-width: 0;
        }
        
        .flex-shrink-0 {
            flex-shrink: 0;
        }
        
        .text-truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        /* Document filters */
        #documentFilters {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #dee2e6;
        }
        
        /* Content tabs styling */
        #contentTabs .nav-link {
            color: #6c757d;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        #contentTabs .nav-link:hover {
            color: #007bff;
            border-bottom-color: #007bff;
        }
        
        #contentTabs .nav-link.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: none;
            font-weight: 600;
        }
        
        /* Dark theme support for document cards */
        [data-theme="dark"] .document-card {
            background: #2d3748;
            border-color: #4a5568;
        }
        
        [data-theme="dark"] .document-card:hover {
            border-color: #63b3ed;
            box-shadow: 0 4px 12px rgba(99, 179, 237, 0.15) !important;
        }
        
        [data-theme="dark"] .document-card .card-header {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            border-bottom-color: #4a5568;
        }
        
        [data-theme="dark"] .document-files .border {
            background-color: #374151;
            border-color: #4a5568;
        }
        
        [data-theme="dark"] .document-files .border:hover {
            background-color: #1e3a8a;
            border-color: #63b3ed !important;
        }
        
        [data-theme="dark"] .document-card .card-header {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border-bottom-color: #4a5568;
            color: #e2e8f0;
        }
        
        [data-theme="dark"] #documentFilters {
            background: #2d3748;
            border-color: #4a5568;
        }
        
        [data-theme="dark"] .document-files .border:hover {
            background-color: #4a5568;
            border-color: #63b3ed !important;
        }
        
        [data-theme="dark"] #contentTabs .nav-link {
            color: #a0aec0;
        }
        
        [data-theme="dark"] #contentTabs .nav-link:hover {
            color: #63b3ed;
            border-bottom-color: #63b3ed;
        }
        
        [data-theme="dark"] #contentTabs .nav-link.active {
            color: #63b3ed;
            border-bottom-color: #63b3ed;
        }
        
        /* Empty state styling for documents */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        [data-theme="dark"] .empty-state {
            color: #a0aec0;
        }
        
        /* ========== INSTAGRAM STYLE FEEDS ========== */
        .feeds-container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .instagram-post {
            background: white;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .post-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .post-author {
            display: flex;
            align-items: center;
        }
        
        .author-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            margin-right: 12px;
            position: relative;
            border: 2px solid transparent;
            transition: border-color 0.3s ease;
        }
        
        .author-avatar:hover {
            border-color: rgba(102, 126, 234, 0.2);
        }
        
        /* Badge de estado en avatar del coach */
        .author-avatar::after {
            content: '';
            position: absolute;
            bottom: -1px;
            right: -1px;
            width: 12px;
            height: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid white;
            border-radius: 50%;
        }
        
        .author-info h6 {
            margin: 0;
            font-weight: 600;
            font-size: 14px;
        }
        
        .author-info small {
            font-size: 12px;
            color: #8e8e8e;
        }
        
        .post-options {
            background: none;
            border: none;
            color: #8e8e8e;
            font-size: 16px;
            cursor: pointer;
        }
        
        .post-media {
            position: relative;
            width: 100%;
            background: #000;
        }

        .post-media .ratio {
            background: #000;
            border-radius: 0;
            max-height: 280px; /* Limitar altura m√°xima para que se vean los iconos */
        }

        .post-media .ratio-4x3 {
            max-height: 280px;
            overflow: hidden;
        }

        .post-media .ratio iframe {
            border-radius: 0;
            height: 280px;
            width: 100%;
            object-fit: cover;
        }
        
        .post-image {
            width: 100%;
            height: 280px; /* Misma altura que los videos */
            object-fit: cover;
            display: block;
        }
        
        .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .video-overlay:hover {
            background: rgba(0,0,0,0.9);
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .video-overlay i {
            color: white;
            font-size: 24px;
            margin-left: 3px;
        }
        
        .post-actions {
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 16px;
        }
        
        .action-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #262626;
            transition: color 0.2s ease;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            min-height: 40px;
        }

        .action-btn i {
            font-size: 24px !important;
            line-height: 1;
            font-family: "Font Awesome 6 Free" !important;
            font-weight: 400 !important;
            display: inline-block;
        }

        .action-btn i.fas {
            font-weight: 900 !important;
        }

        .action-btn small {
            margin-left: 4px;
            font-size: 10px;
            white-space: nowrap;
        }

        /* Asegurar que los iconos FontAwesome se vean */
        .post-actions .action-btn i:before {
            font-family: "Font Awesome 6 Free" !important;
        }
        
        .action-btn:hover {
            color: #8e8e8e;
        }
        
        .action-btn.liked {
            color: #ed4956;
        }
        
        .post-info {
            padding: 0 16px 16px;
        }
        
        .post-likes {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .post-caption {
            font-size: 14px;
            line-height: 1.4;
        }
        
        .post-caption .username {
            font-weight: 600;
            margin-right: 8px;
        }
        
        .post-time {
            color: #8e8e8e;
            font-size: 12px;
            margin-top: 8px;
        }
        
        /* Dark theme for Instagram posts */
        [data-theme="dark"] .instagram-post {
            background: #1a1a1a;
            border-color: #333;
        }
        
        [data-theme="dark"] .author-info h6,
        [data-theme="dark"] .action-btn,
        [data-theme="dark"] .post-likes,
        [data-theme="dark"] .post-caption {
            color: #ffffff;
        }
        
        [data-theme="dark"] .author-info small,
        [data-theme="dark"] .post-time {
            color: #8e8e8e;
        }
        
        [data-theme="dark"] .action-btn:hover {
            color: #dbdbdb;
        }
        
        /* Bottom Navigation - Estilo LinkedIn */
        /* Bottom Navigation - Modern Glassmorphism */
        .bottom-navigation {
            position: fixed !important;
            bottom: 0 !important;
            left: 0 !important;
            right: 0 !important;
            background: rgba(255, 255, 255, 0.8) !important;
            backdrop-filter: blur(16px) !important;
            -webkit-backdrop-filter: blur(16px) !important;
            border-top: 1px solid rgba(0, 0, 0, 0.08) !important;
            padding: 0 !important;
            z-index: 10500 !important;
            height: 72px !important;
            display: flex !important;
            justify-content: space-around !important;
            align-items: center !important;
            box-shadow: 
                0 -4px 6px -1px rgba(0, 0, 0, 0.05),
                0 -2px 4px -1px rgba(0, 0, 0, 0.03),
                0 -10px 15px -3px rgba(0, 0, 0, 0.05) !important;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
        }
        
        [data-theme="dark"] .bottom-navigation {
            background: rgba(31, 41, 55, 0.85) !important;
            border-top-color: rgba(255, 255, 255, 0.08) !important;
            box-shadow: 
                0 -4px 6px -1px rgba(0, 0, 0, 0.2),
                0 -2px 4px -1px rgba(0, 0, 0, 0.15),
                0 -10px 15px -3px rgba(0, 0, 0, 0.25) !important;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: #6B7280;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 8px 4px;
            cursor: pointer;
            position: relative;
            height: 100%;
            border: none;
            background: transparent;
        }
        
        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 3px;
            background: linear-gradient(135deg, #4F46E5, #7C3AED);
            border-radius: 0 0 3px 3px;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .nav-item.active::before {
            opacity: 1;
        }
        
        .nav-item:hover {
            color: #4F46E5;
            transform: translateY(-2px);
            background: rgba(79, 70, 229, 0.05);
        }
        
        .nav-item.active {
            color: #4F46E5;
            background: rgba(79, 70, 229, 0.08);
        }
        
        .nav-item i {
            font-size: 26px;
            margin-bottom: 4px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .nav-item:hover i {
            transform: scale(1.1);
        }
        
        .nav-item.active i {
            transform: scale(1.05);
        }
        
        .nav-item span {
            font-size: 11px;
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        
        /* Espacio inferior para evitar que el contenido quede debajo del nav */
        body {
            padding-bottom: 88px;
        }
        
        /* Tema oscuro para bottom navigation */
        [data-theme="dark"] .nav-item {
            color: #9CA3AF;
        }
        
        [data-theme="dark"] .nav-item:hover {
            color: #4F46E5;
            background: rgba(79, 70, 229, 0.1);
        }
        
        [data-theme="dark"] .nav-item.active {
            color: #4F46E5;
            background: rgba(79, 70, 229, 0.15);
        }

        /* ============================================
           üì± DASHBOARD DRAWER - Bottom Sheet Style
           ============================================ */
        
        .drawer-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: 10499;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .drawer-backdrop.show {
            opacity: 1;
            pointer-events: auto;
        }

        .dashboard-drawer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top-left-radius: 24px;
            border-top-right-radius: 24px;
            padding: 24px;
            z-index: 10500;
            transform: translateY(100%);
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 
                0 -10px 25px -5px rgba(0, 0, 0, 0.1),
                0 -4px 10px -3px rgba(0, 0, 0, 0.05);
            max-height: 60vh;
            overflow-y: auto;
        }
        
        .dashboard-drawer.show {
            transform: translateY(0);
        }
        
        [data-theme="dark"] .dashboard-drawer {
            background: rgba(31, 41, 55, 0.98);
            box-shadow: 
                0 -10px 25px -5px rgba(0, 0, 0, 0.3),
                0 -4px 10px -3px rgba(0, 0, 0, 0.2);
        }

        .drawer-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }

        [data-theme="dark"] .drawer-header {
            border-bottom-color: rgba(255, 255, 255, 0.08);
        }

        .drawer-header h3 {
            font-size: 18px;
            font-weight: 700;
            color: #111827;
            margin: 0;
        }

        [data-theme="dark"] .drawer-header h3 {
            color: #F9FAFB;
        }

        .drawer-close {
            background: rgba(0, 0, 0, 0.05);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .drawer-close:hover {
            background: rgba(0, 0, 0, 0.1);
            transform: scale(1.05);
        }

        [data-theme="dark"] .drawer-close {
            background: rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] .drawer-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .drawer-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .drawer-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px 12px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 16px;
            text-decoration: none;
            color: #374151;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .drawer-item:hover {
            background: rgba(79, 70, 229, 0.08);
            border-color: rgba(79, 70, 229, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] .drawer-item {
            background: rgba(255, 255, 255, 0.03);
            color: #D1D5DB;
            border-color: rgba(255, 255, 255, 0.05);
        }

        [data-theme="dark"] .drawer-item:hover {
            background: rgba(79, 70, 229, 0.15);
            border-color: rgba(79, 70, 229, 0.3);
        }
        
        .drawer-handle {
            width: 40px;
            height: 4px;
            background: #d1d5db;
            border-radius: 999px;
            margin: 0.75rem auto;
        }
        
        [data-theme="dark"] .drawer-handle {
            background: rgba(255, 255, 255, 0.2);
        }

        .drawer-item i {
            font-size: 28px;
            margin-bottom: 8px;
            color: #4F46E5;
        }

        .drawer-item span {
            font-size: 12px;
            font-weight: 600;
            text-align: center;
        }

        [data-theme="dark"] .drawer-divider {
            background: #334155;
        }
        
        /* Estilos para las tarjetas de contenido */
        .content-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .content-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.12) !important;
        }
        
        .content-card:active {
            transform: translateY(-2px);
        }
        
        /* ============================================
           üåô PREMIUM THEME TOGGLE - Animated Switch
           ============================================ */
        
        .theme-toggle-wrapper {
            display: flex;
            align-items: center;
        }
        
        .theme-toggle {
            position: relative;
            width: 60px;
            height: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 30px;
            cursor: pointer;
            transition: all var(--transition-slow) var(--ease-smooth);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .theme-toggle:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
            transform: translateY(-2px);
        }
        
        [data-theme="dark"] .theme-toggle {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        
        [data-theme="dark"] .theme-toggle:hover {
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.5);
        }
        
        .theme-toggle-slider {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 22px;
            height: 22px;
            background: white;
            border-radius: 50%;
            transition: transform var(--transition-slow) var(--ease-bounce),
                        background var(--transition-base) var(--ease-smooth);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        [data-theme="dark"] .theme-toggle-slider {
            transform: translateX(30px);
            background: #1e293b;
        }
        
        .theme-toggle-icon {
            font-size: 12px;
            color: #f59e0b;
            transition: all var(--transition-base) var(--ease-smooth);
        }
        
        [data-theme="dark"] .theme-toggle-icon {
            color: #60a5fa;
        }
        
        /* Premium Card Hover Effects */
        .card-hover-premium {
            transition: transform var(--transition-slow) var(--ease-smooth),
                        box-shadow var(--transition-slow) var(--ease-smooth);
        }
        
        .card-hover-premium:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: 0 20px 40px var(--theme-shadow-lg) !important;
        }
        
        /* Button Ripple Premium */
        .btn-ripple-premium {
            position: relative;
            overflow: hidden;
        }
        
        .btn-ripple-premium::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.6);
            transform: translate(-50%, -50%);
            transition: width var(--transition-slower) var(--ease-smooth),
                        height var(--transition-slower) var(--ease-smooth);
        }
        
        .btn-ripple-premium:active::before {
            width: 300px;
            height: 300px;
        }
        
        /* Fade In Up Animation */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-fadeInUp {
            animation: fadeInUp 0.6s var(--ease-smooth) forwards;
        }
        
        /* Bounce In Animation */
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                transform: scale(1);
            }
        }
        
        .animate-bounceIn {
            animation: bounceIn 0.6s var(--ease-bounce) forwards;
        }
        
        /* Shimmer Loading Effect */
        @keyframes shimmerPremium {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        
        .skeleton-premium {
            animation: shimmerPremium 2.5s infinite linear;
            background: linear-gradient(
                90deg,
                var(--theme-bg-tertiary) 0%,
                var(--theme-border) 20%,
                var(--theme-bg-tertiary) 40%,
                var(--theme-bg-tertiary) 100%
            );
            background-size: 1000px 100%;
            border-radius: 8px;
        }
        
        /* Pulse Glow Animation */
        @keyframes pulseGlow {
            0%, 100% {
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
            }
            50% {
                box-shadow: 0 0 0 10px rgba(102, 126, 234, 0);
            }
        }
        
        .animate-pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        /* ========================================
           üé® CORRECCI√ìN MODO D√çA - SECCI√ìN AGENDAR COACH
           ======================================== */
        
        /* Headers de cards con gradiente morado - Cambiar a fondo claro en modo d√≠a */
        [data-theme="light"] #schedule-coach .card-header {
            background: #f8f9fa !important;
            border-bottom: 2px solid #e5e7eb !important;
        }
        
        [data-theme="light"] #schedule-coach .card-header h6,
        [data-theme="light"] #schedule-coach .card-header .mb-0 {
            color: #111827 !important;
        }
        
        [data-theme="light"] #schedule-coach .card-header i {
            color: #667eea !important;
        }
        
        /* Modo oscuro mantiene el gradiente y texto blanco */
        [data-theme="dark"] #schedule-coach .card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        }
        
        [data-theme="dark"] #schedule-coach .card-header h6,
        [data-theme="dark"] #schedule-coach .card-header .mb-0 {
            color: #ffffff !important;
        }
        
        [data-theme="dark"] #schedule-coach .card-header i {
            color: #ffffff !important;
        }
        
        /* Fix para el logo InstaCoach en el header */
        header h1.gradient-purple-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
            color: transparent !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* Contenedor del logo sin background */
        header .flex.items-center.gap-2 {
            background: transparent !important;
        }
    </style>
</head>
<body x-data="coacheeDashboardApp()" x-init="init()" style="min-height: 100vh; background: #f8fafc;">
    
    <!-- Animated background particles -->
    <div class="particles">
        <div class="particle" style="width: 4px; height: 4px; left: 10%; animation-delay: 0s;"></div>
        <div class="particle" style="width: 6px; height: 6px; left: 20%; animation-delay: 2s;"></div>
        <div class="particle" style="width: 4px; height: 4px; left: 30%; animation-delay: 4s;"></div>
        <div class="particle" style="width: 5px; height: 5px; left: 40%; animation-delay: 1s;"></div>
        <div class="particle" style="width: 4px; height: 4px; left: 50%; animation-delay: 5s;"></div>
        <div class="particle" style="width: 6px; height: 6px; left: 60%; animation-delay: 3s;"></div>
        <div class="particle" style="width: 4px; height: 4px; left: 70%; animation-delay: 6s;"></div>
        <div class="particle" style="width: 5px; height: 5px; left: 80%; animation-delay: 2.5s;"></div>
        <div class="particle" style="width: 4px; height: 4px; left: 90%; animation-delay: 4.5s;"></div>
        <div class="particle" style="width: 6px; height: 6px; left: 15%; animation-delay: 1.5s;"></div>
        <div class="particle" style="width: 4px; height: 4px; left: 25%; animation-delay: 3.5s;"></div>
        <div class="particle" style="width: 5px; height: 5px; left: 35%; animation-delay: 5.5s;"></div>
        <div class="particle" style="width: 4px; height: 4px; left: 45%; animation-delay: 0.5s;"></div>
        <div class="particle" style="width: 6px; height: 6px; left: 55%; animation-delay: 2.2s;"></div>
        <div class="particle" style="width: 4px; height: 4px; left: 65%; animation-delay: 4.2s;"></div>
        <div class="particle" style="width: 5px; height: 5px; left: 75%; animation-delay: 1.2s;"></div>
        <div class="particle" style="width: 4px; height: 4px; left: 85%; animation-delay: 3.2s;"></div>
        <div class="particle" style="width: 6px; height: 6px; left: 95%; animation-delay: 5.2s;"></div>
    </div>
    
    <!-- Header -->
    <header style="position: sticky; top: 0; z-index: 50; width: 100%; background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-bottom: 1px solid #e5e7eb; border-top: none !important; border-left: none !important; border-right: none !important; margin: 0 !important;">
        <div style="display: flex; height: 4rem; align-items: center; justify-content: space-between; padding: 0 1.5rem; margin: 0 !important;">
            <!-- Logo -->
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <div style="display: inline-block; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; -webkit-background-clip: text !important; -webkit-text-fill-color: transparent !important; background-clip: text !important; border: none !important; outline: none !important; box-shadow: none !important;">
                    <h1 style="font-family: 'Pacifico', cursive; font-size: 1.875rem; font-weight: 400; margin: 0; padding: 0; color: transparent !important; background: transparent !important; border: none !important; outline: none !important; box-shadow: none !important;">InstaCoach</h1>
                </div>
            </div>

            <!-- Right Section -->
            <div style="display: flex; align-items: center; gap: 0.75rem;">
                <!-- Notifications -->
                <button style="position: relative; border-radius: 12px; padding: 0.5rem; border: none !important; outline: none !important; background: transparent; cursor: pointer; transition: background 0.2s; box-shadow: none !important;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">
                    <i class="fas fa-bell" style="color: #475569; font-size: 1.25rem; border: none !important; outline: none !important; text-decoration: none !important; background: transparent !important;"></i>
                    <span style="position: absolute; right: 0.25rem; top: 0.25rem; height: 0.5rem; width: 0.5rem; border-radius: 50%; background: #ef4444; border: 2px solid white;"></span>
                </button>

                <!-- Profile Dropdown -->
                <div style="position: relative;" id="feedProfileDropdown">
                    <button
                        onclick="toggleFeedDropdown(event)"
                        style="display: flex; align-items: center; gap: 0.5rem; border-radius: 12px; padding: 0.375rem 0.75rem 0.375rem 0.375rem; border: none !important; outline: none !important; background: transparent; cursor: pointer; transition: background 0.2s; box-shadow: none !important;"
                        onmouseover="this.style.background='#f3f4f6'"
                        onmouseout="this.style.background='transparent'"
                    >
                        <div id="headerAvatar" style="position: relative; width: 2.5rem; height: 2.5rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1rem; border: none !important; outline: none !important; overflow: hidden;">
                            <i class="fas fa-user" style="border: none !important; outline: none !important; text-decoration: none !important; background: transparent !important;"></i>
                        </div>
                        <span style="position: absolute; bottom: 0; right: 2.75rem; height: 0.625rem; width: 0.625rem; border-radius: 50%; background: #10b981; border: 2px solid white;"></span>
                        <i class="fas fa-chevron-down" style="color: #475569; font-size: 0.875rem; border: none !important; outline: none !important; text-decoration: none !important; background: transparent !important;"></i>
                    </button>

                    <div
                        id="feedProfileMenu"
                        style="display: none; position: absolute; right: 0; margin-top: 0.5rem; width: 14rem; border-radius: 16px; background: white; border: 1px solid #e2e8f0; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); overflow: hidden; z-index: 1000;"
                    >
                        <div style="padding: 1rem; border-bottom: 1px solid #e2e8f0;">
                            <p id="welcomeMessageFeed" style="font-size: 0.875rem; font-weight: 500; color: #111827; margin: 0;">Coachee</p>
                            <p style="font-size: 0.75rem; color: #6b7280; margin: 0.25rem 0 0 0;">Participante</p>
                        </div>
                        <div style="padding: 0.5rem;">
                            <a href="/coachee-profile?return=feed" style="display: flex; align-items: center; width: 100%; text-align: left; padding: 0.5rem 0.75rem; font-size: 0.875rem; color: #10b981; border-radius: 8px; text-decoration: none; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">
                                <i class="fas fa-user-circle" style="margin-right: 0.5rem; width: 1rem;"></i> Mi Perfil
                            </a>
                            <button onclick="openChangePasswordModalFeed(); document.getElementById('feedProfileMenu').style.display='none'" style="display: flex; align-items: center; width: 100%; text-align: left; padding: 0.5rem 0.75rem; font-size: 0.875rem; color: #3b82f6; background: transparent; border: none; border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">
                                <i class="fas fa-key" style="margin-right: 0.5rem; width: 1rem;"></i> Cambiar Contrase√±a
                            </button>
                            <button onclick="logout(); document.getElementById('feedProfileMenu').style.display='none'" style="display: flex; align-items: center; width: 100%; text-align: left; padding: 0.5rem 0.75rem; font-size: 0.875rem; color: #f59e0b; background: transparent; border: none; border-radius: 8px; cursor: pointer; transition: background 0.2s;" onmouseover="this.style.background='#f3f4f6'" onmouseout="this.style.background='transparent'">
                                <i class="fas fa-sign-out-alt" style="margin-right: 0.5rem; width: 1rem;"></i> Cerrar Sesi√≥n
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Layout Container - Figma Structure -->
    <div style="display: flex; width: 100%;">
            <!-- Sidebar Navigation - Modern Figma Design -->
        <!-- Sidebar Navigation - Figma Design -->
        <aside style="width: 16rem; border-right: 1px solid #e5e7eb; background: #f9fafb; height: calc(100vh - 4rem); position: sticky; top: 4rem;" class="sidebar-desktop" id="mainSidebar">
            <nav style="flex: 1; padding: 1rem; display: flex; flex-direction: column; gap: 0.25rem;">
                <a href="javascript:void(0)" 
                   class="sidebar-nav-item" 
                   :class="{ 'sidebar-nav-item-active': activeTab === 'overview' }"
                   @click.prevent="showTab('overview')" 
                   data-tab="overview">
                    <i class="fas fa-home"></i>
                    <span>Overview</span>
                </a>
                
                <a href="javascript:void(0)" 
                   class="sidebar-nav-item" 
                   :class="{ 'sidebar-nav-item-active': activeTab === 'evaluaciones-figma' }"
                   @click.prevent="showTab('evaluaciones-figma')" 
                   data-tab="evaluaciones-figma">
                    <i class="fas fa-chart-bar"></i>
                    <span>Evaluaciones</span>
                </a>
                        
                        <a href="javascript:void(0)" 
                           class="sidebar-nav-item" 
                           :class="{ 'sidebar-nav-item-active': activeTab === 'assessment' }"
                           id="assessment-sidebar-item" 
                           x-show="isAssessmentActive"
                           @click.prevent="showTab('assessment')" 
                           data-tab="assessment">
                            <i class="fas fa-play-circle"></i>
                            <span>Evaluaci√≥n Activa</span>
                        </a>
                        
                        <a href="javascript:void(0)" 
                           class="sidebar-nav-item" 
                           :class="{ 'sidebar-nav-item-active': activeTab === 'tasks' }"
                           @click.prevent="showTab('tasks')" 
                           data-tab="tasks">
                            <i class="fas fa-tasks"></i>
                            <span>Mis Acciones y Metas</span>
                        </a>
                        
                        <a href="javascript:void(0)" 
                           class="sidebar-nav-item" 
                           :class="{ 'sidebar-nav-item-active': activeTab === 'content' }"
                           @click.prevent="showTab('content')" 
                           data-tab="content">
                            <i class="fas fa-folder-open"></i>
                            <span>Mi Contenido</span>
                        </a>
                        
                        <a href="javascript:void(0)" 
                           class="sidebar-nav-item" 
                           :class="{ 'sidebar-nav-item-active': activeTab === 'progress' }"
                           @click.prevent="showTab('progress')" 
                           data-tab="progress">
                            <i class="fas fa-chart-line"></i>
                            <span>Mi Progreso</span>
                        </a>
                        
                        <a href="javascript:void(0)" 
                           class="sidebar-nav-item" 
                           :class="{ 'sidebar-nav-item-active': activeTab === 'development-plan' }"
                           @click.prevent="showTab('development-plan')" 
                           data-tab="development-plan">
                            <i class="fas fa-rocket"></i>
                            <span>Mi Plan de Desarrollo</span>
                        </a>
                        
                <a href="javascript:void(0)" 
                   class="sidebar-nav-item" 
                   :class="{ 'sidebar-nav-item-active': activeTab === 'schedule-coach' }"
                   @click.prevent="showTab('schedule-coach')" 
                   data-tab="schedule-coach">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Agendar Coach</span>
                </a>
            </nav>
        </aside>

        <!-- Main Content Area -->
        <main style="flex: 1; overflow-y: auto; height: calc(100vh - 4rem);">
            <div style="padding-bottom: 5rem;">
                <!-- Tab Content -->
                <div class="tab-content" id="mainTabContent" style="margin: 0 !important; padding: 0 !important;">
                
                <!-- Overview Tab - Gamification Design -->
                <div class="tab-pane" id="overview" role="tabpanel" style="display: none;">
                    <div class="section-overview" style="padding: 1.5rem; background: #f9fafb; min-height: 100vh;">
                        <!-- Header -->
                        <div style="margin-bottom: 1.5rem;">
                            <h1 style="font-size: 1.875rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-trophy" style="color: #f59e0b;"></i>
                                <span>¬°Welcome <span x-text="coacheeName"></span>!</span>
                            </h1>
                            <p style="color: #6b7280; font-size: 1rem;">
                                Motiva tu progreso con logros, puntos y rankings
                            </p>
                        </div>

                        <!-- üéÆ GAMIFICACI√ìN: Card "Tu Nivel" - ETAPA 3 -->
                        <div class="row g-4 mb-4">
                            <div class="col-12">
                                <div id="gamificationCard" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; border-radius: 1.25rem; padding: 2rem; box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden; min-height: 200px;">
                                    <!-- Background decoration -->
                                    <div style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(255,255,255,0.1); border-radius: 50%; filter: blur(40px);"></div>
                                    
                                    <!-- Loading State -->
                                    <div id="loadingState" style="text-align: center; padding: 2rem;">
                                        <i class="fas fa-spinner fa-spin" style="font-size: 2rem; color: white;"></i>
                                        <p style="color: white; margin-top: 1rem; opacity: 0.9;">Cargando tu progreso...</p>
                                    </div>

                                    <!-- Error/Welcome State -->
                                    <div id="errorState" style="display: none; text-align: center; padding: 2rem;">
                                        <i id="errorIcon" class="fas fa-rocket" style="font-size: 2.5rem; color: #fef3c7;"></i>
                                        <p id="errorMessage" style="color: white; margin-top: 1rem; font-weight: 600; font-size: 1.125rem;"></p>
                                        <p id="errorSubMessage" style="color: rgba(255,255,255,0.9); margin-top: 0.75rem; font-size: 0.9375rem; line-height: 1.5;"></p>
                                        <button id="errorActionBtn" onclick="showTab('tasks')" style="display: none; margin-top: 1rem; padding: 0.75rem 2rem; background: white; color: #667eea; border: none; border-radius: 12px; font-weight: 600; font-size: 0.9375rem; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.2)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)'">
                                            <i class="fas fa-tasks me-2"></i>Ver Acciones y Metas
                                        </button>
                                    </div>

                                    <!-- Content -->
                                    <div id="contentState" style="display: none;">
                                        <div class="row align-items-center">
                                            <!-- Level Icon & Info -->
                                            <div class="col-md-3 text-center mb-3 mb-md-0">
                                                <div style="position: relative; display: inline-block;">
                                                    <div style="width: 120px; height: 120px; border-radius: 50%; background: rgba(255,255,255,0.2) !important; display: flex !important; align-items: center !important; justify-content: center !important; backdrop-filter: blur(10px); border: 3px solid rgba(255,255,255,0.3); overflow: visible !important;">
                                                        <i id="levelIcon" class="fas fa-seedling" style="font-size: 3rem !important; color: white !important; display: inline-block !important; visibility: visible !important; opacity: 1 !important; line-height: 1 !important;"></i>
                                                    </div>
                                                    <div style="position: absolute; bottom: -10px; left: 50%; transform: translateX(-50%); background: white; border-radius: 20px; padding: 0.375rem 0.875rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15); font-weight: 600; font-size: 0.875rem; color: #667eea; white-space: nowrap;">
                                                        Nivel <span id="currentLevel">1</span>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- Level Details -->
                                            <div class="col-md-6 mb-3 mb-md-0">
                                                <h2 id="levelName" style="font-size: 1.75rem; font-weight: 700; color: white; margin: 0 0 0.5rem 0;">Novato</h2>
                                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
                                                    <span style="color: rgba(255,255,255,0.9); font-size: 1.125rem; font-weight: 500;">
                                                        <span id="totalPoints">0</span> puntos
                                                    </span>
                                                    <span style="color: rgba(255,255,255,0.7); font-size: 0.875rem;">‚Ä¢</span>
                                                    <span style="color: rgba(255,255,255,0.7); font-size: 0.875rem;">
                                                        <span id="pointsToNext">100</span> pts para <span id="nextLevelName">Aprendiz</span>
                                                    </span>
                                                </div>
                                                
                                                <!-- Progress Bar -->
                                                <div style="background: rgba(255,255,255,0.2); border-radius: 9999px; height: 12px; overflow: hidden; backdrop-filter: blur(10px);">
                                                    <div id="progressBar"
                                                        style="width: 0%; height: 100%; border-radius: 9999px; transition: width 0.6s ease;">
                                                    </div>
                                                </div>
                                                <p style="color: rgba(255,255,255,0.8); font-size: 0.75rem; margin-top: 0.5rem; margin-bottom: 0;">
                                                    <span id="progressText">0</span>% completado
                                                </p>
                                            </div>

                                            <!-- Stats -->
                                            <div class="col-md-3">
                                                <div style="background: rgba(255,255,255,0.15) !important; border-radius: 1rem; padding: 1.25rem; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2);">
                                                    <div style="text-align: center;">
                                                        <p style="color: rgba(255,255,255,0.8) !important; font-size: 0.875rem; margin: 0 0 0.5rem 0;">Siguiente Nivel</p>
                                                        <p id="nextLevelNameCard" style="color: white !important; font-size: 1.5rem; font-weight: 700; margin: 0;">Aprendiz</p>
                                                        <p style="color: rgba(255,255,255,0.7) !important; font-size: 0.75rem; margin: 0.5rem 0 0 0;">
                                                            <i class="fas fa-arrow-up" style="margin-right: 0.25rem; color: rgba(255,255,255,0.7) !important;"></i>
                                                            <span id="pointsToNextCard">100</span> puntos
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Stats Cards (ETAPA 9 - Gamificaci√≥n) -->
                        <div id="gamificationStatsCards" style="display: none; margin-bottom: 1.5rem;">
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 250px;">
                                    <div class="overview-stat-card" style="background: white !important; border-radius: 1.25rem; padding: 1.5rem; border: 1px solid #e5e7eb; transition: all 0.2s;">
                                        <div style="display: flex; align-items: center; gap: 1rem;">
                                            <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #facc15, #f59e0b) !important;">
                                                <i class="fas fa-star" style="font-size: 1.5rem; color: white !important;"></i>
                                            </div>
                                            <div>
                                                <p id="statTotalPoints" style="font-size: 2rem; font-weight: 600; color: #111827; margin: 0; line-height: 1;">0</p>
                                                <p style="font-size: 0.875rem; color: #6b7280; margin: 0; margin-top: 0.25rem;">Puntos Totales</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div style="flex: 1; min-width: 250px;">
                                    <div class="overview-stat-card" style="background: white !important; border-radius: 1.25rem; padding: 1.5rem; border: 1px solid #e5e7eb; transition: all 0.2s;">
                                        <div style="display: flex; align-items: center; gap: 1rem;">
                                            <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #a855f7, #ec4899) !important;">
                                                <i class="fas fa-award" style="font-size: 1.5rem; color: white !important;"></i>
                                            </div>
                                            <div>
                                                <p id="statTasksCompleted" style="font-size: 2rem; font-weight: 600; color: #111827; margin: 0; line-height: 1;">0</p>
                                                <p style="font-size: 0.875rem; color: #6b7280; margin: 0; margin-top: 0.25rem;">Tareas Completadas</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Achievements Section -->
                        <div>
                            <h2 style="font-size: 1.125rem; font-weight: 600; color: #111827; margin-bottom: 1rem;">
                                Logros y Badges
                            </h2>
                            <div class="row g-4">
                                <!-- Achievement 1: Primer Paso -->
                                <div class="col-12 col-md-6">
                                    <div class="achievement-card unlocked" style="background: white !important; border-radius: 1.25rem; padding: 1.5rem; border: 1px solid #e5e7eb; transition: all 0.3s;">
                                        <div style="display: flex; gap: 1rem;">
                                            <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #facc15, #f59e0b) !important; flex-shrink: 0;">
                                                <i class="fas fa-star" style="font-size: 1.5rem; color: white !important;"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <h3 style="font-size: 1rem; font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Primer Paso</h3>
                                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">Completa tu primera evaluaci√≥n</p>
                                                <div style="display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.25rem 0.75rem; border-radius: 9999px; background: #d1fae5 !important; color: #059669 !important; font-size: 0.75rem; font-weight: 500;">
                                                    <i class="fas fa-check-circle" style="font-size: 0.75rem;"></i>
                                                    Desbloqueado
                                                </div>
                                                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem; margin-bottom: 0;">Por Mar√≠a L√≥pez ‚Ä¢ 5 ene</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Achievement 2: Contenido Maestro -->
                                <div class="col-12 col-md-6">
                                    <div class="achievement-card unlocked" style="background: white !important; border-radius: 1.25rem; padding: 1.5rem; border: 1px solid #e5e7eb; transition: all 0.3s;">
                                        <div style="display: flex; gap: 1rem;">
                                            <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #3b82f6, #06b6d4) !important; flex-shrink: 0;">
                                                <i class="fas fa-trophy" style="font-size: 1.5rem; color: white !important;"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <h3 style="font-size: 1rem; font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Contenido Maestro</h3>
                                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">Consume 10 horas de contenido</p>
                                                <div style="display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.25rem 0.75rem; border-radius: 9999px; background: #d1fae5 !important; color: #059669 !important; font-size: 0.75rem; font-weight: 500;">
                                                    <i class="fas fa-check-circle" style="font-size: 0.75rem;"></i>
                                                    Desbloqueado
                                                </div>
                                                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem; margin-bottom: 0;">Por Coach ‚Ä¢ 10 ene</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Achievement 3: Racha de Fuego -->
                                <div class="col-12 col-md-6">
                                    <div class="achievement-card unlocked" style="background: white !important; border-radius: 1.25rem; padding: 1.5rem; border: 1px solid #e5e7eb; transition: all 0.3s;">
                                        <div style="display: flex; gap: 1rem;">
                                            <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #ef4444, #f97316) !important; flex-shrink: 0;">
                                                <i class="fas fa-fire" style="font-size: 1.5rem; color: white !important;"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <h3 style="font-size: 1rem; font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Racha de Fuego</h3>
                                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">7 d√≠as consecutivos de actividad</p>
                                                <div style="display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.25rem 0.75rem; border-radius: 9999px; background: #d1fae5 !important; color: #059669 !important; font-size: 0.75rem; font-weight: 500;">
                                                    <i class="fas fa-check-circle" style="font-size: 0.75rem;"></i>
                                                    Desbloqueado
                                                </div>
                                                <p style="font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem; margin-bottom: 0;">Por Mar√≠a L√≥pez ‚Ä¢ 12 ene</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Achievement 4: L√≠der del Mes -->
                                <div class="col-12 col-md-6">
                                    <div class="achievement-card locked" style="background: white !important; border-radius: 1.25rem; padding: 1.5rem; border: 1px solid #e5e7eb; opacity: 0.7; transition: all 0.3s;">
                                        <div style="display: flex; gap: 1rem;">
                                            <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #a855f7, #ec4899) !important; filter: grayscale(100%); flex-shrink: 0;">
                                                <i class="fas fa-crown" style="font-size: 1.5rem; color: white !important;"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <h3 style="font-size: 1rem; font-weight: 600; color: #111827; margin-bottom: 0.25rem;">L√≠der del Mes</h3>
                                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">Mayor progreso en evaluaciones</p>
                                                <div>
                                                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">
                                                        <span>Progreso</span>
                                                        <span>75%</span>
                                                    </div>
                                                    <div style="height: 0.5rem; background: #e5e7eb !important; border-radius: 9999px; overflow: hidden;">
                                                        <div style="height: 100%; width: 75%; background: linear-gradient(to right, #a855f7, #ec4899) !important; border-radius: 9999px; transition: width 0.3s;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Achievement 5: Objetivo Alcanzado -->
                                <div class="col-12 col-md-6">
                                    <div class="achievement-card locked" style="background: white !important; border-radius: 1.25rem; padding: 1.5rem; border: 1px solid #e5e7eb; opacity: 0.7; transition: all 0.3s;">
                                        <div style="display: flex; gap: 1rem;">
                                            <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #22c55e, #10b981) !important; filter: grayscale(100%); flex-shrink: 0;">
                                                <i class="fas fa-bullseye" style="font-size: 1.5rem; color: white !important;"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <h3 style="font-size: 1rem; font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Objetivo Alcanzado</h3>
                                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">Completa un plan de desarrollo</p>
                                                <div>
                                                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">
                                                        <span>Progreso</span>
                                                        <span>45%</span>
                                                    </div>
                                                    <div style="height: 0.5rem; background: #e5e7eb !important; border-radius: 9999px; overflow: hidden;">
                                                        <div style="height: 100%; width: 45%; background: linear-gradient(to right, #22c55e, #10b981) !important; border-radius: 9999px; transition: width 0.3s;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Achievement 6: Estudiante Dedicado -->
                                <div class="col-12 col-md-6">
                                    <div class="achievement-card locked" style="background: white !important; border-radius: 1.25rem; padding: 1.5rem; border: 1px solid #e5e7eb; opacity: 0.7; transition: all 0.3s;">
                                        <div style="display: flex; gap: 1rem;">
                                            <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #6366f1, #a855f7) !important; filter: grayscale(100%); flex-shrink: 0;">
                                                <i class="fas fa-bolt" style="font-size: 1.5rem; color: white !important;"></i>
                                            </div>
                                            <div style="flex: 1;">
                                                <h3 style="font-size: 1rem; font-weight: 600; color: #111827; margin-bottom: 0.25rem;">Estudiante Dedicado</h3>
                                                <p style="font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">Consume 20 horas de contenido</p>
                                                <div>
                                                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #6b7280; margin-bottom: 0.5rem;">
                                                        <span>Progreso</span>
                                                        <span>60%</span>
                                                    </div>
                                                    <div style="height: 0.5rem; background: #e5e7eb !important; border-radius: 9999px; overflow: hidden;">
                                                        <div style="height: 100%; width: 60%; background: linear-gradient(to right, #6366f1, #a855f7) !important; border-radius: 9999px; transition: width 0.3s;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <style>
                        .overview-stat-card {
                            cursor: pointer;
                        }
                        
                        .overview-stat-card:hover {
                            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                            transform: translateY(-2px);
                        }
                        
                        .achievement-card.unlocked:hover {
                            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
                            transform: translateY(-2px);
                        }
                        
                        .achievement-card.locked:hover {
                            opacity: 0.8;
                            transform: scale(1.02);
                        }
                    </style>
                </div>
                
                <!-- Nueva Secci√≥n: Evaluaciones (Figma Complete Design) -->
                <div class="tab-pane" id="evaluaciones-figma" role="tabpanel" style="display: none;">
                    <div style="padding: 1.5rem; background: #f9fafb; min-height: 100vh;">
                        <!-- Header -->
                        <div style="margin-bottom: 1.5rem;">
                            <h1 style="font-size: 1.875rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-chart-bar" style="color: #a855f7;"></i>
                                <span>Evaluaciones</span>
                            </h1>
                            <p style="color: #6b7280; font-size: 1rem;">
                                Explora tus evaluaciones completadas y pendientes con an√°lisis detallados
                            </p>
                        </div>
                            
                            <!-- 3 Tarjetas de Estad√≠sticas (Figma Style) -->
                            <div style="display: grid !important; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)) !important; gap: 1rem !important; margin-bottom: 1.5rem !important;">
                                <!-- Card 1: Completadas (üî• CLICKEABLE) -->
                                <div class="figma-stat-card figma-stat-card-completadas" onclick="toggleCompletadasSection(event)" style="background: white !important; padding: 1.5rem !important; border-radius: 1rem !important; border: 1px solid #e5e7eb !important; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1) !important; transition: all 0.3s !important; cursor: pointer !important;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                                        <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #10b981, #34d399) !important; flex-shrink: 0;">
                                            <i class="fas fa-check-circle" style="font-size: 1.5rem; color: white !important;"></i>
                                        </div>
                                        <div style="flex: 1;">
                                            <p style="font-size: 2rem !important; font-weight: 600 !important; margin: 0 !important; color: #111827 !important; line-height: 1;" id="figma-stats-completadas">-</p>
                                            <p style="font-size: 0.875rem !important; margin: 0 !important; color: #6b7280 !important;">Completadas</p>
                                        </div>
                                        <i class="fas fa-chevron-down" id="completadas-chevron" style="color: #9ca3af; transition: transform 0.3s;"></i>
                                    </div>
                                    <div style="width: 100% !important; height: 0.5rem !important; background: #e5e7eb !important; border-radius: 9999px !important; overflow: hidden !important;">
                                        <div id="figma-progress-completadas" style="width: 0% !important; height: 100% !important; background: linear-gradient(to right, #10b981, #34d399) !important; border-radius: 9999px !important; transition: width 0.6s ease !important;"></div>
                                    </div>
                                </div>
                                
                                <!-- Card 2: Pendientes (üî• CLICKEABLE) -->
                                <div class="figma-stat-card figma-stat-card-pendientes" onclick="togglePendientesSection(event)" style="background: white !important; padding: 1.5rem !important; border-radius: 1rem !important; border: 1px solid #e5e7eb !important; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1) !important; transition: all 0.3s !important; cursor: pointer !important;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                                        <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #f59e0b, #fbbf24) !important; flex-shrink: 0;">
                                            <i class="fas fa-clock" style="font-size: 1.5rem; color: white !important;"></i>
                                        </div>
                                        <div style="flex: 1;">
                                            <p style="font-size: 2rem !important; font-weight: 600 !important; margin: 0 !important; color: #111827 !important; line-height: 1;" id="figma-stats-pendientes">-</p>
                                            <p style="font-size: 0.875rem !important; margin: 0 !important; color: #6b7280 !important;">Pendientes</p>
                                        </div>
                                        <i class="fas fa-chevron-down" id="pendientes-chevron" style="color: #9ca3af; transition: transform 0.3s;"></i>
                                    </div>
                                    <div style="width: 100% !important; height: 0.5rem !important; background: #e5e7eb !important; border-radius: 9999px !important; overflow: hidden !important;">
                                        <div id="figma-progress-pendientes" style="width: 0% !important; height: 100% !important; background: linear-gradient(to right, #f59e0b, #fbbf24) !important; border-radius: 9999px !important; transition: width 0.6s ease !important;"></div>
                                    </div>
                                </div>
                                
                                <!-- Card 3: Tipos Disponibles (üî• CLICKEABLE) -->
                                <div class="figma-stat-card figma-stat-card-tipos" onclick="toggleDisponiblesSection(event)" style="background: white !important; padding: 1.5rem !important; border-radius: 1rem !important; border: 1px solid #e5e7eb !important; box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1) !important; transition: all 0.3s !important; cursor: pointer !important;">
                                    <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                                        <div style="padding: 1rem; border-radius: 1.25rem; background: linear-gradient(to bottom right, #a855f7, #ec4899) !important; flex-shrink: 0;">
                                            <i class="fas fa-chart-bar" style="font-size: 1.5rem; color: white !important;"></i>
                                        </div>
                                        <div style="flex: 1;">
                                            <p style="font-size: 2rem !important; font-weight: 600 !important; margin: 0 !important; color: #111827 !important; line-height: 1;" id="figma-stats-tipos">-</p>
                                            <p style="font-size: 0.875rem !important; margin: 0 !important; color: #6b7280 !important;">Tipos Disponibles</p>
                                        </div>
                                        <i class="fas fa-chevron-down" id="disponibles-chevron" style="color: #9ca3af; transition: transform 0.3s;"></i>
                                    </div>
                                    <div style="width: 100% !important; height: 0.5rem !important; background: #e5e7eb !important; border-radius: 9999px !important; overflow: hidden !important;">
                                        <div id="figma-progress-tipos" style="width: 100% !important; height: 100% !important; background: linear-gradient(to right, #a855f7, #ec4899) !important; border-radius: 9999px !important; transition: width 0.6s ease !important;"></div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- üî• Secci√≥n Expandible de Evaluaciones Completadas CON HISTORIAL -->
                            <div id="completadas-section" style="display: none; margin-bottom: 1.5rem; background: white; border-radius: 1rem; padding: 1.5rem; border: 1px solid #e5e7eb; animation: slideDown 0.3s ease;">
                                <h2 style="font-size: 1.25rem; font-weight: 600; color: #111827; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fas fa-history" style="color: #10b981;"></i>
                                    Historial de Evaluaciones por Categor√≠a
                                </h2>
                                
                                <!-- Contenedor de grupos de evaluaciones -->
                                <div id="figma-completadas-grouped" style="display: flex; flex-direction: column; gap: 1.5rem;">
                                    <!-- Se llenar√° din√°micamente con grupos por tipo de evaluaci√≥n -->
                                </div>
                            </div>
                            
                            <!-- üî• Secci√≥n Expandible de Evaluaciones Pendientes -->
                            <div id="pendientes-section" style="display: none; margin-bottom: 1.5rem; background: white; border-radius: 1rem; padding: 1.5rem; border: 1px solid #e5e7eb; animation: slideDown 0.3s ease;">
                                <h2 style="font-size: 1.25rem; font-weight: 600; color: #111827; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fas fa-clock" style="color: #f59e0b;"></i>
                                    Evaluaciones Pendientes (Sin Iniciar)
                                </h2>
                                <div id="figma-pendientes-lista" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
                                    <!-- Se llenar√° din√°micamente -->
                                </div>
                            </div>
                            
                            <!-- üî• Secci√≥n Expandible de Todos los Tipos Disponibles -->
                            <div id="disponibles-section" style="display: none; margin-bottom: 1.5rem; background: white; border-radius: 1rem; padding: 1.5rem; border: 1px solid #e5e7eb; animation: slideDown 0.3s ease;">
                                <h2 style="font-size: 1.25rem; font-weight: 600; color: #111827; margin: 0 0 1.5rem 0; display: flex; align-items: center; gap: 0.5rem;">
                                    <i class="fas fa-chart-bar" style="color: #a855f7;"></i>
                                    Todos los Tipos de Evaluaciones Disponibles
                                </h2>
                                <div id="figma-disponibles-lista" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
                                    <!-- Se llenar√° din√°micamente -->
                                </div>
                            </div>
                            
                            <!-- Animaci√≥n de slide down -->
                            <style>
                                @keyframes slideDown {
                                    from {
                                        opacity: 0;
                                        transform: translateY(-10px);
                                    }
                                    to {
                                        opacity: 1;
                                        transform: translateY(0);
                                    }
                                }
                                
                                @keyframes shimmer {
                                    0% {
                                        transform: translateX(-100%);
                                    }
                                    100% {
                                        transform: translateX(100%);
                                    }
                                }
                                
                                /* Estilos m√≥viles para Historial de Evaluaciones */
                                @media (max-width: 639px) {
                                    #completadas-section {
                                        border-radius: 0 !important;
                                        border-left: none !important;
                                        border-right: none !important;
                                        margin-left: -0.5rem !important;
                                        margin-right: -0.5rem !important;
                                        padding: 1rem !important;
                                    }
                                    
                                    #completadas-section h2 {
                                        font-size: 1rem !important;
                                        margin-bottom: 1rem !important;
                                        gap: 0.375rem !important;
                                    }
                                    
                                    #completadas-section h2 i {
                                        font-size: 0.9375rem !important;
                                    }
                                    
                                    #figma-completadas-grouped {
                                        gap: 1rem !important;
                                    }
                                    
                                    /* Headers de categor√≠a en m√≥vil */
                                    #figma-completadas-grouped > div {
                                        border-radius: 0.875rem !important;
                                        border-width: 2px !important;
                                    }
                                    
                                    #figma-completadas-grouped > div > div:first-child {
                                        padding: 1rem !important;
                                        gap: 0.75rem !important;
                                    }
                                    
                                    /* Icono de categor√≠a */
                                    #figma-completadas-grouped > div > div:first-child > div:first-child {
                                        width: 48px !important;
                                        height: 48px !important;
                                        border-radius: 0.875rem !important;
                                        font-size: 1.5rem !important;
                                    }
                                    
                                    /* T√≠tulo de categor√≠a */
                                    #figma-completadas-grouped h3 {
                                        font-size: 0.9375rem !important;
                                        margin-bottom: 0.5rem !important;
                                        line-height: 1.3 !important;
                                    }
                                    
                                    /* Badges de estad√≠sticas */
                                    #figma-completadas-grouped > div > div:first-child > div:nth-child(2) > div {
                                        gap: 0.5rem !important;
                                    }
                                    
                                    #figma-completadas-grouped > div > div:first-child > div:nth-child(2) > div span {
                                        padding: 0.25rem 0.5rem !important;
                                        font-size: 0.75rem !important;
                                        border-radius: 0.375rem !important;
                                    }
                                    
                                    /* Chevron */
                                    #figma-completadas-grouped > div > div:first-child > i {
                                        font-size: 1.125rem !important;
                                    }
                                    
                                    /* Contenedor de timeline */
                                    #figma-completadas-grouped > div > div:last-child {
                                        padding: 0 0.875rem 0.875rem 0.875rem !important;
                                        gap: 0.75rem !important;
                                    }
                                    
                                    /* Cards de intentos individuales */
                                    #figma-completadas-grouped > div > div:last-child > div {
                                        flex-direction: column !important;
                                        align-items: flex-start !important;
                                        gap: 0.875rem !important;
                                        padding: 0.875rem !important;
                                        border-radius: 0.75rem !important;
                                    }
                                    
                                    /* N√∫mero de intento */
                                    #figma-completadas-grouped > div > div:last-child > div > div:first-child {
                                        width: 44px !important;
                                        height: 44px !important;
                                        font-size: 1rem !important;
                                    }
                                    
                                    /* Contenedor de info del intento */
                                    #figma-completadas-grouped > div > div:last-child > div > div:nth-child(2) {
                                        width: 100% !important;
                                    }
                                    
                                    /* Badges y porcentaje */
                                    #figma-completadas-grouped > div > div:last-child > div > div:nth-child(2) > div:first-child {
                                        gap: 0.375rem !important;
                                        margin-bottom: 0.5rem !important;
                                    }
                                    
                                    #figma-completadas-grouped > div > div:last-child > div > div:nth-child(2) > div:first-child span:first-child {
                                        font-size: 1.25rem !important;
                                    }
                                    
                                    #figma-completadas-grouped > div > div:last-child > div > div:nth-child(2) > div:first-child span:not(:first-child) {
                                        padding: 0.25rem 0.5rem !important;
                                        font-size: 0.7rem !important;
                                    }
                                    
                                    /* Fecha y hora */
                                    #figma-completadas-grouped > div > div:last-child > div > div:nth-child(2) > div:nth-child(2) {
                                        font-size: 0.75rem !important;
                                        gap: 0.375rem !important;
                                        margin-bottom: 0.5rem !important;
                                        flex-wrap: wrap !important;
                                    }
                                    
                                    /* Progress bar */
                                    #figma-completadas-grouped > div > div:last-child > div > div:nth-child(2) > div:nth-child(3) {
                                        height: 0.5rem !important;
                                    }
                                    
                                    /* Bot√≥n ver detalles */
                                    #figma-completadas-grouped > div > div:last-child > div > button {
                                        width: 100% !important;
                                        padding: 0.625rem 1rem !important;
                                        font-size: 0.8125rem !important;
                                        border-radius: 0.625rem !important;
                                    }
                                }
                                
                                /* Para pantallas muy peque√±as */
                                @media (max-width: 390px) {
                                    #completadas-section {
                                        padding: 0.875rem !important;
                                    }
                                    
                                    #completadas-section h2 {
                                        font-size: 0.9375rem !important;
                                    }
                                    
                                    #figma-completadas-grouped > div > div:first-child {
                                        padding: 0.875rem !important;
                                    }
                                    
                                    #figma-completadas-grouped > div > div:first-child > div:first-child {
                                        width: 40px !important;
                                        height: 40px !important;
                                        font-size: 1.25rem !important;
                                    }
                                    
                                    #figma-completadas-grouped h3 {
                                        font-size: 0.875rem !important;
                                    }
                                    
                                    #figma-completadas-grouped > div > div:last-child > div > div:first-child {
                                        width: 40px !important;
                                        height: 40px !important;
                                        font-size: 0.9375rem !important;
                                    }
                                }
                                
                                @keyframes pulse {
                                    0%, 100% {
                                        opacity: 1;
                                        transform: scale(1);
                                    }
                                    50% {
                                        opacity: 0.7;
                                        transform: scale(1.1);
                                    }
                                }
                                
                                @media (min-width: 1024px) {
                                    #completadas-grid {
                                        grid-template-columns: 1.2fr 1fr !important;
                                    }
                                    #completadas-radar-container {
                                        display: block !important;
                                    }
                                }
                                
                                /* ========================================
                                   MOBILE OPTIMIZATION - ALL SECTIONS
                                   ======================================== */
                                
                                /* Tasks Section */
                                @media (max-width: 639px) {
                                    .section-tasks {
                                        padding: 1rem !important;
                                        margin-left: -0.5rem;
                                        margin-right: -0.5rem;
                                        border-left: none !important;
                                        border-right: none !important;
                                        border-radius: 0 !important;
                                    }
                                    
                                    .section-header-tasks {
                                        margin-bottom: 1rem !important;
                                    }
                                    
                                    .section-title-tasks {
                                        font-size: 1rem !important;
                                        gap: 0.5rem !important;
                                    }
                                    
                                    .section-title-tasks i {
                                        font-size: 1rem !important;
                                    }
                                    
                                    .section-subtitle-tasks {
                                        font-size: 0.875rem !important;
                                    }
                                    
                                    #tasksContainer .card {
                                        border-radius: 0.875rem !important;
                                        margin-bottom: 0.75rem !important;
                                    }
                                    
                                    #tasksContainer .card-body {
                                        padding: 1rem !important;
                                    }
                                    
                                    #tasksContainer h6 {
                                        font-size: 0.9375rem !important;
                                    }
                                    
                                    #tasksContainer .badge {
                                        font-size: 0.75rem !important;
                                        padding: 0.375rem 0.625rem !important;
                                    }
                                    
                                    #tasksContainer .btn {
                                        padding: 0.5rem 0.875rem !important;
                                        font-size: 0.875rem !important;
                                    }
                                }
                                
                                @media (max-width: 390px) {
                                    .section-tasks {
                                        padding: 0.875rem !important;
                                    }
                                    
                                    .section-title-tasks {
                                        font-size: 0.9375rem !important;
                                    }
                                    
                                    .section-subtitle-tasks {
                                        font-size: 0.8125rem !important;
                                    }
                                    
                                    #tasksContainer h6 {
                                        font-size: 0.875rem !important;
                                    }
                                }
                                
                                /* Content Section */
                                @media (max-width: 639px) {
                                    .section-content {
                                        padding: 1rem !important;
                                        margin-left: -0.5rem;
                                        margin-right: -0.5rem;
                                        border-left: none !important;
                                        border-right: none !important;
                                        border-radius: 0 !important;
                                    }
                                    
                                    #content .mb-3 {
                                        margin-bottom: 0.875rem !important;
                                    }
                                    
                                    #content .form-control {
                                        font-size: 0.875rem !important;
                                        padding: 0.5rem 2.25rem 0.5rem 2.25rem !important;
                                    }
                                    
                                    #content .btn {
                                        padding: 0.375rem 0.5rem !important;
                                        font-size: 0.75rem !important;
                                    }
                                    
                                    #content .btn span {
                                        display: inline !important;
                                    }
                                    
                                    #content .card {
                                        border-radius: 0.875rem !important;
                                    }
                                    
                                    #content .card-header {
                                        padding: 0.625rem 0.875rem !important;
                                    }
                                    
                                    #content .card-header h6 {
                                        font-size: 0.8125rem !important;
                                    }
                                    
                                    #content .card-footer {
                                        padding: 0.625rem 0.875rem !important;
                                    }
                                    
                                    #content .card-footer p {
                                        font-size: 0.6875rem !important;
                                    }
                                    
                                    #content .badge {
                                        font-size: 0.625rem !important;
                                        padding: 0.25rem 0.375rem !important;
                                    }
                                }
                                
                                @media (max-width: 390px) {
                                    .section-content {
                                        padding: 0.875rem !important;
                                    }
                                    
                                    #content .form-control {
                                        padding: 0.5rem 2rem 0.5rem 2rem !important;
                                    }
                                    
                                    #content .card-header h6 {
                                        font-size: 0.75rem !important;
                                    }
                                }
                                
                                /* Progress Section */
                                @media (max-width: 639px) {
                                    #progress > div {
                                        padding: 1rem !important;
                                        margin-left: -0.5rem;
                                        margin-right: -0.5rem;
                                        border-left: none !important;
                                        border-right: none !important;
                                        border-radius: 0 !important;
                                    }
                                    
                                    #progress h1 {
                                        font-size: 1rem !important;
                                        gap: 0.5rem !important;
                                        margin-bottom: 0.375rem !important;
                                    }
                                    
                                    #progress h1 i {
                                        font-size: 1rem !important;
                                    }
                                    
                                    #progress p {
                                        font-size: 0.875rem !important;
                                    }
                                    
                                    #progress .mb-3 {
                                        margin-bottom: 0.875rem !important;
                                        gap: 0.5rem !important;
                                    }
                                    
                                    #progress .mb-3 > div {
                                        min-width: 0 !important;
                                        flex: 1 1 100% !important;
                                    }
                                    
                                    #progress .progress-kpi-card,
                                    #progress .progress-kpi-card-success,
                                    #progress .progress-kpi-card-warning {
                                        padding: 0.75rem !important;
                                    }
                                    
                                    #progress .progress-kpi-card i,
                                    #progress .progress-kpi-card-success i,
                                    #progress .progress-kpi-card-warning i {
                                        font-size: 0.875rem !important;
                                    }
                                    
                                    #progress .progress-kpi-value {
                                        font-size: 1.25rem !important;
                                    }
                                    
                                    #alpineProgressChart {
                                        height: 280px !important;
                                    }
                                }
                                
                                @media (max-width: 390px) {
                                    #progress > div {
                                        padding: 0.875rem !important;
                                    }
                                    
                                    #progress h1 {
                                        font-size: 0.9375rem !important;
                                    }
                                    
                                    #progress p {
                                        font-size: 0.8125rem !important;
                                    }
                                    
                                    #progress .progress-kpi-card,
                                    #progress .progress-kpi-card-success,
                                    #progress .progress-kpi-card-warning {
                                        padding: 0.625rem !important;
                                    }
                                    
                                    #alpineProgressChart {
                                        height: 240px !important;
                                    }
                                }
                                
                                /* Development Plan Section */
                                @media (max-width: 639px) {
                                    #development-plan > div {
                                        padding: 1rem !important;
                                        margin-left: -0.5rem;
                                        margin-right: -0.5rem;
                                        border-left: none !important;
                                        border-right: none !important;
                                        border-radius: 0 !important;
                                    }
                                    
                                    #development-plan h1 {
                                        font-size: 1rem !important;
                                        gap: 0.5rem !important;
                                        margin-bottom: 0.375rem !important;
                                    }
                                    
                                    #development-plan h1 i {
                                        font-size: 1rem !important;
                                    }
                                    
                                    #development-plan p {
                                        font-size: 0.875rem !important;
                                    }
                                    
                                    #devPlanContent .card {
                                        border-radius: 0.875rem !important;
                                        margin-bottom: 0.75rem !important;
                                    }
                                    
                                    #devPlanContent .card-body {
                                        padding: 1rem !important;
                                    }
                                    
                                    #devPlanContent h5,
                                    #devPlanContent h6 {
                                        font-size: 0.9375rem !important;
                                    }
                                    
                                    #devPlanContent .badge {
                                        font-size: 0.75rem !important;
                                        padding: 0.375rem 0.625rem !important;
                                    }
                                    
                                    #devPlanContent .btn {
                                        padding: 0.5rem 0.875rem !important;
                                        font-size: 0.875rem !important;
                                    }
                                }
                                
                                @media (max-width: 390px) {
                                    #development-plan > div {
                                        padding: 0.875rem !important;
                                    }
                                    
                                    #development-plan h1 {
                                        font-size: 0.9375rem !important;
                                    }
                                    
                                    #development-plan p {
                                        font-size: 0.8125rem !important;
                                    }
                                    
                                    #devPlanContent h5,
                                    #devPlanContent h6 {
                                        font-size: 0.875rem !important;
                                    }
                                }
                                
                                /* Schedule Coach Section */
                                @media (max-width: 639px) {
                                    #schedule-coach > div {
                                        padding: 1rem !important;
                                        margin-left: -0.5rem;
                                        margin-right: -0.5rem;
                                        border-left: none !important;
                                        border-right: none !important;
                                        border-radius: 0 !important;
                                    }
                                    
                                    #schedule-coach h1 {
                                        font-size: 1rem !important;
                                        gap: 0.5rem !important;
                                        margin-bottom: 0.375rem !important;
                                    }
                                    
                                    #schedule-coach h1 i {
                                        font-size: 1rem !important;
                                    }
                                    
                                    #schedule-coach p {
                                        font-size: 0.875rem !important;
                                    }
                                    
                                    #scheduleCoachTabs {
                                        margin-bottom: 1rem !important;
                                        gap: 0.25rem;
                                    }
                                    
                                    #scheduleCoachTabs .nav-link {
                                        padding: 0.5rem 0.75rem !important;
                                        font-size: 0.875rem !important;
                                        border-radius: 0.5rem !important;
                                    }
                                    
                                    #scheduleCoachTabs .nav-link i {
                                        font-size: 0.75rem !important;
                                    }
                                    
                                    #scheduleCoachTabs .badge {
                                        font-size: 0.625rem !important;
                                        padding: 0.125rem 0.375rem !important;
                                    }
                                    
                                    #scheduleCoachTabContent .card {
                                        border-radius: 0.875rem !important;
                                        margin-bottom: 0.75rem !important;
                                    }
                                    
                                    #scheduleCoachTabContent .card-body {
                                        padding: 1rem !important;
                                    }
                                    
                                    #scheduleCoachTabContent h5,
                                    #scheduleCoachTabContent h6 {
                                        font-size: 0.9375rem !important;
                                    }
                                    
                                    #scheduleCoachTabContent .btn {
                                        padding: 0.5rem 0.875rem !important;
                                        font-size: 0.875rem !important;
                                    }
                                    
                                    #scheduleCoachTabContent .form-control,
                                    #scheduleCoachTabContent .form-select {
                                        font-size: 0.875rem !important;
                                        padding: 0.5rem 0.75rem !important;
                                    }
                                }
                                
                                @media (max-width: 390px) {
                                    #schedule-coach > div {
                                        padding: 0.875rem !important;
                                    }
                                    
                                    #schedule-coach h1 {
                                        font-size: 0.9375rem !important;
                                    }
                                    
                                    #schedule-coach p {
                                        font-size: 0.8125rem !important;
                                    }
                                    
                                    #scheduleCoachTabs .nav-link {
                                        padding: 0.375rem 0.625rem !important;
                                        font-size: 0.8125rem !important;
                                    }
                                    
                                    #scheduleCoachTabContent h5,
                                    #scheduleCoachTabContent h6 {
                                        font-size: 0.875rem !important;
                                    }
                                }
                                
                                /* Overview Section - Additional Mobile Optimizations */
                                @media (max-width: 639px) {
                                    .section-overview {
                                        padding: 1rem !important;
                                        margin-left: -0.5rem;
                                        margin-right: -0.5rem;
                                        border-left: none !important;
                                        border-right: none !important;
                                        border-radius: 0 !important;
                                    }
                                    
                                    #overview .stats-container .stat-card {
                                        padding: 0.875rem !important;
                                        border-radius: 0.875rem !important;
                                    }
                                    
                                    #overview .stats-container .stat-card h6 {
                                        font-size: 0.8125rem !important;
                                    }
                                    
                                    #overview .stats-container .stat-value {
                                        font-size: 1.25rem !important;
                                    }
                                    
                                    #overview .quick-actions .btn {
                                        padding: 0.625rem 0.875rem !important;
                                        font-size: 0.875rem !important;
                                    }
                                }
                                
                                @media (max-width: 390px) {
                                    .section-overview {
                                        padding: 0.875rem !important;
                                    }
                                    
                                    #overview .stats-container .stat-card {
                                        padding: 0.75rem !important;
                                    }
                                    
                                    #overview .stats-container .stat-card h6 {
                                        font-size: 0.75rem !important;
                                    }
                                    
                                    #overview .stats-container .stat-value {
                                        font-size: 1.125rem !important;
                                    }
                                }
                                
                                /* üì± MOBILE FIX: Prevenir scroll horizontal en Overview */
                                @media (max-width: 768px) {
                                    #overview {
                                        overflow-x: hidden !important;
                                        max-width: 100vw !important;
                                        width: 100% !important;
                                    }
                                    
                                    .section-overview {
                                        overflow-x: hidden !important;
                                        max-width: 100% !important;
                                        width: 100% !important;
                                        box-sizing: border-box !important;
                                    }
                                    
                                    #overview * {
                                        box-sizing: border-box !important;
                                    }
                                    
                                    #overview .row {
                                        margin-left: 0 !important;
                                        margin-right: 0 !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #overview .col-12,
                                    #overview .col-md-4,
                                    #overview .col-md-6 {
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #overview .overview-stat-card,
                                    #overview .achievement-card {
                                        max-width: 100% !important;
                                        overflow: hidden !important;
                                    }
                                }
                                
                                /* ============================================================================
                                   FIX MOBILE VIEWPORT: Secci√≥n Mis Acciones y Metas (#tasks)
                                   Previene scroll horizontal y desplazamiento de pantalla en m√≥viles
                                   ============================================================================ */
                                @media (max-width: 768px) {
                                    #tasks {
                                        overflow-x: hidden !important;
                                        max-width: 100vw !important;
                                        width: 100% !important;
                                    }
                                    
                                    .section-tasks {
                                        overflow-x: hidden !important;
                                        max-width: 100% !important;
                                        width: 100% !important;
                                        box-sizing: border-box !important;
                                    }
                                    
                                    #tasks * {
                                        box-sizing: border-box !important;
                                    }
                                    
                                    #tasks .row {
                                        margin-left: 0 !important;
                                        margin-right: 0 !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #tasks .col-12, .col-md-4, .col-md-6, .col-md-8 {
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #tasks .task-card,
                                    #tasks .task-item,
                                    #tasks .task-container {
                                        max-width: 100% !important;
                                        overflow: hidden !important;
                                    }
                                }
                                
                                /* ============================================================================
                                   FIX MOBILE VIEWPORT: Secci√≥n Evaluaciones (#evaluaciones-figma)
                                   Previene scroll horizontal y desplazamiento de pantalla en m√≥viles
                                   ============================================================================ */
                                @media (max-width: 768px) {
                                    /* üîß Contenedor principal */
                                    #evaluaciones-figma {
                                        overflow-x: hidden !important;
                                        max-width: 100vw !important;
                                        width: 100% !important;
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                    }
                                    
                                    /* üîß Todos los elementos internos */
                                    #evaluaciones-figma * {
                                        box-sizing: border-box !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    /* üîß Contenedor interno con padding */
                                    #evaluaciones-figma > div[style*="padding"] {
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                        overflow-x: hidden !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    /* üîß CR√çTICO: FORZAR TODOS LOS GRIDS A UNA COLUMNA */
                                    #evaluaciones-figma [style*="display: grid"],
                                    #evaluaciones-figma [style*="grid-template-columns"] {
                                        display: grid !important;
                                        grid-template-columns: 1fr !important;
                                        max-width: 100% !important;
                                        overflow-x: hidden !important;
                                        width: 100% !important;
                                    }
                                    
                                    /* üîß Control de flexbox */
                                    #evaluaciones-figma [style*="display: flex"] {
                                        max-width: 100% !important;
                                        overflow-x: hidden !important;
                                        flex-wrap: wrap !important;
                                        width: 100% !important;
                                    }
                                    
                                    /* üîß Bootstrap grid */
                                    #evaluaciones-figma .row {
                                        margin-left: 0 !important;
                                        margin-right: 0 !important;
                                        max-width: 100% !important;
                                        overflow-x: hidden !important;
                                    }
                                    
                                    #evaluaciones-figma .col-12,
                                    #evaluaciones-figma .col-md-4,
                                    #evaluaciones-figma .col-md-6,
                                    #evaluaciones-figma .col-md-8,
                                    #evaluaciones-figma [class*="col-"] {
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                        max-width: 100% !important;
                                        overflow-x: hidden !important;
                                    }
                                    
                                    /* üîß Tarjetas de estad√≠sticas */
                                    #evaluaciones-figma .figma-stat-card,
                                    #evaluaciones-figma .figma-stat-card * {
                                        max-width: 100% !important;
                                        min-width: 0 !important;
                                        overflow-x: hidden !important;
                                    }
                                    
                                    /* üîß Secciones expandibles */
                                    #evaluaciones-figma #completadas-section,
                                    #evaluaciones-figma #pendientes-section,
                                    #evaluaciones-figma #disponibles-section {
                                        max-width: 100% !important;
                                        overflow-x: hidden !important;
                                        margin-left: 0 !important;
                                        margin-right: 0 !important;
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                        border-radius: 0.5rem !important;
                                    }
                                    
                                    /* üîß CR√çTICO: Listas de evaluaciones */
                                    #evaluaciones-figma #figma-completadas-grouped,
                                    #evaluaciones-figma #figma-pendientes-lista,
                                    #evaluaciones-figma #figma-disponibles-lista {
                                        display: grid !important;
                                        grid-template-columns: 1fr !important;
                                        max-width: 100% !important;
                                        overflow-x: hidden !important;
                                        gap: 1rem !important;
                                        width: 100% !important;
                                    }
                                    
                                    /* üîß Elementos dentro de las listas */
                                    #evaluaciones-figma #figma-completadas-grouped > *,
                                    #evaluaciones-figma #figma-pendientes-lista > *,
                                    #evaluaciones-figma #figma-disponibles-lista > * {
                                        max-width: 100% !important;
                                        min-width: 0 !important;
                                        overflow-x: hidden !important;
                                        width: 100% !important;
                                    }
                                    
                                    /* üîß Tarjetas de evaluaci√≥n */
                                    #evaluaciones-figma .figma-eval-card,
                                    #evaluaciones-figma .card,
                                    #evaluaciones-figma .assessment-card {
                                        max-width: 100% !important;
                                        overflow-x: hidden !important;
                                        width: 100% !important;
                                    }
                                }
                                
                                /* ============================================================================
                                   FIX MOBILE VIEWPORT: Secci√≥n Contenido (#content)
                                   Previene scroll horizontal y desplazamiento de pantalla en m√≥viles
                                   ============================================================================ */
                                @media (max-width: 768px) {
                                    #content {
                                        overflow-x: hidden !important;
                                        max-width: 100vw !important;
                                        width: 100% !important;
                                    }
                                    
                                    #content * {
                                        box-sizing: border-box !important;
                                    }
                                    
                                    #content .row {
                                        margin-left: 0 !important;
                                        margin-right: 0 !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #content .col-12,
                                    #content .col-md-4,
                                    #content .col-md-6,
                                    #content .col-md-8 {
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #content .content-card,
                                    #content .card {
                                        max-width: 100% !important;
                                        overflow: hidden !important;
                                    }
                                    
                                    #content div[style*="display: grid"],
                                    #content div[style*="display: flex"] {
                                        max-width: 100% !important;
                                        overflow-x: hidden !important;
                                    }
                                }
                                
                                /* ============================================================================
                                   FIX MOBILE VIEWPORT: Secci√≥n Progreso (#progress)
                                   Previene scroll horizontal y desplazamiento de pantalla en m√≥viles
                                   ============================================================================ */
                                @media (max-width: 768px) {
                                    #progress {
                                        overflow-x: hidden !important;
                                        max-width: 100vw !important;
                                        width: 100% !important;
                                    }
                                    
                                    #progress * {
                                        box-sizing: border-box !important;
                                    }
                                    
                                    #progress .row {
                                        margin-left: 0 !important;
                                        margin-right: 0 !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #progress .col-12,
                                    #progress .col-md-4,
                                    #progress .col-md-6,
                                    #progress .col-md-8 {
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #progress .card,
                                    #progress .progress-card {
                                        max-width: 100% !important;
                                        overflow: hidden !important;
                                    }
                                    
                                    #progress div[style*="display: grid"],
                                    #progress div[style*="display: flex"] {
                                        max-width: 100% !important;
                                        overflow-x: hidden !important;
                                    }
                                }
                                
                                /* ============================================================================
                                   FIX MOBILE VIEWPORT: Secci√≥n Plan de Desarrollo (#development-plan)
                                   Previene scroll horizontal y desplazamiento de pantalla en m√≥viles
                                   ============================================================================ */
                                @media (max-width: 768px) {
                                    #development-plan {
                                        overflow-x: hidden !important;
                                        max-width: 100vw !important;
                                        width: 100% !important;
                                    }
                                    
                                    #development-plan * {
                                        box-sizing: border-box !important;
                                    }
                                    
                                    #development-plan .row {
                                        margin-left: 0 !important;
                                        margin-right: 0 !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #development-plan .col-12, .col-md-4, .col-md-6, .col-md-8 {
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #development-plan .card,
                                    #development-plan .plan-card {
                                        max-width: 100% !important;
                                        overflow: hidden !important;
                                    }
                                }
                                
                                /* ============================================================================
                                   FIX MOBILE VIEWPORT: Secci√≥n Agendar Sesi√≥n (#schedule-coach)
                                   Previene scroll horizontal y desplazamiento de pantalla en m√≥viles
                                   ============================================================================ */
                                @media (max-width: 768px) {
                                    #schedule-coach {
                                        overflow-x: hidden !important;
                                        max-width: 100vw !important;
                                        width: 100% !important;
                                    }
                                    
                                    #schedule-coach * {
                                        box-sizing: border-box !important;
                                    }
                                    
                                    #schedule-coach .row {
                                        margin-left: 0 !important;
                                        margin-right: 0 !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #schedule-coach .col-12, .col-md-4, .col-md-6, .col-md-8 {
                                        padding-left: 0.75rem !important;
                                        padding-right: 0.75rem !important;
                                        max-width: 100% !important;
                                    }
                                    
                                    #schedule-coach .card,
                                    #schedule-coach .schedule-card {
                                        max-width: 100% !important;
                                        overflow: hidden !important;
                                    }
                                }
                            </style>
                            
                            <!-- Layout de 2 Columnas (Figma Complete) -->
                            <div style="display: grid; grid-template-columns: 1fr; gap: 1.5rem;" id="figma-main-grid">
                            </div>
                            
                            <!-- Estilos CSS para Secci√≥n Figma -->
                            <style>
                                /* Estilos para tarjetas de stats con fondo blanco */
                                .figma-stat-card {
                                    cursor: default !important;
                                }
                                
                                .figma-stat-card:hover {
                                    transform: translateY(-2px) !important;
                                    box-shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.15) !important;
                                }
                                
                                /* Forzar color blanco en iconos de tarjetas de stats - M√°xima especificidad */
                                .figma-stat-card div[style*="gradient"] i.fas,
                                .figma-stat-card div[style*="gradient"] i.fa,
                                .figma-stat-card i.fas,
                                .figma-stat-card i.fa,
                                .figma-stat-card .fa-check-circle,
                                .figma-stat-card .fa-clock,
                                .figma-stat-card .fa-chart-bar {
                                    color: white !important;
                                    opacity: 1 !important;
                                }
                                
                                /* Estilos para las tarjetas de evaluaciones */
                                .figma-eval-card {
                                    background: white !important;
                                    border: 1px solid #e5e7eb !important;
                                    border-radius: 1rem !important;
                                    padding: 1.5rem !important;
                                    transition: all 0.3s ease !important;
                                    cursor: pointer !important;
                                }
                                
                                .figma-eval-card:hover {
                                    box-shadow: 0 10px 20px -5px rgba(0, 0, 0, 0.1) !important;
                                    transform: translateY(-2px) !important;
                                }
                                
                                /* Botones con gradientes */
                                .figma-btn-gradient {
                                    border: none !important;
                                    padding: 0.625rem 1.5rem !important;
                                    border-radius: 0.5rem !important;
                                    font-size: 0.875rem !important;
                                    font-weight: 600 !important;
                                    cursor: pointer !important;
                                    transition: all 0.3s ease !important;
                                    color: white !important;
                                }
                                
                                .figma-btn-gradient:hover {
                                    transform: scale(1.05) !important;
                                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
                                }
                                
                                /* Responsive */
                                @media (min-width: 1280px) {
                                    #figma-main-grid {
                                        grid-template-columns: 1.5fr 1fr !important;
                                    }
                                    #figma-panel-derecho {
                                        display: block !important;
                                    }
                                }
                            </style>
                        </div>
                    </div>
                </div>
                
                <!-- Evaluations Tab - Unified with Internal Tabs -->
                <!-- Assessment Tab (Hidden by default) -->
                <div class="tab-pane fade" id="assessment" role="tabpanel" style="display: none;">
                    <div class="dashboard-card" style="margin: 0 !important; padding: 0;">
                        <div class="card-header">
                            <h3>
                                <i class="fas fa-clipboard-check me-2"></i>
                                Evaluaci√≥n de Asertividad
                            </h3>
                            <div class="progress mt-3">
                                <div class="progress-bar" role="progressbar" id="assessmentProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="card-body" id="assessmentContainer">
                            <div id="questionContainer">
                                <!-- Questions will be loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Assessment Results Modal -->
                    <div class="modal fade" id="assessmentResultsModal" tabindex="-1" aria-labelledby="assessmentResultsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <div class="modal-header modal-header-dark">
                                    <h5 class="modal-title" id="assessmentResultsModalLabel">
                                        <i class="fas fa-check-circle me-2"></i>
                                        ¬°Evaluaci√≥n Completada!
                                    </h5>
                                    <div class="d-flex align-items-center justify-content-end gap-2">
                                        <button type="button" class="btn btn-outline-light btn-sm" onclick="printEvaluationReport()" title="Imprimir Reporte">
                                            <i class="fas fa-print me-1"></i>
                                            Imprimir
                                        </button>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                </div>
                                <div class="modal-body" id="assessmentResultsContent">
                                    <div class="assessment-completion-section text-center mb-4">
                                        <div class="assessment-score-display" id="assessmentScore">0%</div>
                                        <h3 class="assessment-level-display" id="assessmentLevel">Nivel de Asertividad</h3>
                                    </div>
                                    <div id="assessmentInterpretation">
                                        <!-- Results interpretation will be loaded here -->
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" onclick="finishAssessment()">
                                        <i class="fas fa-check me-2"></i>
                                        Finalizar y Volver
                                    </button>
                                    <button type="button" class="btn btn-primary-custom" onclick="viewDetailedResults()">
                                        <i class="fas fa-chart-radar me-2"></i>
                                        Ver An√°lisis Completo
                                    </button>
                                    <button type="button" class="btn btn-progress" onclick="printEvaluationReport()">
                                        <i class="fas fa-print me-2"></i>
                                        Imprimir Reporte
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tasks Tab -->
                <div class="tab-pane" id="tasks" role="tabpanel" style="display: none;">
                    <div class="section-tasks" style="padding: 1.5rem; background: #f9fafb; min-height: 100vh;">
                        <!-- Header -->
                        <div class="section-header-tasks" style="margin-bottom: 1.5rem;">
                            <h1 class="section-title-tasks" style="font-size: 1.875rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-bullseye" style="color: #10b981;"></i>
                                <span>Mis Acciones y Metas</span>
                            </h1>
                            <p class="section-subtitle-tasks" style="color: #6b7280; font-size: 1rem;">
                                Gestiona tus tareas y objetivos de desarrollo personal
                            </p>
                        </div>
                        
                        <div id="tasksContainer">
                            <div class="text-center py-4">
                                <div class="spinner-border spinner-border-sm text-primary" role="status">
                                    <span class="visually-hidden">Cargando...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Tab -->
                <div class="tab-pane" id="content" role="tabpanel" style="display: none;">
                    <div class="section-content" style="padding: 1.5rem; background: #f9fafb; min-height: 100vh;">
                        <!-- Header -->
                        <div style="margin-bottom: 1.5rem;">
                            <h1 style="font-size: 1.875rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-folder-open" style="color: #3b82f6;"></i>
                                <span>Mi Contenido</span>
                            </h1>
                            <p style="color: #6b7280; font-size: 1rem;">
                                Accede a recursos y materiales de apoyo para tu desarrollo
                            </p>
                        </div>
                        
                        <!-- Buscador -->
                        <div class="mb-3">
                            <div class="position-relative">
                                <input type="text" 
                                    x-model="contentSearch" 
                                    class="form-control form-control-sm" 
                                    placeholder="Buscar por t√≠tulo o descripci√≥n..."
                                    style="border-radius: 8px; padding: 0.625rem 2.5rem 0.625rem 2.5rem; font-size: 0.875rem; border: 2px solid #e5e7eb;">
                                <i class="fas fa-search" style="position: absolute; left: 0.875rem; top: 50%; transform: translateY(-50%); color: #9ca3af; font-size: 0.875rem;"></i>
                                <button x-show="contentSearch.length > 0" 
                                    @click="contentSearch = ''"
                                    class="btn btn-sm" 
                                    style="position: absolute; right: 0.5rem; top: 50%; transform: translateY(-50%); padding: 0.25rem 0.5rem; border: none; background: transparent;">
                                    <i class="fas fa-times" style="color: #9ca3af; font-size: 0.875rem;"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Filtros por categor√≠a -->
                        <div class="d-flex gap-1 flex-wrap">
                            <button @click="contentFilter = 'all'" 
                                :class="contentFilter === 'all' ? 'btn-primary' : 'btn-outline-secondary'"
                                class="btn btn-sm" style="border-radius: 8px; font-weight: 500; padding: 0.375rem 0.625rem; font-size: 0.75rem;">
                                <i class="fas fa-th-large" style="font-size: 0.75rem;"></i>
                                <span class="d-none d-sm-inline ms-1">Todos</span>
                            </button>
                            <button @click="contentFilter = 'video'" 
                                :class="contentFilter === 'video' ? 'btn-primary' : 'btn-outline-secondary'"
                                class="btn btn-sm" style="border-radius: 8px; font-weight: 500; padding: 0.375rem 0.625rem; font-size: 0.75rem;">
                                <i class="fas fa-video" style="font-size: 0.75rem;"></i>
                                <span class="d-none d-sm-inline ms-1">Videos</span>
                            </button>
                            <button @click="contentFilter = 'document'" 
                                :class="contentFilter === 'document' ? 'btn-primary' : 'btn-outline-secondary'"
                                class="btn btn-sm" style="border-radius: 8px; font-weight: 500; padding: 0.375rem 0.625rem; font-size: 0.75rem;">
                                <i class="fas fa-file-pdf" style="font-size: 0.75rem;"></i>
                                <span class="d-none d-sm-inline ms-1">Docs</span>
                            </button>
                        </div>
                        
                        <!-- Grid de Cards con Vista Previa -->
                        <div class="row g-2 g-md-3">
                                    <!-- Loading -->
                                    <div x-show="isLoadingVideos" class="col-12">
                                        <div class="text-center py-5">
                                            <div class="spinner-border text-primary" role="status">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="text-muted mt-2" style="font-size: 0.875rem;">Cargando contenido...</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Empty state -->
                                    <div x-show="!isLoadingVideos && filteredContent.length === 0" class="col-12">
                                        <div class="text-center py-5">
                                            <i class="fas fa-folder-open" style="font-size: 3rem; color: #d1d5db; margin-bottom: 1rem;"></i>
                                            <h6 style="color: #6b7280; font-weight: 600;">No hay contenido disponible</h6>
                                            <p style="color: #9ca3af; font-size: 0.875rem;" x-show="contentFilter !== 'all'">Intenta cambiar el filtro para ver m√°s contenido</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Cards de Contenido -->
                                    <template x-for="item in filteredContent" :key="item.id">
                                        <div class="col-12 col-md-6 col-lg-4">
                                            <div class="card" style="background: #ffffff; border-radius: 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); border: none; overflow: hidden; transition: transform 0.2s, box-shadow 0.2s;"
                                                 onmouseover="this.style.transform='translateY(-4px)'; this.style.boxShadow='0 4px 12px rgba(0, 0, 0, 0.1)'"
                                                 onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 1px 3px rgba(0, 0, 0, 0.05)'">
                                                
                                                <!-- Header con t√≠tulo y badge -->
                                                <div class="card-header d-flex justify-content-between align-items-start gap-2" 
                                                     style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 0.75rem 1rem;">
                                                    <div style="flex: 1; min-width: 0;">
                                                        <h6 class="mb-0" style="font-weight: 600; font-size: 0.875rem; line-height: 1.3; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;" x-text="item.title"></h6>
                                                    </div>
                                                    <div>
                                                        <template x-if="!item.is_viewed">
                                                            <span class="badge bg-danger" style="font-size: 0.625rem; padding: 0.25rem 0.5rem;">NUEVO</span>
                                                        </template>
                                                        <template x-if="item.is_viewed">
                                                            <span class="badge bg-success" style="font-size: 0.625rem; padding: 0.25rem 0.5rem;">
                                                                <i class="fas fa-check" style="font-size: 0.5rem;"></i> VISTO
                                                            </span>
                                                        </template>
                                                    </div>
                                                </div>
                                                
                                                <!-- Vista Previa de Video -->
                                                <template x-if="item.type === 'video' && item.video_platform === 'youtube' && item.video_id">
                                                    <div class="card-body" style="padding: 0;">
                                                        <div style="position: relative; width: 100%; padding-top: 56.25%; background: #000;">
                                                            <iframe :src="`https://www.youtube.com/embed/${item.video_id}`"
                                                                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
                                                                    frameborder="0"
                                                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                                                    allowfullscreen>
                                                            </iframe>
                                                        </div>
                                                    </div>
                                                </template>
                                                
                                                <!-- Vista Previa de Instagram -->
                                                <template x-if="item.type === 'video' && item.video_platform === 'instagram' && item.video_id">
                                                    <div class="card-body" style="padding: 0;">
                                                        <div style="position: relative; width: 100%; padding-top: 125%; background: #000;">
                                                            <iframe :src="`https://www.instagram.com/p/${item.video_id}/embed`"
                                                                    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;"
                                                                    frameborder="0"
                                                                    scrolling="no"
                                                                    allowtransparency="true">
                                                            </iframe>
                                                        </div>
                                                    </div>
                                                </template>
                                                
                                                <!-- Vista Previa de Documento -->
                                                <div class="card-body" style="padding: 0;" x-show="item.type === 'document' && item.file_path">
                                                    <div style="position: relative; width: 100%; height: 300px; background: #f3f4f6; overflow: hidden;">
                                                        <embed :src="item.file_path + '?t=' + Date.now() + '#view=FitH'" 
                                                               type="application/pdf"
                                                               style="width: 100%; height: 100%; border: none;">
                                                    </div>
                                                </div>
                                                
                                                <!-- Mensaje de error si no hay contenido -->
                                                <template x-if="(item.type === 'video' && !item.video_id) || (item.type === 'document' && !item.file_path)">
                                                    <div class="card-body text-center" style="padding: 2rem 1rem;">
                                                        <i class="fas fa-exclamation-circle mb-2" style="color: #f59e0b; font-size: 2rem;"></i>
                                                        <p style="font-size: 0.75rem; color: #6b7280; margin: 0;">No se pudo cargar el contenido</p>
                                                    </div>
                                                </template>
                                                
                                                <!-- Footer con descripci√≥n y fecha -->
                                                <div class="card-footer" style="background: #f9fafb; border-top: 1px solid #e5e7eb; padding: 0.75rem 1rem;">
                                                    <template x-if="item.description">
                                                        <p class="mb-2 text-muted" style="font-size: 0.75rem; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;" x-text="item.description"></p>
                                                    </template>
                                                    <div class="d-flex justify-content-between align-items-center">
                                                        <div class="text-muted" style="font-size: 0.6875rem;">
                                                            <i class="far fa-calendar me-1" style="font-size: 0.625rem;"></i>
                                                            <span x-text="formatDate(item.created_at)"></span>
                                                        </div>
                                                        <div>
                                                            <template x-if="item.type === 'video'">
                                                                <span class="badge bg-primary" style="font-size: 0.625rem; padding: 0.25rem 0.5rem;">
                                                                    <i class="fas fa-video" style="font-size: 0.5rem;"></i> Video
                                                                </span>
                                                            </template>
                                                            <template x-if="item.type === 'document'">
                                                                <span class="badge bg-secondary" style="font-size: 0.625rem; padding: 0.25rem 0.5rem;">
                                                                    <i class="fas fa-file-pdf" style="font-size: 0.5rem;"></i> Doc
                                                                </span>
                                                            </template>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </template>
                                    </div>
                    </div>
                </div>

                <!-- Progress Tab -->
                <div class="tab-pane" id="progress" role="tabpanel" style="display: none;">
                    <div style="padding: 1.5rem; background: #f9fafb; min-height: 100vh;">
                        <!-- Header -->
                        <div style="margin-bottom: 1.5rem;">
                            <h1 style="font-size: 1.875rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-chart-line" style="color: #f59e0b;"></i>
                                <span>Mi Progreso</span>
                            </h1>
                            <p style="color: #6b7280; font-size: 1rem;">
                                Visualiza tu evoluci√≥n y logros alcanzados
                            </p>
                        </div>
                        
                        <!-- Alpine Loading Spinner -->
                        <div class="text-center py-5" 
                                        x-show="isLoadingProgress" 
                                        x-transition:enter="transition ease-out duration-150"
                                        x-transition:enter-start="opacity-0"
                                        x-transition:enter-end="opacity-100"
                                        x-transition:leave="transition ease-in duration-150"
                                        x-transition:leave-start="opacity-100"
                                        x-transition:leave-end="opacity-0"
                                        x-cloak>
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                        <p class="text-muted small mt-3 mb-0">Cargando datos de progreso...</p>
                                    </div>
                                    
                                    <!-- Alpine Empty State -->
                                    <div class="text-center py-5" 
                                        x-show="!isLoadingProgress && (!allAssessmentHistory || Object.keys(allAssessmentHistory || {}).length === 0)"
                                        x-cloak>
                                        <i class="fas fa-chart-line text-muted mb-3" style="font-size: 3rem;"></i>
                                        <h5 class="text-muted">Sin evaluaciones registradas</h5>
                                        <p class="text-muted small">Completa evaluaciones para ver tu progreso aqu√≠</p>
                                    </div>
                                    
                                    <!-- Alpine Statistics - Movidas arriba del gr√°fico -->
                                    <div class="mb-3 d-flex gap-2 flex-wrap" 
                                        x-show="!isLoadingProgress && allAssessmentHistory && Object.keys(allAssessmentHistory || {}).length > 0"
                                        x-transition:enter="transition ease-out duration-300"
                                        x-transition:enter-start="opacity-0 transform translate-y-4"
                                        x-transition:enter-end="opacity-100 transform translate-y-0"
                                        x-cloak
                                        style="transition: all 0.3s ease;">
                                        <div style="flex: 1; min-width: 200px;">
                                            <div class="text-center p-2 rounded-3 progress-kpi-card">
                                                <i class="fas fa-chart-bar text-primary mb-1" style="font-size: 1rem;"></i>
                                                <div class="text-muted" style="font-size: 0.7rem; font-weight: 600;">Total Evaluaciones</div>
                                                <div class="fs-5 fw-bold progress-kpi-value text-primary" x-text="progressStatistics.totalEvaluations || 0"></div>
                                            </div>
                                        </div>
                                        <div style="flex: 1; min-width: 200px;">
                                            <div class="text-center p-2 rounded-3 progress-kpi-card-success">
                                                <i class="fas fa-chart-line text-success mb-1" style="font-size: 1rem;"></i>
                                                <div class="text-muted" style="font-size: 0.7rem; font-weight: 600;">Promedio General</div>
                                                <div class="fs-5 fw-bold progress-kpi-value text-success" x-text="`${(progressStatistics.averageScore || 0).toFixed(1)}%`"></div>
                                            </div>
                                        </div>
                                        <div style="flex: 1; min-width: 200px;">
                                            <div class="text-center p-2 rounded-3 progress-kpi-card-warning">
                                                <i class="fas fa-trophy text-warning mb-1" style="font-size: 1rem;"></i>
                                                <div class="text-muted" style="font-size: 0.7rem; font-weight: 600;">Mejor Score</div>
                                                <div class="fs-5 fw-bold progress-kpi-value text-warning" x-text="`${(progressStatistics.bestScore || 0).toFixed(1)}%`"></div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Alpine Chart Container -->
                                    <div x-show="!isLoadingProgress && allAssessmentHistory && Object.keys(allAssessmentHistory || {}).length > 0"
                                        x-transition:enter="transition ease-out duration-300 delay-75"
                                        x-transition:enter-start="opacity-0 transform translate-y-4"
                                        x-transition:enter-end="opacity-100 transform translate-y-0"
                                        x-cloak
                                        style="position: relative; height: 350px; transition: all 0.3s ease;">
                                        <canvas id="alpineProgressChart"></canvas>
                                    </div>
                    </div>
                </div>

                <!-- Development Plan Tab -->
                <div class="tab-pane" id="development-plan" role="tabpanel" style="display: none;">
                    <div style="padding: 1.5rem; background: #f9fafb; min-height: 100vh;">
                        <!-- Header -->
                        <div style="margin-bottom: 1.5rem;">
                            <h1 style="font-size: 1.875rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-rocket" style="color: #ec4899;"></i>
                                <span>Mi Plan de Desarrollo</span>
                            </h1>
                            <p style="color: #6b7280; font-size: 1rem;">
                                Planifica y da seguimiento a tu crecimiento profesional
                            </p>
                        </div>
                        
                        <!-- Loading -->
                        <div id="devPlanLoading" 
                                        x-show="isLoadingPlans"
                                        class="text-center py-3">
                                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                    </div>
                                    
                                    <!-- No Plan Message -->
                                    <div id="devPlanEmpty" 
                                        x-show="!isLoadingPlans && developmentPlans.length === 0">
                                        <div class="text-center py-3">
                                            <i class="fas fa-rocket" style="font-size: 2rem; color: #e2e8f0; margin-bottom: 0.75rem;"></i>
                                            <h6 class="inline-text-light" style="font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem">A√∫n no tienes un Plan de Desarrollo</h6>
                                            <p style="color: #94a3b8; margin: 0; font-size: 0.8rem;">Tu coach crear√° un plan personalizado para ti.</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Development Plans Grid -->
                                    <div id="devPlanContent" 
                                        x-show="!isLoadingPlans && developmentPlans.length > 0">
                                        <!-- Plans will be rendered here in grid format -->
                                    </div>
                    </div>
                </div>

                <!-- Schedule Coach Tab -->
                <div class="tab-pane" id="schedule-coach" role="tabpanel" style="display: none;">
                    <div style="padding: 1.5rem; background: #f9fafb; min-height: 100vh;">
                        <!-- Header -->
                        <div style="margin-bottom: 1.5rem;">
                            <h1 style="font-size: 1.875rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.75rem;">
                                <i class="fas fa-calendar-alt" style="color: #8b5cf6;"></i>
                                <span>Agendar Coach</span>
                            </h1>
                            <p style="color: #6b7280; font-size: 1rem;">
                                Programa tus sesiones de coaching personalizadas
                            </p>
                        </div>
                        
                        <!-- Pesta√±as modernas y compactas para m√≥vil -->
                        <ul class="nav nav-tabs mb-4" id="scheduleCoachTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" 
                                            @click="switchScheduleTab('request')"
                                            id="schedule-request-tab" type="button" role="tab"
                                            style="background: #fff !important; color: #333 !important; border-color: #dee2e6 !important;">
                                            <i class="fas fa-plus me-2" style="color: #333 !important;"></i>
                                            <span style="color: #333 !important;">Solicitar</span>
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link position-relative" 
                                            @click="switchScheduleTab('sessions')"
                                            id="my-sessions-tab" type="button" role="tab"
                                            style="background: #fff !important; color: #333 !important; border-color: #dee2e6 !important;">
                                            <i class="fas fa-calendar me-2" style="color: #333 !important;"></i>
                                            <span style="color: #333 !important;">Mis Sesiones</span>
                                            <span class="badge rounded-pill ms-1" 
                                                style="background: #333 !important; color: #fff !important;"
                                                x-show="mySessions.length > 0"
                                                x-text="mySessions.length"
                                                id="mySessionsCount"></span>
                                        </button>
                                    </li>
                                </ul>                                    <!-- Contenido de las pesta√±as -->
                                    <div class="tab-content" id="scheduleCoachTabContent">
                                        
                                        <!-- Pesta√±a: Solicitar Sesi√≥n -->
                                        <div class="tab-pane fade" 
                                            :class="{ 'show active': scheduleTab === 'request' }"
                                            id="schedule-request-pane" role="tabpanel" 
                                            aria-labelledby="schedule-request-tab" tabindex="0">
                                            <div class="d-flex gap-3 flex-wrap">
                                                <div style="flex: 1; min-width: 300px;">
                                                    <div class="card" style="border-radius: 12px; border: 1px solid #e5e7eb; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                                        <div class="card-body session-card-body" style="padding: 1rem;">
                                                            <h6 class="mb-3" style="font-size: 1.1375rem; font-weight: 600; color: #111827;">
                                                                <i class="fas fa-calendar-plus me-2" style="color: #10b981; font-size: 1.1375rem;"></i>
                                                                Nueva Solicitud de Sesi√≥n
                                                            </h6>
                                                            <form id="sessionRequestForm">
                                                                <div class="row g-3">
                                                                    <div class="col-12">
                                                                        <label for="sessionDate" class="form-label" style="font-size: 0.875rem; font-weight: 600; color: #1f2937; margin-bottom: 0.375rem;">Fecha Preferida</label>
                                                                        <input type="date" class="form-control" id="sessionDate" required 
                                                                            style="border-radius: 8px; border: 1px solid #d1d5db; padding: 0.625rem 0.75rem; font-size: 0.9375rem;">
                                                                    </div>
                                                                    <div class="col-6">
                                                                        <label for="sessionStartTime" class="form-label" style="font-size: 0.875rem; font-weight: 600; color: #1f2937; margin-bottom: 0.375rem;">Hora Inicio</label>
                                                                        <select class="form-select time-select-24h" id="sessionStartTime" required
                                                                            style="border-radius: 8px; border: 1px solid #d1d5db; padding: 0.625rem 0.75rem; font-size: 0.9375rem;">
                                                                            <option value="">Seleccionar</option>
                                                                            <option value="08:00">08:00</option>
                                                                            <option value="08:30">08:30</option>
                                                                            <option value="09:00">09:00</option>
                                                                            <option value="09:30">09:30</option>
                                                                            <option value="10:00" selected>10:00</option>
                                                                            <option value="10:30">10:30</option>
                                                                            <option value="11:00">11:00</option>
                                                                            <option value="11:30">11:30</option>
                                                                            <option value="12:00">12:00</option>
                                                                            <option value="12:30">12:30</option>
                                                                            <option value="13:00">13:00</option>
                                                                            <option value="13:30">13:30</option>
                                                                            <option value="14:00">14:00</option>
                                                                            <option value="14:30">14:30</option>
                                                                            <option value="15:00">15:00</option>
                                                                            <option value="15:30">15:30</option>
                                                                            <option value="16:00">16:00</option>
                                                                            <option value="16:30">16:30</option>
                                                                            <option value="17:00">17:00</option>
                                                                            <option value="17:30">17:30</option>
                                                                            <option value="18:00">18:00</option>
                                                                            <option value="18:30">18:30</option>
                                                                            <option value="19:00">19:00</option>
                                                                            <option value="19:30">19:30</option>
                                                                            <option value="20:00">20:00</option>
                                                                        </select>
                                                                        <div class="form-text" style="font-size: 0.75rem; color: #4b5563; font-weight: 500;">08:00 - 20:00</div>
                                                                    </div>
                                                                    <div class="col-6">
                                                                        <label for="sessionEndTime" class="form-label" style="font-size: 0.875rem; font-weight: 600; color: #1f2937; margin-bottom: 0.375rem;">Hora Fin</label>
                                                                        <select class="form-select time-select-24h" id="sessionEndTime" required
                                                                            style="border-radius: 8px; border: 1px solid #d1d5db; padding: 0.625rem 0.75rem; font-size: 0.9375rem;">
                                                                            <option value="">Seleccionar</option>
                                                                            <option value="08:30">08:30</option>
                                                                            <option value="09:00">09:00</option>
                                                                            <option value="09:30">09:30</option>
                                                                            <option value="10:00">10:00</option>
                                                                            <option value="10:30">10:30</option>
                                                                            <option value="11:00" selected>11:00</option>
                                                                            <option value="11:30">11:30</option>
                                                                            <option value="12:00">12:00</option>
                                                                            <option value="12:30">12:30</option>
                                                                            <option value="13:00">13:00</option>
                                                                            <option value="13:30">13:30</option>
                                                                            <option value="14:00">14:00</option>
                                                                            <option value="14:30">14:30</option>
                                                                            <option value="15:00">15:00</option>
                                                                            <option value="15:30">15:30</option>
                                                                            <option value="16:00">16:00</option>
                                                                            <option value="16:30">16:30</option>
                                                                            <option value="17:00">17:00</option>
                                                                            <option value="17:30">17:30</option>
                                                                            <option value="18:00">18:00</option>
                                                                            <option value="18:30">18:30</option>
                                                                            <option value="19:00">19:00</option>
                                                                            <option value="19:30">19:30</option>
                                                                            <option value="20:00">20:00</option>
                                                                            <option value="20:30">20:30</option>
                                                                        </select>
                                                                        <div class="form-text" style="font-size: 0.75rem; color: #4b5563; font-weight: 500;">08:30 - 20:30</div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <label for="sessionTitle" class="form-label" style="font-size: 0.875rem; font-weight: 600; color: #1f2937; margin-bottom: 0.375rem;">T√≠tulo de la Sesi√≥n</label>
                                                                        <input type="text" class="form-control" id="sessionTitle" 
                                                                            placeholder="Ej: Sesi√≥n de desarrollo personal" value="Sesi√≥n de Coaching"
                                                                            style="border-radius: 8px; border: 1px solid #d1d5db; padding: 0.625rem 0.75rem; font-size: 0.9375rem;">
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <label for="sessionDescription" class="form-label" style="font-size: 0.875rem; font-weight: 600; color: #1f2937; margin-bottom: 0.375rem;">Descripci√≥n (opcional)</label>
                                                                        <textarea class="form-control" id="sessionDescription" rows="3" 
                                                                            placeholder="Describe brevemente el tema que te gustar√≠a trabajar..."
                                                                            style="border-radius: 8px; border: 1px solid #d1d5db; padding: 0.625rem 0.75rem; font-size: 0.9375rem;"></textarea>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <label for="sessionLocation" class="form-label" style="font-size: 0.875rem; font-weight: 600; color: #1f2937; margin-bottom: 0.375rem;">Modalidad Preferida</label>
                                                                        <select class="form-select" id="sessionLocation"
                                                                            style="border-radius: 8px; border: 1px solid #d1d5db; padding: 0.625rem 0.75rem; font-size: 0.9375rem;">
                                                                            <option value="Virtual - Zoom">Virtual - Zoom</option>
                                                                            <option value="Virtual - Teams">Virtual - Teams</option>
                                                                            <option value="Virtual - Meet">Virtual - Google Meet</option>
                                                                            <option value="Presencial">Presencial</option>
                                                                            <option value="Por definir">Por definir</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <button type="submit" class="btn btn-primary w-100 w-sm-auto" 
                                                                            style="border-radius: 8px; padding: 0.625rem 1.5rem; font-weight: 500; font-size: 0.9375rem;">
                                                                            <i class="fas fa-paper-plane me-2"></i>Enviar Solicitud
                                                                        </button>
                                                                        <button type="button" class="btn btn-outline-secondary w-100 w-sm-auto mt-2 mt-sm-0 ms-sm-2" onclick="resetSessionForm()"
                                                                            style="border-radius: 8px; padding: 0.625rem 1.5rem; font-weight: 500; font-size: 0.9375rem;">
                                                                            <i class="fas fa-undo me-2"></i>Limpiar
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div style="flex: 0 0 auto; width: 320px;">
                                                    <div class="card" style="border-radius: 12px; border: 1px solid #e5e7eb; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                                        <div class="card-body avail-card-body" id="coachAvailabilityInfo" style="padding: 1rem;">
                                                            <!-- Contenido generado por JavaScript -->
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="card mt-3" style="border-radius: 12px; border: 1px solid #e5e7eb; box-shadow: 0 1px 2px rgba(0,0,0,0.05);">
                                                        <div class="card-body" style="padding: 1rem;">
                                                            <h6 class="mb-3" style="font-size: 0.875rem; font-weight: 600;">
                                                                <i class="fas fa-lightbulb me-2 avail-icon-lightbulb"></i>
                                                                Tips para Agendar
                                                            </h6>
                                                            <ul class="list-unstyled mb-0" style="font-size: 0.8125rem; line-height: 1.5; color: #1f2937;">
                                                                <li class="mb-2" style="display: flex; align-items: start; gap: 0.5rem;">
                                                                    <i class="fas fa-check-circle" style="color: #10b981; margin-top: 0.125rem; flex-shrink: 0;"></i>
                                                                    <span style="color: #1f2937;">Planifica con 24h de anticipaci√≥n</span>
                                                                </li>
                                                                <li class="mb-2" style="display: flex; align-items: start; gap: 0.5rem;">
                                                                    <i class="fas fa-check-circle" style="color: #10b981; margin-top: 0.125rem; flex-shrink: 0;"></i>
                                                                    <span style="color: #1f2937;">Describe el tema que quieres trabajar</span>
                                                                </li>
                                                                <li class="mb-2" style="display: flex; align-items: start; gap: 0.5rem;">
                                                                    <i class="fas fa-check-circle" style="color: #10b981; margin-top: 0.125rem; flex-shrink: 0;"></i>
                                                                    <span style="color: #1f2937;">Verifica tu disponibilidad antes</span>
                                                                </li>
                                                                <li class="mb-0" style="display: flex; align-items: start; gap: 0.5rem;">
                                                                    <i class="fas fa-check-circle" style="color: #10b981; margin-top: 0.125rem; flex-shrink: 0;"></i>
                                                                    <span style="color: #1f2937;">Tu coach responder√° en m√°x. 24h</span>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Pesta√±a: Mis Sesiones -->
                                        <div class="tab-pane fade" 
                                            :class="{ 'show active': scheduleTab === 'sessions' }"
                                            id="my-sessions-pane" role="tabpanel" 
                                            aria-labelledby="my-sessions-tab" tabindex="0">
                                            <div>
                                                <div>
                                                    <div class="d-flex flex-column flex-sm-row justify-content-between align-items-start align-items-sm-center gap-2 mb-3">
                                                        <h6 class="mb-0" style="font-size: clamp(0.9375rem, 3vw, 1rem); font-weight: 600; color: #111827;">
                                                            <i class="fas fa-calendar me-2" style="color: #3b82f6;"></i>
                                                            Mis Sesiones Programadas
                                                        </h6>
                                                        <div class="d-flex gap-2 w-100 w-sm-auto">
                                                            <button class="btn btn-primary btn-sm flex-grow-1 flex-sm-grow-0" 
                                                                @click="switchScheduleTab('request')"
                                                                style="border-radius: 8px; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500;">
                                                                <i class="fas fa-plus me-1"></i>Nueva Sesi√≥n
                                                            </button>
                                                            <button class="btn btn-outline-primary btn-sm" 
                                                                @click="loadMySessions(true)"
                                                                :disabled="isLoadingSessions"
                                                                style="border-radius: 8px; padding: 0.5rem 1rem; font-size: 0.875rem; font-weight: 500;">
                                                                <i class="fas fa-sync-alt" :class="{ 'fa-spin': isLoadingSessions }"></i>
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="mySessionsList">
                                                        <div class="text-center py-4" x-show="isLoadingSessions">
                                                            <div class="spinner-border text-primary" role="status" style="width: 2rem; height: 2rem;">
                                                                <span class="visually-hidden">Cargando sesiones...</span>
                                                            </div>
                                                            <p class="mt-2 mb-0" style="font-size: 0.875rem; color: #4b5563; font-weight: 500;">Cargando sesiones...</p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                
                <style>
                    /* ============================================
                       üìã EVALUACIONES DISPONIBLES - PREMIUM SAAS
                       ============================================ */
                    
                    .evaluations-section {
                        background: #ffffff;
                        border: 1px solid #e5e7eb;
                        border-radius: 1rem;
                        overflow: hidden;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                        animation: slideUpFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                    }
                    
                    /* Header Styles */
                    .evaluations-header {
                        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
                        padding: 1.5rem 1.25rem;
                        border-bottom: 3px solid #10b981;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .evaluations-header::before {
                        content: '';
                        position: absolute;
                        top: -50%;
                        right: -10%;
                        width: 300px;
                        height: 300px;
                        background: radial-gradient(circle, rgba(16, 185, 129, 0.12) 0%, transparent 70%);
                        border-radius: 50%;
                        pointer-events: none;
                    }
                    
                    .evaluations-header-content {
                        position: relative;
                        z-index: 1;
                    }
                    
                    .evaluations-header-title-group {
                        display: flex;
                        align-items: center;
                        gap: 1rem;
                    }
                    
                    .evaluations-icon-badge {
                        width: 3rem;
                        height: 3rem;
                        background: #10b981;
                        border-radius: 0.75rem;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                        flex-shrink: 0;
                    }

        [data-theme="dark"] .calendar-header-title {
            color: #f1f5f9 !important;
        }
                    
                    .evaluations-icon-badge i {
                        color: #ffffff;
                        font-size: 1.25rem;
                    }
                    
                    .evaluations-header-text {
                        flex: 1;
                        min-width: 0;
                    }
                    
                    .evaluations-title {
                        color: #ffffff;
                        font-weight: 700;
                        font-size: 1.25rem;
                        margin: 0 0 0.25rem 0;
                        letter-spacing: -0.015em;
                        line-height: 1.3;
                    }
                    
                    .evaluations-subtitle {
                        color: #cbd5e1;
                        font-size: 0.875rem;
                        font-weight: 500;
                        margin: 0;
                        display: none;
                    }
                    
                    /* Action Bar */
                    .evaluations-actions {
                        padding: 1.25rem;
                        border-bottom: 1px solid #f3f4f6;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        gap: 0.75rem;
                        flex-wrap: wrap;
                        background: #fafafa;
                    }
                    
                    .btn-group-left {
                        display: flex;
                        gap: 0.5rem;
                        flex-wrap: wrap;
                    }
                    
                    /* Button System - SaaS Premium */
                    .btn-primary,
                    .btn-secondary,
                    .btn-ghost {
                        display: inline-flex;
                        align-items: center;
                        gap: 0.5rem;
                        padding: 0.625rem 1rem;
                        border-radius: 0.625rem;
                        font-size: 0.875rem;
                        font-weight: 600;
                        border: none;
                        cursor: pointer;
                        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
                        white-space: nowrap;
                        line-height: 1;
                    }
                    
                    /* Ensure proper text color for secondary buttons */
                    .evaluations-actions .btn-secondary {
                        color: #0f172a !important;
                    }
                    
                    [data-theme="dark"] .evaluations-actions .btn-secondary {
                        color: #f1f5f9 !important;
                    }
                    
                    /* Button styles unified in main CSS section - no overrides needed in media query */
                    
                    /* Button States */
                    .btn-primary:disabled,
                    .btn-secondary:disabled,
                    .btn-ghost:disabled {
                        opacity: 0.5;
                        cursor: not-allowed;
                        transform: none !important;
                    }
                    
                    .btn-primary i,
                    .btn-secondary i,
                    .btn-ghost i {
                        font-size: 0.875rem;
                    }
                    
                    /* Content Container */
                    .evaluations-content {
                        padding: 1.5rem 1.25rem;
                        min-height: 200px;
                    }
                    
                    [data-theme="dark"] .evaluations-content {
                        background: #0f172a !important;
                    }
                    
                    /* Skeleton Loader Premium */
                    .skeleton-loader {
                        animation: fadeIn 0.3s ease;
                    }
                    
                    .skeleton-card {
                        background: #ffffff;
                        border: 1px solid #f3f4f6;
                        border-radius: 0.75rem;
                        padding: 1.25rem;
                        margin-bottom: 1.25rem;
                    }
                    
                    .skeleton-header {
                        display: flex;
                        align-items: center;
                        gap: 1rem;
                        margin-bottom: 1.5rem;
                        padding-bottom: 1rem;
                        border-bottom: 1px solid #f3f4f6;
                    }
                    
                    .skeleton-icon {
                        width: 3rem;
                        height: 3rem;
                        border-radius: 0.75rem;
                        background: linear-gradient(
                            90deg,
                            #f0f0f0 0%,
                            #e0e0e0 20%,
                            #f0f0f0 40%,
                            #f0f0f0 100%
                        );
                        background-size: 200% 100%;
                        animation: shimmer 2s infinite linear;
                        flex-shrink: 0;
                    }
                    
                    .skeleton-lines {
                        flex: 1;
                        display: flex;
                        flex-direction: column;
                        gap: 0.5rem;
                    }
                    
                    .skeleton-line {
                        height: 0.875rem;
                        border-radius: 0.25rem;
                        background: linear-gradient(
                            90deg,
                            #f0f0f0 0%,
                            #e0e0e0 20%,
                            #f0f0f0 40%,
                            #f0f0f0 100%
                        );
                        background-size: 200% 100%;
                        animation: shimmer 2s infinite linear;
                    }
                    
                    .skeleton-line-title {
                        width: 60%;
                        height: 1rem;
                    }
                    
                    .skeleton-line-subtitle {
                        width: 40%;
                    }
                    
                    .skeleton-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                        gap: 1rem;
                    }
                    
                    .skeleton-item {
                        height: 200px;
                        border-radius: 0.75rem;
                        background: linear-gradient(
                            90deg,
                            #f0f0f0 0%,
                            #e0e0e0 20%,
                            #f0f0f0 40%,
                            #f0f0f0 100%
                        );
                        background-size: 200% 100%;
                        animation: shimmer 2s infinite linear;
                    }
                    
                    @keyframes shimmer {
                        0% {
                            background-position: -200% 0;
                        }
                        100% {
                            background-position: 200% 0;
                        }
                    }
                    
                    @keyframes slideUpFadeIn {
                        from {
                            opacity: 0;
                            transform: translateY(20px);
                        }
                        to {
                            opacity: 1;
                            transform: translateY(0);
                        }
                    }
                    
                    @keyframes fadeIn {
                        from { opacity: 0; }
                        to { opacity: 1; }
                    }
                    
                    /* Responsive Design */
                    @media (min-width: 640px) {
                        .evaluations-subtitle {
                            display: block;
                        }
                        
                        .btn-primary span,
                        .btn-secondary span,
                        .btn-ghost span {
                            display: inline;
                        }
                    }
                    
                    @media (max-width: 639px) {
                        .evaluations-section {
                            border-radius: 0;
                            border-left: none;
                            border-right: none;
                            margin-left: -0.5rem;
                            margin-right: -0.5rem;
                        }
                        
                        .evaluations-header {
                            padding: 0.875rem 1rem;
                            border-bottom-width: 2px;
                        }
                        
                        .evaluations-header-title-group {
                            gap: 0.75rem;
                        }
                        
                        .evaluations-icon-badge {
                            width: 2.5rem;
                            height: 2.5rem;
                            border-radius: 0.625rem;
                        }
                        
                        .evaluations-icon-badge i {
                            font-size: 1.125rem;
                        }
                        
                        .evaluations-title {
                            font-size: 1rem;
                            letter-spacing: -0.01em;
                        }
                        
                        .evaluations-actions {
                            padding: 0.75rem 1rem;
                            gap: 0.5rem;
                            background: #f9fafb;
                        }
                        
                        .btn-group-left {
                            gap: 0.375rem;
                            flex: 1;
                        }
                        
                        .btn-primary,
                        .btn-secondary,
                        .btn-ghost {
                            padding: 0.5rem 0.75rem;
                            gap: 0.375rem;
                            font-size: 0.8125rem;
                            border-radius: 0.5rem;
                        }
                        
                        .btn-primary i,
                        .btn-secondary i,
                        .btn-ghost i {
                            font-size: 0.8125rem;
                        }
                        
                        .btn-primary span,
                        .btn-secondary span,
                        .btn-ghost span {
                            display: inline;
                        }
                        
                        .evaluations-content {
                            padding: 1rem;
                        }
                        
                        .skeleton-grid {
                            grid-template-columns: 1fr;
                        }
                        
                        /* Optimizaci√≥n de cards de evaluaci√≥n en m√≥vil */
                        .category-header-bg {
                            padding: 0.875rem 1rem !important;
                            margin-bottom: 0.75rem !important;
                            border-radius: 0.75rem !important;
                        }
                        
                        .category-header-bg .d-flex.align-items-center.gap-3 {
                            gap: 0.75rem !important;
                        }
                        
                        .category-header-bg > div:first-child > div:first-child {
                            width: 2.5rem !important;
                            height: 2.5rem !important;
                            border-radius: 0.75rem !important;
                        }
                        
                        .category-header-bg > div:first-child > div:first-child i {
                            font-size: 1.125rem !important;
                        }
                        
                        .category-header-bg h4 {
                            font-size: 0.9375rem !important;
                        }
                        
                        .category-header-bg p {
                            font-size: 0.75rem !important;
                        }
                        
                        .category-header-bg > span {
                            padding: 0.375rem 0.75rem !important;
                            font-size: 0.8125rem !important;
                            border-radius: 0.5rem !important;
                        }
                        
                        /* Cards de evaluaci√≥n */
                        .evaluations-content .card {
                            border-radius: 0.875rem !important;
                            margin-bottom: 0.75rem;
                        }
                        
                        .evaluations-content .card .card-body {
                            padding: 1rem !important;
                        }
                        
                        .evaluations-content .card .card-title {
                            font-size: 0.9375rem !important;
                            margin-bottom: 0.75rem !important;
                        }
                        
                        .evaluations-content .card .p-4:first-child {
                            padding: 1.5rem 1rem !important;
                        }
                        
                        .evaluations-content .card .p-4:first-child i {
                            font-size: 2.5rem !important;
                        }
                        
                        /* Metadata badges */
                        .evaluations-content .metadata-badge-bg-orange,
                        .evaluations-content .metadata-badge-bg-blue,
                        .evaluations-content .metadata-badge-bg-purple,
                        .evaluations-content .metadata-badge-bg-green {
                            padding: 0.375rem 0.625rem !important;
                            border-radius: 0.5rem !important;
                        }
                        
                        .evaluations-content .metadata-badge-bg-orange span,
                        .evaluations-content .metadata-badge-bg-blue span,
                        .evaluations-content .metadata-badge-bg-purple span,
                        .evaluations-content .metadata-badge-bg-green span {
                            font-size: 0.75rem !important;
                        }
                        
                        /* Botones de acci√≥n en cards */
                        .evaluations-content .btn {
                            padding: 0.625rem 1rem !important;
                            font-size: 0.875rem !important;
                            border-radius: 0.625rem !important;
                        }
                        
                        .evaluations-content .btn i {
                            font-size: 0.875rem !important;
                        }
                        
                        /* Grid responsive */
                        .evaluations-content .row.g-3 {
                            gap: 0.75rem !important;
                            margin: 0 !important;
                        }
                        
                        .evaluations-content .row.g-3 > [class*="col-"] {
                            padding: 0 !important;
                        }
                    }
                    
                    @media (min-width: 768px) {
                        .evaluations-header {
                            padding: 1.25rem 2rem;
                            border-bottom-width: 4px;
                        }
                        
                        .evaluations-icon-badge {
                            width: 3.5rem;
                            height: 3.5rem;
                            border-radius: 0.875rem;
                        }
                        
                        .evaluations-icon-badge i {
                            font-size: 1.5rem;
                        }
                        
                        .evaluations-title {
                            font-size: 1.5rem;
                        }
                        
                        .evaluations-subtitle {
                            font-size: 0.9375rem;
                        }
                        
                        .evaluations-actions {
                            padding: 1.5rem 2rem;
                        }
                        
                        .evaluations-content {
                            padding: 2rem;
                        }
                    }
                </style>

                <style>
                    /* ============================================
                       ‚úÖ EVALUACIONES COMPLETADAS - PREMIUM SAAS
                       ============================================ */
                    
                    .completed-evaluations-section {
                        background: #ffffff;
                        border: 1px solid #e5e7eb;
                        border-radius: 1rem;
                        overflow: hidden;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
                        animation: slideUpFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
                    }
                    
                    [data-theme="dark"] .completed-evaluations-section {
                        background: #1e293b;
                        border-color: #334155;
                    }
                    
                    /* Header Styles */
                    .completed-evaluations-header {
                        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
                        padding: 1.5rem 1.25rem;
                        border-bottom: 3px solid #10b981;
                        position: relative;
                        overflow: hidden;
                    }
                    
                    .completed-evaluations-header::before {
                        content: '';
                        position: absolute;
                        top: -50%;
                        right: -10%;
                        width: 300px;
                        height: 300px;
                        background: radial-gradient(circle, rgba(16, 185, 129, 0.15) 0%, transparent 70%);
                        border-radius: 50%;
                        pointer-events: none;
                    }
                    
                    .completed-evaluations-header-content {
                        position: relative;
                        z-index: 1;
                    }
                    
                    .completed-evaluations-header-title-group {
                        display: flex;
                        align-items: center;
                        gap: 1rem;
                    }
                    
                    .completed-evaluations-icon-badge {
                        width: 3rem;
                        height: 3rem;
                        background: #10b981;
                        border-radius: 0.75rem;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
                        flex-shrink: 0;
                    }
                    
                    .completed-evaluations-icon-badge i {
                        color: #ffffff;
                        font-size: 1.25rem;
                    }
                    
                    .completed-evaluations-header-text {
                        flex: 1;
                        min-width: 0;
                    }
                    
                    .completed-evaluations-title {
                        color: #ffffff;
                        font-weight: 700;
                        font-size: 1.25rem;
                        margin: 0 0 0.25rem 0;
                        letter-spacing: -0.015em;
                        line-height: 1.3;
                    }
                    
                    .completed-evaluations-subtitle {
                        color: #cbd5e1;
                        font-size: 0.875rem;
                        font-weight: 500;
                        margin: 0;
                        display: none;
                    }
                    
                    /* Action Bar */
                    .completed-evaluations-actions {
                        padding: 1.25rem;
                        border-bottom: 1px solid #f3f4f6;
                        display: flex;
                        justify-content: space-between;
                        align-items: center;
                        gap: 0.75rem;
                        flex-wrap: wrap;
                        background: #fafafa;
                    }
                    
                    [data-theme="dark"] .completed-evaluations-actions {
                        background: #0f172a;
                        border-bottom-color: #334155;
                    }
                    
                    /* Ensure proper text color for secondary buttons in completed evaluations */
                    .completed-evaluations-actions .btn-secondary {
                        color: #0f172a !important;
                    }
                    
                    [data-theme="dark"] .completed-evaluations-actions .btn-secondary {
                        color: #f1f5f9 !important;
                    }
                    
                    /* Content Container */
                    .completed-evaluations-content {
                        padding: 1.5rem 1.25rem;
                        min-height: 200px;
                    }
                    
                    [data-theme="dark"] .completed-evaluations-content {
                        background: #1e293b;
                    }
                    
                    /* ============================================
                       üì± RESPONSIVE DESIGN - 100% OPTIMIZADO
                       ============================================ */
                    
                    /* Estilos para headers de categor√≠as completadas */
                    .section-header-eval {
                        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
                        padding: 1rem;
                        border-radius: 12px;
                        margin-bottom: 1rem;
                        cursor: pointer;
                        transition: all 0.3s ease;
                        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                    }
                    
                    .section-header-eval:hover {
                        transform: translateY(-2px);
                        box-shadow: 0 4px 16px rgba(0,0,0,0.15);
                    }
                    
                    [data-theme="dark"] .section-header-eval {
                        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
                    }
                    
                    /* Override para headers din√°micos con data-theme-bg */
                    .section-header-eval[data-theme-bg="light"] {
                        background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
                    }
                    
                    [data-theme="dark"] .section-header-eval[data-theme-bg="light"] {
                        background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
                    }
                    
                    /* Colores de texto para categor√≠as */
                    .category-header-title {
                        color: #4b5563;
                    }
                    
                    [data-theme="dark"] .category-header-title {
                        color: #e2e8f0;
                    }
                    
                    .category-header-subtitle {
                        color: #6b7280;
                    }
                    
                    [data-theme="dark"] .category-header-subtitle {
                        color: #cbd5e1;
                    }
                    
                    /* ============================================
                       CATEGORY GRID - ANIMACI√ìN CSS PURA
                       ============================================ */
                    .category-grid {
                        display: grid;
                        overflow: hidden;
                        margin-bottom: 0;
                        max-height: 0;
                        opacity: 0;
                        transition: max-height 0.5s ease, opacity 0.3s ease, margin-bottom 0.3s ease;
                    }
                    
                    .category-grid[data-expanded="true"] {
                        max-height: 10000px;
                        opacity: 1;
                        margin-bottom: 30px;
                    }
                    
                    /* Hover en header */
                    .section-header-eval:hover {
                        box-shadow: 0 4px 12px rgba(0,0,0,0.1) !important;
                        transform: translateY(-2px);
                    }
                    
                    /* Grid responsivo para evaluaciones completadas */
                    .assessments-grid {
                        display: grid;
                        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                        gap: 1rem;
                        margin-bottom: 0;
                    }
                    
                    /* Cards de evaluaciones completadas */
                    .assessment-card {
                        background: white;
                        border-radius: 12px;
                        overflow: hidden;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        border: 1px solid #e5e7eb;
                        cursor: pointer;
                        height: 100%;
                        display: flex;
                        flex-direction: column;
                    }
                    
                    .assessment-card:hover {
                        transform: translateY(-4px);
                        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
                    }
                    
                    [data-theme="dark"] .assessment-card {
                        background: #1e293b;
                        border-color: #334155;
                    }
                    
                    /* Mobile First - Smartphones (< 640px) */
                    @media (max-width: 639px) {
                        .completed-evaluations-header {
                            padding: 1rem 0.875rem;
                        }
                        
                        .completed-evaluations-header-title-group {
                            gap: 0.75rem;
                        }
                        
                        .completed-evaluations-icon-badge {
                            width: 2.5rem;
                            height: 2.5rem;
                        }
                        
                        .completed-evaluations-icon-badge i {
                            font-size: 1rem;
                        }
                        
                        .completed-evaluations-title {
                            font-size: 1rem;
                            line-height: 1.25;
                        }
                        
                        .completed-evaluations-subtitle {
                            font-size: 0.75rem;
                            display: none;
                        }
                        
                        .completed-evaluations-actions {
                            padding: 0.875rem;
                            gap: 0.5rem;
                        }
                        
                        .completed-evaluations-actions .btn-secondary,
                        .completed-evaluations-actions .btn-primary {
                            font-size: 0.8125rem;
                            padding: 0.5rem 0.75rem;
                        }
                        
                        .completed-evaluations-actions span {
                            display: none;
                        }
                        
                        .completed-evaluations-content {
                            padding: 0.875rem;
                        }
                        
                        /* Headers de categor√≠as en m√≥vil */
                        .section-header-eval {
                            padding: 0.875rem;
                        }
                        
                        .section-header-eval h4 {
                            font-size: 0.9375rem !important;
                        }
                        
                        .section-header-eval p {
                            font-size: 0.75rem !important;
                        }
                        
                        /* Grid m√≥vil - 1 columna */
                        .assessments-grid {
                            grid-template-columns: 1fr;
                            gap: 0.875rem;
                        }
                        
                        /* Cards de evaluaci√≥n en m√≥vil */
                        .assessment-card h5 {
                            font-size: 0.9375rem !important;
                            -webkit-line-clamp: 2 !important;
                            line-clamp: 2 !important;
                        }
                        
                        .assessment-card p {
                            font-size: 0.8125rem !important;
                        }
                    }
                    
                    /* Tablets y pantallas medianas (640px - 767px) */
                    @media (min-width: 640px) and (max-width: 767px) {
                        .completed-evaluations-subtitle {
                            display: block;
                            font-size: 0.8125rem;
                        }
                        
                        .completed-evaluations-title {
                            font-size: 1.125rem;
                        }
                        
                        .completed-evaluations-actions span {
                            display: inline;
                        }
                        
                        .assessments-grid {
                            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                        }
                    }
                    
                    /* Tablets grandes y peque√±os desktop (768px - 1023px) */
                    @media (min-width: 768px) {
                        .completed-evaluations-header {
                            padding: 1.25rem;
                            border-bottom-width: 4px;
                        }
                        
                        .completed-evaluations-icon-badge {
                            width: 3.25rem;
                            height: 3.25rem;
                            border-radius: 0.875rem;
                        }
                        
                        .completed-evaluations-icon-badge i {
                            font-size: 1.375rem;
                        }
                        
                        .completed-evaluations-title {
                            font-size: 1.375rem;
                        }
                        
                        .completed-evaluations-subtitle {
                            font-size: 0.875rem;
                            display: block;
                        }
                        
                        .completed-evaluations-actions {
                            padding: 1.25rem 1.5rem;
                        }
                        
                        .completed-evaluations-actions span {
                            display: inline;
                        }
                        
                        .completed-evaluations-content {
                            padding: 1.5rem;
                        }
                        
                        .section-header-eval {
                            padding: 1.125rem 1.25rem;
                        }
                        
                        .assessments-grid {
                            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
                            gap: 1.125rem;
                        }
                    }
                    
                    /* Desktop grande (>= 1024px) */
                    @media (min-width: 1024px) {
                        .completed-evaluations-header {
                            padding: 1.25rem 2rem;
                        }
                        
                        .completed-evaluations-icon-badge {
                            width: 3.5rem;
                            height: 3.5rem;
                        }
                        
                        .completed-evaluations-icon-badge i {
                            font-size: 1.5rem;
                        }
                        
                        .completed-evaluations-title {
                            font-size: 1.5rem;
                        }
                        
                        .completed-evaluations-subtitle {
                            font-size: 0.9375rem;
                        }
                        
                        .completed-evaluations-actions {
                            padding: 1.5rem 2rem;
                        }
                        
                        .completed-evaluations-content {
                            padding: 2rem;
                        }
                        
                        .section-header-eval {
                            padding: 1.25rem 1.5rem;
                        }
                        
                        .assessments-grid {
                            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
                            gap: 1.25rem;
                        }
                    }
                </style>

                <!-- ========================================= -->
                <!-- MIS EVALUACIONES DISPONIBLES - PREMIUM SAAS -->
                <!-- ========================================= -->
                <div class="tab-pane fade" id="available-evaluations-v2" role="tabpanel">
                    <div class="row" style="margin-top: 0;">
                        <div class="col-12">
                            <article class="evaluations-section" role="region" aria-labelledby="available-evaluations-heading">
                                
                                <!-- üé® Premium Header -->
                                <header class="evaluations-header">
                                    <div class="evaluations-header-content">
                                    
                                        <div class="evaluations-header-title-group">
                                            <div class="evaluations-icon-badge">
                                                <i class="fas fa-clipboard-list" aria-hidden="true"></i>
                                            </div>
                                            <div class="evaluations-header-text">
                                                <h2 class="evaluations-title" id="available-evaluations-heading">
                                                    Mis Evaluaciones Disponibles
                                                </h2>
                                                <p class="evaluations-subtitle">
                                                    Completa tus evaluaciones y descubre tus √°reas de desarrollo
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                </header>
                                
                                <!-- üéõÔ∏è Action Bar Premium -->
                                <div class="evaluations-actions">
                                    <div class="btn-group-left">
                                        <button type="button" 
                                                onclick="filterAvailableEvaluations('all')"
                                                class="btn-secondary"
                                                aria-label="Mostrar todas las evaluaciones">
                                            <i class="fas fa-list" aria-hidden="true"></i>
                                            <span>Todas</span>
                                        </button>
                                        <button type="button"
                                                onclick="filterAvailableEvaluations('pending')"
                                                class="btn-secondary"
                                                aria-label="Filtrar evaluaciones pendientes">
                                            <i class="fas fa-clock" aria-hidden="true"></i>
                                            <span>Pendientes</span>
                                        </button>
                                    </div>
                                    <button type="button"
                                            onclick="location.reload()" 
                                            class="btn-primary"
                                            aria-label="Actualizar lista de evaluaciones">
                                        <i class="fas fa-sync-alt" aria-hidden="true"></i>
                                        <span>Actualizar</span>
                                    </button>
                                </div>
                                
                                <!-- üìã Content Container -->
                                <div id="availableEvaluationsV2" 
                                     class="evaluations-content" 
                                     role="region" 
                                     aria-label="Lista de evaluaciones disponibles" 
                                     aria-live="polite">
                                    <!-- Skeleton Loading Premium -->
                                    <div class="skeleton-loader" role="status" aria-label="Cargando evaluaciones">
                                        <div class="skeleton-card">
                                            <div class="skeleton-header">
                                                <div class="skeleton-icon"></div>
                                                <div class="skeleton-lines">
                                                    <div class="skeleton-line skeleton-line-title"></div>
                                                    <div class="skeleton-line skeleton-line-subtitle"></div>
                                                </div>
                                            </div>
                                            <div class="skeleton-grid">
                                                <div class="skeleton-item"></div>
                                                <div class="skeleton-item"></div>
                                                <div class="skeleton-item"></div>
                                            </div>
                                        </div>
                                        <span class="visually-hidden">Cargando evaluaciones disponibles...</span>
                                    </div>
                                    
                                    <!-- CATEGOR√çAS DE EVALUACIONES -->
                                    <div id="availableEvaluationsV2">
                                        
                                        <!-- CATEGOR√çA: LIDERAZGO (Ejemplo con 2 evaluaciones) -->
                                        <div class="mb-4 animate-slideUp">
                                            <!-- Header de categor√≠a -->
                                            <div class="d-flex align-items-center justify-content-between p-4 mb-3 cursor-pointer category-header-bg"
                                                 style="border-radius: 1rem; 
                                                       border-left: 4px solid #fd7e14;
                                                       box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
                                                       transition: all 0.2s ease;"
                                                 onmouseenter="this.style.boxShadow='0 4px 16px rgba(0,0,0,0.1)';"
                                                 onmouseleave="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)';">
                                                <div class="d-flex align-items-center gap-3">
                                                    <!-- Badge del icono -->
                                                    <div class="d-flex align-items-center justify-content-center" 
                                                         style="width: 3.5rem; 
                                                               height: 3.5rem; 
                                                               background: #fd7e14; 
                                                               border-radius: 1rem; 
                                                               box-shadow: 0 4px 12px rgba(253, 126, 20, 0.4);">
                                                        <i class="fas fa-crown" style="color: #ffffff !important; font-size: 1.5rem;"></i>
                                                    </div>
                                                    
                                                    <!-- T√≠tulo y descripci√≥n -->
                                                    <div>
                                                        <h4 class="mb-0 inline-text-dark" style="font-size: 1.125rem; font-weight: 700;">
                                                            Liderazgo
                                                        </h4>
                                                        <p class="mb-0 inline-text-light" style="font-size: 0.875rem;">
                                                            2 evaluaciones disponibles
                                                        </p>
                                                    </div>
                                                </div>
                                                
                                                <!-- Badge contador -->
                                                <span class="d-flex align-items-center justify-content-center" 
                                                      style="background: #fd7e14; 
                                                            color: #ffffff !important; 
                                                            padding: 0.5rem 1rem; 
                                                            border-radius: 0.75rem; 
                                                            font-weight: 700; 
                                                            font-size: 0.875rem;
                                                            box-shadow: 0 2px 8px rgba(253, 126, 20, 0.4);">
                                                    2
                                                </span>
                                            </div>
                                            
                                            <!-- Cards de evaluaciones -->
                                            <div class="row g-3">
                                                
                                                <!-- CARD 1: Evaluaci√≥n de Habilidades de Liderazgo -->
                                                <div class="col-12 col-md-6">
                                                    <div class="card h-100 animate-scaleIn card-bg-theme" 
                                                         style="border: 2px solid #fd7e14 !important; 
                                                               border-radius: 1rem; 
                                                               box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); 
                                                               overflow: hidden;">
                                                        
                                                        <!-- Header con icono grande -->
                                                        <div class="p-4 text-center card-header-bg-orange">
                                                            <i class="fas fa-crown" style="font-size: 3.5rem; color: #fd7e14 !important; opacity: 0.9;"></i>
                                                        </div>
                                                        
                                                        <!-- Body del card -->
                                                        <div class="card-body p-4">
                                                            <h5 class="card-title mb-3 inline-text-dark" style="font-weight: 700; font-size: 1.125rem; line-height: 1.4;">
                                                                Evaluaci√≥n de Habilidades de Liderazgo
                                                            </h5>
                                                            
                                                            <!-- Metadata -->
                                                            <div class="d-flex align-items-center gap-3 mb-3 flex-wrap">
                                                                <div class="d-flex align-items-center gap-2 px-3 py-1 metadata-badge-bg-orange" 
                                                                     style="border-radius: 0.75rem;">
                                                                    <i class="fas fa-question-circle metadata-text-orange" style="font-size: 0.875rem;"></i>
                                                                    <span class="metadata-text-orange" style="font-weight: 600; font-size: 0.875rem;">10 preguntas</span>
                                                                </div>
                                                                <div class="d-flex align-items-center gap-2 px-3 py-1 metadata-badge-bg-orange" 
                                                                     style="border-radius: 0.75rem;">
                                                                    <i class="fas fa-clock metadata-text-orange" style="font-size: 0.875rem;"></i>
                                                                    <span class="metadata-text-orange" style="font-weight: 600; font-size: 0.875rem;">~15 min</span>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Coach info -->
                                                            <div class="d-flex align-items-center gap-2 p-2 mb-3" 
                                                                 style="background: rgba(253, 126, 20, 0.15) !important; 
                                                                       border-radius: 0.75rem; 
                                                                       border: 1px solid #fd7e14;">
                                                                <div style="width: 2.25rem; height: 2.25rem; border-radius: 50%; background: #e2e8f0; overflow: hidden;">
                                                                    <img src="https://i.pravatar.cc/300?img=3" alt="Coach" style="width: 100%; height: 100%; object-fit: cover;">
                                                                </div>
                                                                <div style="flex: 1;">
                                                                    <p class="mb-0" class="inline-text-light" style="font-size: 0.75rem; font-weight: 500">Asignada por</p>
                                                                    <p class="mb-0" class="inline-text-dark" style="font-size: 0.875rem; font-weight: 600">Cristian Galdames</p>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Bot√≥n de acci√≥n premium -->
                                                            <button class="btn w-100 d-inline-flex align-items-center justify-content-center gap-2" 
                                                                    style="background: #fd7e14 !important; 
                                                                          border: none !important; 
                                                                          padding: 0.75rem 1.5rem !important; 
                                                                          border-radius: 0.75rem !important; 
                                                                          color: #ffffff !important; 
                                                                          font-weight: 700 !important; 
                                                                          font-size: 0.875rem !important; 
                                                                          box-shadow: 0 4px 16px rgba(253, 126, 20, 0.3) !important; 
                                                                          transition: all 0.2s ease !important;"
                                                                    onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 24px rgba(253, 126, 20, 0.4)';"
                                                                    onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(253, 126, 20, 0.3)';">
                                                                <i class="fas fa-play" style="font-size: 0.75rem !important; color: #ffffff !important;"></i>
                                                                <span style="color: #ffffff !important;">Comenzar Evaluaci√≥n</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <!-- CARD 2: Evaluaci√≥n de Competencias de Liderazgo -->
                                                <div class="col-12 col-md-6">
                                                    <div class="card h-100 animate-scaleIn card-bg-theme" 
                                                         style="border: 2px solid #fd7e14 !important; 
                                                               border-radius: 1rem; 
                                                               box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); 
                                                               overflow: hidden;">
                                                        
                                                        <!-- Header con icono grande -->
                                                        <div class="p-4 text-center card-header-bg-orange">
                                                            <i class="fas fa-crown" style="font-size: 3.5rem; color: #fd7e14 !important; opacity: 0.9;"></i>
                                                        </div>
                                                        
                                                        <!-- Body del card -->
                                                        <div class="card-body p-4">
                                                            <h5 class="card-title mb-3 inline-text-dark" style="font-weight: 700; font-size: 1.125rem; line-height: 1.4">
                                                                Evaluaci√≥n de Competencias de Liderazgo
                                                            </h5>
                                                            
                                                            <!-- Metadata -->
                                                            <div class="d-flex align-items-center gap-3 mb-3 flex-wrap">
                                                                <div class="d-flex align-items-center gap-2 px-3 py-1 metadata-badge-bg-orange" 
                                                                     style="border-radius: 0.75rem;">
                                                                    <i class="fas fa-question-circle metadata-text-orange" style="font-size: 0.875rem;"></i>
                                                                    <span class="metadata-text-orange" style="font-weight: 600; font-size: 0.875rem;">8 preguntas</span>
                                                                </div>
                                                                <div class="d-flex align-items-center gap-2 px-3 py-1 metadata-badge-bg-orange" 
                                                                     style="border-radius: 0.75rem;">
                                                                    <i class="fas fa-clock metadata-text-orange" style="font-size: 0.875rem;"></i>
                                                                    <span class="metadata-text-orange" style="font-weight: 600; font-size: 0.875rem;">~12 min</span>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Coach info -->
                                                            <div class="d-flex align-items-center gap-2 p-2 mb-3 coach-info-bg-orange" 
                                                                 style="border-radius: 0.75rem;">
                                                                <div style="width: 2.25rem; height: 2.25rem; border-radius: 50%; background: #e2e8f0; overflow: hidden;">
                                                                    <img src="https://i.pravatar.cc/300?img=3" alt="Coach" style="width: 100%; height: 100%; object-fit: cover;">
                                                                </div>
                                                                <div style="flex: 1;">
                                                                    <p class="mb-0 inline-text-light" style="font-size: 0.75rem; font-weight: 500">Asignada por</p>
                                                                    <p class="mb-0 inline-text-dark" style="font-size: 0.875rem; font-weight: 600">Cristian Galdames</p>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Bot√≥n de acci√≥n premium -->
                                                            <button class="btn w-100 d-inline-flex align-items-center justify-content-center gap-2" 
                                                                    style="background: #fd7e14 !important; 
                                                                          border: none !important; 
                                                                          padding: 0.75rem 1.5rem !important; 
                                                                          border-radius: 0.75rem !important; 
                                                                          color: #ffffff !important; 
                                                                          font-weight: 700 !important; 
                                                                          font-size: 0.875rem !important; 
                                                                          box-shadow: 0 4px 16px rgba(253, 126, 20, 0.3) !important; 
                                                                          transition: all 0.2s ease !important;"
                                                                    onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 24px rgba(253, 126, 20, 0.4)';"
                                                                    onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(253, 126, 20, 0.3)';">
                                                                <i class="fas fa-play" style="font-size: 0.75rem !important; color: #ffffff !important;"></i>
                                                                <span style="color: #ffffff !important;">Comenzar Evaluaci√≥n</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        </div>
                                        
                                        <!-- CATEGOR√çA: INTELIGENCIA EMOCIONAL (Ejemplo con 1 evaluaci√≥n) -->
                                        <div class="mb-4 animate-slideUp">
                                            <!-- Header de categor√≠a -->
                                            <div class="d-flex align-items-center justify-content-between p-4 mb-3 cursor-pointer category-header-bg"
                                                 style="border-radius: 1rem; 
                                                       border-left: 4px solid #e83e8c;
                                                       box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
                                                       transition: all 0.2s ease;"
                                                 onmouseenter="this.style.boxShadow='0 4px 16px rgba(0,0,0,0.1)';"
                                                 onmouseleave="this.style.boxShadow='0 2px 8px rgba(0,0,0,0.06)';">
                                                <div class="d-flex align-items-center gap-3">
                                                    <!-- Badge del icono -->
                                                    <div class="d-flex align-items-center justify-content-center" 
                                                         style="width: 3.5rem; 
                                                               height: 3.5rem; 
                                                               background: #e83e8c; 
                                                               border-radius: 1rem; 
                                                               box-shadow: 0 4px 12px rgba(232, 62, 140, 0.4);">
                                                        <i class="fas fa-heart" style="color: #ffffff !important; font-size: 1.5rem;"></i>
                                                    </div>
                                                    
                                                    <!-- T√≠tulo y descripci√≥n -->
                                                    <div>
                                                        <h4 class="mb-0" class="inline-text-dark" style="font-size: 1.125rem; font-weight: 700">
                                                            Inteligencia Emocional
                                                        </h4>
                                                        <p class="mb-0" class="inline-text-light" style="font-size: 0.875rem">
                                                            1 evaluaci√≥n disponible
                                                        </p>
                                                    </div>
                                                </div>
                                                
                                                <!-- Badge contador -->
                                                <span class="d-flex align-items-center justify-content-center" 
                                                      style="background: #e83e8c; 
                                                            color: #ffffff !important; 
                                                            padding: 0.5rem 1rem; 
                                                            border-radius: 0.75rem; 
                                                            font-weight: 700; 
                                                            font-size: 0.875rem;
                                                            box-shadow: 0 2px 8px rgba(232, 62, 140, 0.4);">
                                                    1
                                                </span>
                                            </div>
                                            
                                            <!-- Cards de evaluaciones -->
                                            <div class="row g-3">
                                                
                                                <!-- CARD: Evaluaci√≥n de Inteligencia Emocional -->
                                                <div class="col-12 col-md-6">
                                                    <div class="card h-100 animate-scaleIn card-bg-theme" 
                                                         style="border: 2px solid #e83e8c !important; 
                                                               border-radius: 1rem; 
                                                               box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); 
                                                               overflow: hidden;">
                                                        
                                                        <!-- Header con icono grande -->
                                                        <div class="p-4 text-center card-header-bg-pink">
                                                            <i class="fas fa-heart" style="font-size: 3.5rem; color: #e83e8c !important; opacity: 0.9;"></i>
                                                        </div>
                                                        
                                                        <!-- Body del card -->
                                                        <div class="card-body p-4">
                                                            <h5 class="card-title mb-3 inline-text-dark" style="font-weight: 700; font-size: 1.125rem; line-height: 1.4">
                                                                Evaluaci√≥n de Inteligencia Emocional
                                                            </h5>
                                                            
                                                            <!-- Metadata -->
                                                            <div class="d-flex align-items-center gap-3 mb-3 flex-wrap">
                                                                <div class="d-flex align-items-center gap-2 px-3 py-1 metadata-badge-bg-pink" 
                                                                     style="border-radius: 0.75rem;">
                                                                    <i class="fas fa-question-circle metadata-text-pink" style="font-size: 0.875rem;"></i>
                                                                    <span class="metadata-text-pink" style="font-weight: 600; font-size: 0.875rem;">12 preguntas</span>
                                                                </div>
                                                                <div class="d-flex align-items-center gap-2 px-3 py-1 metadata-badge-bg-pink" 
                                                                     style="border-radius: 0.75rem;">
                                                                    <i class="fas fa-clock metadata-text-pink" style="font-size: 0.875rem;"></i>
                                                                    <span class="metadata-text-pink" style="font-weight: 600; font-size: 0.875rem;">~18 min</span>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Coach info -->
                                                            <div class="d-flex align-items-center gap-2 p-2 mb-3 coach-info-bg-pink" 
                                                                 style="border-radius: 0.75rem;">
                                                                <div style="width: 2.25rem; height: 2.25rem; border-radius: 50%; background: #e2e8f0; overflow: hidden;">
                                                                    <img src="https://i.pravatar.cc/300?img=3" alt="Coach" style="width: 100%; height: 100%; object-fit: cover;">
                                                                </div>
                                                                <div style="flex: 1;">
                                                                    <p class="mb-0 inline-text-light" style="font-size: 0.75rem; font-weight: 500">Asignada por</p>
                                                                    <p class="mb-0 inline-text-dark" style="font-size: 0.875rem; font-weight: 600">Cristian Galdames</p>
                                                                </div>
                                                            </div>
                                                            
                                                            <!-- Bot√≥n de acci√≥n premium -->
                                                            <button class="btn w-100 d-inline-flex align-items-center justify-content-center gap-2" 
                                                                    style="background: #e83e8c !important; 
                                                                          border: none !important; 
                                                                          padding: 0.75rem 1.5rem !important; 
                                                                          border-radius: 0.75rem !important; 
                                                                          color: #ffffff !important; 
                                                                          font-weight: 700 !important; 
                                                                          font-size: 0.875rem !important; 
                                                                          box-shadow: 0 4px 16px rgba(232, 62, 140, 0.3) !important; 
                                                                          transition: all 0.2s ease !important;"
                                                                    onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 24px rgba(232, 62, 140, 0.4)';"
                                                                    onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(232, 62, 140, 0.3)';">
                                                                <i class="fas fa-play" style="font-size: 0.75rem !important; color: #ffffff !important;"></i>
                                                                <span style="color: #ffffff !important;">Comenzar Evaluaci√≥n</span>
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar Premium Styles -->
    <style>
        .sidebar .list-group-item {
            background: transparent;
            color: #4b5563;
        }
        
        .sidebar .list-group-item:hover:not(.active) {
            background: rgba(16, 185, 129, 0.08);
            color: #10b981;
            transform: translateX(3px);
        }
        
        .sidebar .list-group-item.active {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: #ffffff;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(30, 41, 59, 0.3);
            border-left: 3px solid #10b981;
        }
        
        .sidebar .list-group-item i {
            opacity: 0.8;
        }
        
        .sidebar .list-group-item.active i {
            opacity: 1;
        }
        
        /* Mobile responsive adjustments */
        @media (max-width: 767px) {
            .sidebar {
                margin-bottom: 1rem !important;
            }
            
            .sidebar .card-header {
                padding: 1rem 0.875rem !important;
            }
            
            .sidebar .card-header h5 {
                font-size: 0.9375rem !important;
            }
            
            .sidebar .card-header p {
                font-size: 0.75rem !important;
            }
            
            .sidebar .list-group-item {
                padding: 0.625rem 0.75rem !important;
            }
            
            .sidebar .list-group-item span {
                font-size: 0.8125rem !important;
            }
        }
    </style>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1060;">
        <div id="toastNotification" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">Notificaci√≥n</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <!-- Toast message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- GAMIFICACI√ìN: Modal Level Up (Etapa 8) -->
    <div class="modal fade" id="levelUpModal" tabindex="-1" aria-labelledby="levelUpModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="border-radius: 20px !important; border: none !important; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; overflow: hidden; box-shadow: 0 20px 60px rgba(102, 126, 234, 0.5) !important;">
                <div class="modal-body text-center" style="padding: 3rem 2rem;">
                    <!-- Animaci√≥n de confetti (usando emojis) -->
                    <div style="font-size: 3rem; margin-bottom: 1rem; animation: float 3s ease-in-out infinite;">
                        üéâ ‚ú® üéä
                    </div>
                    
                    <!-- √çcono del nivel -->
                    <div style="margin: 0 auto 1.5rem;">
                        <i id="levelUpIcon" class="fas fa-star"></i>
                    </div>
                    
                    <!-- Texto principal -->
                    <h2 style="color: white; font-weight: 700; font-size: 2rem; margin-bottom: 0.5rem;">
                        ¬°Nivel Alcanzado!
                    </h2>
                    
                    <div style="background: white; border: none; border-radius: 50px; padding: 0.5rem 1.5rem; display: inline-block; margin-bottom: 1rem; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                        <span id="levelUpNumberContainer" style="font-size: 1.5rem; font-weight: 700;">
                            Nivel <span id="levelUpNumber">2</span>
                        </span>
                    </div>
                    
                    <h3 id="levelUpName" style="color: white; font-weight: 600; font-size: 1.75rem; margin-bottom: 1.5rem;">
                        Aprendiz
                    </h3>
                    
                    <p style="color: rgba(255,255,255,0.9); font-size: 1.125rem; margin-bottom: 2rem; max-width: 400px; margin-left: auto; margin-right: auto;">
                        ¬°Felicitaciones! Has demostrado dedicaci√≥n y progreso constante en tu desarrollo personal.
                    </p>
                    
                    <!-- Bot√≥n cerrar -->
                    <button type="button" class="btn btn-light btn-lg" data-bs-dismiss="modal" style="border-radius: 12px; padding: 0.875rem 2.5rem; font-weight: 600; font-size: 1.125rem; background: white; color: #667eea; border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.25)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0,0,0,0.2)'">
                        <i class="fas fa-check me-2"></i>¬°Genial!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        #levelUpModal .modal-content {
            animation: modalZoomIn 0.5s ease-out;
        }
        
        @keyframes modalZoomIn {
            0% { transform: scale(0.7); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Estilos espec√≠ficos para el √≠cono del modal de level up */
        #levelUpIcon {
            font-family: "Font Awesome 6 Free" !important;
            font-weight: 900 !important;
            font-size: 3.5rem !important;
            color: white !important;
            line-height: 1 !important;
            width: auto !important;
            height: auto !important;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-style: normal !important;
            font-variant: normal !important;
            text-rendering: auto !important;
        }
        
        #levelUpIcon::before {
            font-family: "Font Awesome 6 Free" !important;
            font-weight: 900 !important;
            display: inline-block !important;
        }
        
        /* Forzar contenido de los iconos espec√≠ficos */
        #levelUpIcon.fa-seedling::before { content: "\f4d8" !important; }
        #levelUpIcon.fa-book::before { content: "\f02d" !important; }
        #levelUpIcon.fa-compass::before { content: "\f14e" !important; }
        #levelUpIcon.fa-running::before { content: "\f70c" !important; }
        #levelUpIcon.fa-medal::before { content: "\f5a2" !important; }
        #levelUpIcon.fa-crown::before { content: "\f521" !important; }
        #levelUpIcon.fa-gem::before { content: "\f3a5" !important; }
        #levelUpIcon.fa-star::before { content: "\f005" !important; }
        
        
        /* Asegurar contraste - SOLO para textos espec√≠ficos, NO para el badge */
        #levelUpModal .modal-body > h2,
        #levelUpModal .modal-body > h3,
        #levelUpModal .modal-body > p {
            color: white !important;
        }
    </style>

    <!-- Task Progress Modal -->
    <div class="modal fade" id="taskProgressModal" tabindex="-1" aria-labelledby="taskProgressModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body">
                    <form id="taskProgressForm">
                        <input type="hidden" id="taskId" />
                        
                        <div class="mb-2">
                            <label for="taskStatus" class="form-label">
                                <i class="fas fa-list-check"></i>
                                Estado de la Tarea
                            </label>
                            <select class="form-select" id="taskStatus" required>
                                <option value="pending">‚è∏Ô∏è Pendiente</option>
                                <option value="in_progress">‚ñ∂Ô∏è En Progreso</option>
                                <option value="completed">‚úÖ Completada</option>
                            </select>
                        </div>
                        
                        <div class="mb-2">
                            <label for="taskProgress" class="form-label">
                                <i class="fas fa-percent"></i>
                                Progreso
                            </label>
                            <input type="range" class="form-range" id="taskProgress" min="0" max="100" value="0">
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <span class="text-muted small">0%</span>
                                <span id="progressValue" class="badge bg-gradient" style="font-size: 0.9375rem; padding: 0.375rem 0.875rem;">0%</span>
                                <span class="text-muted small">100%</span>
                            </div>
                        </div>
                        
                        <div class="mb-2">
                            <label for="taskNotes" class="form-label">
                                <i class="fas fa-sticky-note"></i>
                                Notas (Opcional)
                            </label>
                            <textarea class="form-control" id="taskNotes" rows="1" placeholder="A√±ade comentarios sobre tu progreso..." style="resize: vertical; min-height: 38px;"></textarea>
                            <small class="text-muted d-block mt-1" style="font-size: 0.75rem;">
                                <i class="fas fa-info-circle me-1"></i>
                                Tu coach ver√° estos comentarios
                            </small>
                        </div>
                        
                        <!-- Botones dentro del modal-body -->
                        <div style="display: flex !important; gap: 0.5rem !important; margin-top: 1.5rem !important; visibility: visible !important; opacity: 1 !important;">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="flex: 1 !important; padding: 0.625rem 1.25rem !important; font-weight: 600 !important; border-radius: 8px !important; font-size: 0.875rem !important; background: #f3f4f6 !important; color: #374151 !important; border: 1px solid #e5e7eb !important; display: block !important;">
                                Cancelar
                            </button>
                            <button type="button" class="btn btn-task" onclick="saveTaskProgress()" style="flex: 1 !important; padding: 0.625rem 1.25rem !important; font-weight: 600 !important; border-radius: 8px !important; font-size: 0.875rem !important; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important; color: white !important; border: none !important; display: block !important;">
                                <i class="fas fa-save me-2"></i>
                                Guardar Progreso
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Solicitar Plan de Desarrollo - COMPACTO Y MODERNO -->
    <div class="modal fade" id="requestDevelopmentPlanModal" tabindex="-1" aria-labelledby="requestDevelopmentPlanModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content" style="max-height: 90vh; display: flex; flex-direction: column; border-radius: 16px; overflow: hidden;">
                <div class="modal-header modal-header-development" style="position: sticky; top: 0; z-index: 1050; flex-shrink: 0; display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.25rem;">
                    <h5 class="modal-title" id="requestDevelopmentPlanModalLabel" style="margin: 0;">
                        <i class="fas fa-road"></i>
                        <span>Plan de Desarrollo</span>
                    </h5>
                    <button type="button" class="btn btn-sm btn-light" data-bs-dismiss="modal" aria-label="Cerrar" style="margin: 0; padding: 0.375rem 0.75rem; background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; border-radius: 6px; font-size: 0.875rem; font-weight: 500; display: flex; align-items: center; gap: 0.375rem; transition: all 0.2s ease;">
                        <i class="fas fa-times"></i>
                        <span>Cerrar</span>
                    </button>
                </div>
                <div class="modal-body" style="padding: 1rem 1.25rem; overflow-y: auto; flex: 1 1 auto;">
                    <!-- Banner compacto con gradiente -->
                    <div class="alert alert-primary mb-3" style="padding: 0.875rem 1rem; border-radius: 8px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white;">
                        <div class="d-flex align-items-start">
                            <i class="fas fa-lightbulb" style="font-size: 1.5rem; margin-right: 0.75rem; margin-top: 0.125rem;"></i>
                            <div>
                                <strong style="font-size: 0.9375rem;">Plan Personalizado DISC</strong>
                                <p class="mb-0" style="font-size: 0.8125rem; opacity: 0.95; margin-top: 0.25rem;">Tu coach crear√° estrategias espec√≠ficas basadas en tu perfil</p>
                            </div>
                        </div>
                    </div>
                    
                    <form id="requestDevelopmentPlanForm">
                        <input type="hidden" id="planEvaluationId" />
                        <input type="hidden" id="planName" />
                        <input type="hidden" id="planEmail" />
                        
                        <!-- √Åreas de enfoque con badges -->
                        <div class="mb-3">
                            <label class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">
                                <i class="fas fa-chart-radar me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>√Åreas de Enfoque <span class="text-danger">*</span>
                            </label>
                            <div class="d-flex flex-wrap gap-2">
                                <div class="form-check-badge">
                                    <input class="form-check-input d-none" type="checkbox" id="focusCommunication" value="communication">
                                    <label class="badge-checkbox" for="focusCommunication">
                                        <i class="fas fa-comments me-1"></i>Comunicaci√≥n
                                    </label>
                                </div>
                                <div class="form-check-badge">
                                    <input class="form-check-input d-none" type="checkbox" id="focusLeadership" value="leadership">
                                    <label class="badge-checkbox" for="focusLeadership">
                                        <i class="fas fa-users me-1"></i>Liderazgo
                                    </label>
                                </div>
                                <div class="form-check-badge">
                                    <input class="form-check-input d-none" type="checkbox" id="focusDecision" value="decision">
                                    <label class="badge-checkbox" for="focusDecision">
                                        <i class="fas fa-sitemap me-1"></i>Decisiones
                                    </label>
                                </div>
                                <div class="form-check-badge">
                                    <input class="form-check-input d-none" type="checkbox" id="focusConflict" value="conflict">
                                    <label class="badge-checkbox" for="focusConflict">
                                        <i class="fas fa-handshake me-1"></i>Conflictos
                                    </label>
                                </div>
                                <div class="form-check-badge">
                                    <input class="form-check-input d-none" type="checkbox" id="focusEmotional" value="emotional">
                                    <label class="badge-checkbox" for="focusEmotional">
                                        <i class="fas fa-heart me-1"></i>Int. Emocional
                                    </label>
                                </div>
                                <div class="form-check-badge">
                                    <input class="form-check-input d-none" type="checkbox" id="focusProductivity" value="productivity">
                                    <label class="badge-checkbox" for="focusProductivity">
                                        <i class="fas fa-tasks me-1"></i>Productividad
                                    </label>
                                </div>
                            </div>
                            <small class="text-muted d-block mt-2" style="font-size: 0.75rem;">Selecciona una o m√°s √°reas</small>
                        </div>
                        
                        <!-- Prioridad compacta -->
                        <div class="mb-3">
                            <label for="planPriority" class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem;">
                                <i class="fas fa-flag me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>Prioridad <span class="text-danger">*</span>
                            </label>
                            <select class="form-select form-select-sm" id="planPriority" required
                                style="border-radius: 6px; padding: 0.5rem 0.75rem; font-size: 0.9375rem;">
                                <option value="">Seleccionar...</option>
                                <option value="low">üü¢ Baja - Largo plazo</option>
                                <option value="medium" selected>üü° Media - Gradual</option>
                                <option value="high">üî¥ Alta - Urgente</option>
                            </select>
                        </div>
                        
                        <!-- Secci√≥n colapsable para detalles opcionales -->
                        <div class="mb-2">
                            <button class="btn btn-link p-0 text-decoration-none" type="button" data-bs-toggle="collapse" data-bs-target="#planOptionalFields" aria-expanded="false" aria-controls="planOptionalFields" style="font-size: 0.875rem; color: #6b7280;">
                                <i class="fas fa-chevron-right me-1" id="planCollapseIcon"></i>
                                <span>Agregar objetivos y detalles (opcional)</span>
                            </button>
                        </div>
                        <div class="collapse" id="planOptionalFields">
                            <div class="row g-2">
                                <div class="col-12">
                                    <label for="planGoals" class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem;">
                                        <i class="fas fa-bullseye me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>Objetivos Espec√≠ficos
                                    </label>
                                    <textarea class="form-control form-control-sm" id="planGoals" rows="2" 
                                        placeholder="Ej: Mejorar delegaci√≥n, comunicaci√≥n asertiva..."
                                        style="border-radius: 6px; padding: 0.5rem 0.75rem; font-size: 0.875rem; resize: none;"></textarea>
                                </div>
                                <div class="col-12">
                                    <label for="planMessage" class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem;">
                                        <i class="fas fa-message me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>Contexto Adicional
                                    </label>
                                    <textarea class="form-control form-control-sm" id="planMessage" rows="2" 
                                        placeholder="Informaci√≥n que ayude a personalizar tu plan..."
                                        style="border-radius: 6px; padding: 0.5rem 0.75rem; font-size: 0.875rem; resize: none;"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Info compacta -->
                        <div class="mt-3 p-2" style="background: #f9fafb; border-radius: 6px; border-left: 3px solid #667eea;">
                            <small class="text-muted d-flex align-items-start" style="font-size: 0.75rem; line-height: 1.4;">
                                <i class="fas fa-info-circle me-2 mt-1" style="color: #667eea; flex-shrink: 0;"></i>
                                <span>Tu coach analizar√° tu evaluaci√≥n DISC y crear√° un plan personalizado. Recibir√°s notificaci√≥n cuando est√© listo.</span>
                            </small>
                        </div>
                        
                        <!-- Botones de acci√≥n -->
                        <div class="d-flex gap-2 mt-4" style="padding-top: 0.75rem; border-top: 1px solid #e5e7eb;">
                            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="border-radius: 8px; padding: 0.625rem 1.25rem; font-size: 0.9375rem; flex: 1;">
                                <i class="fas fa-times me-1"></i>Cancelar
                            </button>
                            <button type="button" class="btn btn-success" onclick="submitDevelopmentPlanRequest()" style="border-radius: 8px; padding: 0.625rem 1.5rem; font-size: 0.9375rem; font-weight: 600; flex: 1;">
                                <i class="fas fa-paper-plane me-1"></i>Enviar Solicitud
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        /* Estilos para badges de √°reas de enfoque */
        .form-check-badge .badge-checkbox {
            display: inline-block;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 500;
            border: 2px solid #d1d5db;
            border-radius: 20px;
            background: white;
            color: #374151;
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }
        
        .form-check-badge .badge-checkbox:hover {
            border-color: #667eea;
            background: #f5f7ff;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(102, 126, 234, 0.1);
        }
        
        .form-check-badge input[type="checkbox"]:checked + .badge-checkbox {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
        }
        
        /* Animaci√≥n del √≠cono de colapso para plan */
        #planOptionalFields.show ~ .mb-2 #planCollapseIcon {
            transform: rotate(90deg);
            transition: transform 0.2s ease;
        }
        
        #planOptionalFields.collapsing ~ .mb-2 #planCollapseIcon,
        #planOptionalFields:not(.show) ~ .mb-2 #planCollapseIcon {
            transform: rotate(0deg);
            transition: transform 0.2s ease;
        }
        
        /* Responsive adjustments para plan */
        @media (max-width: 576px) {
            #requestDevelopmentPlanModal .modal-dialog {
                margin: 0.5rem;
                max-width: calc(100% - 1rem);
            }
            
            #requestDevelopmentPlanModal .modal-content {
                max-height: 95vh !important;
                border-radius: 12px !important;
            }
            
            #requestDevelopmentPlanModal .modal-header {
                padding: 0.875rem 1rem !important;
            }
            
            #requestDevelopmentPlanModal .modal-header .modal-title {
                font-size: 1rem !important;
            }
            
            #requestDevelopmentPlanModal .modal-header .modal-title i {
                font-size: 1.125rem !important;
            }
            
            #requestDevelopmentPlanModal .modal-body {
                padding: 0.875rem 1rem !important;
            }
            
            #requestDevelopmentPlanModal .d-flex.gap-2.mt-4 {
                flex-direction: column;
                gap: 0.625rem !important;
            }
            
            #requestDevelopmentPlanModal .d-flex.gap-2.mt-4 button {
                width: 100%;
                padding: 0.75rem 1rem !important;
                font-size: 0.875rem !important;
            }
            
            #requestDevelopmentPlanModal .alert {
                padding: 0.75rem !important;
                font-size: 0.875rem !important;
            }
            
            #requestDevelopmentPlanModal .alert strong {
                font-size: 0.875rem !important;
            }
            
            #requestDevelopmentPlanModal .alert p {
                font-size: 0.75rem !important;
            }
            
            #requestDevelopmentPlanModal .form-label {
                font-size: 0.8125rem !important;
                margin-bottom: 0.25rem !important;
            }
            
            #requestDevelopmentPlanModal .form-control,
            #requestDevelopmentPlanModal .form-select {
                font-size: 0.875rem !important;
                padding: 0.5rem !important;
            }
            
            #requestDevelopmentPlanModal .row.g-2 {
                gap: 0.5rem !important;
            }
            
            .badge-checkbox {
                font-size: 0.75rem !important;
                padding: 0.375rem 0.75rem !important;
            }
            
            #requestDevelopmentPlanModal .d-flex.flex-wrap.gap-2 {
                gap: 0.5rem !important;
            }
            
            #requestDevelopmentPlanModal textarea {
                font-size: 0.8125rem !important;
            }
            
            #requestDevelopmentPlanModal small {
                font-size: 0.7rem !important;
            }
        }
        
        /* Para pantallas muy peque√±as */
        @media (max-width: 390px) {
            #requestDevelopmentPlanModal .modal-content {
                max-height: 98vh !important;
            }
            
            #requestDevelopmentPlanModal .modal-body {
                padding: 0.75rem !important;
            }
            
            #requestDevelopmentPlanModal .modal-header {
                padding: 0.75rem 0.875rem !important;
            }
            
            #requestDevelopmentPlanModal .modal-header .modal-title {
                font-size: 0.9375rem !important;
            }
            
            #requestDevelopmentPlanModal .d-flex.gap-2.mt-4 button {
                padding: 0.625rem 0.875rem !important;
                font-size: 0.8125rem !important;
            }
            
            .badge-checkbox {
                font-size: 0.7rem !important;
                padding: 0.3rem 0.625rem !important;
            }
        }
    </style>

    <!-- Modal: Ver Detalles del Plan de Desarrollo -->
    <div class="modal fade" id="viewDevelopmentPlanModal" tabindex="-1" aria-labelledby="viewDevelopmentPlanModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 16px; border: none; box-shadow: 0 20px 60px rgba(0,0,0,0.15);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); padding: 1.5rem; border-radius: 16px 16px 0 0; position: relative;">
                    <h5 style="margin: 0; color: white; font-weight: 600; font-size: 1.15rem; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-rocket" style="font-size: 1.25rem;"></i>
                        <span>Mi Plan de Desarrollo Personal</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" style="position: absolute; right: 1.5rem; top: 1.5rem;"></button>
                </div>
                
                <!-- Body -->
                <div class="modal-body" style="padding: 1.5rem; background: #fafafa; max-height: 70vh; overflow-y: auto;">
                    <!-- Plan Header Info -->
                    <div id="modalPlanHeader" style="background: white; border-radius: 12px; padding: 1.25rem; margin-bottom: 1.25rem; border: 1px solid #e5e7eb;">
                        <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                            <div>
                                <h6 style="font-size: 0.95rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem;">
                                    <i class="fas fa-calendar-alt me-2" style="color: #667eea;"></i>
                                    Plan creado el <span id="modalPlanDate"></span>
                                </h6>
                                <p style="font-size: 0.8rem; color: #6b7280; margin: 0;">
                                    <i class="fas fa-user-tie me-2"></i>
                                    Por: <strong id="modalCoachName"></strong>
                                </p>
                            </div>
                            <span id="modalPlanStatus" class="badge" style="font-size: 0.75rem; padding: 0.4rem 0.75rem;"></span>
                        </div>
                    </div>
                    
                    <!-- Objetivo Principal -->
                    <div id="modalPlanObjective" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem; border-left: 4px solid #3b82f6;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #1e40af; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-bullseye"></i>
                            <span>Objetivo Principal</span>
                        </h6>
                        <p id="modalObjectiveText" style="font-size: 0.875rem; color: #1e3a8a; margin: 0; line-height: 1.6;"></p>
                    </div>
                    
                    <!-- Situaci√≥n Actual -->
                    <div id="modalPlanSituation" style="background: white; border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem; border: 1px solid #e5e7eb;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #111827; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-compass" style="color: #f59e0b;"></i>
                            <span>Situaci√≥n Actual</span>
                        </h6>
                        <p id="modalSituationText" style="font-size: 0.875rem; color: #4b5563; margin: 0; line-height: 1.6;"></p>
                    </div>
                    
                    <!-- √Åreas de Desarrollo -->
                    <div id="modalPlanAreas" style="background: white; border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem; border: 1px solid #e5e7eb;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #111827; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-chart-line" style="color: #10b981;"></i>
                            <span>√Åreas de Desarrollo</span>
                        </h6>
                        <div id="modalAreasList" style="display: flex; flex-wrap: wrap; gap: 0.5rem;"></div>
                    </div>
                    
                    <!-- Acciones -->
                    <div id="modalPlanActions" style="background: white; border-radius: 10px; padding: 1.25rem; border: 1px solid #e5e7eb;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #111827; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-tasks" style="color: #8b5cf6;"></i>
                            <span>Plan de Acci√≥n</span>
                        </h6>
                        <div id="modalActionsList"></div>
                    </div>
                    
                    <!-- Indicadores de √âxito -->
                    <div id="modalPlanIndicators" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 10px; padding: 1.25rem; margin-top: 1.25rem; border-left: 4px solid #10b981;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #065f46; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-star"></i>
                            <span>Indicadores de √âxito</span>
                        </h6>
                        <ul id="modalIndicatorsList" style="margin: 0; padding-left: 1.5rem; color: #047857; font-size: 0.875rem; line-height: 1.8;"></ul>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="modal-footer" style="background: white; border-top: 1px solid rgba(0,0,0,0.08); padding: 1rem 1.5rem; border-radius: 0 0 16px 16px; gap: 0.75rem;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="font-size: 0.875rem; padding: 0.75rem 1.25rem; border-radius: 8px; font-weight: 600;">
                        <i class="fas fa-times me-1"></i>Cerrar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="printDevelopmentPlan()" style="font-size: 0.875rem; padding: 0.75rem 1.25rem; border-radius: 8px; font-weight: 600; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none;">
                        <i class="fas fa-print me-1"></i>Imprimir Plan
                    </button>
                </div>
            </div>
        </div>
    </div>

</div> <!-- Close container-fluid -->

    <script>
        // @ts-nocheck
        // ============================================
        // ALPINE.JS COACHEE DASHBOARD APP - V2 REACTIVE
        // ============================================
        
        // Toggle dropdown menu for feed header
        function toggleFeedDropdown(event) {
            event.stopPropagation();
            const menu = document.getElementById('feedProfileMenu');
            menu.style.display = menu.style.display === 'none' ? 'block' : 'none';
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('feedProfileDropdown');
            const menu = document.getElementById('feedProfileMenu');
            if (dropdown && !dropdown.contains(event.target)) {
                menu.style.display = 'none';
            }
        });
        
        // Funci√≥n para actualizar el avatar en el header
        function updateHeaderAvatar(avatarUrl, username) {
            const headerAvatar = document.getElementById('headerAvatar');
            if (!headerAvatar) return;
            
            if (avatarUrl) {
                headerAvatar.innerHTML = `<img src="${avatarUrl}" alt="${username}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
            } else {
                // Mostrar inicial del username si no hay avatar
                const initial = username ? username.charAt(0).toUpperCase() : 'U';
                headerAvatar.innerHTML = initial;
                headerAvatar.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            }
            
            // Actualizar mensaje de bienvenida
            const welcomeMessage = document.getElementById('welcomeMessageFeed');
            if (welcomeMessage && username) {
                welcomeMessage.textContent = username;
            }
        }
        
        // Detectar cuando Alpine.js est√° listo
        document.addEventListener('alpine:init', () => {
        });
        
        // API configuration
        const API_BASE_URL = window.location.origin;
        
        // DEBUG: Add debugging function
        function debugLog(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
        }
        
        // ============================================
        // ALPINE.JS COMPONENT
        // ============================================
        console.log('üì¶ [COACHEE] Definiendo window.coacheeDashboardApp...');
        window.coacheeDashboardApp = function() {
            console.log('‚ú® [COACHEE] Funci√≥n coacheeDashboardApp() llamada');
            
            // üõ°Ô∏è BOOT GUARD: Prevent double initialization
            if (window.__coacheeDashboardBooted) {
                console.warn('‚ö†Ô∏è Dashboard already booted, returning existing instance');
                return window.__dashboardInstance;
            }
            window.__coacheeDashboardBooted = true;
            
            const dashboardInstance = {
                // Estado Global
                activeTab: 'overview', // Mostrar overview por defecto
                evaluationsSubTab: 'disponibles', // Sub-tab para evaluaciones: disponibles, completadas, pendientes
                coacheeName: '',
                coacheeEmail: '',
                coacheeId: null,
                coacheeAvatar: '<i class="fas fa-user"></i>',
                coacheeAvatarUrl: null,
                
                // üåô Theme State
                isDarkTheme: false,
                
                // üì± UI State
                showDashboardDrawer: false,
                
                // Datos
                evaluationsData: null,
                evaluationsLastLoaded: null,
                evaluationCategories: {},
                evaluationHistory: null,
                progressData: null,
                pendingEvaluations: [],
                pendingEvaluationsLoaded: false,
                tasksData: [],
                tasksLastLoaded: null,
                isLoadingTasks: false,
                TASKS_CACHE_DURATION: 30000, // 30 segundos
                documentsData: [],
                videosData: [],
                developmentPlans: [],
                isAssessmentActive: false,
                
                // Filtro de contenido
                contentFilter: 'all', // 'all', 'video', 'document'
                contentSearch: '', // B√∫squeda de contenido
                selectedContent: null, // Para el modal de vista previa
                
                // Estad√≠sticas
                stats: {
                    completedEvaluations: 0,
                    pendingEvaluations: 0,
                    activeTasks: 0,
                    overdueTasks: 0,
                    latestEvaluationId: null  // ID de la √∫ltima evaluaci√≥n completada
                },
                
                // Estados de UI
                loading: {
                    evaluations: false,
                    tasks: false,
                    documents: false,
                    stats: false
                },
                
                // Constantes
                EVALUATIONS_CACHE_DURATION: 30000, // 30 segundos
                
                // Fecha/Hora actual
                currentDate: '',
                currentTime: '',
                
                // Propiedad computada para filtrar contenido
                get filteredContent() {
                    let filtered = this.videosData;
                    
                    // Filtrar por tipo (all, video, document)
                    if (this.contentFilter !== 'all') {
                        filtered = filtered.filter(item => item.type === this.contentFilter);
                    }
                    
                    // Filtrar por b√∫squeda de texto
                    if (this.contentSearch.trim() !== '') {
                        const searchLower = this.contentSearch.toLowerCase().trim();
                        filtered = filtered.filter(item => {
                            const titleMatch = item.title && item.title.toLowerCase().includes(searchLower);
                            const descMatch = item.description && item.description.toLowerCase().includes(searchLower);
                            return titleMatch || descMatch;
                        });
                    }
                    
                    return filtered;
                },
                
                // Inicializaci√≥n
                async init() {
                    try {
                        
                        // Restaurar pesta√±a activa desde localStorage o query param
                        const urlParams = new URLSearchParams(window.location.search);
                        const tabParam = urlParams.get('tab');
                        const savedTab = localStorage.getItem('coachee_activeTab');
                        
                        // Prioridad: 1) Query param, 2) localStorage, 3) default (overview)
                        if (tabParam) {
                            this.activeTab = tabParam;
                            localStorage.setItem('coachee_activeTab', tabParam);
                        } else if (savedTab) {
                            this.activeTab = savedTab;
                        }
                        // Alpine.js se encarga autom√°ticamente de mostrar/ocultar con x-show
                        // Alpine.js se encarga autom√°ticamente de mostrar/ocultar con x-show
                        
                        this.createParticles();
                        this.updateDateTime();
                        setInterval(() => this.updateDateTime(), 1000);
                        
                        // üåô Initialize Theme
                        this.initializeTheme();
                        
                        // IMPORTANTE: Inicializar funciones legacy PRIMERO para exponer window.evaluationCategories
                        this.initializeLegacyFunctions();
                        
                        // üöÄ OPTIMIZACI√ìN: Cargar todos los datos en una sola llamada
                        await this.loadDashboardData();
                        
                        // Cargar contenido espec√≠fico seg√∫n pesta√±a activa
                        // IMPORTANTE: Dar tiempo a Alpine.js para renderizar el DOM completamente
                        const currentTab = this.activeTab;
                        
                        // ‚úÖ VANILLA JS: Show the active tab after DOM is ready
                        setTimeout(() => {
                            console.log('üéØ Mostrando tab inicial:', currentTab);
                            this.showTab(currentTab);
                            
                            if (currentTab === 'overview') {
                                // Overview ya se carga con loadDashboardData, solo asegurar visibilidad
                                console.log('‚úÖ Overview visible y listo');
                            } else if (currentTab === 'evaluaciones-figma') {
                                // Cargar evaluaciones disponibles - ESPERAR A QUE EL DOM EXISTA
                                console.log('üîÑ Cargando evaluaciones disponibles...');
                                this.loadEvaluations();
                            } else if (currentTab === 'completed-evaluations') {
                                this.renderCompletedEvaluationsSection();
                            } else if (currentTab === 'content') {
                                this.loadVideos(false); // Usar cache si est√° disponible
                            } else if (currentTab === 'development-plan') {
                                this.loadDevelopmentPlans();
                            }
                        }, 300); // 300ms asegura que Alpine.js haya renderizado completamente el DOM
                        
                        // üî• WATCHER: Recargar PDFs cuando se vuelve a la pesta√±a de contenido
                        this.$watch('activeTab', (newTab, oldTab) => {
                            // Evitar procesamiento si el tab no cambi√≥ realmente
                            if (newTab === oldTab) return;
                            
                            // Cargar contenido espec√≠fico seg√∫n la pesta√±a
                            // Dar tiempo a Alpine.js para renderizar el DOM
                            setTimeout(() => {
                                if (newTab === 'evaluaciones-figma' && !this.evaluationsData) {
                                    console.log('üîÑ Cargando evaluaciones al cambiar de tab');
                                    this.loadEvaluations();
                                } else if (newTab === 'content' && oldTab !== 'content') {
                                    // Forzar recarga de todos los PDFs
                                    const pdfEmbeds = document.querySelectorAll('embed[type="application/pdf"]');
                                    pdfEmbeds.forEach(embed => {
                                        const currentSrc = embed.src;
                                        // Remover timestamp anterior y agregar uno nuevo
                                        const baseSrc = currentSrc.split('?')[0];
                                        const newSrc = `${baseSrc}?t=${Date.now()}#view=FitH`;
                                        embed.src = newSrc;
                                    });
                                }
                            }, 300); // 300ms asegura renderizado completo del DOM
                        });
                    } catch (error) {
                        console.error('‚ùå ERROR en init():', error);
                        console.error('Stack:', error.stack);
                    }
                },
                
                // Crear part√≠culas animadas
                createParticles() {
                    const particlesContainer = document.querySelector('.particles');
                    if (!particlesContainer) return;
                    
                    for (let i = 0; i < 30; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 20 + 's';
                        particle.style.width = particle.style.height = (Math.random() * 4 + 2) + 'px';
                        particle.style.animationDuration = (Math.random() * 10 + 20) + 's';
                        particlesContainer.appendChild(particle);
                    }
                },
                
                // Actualizar fecha y hora
                updateDateTime() {
                    const now = new Date();
                    const options = { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    };
                    this.currentDate = now.toLocaleDateString('es-ES', options);
                    this.currentTime = now.toLocaleTimeString('es-ES', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    });
                },
                
                // üåô Initialize Theme from localStorage
                initializeTheme() {
                    const savedTheme = localStorage.getItem('coachee_theme');
                    this.isDarkTheme = savedTheme === 'dark';
                    
                    if (this.isDarkTheme) {
                        document.documentElement.setAttribute('data-theme', 'dark');
                    } else {
                        document.documentElement.setAttribute('data-theme', 'light');
                    }
                    
                },
                
                // üåô Toggle Theme with Animation
                toggleTheme() {
                    this.isDarkTheme = !this.isDarkTheme;
                    
                    // Save to localStorage
                    localStorage.setItem('coachee_theme', this.isDarkTheme ? 'dark' : 'light');
                    
                    // Apply to document with smooth transition
                    if (this.isDarkTheme) {
                        document.documentElement.setAttribute('data-theme', 'dark');
                    } else {
                        document.documentElement.setAttribute('data-theme', 'light');
                    }
                    
                    
                    // Optional: Add a subtle animation feedback
                    const toggle = document.querySelector('.theme-toggle');
                    if (toggle) {
                        toggle.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            toggle.style.transform = '';
                        }, 150);
                    }
                },
                
                // NUEVA FUNCI√ìN OPTIMIZADA: Cargar todos los datos en una sola llamada
                async loadDashboardData() {
                    try {
                        console.log('üöÄ [LOAD] Llamando a /api/coachee/dashboard-init (endpoint optimizado)');
                        const response = await fetch('/api/coachee/dashboard-init');
                        
                        // Si el endpoint no existe (404), usar m√©todo legacy
                        if (response.status === 404) {
                            console.warn('‚ö†Ô∏è [LOAD] Endpoint optimizado no disponible, usando m√©todo legacy');
                            await this.loadUserProfile();
                            await this.loadEvaluations();
                            return;
                        }
                        
                        const data = await response.json();
                        console.log('üì¶ [LOAD] Respuesta recibida:', data);
                        
                        if (data.success) {
                            // 1. Cargar datos del perfil
                            if (data.profile) {
                                const profile = data.profile;
                                this.userName = profile.full_name || profile.username || 'Usuario';
                                this.coacheeName = profile.full_name || profile.username || 'Usuario'; // ‚úÖ Para Overview
                                this.userEmail = profile.email;
                                this.userRole = profile.role;
                                
                                if (profile.avatar_url) {
                                    this.userAvatar = `<img src="${profile.avatar_url}" alt="${this.userName}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                                } else {
                                    const initial = this.userName.charAt(0).toUpperCase();
                                    this.userAvatar = initial;
                                }
                                
                                if (profile.coach) {
                                    this.coachName = profile.coach.name;
                                    this.coachEmail = profile.coach.email;
                                }
                                
                                // Actualizar header avatar
                                this.updateHeaderAvatar(profile.avatar_url, this.userName);
                                
                                console.log('‚úÖ [LOAD] Perfil cargado:', this.userName);
                            }
                            
                            // 2. Cargar evaluaciones
                            if (data.evaluations) {
                                this.evaluationsData = data.evaluations;
                                this.evaluationsLastLoaded = Date.now();
                                
                                // Actualizar stats
                                if (data.evaluations.completed && Array.isArray(data.evaluations.completed)) {
                                    this.stats.completedEvaluations = data.evaluations.completed.length;
                                    if (data.evaluations.completed.length > 0) {
                                        this.stats.latestScore = data.evaluations.completed[0].score + '%' || '0%';
                                        this.stats.latestEvaluationId = data.evaluations.completed[0].id;
                                    }
                                }
                                
                                console.log(`‚úÖ [LOAD] Evaluaciones cargadas: ${data.evaluations.total_completed} completadas`);
                            }
                            
                            // 3. Cargar stats
                            if (data.stats) {
                                this.stats.pendingTasks = data.stats.pending_tasks_count || 0;
                                console.log('‚úÖ [LOAD] Stats cargadas');
                            }
                            
                            console.log('üéâ [LOAD] Todos los datos cargados en una sola llamada');
                        } else {
                            console.warn('‚ö†Ô∏è [LOAD] Respuesta sin success:true, usando m√©todo legacy');
                            await this.loadUserProfile();
                            await this.loadEvaluations();
                        }
                    } catch (error) {
                        console.error('‚ùå [LOAD] Error cargando dashboard data:', error);
                        console.log('üîÑ [LOAD] Fallback a m√©todo legacy');
                        try {
                            await this.loadUserProfile();
                            await this.loadEvaluations();
                        } catch (legacyError) {
                            console.error('‚ùå [LOAD] Error tambi√©n en m√©todo legacy:', legacyError);
                        }
                    }
                },
                
                // Cargar perfil de usuario (LEGACY - mantener para compatibilidad)
                async loadUserProfile() {
                    try {
                        
                        // Obtener del endpoint correcto
                        const response = await fetch('/api/coachee/profile');
                        
                        if (response.ok) {
                            const data = await response.json();
                            
                            // El endpoint devuelve {success: true, profile: {...}}
                            const profile = data.profile || data;
                            
                            this.coacheeName = profile.full_name || profile.username || 'Usuario';
                            this.coacheeEmail = profile.email || '';
                            this.coacheeId = profile.id || null;
                            this.coacheeAvatarUrl = profile.avatar_url || null;
                            
                            // Actualizar welcome message
                            const welcomeEl = document.getElementById('welcomeMessage');
                            if (welcomeEl) {
                                welcomeEl.textContent = this.coacheeName.split(' ')[0];
                            }
                            
                            // Generar avatar
                            this.generateAvatar();
                            
                        } else {
                            console.warn('‚ö†Ô∏è No se pudo cargar perfil, usando valores por defecto');
                            this.coacheeName = 'Usuario';
                        }
                        
                    } catch (error) {
                        console.error('‚ùå Error al cargar perfil:', error);
                        this.coacheeName = 'Usuario';
                    }
                },
                
                // Actualizar avatar en el header
                updateHeaderAvatar(avatarUrl, username) {
                    const headerAvatar = document.getElementById('headerAvatar');
                    if (!headerAvatar) return;
                    
                    if (avatarUrl) {
                        headerAvatar.innerHTML = `<img src="${avatarUrl}" alt="${username}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                    } else {
                        // Mostrar inicial del username si no hay avatar
                        const initial = username ? username.charAt(0).toUpperCase() : 'U';
                        headerAvatar.innerHTML = initial;
                        headerAvatar.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    }
                    
                    // Actualizar mensaje de bienvenida
                    const welcomeMessage = document.getElementById('welcomeMessageDashboard');
                    if (welcomeMessage && username) {
                        welcomeMessage.textContent = username;
                    }
                },
                
                // Generar avatar con imagen o iniciales
                generateAvatar() {
                    // Si hay imagen de avatar, usarla
                    if (this.coacheeAvatarUrl) {
                        this.coacheeAvatar = `
                            <img 
                                src="${this.coacheeAvatarUrl}" 
                                alt="${this.coacheeName}"
                                style="
                                    width: 100%;
                                    height: 100%;
                                    object-fit: cover;
                                    border-radius: 50%;
                                    border: none !important;
                                    outline: none !important;
                                "
                                onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-user\\' style=\\'border: none !important; outline: none !important; text-decoration: none !important; background: transparent !important;\\'></i>'"
                            >
                        `;
                    } else {
                        // Fallback: usar iniciales con color
                        const names = this.coacheeName.split(' ');
                        let initials = '';
                        
                        if (names.length >= 2) {
                            initials = names[0][0] + names[1][0];
                        } else if (names.length === 1) {
                            initials = names[0].substring(0, 2);
                        } else {
                            initials = 'U';
                        }
                        
                        const colors = [
                            { bg: '#667eea', text: '#ffffff' },
                            { bg: '#764ba2', text: '#ffffff' },
                            { bg: '#f093fb', text: '#ffffff' },
                            { bg: '#4facfe', text: '#ffffff' },
                            { bg: '#43e97b', text: '#ffffff' }
                        ];
                        
                        const colorIndex = this.coacheeName.charCodeAt(0) % colors.length;
                        const color = colors[colorIndex];
                        
                        this.coacheeAvatar = `
                            <div style="
                                width: 100%;
                                height: 100%;
                                background: ${color.bg};
                                color: ${color.text};
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-weight: 700;
                                font-size: 1rem;
                                border-radius: 50%;
                            ">
                                ${initials.toUpperCase()}
                            </div>
                        `;
                    }
                    
                    // Actualizar avatares en el DOM
                    const avatarElements = document.querySelectorAll('#headerAvatarDashboard, .user-avatar');
                    avatarElements.forEach(el => {
                        if (el) el.innerHTML = this.coacheeAvatar;
                    });
                },
                
                // Mantener funciones legacy para compatibilidad
                initializeLegacyFunctions() {
                    // Inicializar categor√≠as de evaluaciones
                    this.evaluationCategories = {
                        'Personalidad': {
                            color: '#6f42c1',
                            icon: 'fa-user-circle',
                            keywords: ['personalidad', 'disc', 'temperamento', 'car√°cter']
                        },
                        'Liderazgo': {
                            color: '#fd7e14',
                            icon: 'fa-crown',
                            keywords: ['liderazgo', 'l√≠der', 'gesti√≥n', 'direcci√≥n']
                        },
                        'Inteligencia Emocional': {
                            color: '#e83e8c',
                            icon: 'fa-heart',
                            keywords: ['emocional', 'emoci√≥n', 'sentimiento', 'asertividad']
                        },
                        'Trabajo en Equipo': {
                            color: '#20c997',
                            icon: 'fa-users',
                            keywords: ['equipo', 'colaboraci√≥n', 'grupo', 'cooperaci√≥n']
                        },
                        'Crecimiento Empresarial': {
                            color: '#17a2b8',
                            icon: 'fa-chart-line',
                            keywords: ['empresarial', 'negocio', 'crecer', 'crecimiento', '2026']
                        },
                        'Otros': {
                            color: '#6c757d',
                            icon: 'fa-clipboard-list',
                            keywords: []
                        }
                    };
                    
                    // Exponer categor√≠as y datos globalmente para legacy code
                    window.evaluationCategories = this.evaluationCategories;
                    window.evaluationsData = this.evaluationsData;
                    
                    // Las funciones globales existentes se mantendr√°n por ahora
                    // Se migrar√°n progresivamente en los siguientes pasos
                },
                
                // ============================================
                // M√âTODOS DE NAVEGACI√ìN (Alpine)
                // ============================================
                
                navigateToCompletedEvaluations() {
                    this.activeTab = 'completed-evaluations';
                    showTab('completed-evaluations');
                },
                
                navigateToLatestEvaluation() {
                    this.activeTab = 'completed-evaluations';
                    showTab('completed-evaluations');
                    
                    // Esperar a que se renderice la pesta√±a y luego hacer scroll
                    setTimeout(() => {
                        if (this.stats.latestEvaluationId) {
                            const card = document.querySelector(`[data-evaluation-id="${this.stats.latestEvaluationId}"]`);
                            if (card) {
                                // Expandir el accordion si est√° colapsado
                                const accordionButton = card.closest('.accordion-collapse')?.previousElementSibling?.querySelector('.accordion-button');
                                if (accordionButton && accordionButton.classList.contains('collapsed')) {
                                    accordionButton.click();
                                }
                                
                                // Scroll suave a la tarjeta
                                setTimeout(() => {
                                    card.scrollIntoView({ behavior: 'smooth', block: 'center' });
                                    
                                    // Efecto de highlight
                                    card.style.boxShadow = '0 0 0 3px rgba(59, 130, 246, 0.5)';
                                    card.style.transition = 'box-shadow 0.3s ease';
                                    setTimeout(() => {
                                        card.style.boxShadow = '';
                                    }, 2000);
                                }, 300);
                            }
                        }
                    }, 300);
                },
                
                navigateToTasks() {
                    this.activeTab = 'tasks';
                    showTab('tasks');
                },
                
                navigateToOverdueTasks() {
                    this.activeTab = 'tasks';
                    showTab('tasks');
                    // Despu√©s del cambio de tab, filtrar tareas vencidas
                    setTimeout(() => {
                        const overdueSection = document.querySelector('[data-section="overdue-tasks"]');
                        if (overdueSection) {
                            const elementPosition = overdueSection.getBoundingClientRect().top + window.pageYOffset;
                            const offsetPosition = elementPosition - (window.innerHeight * 0.1);
                            window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                        }
                    }, 300);
                },
                
                openChangePasswordModalCoachee() {
                    // Llamar a la funci√≥n legacy por ahora
                    if (typeof window.openChangePasswordModalCoachee === 'function') {
                        window.openChangePasswordModalCoachee();
                    }
                },
                
                // ============================================
                // SISTEMA DE NAVEGACI√ìN (Alpine)
                // ============================================
                
                showTab(tabId) {
                    console.log('üéØ showTab called:', tabId);
                    
                    // Colapsar categor√≠as de evaluaciones disponibles ANTES de cambiar de pesta√±a
                    if (this.activeTab === 'evaluations' && tabId !== 'evaluations') {
                        // Estamos saliendo de la pesta√±a de evaluaciones
                        const allCategories = document.querySelectorAll('#availableEvaluations .assessments-grid[data-expanded="true"]');
                        allCategories.forEach(categoryGrid => {
                            const categoryId = categoryGrid.id;
                            const icon = document.getElementById(`icon-${categoryId}`);
                            
                            categoryGrid.style.maxHeight = '0px';
                            categoryGrid.style.opacity = '0';
                            categoryGrid.style.marginBottom = '0px';
                            if (icon) {
                                icon.style.transform = 'rotate(-90deg)';
                            }
                            categoryGrid.setAttribute('data-expanded', 'false');
                        });
                    }
                    
                    // ‚úÖ VANILLA JS: Hide ALL tab-panes first (like coach dashboard)
                    document.querySelectorAll('.tab-pane').forEach(pane => {
                        pane.style.display = 'none';
                    });
                    
                    // ‚úÖ VANILLA JS: Show selected tab-pane
                    const selectedPane = document.getElementById(tabId);
                    if (selectedPane) {
                        selectedPane.style.display = 'block';
                        console.log('‚úÖ Tab displayed:', tabId);
                    } else {
                        console.error('‚ùå Tab not found:', tabId);
                    }
                    
                    // Update activeTab for tracking and :class bindings
                    this.activeTab = tabId;
                    
                    // Guardar pesta√±a activa en localStorage
                    localStorage.setItem('coachee_activeTab', tabId);
                    
                    // üîß FORCE: Ensure col-md-9 always has zero padding
                    setTimeout(() => {
                        const contentArea = document.querySelector('.col-md-9');
                        if (contentArea) {
                            contentArea.style.setProperty('padding', '0', 'important');
                            contentArea.style.setProperty('padding-left', '0', 'important');
                            contentArea.style.setProperty('padding-right', '0', 'important');
                            contentArea.style.setProperty('padding-top', '0', 'important');
                            contentArea.style.setProperty('padding-bottom', '0', 'important');
                        }
                    }, 10);
                    
                    // üì± Scroll to tab header (not body) for better visibility
                    setTimeout(() => {
                        // Solo hacer scroll en m√≥vil
                        const isMobile = window.innerWidth <= 768;
                        if (!isMobile) return; // No hacer scroll en desktop
                        
                        // Buscar el header del tab activo
                        const activeTabPane = document.getElementById(tabId);
                        if (activeTabPane) {
                            // Intentar encontrar el header dentro del tab
                            const tabHeader = activeTabPane.querySelector('.evaluations-header, .completed-evaluations-header, header');
                            
                            if (tabHeader) {
                                // Scroll al header del tab con offset m√≥vil
                                const headerTop = tabHeader.getBoundingClientRect().top + window.pageYOffset;
                                const offset = window.innerHeight * 0.2;  // 20% en m√≥vil
                                
                                window.scrollTo({
                                    top: headerTop - offset,
                                    behavior: 'smooth'
                                });
                            } else {
                                // Fallback: scroll al tab-pane completo con offset m√≥vil
                                const paneTop = activeTabPane.getBoundingClientRect().top + window.pageYOffset;
                                const offset = window.innerHeight * 0.2;
                                
                                window.scrollTo({
                                    top: paneTop - offset,
                                    behavior: 'smooth'
                                });
                            }
                        }
                    }, 150);
                    
                    // Cargar contenido espec√≠fico seg√∫n la pesta√±a
                    if (tabId === 'evaluations') {
                        // üî• ALPINE: Cargar evaluaciones disponibles
                        this.loadEvaluations();
                    } else if (tabId === 'evaluaciones-figma') {
                        // üî• ALPINE: Cargar evaluaciones Figma y renderizar solo stats
                        this.loadEvaluations().then(() => {
                            if (typeof renderFigmaStats === 'function') {
                                renderFigmaStats();
                            }
                        });
                    } else if (tabId === 'tasks') {
                        // üî• ALPINE: Cargar tareas (con cache autom√°tico)
                        this.loadTasks();
                    } else if (tabId === 'content') {
                        // üî• ALPINE: Cargar contenido (con cache autom√°tico)
                        this.loadVideos();
                    } else if (tabId === 'progress') {
                        // üî• ALPINE: Cargar progreso directamente (evitar duplicaci√≥n)
                        this.loadAllAssessmentHistory();
                    } else if (tabId === 'completed-evaluations') {
                        // üî• ALPINE: Renderizar evaluaciones completadas
                        this.renderCompletedEvaluationsSection();
                    } else if (tabId === 'pending-evaluations') {
                        // üî• ALPINE: Cargar evaluaciones pendientes
                        this.loadPendingEvaluations();
                    } else if (tabId === 'development-plan') {
                        // üî• ALPINE: Cargar planes de desarrollo
                        this.loadDevelopmentPlans();
                    } else if (tabId === 'schedule-coach') {
                        // üî• ALPINE: Cargar disponibilidad del coach y sesiones
                        setTimeout(() => {
                            this.switchScheduleTab('request');
                        }, 100);
                    }
                    
                },
                
                // ============================================
                // EVALUACIONES DISPONIBLES (Alpine)
                // ============================================
                
                async loadEvaluations(forceRefresh = false) {
                    // OPTIMIZACI√ìN: Evitar carga duplicada
                    if (this.loading.evaluations) {
                        return;
                    }
                    
                    // OPTIMIZACI√ìN: Usar cache si los datos son recientes
                    if (!forceRefresh && this.evaluationsData && this.evaluationsLastLoaded) {
                        const age = Date.now() - this.evaluationsLastLoaded;
                        if (age < this.EVALUATIONS_CACHE_DURATION) {
                            this.renderAvailableEvaluations();
                            return;
                        }
                    }
                    
                    this.loading.evaluations = true;
                    
                    try {
                        debugLog('üîç ALPINE: Iniciando carga de evaluaciones...');
                        const response = await fetch(`${API_BASE_URL}/api/coachee/evaluations`);
                        
                        debugLog(`üì° Response status: ${response.status} ${response.statusText}`);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        debugLog('üì¶ Datos de evaluaciones recibidos:', data);
                        
                        if (data && typeof data === 'object') {
                            this.evaluationsData = data; // {available: {}, completed: []}
                            this.evaluationsLastLoaded = Date.now();
                            
                            // Actualizar stats
                            if (data.completed && Array.isArray(data.completed)) {
                                this.stats.completedEvaluations = data.completed.length;
                                if (data.completed.length > 0) {
                                    this.stats.latestScore = data.completed[0].score + '%' || '0%';
                                    this.stats.latestEvaluationId = data.completed[0].id; // Guardar ID
                                }
                            }
                            
                            // Exponer globalmente para legacy code
                            window.evaluationsData = this.evaluationsData;
                            
                            // ‚úÖ Renderizar evaluaciones con dise√±o Figma (Alpine.js)
                            debugLog('‚úÖ Renderizando evaluaciones disponibles...');
                            this.renderAvailableEvaluations();
                        } else {
                            console.error('Formato de datos inesperado:', data);
                            throw new Error('Formato de datos inesperado del servidor');
                        }
                    } catch (error) {
                        debugLog('‚ùå Error cargando evaluaciones', error);
                        console.error('Error cargando evaluaciones:', error);
                        if (typeof showToast === 'function') {
                            showToast('Error cargando evaluaciones: ' + error.message, 'error');
                        }
                        
                        // Inicializar con datos vac√≠os
                        this.evaluationsData = { available: {}, completed: [] };
                        
                        // Show error in container
                        const container = document.getElementById('availableEvaluations');
                        if (container) {
                            container.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando mis evaluaciones disponibles</p></div>';
                        }
                    } finally {
                        this.loading.evaluations = false;
                    }
                },
                
                renderAvailableEvaluations() {
                    console.log('üé® Renderizando evaluaciones con dise√±o Figma...');
                    
                    // ‚úÖ CR√çTICO: Si window.evaluationsData ya existe (cargado por legacy loadEvaluations),
                    // usarlo directamente en lugar del state de Alpine.js
                    // Esto evita problemas con el Proxy reactivo que pierde la estructura de datos
                    if (window.evaluationsData && typeof window.evaluationsData === 'object') {
                        console.log('üì¶ Usando evaluationsData de window (ya cargado por API)');
                        
                        // Renderizar stats de Figma con datos del servidor
                        if (typeof renderFigmaStats === 'function') {
                            console.log('üìä Llamando a renderFigmaStats con datos del servidor...');
                            renderFigmaStats();
                        }
                        
                        console.log('‚úÖ Evaluaciones renderizadas exitosamente (desde window)');
                        return;
                    }
                    
                    // Fallback: usar datos de Alpine.js si window.evaluationsData no existe
                    console.log('üì¶ Usando evaluationsData de Alpine.js (fallback)');
                    
                    // Verificar mensaje espec√≠fico
                    if (this.evaluationsData && this.evaluationsData.message) {
                        console.warn('‚ö†Ô∏è Mensaje del servidor:', this.evaluationsData.message);
                        return;
                    }
                    
                    // ‚úÖ FIX: Validar que haya ALG√öN dato (completadas O disponibles)
                    const hasAvailable = this.evaluationsData?.available && Object.keys(this.evaluationsData.available).length > 0;
                    const hasCompleted = this.evaluationsData?.completed && Array.isArray(this.evaluationsData.completed) && this.evaluationsData.completed.length > 0;
                    
                    if (!this.evaluationsData || (!hasAvailable && !hasCompleted)) {
                        console.warn('‚ö†Ô∏è No hay evaluaciones disponibles ni completadas');
                        return;
                    }
                    
                    console.log(`üìä Datos: ${hasCompleted ? this.evaluationsData.completed.length : 0} completadas, ${hasAvailable ? Object.keys(this.evaluationsData.available).length : 0} disponibles`);
                    
                    // ‚úÖ FIX: Hacer deep copy de los datos para evitar Proxy de Alpine.js
                    window.evaluationsData = JSON.parse(JSON.stringify(this.evaluationsData));
                    
                    // ‚úÖ Renderizar stats de Figma
                    if (typeof renderFigmaStats === 'function') {
                        console.log('üìä Llamando a renderFigmaStats...');
                        renderFigmaStats();
                    }
                    
                    console.log('‚úÖ Evaluaciones renderizadas exitosamente');
                },
                
                // ============================================
                // EVALUACIONES COMPLETADAS (Alpine)
                // ============================================
                // EVALUACIONES COMPLETADAS (Alpine)
                // ============================================
                
                renderCompletedEvaluationsSection() {
                    
                    const container = document.getElementById('completedEvaluationsSection');
                    if (!container) {
                        console.error('‚ùå Container completedEvaluationsSection NO ENCONTRADO');
                        return;
                    }
                    
                    
                    // Exponer globalmente para legacy code (ambas formas)
                    window.evaluationsData = this.evaluationsData;
                    evaluationsData = this.evaluationsData;
                    
                    // Si no hay datos, mostrar estado vac√≠o
                    if (!this.evaluationsData || !this.evaluationsData.completed || this.evaluationsData.completed.length === 0) {
                        container.innerHTML = `
                            <div style="text-align: center; padding: 3rem 1.25rem;">
                                <div style="font-size: 4rem; color: #9ca3af; margin-bottom: 1rem;">
                                    <i class="fas fa-clipboard-check"></i>
                                </div>
                                <h3 style="color: #000000; font-size: 1.125rem; margin-bottom: 0.5rem; font-weight: 700;">
                                    Sin evaluaciones completadas
                                </h3>
                                <p style="color: #000000; font-size: 0.875rem;">
                                    A√∫n no has completado ninguna evaluaci√≥n
                                </p>
                            </div>
                        `;
                        return;
                    }
                    
                    // Llamar a funci√≥n legacy para renderizar
                    
                    if (typeof renderCompletedEvaluationsLegacy === 'function') {
                        renderCompletedEvaluationsLegacy();
                    } else {
                        console.error('‚ùå renderCompletedEvaluationsLegacy no est√° disponible');
                    }
                },
                
                async loadEvaluationHistory() {
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-history`);
                        const data = await response.json();
                        
                        
                        if (response.ok) {
                            this.evaluationHistory = data.history || [];
                            this.progressData = data.progress_data || null;
                            
                            
                            // üî• ALPINE: Cargar gr√°fico de progreso completo
                            await this.loadAllAssessmentHistory();
                            
                        } else {
                            throw new Error(data.error);
                        }
                    } catch (error) {
                        console.error('‚ùå Error cargando historial:', error);
                        if (typeof showToast === 'function') {
                            showToast('Error cargando historial de evaluaciones', 'error');
                        }
                    }
                },
                
                // ============================================
                // EVALUACIONES PENDIENTES (Alpine)
                // ============================================
                
                async loadPendingEvaluations() {
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/pending-evaluations`);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.pendingEvaluations = data.pending_evaluations || [];
                            this.pendingEvaluationsLoaded = true;
                            
                            // Exponer globalmente para legacy code
                            window.pendingEvaluations = this.pendingEvaluations;
                            
                            this.displayPendingEvaluations();
                        } else {
                            throw new Error(data.error || 'Error desconocido');
                        }
                    } catch (error) {
                        console.error('‚ùå ALPINE: Error cargando evaluaciones pendientes:', error);
                        const container = document.getElementById('pendingEvaluationsSection');
                        if (container) {
                            container.innerHTML = `
                                <div class="text-center py-5">
                                    <i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 3rem;"></i>
                                    <h5 class="text-muted mb-2">Error al cargar</h5>
                                    <p class="text-muted small">No se pudieron cargar las evaluaciones pendientes</p>
                                </div>
                            `;
                        }
                    }
                },
                
                displayPendingEvaluations() {
                    
                    // Exponer globalmente
                    window.pendingEvaluations = this.pendingEvaluations;
                    
                    // Llamar funci√≥n legacy
                    if (typeof displayPendingEvaluationsLegacy === 'function') {
                        displayPendingEvaluationsLegacy();
                    } else {
                        console.error('‚ùå displayPendingEvaluationsLegacy no disponible');
                    }
                },
                
                // ============================================
                // TASKS (Alpine)
                // ============================================
                
                async loadTasks(forceRefresh = false) {
                    
                    // Evitar carga duplicada
                    if (this.isLoadingTasks) {
                        return;
                    }
                    
                    // Usar cache si los datos son recientes
                    if (!forceRefresh && this.tasksData && this.tasksData.length > 0 && this.tasksLastLoaded) {
                        const age = Date.now() - this.tasksLastLoaded;
                        if (age < this.TASKS_CACHE_DURATION) {
                            this.renderTasks();
                            return;
                        }
                    }
                    
                    this.isLoadingTasks = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/tasks`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        
                        if (Array.isArray(data)) {
                            this.tasksData = data;
                            this.tasksLastLoaded = Date.now();
                            
                            // Calcular estad√≠sticas de tareas
                            const now = new Date();
                            let activeTasks = 0;
                            let overdueTasks = 0;
                            
                            data.forEach(task => {
                                // Contar tareas pendientes (status: pending, in_progress)
                                if (task.status === 'pending' || task.status === 'in_progress') {
                                    activeTasks++;
                                    
                                    // Verificar si est√° vencida
                                    if (task.due_date) {
                                        const dueDate = new Date(task.due_date);
                                        if (dueDate < now) {
                                            overdueTasks++;
                                        }
                                    }
                                }
                            });
                            
                            // Actualizar stats
                            this.stats.activeTasks = activeTasks;
                            this.stats.overdueTasks = overdueTasks;
                            
                            
                            // Exponer globalmente para legacy code
                            window.tasksData = this.tasksData;
                            
                            this.renderTasks();
                        } else {
                            console.error('Formato de datos inesperado para tareas:', data);
                            throw new Error('Formato de datos inesperado del servidor');
                        }
                    } catch (error) {
                        console.error('‚ùå ALPINE: Error cargando tareas:', error);
                        if (typeof showToast === 'function') {
                            showToast('Error cargando tareas: ' + error.message, 'error');
                        }
                        
                        this.tasksData = [];
                        
                        const container = document.getElementById('tasksContainer');
                        if (container) {
                            container.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando tareas</p></div>';
                        }
                    } finally {
                        this.isLoadingTasks = false;
                    }
                },
                
                renderTasks() {
                    
                    // Exponer globalmente
                    window.tasksData = this.tasksData;
                    
                    // Llamar funci√≥n legacy
                    if (typeof renderTasksLegacy === 'function') {
                        renderTasksLegacy();
                    } else {
                        console.error('‚ùå renderTasksLegacy no disponible');
                    }
                },
                
                // ============================================
                // CONTENIDO (Alpine) - SIMPLIFICADO
                // ============================================
                
                videosData: [],
                videosLastLoaded: null,
                isLoadingVideos: false,
                CONTENT_CACHE_DURATION: 300000, // 5 minutos
                
                // Cargar videos y documentos
                async loadVideos(forceRefresh = false) {
                    
                    // Evitar carga duplicada
                    if (this.isLoadingVideos) {
                        return;
                    }
                    
                    // Usar cache
                    if (!forceRefresh && this.videosData && this.videosData.length > 0 && this.videosLastLoaded) {
                        const age = Date.now() - this.videosLastLoaded;
                        if (age < this.CONTENT_CACHE_DURATION) {
                            return;
                        }
                    }
                    
                    this.isLoadingVideos = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/content`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        this.videosData = data.content || [];
                        this.videosLastLoaded = Date.now();
                        
                        
                        // Forzar actualizaci√≥n del estado de carga
                        this.isLoadingVideos = false;
                        
                        // Seleccionar autom√°ticamente el primer contenido si existe
                        if (this.videosData.length > 0 && !this.selectedContent) {
                            const firstContent = this.videosData[0];
                            
                            // Usar setTimeout para asegurarse de que el DOM est√° listo
                            setTimeout(() => {
                                this.selectContentForPreview(firstContent);
                            }, 100);
                        }
                    } catch (error) {
                        console.error('‚ùå ALPINE: Error loading content:', error);
                        this.videosData = [];
                        this.isLoadingVideos = false;
                    }
                },
                
                // Marcar contenido como visto
                async markContentAsViewed(contentId) {
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/content/${contentId}/mark-viewed`, {
                            method: 'POST',
                            credentials: 'include',
                            headers: {
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        // Actualizar el estado local
                        const item = this.videosData.find(v => v.id === contentId);
                        if (item) {
                            item.is_viewed = true;
                        }
                        
                        
                        if (typeof showToast === 'function') {
                            showToast('Contenido marcado como visto', 'success');
                        }
                    } catch (error) {
                        console.error('‚ùå Error marking content as viewed:', error);
                        if (typeof showToast === 'function') {
                            showToast('Error al marcar contenido', 'error');
                        }
                    }
                },
                
                // Seleccionar contenido para vista previa
                selectContentForPreview(item) {
                    
                    // Marcar como visto si no lo est√°
                    if (!item.is_viewed) {
                        this.markContentAsViewed(item.id);
                    }
                    
                    // Guardar el contenido seleccionado
                    this.selectedContent = item;
                    
                    
                    // Si es video, actualizar la vista previa
                    if (item.type === 'video' && item.video_id) {
                        this.updateVideoPreview(item.video_id, item.video_platform);
                    }
                    
                    // Si es documento, asegurarse de que Alpine.js actualice la vista
                    if (item.type === 'document') {
                        // Forzar actualizaci√≥n de Alpine
                        this.$nextTick(() => {
                        });
                    }
                },
                
                // Actualizar vista previa de video con iframe
                updateVideoPreview(videoId, platform = 'youtube') {
                    const container = document.getElementById('videoPreviewContainer');
                    if (!container) return;
                    
                    
                    // Limpiar contenido previo
                    container.innerHTML = '';
                    
                    // Crear iframe seg√∫n la plataforma
                    const iframe = document.createElement('iframe');
                    iframe.style.position = 'absolute';
                    iframe.style.top = '0';
                    iframe.style.left = '0';
                    iframe.style.width = '100%';
                    iframe.style.height = '100%';
                    iframe.frameBorder = '0';
                    iframe.allowFullscreen = true;
                    
                    if (platform === 'instagram') {
                        // Instagram embed
                        iframe.src = `https://www.instagram.com/p/${videoId}/embed/`;
                        iframe.allow = 'encrypted-media';
                        iframe.setAttribute('scrolling', 'no');
                        iframe.setAttribute('allowtransparency', 'true');
                        // Para Instagram, ajustar el contenedor
                        container.style.paddingTop = '125%'; // Instagram es m√°s alto
                    } else {
                        // YouTube embed (default) - sin autoplay
                        iframe.src = `https://www.youtube.com/embed/${videoId}?rel=0`;
                        iframe.allow = 'accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture';
                        container.style.paddingTop = '56.25%'; // 16:9 ratio
                    }
                    
                    container.appendChild(iframe);
                },
                
                // Formatear fecha
                formatDate(dateString) {
                    if (!dateString) return 'Sin fecha';
                    
                    try {
                        const date = new Date(dateString);
                        const now = new Date();
                        const diffTime = Math.abs(now - date);
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        
                        if (diffDays === 0) {
                            return 'Hoy';
                        } else if (diffDays === 1) {
                            return 'Ayer';
                        } else if (diffDays < 7) {
                            return `Hace ${diffDays} d√≠as`;
                        } else {
                            return date.toLocaleDateString('es-ES', { 
                                day: '2-digit', 
                                month: 'short',
                                year: 'numeric'
                            });
                        }
                    } catch (error) {
                        console.error('Error formateando fecha:', error);
                        return 'Sin fecha';
                    }
                },
                
                // ============================================
                // PROGRESS (Alpine) - PASO 8
                // ============================================
                
                allAssessmentHistory: null,
                isLoadingProgress: false,
                progressChart: null,
                
                resetProgressChartFilters() {
                    if (this.progressChart) {
                        this.progressChart.data.datasets.forEach(dataset => {
                            dataset.hidden = false;
                        });
                        this.progressChart.update();
                    }
                },
                progressDataLoaded: false, // Cache flag para evitar recargas
                progressStatistics: {
                    totalEvaluations: 0,
                    averageScore: 0,
                    bestScore: 0
                },
                
                // Cargar historial completo de todas las evaluaciones
                async loadAllAssessmentHistory(forceRefresh = false) {
                    
                    // Si ya se carg√≥ y no se fuerza refresh, no volver a cargar
                    if (this.progressDataLoaded && !forceRefresh && this.allAssessmentHistory) {
                        return;
                    }
                    
                    if (this.isLoadingProgress) {
                        return;
                    }
                    
                    this.isLoadingProgress = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/all-assessment-history`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.success && data.history && Object.keys(data.history).length > 0) {
                            this.allAssessmentHistory = data.history;
                            this.progressDataLoaded = true; // Marcar como cargado
                            
                            // Convertir estad√≠sticas de snake_case a camelCase
                            if (data.statistics) {
                                this.progressStatistics = {
                                    totalEvaluations: data.statistics.total_evaluations || 0,
                                    averageScore: data.statistics.average_score || 0,
                                    bestScore: data.statistics.best_score || 0,
                                    worstScore: data.statistics.worst_score || 0
                                };
                            }
                            
                            
                            // Exponer globalmente
                            window.allAssessmentHistory = this.allAssessmentHistory;
                            
                            // Renderizar gr√°fico
                            this.renderProgressChart();
                        } else {
                            // No hay datos
                            this.showEmptyProgressState();
                        }
                    } catch (error) {
                        console.error('‚ùå ALPINE: Error loading progress:', error);
                        this.showEmptyProgressState();
                        this.isLoadingProgress = false;
                    }
                },
                
                // Renderizar gr√°fico de progreso
                renderProgressChart() {
                    
                    // Exponer globalmente
                    window.allAssessmentHistory = this.allAssessmentHistory;
                    
                    // Forzar la creaci√≥n inmediata del gr√°fico
                    // Alpine ya deber√≠a haber actualizado el DOM en este punto
                    this.createProgressChart();
                },
                
                // Crear el gr√°fico de progreso con Chart.js (NUEVA VERSI√ìN CON FECHAS)
                createProgressChart() {
                    try {
                        const canvas = document.getElementById('alpineProgressChart');
                        
                        if (!canvas) {
                            console.error('‚ùå Canvas alpineProgressChart no encontrado');
                            this.isLoadingProgress = false;
                            return;
                        }
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Destruir gr√°fico anterior si existe
                        if (this.progressChart) {
                            this.progressChart.destroy();
                        }
                        
                        
                        // Colores para diferentes evaluaciones
                        const colors = [
                            { border: '#10b981', bg: 'rgba(16, 185, 129, 0.1)' },    // Verde
                            { border: '#3b82f6', bg: 'rgba(59, 130, 246, 0.1)' },    // Azul
                            { border: '#f59e0b', bg: 'rgba(245, 158, 11, 0.1)' },    // Naranja
                            { border: '#ef4444', bg: 'rgba(239, 68, 68, 0.1)' },     // Rojo
                            { border: '#8b5cf6', bg: 'rgba(139, 92, 246, 0.1)' },    // P√∫rpura
                            { border: '#ec4899', bg: 'rgba(236, 72, 153, 0.1)' }     // Rosa
                        ];
                        
                        // Crear datasets para cada tipo de evaluaci√≥n
                        const datasets = [];
                        let colorIndex = 0;
                        
                        Object.entries(this.allAssessmentHistory).forEach(([assessmentId, assessmentData]) => {
                            const color = colors[colorIndex % colors.length];
                            colorIndex++;
                            
                            datasets.push({
                                label: assessmentData.title,
                                data: assessmentData.data.map(item => ({
                                    x: new Date(item.completed_at),  // Usar fecha/hora real
                                    y: item.percentage
                                })),
                                borderColor: color.border,
                                backgroundColor: color.bg,
                                borderWidth: 3,
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                pointBackgroundColor: color.border,
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointHoverBackgroundColor: color.border,
                                pointHoverBorderColor: '#ffffff',
                                tension: 0.4,
                                fill: false,
                                showLine: true,
                                spanGaps: true,
                                metadata: assessmentData.data
                            });
                        });
                        
                        
                        // Crear el gr√°fico con eje X de tiempo
                        this.progressChart = new Chart(ctx, {
                            type: 'line',
                            data: { datasets },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: {
                                    mode: 'nearest',
                                    intersect: false,
                                    axis: 'x'
                                },
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'top',
                                        labels: {
                                            usePointStyle: true,
                                            padding: 15,
                                            font: {
                                                size: 12,
                                                family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                                                weight: '500'
                                            },
                                            boxWidth: 10,
                                            boxHeight: 10
                                        },
                                        onClick: function(e, legendItem, legend) {
                                            const index = legendItem.datasetIndex;
                                            const chart = legend.chart;
                                            const dataset = chart.data.datasets[index];
                                            
                                            // Verificar si todas est√°n visibles (estado inicial/limpio)
                                            const allVisible = chart.data.datasets.every(ds => !ds.hidden);
                                            
                                            if (allVisible) {
                                                // Si todas est√°n visibles, ocultar todas excepto la clickeada
                                                chart.data.datasets.forEach((ds, i) => {
                                                    ds.hidden = (i !== index);
                                                });
                                            } else {
                                                // Si ya hay filtro activo, toggle de la clickeada
                                                dataset.hidden = !dataset.hidden;
                                                
                                                // Si todas quedan ocultas, mostrar todas
                                                const allHidden = chart.data.datasets.every(ds => ds.hidden);
                                                if (allHidden) {
                                                    chart.data.datasets.forEach(ds => {
                                                        ds.hidden = false;
                                                    });
                                                }
                                            }
                                            
                                            chart.update();
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        titleColor: '#fff',
                                        bodyColor: '#fff',
                                        borderColor: 'rgba(255, 255, 255, 0.3)',
                                        borderWidth: 1,
                                        padding: 12,
                                        displayColors: true,
                                        callbacks: {
                                            title: function(context) {
                                                const date = new Date(context[0].parsed.x);
                                                const dateStr = date.toLocaleDateString('es-ES', { 
                                                    weekday: 'short',
                                                    day: '2-digit', 
                                                    month: 'short',
                                                    year: 'numeric'
                                                });
                                                const timeStr = date.toLocaleTimeString('es-ES', {
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                });
                                                return `${dateStr} - ${timeStr}`;
                                            },
                                            label: function(context) {
                                                return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}%`;
                                            },
                                            afterLabel: function(context) {
                                                const datasetData = context.dataset.metadata;
                                                if (datasetData && datasetData.length > 1) {
                                                    return `Intento ${context.dataIndex + 1} de ${datasetData.length}`;
                                                }
                                                return '';
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    x: {
                                        type: 'time',
                                        time: {
                                            unit: 'hour',
                                            displayFormats: {
                                                hour: 'dd MMM HH:mm',
                                                day: 'dd MMM',
                                                minute: 'dd MMM HH:mm'
                                            },
                                            tooltipFormat: 'dd/MM/yyyy HH:mm'
                                        },
                                        title: {
                                            display: true,
                                            text: 'Fecha y Hora de Evaluaci√≥n',
                                            font: { size: 12, weight: 'bold' }
                                        },
                                        ticks: {
                                            maxRotation: 45,
                                            minRotation: 45,
                                            autoSkip: false,
                                            source: 'data',
                                            font: { size: 10, weight: '500' },
                                            callback: function(value, index, ticks) {
                                                const date = new Date(value);
                                                const dateStr = date.toLocaleDateString('es-ES', { 
                                                    day: '2-digit', 
                                                    month: 'short'
                                                });
                                                const timeStr = date.toLocaleTimeString('es-ES', {
                                                    hour: '2-digit',
                                                    minute: '2-digit',
                                                    hour12: false
                                                });
                                                return [`${dateStr}`, `${timeStr}`];
                                            }
                                        },
                                        grid: { 
                                            display: true,
                                            color: 'rgba(0, 0, 0, 0.05)' 
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        max: 100,
                                        title: {
                                            display: true,
                                            text: 'Porcentaje (%)',
                                            font: { size: 12, weight: 'bold' }
                                        },
                                        ticks: {
                                            callback: function(value) {
                                                return value + '%';
                                            },
                                            font: { size: 11 }
                                        },
                                        grid: {
                                            color: 'rgba(0, 0, 0, 0.05)',
                                            drawBorder: false
                                        }
                                    }
                                }
                            }
                        });
                        
                    } catch (error) {
                        console.error('‚ùå ALPINE: Error creating progress chart:', error);
                    } finally {
                        this.isLoadingProgress = false;
                    }
                },
                
                // Mostrar estado vac√≠o si no hay datos
                showEmptyProgressState() {
                    // Alpine maneja la visibilidad con x-show, no necesitamos manipular el DOM
                },
                
                // ============================================
                // DEVELOPMENT PLAN (Alpine) - PASO 9
                // ============================================
                
                developmentPlans: [],
                isLoadingPlans: false,
                selectedPlan: null,
                
                // Cargar planes de desarrollo
                async loadDevelopmentPlans(forceRefresh = false) {
                    
                    if (this.isLoadingPlans) {
                        return;
                    }
                    
                    this.isLoadingPlans = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/development-plans`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.success && data.plans && data.plans.length > 0) {
                            this.developmentPlans = data.plans;
                            this.selectedPlan = data.plans[0]; // Seleccionar el m√°s reciente
                            
                            // Exponer globalmente
                            window.developmentPlans = this.developmentPlans;
                            
                            this.renderDevelopmentPlans();
                        } else {
                            // No hay planes
                            this.developmentPlans = [];
                            this.selectedPlan = null;
                            this.showEmptyPlansState();
                        }
                    } catch (error) {
                        console.error('‚ùå ALPINE: Error loading plans:', error);
                        this.developmentPlans = [];
                        this.selectedPlan = null;
                        this.showEmptyPlansState();
                        
                        if (typeof showToast === 'function') {
                            showToast('Error al cargar el plan de desarrollo', 'error');
                        }
                    } finally {
                        this.isLoadingPlans = false;
                    }
                },
                
                // Renderizar planes (llamar funci√≥n legacy)
                renderDevelopmentPlans() {
                    
                    // Exponer globalmente
                    window.developmentPlans = this.developmentPlans;
                    
                    // Llamar funci√≥n legacy
                    if (typeof renderDevelopmentPlans === 'function') {
                        renderDevelopmentPlans(this.developmentPlans);
                    } else {
                        console.error('‚ùå renderDevelopmentPlans no disponible');
                    }
                },
                
                // Mostrar estado vac√≠o si no hay planes
                showEmptyPlansState() {
                    const loadingEl = document.getElementById('devPlanLoading');
                    const emptyEl = document.getElementById('devPlanEmpty');
                    const contentEl = document.getElementById('devPlanContent');
                    
                    if (loadingEl) loadingEl.style.display = 'none';
                    if (emptyEl) emptyEl.style.display = 'block';
                    if (contentEl) contentEl.style.display = 'none';
                },
                
                // ============================================
                // CALENDAR/SCHEDULE (Alpine) - PASO 10
                // ============================================
                
                coachAvailability: [],
                occupiedSlots: [],
                mySessions: [],
                isLoadingAvailability: false,
                isLoadingSessions: false,
                coachName: '',
                scheduleTab: 'request', // 'request' o 'sessions'
                
                // Cambiar tab de schedule
                switchScheduleTab(tab) {
                    this.scheduleTab = tab;
                    
                    // Forzar estilos consistentes en los botones
                    setTimeout(() => {
                        const buttons = document.querySelectorAll('#scheduleCoachTabs .nav-link');
                        buttons.forEach(btn => {
                            btn.style.setProperty('background', '#fff', 'important');
                            btn.style.setProperty('background-color', '#fff', 'important');
                            btn.style.setProperty('color', '#333', 'important');
                            btn.style.setProperty('border-color', '#dee2e6', 'important');
                            
                            const icon = btn.querySelector('i');
                            if (icon) {
                                icon.style.setProperty('color', '#333', 'important');
                            }
                            
                            const spans = btn.querySelectorAll('span:not(.badge)');
                            spans.forEach(span => {
                                span.style.setProperty('color', '#333', 'important');
                            });
                        });
                    }, 10);
                    
                    if (tab === 'sessions') {
                        this.loadMySessions();
                    } else if (tab === 'request') {
                        this.loadCoachAvailability();
                    }
                },
                
                // Cargar disponibilidad del coach
                async loadCoachAvailability(forceRefresh = false) {
                    
                    if (this.isLoadingAvailability) {
                        return;
                    }
                    
                    this.isLoadingAvailability = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/coach-availability`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.coachAvailability = data.availability || [];
                            this.occupiedSlots = data.occupied_slots || [];
                            this.coachName = data.coach_name || '';
                            
                            // Exponer globalmente
                            window.coachAvailability = this.coachAvailability;
                            window.occupiedSlots = this.occupiedSlots;
                            
                            
                            // Llamar funci√≥n legacy para renderizar
                            if (typeof displayCoachAvailability === 'function') {
                                displayCoachAvailability(this.coachAvailability, this.occupiedSlots, this.coachName);
                            }
                        } else {
                            this.showEmptyAvailabilityState();
                        }
                    } catch (error) {
                        console.error('‚ùå ALPINE: Error loading availability:', error);
                        this.showEmptyAvailabilityState();
                    } finally {
                        this.isLoadingAvailability = false;
                    }
                },
                
                // Cargar mis sesiones
                async loadMySessions(forceRefresh = false) {
                    
                    if (this.isLoadingSessions) {
                        return;
                    }
                    
                    this.isLoadingSessions = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/my-sessions`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        
                        if (data.success) {
                            this.mySessions = data.sessions || [];
                            
                            // Exponer globalmente
                            window.mySessions = this.mySessions;
                            
                            
                            // Llamar funci√≥n legacy para renderizar
                            if (typeof displayMySessions === 'function') {
                                displayMySessions(this.mySessions);
                            }
                            
                            // Actualizar contador
                            if (typeof updateMySessionsCount === 'function') {
                                updateMySessionsCount(this.mySessions.length);
                            }
                        }
                    } catch (error) {
                        console.error('‚ùå ALPINE: Error loading sessions:', error);
                        this.mySessions = [];
                    } finally {
                        this.isLoadingSessions = false;
                    }
                },
                
                // Mostrar estado vac√≠o de disponibilidad
                showEmptyAvailabilityState() {
                    const container = document.getElementById('coachAvailabilityInfo');
                    if (container) {
                        container.innerHTML = '<p class="text-muted">No se pudo cargar la disponibilidad del coach</p>';
                    }
                },
                
                // ============================================
                // MODALS (Alpine) - PASO 11
                // ============================================
                
                modals: {
                    changePassword: false,
                    taskProgress: false,
                    evaluationDetails: false,
                    contactCoach: false,
                    assessmentResults: false
                },
                
                selectedTask: null,
                selectedEvaluation: null,
                
                // Abrir modal
                openModal(modalName) {
                    this.modals[modalName] = true;
                    
                    // Tambi√©n activar el modal Bootstrap para compatibilidad
                    const modalId = this.getModalId(modalName);
                    if (modalId) {
                        const modalElement = document.getElementById(modalId);
                        if (modalElement) {
                            const modal = new bootstrap.Modal(modalElement);
                            modal.show();
                        }
                    }
                },
                
                // Cerrar modal
                closeModal(modalName) {
                    this.modals[modalName] = false;
                    
                    // Tambi√©n cerrar el modal Bootstrap
                    const modalId = this.getModalId(modalName);
                    if (modalId) {
                        const modalElement = document.getElementById(modalId);
                        if (modalElement) {
                            const modal = bootstrap.Modal.getInstance(modalElement);
                            if (modal) modal.hide();
                        }
                    }
                },
                
                // Obtener ID del modal
                getModalId(modalName) {
                    const modalMap = {
                        changePassword: 'changePasswordModalCoachee',
                        taskProgress: 'taskProgressModal',
                        evaluationDetails: 'evaluationDetailsModal',
                        contactCoach: 'contactCoachModal',
                        assessmentResults: 'assessmentResultsModal'
                    };
                    return modalMap[modalName];
                },
                
                // Ver detalles de evaluaci√≥n
                viewEvaluationDetails(evaluationId) {
                    this.selectedEvaluation = evaluationId;
                    
                    // Llamar funci√≥n legacy
                    if (typeof viewEvaluationDetails === 'function') {
                        viewEvaluationDetails(evaluationId);
                    }
                },
                
                // Ver progreso de tarea
                viewTaskProgress(taskId) {
                    this.selectedTask = taskId;
                    
                    // Llamar funci√≥n legacy
                    if (typeof showTaskProgress === 'function') {
                        showTaskProgress(taskId);
                    }
                }
            };
            
            // üõ°Ô∏è Store instance globally for boot guard
            window.__dashboardInstance = dashboardInstance;
            
            return dashboardInstance;
        }
        
        // ============================================
        // FUNCIONES LEGACY (Se migrar√°n progresivamente)
        // ============================================
        
        // Helper function to escape HTML entities
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Helper function to clean video titles from problematic prefixes
        function cleanVideoTitle(title) {
            if (!title) return title;
            
            // Si el t√≠tulo empieza con "(Video de", limpiar esa parte
            if (title.startsWith('(Video de')) {
                const closeParenIndex = title.indexOf(')');
                if (closeParenIndex !== -1) {
                    const cleanedTitle = title.substring(closeParenIndex + 1).trim();
                    return cleanedTitle || 'Video educativo';
                }
            }
            
            return title;
        }
        
        // Helper function to clean video descriptions from problematic prefixes
        function cleanVideoDescription(description) {
            if (!description) return description;
            
            // Si la descripci√≥n empieza con "Video de", limpiar esa parte
            if (description.startsWith('Video de ')) {
                return description.substring(9).trim() || 'Contenido educativo asignado por el coach';
            }
            
            return description;
        }
        
        // Verificar si la sesi√≥n expir√≥ y redirigir autom√°ticamente
        function checkSessionExpired(data) {
            if (data && data.session_expired && data.redirect_url) {
                window.location.href = data.redirect_url;
                return true;
            }
            return false;
        }
        
        // DEBUG: Override fetch to log all requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            debugLog(`üåê FETCH REQUEST: ${args[0]}`, args[1]);
            return originalFetch.apply(this, args)
                .then(async response => {
                    debugLog(`üì• FETCH RESPONSE: ${args[0]} - Status: ${response.status}`);
                    
                    // Intentar verificar si hay sesi√≥n expirada en la respuesta
                    if (response.ok && response.headers.get('content-type')?.includes('application/json')) {
                        // Clonar la respuesta para poder leerla sin consumirla
                        const clonedResponse = response.clone();
                        try {
                            const data = await clonedResponse.json();
                            // Verificar si la sesi√≥n expir√≥
                            if (checkSessionExpired(data)) {
                                // Sesi√≥n expirada, se redirigir√° autom√°ticamente
                                return new Promise(() => {}); // Never resolves, ya que se redirige
                            }
                        } catch (e) {
                            // Si falla el parsing, continuar con la respuesta original
                            debugLog(`‚ö†Ô∏è No se pudo verificar sesi√≥n en respuesta: ${e.message}`);
                        }
                    }
                    
                    return response;
                })
                .catch(error => {
                    debugLog(`‚ùå FETCH ERROR: ${args[0]}`, error);
                    throw error;
                });
        };
        
        debugLog("üöÄ Coachee Dashboard JavaScript loaded");
        
        // Application state
        let currentUser = null;
        let dashboardData = null;
        let evaluationsData = null;
        let tasksData = null;
        let contentData = null;
        // let progressChart = null; // ELIMINADO
        // let testProgressChart = null; // ELIMINADO

        // Assessment state
        let questions = [];
        let currentQuestionIndex = 0;
        let answers = {};
        let isAssessmentActive = false;
        let currentAssessmentId = null;
        
        // CACHE BUSTER: Verificar que JavaScript se carg√≥ correctamente

        // Logout function
        async function logout() {
            try {
                // Show loading state
                const logoutBtn = document.querySelector('.logout-btn');
                const originalContent = logoutBtn.innerHTML;
                logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Cerrando...';
                logoutBtn.disabled = true;

                // Limpiar localStorage antes de cerrar sesi√≥n
                localStorage.removeItem('coachee_activeTab');

                // Call logout API espec√≠fico para coachee
                const response = await fetch(`${API_BASE_URL}/api/coachee/logout`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                // Always redirect to participant access page regardless of API response
                window.location.href = '/participant-access';
                
            } catch (error) {
                console.error('Error during logout:', error);
                // Limpiar localStorage incluso si hay error
                localStorage.removeItem('coachee_activeTab');
                // Even if there's an error, redirect to participant access page
                window.location.href = '/participant-access';
            }
        }

        // Initialize particles animation
        function createParticles() {
            const particlesContainer = document.querySelector('.particles');
            // üî• FIX: Check if container exists before creating particles
            if (!particlesContainer) {
                console.warn('‚ö†Ô∏è Particles container not found, skipping animation');
                return;
            }
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.width = particle.style.height = (Math.random() * 4 + 2) + 'px';
                particle.style.animationDuration = (Math.random() * 10 + 20) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // ============================================
        // WRAPPER FUNCTIONS PARA COMPATIBILIDAD LEGACY
        // ============================================
        
        // showTab global wrapper - llama al m√©todo Alpine
        function showTab(tabId) {
            // Obtener la instancia de Alpine y llamar al m√©todo
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.showTab === 'function') {
                alpineData.showTab(tabId);
            } else {
                console.warn('‚ö†Ô∏è Alpine not ready, fallback to direct manipulation');
                // Fallback por si Alpine no est√° listo
                const allTabPanes = document.querySelectorAll('.tab-pane');
                allTabPanes.forEach(pane => pane.classList.remove('show', 'active'));
                
                const targetPane = document.getElementById(tabId);
                if (targetPane) targetPane.classList.add('show', 'active');
            }
        }
        
        // loadEvaluations wrapper - llama al m√©todo Alpine
        async function loadEvaluations(forceRefresh = false) {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadEvaluations === 'function') {
                await alpineData.loadEvaluations(forceRefresh);
            } else {
                console.warn('‚ö†Ô∏è Alpine not ready for loadEvaluations');
            }
        }
        
        // ============================================
        // WRAPPERS GLOBALES PARA COMPATIBILIDAD (Legacy)
        // ============================================
        
        // Wrapper para showTab
        function showTab(tabId) {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.showTab === 'function') {
                alpineData.showTab(tabId);
            } else {
                console.error('‚ùå Alpine component not ready');
            }
        }
        
        // Wrapper para loadEvaluations
        async function loadEvaluations(forceRefresh = false) {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadEvaluations === 'function') {
                await alpineData.loadEvaluations(forceRefresh);
            } else {
                console.error('‚ùå Alpine component not ready');
            }
        }
        
        // üî• PASO 4: Wrapper para renderCompletedEvaluationsSection
        function renderCompletedEvaluationsSection() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.renderCompletedEvaluationsSection === 'function') {
                alpineData.renderCompletedEvaluationsSection();
            } else {
                console.error('‚ùå Alpine component not ready');
            }
        }
        
        // üî• PASO 4: Wrapper para loadEvaluationHistory
        async function loadEvaluationHistory() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadEvaluationHistory === 'function') {
                await alpineData.loadEvaluationHistory();
            } else {
                console.error('‚ùå Alpine component not ready');
            }
        }

        // üî• PASO 5: Wrapper para loadPendingEvaluations
        async function loadPendingEvaluations() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadPendingEvaluations === 'function') {
                await alpineData.loadPendingEvaluations();
            } else {
                console.error('‚ùå Alpine component not ready');
            }
        }
        
        // üî• PASO 5: Wrapper para displayPendingEvaluations
        function displayPendingEvaluations() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.displayPendingEvaluations === 'function') {
                alpineData.displayPendingEvaluations();
            } else {
                console.error('‚ùå Alpine component not ready');
            }
        }
        
        // üî• PASO 6: Wrapper para loadTasks
        async function loadTasks(forceRefresh = false) {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadTasks === 'function') {
                await alpineData.loadTasks(forceRefresh);
            } else {
                console.error('‚ùå Alpine component not ready');
            }
        }
        
        // üî• PASO 6: Wrapper para renderTasks  
        function renderTasks() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.renderTasks === 'function') {
                alpineData.renderTasks();
            } else {
                console.error('‚ùå Alpine component not ready');
            }
        }

        // Funci√≥n para navegar a evaluaciones completadas
        function navigateToCompletedEvaluations() {
            // Primero activar la pesta√±a de evaluaciones con el nuevo sistema
            showTab('evaluations');
            
            // Hacer scroll hacia la secci√≥n de evaluaciones completadas (solo en m√≥vil)
            setTimeout(() => {
                const isMobile = window.innerWidth <= 768;
                if (!isMobile) return; // No hacer scroll en desktop
                
                const completedSection = document.getElementById('completedEvaluations');
                if (completedSection) {
                    const elementPosition = completedSection.getBoundingClientRect().top + window.pageYOffset;
                    const offsetPosition = elementPosition - (window.innerHeight * 0.2);
                    window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                    
                    // Destacar brevemente la secci√≥n
                    completedSection.style.border = '2px solid #28a745';
                    completedSection.style.borderRadius = '0.5rem';
                    setTimeout(() => {
                        completedSection.style.border = '';
                        completedSection.style.borderRadius = '';
                    }, 2000);
                }
            }, 100);
        }

        // Funci√≥n para navegar a la secci√≥n de tareas
        function navigateToTasks() {
            // Primero activar la pesta√±a de tareas con el nuevo sistema
            showTab('tasks');
            
            // Hacer scroll hacia la secci√≥n de tareas (solo en m√≥vil)
            setTimeout(() => {
                const isMobile = window.innerWidth <= 768;
                if (!isMobile) return; // No hacer scroll en desktop
                
                const tasksSection = document.getElementById('tasks');
                if (tasksSection) {
                    const elementPosition = tasksSection.getBoundingClientRect().top + window.pageYOffset;
                    const offsetPosition = elementPosition - (window.innerHeight * 0.2);
                    window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                    
                    // Destacar brevemente la secci√≥n
                    tasksSection.style.border = '2px solid #ffc107';
                    tasksSection.style.borderRadius = '0.5rem';
                    setTimeout(() => {
                        tasksSection.style.border = '';
                        tasksSection.style.borderRadius = '';
                    }, 2000);
                }
            }, 100);
        }

        // Funci√≥n para navegar a las tareas vencidas
        function navigateToOverdueTasks() {
            // Primero activar la pesta√±a de tareas con el nuevo sistema
            showTab('tasks');
            
            // Hacer scroll hacia la secci√≥n de tareas (solo en m√≥vil)
            setTimeout(() => {
                const isMobile = window.innerWidth <= 768;
                if (!isMobile) return; // No hacer scroll en desktop
                
                const tasksSection = document.getElementById('tasks');
                if (tasksSection) {
                    const elementPosition = tasksSection.getBoundingClientRect().top + window.pageYOffset;
                    const offsetPosition = elementPosition - (window.innerHeight * 0.2);
                    window.scrollTo({ top: offsetPosition, behavior: 'smooth' });
                    
                    // Destacar brevemente la secci√≥n con color rojo (danger)
                    tasksSection.style.border = '2px solid #dc3545';
                    tasksSection.style.borderRadius = '0.5rem';
                    setTimeout(() => {
                        tasksSection.style.border = '';
                        tasksSection.style.borderRadius = '';
                    }, 2000);
                    
                    // Destacar visualmente las tareas vencidas dentro del contenedor
                    setTimeout(() => {
                        const tasksContainer = document.getElementById('tasksContainer');
                        if (tasksContainer) {
                            // Buscar todas las tareas vencidas y destacarlas
                            const overdueTasks = tasksContainer.querySelectorAll('.task-item[data-status="overdue"], .task-item.overdue, .task-item .text-danger');
                            overdueTasks.forEach(task => {
                                task.style.background = 'rgba(220, 53, 69, 0.1)';
                                task.style.border = '2px solid rgba(220, 53, 69, 0.3)';
                                task.style.borderRadius = '0.5rem';
                                
                                // Quitar el destacado despu√©s de 3 segundos
                                setTimeout(() => {
                                    task.style.background = '';
                                    task.style.border = '';
                                    task.style.borderRadius = '';
                                }, 3000);
                            });
                        }
                    }, 500);
                }
            }, 100);
        }

        // ============================================
        // üìã DESARROLLO DE PLANES - Funciones
        // ============================================
        
        async function loadDevelopmentPlans() {
            
            const loadingEl = document.getElementById('devPlanLoading');
            const emptyEl = document.getElementById('devPlanEmpty');
            const contentEl = document.getElementById('devPlanContent');
            
            // Mostrar loading
            loadingEl.style.display = 'block';
            emptyEl.style.display = 'none';
            contentEl.style.display = 'none';
            
            try {
                const response = await fetch('/api/coachee/development-plans');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                loadingEl.style.display = 'none';
                
                if (data.success && data.plans && data.plans.length > 0) {
                    renderDevelopmentPlans(data.plans);
                    contentEl.style.display = 'block';
                } else {
                    emptyEl.style.display = 'block';
                }
                
            } catch (error) {
                console.error('‚ùå Error al cargar planes:', error);
                loadingEl.style.display = 'none';
                emptyEl.style.display = 'block';
                showToast('Error al cargar el plan de desarrollo', 'error');
            }
        }
        
        function renderDevelopmentPlans(plans) {
            const container = document.getElementById('devPlanContent');
            container.innerHTML = '';
            
            // Crear grid para m√∫ltiples planes
            const plansHTML = plans.map((plan, index) => `
                <div class="dev-plan-card">
                    
                    <!-- Header con info del plan -->
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <div style="flex: 1; min-width: 0;">
                            <span class="plan-number-badge">
                                <i class="fas fa-check-circle" style="font-size: 0.65rem;"></i> Plan ${index + 1}
                            </span>
                            <div class="inline-text-light" style="font-size: 0.7rem; margin-top: 0.35rem">
                                <i class="fas fa-calendar-check" style="font-size: 0.65rem;"></i> ${new Date(plan.published_at).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' })}
                            </div>
                        </div>
                        <button onclick="togglePlanDetails(${plan.id})" class="plan-toggle-btn">
                            <i class="fas fa-chevron-down" id="plan-icon-${plan.id}"></i>
                        </button>
                    </div>
                    
                    <!-- Objetivo Principal (siempre visible) -->
                    <div class="plan-objective-box">
                        <div class="plan-objective-title">
                            <i class="fas fa-bullseye" style="font-size: 0.75rem; margin-right: 0.4rem;"></i>Objetivo
                        </div>
                        <p class="plan-objective-text">${plan.objetivo || 'No especificado'}</p>
                    </div>
                    
                    <!-- √Åreas de Desarrollo (compactas) -->
                    <div style="margin-bottom: 0.5rem;">
                        <div class="inline-text-medium" style="font-weight: 600; margin-bottom: 0.4rem; display: flex; align-items: center; font-size: 0.75rem">
                            <i class="fas fa-th-large" style="color: #667eea; font-size: 0.7rem; margin-right: 0.4rem;"></i>√Åreas
                        </div>
                        <div style="display: flex; gap: 0.35rem; flex-wrap: wrap;">
                            ${renderAreasCompact(plan.areas_desarrollo)}
                        </div>
                    </div>
                    
                    <!-- Detalles expandibles -->
                    <div id="plan-details-${plan.id}" style="display: none; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #e5e7eb;">
                        
                        ${plan.situacion_actual ? `
                        <div class="plan-details-box">
                            <div class="inline-text-medium" style="font-weight: 600; margin-bottom: 0.35rem; display: flex; align-items: center; font-size: 0.75rem">
                                <i class="fas fa-compass" style="font-size: 0.7rem; margin-right: 0.4rem;"></i>Situaci√≥n Actual
                            </div>
                            <p class="inline-text-light" style="margin: 0; line-height: 1.4; font-size: 0.75rem">${plan.situacion_actual}</p>
                        </div>
                        ` : ''}
                        
                        <div style="margin-bottom: 0.5rem;">
                            <div class="inline-text-medium" style="font-weight: 600; margin-bottom: 0.4rem; display: flex; align-items: center; font-size: 0.75rem">
                                <i class="fas fa-tasks" style="color: #667eea; font-size: 0.7rem; margin-right: 0.4rem;"></i>Acciones (${plan.acciones?.length || 0})
                            </div>
                            ${renderAccionesCompact(plan.acciones)}
                        </div>
                        
                        <div class="plan-indicators-box">
                            <div class="plan-indicators-title">
                                <i class="fas fa-chart-line" style="font-size: 0.7rem; margin-right: 0.4rem;"></i>Indicadores
                            </div>
                            <p class="plan-indicators-text">${plan.indicadores || 'No especificados'}</p>
                        </div>
                    </div>
                    
                </div>
            `).join('');
            
            container.innerHTML = plansHTML;
        }
        
        // Toggle plan details
        function togglePlanDetails(planId) {
            const details = document.getElementById(`plan-details-${planId}`);
            const icon = document.getElementById(`plan-icon-${planId}`);
            
            if (details.style.display === 'none') {
                details.style.display = 'block';
                icon.className = 'fas fa-chevron-up';
            } else {
                details.style.display = 'none';
                icon.className = 'fas fa-chevron-down';
            }
        }
        
        function renderAreas(areas) {
            if (!areas || !Array.isArray(areas) || areas.length === 0) {
                return '<span style="color: #94a3b8; font-style: italic; font-size: 0.85rem;">No especificadas</span>';
            }
            
            const colors = [
                { bg: '#eff6ff', border: '#3b82f6', text: '#1e40af' },
                { bg: '#f0fdf4', border: '#22c55e', text: '#166534' },
                { bg: '#fef3c7', border: '#f59e0b', text: '#92400e' }
            ];
            
            return areas.map((area, index) => {
                const color = colors[index % colors.length];
                return `
                    <span style="
                        background: ${color.bg}; 
                        border: 1.5px solid ${color.border}; 
                        color: ${color.text}; 
                        padding: 0.4rem 0.75rem; 
                        border-radius: 16px; 
                        font-weight: 600; 
                        font-size: 0.8rem;
                        display: inline-block;
                        line-height: 1.2;
                    ">
                        ${area}
                    </span>
                `;
            }).join('');
        }
        
        function renderAreasCompact(areas) {
            if (!areas || !Array.isArray(areas) || areas.length === 0) {
                return '<span style="color: #94a3b8; font-style: italic; font-size: 0.7rem;">Ninguna</span>';
            }
            
            const colorClasses = ['plan-area-badge-blue', 'plan-area-badge-green', 'plan-area-badge-yellow'];
            
            return areas.map((area, index) => {
                const colorClass = colorClasses[index % colorClasses.length];
                return `
                    <span class="plan-area-badge ${colorClass}">
                        ${area}
                    </span>
                `;
            }).join('');
        }
        
        function renderAcciones(acciones) {
            if (!acciones || !Array.isArray(acciones) || acciones.length === 0) {
                return '<p style="color: #94a3b8; font-style: italic; font-size: 0.85rem;">No hay acciones definidas</p>';
            }
            
            return acciones.map((accion, index) => `
                <div style="background: white; border: 1.5px solid #e2e8f0; border-radius: 6px; padding: 0.875rem; margin-bottom: 0.75rem;">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <div style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            width: 26px;
                            height: 26px;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: 700;
                            flex-shrink: 0;
                            font-size: 0.85rem;
                        ">
                            ${index + 1}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <p style="color: #334155; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; line-height: 1.4;">${accion.descripcion}</p>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                <span class="inline-text-light" style="font-size: 0.8rem">
                                    <i class="fas fa-sync-alt me-1" style="color: #667eea; font-size: 0.75rem;"></i>
                                    <strong>Frecuencia:</strong> ${accion.frecuencia || 'No especificada'}
                                </span>
                                ${accion.fecha_objetivo ? `
                                <span class="inline-text-light" style="font-size: 0.8rem">
                                    <i class="fas fa-calendar-day me-1" style="color: #667eea; font-size: 0.75rem;"></i>
                                    <strong>Fecha:</strong> ${new Date(accion.fecha_objetivo).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}
                                </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderAccionesCompact(acciones) {
            if (!acciones || !Array.isArray(acciones) || acciones.length === 0) {
                return '<p style="color: #94a3b8; font-style: italic; font-size: 0.7rem; margin: 0;">No definidas</p>';
            }
            
            return acciones.map((accion, index) => `
                <div class="plan-action-card">
                    <div style="display: flex; align-items: start; gap: 0.5rem;">
                        <div style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            width: 18px;
                            height: 18px;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: 700;
                            flex-shrink: 0;
                            font-size: 0.65rem;
                        ">
                            ${index + 1}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <p class="plan-action-text">${accion.descripcion}</p>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <span class="inline-text-light" style="font-size: 0.65rem">
                                    <i class="fas fa-sync-alt" style="color: #667eea; font-size: 0.6rem; margin-right: 0.2rem;"></i>
                                    ${accion.frecuencia || 'N/A'}
                                </span>
                                ${accion.fecha_objetivo ? `
                                <span class="inline-text-light" style="font-size: 0.65rem">
                                    <i class="fas fa-calendar-day" style="color: #667eea; font-size: 0.6rem; margin-right: 0.2rem;"></i>
                                    ${new Date(accion.fecha_objetivo).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}
                                </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Toast notification system
        function showToast(message, type = 'info') {
            const toastElement = document.getElementById('toastNotification');
            const toastBody = toastElement.querySelector('.toast-body');
            const toastHeader = toastElement.querySelector('.toast-header');
            
            // Update icon
            const icon = toastHeader.querySelector('i');
            switch (type) {
                case 'success':
                    icon.className = 'fas fa-check-circle text-success me-2';
                    break;
                case 'error':
                    icon.className = 'fas fa-exclamation-circle text-danger me-2';
                    break;
                case 'warning':
                    icon.className = 'fas fa-exclamation-triangle text-warning me-2';
                    break;
                default:
                    icon.className = 'fas fa-info-circle text-primary me-2';
            }
            
            toastBody.textContent = message;
            
            const toast = new bootstrap.Toast(toastElement, {
                autohide: true,
                delay: 5000
            });
            toast.show();
        }

        // GAMIFICACI√ìN: Mostrar modal de Level Up (Etapa 8)
        function showLevelUpModal(levelInfo) {
            console.log('üéâ Mostrando modal Level Up:', levelInfo);
            console.log('üìä Datos del nivel:', {
                level_number: levelInfo.level_number,
                level_name: levelInfo.level_name,
                icon_class: levelInfo.icon_class,
                color_hex: levelInfo.color_hex
            });
            
            // Actualizar contenido del modal
            document.getElementById('levelUpNumber').textContent = levelInfo.level_number;
            document.getElementById('levelUpName').textContent = levelInfo.level_name;
            
            // Aplicar color del nivel al badge
            const levelBadgeContainer = document.getElementById('levelUpNumberContainer');
            if (levelInfo.color_hex) {
                levelBadgeContainer.style.color = levelInfo.color_hex;
            }
            
            // Actualizar √≠cono - usar SVG como fallback si Font Awesome falla
            const iconElement = document.getElementById('levelUpIcon');
            const iconClass = levelInfo.icon_class.startsWith('fas ') 
                ? levelInfo.icon_class 
                : 'fas ' + levelInfo.icon_class;
            console.log('üé® Aplicando clase de √≠cono:', iconClass);
            
            // Mapeo de iconos a emojis como fallback visual
            const iconEmojis = {
                'fa-seedling': 'üå±',
                'fa-book': 'üìö',
                'fa-compass': 'üß≠',
                'fa-running': 'üèÉ',
                'fa-medal': 'üèÖ',
                'fa-crown': 'üëë',
                'fa-gem': 'üíé',
                'fa-star': '‚≠ê'
            };
            
            const iconName = iconClass.replace('fas ', '');
            
            // Intentar con Font Awesome primero
            iconElement.textContent = '';
            iconElement.className = iconClass;
            iconElement.style.cssText = 'font-family: "Font Awesome 6 Free" !important; font-weight: 900 !important; font-size: 3.5rem !important; color: white !important; display: inline-block !important;';
            
            // Despu√©s de un momento, verificar si el √≠cono se renderiz√≥
            setTimeout(() => {
                const computed = window.getComputedStyle(iconElement, '::before');
                const content = computed.getPropertyValue('content');
                console.log('üé® Contenido del ::before:', content);
                
                // Si el ::before est√° vac√≠o, usar emoji como fallback
                if (!content || content === 'none' || content === '""') {
                    console.log('‚ö†Ô∏è Font Awesome no renderiz√≥, usando emoji fallback');
                    iconElement.className = ''; // Remover clases de FA
                    iconElement.textContent = iconEmojis[iconName] || '‚≠ê';
                    iconElement.style.cssText = 'font-size: 4rem !important; color: white !important; display: inline-block !important; line-height: 1 !important;';
                }
            }, 100);
            
            console.log('üé® Clase aplicada:', iconElement.className);
            
            // Actualizar color de fondo del modal con gradiente
            const modalContent = document.querySelector('#levelUpModal .modal-content');
            if (levelInfo.color_hex) {
                const gradient = `linear-gradient(135deg, ${levelInfo.color_hex} 0%, ${levelInfo.color_hex}dd 100%)`;
                console.log('üé® Aplicando gradiente con color del nivel:', gradient);
                // Crear gradiente con el color del nivel (usando !important)
                modalContent.style.setProperty('background', gradient, 'important');
            } else {
                console.log('‚ö†Ô∏è No hay color_hex, usando gradiente por defecto');
                // Si no hay color espec√≠fico, usar el gradiente por defecto
                modalContent.style.setProperty('background', 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 'important');
            }
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('levelUpModal'));
            modal.show();
        }

        // Load user profile
        async function loadUserProfile() {
            try {
                
                // Esperar a que el DOM est√© completamente cargado
                if (document.readyState === 'loading') {
                    await new Promise(resolve => document.addEventListener('DOMContentLoaded', resolve));
                }
                
                // SOLUCI√ìN: Obtener nombre real del usuario autom√°ticamente
                
                // PRIORIDAD 1: Usar endpoint espec√≠fico de coachee (m√°s confiable)
                try {
                    const summaryResponse = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                    
                    if (summaryResponse.ok) {
                        const summaryData = await summaryResponse.json();
                        
                        if (summaryData.success && summaryData.summary?.coachee?.name) {
                            const userName = summaryData.summary.coachee.name;
                            
                            // Mostrar tambi√©n info del coach para comparar
                            if (summaryData.summary?.coach) {
                            }
                            
                            // Crear objeto currentUser con los datos del coachee
                            currentUser = {
                                full_name: userName,
                                email: summaryData.summary.coachee.email,
                                avatar_url: summaryData.summary.coachee.avatar_url
                            };
                            
                            const welcomeText = userName;
                            updateAllWelcomeMessages(welcomeText);
                            updateHeaderAvatar();
                            return;
                        } else {
                        }
                    } else {
                    }
                } catch (summaryError) {
                }
                
                // PRIORIDAD 2: Fallback a /api/coachee/profile (espec√≠fico para coachees con avatar)
                try {
                    const response = await fetch(`${API_BASE_URL}/api/coachee/profile`);
                    
                    if (response.ok) {
                        const data = await response.json();
                        
                        if (data.success && data.profile?.full_name) {
                            const realName = data.profile.full_name;
                            
                            const realWelcomeText = realName;
                            updateAllWelcomeMessages(realWelcomeText);
                            currentUser = data.profile;
                            updateHeaderAvatar();
                            return;
                        }
                    }
                } catch (apiError) {
                }
                
                // √öltimo fallback: mantener mensaje gen√©rico
                
            } catch (error) {
                console.error('‚ùå Error cargando perfil:', error);
                
                // Fallback: mantener mensaje gen√©rico si hay error total
            }
        }

        // Load dashboard summary
        async function loadDashboardSummary() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (data && data.summary) {
                    dashboardData = data.summary;
                    updateSummaryCards();
                    updateUserInfo();
                } else {
                    console.error('Formato de datos inesperado:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                console.error('Error cargando resumen:', error);
                showToast('Error cargando resumen del dashboard: ' + error.message, 'error');
                
                // Inicializar con datos vac√≠os para evitar errores
                dashboardData = {
                    evaluation_summary: { total_completed: 0 },
                    latest_evaluation: null,
                    tasks_summary: { pending: 0, overdue: 0 },
                    coachee: {}
                };
                updateSummaryCards();
                updateUserInfo();
            }
        }

        // Update summary cards
        function updateSummaryCards() {
            if (!dashboardData) return;
            
            // Actualizar elementos del DOM de manera segura
            const totalEvaluationsElement = document.getElementById('totalEvaluations');
            const latestScoreElement = document.getElementById('latestScore');
            const pendingTasksElement = document.getElementById('pendingTasks');
            const overdueTasksElement = document.getElementById('overdueTasks');
            
            if (totalEvaluationsElement) {
                totalEvaluationsElement.textContent = 
                    (dashboardData.evaluation_summary && dashboardData.evaluation_summary.total_completed) || '0';
            }
            
            if (latestScoreElement) {
                latestScoreElement.textContent = 
                    (dashboardData.latest_evaluation && dashboardData.latest_evaluation.total_score) ? 
                    `${Math.round(dashboardData.latest_evaluation.total_score)}%` : '-';
            }
            
            if (pendingTasksElement) {
                pendingTasksElement.textContent = 
                    (dashboardData.tasks_summary && dashboardData.tasks_summary.pending) || '0';
            }
            
            if (overdueTasksElement) {
                overdueTasksElement.textContent = 
                    (dashboardData.tasks_summary && dashboardData.tasks_summary.overdue) || '0';
            }
        }

        // Update user info
        function updateUserInfo() {
            if (!dashboardData) return;
            
            const userInfoElement = document.getElementById('userInfo');
            if (!userInfoElement) return;
            
            const coacheeData = dashboardData.coachee;
            
            if (coacheeData && coacheeData.joined_at) {
                const joinedDate = new Date(coacheeData.joined_at).toLocaleDateString('es-ES');
                userInfoElement.textContent = `Miembro desde: ${joinedDate}`;
            } else if (coacheeData && coacheeData.email) {
                userInfoElement.textContent = coacheeData.email;
            } else {
                userInfoElement.textContent = 'Informaci√≥n no disponible';
            }
        }

        // Load evaluations data
        // Control de carga duplicada para evaluaciones
        let isLoadingEvaluations = false;
        let evaluationsLastLoaded = null;
        const EVALUATIONS_CACHE_DURATION = 30000; // 30 segundos
        
        async function loadEvaluations(forceRefresh = false) {
            // OPTIMIZACI√ìN: Evitar carga duplicada
            if (isLoadingEvaluations) {
                return;
            }
            
            // OPTIMIZACI√ìN: Usar cache si los datos son recientes
            if (!forceRefresh && evaluationsData && evaluationsLastLoaded) {
                const age = Date.now() - evaluationsLastLoaded;
                if (age < EVALUATIONS_CACHE_DURATION) {
                    // ‚úÖ Renderizar stats de Figma directamente (legacy function removed)
                    const savedTab = localStorage.getItem('coachee_activeTab');
                    if (savedTab === 'evaluaciones-figma' && typeof renderFigmaStats === 'function') {
                        debugLog('üìä Renderizando estad√≠sticas de Figma desde cache...');
                        renderFigmaStats();
                    }
                    
                    // ‚ùå DESHABILITADO - renderFigmaEvaluacionesSection(); // Conflicto con secciones expandibles
                    return;
                }
            }
            
            isLoadingEvaluations = true;
            
            try {
                debugLog('üîç Iniciando carga de evaluaciones...');
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluations`);
                
                debugLog(`üì° Response status: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                debugLog('üì¶ Datos de evaluaciones recibidos:', data);
                
                if (data && typeof data === 'object') {
                    evaluationsData = data; // Ahora contiene {available: {}, completed: []}
                    window.evaluationsData = data; // üî• IMPORTANTE: Asignar a window para funciones Figma
                    evaluationsLastLoaded = Date.now();
                    debugLog('‚úÖ Renderizando evaluaciones disponibles...');
                    
                    // ‚úÖ Renderizar stats de Figma directamente (legacy function removed)
                    const savedTab = localStorage.getItem('coachee_activeTab');
                    if (savedTab === 'evaluaciones-figma' && typeof renderFigmaStats === 'function') {
                        debugLog('üìä Renderizando estad√≠sticas de Figma...');
                        renderFigmaStats();
                    }
                    
                    // ‚ùå DESHABILITADO - Render nueva secci√≥n Figma
                    // renderFigmaEvaluacionesSection();
                } else {
                    console.error('Formato de datos inesperado:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                debugLog('‚ùå Error cargando evaluaciones', error);
                console.error('Error cargando evaluaciones:', error);
                showToast('Error cargando evaluaciones: ' + error.message, 'error');
                
                // Inicializar con datos vac√≠os
                evaluationsData = { available: {}, completed: [] };
                
                // Show error in container
                document.getElementById('availableEvaluations').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando mis evaluaciones disponibles</p></div>';
            } finally {
                isLoadingEvaluations = false;
            }
        }

        // LEGACY: Funci√≥n para cargar evaluaciones pendientes (ahora manejada por Alpine)
        // Esta funci√≥n ya no se usa directamente, el wrapper global llama al m√©todo Alpine
        
        // Funci√≥n para mostrar evaluaciones pendientes
        // LEGACY: Funci√≥n original de display de evaluaciones pendientes
        function displayPendingEvaluationsLegacy() {
            const pendingEvaluations = window.pendingEvaluations || [];
            const container = document.getElementById('pendingEvaluationsSection');
            
            if (!container) {
                console.warn('Contenedor pendingEvaluationsSection no encontrado');
                return;
            }
            
            if (pendingEvaluations.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem 1.25rem;">
                        <div style="font-size: 4rem; color: #22c55e; margin-bottom: 1rem;">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3 style="color: #111827; font-size: 1.25rem; margin-bottom: 0.5rem; font-weight: 700;">
                            ¬°Todo al d√≠a!
                        </h3>
                        <p style="color: #6b7280; font-size: 0.875rem;">
                            No tienes evaluaciones pendientes en este momento
                        </p>
                    </div>
                `;
                return;
            }
            
            // Categorize pending evaluations like available ones
            const categorizedEvaluations = {};
            pendingEvaluations.forEach(evaluation => {
                const title = evaluation.assessment_title || '';
                let category = 'Otros';
                
                if (title.toLowerCase().includes('disc') || title.toLowerCase().includes('personalidad')) {
                    category = 'Personalidad';
                } else if (title.toLowerCase().includes('liderazgo') || title.toLowerCase().includes('l√≠der')) {
                    category = 'Liderazgo';
                } else if (title.toLowerCase().includes('emocional') || title.toLowerCase().includes('asertividad')) {
                    category = 'Inteligencia Emocional';
                } else if (title.toLowerCase().includes('equipo') || title.toLowerCase().includes('colaboraci√≥n')) {
                    category = 'Trabajo en Equipo';
                } else if (title.toLowerCase().includes('empresarial') || title.toLowerCase().includes('crecer') || title.toLowerCase().includes('2026')) {
                    category = 'Crecimiento Empresarial';
                }
                
                if (!categorizedEvaluations[category]) {
                    categorizedEvaluations[category] = [];
                }
                categorizedEvaluations[category].push(evaluation);
            });
            
            // Clear container
            container.innerHTML = '';
            
            // Render each category
            Object.entries(categorizedEvaluations).forEach(([categoryName, evaluations]) => {
                const category = window.evaluationCategories ? window.evaluationCategories[categoryName] : null;
                
                if (!category) {
                    console.error(`‚ùå Categor√≠a ${categoryName} no encontrada en pending evaluations`);
                    return;
                }
                
                // Get gradient colors
                const getGradientColors = (baseColor) => {
                    const gradients = {
                        '#a855f7': { start: '#a855f7', end: '#c084fc' },
                        '#3b82f6': { start: '#3b82f6', end: '#60a5fa' },
                        '#ec4899': { start: '#ec4899', end: '#f472b6' },
                        '#22c55e': { start: '#22c55e', end: '#4ade80' },
                        '#f97316': { start: '#f97316', end: '#fb923c' },
                    };
                    return gradients[baseColor] || { start: baseColor, end: baseColor };
                };
                
                const gradientColors = getGradientColors(category.color);
                const categoryId = `pending-category-${categoryName.replace(/\s+/g, '-')}`;
                
                const categorySection = document.createElement('div');
                categorySection.className = 'assessment-category';
                categorySection.style.marginBottom = '1.5rem';
                
                categorySection.innerHTML = `
                    <div class="section-header-eval" 
                         id="header-${categoryId}"
                         data-category-id="${categoryId}"
                         role="button"
                         tabindex="0"
                         aria-expanded="false"
                         aria-controls="${categoryId}"
                         style="background: white !important; 
                                padding: 1.25rem; 
                                border-radius: 1.25rem; 
                                margin-bottom: 1.25rem; 
                                cursor: pointer; 
                                transition: all 0.3s ease; 
                                box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important; 
                                border-left: 4px solid #f59e0b !important;
                                border: 1px solid #fbbf24 !important;
                                background: linear-gradient(to right, #fffbeb 0%, white 50%) !important;">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; flex: 1; min-width: 0;">
                                <div style="width: 3.5rem; 
                                           height: 3.5rem; 
                                           background: linear-gradient(135deg, ${gradientColors.start} 0%, ${gradientColors.end} 100%) !important; 
                                           border-radius: 1rem; 
                                           display: flex; 
                                           align-items: center; 
                                           justify-content: center; 
                                           flex-shrink: 0; 
                                           box-shadow: 0 4px 12px ${hexToRgba(category.color, 0.4)}, 0 0 0 2px rgba(255,255,255,0.2) !important;
                                           position: relative;">
                                    <i class="fas ${category.icon}" style="color: #ffffff !important; font-size: 1.5rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));"></i>
                                    <div style="position: absolute; top: -4px; right: -4px; background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%) !important; width: 1.25rem; height: 1.25rem; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 2px 8px rgba(245,158,11,0.4); border: 2px solid white;">
                                        <i class="fas fa-clock" style="color: #ffffff !important; font-size: 0.5rem;"></i>
                                    </div>
                                </div>
                                <div style="flex: 1; min-width: 0;">
                                    <h3 style="font-size: 1.125rem; font-weight: 700; margin: 0 0 0.25rem 0; line-height: 1.3; color: #111827 !important;">
                                        ${categoryName}
                                    </h3>
                                    <p style="font-size: 0.875rem; margin: 0; font-weight: 600; color: #d97706 !important;">
                                        <i class="fas fa-exclamation-circle" style="font-size: 0.75rem; margin-right: 0.25rem;"></i>
                                        ${evaluations.length} pendiente${evaluations.length !== 1 ? 's' : ''}
                                    </p>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0;">
                                <span style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%) !important; 
                                             color: #ffffff !important; 
                                             padding: 0.5rem 1rem; 
                                             border-radius: 1.25rem; 
                                             font-size: 0.875rem; 
                                             font-weight: 800; 
                                             box-shadow: 0 4px 12px rgba(245,158,11,0.4), 0 0 0 2px rgba(255,255,255,0.3) !important;
                                             min-width: 2.5rem;
                                             text-align: center;">
                                    ${evaluations.length}
                                </span>
                                <i class="fas fa-chevron-down" 
                                   id="icon-${categoryId}"
                                   style="color: #f59e0b !important; 
                                          font-size: 1.125rem; 
                                          transition: transform 0.3s ease; 
                                          transform: rotate(-90deg);"></i>
                            </div>
                        </div>
                    </div>
                    <div class="assessments-grid category-grid" 
                         id="${categoryId}" 
                         data-expanded="false" 
                         style="grid-template-columns: repeat(auto-fill, minmax(min(300px, 100%), 1fr)); 
                                gap: 1.25rem;">
                    </div>
                `;
                
                container.appendChild(categorySection);
                
                const grid = document.getElementById(categoryId);
                
                // Render each pending evaluation card
                evaluations.forEach(evaluation => {
                    const assignedDate = new Date(evaluation.assigned_date).toLocaleDateString('es-ES', {
                        day: '2-digit',
                        month: 'short',
                        year: 'numeric'
                    });
                    
                    const card = document.createElement('div');
                    card.style.cssText = `
                        background: white !important;
                        border-radius: 1.25rem !important;
                        overflow: hidden !important;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08) !important;
                        transition: all 0.3s ease !important;
                        border: 2px solid #fbbf24 !important;
                        height: 100% !important;
                        display: flex !important;
                        flex-direction: column !important;
                        position: relative !important;
                    `;
                    
                    card.onmouseenter = () => {
                        card.style.transform = 'translateY(-4px)';
                        card.style.boxShadow = '0 12px 24px rgba(245,158,11,0.3) !important';
                    };
                    card.onmouseleave = () => {
                        card.style.transform = 'translateY(0)';
                        card.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.08) !important';
                    };
                    
                    card.innerHTML = `
                        <div style="position: relative; 
                                    width: 100%; 
                                    padding-top: 45%; 
                                    background: linear-gradient(135deg, ${gradientColors.start} 0%, ${gradientColors.end} 100%) !important; 
                                    overflow: hidden;">
                            <div style="position: absolute; 
                                       top: 0; 
                                       left: 0; 
                                       width: 100%; 
                                       height: 100%; 
                                       display: flex; 
                                       align-items: center; 
                                       justify-content: center; 
                                       background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 70%);">
                                <i class="fas ${category.icon}" style="font-size: 3rem; color: #ffffff !important; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.25));"></i>
                            </div>
                            <div style="position: absolute; 
                                       top: 0.875rem; 
                                       left: 0.875rem; 
                                       background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%) !important; 
                                       padding: 0.5rem 0.875rem; 
                                       border-radius: 1.5rem; 
                                       box-shadow: 0 4px 12px rgba(245,158,11,0.4), 0 0 0 2px rgba(255,255,255,0.3) !important;">
                                <span style="color: #ffffff !important; 
                                             font-size: 0.75rem; 
                                             font-weight: 800; 
                                             display: flex; 
                                             align-items: center; 
                                             gap: 0.375rem;">
                                    <i class="fas fa-clock" style="color: #ffffff !important; font-size: 0.75rem;"></i>
                                    PENDIENTE
                                </span>
                            </div>
                            <div style="position: absolute; 
                                       top: 0.875rem; 
                                       right: 0.875rem; 
                                       background: rgba(255,255,255,0.95) !important; 
                                       backdrop-filter: blur(12px); 
                                       padding: 0.5rem 0.875rem; 
                                       border-radius: 1.5rem; 
                                       box-shadow: 0 4px 12px rgba(0,0,0,0.15), 0 0 0 2px ${category.color}40 !important;
                                       border: 2px solid ${category.color} !important;">
                                <span style="color: ${category.color} !important; 
                                             font-size: 0.8125rem; 
                                             font-weight: 800; 
                                             display: flex; 
                                             align-items: center; 
                                             gap: 0.375rem;">
                                    <i class="fas fa-list-check" style="color: ${category.color} !important; font-size: 0.75rem;"></i>
                                    ${evaluation.total_questions} preguntas
                                </span>
                            </div>
                        </div>
                        <div style="padding: 1.25rem; 
                                    flex: 1; 
                                    display: flex; 
                                    flex-direction: column; 
                                    background: #ffffff !important;">
                            <h4 style="font-size: 1rem; font-weight: 700; margin: 0 0 0.625rem 0; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; min-height: 2.8rem; color: #111827 !important;">
                                ${evaluation.assessment_title}
                            </h4>
                            <p style="font-size: 0.875rem; margin: 0 0 1rem 0; line-height: 1.6; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; flex: 1; color: #6b7280 !important;">
                                ${evaluation.assessment_description || 'Evaluaci√≥n asignada por tu coach'}
                            </p>
                            <div style="display: flex; 
                                       align-items: center; 
                                       justify-content: space-between; 
                                       gap: 0.75rem; 
                                       padding-top: 1rem; 
                                       border-top: 2px solid #fef3c7;
                                       flex-wrap: wrap;">
                                <div style="display: flex; flex-direction: column; gap: 0.5rem; flex: 1; min-width: 0;">
                                    <div style="display: flex; align-items: center; gap: 0.625rem; font-size: 0.8125rem;">
                                        <div style="width: 2rem; 
                                                   height: 2rem; 
                                                   background: linear-gradient(135deg, ${gradientColors.start}15 0%, ${gradientColors.end}10 100%) !important; 
                                                   border-radius: 0.625rem; 
                                                   display: flex; 
                                                   align-items: center; 
                                                   justify-content: center; 
                                                   flex-shrink: 0;
                                                   box-shadow: 0 2px 6px ${category.color}20 !important;
                                                   border: 1px solid ${category.color}30 !important;">
                                            <i class="fas fa-user-tie" style="color: ${category.color} !important; font-size: 0.75rem;"></i>
                                        </div>
                                        <span style="font-weight: 600 !important; color: #374151 !important;">
                                            ${evaluation.coach_name}
                                        </span>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.625rem; font-size: 0.8125rem;">
                                        <div style="width: 2rem; 
                                                   height: 2rem; 
                                                   background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%) !important; 
                                                   border-radius: 0.625rem; 
                                                   display: flex; 
                                                   align-items: center; 
                                                   justify-content: center; 
                                                   flex-shrink: 0;
                                                   box-shadow: 0 2px 6px rgba(245,158,11,0.2) !important;">
                                            <i class="fas fa-calendar-plus" style="color: #d97706 !important; font-size: 0.75rem;"></i>
                                        </div>
                                        <span style="font-weight: 600 !important; color: #6b7280 !important;">
                                            ${assignedDate}
                                        </span>
                                    </div>
                                </div>
                                <button onclick="startPendingEvaluation(${evaluation.assessment_id})" 
                                        style="background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%) !important; 
                                               border: none !important; 
                                               padding: 0.75rem 1.25rem !important; 
                                               border-radius: 0.75rem !important; 
                                               color: #ffffff !important; 
                                               font-weight: 700 !important; 
                                               font-size: 0.875rem !important; 
                                               transition: all 0.2s ease !important; 
                                               white-space: nowrap !important; 
                                               box-shadow: 0 4px 12px rgba(245,158,11,0.4), 0 0 0 1px rgba(255,255,255,0.2) !important; 
                                               flex-shrink: 0 !important;
                                               cursor: pointer !important;
                                               display: inline-flex !important;
                                               align-items: center !important;
                                               gap: 0.5rem !important;
                                               align-self: flex-end !important;">
                                    <i class="fas fa-play-circle" style="font-size: 0.875rem !important; color: #ffffff !important;"></i>
                                    <span style="color: #ffffff !important;">Completar</span>
                                </button>
                            </div>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
            });
        }

        // Funci√≥n para iniciar una evaluaci√≥n pendiente
        async function startPendingEvaluation(assessmentId) {
            try {
                
                // Usar la funci√≥n existente startEvaluation que ya maneja todo el flujo
                await startEvaluation(assessmentId);
                
            } catch (error) {
                console.error('‚ùå Error iniciando evaluaci√≥n:', error);
                showToast('Error al iniciar la evaluaci√≥n: ' + error.message, 'error');
            }
        }

        // Helper function to get assertativeness level
        function getAssertativenessLevel(score) {
            if (score >= 80) return 'Muy Asertivo';
            if (score >= 65) return 'Asertivo';
            if (score >= 50) return 'Moderadamente Asertivo';
            if (score >= 35) return 'Poco Asertivo';
            return 'Muy Poco Asertivo';
        }

        // NOTA: evaluationCategories ahora se define en Alpine y se expone como window.evaluationCategories
        // La constante local ha sido eliminada para evitar conflictos

        // Utility: Convert hex color to rgba with alpha transparency
        // Reusable across all rendering functions
        function hexToRgba(hex, alpha) {
            if (!hex || hex.length < 7) return `rgba(100, 116, 139, ${alpha})`;
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }

        // Function to classify evaluation by category
        function classifyEvaluation(evaluation) {
            const title = evaluation.title.toLowerCase();
            const description = (evaluation.description || '').toLowerCase();
            const searchText = `${title} ${description}`;
            
            const categories = window.evaluationCategories || {};
            
            for (const [category, data] of Object.entries(categories)) {
                if (category === 'Otros') continue;
                
                for (const keyword of data.keywords) {
                    if (searchText.includes(keyword)) {
                        return category;
                    }
                }
            }
            
            return 'Otros';
        }

        // Create category header element with proper semantic structure
        // Returns a DOM element ready to append to container
        function createCategoryHeader(categoryName, category, evaluations, categoryId) {
            const categorySection = document.createElement('section');
            categorySection.className = 'assessment-category';
            categorySection.style.marginBottom = '1.5rem';
            categorySection.setAttribute('aria-labelledby', `header-${categoryId}`);
            
            // Get gradient colors for this category
            const getGradientColors = (baseColor) => {
                const gradients = {
                    '#a855f7': { start: '#a855f7', end: '#c084fc' }, // Purple
                    '#3b82f6': { start: '#3b82f6', end: '#60a5fa' }, // Blue
                    '#ec4899': { start: '#ec4899', end: '#f472b6' }, // Pink
                    '#22c55e': { start: '#22c55e', end: '#4ade80' }, // Green
                    '#f97316': { start: '#f97316', end: '#fb923c' }, // Orange
                };
                return gradients[baseColor] || { start: baseColor, end: baseColor };
            };
            
            const gradientColors = getGradientColors(category.color);
            
            categorySection.innerHTML = `
                <header class="section-header-eval" 
                     id="header-${categoryId}"
                     data-category-id="${categoryId}"
                     role="button"
                     tabindex="0"
                     aria-expanded="false"
                     aria-controls="${categoryId}"
                     style="background: white !important; 
                            padding: 1.25rem; 
                            border-radius: 1.25rem; 
                            margin-bottom: 1.25rem; 
                            cursor: pointer; 
                            transition: all 0.3s ease; 
                            box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important; 
                            border-left: 4px solid ${category.color} !important;
                            border: 1px solid #e5e7eb !important;">
                    <div style="display: flex; justify-content: space-between; align-items: center; gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 1rem; flex: 1; min-width: 0;">
                            <div role="img" aria-label="${categoryName} icono" style="width: 3.5rem; 
                                       height: 3.5rem; 
                                       background: linear-gradient(135deg, ${gradientColors.start} 0%, ${gradientColors.end} 100%) !important; 
                                       border-radius: 1rem; 
                                       display: flex; 
                                       align-items: center; 
                                       justify-content: center; 
                                       flex-shrink: 0; 
                                       box-shadow: 0 4px 12px ${hexToRgba(category.color, 0.4)}, 0 0 0 2px rgba(255,255,255,0.2) !important;">
                                <i class="fas ${category.icon}" aria-hidden="true" style="color: #ffffff !important; font-size: 1.5rem; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));"></i>
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <h3 class="category-title-responsive inline-text-dark" style="font-size: 1.125rem; font-weight: 700; margin: 0 0 0.25rem 0; line-height: 1.3; word-wrap: break-word; overflow-wrap: break-word; color: #111827 !important;">
                                    ${categoryName}
                                </h3>
                                <p class="inline-text-light" style="font-size: 0.875rem; margin: 0; font-weight: 600; color: #6b7280 !important;">
                                    ${evaluations.length} ${evaluations.length === 1 ? 'evaluaci√≥n disponible' : 'evaluaciones disponibles'}
                                </p>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0;">
                            <span role="status" aria-label="${evaluations.length} evaluaciones" style="background: linear-gradient(135deg, ${gradientColors.start} 0%, ${gradientColors.end} 100%) !important; 
                                         color: #ffffff !important; 
                                         padding: 0.5rem 1rem; 
                                         border-radius: 1.25rem; 
                                         font-size: 0.875rem; 
                                         font-weight: 800; 
                                         box-shadow: 0 4px 12px ${hexToRgba(category.color, 0.4)}, 0 0 0 2px rgba(255,255,255,0.3) !important;
                                         min-width: 2.5rem;
                                         text-align: center;">
                                ${evaluations.length}
                            </span>
                            <i class="fas fa-chevron-down" 
                               id="icon-${categoryId}" 
                               aria-hidden="true"
                               style="color: ${category.color} !important; 
                                      font-size: 1.125rem; 
                                      transition: transform 0.3s ease; 
                                      transform: rotate(-90deg);"></i>
                        </div>
                    </div>
                    
                    <style>
                        .section-header-eval:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 8px 16px rgba(0,0,0,0.12) !important;
                        }
                        
                        @media (min-width: 768px) {
                            .section-header-eval {
                                padding: 1.5rem !important;
                                border-radius: 1.25rem !important;
                                margin-bottom: 1.5rem !important;
                            }
                            .category-title-responsive {
                                font-size: 1.25rem !important;
                            }
                        }
                    </style>
                </header>
                <div class="assessments-grid category-grid" 
                     id="${categoryId}" 
                     role="region"
                     aria-label="${categoryName} evaluaciones"
                     data-expanded="false" 
                     style="grid-template-columns: repeat(auto-fill, minmax(min(300px, 100%), 1fr)); 
                            gap: 1.25rem;">
                </div>
            `;
            
            return categorySection;
        }

        // Create evaluation card element with proper semantic structure - Responsive
        // Returns a DOM element ready to append to grid
        function createEvaluationCard(evaluation, category) {
            const card = document.createElement('article');
            card.className = 'assessment-card';
            card.setAttribute('aria-label', `${evaluation.title} - ${evaluation.total_questions} preguntas`);
            
            // Get emoji for category (Figma style)
            const getCategoryEmoji = (categoryName) => {
                const emojiMap = {
                    'Personalidad': 'üéØ',
                    'Liderazgo': 'üëë',
                    'Inteligencia Emocional': '‚ù§Ô∏è',
                    'Trabajo en Equipo': 'üí™',
                    'Crecimiento Empresarial': '‚≠ê'
                };
                return emojiMap[categoryName] || 'üìã';
            };
            
            // Calculate progress (simulation for available evaluations)
            const completed = evaluation.attempts || 0;
            const total = evaluation.total_questions || 24;
            const percentage = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            // Get badge color based on percentage
            const getBadgeColor = (percent) => {
                if (percent >= 80) return { bg: '#dcfce7', text: '#166534' }; // Green
                if (percent >= 50) return { bg: '#fef3c7', text: '#92400e' }; // Yellow
                return { bg: '#fee2e2', text: '#991b1b' }; // Red
            };
            
            const badgeColors = getBadgeColor(percentage);
            
            // Get lighter and darker shades for gradients
            const getGradientColors = (baseColor) => {
                // Define gradient pairs for each category color
                const gradients = {
                    '#a855f7': { start: '#a855f7', end: '#c084fc' }, // Purple -> Lighter purple
                    '#3b82f6': { start: '#3b82f6', end: '#60a5fa' }, // Blue -> Lighter blue
                    '#ec4899': { start: '#ec4899', end: '#f472b6' }, // Pink -> Lighter pink
                    '#22c55e': { start: '#22c55e', end: '#4ade80' }, // Green -> Lighter green
                    '#f97316': { start: '#f97316', end: '#fb923c' }, // Orange -> Lighter orange
                };
                return gradients[baseColor] || { start: baseColor, end: baseColor };
            };
            
            const gradientColors = getGradientColors(category.color);
            const bgLight = hexToRgba(category.color, 0.1);
            const shadow = hexToRgba(category.color, 0.4);
            const categoryEmoji = getCategoryEmoji(category.name);
            
            card.style.cssText = `
                background: white !important;
                border-radius: 1.25rem !important;
                overflow: hidden !important;
                box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08) !important;
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
                border: 1px solid #e5e7eb !important;
                cursor: pointer !important;
                height: 100% !important;
                display: flex !important;
                flex-direction: column !important;
            `;
            
            // Add hover effect
            card.onmouseenter = () => {
                card.style.transform = 'translateY(-4px)';
                card.style.boxShadow = `0 12px 24px ${shadow} !important`;
            };
            card.onmouseleave = () => {
                card.style.transform = 'translateY(0)';
                card.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.08) !important';
            };
            
            card.innerHTML = `
                <!-- Emoji Header (Figma Style) -->
                <div style="padding: 1.5rem; background: white; border-bottom: 1px solid #f3f4f6;">
                    <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1rem;">
                        <div style="font-size: 2.5rem; line-height: 1; flex-shrink: 0;">${categoryEmoji}</div>
                        <div style="flex: 1; min-width: 0;">
                            <h4 style="font-size: 1rem; font-weight: 700; margin: 0 0 0.5rem 0; line-height: 1.4; color: #111827;">
                                ${evaluation.title}
                            </h4>
                            <p style="font-size: 0.875rem; margin: 0 0 0.75rem 0; line-height: 1.6; color: #6b7280;">
                                ${evaluation.description || 'Evaluaci√≥n dise√±ada para medir tus competencias profesionales'}
                            </p>
                            <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap; font-size: 0.875rem; color: #6b7280;">
                                <span>${evaluation.total_questions} preguntas</span>
                                ${percentage > 0 ? `
                                <span style="padding: 0.25rem 0.75rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600; background: ${badgeColors.bg}; color: ${badgeColors.text};">
                                    ${percentage}%
                                </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Progress Bar (Figma Style) -->
                    ${percentage > 0 ? `
                    <div style="margin-bottom: 1rem;">
                        <div style="height: 0.5rem; background: #e5e7eb; border-radius: 9999px; overflow: hidden;">
                            <div style="height: 100%; background: linear-gradient(90deg, ${gradientColors.start} 0%, ${gradientColors.end} 100%); border-radius: 9999px; width: ${percentage}%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                    ` : ''}
                    
                    <!-- Footer with Coach and Button -->
                    <div style="display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; flex-wrap: wrap;">
                        <div style="display: flex; align-items: center; gap: 0.625rem; font-size: 0.875rem; flex: 1; min-width: 0;">
                            <div style="width: 2rem; height: 2rem; background: linear-gradient(135deg, ${gradientColors.start}15 0%, ${gradientColors.end}10 100%); border-radius: 9999px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                <i class="fas fa-user-tie" style="color: ${category.color}; font-size: 0.75rem;"></i>
                            </div>
                            <span style="font-weight: 600; font-size: 0.875rem; color: #374151; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">
                                ${evaluation.coach_name || 'Coach'}
                            </span>
                        </div>
                        <button onclick="startEvaluation(${evaluation.id})" 
                                data-eval-btn
                                data-assessment-id="${evaluation.id}"
                                style="display: inline-flex; align-items: center; gap: 0.5rem; background: linear-gradient(135deg, ${gradientColors.start} 0%, ${gradientColors.end} 100%); border: none; padding: 0.625rem 1.25rem; border-radius: 0.5rem; color: white; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 2px 8px ${shadow};"
                                onmouseover="this.style.boxShadow='0 4px 12px ${shadow}'"
                                onmouseout="this.style.boxShadow='0 2px 8px ${shadow}'">
                            <i class="fas fa-eye" style="font-size: 0.875rem;"></i>
                            <span>Iniciar</span>
                        </button>
                    </div>
                </div>
                
                <style>
                    @media (min-width: 768px) {
                        .assessment-card .card-header-visual {
                            padding-top: 40% !important;
                        }
                        .assessment-card .card-header-visual i {
                            font-size: 3.25rem !important;
                        }
                        .assessment-card .card-header-visual > div:last-child {
                            top: 0.875rem !important;
                            right: 0.875rem !important;
                            padding: 0.5rem 0.75rem !important;
                            border-radius: 0.625rem !important;
                        }
                        .assessment-card .card-header-visual > div:last-child span {
                            font-size: 0.8125rem !important;
                            gap: 0.375rem !important;
                        }
                        .assessment-card .card-header-visual > div:last-child i {
                            font-size: 0.75rem !important;
                        }
                        .assessment-card .card-body-content {
                            padding: 1.25rem !important;
                        }
                        .assessment-card h4 {
                            font-size: 1.0625rem !important;
                            margin-bottom: 0.75rem !important;
                            min-height: 2.8rem !important;
                        }
                        .assessment-card p {
                            font-size: 0.875rem !important;
                            margin-bottom: 1rem !important;
                        }
                        .assessment-card footer {
                            gap: 0.75rem !important;
                            padding-top: 1rem !important;
                        }
                        .assessment-card footer > div:first-child {
                            gap: 0.625rem !important;
                            font-size: 0.875rem !important;
                        }
                        .assessment-card footer > div:first-child > div {
                            width: 2.25rem !important;
                            height: 2.25rem !important;
                        }
                        .assessment-card footer > div:first-child i {
                            font-size: 0.875rem !important;
                        }
                        .assessment-card footer > div:first-child span {
                            font-size: 0.875rem !important;
                        }
                        .assessment-card button {
                            padding: 0.75rem 1.375rem !important;
                            font-size: 0.875rem !important;
                            gap: 0.5rem !important;
                        }
                        .assessment-card button i {
                            font-size: 0.75rem !important;
                        }
                        .assessment-card button span {
                            font-size: 0.875rem !important;
                        }
                        .assessments-grid {
                            grid-template-columns: repeat(auto-fill, minmax(min(320px, 100%), 1fr)) !important;
                            gap: 1.25rem !important;
                        }
                    }
                </style>
            `;
            
            // Add hover effects
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-4px) !important';
                this.style.boxShadow = `0 8px 20px ${hexToRgba(category.color, 0.3)} !important`;
                this.style.borderColor = `${category.color} !important`;
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) !important';
                this.style.boxShadow = '0 2px 6px rgba(0, 0, 0, 0.08) !important';
                this.style.borderColor = `${borderColor} !important`;
            });
            
            // Button hover effects
            const button = card.querySelector('button');
            button.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-1px) !important';
                this.style.boxShadow = `0 4px 16px ${hexToRgba(category.color, 0.4)} !important`;
            });
            
            button.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0) !important';
                this.style.boxShadow = `0 2px 10px ${shadow} !important`;
            });
            
            return card;
        }

        // ============================================
        // CATEGORY TOGGLE - DELEGACI√ìN DE EVENTOS
        // ============================================
        
        // ============================================
        // DIAGN√ìSTICO EXHAUSTIVO - PRODUCCI√ìN
        // ============================================
        
        // Contador de llamadas por categor√≠a
        window.__toggleCallCount = window.__toggleCallCount || {};
        window.__mutationObservers = window.__mutationObservers || {};
        
        // Guard para evitar doble inicializaci√≥n en producci√≥n
        if (!window.__categoryToggleInitialized) {
            window.__categoryToggleInitialized = true;
            
            console.trace('üìç STACK DE INICIALIZACI√ìN');
            
            // Un solo listener global para clicks
            document.addEventListener('click', function(event) {
                const header = event.target.closest('.section-header-eval[data-category-id]');
                if (!header) return;
                
                console.trace('üìç STACK DEL CLICK');
                
                event.preventDefault();
                event.stopPropagation();
                
                const categoryId = header.getAttribute('data-category-id');
                toggleCategoryPure(categoryId, header);
            }, { passive: false });
            
            // Un solo listener global para teclado
            document.addEventListener('keydown', function(event) {
                const header = event.target.closest('.section-header-eval[data-category-id]');
                if (!header) return;
                
                if (event.key === 'Enter' || event.key === ' ') {
                    if (event.key === ' ') {
                        event.preventDefault(); // Prevenir scroll en Space
                    }
                    event.stopPropagation();
                    
                    console.trace('üìç STACK DEL TECLADO');
                    
                    const categoryId = header.getAttribute('data-category-id');
                    toggleCategoryPure(categoryId, header);
                }
            }, { passive: false });
        }
        
        // Funci√≥n de toggle pura con DIAGN√ìSTICO EXHAUSTIVO
        function toggleCategoryPure(categoryId, header) {
            // CONTADOR DE LLAMADAS
            if (!window.__toggleCallCount[categoryId]) {
                window.__toggleCallCount[categoryId] = 0;
            }
            window.__toggleCallCount[categoryId]++;
            
            const callNumber = window.__toggleCallCount[categoryId];
            
            console.trace('üìç STACK COMPLETO DE toggleCategoryPure');
            
            const categoryGrid = document.getElementById(categoryId);
            const icon = document.getElementById(`icon-${categoryId}`);
            
            if (!categoryGrid) {
                console.error('‚ùå No se encontr√≥ categoryGrid:', categoryId);
                console.trace('üìç STACK DEL ERROR');
                return;
            }
            
            // VERIFICAR IDs DUPLICADOS
            const allElementsWithId = document.querySelectorAll(`#${categoryId}`);
            if (allElementsWithId.length > 1) {
                console.error('üö® ID DUPLICADO DETECTADO:', categoryId);
                console.error('Cantidad de elementos:', allElementsWithId.length);
                console.error('Elementos:', allElementsWithId);
                console.trace('üìç STACK DE ID DUPLICADO');
            }
            
            const isExpanded = categoryGrid.getAttribute('data-expanded') === 'true';
            const newState = !isExpanded;
            
            
            // INSTALAR MUTATIONOBSERVER SI NO EXISTE
            if (!window.__mutationObservers[categoryId]) {
                
                const observer = new MutationObserver(function(mutations) {
                    mutations.forEach(function(mutation) {
                        if (mutation.type === 'attributes') {
                            console.trace('üìç STACK DE LA MUTACI√ìN');
                        }
                    });
                });
                
                observer.observe(categoryGrid, {
                    attributes: true,
                    attributeOldValue: true,
                    attributeFilter: ['data-expanded', 'style', 'class']
                });
                
                window.__mutationObservers[categoryId] = observer;
            }
            
            // Cambiar estado - CSS hace toda la animaci√≥n
            categoryGrid.setAttribute('data-expanded', newState.toString());
            
            // CR√çTICO: Limpiar estilos inline que pueden sobrescribir CSS
            if (newState) {
                // Si se est√° expandiendo, remover estilos inline restrictivos
                categoryGrid.style.maxHeight = '';
                categoryGrid.style.opacity = '';
                categoryGrid.style.marginBottom = '';
            }
            
            if (header) header.setAttribute('aria-expanded', newState.toString());
            
            // Rotar icono
            if (icon) {
                icon.style.transform = newState ? 'rotate(0deg)' : 'rotate(-90deg)';
            }
            
            
            // Warning si se llama m√°s de una vez
            if (callNumber > 1) {
                console.warn('‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è ATENCI√ìN: toggleCategoryPure llamado ' + callNumber + ' veces para ' + categoryId);
                console.warn('‚ö†Ô∏è‚ö†Ô∏è‚ö†Ô∏è Esto indica DOBLE EJECUCI√ìN - revisar el stack anterior');
                console.trace('üìç STACK DE LLAMADA M√öLTIPLE');
            }
        }

        // Expand all categories - CSS puro
        function expandAllCategories(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const allCategories = container.querySelectorAll('.category-grid[data-expanded="false"]');
            allCategories.forEach(grid => {
                const categoryId = grid.id;
                const icon = document.getElementById(`icon-${categoryId}`);
                const header = document.getElementById(`header-${categoryId}`);
                
                // Solo cambiar atributo - CSS hace el resto
                grid.setAttribute('data-expanded', 'true');
                if (header) header.setAttribute('aria-expanded', 'true');
                if (icon) icon.style.transform = 'rotate(0deg)';
            });
        }

        // Collapse all categories - CSS puro
        function collapseAllCategories(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const allCategories = container.querySelectorAll('.category-grid[data-expanded="true"]');
            allCategories.forEach(grid => {
                const categoryId = grid.id;
                const icon = document.getElementById(`icon-${categoryId}`);
                const header = document.getElementById(`header-${categoryId}`);
                
                // Solo cambiar atributo - CSS hace el resto
                grid.setAttribute('data-expanded', 'false');
                if (header) header.setAttribute('aria-expanded', 'false');
                if (icon) icon.style.transform = 'rotate(-90deg)';
            });
        }

        // Render available evaluations
        // Funci√≥n optimizada para renderizar evaluaciones disponibles con dise√±o moderno y compacto
        function renderAvailableEvaluationsLegacy() {
            
            const evaluationsData = window.evaluationsData;
            const container = document.getElementById('availableEvaluations');
            
            
            if (!container) {
                console.warn('‚ö†Ô∏è Legacy container availableEvaluations no encontrado (esperado - usando dise√±o Figma)');
                return;
            }
            
            // üõ°Ô∏è CONTENT GUARD: Skip re-render if content exists (preserves toggle state)
            // Only skip if we have actual evaluation content (not just a message)
            if (container.children.length > 0 && !window.__forceEvaluationsRender) {
                const hasEvaluationContent = container.querySelector('.category-grid');
                if (hasEvaluationContent) {
                    return;
                }
            }
            window.__forceEvaluationsRender = false; // Reset flag
            
            // üõ°Ô∏è CONTENT GUARD: Skip re-render if content exists (preserves toggle state)
            // Only skip if we have actual evaluation content (not just a message)
            if (container.children.length > 0 && !window.__forceEvaluationsRender) {
                const hasEvaluationContent = container.querySelector('.category-grid');
                if (hasEvaluationContent) {
                    return;
                }
            }
            window.__forceEvaluationsRender = false; // Reset flag
            
            // Verificar si hay un mensaje espec√≠fico (sin coach o sin invitaci√≥n)
            if (evaluationsData && evaluationsData.message) {
                container.innerHTML = `
                    <div class="text-center" style="padding: 4rem 2rem; animation: fadeIn 0.6s ease;">
                        <div class="d-inline-flex align-items-center justify-content-center mb-4" 
                             style="width: 5rem; height: 5rem; border-radius: 1.5rem; background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%); box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);">
                            <i class="fas fa-user-tie" style="font-size: 2.5rem; color: #3b82f6;"></i>
                        </div>
                        <h3 class="mb-2" class="inline-text-dark" style="font-size: 1.5rem; font-weight: 700">Informaci√≥n</h3>
                        <p class="mb-0" class="inline-text-light" style="font-size: 1rem; font-weight: 500; max-width: 400px; margin: 0 auto; line-height: 1.6">${evaluationsData.message}</p>
                    </div>
                `;
                return;
            }
            
            if (!evaluationsData || !evaluationsData.available || Object.keys(evaluationsData.available).length === 0) {
                container.innerHTML = `
                    <div class="text-center" style="padding: 4rem 2rem; animation: fadeIn 0.6s ease;">
                        <div class="d-inline-flex align-items-center justify-content-center mb-4" 
                             style="width: 5rem; height: 5rem; border-radius: 1.5rem; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); box-shadow: 0 10px 30px rgba(100, 116, 139, 0.15);">
                            <i class="fas fa-inbox" class="inline-text-light" style="font-size: 2.5rem"></i>
                        </div>
                        <h3 class="mb-2" class="inline-text-dark" style="font-size: 1.5rem; font-weight: 700">Sin evaluaciones disponibles</h3>
                        <p class="mb-4" class="inline-text-light" style="font-size: 1rem; font-weight: 500; max-width: 400px; margin: 0 auto 1.5rem; line-height: 1.6">
                            No tienes evaluaciones disponibles en este momento
                        </p>
                        <button type="button" onclick="location.reload()" 
                                class="btn d-inline-flex align-items-center gap-2"
                                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border: none; color: #ffffff; border-radius: 0.75rem; font-weight: 600; padding: 0.75rem 1.5rem; font-size: 0.9375rem; box-shadow: 0 4px 12px rgba(16, 185, 129, 0.25); transition: all 0.2s ease;"
                                onmouseenter="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(16, 185, 129, 0.35)';"
                                onmouseleave="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(16, 185, 129, 0.25)';"
                                aria-label="Actualizar evaluaciones">
                            <i class="fas fa-sync-alt"></i>
                            <span>Actualizar</span>
                        </button>
                    </div>
                `;
                return;
            }
            
            // Categorize evaluations
            const categorizedEvaluations = {};
            Object.values(evaluationsData.available).forEach(evaluation => {
                const category = classifyEvaluation(evaluation);
                if (!categorizedEvaluations[category]) {
                    categorizedEvaluations[category] = [];
                }
                categorizedEvaluations[category].push(evaluation);
            });
            
            // Clear container
            container.innerHTML = '';
            
            
            // Render each category using extracted functions
            Object.entries(categorizedEvaluations).forEach(([categoryName, evaluations]) => {
                const category = window.evaluationCategories ? window.evaluationCategories[categoryName] : null;
                
                if (!category) {
                    console.error(`‚ùå Categor√≠a ${categoryName} no encontrada`);
                    return;
                }
                
                const categoryId = `category-${categoryName.replace(/\s+/g, '-')}`;
                
                // Create category header using extracted function
                const categorySection = createCategoryHeader(categoryName, category, evaluations, categoryId);
                container.appendChild(categorySection);
                
                // Get grid element to append cards
                const grid = document.getElementById(categoryId);
                
                // Create and append each evaluation card
                evaluations.forEach(evaluation => {
                    const card = createEvaluationCard(evaluation, category);
                    grid.appendChild(card);
                });
            });
            
            // Update stats cards
            updateEvaluationStats();
        }
        
        // Update evaluation statistics cards (Figma style)
        function updateEvaluationStats() {
            const evaluationsData = window.evaluationsData;
            
            if (!evaluationsData) return;
            
            // Count evaluations
            const disponiblesCount = evaluationsData.available ? Object.keys(evaluationsData.available).length : 0;
            const completadasCount = evaluationsData.completed ? evaluationsData.completed.length : 0;
            const pendientesCount = evaluationsData.pending ? evaluationsData.pending.length : 0;
            const totalCount = disponiblesCount + completadasCount + pendientesCount;
            
            // Count unique tipos
            const tiposSet = new Set();
            if (evaluationsData.available) {
                Object.values(evaluationsData.available).forEach(e => tiposSet.add(e.assessment_id));
            }
            if (evaluationsData.completed) {
                evaluationsData.completed.forEach(e => tiposSet.add(e.assessment_id));
            }
            const tiposCount = tiposSet.size;
            
            // Update DOM elements
            const statsCompletadas = document.getElementById('stats-completadas');
            const statsPendientes = document.getElementById('stats-pendientes');
            const statsTipos = document.getElementById('stats-tipos');
            
            const progressCompletadas = document.getElementById('progress-completadas');
            const progressPendientes = document.getElementById('progress-pendientes');
            const progressTipos = document.getElementById('progress-tipos');
            
            if (statsCompletadas) statsCompletadas.textContent = completadasCount;
            if (statsPendientes) statsPendientes.textContent = pendientesCount;
            if (statsTipos) statsTipos.textContent = tiposCount;
            
            // Calculate percentages
            const completadasPercent = totalCount > 0 ? (completadasCount / totalCount * 100) : 0;
            const pendientesPercent = totalCount > 0 ? (pendientesCount / totalCount * 100) : 0;
            
            // Update progress bars
            if (progressCompletadas) {
                setTimeout(() => {
                    progressCompletadas.style.width = `${completadasPercent}%`;
                }, 100);
            }
            if (progressPendientes) {
                setTimeout(() => {
                    progressPendientes.style.width = `${pendientesPercent}%`;
                }, 100);
            }
            if (progressTipos) {
                // Tipos est√° siempre 100%
                progressTipos.style.width = '100%';
            }
            
            // Render Figma panels
            renderRadarChart();
            renderRecentCompletions();
        }

        // Render Radar Chart (Figma Style)
        function renderRadarChart() {
            const canvas = document.getElementById('radarChartEvaluaciones');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const evaluationsData = window.evaluationsData;
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#9ca3af';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('No hay evaluaciones completadas', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // Calculate average scores by dimension
            const dimensions = {
                'Liderazgo': [],
                'Comunicaci√≥n': [],
                'Trabajo en Equipo': [],
                'Resoluci√≥n de Problemas': [],
                'Adaptabilidad': [],
                'Creatividad': []
            };
            
            // Map assessments to dimensions
            evaluationsData.completed.forEach(evaluation => {
                const title = evaluation.assessment_title || '';
                const score = evaluation.score || 0;
                
                if (title.includes('Liderazgo')) dimensions['Liderazgo'].push(score);
                else if (title.includes('Comunicaci√≥n')) dimensions['Comunicaci√≥n'].push(score);
                else if (title.includes('Equipo')) dimensions['Trabajo en Equipo'].push(score);
                else if (title.includes('Problema')) dimensions['Resoluci√≥n de Problemas'].push(score);
                else if (title.includes('Adaptab')) dimensions['Adaptabilidad'].push(score);
                else if (title.includes('Creativ')) dimensions['Creatividad'].push(score);
                else {
                    // Default: distribute score to all dimensions
                    Object.keys(dimensions).forEach(dim => dimensions[dim].push(score / 6));
                }
            });
            
            // Calculate averages
            const scores = Object.keys(dimensions).map(dim => {
                const values = dimensions[dim];
                return values.length > 0 ? values.reduce((a, b) => a + b, 0) / values.length : 50;
            });
            
            // Find top and weak skills
            const labels = Object.keys(dimensions);
            const maxIndex = scores.indexOf(Math.max(...scores));
            const minIndex = scores.indexOf(Math.min(...scores));
            
            document.getElementById('radar-total-evals').textContent = evaluationsData.completed.length;
            document.getElementById('radar-top-skill').textContent = labels[maxIndex];
            document.getElementById('radar-improve-skill').textContent = labels[minIndex];
            
            // Draw radar chart
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 60;
            const angleStep = (Math.PI * 2) / labels.length;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid circles
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            for (let i = 1; i <= 5; i++) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, (radius / 5) * i, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = '#d1d5db';
            labels.forEach((label, i) => {
                const angle = angleStep * i - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // Draw labels
                const labelX = centerX + Math.cos(angle) * (radius + 40);
                const labelY = centerY + Math.sin(angle) * (radius + 40);
                ctx.fillStyle = '#374151';
                ctx.font = '12px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(label, labelX, labelY);
            });
            
            // Draw data polygon
            ctx.fillStyle = 'rgba(168, 85, 247, 0.3)';
            ctx.strokeStyle = '#a855f7';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            scores.forEach((score, i) => {
                const angle = angleStep * i - Math.PI / 2;
                const distance = (score / 100) * radius;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Draw data points
            ctx.fillStyle = '#a855f7';
            scores.forEach((score, i) => {
                const angle = angleStep * i - Math.PI / 2;
                const distance = (score / 100) * radius;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }

        // Render Recent Completions (Figma Style)
        function renderRecentCompletions() {
            const container = document.getElementById('recentCompletions');
            if (!container) return;
            
            const evaluationsData = window.evaluationsData;
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; font-size: 0.875rem; text-align: center;">No hay evaluaciones completadas</p>';
                return;
            }
            
            // Get last 5 completions
            const recentEvals = [...evaluationsData.completed]
                .sort((a, b) => new Date(b.completed_at) - new Date(a.completed_at))
                .slice(0, 5);
            
            let html = '';
            recentEvals.forEach(evaluation => {
                const score = Math.round(evaluation.score || 0);
                const title = evaluation.assessment_title || 'Evaluaci√≥n';
                const date = evaluation.completed_at;
                
                // Get emoji for category
                const getCategoryEmoji = (title) => {
                    if (title.includes('Personalidad') || title.includes('DISC')) return 'üéØ';
                    if (title.includes('Liderazgo')) return 'üëë';
                    if (title.includes('Emocional')) return '‚ù§Ô∏è';
                    if (title.includes('Equipo')) return 'üí™';
                    if (title.includes('Empresarial') || title.includes('crecer')) return '‚≠ê';
                    return 'üìã';
                };
                
                // Get badge color
                const getBadgeColor = (score) => {
                    if (score >= 80) return { bg: '#dcfce7', text: '#166534' };
                    if (score >= 50) return { bg: '#fef3c7', text: '#92400e' };
                    return { bg: '#fee2e2', text: '#991b1b' };
                };
                
                const badgeColors = getBadgeColor(score);
                const emoji = getCategoryEmoji(title);
                
                // Format relative time
                const getRelativeTime = (dateStr) => {
                    const now = new Date();
                    const then = new Date(dateStr);
                    const diffMs = now - then;
                    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 0) return 'Hoy';
                    if (diffDays === 1) return 'Ayer';
                    if (diffDays < 7) return `Hace ${diffDays} d√≠as`;
                    return then.toLocaleDateString('es-ES');
                };
                
                html += `
                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-radius: 0.5rem; background: #f9fafb; border: 1px solid #e5e7eb;">
                        <div style="font-size: 1.5rem; flex-shrink: 0;">${emoji}</div>
                        <div style="flex: 1; min-width: 0;">
                            <p style="font-size: 0.875rem; font-weight: 500; color: #111827; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${title}</p>
                            <p style="font-size: 0.75rem; color: #6b7280; margin: 0;">${getRelativeTime(date)}</p>
                        </div>
                        <div style="background: ${badgeColors.bg}; color: ${badgeColors.text}; padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.75rem; font-weight: 600; flex-shrink: 0;">
                            ${score}%
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // ============================================
        // NUEVA SECCI√ìN FIGMA: Funciones de Renderizado
        // ============================================
        
        // Render Figma Evaluaciones Section (Complete)
        function renderFigmaEvaluacionesSection() {
            renderFigmaStats();
            // renderFigmaEvaluacionesList(); // ‚ùå DESHABILITADO - Conflicto con secciones expandibles
            // renderFigmaRadarChart(); // ‚ùå DESHABILITADO - Ahora est√° en completadas-section
            // renderFigmaRecentCompletions(); // ‚ùå DESHABILITADO - No se usa
        }
        
        // Render Figma Stats Cards
        function renderFigmaStats() {
            const evaluationsData = window.evaluationsData;
            
            if (!evaluationsData) {
                console.log('‚ö†Ô∏è FIGMA STATS: No hay datos de evaluaciones');
                return;
            }
            
            console.log('üìä FIGMA STATS: Datos recibidos:', evaluationsData);
            
            // Count evaluations
            const disponiblesCount = evaluationsData.available ? Object.keys(evaluationsData.available).length : 0;
            const completadasCount = evaluationsData.completed ? evaluationsData.completed.length : 0;
            
            // Calcular pendientes: evaluaciones asignadas que NO est√°n completadas
            // üî• USAR FLAG is_completed del backend
            let pendientesCount = 0;
            if (evaluationsData.available) {
                Object.values(evaluationsData.available).forEach(avail => {
                    if (!avail.is_completed) {  // üî• Usar flag directo
                        pendientesCount++;
                    }
                });
            }
            
            const totalCount = disponiblesCount;
            
            // Count unique tipos
            const tiposSet = new Set();
            if (evaluationsData.available) {
                Object.values(evaluationsData.available).forEach(e => tiposSet.add(e.id));
            }
            const tiposCount = tiposSet.size;
            
            console.log(`üìä FIGMA STATS: Completadas=${completadasCount}, Pendientes=${pendientesCount}, Tipos=${tiposCount}`);
            
            // Update DOM
            const completadasEl = document.getElementById('figma-stats-completadas');
            const pendientesEl = document.getElementById('figma-stats-pendientes');
            const tiposEl = document.getElementById('figma-stats-tipos');
            
            if (completadasEl) completadasEl.textContent = completadasCount;
            if (pendientesEl) pendientesEl.textContent = pendientesCount;
            if (tiposEl) tiposEl.textContent = tiposCount;
            
            // Calculate percentages
            const completadasPercent = totalCount > 0 ? (completadasCount / totalCount * 100) : 0;
            const pendientesPercent = totalCount > 0 ? (pendientesCount / totalCount * 100) : 0;
            
            // Animate progress bars
            setTimeout(() => {
                const progressCompletadas = document.getElementById('figma-progress-completadas');
                const progressPendientes = document.getElementById('figma-progress-pendientes');
                
                if (progressCompletadas) progressCompletadas.style.width = `${completadasPercent}%`;
                if (progressPendientes) progressPendientes.style.width = `${pendientesPercent}%`;
                
                // üî• AUTO-EXPAND: Expandir secci√≥n Completadas por defecto
                autoExpandCompletadasSection();
            }, 100);
        }
        
        // üî• AUTO-EXPAND: Funci√≥n para expandir autom√°ticamente la secci√≥n Completadas
        function autoExpandCompletadasSection() {
            const section = document.getElementById('completadas-section');
            const chevron = document.getElementById('completadas-chevron');
            
            if (!section) return;
            
            // Solo expandir si est√° oculta
            if (section.style.display === 'none' || section.style.display === '') {
                section.style.display = 'block';
                if (chevron) chevron.style.transform = 'rotate(180deg)';
                
                // Renderizar contenido si a√∫n no se ha renderizado
                if (typeof renderCompletadasSubsection === 'function') {
                    renderCompletadasSubsection();
                }
                
                console.log('‚úÖ Secci√≥n Completadas expandida autom√°ticamente');
            }
        }
        
        // üî• Render Figma Evaluaciones List - DISE√ëO MODERNO
        function renderFigmaEvaluacionesList() {
            console.log('üìã FIGMA LIST: Rendering evaluaciones list');
            const container = document.getElementById('figma-evaluaciones-lista');
            const countBadge = document.getElementById('eval-count-badge');
            const evaluationsData = window.evaluationsData;
            
            console.log('üìã FIGMA LIST: evaluationsData =', evaluationsData);
            
            if (!evaluationsData || !evaluationsData.available || Object.keys(evaluationsData.available).length === 0) {
                console.log('‚ö†Ô∏è FIGMA LIST: No hay evaluaciones disponibles');
                if (container) {
                    container.innerHTML = `
                        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: #9ca3af;">
                            <i class="fas fa-clipboard-check" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p style="font-size: 1.125rem; font-weight: 500; color: #6b7280; margin: 0;">No hay evaluaciones disponibles</p>
                        </div>
                    `;
                }
                if (countBadge) countBadge.textContent = '0';
                return;
            }
            
            const availableCount = Object.keys(evaluationsData.available).length;
            if (countBadge) countBadge.textContent = `${availableCount} activas`;
            
            // Get emoji for category
            const getCategoryEmoji = (title) => {
                if (!title) return 'üìã';
                if (title.includes('Personalidad') || title.includes('DISC')) return 'üéØ';
                if (title.includes('Liderazgo')) return 'üëë';
                if (title.includes('Emocional')) return '‚ù§Ô∏è';
                if (title.includes('Equipo')) return 'üí™';
                if (title.includes('Empresarial') || title.includes('crecer')) return '‚≠ê';
                return 'üìã';
            };
            
            // Gradient based on category
            const getGradient = (title) => {
                if (title.includes('Personalidad') || title.includes('DISC')) return 'linear-gradient(135deg, #a855f7 0%, #c084fc 100%)';
                if (title.includes('Liderazgo')) return 'linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%)';
                if (title.includes('Emocional')) return 'linear-gradient(135deg, #ec4899 0%, #f472b6 100%)';
                if (title.includes('Equipo')) return 'linear-gradient(135deg, #22c55e 0%, #4ade80 100%)';
                if (title.includes('Empresarial') || title.includes('crecer')) return 'linear-gradient(135deg, #f97316 0%, #fb923c 100%)';
                return 'linear-gradient(135deg, #6366f1 0%, #818cf8 100%)';
            };
            
            console.log('üìã FIGMA LIST: Building HTML for', availableCount, 'evaluaciones');
            let html = '';
            
            Object.values(evaluationsData.available).forEach(evaluation => {
                const emoji = getCategoryEmoji(evaluation.title);
                const attempts = evaluation.previous_attempts || 0;
                const total = evaluation.total_questions || 24;
                const percentage = Math.round((attempts / total) * 100);
                const gradient = getGradient(evaluation.title);
                
                // Status badge
                const getStatusBadge = (percent) => {
                    if (percent === 0) return { icon: 'fa-play-circle', text: 'Sin iniciar', color: '#f59e0b' };
                    if (percent < 50) return { icon: 'fa-hourglass-half', text: 'En inicio', color: '#ef4444' };
                    if (percent < 80) return { icon: 'fa-chart-line', text: 'En progreso', color: '#3b82f6' };
                    return { icon: 'fa-check-circle', text: 'Casi lista', color: '#10b981' };
                };
                
                const status = getStatusBadge(percentage);
                
                html += `
                    <div class="modern-eval-card" style="position: relative; background: white; border-radius: 1rem; padding: 1.25rem; border: 2px solid #f3f4f6; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer; overflow: hidden;" 
                         onmouseover="this.style.borderColor='#a855f7'; this.style.boxShadow='0 10px 25px -5px rgba(168, 85, 247, 0.2)'; this.style.transform='translateY(-4px)';" 
                         onmouseout="this.style.borderColor='#f3f4f6'; this.style.boxShadow='none'; this.style.transform='translateY(0)';">
                        
                        <!-- Top gradient line -->
                        <div style="position: absolute; top: 0; left: 0; right: 0; height: 3px; background: ${gradient};"></div>
                        
                        <!-- Header with emoji and status -->
                        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.75rem;">
                            <div style="width: 48px; height: 48px; background: ${gradient}; border-radius: 0.75rem; display: flex; align-items: center; justify-content: center; font-size: 1.5rem;">
                                ${emoji}
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.375rem; padding: 0.375rem 0.75rem; background: ${status.color}15; border-radius: 9999px;">
                                <i class="fas ${status.icon}" style="font-size: 0.75rem; color: ${status.color};"></i>
                                <span style="font-size: 0.75rem; font-weight: 600; color: ${status.color};">${status.text}</span>
                            </div>
                        </div>
                        
                        <!-- Title -->
                        <h4 style="font-size: 1rem; font-weight: 600; color: #111827; margin: 0 0 0.5rem 0; line-height: 1.4;">
                            ${evaluation.title}
                        </h4>
                        
                        <!-- Description -->
                        <p style="font-size: 0.8125rem; color: #6b7280; margin: 0 0 1rem 0; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                            ${evaluation.description || 'Evaluaci√≥n disponible para completar'}
                        </p>
                        
                        <!-- Progress section -->
                        <div style="margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="font-size: 0.75rem; font-weight: 500; color: #6b7280;">Progreso</span>
                                <span style="font-size: 0.875rem; font-weight: 700; color: #111827;">${percentage}%</span>
                            </div>
                            <div style="width: 100%; height: 6px; background: #f3f4f6; border-radius: 9999px; overflow: hidden;">
                                <div style="width: ${percentage}%; height: 100%; background: ${gradient}; border-radius: 9999px; transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);"></div>
                            </div>
                        </div>
                        
                        <!-- Footer with info and action -->
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 0.75rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; font-size: 0.75rem; color: #9ca3af;">
                                <span style="display: flex; align-items: center; gap: 0.25rem;">
                                    <i class="fas fa-list-ul"></i> ${total}
                                </span>
                                <span style="display: flex; align-items: center; gap: 0.25rem;">
                                    <i class="fas fa-clock"></i> ~${Math.ceil(total / 2)}min
                                </span>
                            </div>
                            <button onclick="event.stopPropagation(); startEvaluation(${evaluation.id})" 
                                    style="background: ${gradient}; border: none; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.8125rem; font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap;"
                                    onmouseover="this.style.transform='scale(1.05)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.15)';"
                                    onmouseout="this.style.transform='scale(1)'; this.style.boxShadow='none';">
                                ${percentage > 0 ? '<i class="fas fa-play"></i> Continuar' : '<i class="fas fa-rocket"></i> Iniciar'}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ============================================
        // üî• SECCI√ìN: EVALUACIONES COMPLETADAS
        // ============================================
        
        function toggleCompletadasSection(event) {
            if (event) event.stopPropagation();
            console.log('üîÑ Toggle COMPLETADAS');
            
            const section = document.getElementById('completadas-section');
            const chevron = document.getElementById('completadas-chevron');
            
            if (!section) {
                console.error('‚ùå Completadas section not found');
                return;
            }
            
            // Cerrar otras secciones
            const pendientesSection = document.getElementById('pendientes-section');
            const disponiblesSection = document.getElementById('disponibles-section');
            const pendientesChevron = document.getElementById('pendientes-chevron');
            const disponiblesChevron = document.getElementById('disponibles-chevron');
            
            if (pendientesSection) pendientesSection.style.display = 'none';
            if (disponiblesSection) disponiblesSection.style.display = 'none';
            if (pendientesChevron) pendientesChevron.style.transform = 'rotate(0deg)';
            if (disponiblesChevron) disponiblesChevron.style.transform = 'rotate(0deg)';
            
            // Toggle la secci√≥n actual
            const isVisible = section.style.display === 'block';
            
            if (isVisible) {
                // Cerrar
                section.style.display = 'none';
                if (chevron) chevron.style.transform = 'rotate(0deg)';
            } else {
                // Abrir
                section.style.display = 'block';
                if (chevron) chevron.style.transform = 'rotate(180deg)';
                renderCompletadasSubsection();
            }
        }
        
        // üî• NUEVA FUNCI√ìN: Toggle individual de categor√≠as
        function toggleCategory(categoryId) {
            const content = document.getElementById(`${categoryId}-content`);
            const chevron = document.getElementById(`${categoryId}-chevron`);
            
            if (!content || !chevron) return;
            
            const isVisible = content.style.display !== 'none';
            
            if (isVisible) {
                // Colapsar
                content.style.display = 'none';
                chevron.style.transform = 'rotate(0deg)';
            } else {
                // Expandir
                content.style.display = 'flex';
                chevron.style.transform = 'rotate(180deg)';
            }
        }
        
        async function renderCompletadasSubsection() {
            console.log('üìã RENDER: Completadas Subsection (con historial agrupado)');
            const container = document.getElementById('figma-completadas-grouped');
            
            if (!container) {
                console.error('‚ùå Container figma-completadas-grouped not found');
                return;
            }
            
            // Mostrar loading
            container.innerHTML = `
                <div style="text-align: center; padding: 3rem; color: #9ca3af;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                    <p style="font-size: 1rem; color: #6b7280; margin: 0;">Cargando historial...</p>
                </div>
            `;
            
            try {
                // Cargar historial completo desde API
                const response = await fetch(`${API_BASE_URL}/api/coachee/all-assessment-history`);
                const data = await response.json();
                
                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Error cargando historial');
                }
                
                const history = data.history;
                const statistics = data.statistics;
                
                if (!history || Object.keys(history).length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 3rem; color: #9ca3af;">
                            <i class="fas fa-clipboard-check" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                            <p style="font-size: 1.125rem; font-weight: 500; color: #6b7280; margin: 0;">No hay evaluaciones completadas</p>
                        </div>
                    `;
                    return;
                }
                
                console.log('‚úÖ HISTORIAL: Cargados', Object.keys(history).length, 'tipos de evaluaciones');
                console.log('üìä ESTAD√çSTICAS:', statistics);
                
                // Helper functions
                const getCategoryEmoji = (title) => {
                    if (!title) return 'üìã';
                    if (title.includes('Personalidad') || title.includes('DISC')) return 'üéØ';
                    if (title.includes('Liderazgo')) return 'üëë';
                    if (title.includes('Emocional')) return '‚ù§Ô∏è';
                    if (title.includes('Equipo')) return 'üí™';
                    if (title.includes('Empresarial') || title.includes('crecer')) return '‚≠ê';
                    return 'üìã';
                };
                
                const getGradient = (title) => {
                    if (title.includes('Personalidad') || title.includes('DISC')) return 'linear-gradient(135deg, #a855f7 0%, #c084fc 100%)';
                    if (title.includes('Liderazgo')) return 'linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%)';
                    if (title.includes('Emocional')) return 'linear-gradient(135deg, #ec4899 0%, #f472b6 100%)';
                    if (title.includes('Equipo')) return 'linear-gradient(135deg, #22c55e 0%, #4ade80 100%)';
                    if (title.includes('Empresarial') || title.includes('crecer')) return 'linear-gradient(135deg, #f97316 0%, #fb923c 100%)';
                    return 'linear-gradient(135deg, #10b981 0%, #34d399 100%)';
                };
                
                const getScoreBadge = (percent) => {
                    if (percent >= 80) return { bg: '#dcfce7', text: '#166534', label: 'Excelente', icon: 'üåü' };
                    if (percent >= 60) return { bg: '#dbeafe', text: '#1e40af', label: 'Bueno', icon: 'üëç' };
                    if (percent >= 40) return { bg: '#fef3c7', text: '#92400e', label: 'Regular', icon: 'üìà' };
                    return { bg: '#fee2e2', text: '#991b1b', label: 'Bajo', icon: 'üí™' };
                };
                
                // Generar HTML
                let html = '';
                
                // Iterar sobre cada tipo de evaluaci√≥n
                for (const [assessmentId, assessmentData] of Object.entries(history)) {
                    const title = assessmentData.title;
                    const attempts = assessmentData.data;
                    const emoji = getCategoryEmoji(title);
                    const gradient = getGradient(title);
                    
                    // Calcular progreso (comparar √∫ltimo vs primer intento)
                    // Como est√°n ordenados descendente: [0] = √∫ltimo, [length-1] = primero
                    const lastScore = attempts[0].percentage;  // üî• M√°s reciente
                    const firstScore = attempts[attempts.length - 1].percentage;  // üî• M√°s antiguo
                    const improvement = lastScore - firstScore;
                    const improvementIcon = improvement > 0 ? 'üìà' : improvement < 0 ? 'üìâ' : '‚û°Ô∏è';
                    const improvementColor = improvement > 0 ? '#10b981' : improvement < 0 ? '#ef4444' : '#6b7280';
                    const categoryId = `category-${assessmentId}`;
                    
                    html += `
                        <div style="background: white; border: 3px solid #e5e7eb; border-radius: 1.25rem; padding: 0; transition: all 0.3s; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);">
                            <!-- Header del grupo (clickeable para colapsar/expandir) -->
                            <div onclick="toggleCategory('${categoryId}')" style="display: flex; align-items: center; gap: 1rem; padding: 1.5rem; cursor: pointer; user-select: none; border-radius: 1rem; transition: all 0.2s;" 
                                 onmouseover="this.style.background='#f9fafb'" 
                                 onmouseout="this.style.background='white'">
                                <div style="width: 70px; height: 70px; background: ${gradient}; border-radius: 1.25rem; display: flex; align-items: center; justify-content: center; font-size: 2.25rem; flex-shrink: 0; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);">
                                    ${emoji}
                                </div>
                                <div style="flex: 1;">
                                    <h3 style="font-size: 1.375rem; font-weight: 700; color: #111827; margin: 0 0 0.75rem 0;">${title}</h3>
                                    <div style="display: flex; align-items: center; gap: 1rem; flex-wrap: wrap;">
                                        <span style="display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.375rem 0.75rem; background: linear-gradient(135deg, #f3e8ff, #e9d5ff); border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; color: #7c3aed;">
                                            <i class="fas fa-redo"></i> ${attempts.length} intento${attempts.length > 1 ? 's' : ''}
                                        </span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.375rem; padding: 0.375rem 0.75rem; background: linear-gradient(135deg, ${improvement > 0 ? '#dcfce7, #bbf7d0' : improvement < 0 ? '#fee2e2, #fecaca' : '#f3f4f6, #e5e7eb'}); border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; color: ${improvementColor};">
                                            ${improvementIcon} ${improvement > 0 ? '+' : ''}${Math.round(improvement)}% progreso
                                        </span>
                                    </div>
                                </div>
                                <i id="${categoryId}-chevron" class="fas fa-chevron-down" style="color: #6b7280; font-size: 1.5rem; transition: transform 0.3s;"></i>
                            </div>
                            
                            <!-- Timeline de intentos (colapsable) -->
                            <div id="${categoryId}-content" style="display: none; flex-direction: column; gap: 1rem; padding: 0 1.5rem 1.5rem 1.5rem; background: #f9fafb; border-radius: 0 0 1rem 1rem;">
                    `;
                    
                    // Mostrar cada intento (ya vienen ordenados descendente del backend - √∫ltimo primero)
                    attempts.forEach((attempt, index) => {
                        const badge = getScoreBadge(attempt.percentage);
                        const isLatest = index === 0;  // üî• El primero es el m√°s reciente (orden descendente)
                        const attemptBg = isLatest ? 'linear-gradient(135deg, #dcfce7 0%, #bbf7d0 100%)' : '#ffffff';
                        const attemptBorder = isLatest ? '3px solid #10b981' : '2px solid #e5e7eb';
                        const attemptShadow = isLatest ? '0 10px 15px -3px rgba(16, 185, 129, 0.3), 0 4px 6px -2px rgba(16, 185, 129, 0.2)' : '0 1px 3px 0 rgba(0, 0, 0, 0.1)';
                        
                        html += `
                            <div style="display: flex; align-items: center; gap: 1.25rem; padding: 1.25rem; background: ${attemptBg}; border-radius: 1rem; border: ${attemptBorder}; position: relative; transition: all 0.2s; box-shadow: ${attemptShadow};" 
                                 onmouseover="this.style.transform='translateX(4px)'; this.style.boxShadow='0 10px 15px -3px rgba(0, 0, 0, 0.15), 0 4px 6px -2px rgba(0, 0, 0, 0.1)'"
                                 onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='${attemptShadow}'">
                                <!-- N√∫mero de intento -->
                                <div style="width: 56px; height: 56px; background: ${gradient}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 1.25rem; flex-shrink: 0; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1); position: relative;">
                                    #${attempt.attempt_number}
                                    ${isLatest ? '<div style="position: absolute; top: -4px; right: -4px; width: 16px; height: 16px; background: #fbbf24; border: 2px solid white; border-radius: 50%; animation: pulse 2s infinite;"></div>' : ''}
                                </div>
                                
                                <!-- Info del intento -->
                                <div style="flex: 1; min-width: 0;">
                                    <div style="display: flex; align-items: center; gap: 0.625rem; margin-bottom: 0.75rem; flex-wrap: wrap;">
                                        <span style="font-size: 1.5rem; font-weight: 700; color: #111827;">${Math.round(attempt.percentage)}%</span>
                                        <span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.375rem 0.625rem; background: ${badge.bg}; color: ${badge.text}; border-radius: 0.5rem; font-size: 0.813rem; font-weight: 700; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);">
                                            ${badge.icon} ${badge.label}
                                        </span>
                                        ${isLatest ? '<span style="display: inline-flex; align-items: center; gap: 0.25rem; padding: 0.375rem 0.625rem; background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; border-radius: 0.5rem; font-size: 0.813rem; font-weight: 700; box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);">‚ú® M√°s reciente</span>' : ''}
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.875rem; color: #6b7280; margin-bottom: 0.75rem;">
                                        <i class="fas fa-calendar-alt" style="color: #a855f7;"></i>
                                        <span style="font-weight: 500; color: #374151;">${attempt.date_only}</span>
                                        <span style="color: #d1d5db;">‚Ä¢</span>
                                        <i class="fas fa-clock" style="color: #ec4899;"></i>
                                        <span style="font-weight: 500; color: #374151;">${attempt.time_only}</span>
                                    </div>
                                    
                                    <!-- Progress bar mejorada -->
                                    <div style="position: relative; width: 100%; height: 0.625rem; background: linear-gradient(to right, #f3f4f6, #e5e7eb); border-radius: 9999px; overflow: hidden; box-shadow: inset 0 2px 4px 0 rgba(0, 0, 0, 0.06);">
                                        <div style="width: ${attempt.percentage}%; height: 100%; background: ${gradient}; transition: width 0.6s ease; box-shadow: 0 0 10px rgba(168, 85, 247, 0.4); position: relative;">
                                            <div style="position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent); animation: shimmer 2s infinite;"></div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Bot√≥n ver detalles mejorado -->
                                <button onclick="viewHistoryAttemptDetails(${attempt.id})" 
                                        style="background: ${gradient}; border: none; color: white; padding: 0.75rem 1.25rem; border-radius: 0.75rem; font-size: 0.875rem; font-weight: 600; cursor: pointer; transition: all 0.2s; white-space: nowrap; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1);"
                                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2)'"
                                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px -1px rgba(0, 0, 0, 0.2), 0 2px 4px -1px rgba(0, 0, 0, 0.1)'">
                                    <i class="fas fa-eye"></i> Ver detalles
                                </button>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
                
                container.innerHTML = html;
                
            } catch (error) {
                console.error('‚ùå Error cargando historial:', error);
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #ef4444;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <p style="font-size: 1rem; font-weight: 500; margin: 0;">Error cargando historial de evaluaciones</p>
                        <p style="font-size: 0.875rem; color: #6b7280; margin-top: 0.5rem;">${error.message}</p>
                    </div>
                `;
            }
        }
        
        // ============================================
        // üî• FUNCI√ìN: Ver detalles de intento hist√≥rico
        // ============================================
        
        async function viewHistoryAttemptDetails(history_id) {
            console.log(`üìñ Loading history attempt details: ${history_id}`);
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/history-attempt-details/${history_id}`);
                const data = await response.json();
                
                if (!response.ok || !data.success) {
                    throw new Error(data.error || 'Error cargando detalles del intento');
                }
                
                console.log(`‚úÖ Loaded attempt #${data.evaluation.attempt_number} (History ID: ${history_id})`);
                console.log('üîç DEBUG Evaluation data:', data.evaluation);
                console.log(`üìä Score: ${data.evaluation.score}%, is_percentage: ${data.evaluation.is_percentage}`);
                console.log('üì¶ FULL API RESPONSE:', JSON.stringify(data, null, 2));
                
                // Reutilizar la funci√≥n existente de renderizado
                renderEvaluationDetails(data.evaluation);
                
                // Mostrar modal
                const modalElement = document.getElementById('evaluationDetailsModal');
                const modal = new bootstrap.Modal(modalElement, {
                    backdrop: false,
                    keyboard: true,
                    focus: true
                });
                modal.show();
                
            } catch (error) {
                console.error('‚ùå Error loading history attempt:', error);
                showToast(`Error: ${error.message}`, 'error');
            }
        }
        
        // ============================================
        // üî• SECCI√ìN: EVALUACIONES PENDIENTES
        // ============================================
        
        function togglePendientesSection(event) {
            if (event) event.stopPropagation();
            console.log('üîÑ Toggle PENDIENTES');
            
            const section = document.getElementById('pendientes-section');
            const chevron = document.getElementById('pendientes-chevron');
            
            if (!section) {
                console.error('‚ùå Pendientes section not found');
                return;
            }
            
            // Cerrar otras secciones
            const completadasSection = document.getElementById('completadas-section');
            const disponiblesSection = document.getElementById('disponibles-section');
            const completadasChevron = document.getElementById('completadas-chevron');
            const disponiblesChevron = document.getElementById('disponibles-chevron');
            
            if (completadasSection) completadasSection.style.display = 'none';
            if (disponiblesSection) disponiblesSection.style.display = 'none';
            if (completadasChevron) completadasChevron.style.transform = 'rotate(0deg)';
            if (disponiblesChevron) disponiblesChevron.style.transform = 'rotate(0deg)';
            
            // Toggle la secci√≥n actual
            const isVisible = section.style.display === 'block';
            
            if (isVisible) {
                // Cerrar
                section.style.display = 'none';
                if (chevron) chevron.style.transform = 'rotate(0deg)';
            } else {
                // Abrir
                section.style.display = 'block';
                if (chevron) chevron.style.transform = 'rotate(180deg)';
                renderPendientesSubsection();
            }
        }
        
        function renderPendientesSubsection() {
            console.log('üìã RENDER: Pendientes Subsection');
            const container = document.getElementById('figma-pendientes-lista');
            const evaluationsData = window.evaluationsData;
            
            if (!container) {
                console.error('‚ùå Container figma-pendientes-lista not found');
                return;
            }
            
            // Validar datos
            if (!evaluationsData || !evaluationsData.available) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #9ca3af;">
                        <i class="fas fa-clock" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p style="font-size: 1.125rem; font-weight: 500; color: #6b7280; margin: 0;">No se pudieron cargar las evaluaciones</p>
                    </div>
                `;
                return;
            }
            
            // DEBUG: Mostrar datos disponibles
            console.log('üìä DEBUG Pendientes - Datos disponibles:', {
                available: evaluationsData.available,
                completed: evaluationsData.completed,
                availableCount: Object.keys(evaluationsData.available).length,
                completedCount: evaluationsData.completed ? evaluationsData.completed.length : 0
            });
            
            // üî• L√ìGICA CORRECTA: Pendientes = evaluaciones asignadas que NO est√°n completadas
            // Usar el flag is_completed del backend directamente
            const pendientes = Object.values(evaluationsData.available).filter(eval => {
                const isPending = !eval.is_completed;  // üî• Usar flag del backend
                console.log(`üìä DEBUG Pendientes - Evaluaci√≥n ${eval.id} (${eval.title}): ${isPending ? 'PENDIENTE ‚è≥' : 'COMPLETADA ‚úÖ'}, is_completed: ${eval.is_completed}`);
                return isPending;
            });
            
            console.log('‚úÖ PENDIENTES: Encontradas', pendientes.length, 'evaluaciones sin completar', pendientes);
            
            if (pendientes.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #9ca3af;">
                        <i class="fas fa-check-circle" style="font-size: 3rem; margin-bottom: 1rem; color: #10b981;"></i>
                        <p style="font-size: 1.125rem; font-weight: 500; color: #6b7280; margin: 0;">No tienes evaluaciones pendientes</p>
                        <p style="font-size: 0.875rem; color: #9ca3af; margin-top: 0.5rem;">Tu coach no te ha asignado nuevas evaluaciones</p>
                    </div>
                `;
                return;
            }
            
            // Get emoji for category
            const getCategoryEmoji = (title) => {
                if (!title) return 'üìã';
                if (title.includes('Personalidad') || title.includes('DISC')) return 'üéØ';
                if (title.includes('Liderazgo')) return 'üëë';
                if (title.includes('Emocional')) return '‚ù§Ô∏è';
                if (title.includes('Equipo')) return 'üí™';
                if (title.includes('Empresarial') || title.includes('crecer')) return '‚≠ê';
                return 'üìã';
            };
            
            // Get gradient for category
            const getGradient = (title) => {
                if (title.includes('Personalidad') || title.includes('DISC')) return 'linear-gradient(135deg, #a855f7 0%, #c084fc 100%)';
                if (title.includes('Liderazgo')) return 'linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%)';
                if (title.includes('Emocional')) return 'linear-gradient(135deg, #ec4899 0%, #f472b6 100%)';
                if (title.includes('Equipo')) return 'linear-gradient(135deg, #22c55e 0%, #4ade80 100%)';
                if (title.includes('Empresarial') || title.includes('crecer')) return 'linear-gradient(135deg, #f97316 0%, #fb923c 100%)';
                return 'linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%)';
            };
            
            let html = '';
            pendientes.forEach(assessment => {
                const emoji = getCategoryEmoji(assessment.title);
                const gradient = getGradient(assessment.title);
                const attempts = assessment.previous_attempts || 0;
                const statusText = attempts === 0 ? 'Sin iniciar' : `En progreso (${attempts} intento${attempts > 1 ? 's' : ''})`;
                const statusColor = attempts === 0 ? '#f59e0b' : '#3b82f6';
                
                html += `
                    <div class="figma-disponible-card" style="background: white; border: 2px solid #f3f4f6; border-radius: 12px; padding: 1.5rem; transition: all 0.2s; cursor: pointer; position: relative; overflow: hidden;"
                        onmouseover="this.style.borderColor='#f59e0b'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 25px -5px rgba(245, 158, 11, 0.2)'"
                        onmouseout="this.style.borderColor='#f3f4f6'; this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                        onclick="startEvaluation(${assessment.id})">
                        
                        <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: ${gradient}; opacity: 0.1; border-radius: 0 0 0 100%;"></div>
                        
                        <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1rem; position: relative;">
                            <div style="width: 48px; height: 48px; background: ${gradient}; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; flex-shrink: 0;">
                                ${emoji}
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <h4 style="margin: 0 0 0.5rem 0; font-size: 1rem; font-weight: 600; color: #111827;">${assessment.title}</h4>
                                <p style="margin: 0; font-size: 0.875rem; color: #6b7280; line-height: 1.4;">${assessment.description || 'Evaluaci√≥n disponible'}</p>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; padding-top: 1rem; border-top: 1px solid #f3f4f6;">
                            <span style="font-size: 0.875rem; color: #9ca3af;">
                                <i class="fas fa-question-circle" style="margin-right: 0.25rem;"></i>
                                ${assessment.total_questions || 0} preguntas
                            </span>
                            <span style="display: inline-block; padding: 0.25rem 0.75rem; background: ${statusColor}22; color: ${statusColor}; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">
                                ${statusText}
                            </span>
                        </div>
                        
                        <div style="margin-top: 0.75rem; text-align: center;">
                            <button onclick="event.stopPropagation(); startEvaluation(${assessment.id})" 
                                style="width: 100%; padding: 0.625rem 1rem; background: ${gradient}; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.opacity='0.9'; this.style.transform='scale(1.02)'"
                                onmouseout="this.style.opacity='1'; this.style.transform='scale(1)'">
                                ${attempts === 0 ? 'üöÄ Comenzar Ahora' : '‚ñ∂Ô∏è Continuar'}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ============================================
        // üî• FUNCI√ìN: RENDER COMPLETADAS RADAR CHART (DESHABILITADA)
        // Ya no se usa porque ahora mostramos historial agrupado
        // ============================================
        
        /*
        function renderCompletadasRadarChart() {
            const canvas = document.getElementById('completadasRadarChart');
            const evaluationsData = window.evaluationsData;
            
            if (!canvas || !evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                console.log('‚ö†Ô∏è No se puede renderizar radar de completadas');
                return;
            }
            
            console.log('üìä Rendering completadas radar chart');
            
            const ctx = canvas.getContext('2d');
            
            // Aggregate scores by category
            const categoryScores = {};
            const categoryCounts = {};
            
            evaluationsData.completed.forEach(result => {
                const title = result.assessment_title || '';
                let category = 'Otros';
                
                if (title.includes('Personalidad') || title.includes('DISC')) category = 'Personalidad';
                else if (title.includes('Liderazgo')) category = 'Liderazgo';
                else if (title.includes('Emocional')) category = 'Int. Emocional';
                else if (title.includes('Equipo')) category = 'Trabajo en Equipo';
                else if (title.includes('Empresarial') || title.includes('crecer')) category = 'Desarrollo';
                
                const score = result.score || 0;
                const totalScore = result.total_score || 100;
                const percentage = (score / totalScore) * 100;
                
                if (!categoryScores[category]) {
                    categoryScores[category] = 0;
                    categoryCounts[category] = 0;
                }
                
                categoryScores[category] += percentage;
                categoryCounts[category]++;
            });
            
            // Calculate averages
            const categories = Object.keys(categoryScores);
            const averages = categories.map(cat => Math.round(categoryScores[cat] / categoryCounts[cat]));
            
            // Find top and improvement areas
            const maxScore = Math.max(...averages);
            const minScore = Math.min(...averages);
            const topCategory = categories[averages.indexOf(maxScore)];
            const improveCategory = categories[averages.indexOf(minScore)];
            
            // Update stats
            const totalEl = document.getElementById('completadas-radar-total');
            const topEl = document.getElementById('completadas-radar-top');
            const improveEl = document.getElementById('completadas-radar-improve');
            
            if (totalEl) totalEl.textContent = evaluationsData.completed.length;
            if (topEl) topEl.textContent = `${topCategory} (${maxScore}%)`;
            if (improveEl) improveEl.textContent = `${improveCategory} (${minScore}%)`;
            
            // Destroy previous chart if exists
            if (window.completadasRadarChartInstance) {
                window.completadasRadarChartInstance.destroy();
            }
            
            // Create new chart
            window.completadasRadarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: categories,
                    datasets: [{
                        label: 'Promedio de Desempe√±o',
                        data: averages,
                        backgroundColor: 'rgba(16, 185, 129, 0.2)',
                        borderColor: '#10b981',
                        borderWidth: 2,
                        pointBackgroundColor: '#10b981',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: '#10b981',
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                font: { size: 10 }
                            },
                            pointLabels: {
                                font: { size: 11, weight: '500' }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.parsed.r + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        */
        
        // ============================================
        // üî• SECCI√ìN: EVALUACIONES DISPONIBLES
        // ============================================
        
        function toggleDisponiblesSection(event) {
            if (event) event.stopPropagation();
            console.log('üîÑ Toggle DISPONIBLES');
            
            const section = document.getElementById('disponibles-section');
            const chevron = document.getElementById('disponibles-chevron');
            
            if (!section) {
                console.error('‚ùå Disponibles section not found');
                return;
            }
            
            // Cerrar otras secciones
            const completadasSection = document.getElementById('completadas-section');
            const pendientesSection = document.getElementById('pendientes-section');
            const completadasChevron = document.getElementById('completadas-chevron');
            const pendientesChevron = document.getElementById('pendientes-chevron');
            
            if (completadasSection) completadasSection.style.display = 'none';
            if (pendientesSection) pendientesSection.style.display = 'none';
            if (completadasChevron) completadasChevron.style.transform = 'rotate(0deg)';
            if (pendientesChevron) pendientesChevron.style.transform = 'rotate(0deg)';
            
            // Toggle la secci√≥n actual
            const isVisible = section.style.display === 'block';
            
            if (isVisible) {
                // Cerrar
                section.style.display = 'none';
                if (chevron) chevron.style.transform = 'rotate(0deg)';
            } else {
                // Abrir
                section.style.display = 'block';
                if (chevron) chevron.style.transform = 'rotate(180deg)';
                renderDisponiblesSubsection();
            }
        }
        
        function renderDisponiblesSubsection() {
            console.log('üìã RENDER: Disponibles Subsection');
            const container = document.getElementById('figma-disponibles-lista');
            const evaluationsData = window.evaluationsData;
            
            if (!container) {
                console.error('‚ùå Container figma-disponibles-lista not found');
                return;
            }
            
            // Validar datos
            if (!evaluationsData || !evaluationsData.available || Object.keys(evaluationsData.available).length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #9ca3af;">
                        <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p style="font-size: 1.125rem; font-weight: 500; color: #6b7280; margin: 0;">No hay evaluaciones disponibles</p>
                    </div>
                `;
                return;
            }
            
            const disponibles = Object.values(evaluationsData.available);
            console.log('‚úÖ DISPONIBLES: Mostrando', disponibles.length, 'evaluaciones');
            
            // Get emoji for category
            const getCategoryEmoji = (title) => {
                if (!title) return 'üìã';
                if (title.includes('Personalidad') || title.includes('DISC')) return 'üéØ';
                if (title.includes('Liderazgo')) return 'üëë';
                if (title.includes('Emocional')) return '‚ù§Ô∏è';
                if (title.includes('Equipo')) return 'üí™';
                if (title.includes('Empresarial') || title.includes('crecer')) return '‚≠ê';
                return 'üìã';
            };
            
            // Get gradient for category
            const getGradient = (title) => {
                if (title.includes('Personalidad') || title.includes('DISC')) return 'linear-gradient(135deg, #a855f7 0%, #c084fc 100%)';
                if (title.includes('Liderazgo')) return 'linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%)';
                if (title.includes('Emocional')) return 'linear-gradient(135deg, #ec4899 0%, #f472b6 100%)';
                if (title.includes('Equipo')) return 'linear-gradient(135deg, #22c55e 0%, #4ade80 100%)';
                if (title.includes('Empresarial') || title.includes('crecer')) return 'linear-gradient(135deg, #f97316 0%, #fb923c 100%)';
                return 'linear-gradient(135deg, #a855f7 0%, #c084fc 100%)';
            };
            
            // üî• NUEVO: Todas las evaluaciones asignadas se muestran aqu√≠ (permanente)
            let html = '';
            disponibles.forEach(assessment => {
                const emoji = getCategoryEmoji(assessment.title);
                const gradient = getGradient(assessment.title);
                const attempts = assessment.previous_attempts || 0;
                const isCompleted = assessment.is_completed || false;  // üî• USAR FLAG DEL BACKEND
                
                let statusText, statusColor, statusBg, statusIcon;
                if (isCompleted) {
                    statusText = `Completada (${attempts})`;
                    statusColor = '#10b981';
                    statusBg = '#d1fae5';
                    statusIcon = '‚úÖ';
                } else {
                    statusText = 'Pendiente';
                    statusColor = '#f59e0b';
                    statusBg = '#fef3c7';
                    statusIcon = '‚è≥';
                }
                
                html += `
                    <div class="figma-disponible-card" style="background: white; border: 2px solid #f3f4f6; border-radius: 12px; padding: 1.5rem; transition: all 0.2s; cursor: pointer; position: relative; overflow: hidden;"
                        onmouseover="this.style.borderColor='#a855f7'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 10px 25px -5px rgba(168, 85, 247, 0.2)'"
                        onmouseout="this.style.borderColor='#f3f4f6'; this.style.transform='translateY(0)'; this.style.boxShadow='none'"
                        onclick="startEvaluation(${assessment.id})">
                        
                        <div style="position: absolute; top: 0; right: 0; width: 100px; height: 100px; background: ${gradient}; opacity: 0.1; border-radius: 0 0 0 100%;"></div>
                        
                        <div style="display: flex; align-items: flex-start; gap: 1rem; margin-bottom: 1rem; position: relative;">
                            <div style="width: 48px; height: 48px; background: ${gradient}; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; flex-shrink: 0;">
                                ${emoji}
                            </div>
                            <div style="flex: 1; min-width: 0;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <h4 style="margin: 0; font-size: 1rem; font-weight: 600; color: #111827;">${assessment.title}</h4>
                                    <span style="font-size: 1.25rem;">${statusIcon}</span>
                                </div>
                                <p style="margin: 0; font-size: 0.875rem; color: #6b7280; line-height: 1.4;">${assessment.description || 'Evaluaci√≥n disponible'}</p>
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; justify-content: space-between; padding-top: 1rem; border-top: 1px solid #f3f4f6;">
                            <span style="font-size: 0.875rem; color: #9ca3af;">
                                <i class="fas fa-question-circle" style="margin-right: 0.25rem;"></i>
                                ${assessment.total_questions || 0} preguntas
                            </span>
                            <span style="display: inline-block; padding: 0.25rem 0.75rem; background: ${statusBg}; color: ${statusColor}; border-radius: 6px; font-size: 0.75rem; font-weight: 600;">
                                ${statusText}
                            </span>
                        </div>
                        
                        <div style="margin-top: 0.75rem; text-align: center;">
                            <button onclick="event.stopPropagation(); startEvaluation(${assessment.id})" 
                                style="width: 100%; padding: 0.625rem 1rem; background: ${gradient}; color: white; border: none; border-radius: 8px; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: all 0.2s;"
                                onmouseover="this.style.opacity='0.9'; this.style.transform='scale(1.02)'"
                                onmouseout="this.style.opacity='1'; this.style.transform='scale(1)'">
                                ${isCompleted ? 'üîÑ Repetir Evaluaci√≥n' : 'üöÄ Comenzar Ahora'}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ============================================
        // üî• FUNCIONES ANTIGUAS (ELIMINAR SI NO SE USAN)
        // ============================================
        
        // üî• Render Disponibles List (todas las evaluaciones)
        function renderDisponiblesList() {
            console.log('üìã Rendering disponibles list');
            const container = document.getElementById('figma-disponibles-lista');
            const evaluationsData = window.evaluationsData;
            
            if (!container) {
                console.error('‚ùå Disponibles container not found');
                return;
            }
            
            if (!evaluationsData || !evaluationsData.available || Object.keys(evaluationsData.available).length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 3rem; color: #9ca3af;">
                        <i class="fas fa-clipboard-check" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                        <p style="font-size: 1.125rem; font-weight: 500; color: #6b7280; margin: 0;">No hay evaluaciones disponibles</p>
                    </div>
                `;
                return;
            }
            
            console.log('üìä Found', Object.keys(evaluationsData.available).length, 'available evaluations');
            
            // Get emoji and gradient helpers
            const getCategoryEmoji = (title) => {
                if (!title) return 'üìã';
                if (title.includes('Personalidad') || title.includes('DISC')) return 'üéØ';
                if (title.includes('Liderazgo')) return 'üëë';
                if (title.includes('Emocional')) return '‚ù§Ô∏è';
                if (title.includes('Equipo')) return 'üí™';
                if (title.includes('Empresarial') || title.includes('crecer')) return '‚≠ê';
                return 'üìã';
            };
            
            const getGradient = (title) => {
                if (title.includes('Personalidad') || title.includes('DISC')) return 'linear-gradient(135deg, #a855f7 0%, #c084fc 100%)';
                if (title.includes('Liderazgo')) return 'linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%)';
                if (title.includes('Emocional')) return 'linear-gradient(135deg, #ec4899 0%, #f472b6 100%)';
                if (title.includes('Equipo')) return 'linear-gradient(135deg, #22c55e 0%, #4ade80 100%)';
                if (title.includes('Empresarial') || title.includes('crecer')) return 'linear-gradient(135deg, #f97316 0%, #fb923c 100%)';
                return 'linear-gradient(135deg, #6366f1 0%, #818cf8 100%)';
            };
            
            let html = '';
            Object.values(evaluationsData.available).forEach(evaluation => {
                const emoji = getCategoryEmoji(evaluation.title);
                const gradient = getGradient(evaluation.title);
                const attempts = evaluation.previous_attempts || 0;
                const total = evaluation.total_questions || 24;
                const percentage = Math.round((attempts / total) * 100);
                
                // Badge color based on completion
                const getBadgeColor = (percent) => {
                    if (percent >= 80) return { bg: '#dcfce7', text: '#166534', label: 'Casi completa' };
                    if (percent >= 50) return { bg: '#dbeafe', text: '#1e40af', label: 'En progreso' };
                    if (percent > 0) return { bg: '#fef3c7', text: '#92400e', label: 'Iniciada' };
                    return { bg: '#fee2e2', text: '#991b1b', label: 'Sin iniciar' };
                };
                
                const badge = getBadgeColor(percentage);
                
                html += `
                    <div class="figma-eval-card" style="height: fit-content;">
                        <div style="display: flex; align-items: start; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-size: 2.5rem; flex-shrink: 0;">${emoji}</div>
                            <div style="flex: 1;">
                                <h4 style="font-size: 1.125rem; font-weight: 600; color: #111827; margin: 0 0 0.5rem 0;">${evaluation.title}</h4>
                                <p style="font-size: 0.875rem; color: #6b7280; margin: 0; line-height: 1.5;">${evaluation.description || 'Evaluaci√≥n disponible'}</p>
                            </div>
                            <div style="background: ${badge.bg}; color: ${badge.text}; padding: 0.5rem 1rem; border-radius: 0.5rem; font-size: 0.875rem; font-weight: 600; flex-shrink: 0; text-align: center;">
                                ${percentage}%
                            </div>
                        </div>
                        
                        <!-- Progress Bar -->
                        <div style="width: 100%; height: 0.5rem; background: #e5e7eb; border-radius: 0.25rem; overflow: hidden; margin-bottom: 1rem;">
                            <div style="width: ${percentage}%; height: 100%; background: ${gradient}; transition: width 0.3s ease;"></div>
                        </div>
                        
                        <!-- Footer -->
                        <div style="display: flex; align-items: center; justify-content: space-between; font-size: 0.875rem; margin-bottom: 1rem;">
                            <span style="color: #6b7280;">
                                <i class="fas fa-question-circle"></i> ${total} preguntas
                            </span>
                            <span style="color: ${badge.text}; background: ${badge.bg}; padding: 0.25rem 0.75rem; border-radius: 0.25rem; font-weight: 500;">
                                ${badge.label}
                            </span>
                        </div>
                        
                        <button onclick="startEvaluation(${evaluation.id})" 
                                class="figma-btn-gradient"
                                style="background: ${gradient} !important; width: 100%; justify-content: center; display: flex; align-items: center; gap: 0.5rem;">
                            ${percentage > 0 ? '<i class="fas fa-play"></i> Continuar' : '<i class="fas fa-play"></i> Iniciar'} 
                        </button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Render Figma Radar Chart
        function renderFigmaRadarChart() {
            const canvas = document.getElementById('figmaRadarChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const evaluationsData = window.evaluationsData;
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = '#9ca3af';
                ctx.font = '14px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText('No hay evaluaciones completadas', canvas.width / 2, canvas.height / 2);
                return;
            }
            
            // Calculate average scores by dimension
            const dimensions = {
                'Liderazgo': [],
                'Comunicaci√≥n': [],
                'Trabajo en Equipo': [],
                'Resoluci√≥n de Problemas': [],
                'Adaptabilidad': [],
                'Creatividad': []
            };
            
            // Map assessments to dimensions
            evaluationsData.completed.forEach(evaluation => {
                const title = evaluation.assessment_title || '';
                const score = evaluation.score || 0;
                
                if (title.includes('Liderazgo')) dimensions['Liderazgo'].push(score);
                else if (title.includes('Comunicaci√≥n')) dimensions['Comunicaci√≥n'].push(score);
                else if (title.includes('Equipo')) dimensions['Trabajo en Equipo'].push(score);
                else if (title.includes('Problema')) dimensions['Resoluci√≥n de Problemas'].push(score);
                else if (title.includes('Adaptab')) dimensions['Adaptabilidad'].push(score);
                else if (title.includes('Creativ')) dimensions['Creatividad'].push(score);
                else {
                    // Default: distribute score to all dimensions
                    Object.keys(dimensions).forEach(dim => dimensions[dim].push(score / 6));
                }
            });
            
            // Calculate averages
            const scores = Object.keys(dimensions).map(dim => {
                const values = dimensions[dim];
                return values.length > 0 ? values.reduce((a, b) => a + b, 0) / values.length : 50;
            });
            
            // Find top and weak skills
            const labels = Object.keys(dimensions);
            const maxIndex = scores.indexOf(Math.max(...scores));
            const minIndex = scores.indexOf(Math.min(...scores));
            
            document.getElementById('figma-radar-total').textContent = evaluationsData.completed.length;
            document.getElementById('figma-radar-top').textContent = labels[maxIndex];
            document.getElementById('figma-radar-improve').textContent = labels[minIndex];
            
            // Draw radar chart
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) - 60;
            const angleStep = (Math.PI * 2) / labels.length;
            
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw grid circles
            ctx.strokeStyle = '#e5e7eb';
            ctx.lineWidth = 1;
            for (let i = 1; i <= 5; i++) {
                ctx.beginPath();
                ctx.arc(centerX, centerY, (radius / 5) * i, 0, Math.PI * 2);
                ctx.stroke();
            }
            
            // Draw axes
            ctx.strokeStyle = '#d1d5db';
            labels.forEach((label, i) => {
                const angle = angleStep * i - Math.PI / 2;
                const x = centerX + Math.cos(angle) * radius;
                const y = centerY + Math.sin(angle) * radius;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(x, y);
                ctx.stroke();
                
                // Draw labels
                const labelX = centerX + Math.cos(angle) * (radius + 40);
                const labelY = centerY + Math.sin(angle) * (radius + 40);
                ctx.fillStyle = '#374151';
                ctx.font = '11px sans-serif';
                ctx.textAlign = 'center';
                ctx.fillText(label, labelX, labelY);
            });
            
            // Draw data polygon
            ctx.fillStyle = 'rgba(168, 85, 247, 0.3)';
            ctx.strokeStyle = '#a855f7';
            ctx.lineWidth = 2;
            ctx.beginPath();
            
            scores.forEach((score, i) => {
                const angle = angleStep * i - Math.PI / 2;
                const distance = (score / 100) * radius;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                if (i === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            
            ctx.closePath();
            ctx.fill();
            ctx.stroke();
            
            // Draw data points
            ctx.fillStyle = '#a855f7';
            scores.forEach((score, i) => {
                const angle = angleStep * i - Math.PI / 2;
                const distance = (score / 100) * radius;
                const x = centerX + Math.cos(angle) * distance;
                const y = centerY + Math.sin(angle) * distance;
                
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, Math.PI * 2);
                ctx.fill();
            });
        }
        
        // Render Figma Recent Completions
        function renderFigmaRecentCompletions() {
            const container = document.getElementById('figma-recent-completions');
            if (!container) return;
            
            const evaluationsData = window.evaluationsData;
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                container.innerHTML = '<p style="color: #9ca3af; font-size: 0.875rem; text-align: center;">No hay evaluaciones completadas</p>';
                return;
            }
            
            // Get last 5 completions
            const recentEvals = [...evaluationsData.completed]
                .sort((a, b) => new Date(b.completed_at) - new Date(a.completed_at))
                .slice(0, 5);
            
            let html = '';
            recentEvals.forEach(evaluation => {
                const score = Math.round(evaluation.score || 0);
                const title = evaluation.assessment_title || 'Evaluaci√≥n';
                const date = evaluation.completed_at;
                
                // Get emoji for category
                const getCategoryEmoji = (title) => {
                    if (title.includes('Personalidad') || title.includes('DISC')) return 'üéØ';
                    if (title.includes('Liderazgo')) return 'üëë';
                    if (title.includes('Emocional')) return '‚ù§Ô∏è';
                    if (title.includes('Equipo')) return 'üí™';
                    if (title.includes('Empresarial') || title.includes('crecer')) return '‚≠ê';
                    return 'üìã';
                };
                
                // Get badge color
                const getBadgeColor = (score) => {
                    if (score >= 80) return { bg: '#dcfce7', text: '#166534' };
                    if (score >= 50) return { bg: '#fef3c7', text: '#92400e' };
                    return { bg: '#fee2e2', text: '#991b1b' };
                };
                
                const badgeColors = getBadgeColor(score);
                const emoji = getCategoryEmoji(title);
                
                // Format relative time
                const getRelativeTime = (dateStr) => {
                    const now = new Date();
                    const then = new Date(dateStr);
                    const diffMs = now - then;
                    const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
                    
                    if (diffDays === 0) return 'Hoy';
                    if (diffDays === 1) return 'Ayer';
                    if (diffDays < 7) return `Hace ${diffDays} d√≠as`;
                    return then.toLocaleDateString('es-ES');
                };
                
                html += `
                    <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; border-radius: 0.5rem; background: #f9fafb; border: 1px solid #e5e7eb;">
                        <div style="font-size: 1.5rem; flex-shrink: 0;">${emoji}</div>
                        <div style="flex: 1; min-width: 0;">
                            <p style="font-size: 0.875rem; font-weight: 500; color: #111827; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${title}</p>
                            <p style="font-size: 0.75rem; color: #6b7280; margin: 0;">${getRelativeTime(date)}</p>
                        </div>
                        <div style="background: ${badgeColors.bg}; color: ${badgeColors.text}; padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.75rem; font-weight: 600; flex-shrink: 0;">
                            ${score}%
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Render completed evaluations
        function renderCompletedEvaluations() {
            const container = document.getElementById('completedEvaluations');
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                container.innerHTML = '<div class="unified-empty-state"><i class="fas fa-clipboard-list"></i><p>A√∫n no has completado ninguna evaluaci√≥n</p></div>';
                return;
            }
            
            let html = '<div class="results-list">';
            evaluationsData.completed.forEach(evaluation => {
                const score = evaluation.score || 0;
                
                // Usar el t√≠tulo real del assessment o un t√≠tulo por defecto
                const assessmentTitle = evaluation.assessment_title || 'Evaluaci√≥n completada';
                
                // Funci√≥n para obtener el nivel basado en el tipo de evaluaci√≥n
                function getEvaluationLevel(score, title) {
                    if (title && title.includes('DISC')) {
                        // Para evaluaciones DISC, mostrar informaci√≥n de personalidad
                        if (score >= 80) return 'Perfil Dominante';
                        if (score >= 60) return 'Perfil Influyente';
                        if (score >= 40) return 'Perfil Estable';
                        return 'Perfil Concienzudo';
                    } else if (title && title.includes('Preparaci√≥n para crecer 2026')) {
                        // Para evaluaciones de Preparaci√≥n para crecer 2026
                        if (score >= 85) return 'Preparado';      // Verde
                        if (score >= 60) return 'En progreso';    // Amarillo
                        return 'Alta dependencia';                // Rojo
                    } else {
                        // Para evaluaciones de Asertividad, usar la funci√≥n existente
                        return getAssertativenessLevel(score);
                    }
                }
                
                html += `
                    <div class="unified-card">
                        <div class="unified-card-header">
                            <h5 class="unified-card-title">${assessmentTitle}</h5>
                            <div class="score-display">
                                <span class="score-value">${Math.round(score)}%</span>
                            </div>
                        </div>
                        <div class="unified-card-body">
                            <div class="evaluation-level">${getEvaluationLevel(score, assessmentTitle)}</div>
                            <div class="evaluation-description">${evaluation.result_text || 'Evaluaci√≥n completada con √©xito'}</div>
                            <div class="evaluation-meta">
                                <span class="meta-date">
                                    <i class="fas fa-calendar-alt"></i>
                                    ${formatDate(evaluation.completed_at)}
                                </span>
                            </div>
                        </div>
                        <div class="unified-card-footer">
                            <button class="unified-btn unified-btn-primary" onclick="viewEvaluationDetails(${evaluation.id})">
                                <i class="fas fa-eye"></i>
                                Ver Detalles
                            </button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        // LEGACY: Funci√≥n original de renderizado - Renombrada para compatibilidad
        function renderCompletedEvaluationsLegacy() {
            
            const container = document.getElementById('completedEvaluationsSection');
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem 1.25rem;">
                        <div style="font-size: 4rem; color: #9ca3af; margin-bottom: 1rem;">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <h3 style="color: #000000; font-size: 1.125rem; margin-bottom: 0.5rem; font-weight: 700;">
                            Sin evaluaciones completadas
                        </h3>
                        <p style="color: #000000; font-size: 0.875rem;">
                            A√∫n no has completado ninguna evaluaci√≥n
                        </p>
                    </div>
                `;
                return;
            }
            
            // Categorize completed evaluations
            const categorizedEvaluations = {};
            evaluationsData.completed.forEach(evaluation => {
                const title = evaluation.assessment_title || 'Evaluaci√≥n completada';
                let category = 'Otros';
                
                if (title.toLowerCase().includes('disc') || title.toLowerCase().includes('personalidad')) {
                    category = 'Personalidad';
                } else if (title.toLowerCase().includes('liderazgo') || title.toLowerCase().includes('l√≠der')) {
                    category = 'Liderazgo';
                } else if (title.toLowerCase().includes('emocional') || title.toLowerCase().includes('asertividad')) {
                    category = 'Inteligencia Emocional';
                } else if (title.toLowerCase().includes('equipo') || title.toLowerCase().includes('colaboraci√≥n')) {
                    category = 'Trabajo en Equipo';
                } else if (title.toLowerCase().includes('empresarial') || title.toLowerCase().includes('crecer') || title.toLowerCase().includes('2026')) {
                    category = 'Crecimiento Empresarial';
                }
                
                if (!categorizedEvaluations[category]) {
                    categorizedEvaluations[category] = [];
                }
                categorizedEvaluations[category].push(evaluation);
            });
            
            // Clear container
            container.innerHTML = '';
            
            // Render each category
            Object.entries(categorizedEvaluations).forEach(([categoryName, evaluations]) => {
                const category = window.evaluationCategories ? window.evaluationCategories[categoryName] : null;
                
                if (!category) {
                    console.error(`‚ùå Categor√≠a ${categoryName} no encontrada en renderCompletedEvaluationsLegacy`);
                    return;
                }
                
                const categorySection = document.createElement('div');
                categorySection.className = 'assessment-category';
                categorySection.style.marginBottom = '1.5rem';
                const categoryId = `completed-category-${categoryName.replace(/\s+/g, '-')}`;
                
                categorySection.innerHTML = `
                    <div class="section-header-eval" 
                         id="header-${categoryId}"
                         data-category-id="${categoryId}"
                         role="button"
                         tabindex="0"
                         aria-expanded="false"
                         aria-controls="${categoryId}"
                         style="padding: 1rem 1.25rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border-left: 4px solid ${category.color};" 
                         data-theme-bg="light">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 0.75rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; flex: 1; min-width: 0;">
                                <div style="width: 3rem; height: 3rem; background: ${category.color} !important; border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 4px 12px ${category.color}60, 0 0 0 2px rgba(255, 255, 255, 0.2) !important; filter: saturate(1.2) brightness(1.1);">
                                    <i class="fas ${category.icon}" style="color: #ffffff !important; font-size: 1.25rem;"></i>
                                </div>
                                <div style="flex: 1; min-width: 0;">
                                    <h4 class="category-header-title" style="font-size: 1.0625rem; font-weight: 700; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                        ${categoryName}
                                    </h4>
                                    <p class="category-header-subtitle" style="font-size: 0.8125rem; margin: 0; font-weight: 500;">
                                        ${evaluations.length} ${evaluations.length === 1 ? 'evaluaci√≥n completada' : 'evaluaciones completadas'}
                                    </p>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0;">
                                <span style="background: ${category.color} !important; color: #ffffff !important; padding: 0.375rem 0.875rem; border-radius: 20px; font-size: 0.8125rem; font-weight: 700; box-shadow: 0 4px 16px ${category.color}60, 0 0 0 2px rgba(255, 255, 255, 0.3); filter: saturate(1.2) brightness(1.1);">${evaluations.length}</span>
                                <i class="fas fa-chevron-down" id="icon-${categoryId}" style="color: ${category.color}; font-size: 1.125rem; transition: transform 0.3s ease; transform: rotate(-90deg); filter: saturate(1.1) brightness(0.85);"></i>
                            </div>
                        </div>
                    </div>
                    <div class="assessments-grid category-grid" id="${categoryId}" data-expanded="false" style="grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1rem;">
                    </div>
                `;
                
                container.appendChild(categorySection);
                
                const grid = document.getElementById(categoryId);
                
                evaluations.forEach(evaluation => {
                    const score = evaluation.score || 0;
                    const assessmentTitle = evaluation.assessment_title || 'Evaluaci√≥n completada';
                    
                    const card = document.createElement('div');
                    card.className = 'assessment-card';
                    card.setAttribute('data-evaluation-id', evaluation.id); // Agregar ID para navegaci√≥n
                    card.style.cssText = `
                        background: white;
                        border-radius: 12px;
                        overflow: hidden;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                        border: 1px solid #e5e7eb;
                        height: 100%;
                        display: flex;
                        flex-direction: column;
                    `;
                    
                    card.innerHTML = `
                        <div style="position: relative; width: 100%; padding-top: 45%; background: linear-gradient(135deg, ${category.color} 0%, ${category.color}dd 100%) !important; overflow: hidden;">
                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.2) 0%, transparent 70%);">
                                <i class="fas ${category.icon}" style="font-size: 3.5rem; color: #ffffff !important; filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3)) drop-shadow(0 0 20px ${category.color}80) saturate(1.3) brightness(1.2);"></i>
                            </div>
                            <div style="position: absolute; top: 0.875rem; right: 0.875rem; background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(255,255,255,0.95) 100%) !important; backdrop-filter: blur(12px); padding: 0.625rem 1rem; border-radius: 24px; box-shadow: 0 8px 24px rgba(0,0,0,0.15), 0 4px 12px ${category.color}70, 0 0 0 3px ${category.color}50; border: 2.5px solid ${category.color} !important; transition: all 0.3s ease;">
                                <span style="color: ${category.color} !important; font-size: 0.9375rem; font-weight: 900; display: flex; align-items: center; gap: 0.5rem; line-height: 1; letter-spacing: -0.02em;">
                                    <i class="fas fa-trophy" style="color: ${category.color} !important; font-size: 1rem; filter: saturate(1.4) brightness(1.2) drop-shadow(0 2px 4px rgba(0,0,0,0.1));"></i>
                                    ${Math.round(score)}%
                                </span>
                            </div>
                        </div>
                        <div class="card-bg-theme" style="padding: 1.125rem; flex: 1; display: flex; flex-direction: column;">
                            <h5 class="inline-text-dark" style="font-size: 1rem; font-weight: 700; margin: 0 0 0.625rem 0; line-height: 1.35; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                ${assessmentTitle}
                            </h5>
                            <p class="inline-text-light" style="font-size: 0.8125rem; margin: 0 0 1rem 0; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; flex: 1;">
                                ${evaluation.result_text || 'Evaluaci√≥n completada con √©xito'}
                            </p>
                            <div style="display: flex; align-items: center; justify-content: space-between; gap: 0.625rem; padding-top: 0.875rem; border-top: 2px solid #f3f4f6;">
                                <div class="inline-text-light" style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.8125rem; font-weight: 500; flex: 1; min-width: 0;">
                                    <div style="width: 1.75rem; height: 1.75rem; background: linear-gradient(135deg, ${category.color}20 0%, ${category.color}10 100%) !important; border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 2px 6px ${category.color}20;">
                                        <i class="fas fa-calendar" style="color: ${category.color} !important; font-size: 0.75rem; filter: saturate(1.2) brightness(1.1);"></i>
                                    </div>
                                    <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${formatDate(evaluation.completed_at)}</span>
                                </div>
                                <button onclick="viewEvaluationDetails(${evaluation.id})" style="background: linear-gradient(135deg, ${category.color} 0%, ${category.color}dd 100%) !important; border: none; padding: 0.625rem 1.125rem; border-radius: 8px; color: #ffffff !important; font-weight: 700; font-size: 0.8125rem; transition: all 0.2s ease; white-space: nowrap; box-shadow: 0 2px 8px ${category.color}40, 0 0 0 1px rgba(255,255,255,0.2); flex-shrink: 0; filter: saturate(1.2) brightness(1.1);">
                                    <i class="fas fa-eye" style="font-size: 0.75rem; margin-right: 0.5rem; color: #ffffff !important;"></i>
                                    Ver Detalles
                                </button>
                            </div>
                        </div>
                    `;
                    
                    grid.appendChild(card);
                });
            });
        }

        // LEGACY: Variables de control de tasks (ahora en Alpine state)
        // Mantenidas por compatibilidad pero ya no se usan
        let isLoadingTasks = false;
        let tasksLastLoaded = null;
        const TASKS_CACHE_DURATION = 30000;
        
        // LEGACY: Funci√≥n de carga de tasks (ahora manejada por Alpine)
        // Esta funci√≥n ya no se usa directamente, el wrapper global llama al m√©todo Alpine
        
        // LEGACY: Funci√≥n original de renderizado de tasks
        function renderTasksLegacy() {
            const tasksData = window.tasksData || [];
            const container = document.getElementById('tasksContainer');
            
            if (!tasksData || tasksData.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5" style="color: #94a3b8;">
                        <i class="fas fa-clipboard-list" style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                        <p class="mb-0" style="font-size: 0.95rem; font-weight: 500;">No hay acciones asignadas</p>
                        <small style="font-size: 0.8rem; color: #cbd5e1;">Tu coach a√∫n no ha creado tareas para ti</small>
                    </div>
                `;
                return;
            }
            
            // Definir colores para prioridades
            const priorityColors = {
                high: { bg: '#fef2f2', color: '#dc2626', icon: 'fa-exclamation-circle' },
                medium: { bg: '#fffbeb', color: '#f59e0b', icon: 'fa-clock' },
                low: { bg: '#f0f9ff', color: '#0284c7', icon: 'fa-info-circle' }
            };
            
            // Definir colores para estados
            const statusColors = {
                pending: { bg: '#fffbeb', color: '#d97706', label: 'Pendiente' },
                in_progress: { bg: '#eff6ff', color: '#3b82f6', label: 'En progreso' },
                completed: { bg: '#f0fdf4', color: '#10b981', label: 'Completada' },
                blocked: { bg: '#fef2f2', color: '#ef4444', label: 'Bloqueada' }
            };
            
            // Definir iconos para categor√≠as
            const categoryIcons = {
                desarrollo_personal: 'fa-user-plus',
                proyecto: 'fa-project-diagram',
                aprendizaje: 'fa-graduation-cap',
                comunicacion: 'fa-comments',
                liderazgo: 'fa-crown',
                default: 'fa-tasks'
            };
            
            // Actualizar contador de tareas (opcional, ya no existe en la UI)
            const completedCount = tasksData.filter(t => t.status === 'completed').length;
            const totalCount = tasksData.length;
            
            // Los elementos del contador ya no existen en la nueva estructura premium
            // document.getElementById('completedTasks').textContent = completedCount;
            // document.getElementById('totalTasks').textContent = totalCount;
            // document.getElementById('tasksCounter').style.display = 'block';
            
            let html = '<div style="display: grid; gap: 1rem;">';
            
            tasksData.forEach(task => {
                const priority = priorityColors[task.priority] || priorityColors.low;
                const status = statusColors[task.status] || statusColors.pending;
                const categoryIcon = categoryIcons[task.category] || categoryIcons.default;
                const progress = Math.round(task.progress_percentage || 0);
                
                // Calcular d√≠as restantes
                let daysInfo = '';
                if (task.due_date) {
                    const today = new Date();
                    const dueDate = new Date(task.due_date);
                    const diffTime = dueDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays < 0) {
                        daysInfo = `<span style="color: #dc2626; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-exclamation-triangle"></i> Vencida</span>`;
                    } else if (diffDays === 0) {
                        daysInfo = `<span style="color: #f59e0b; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-clock"></i> Vence hoy</span>`;
                    } else if (diffDays <= 3) {
                        daysInfo = `<span style="color: #f59e0b; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-hourglass-half"></i> ${diffDays} d√≠as</span>`;
                    } else {
                        daysInfo = `<span class="inline-text-light" style="font-size: 0.75rem"><i class="fas fa-calendar"></i> ${diffDays} d√≠as</span>`;
                    }
                }
                
                html += `
                    <div class="task-card" 
                         style="border-left: 4px solid ${priority.color};"
                         onmouseover="this.style.borderLeftWidth='5px';" 
                         onmouseout="this.style.borderLeftWidth='4px';">
                        
                        <!-- Header: T√≠tulo y Badges -->
                        <div style="display: flex; align-items: start; justify-content: space-between; gap: 1rem; margin-bottom: 0.75rem;">
                            <div style="flex: 1; min-width: 0;">
                                <div style="display: flex; align-items: center; gap: 0.625rem; margin-bottom: 0.375rem;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <i class="fas ${categoryIcon}" style="font-size: 0.875rem; color: #fbbf24;"></i>
                                    </div>
                                    <h6 class="task-card-title" style="margin: 0;">
                                        ${task.title}
                                    </h6>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem; flex-shrink: 0;">
                                <span class="task-priority-badge task-priority-${task.priority}">
                                    <i class="fas ${priority.icon}" style="font-size: 0.65rem;"></i>
                                    ${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Descripci√≥n -->
                        ${task.description ? `
                        <p class="inline-text-medium" style="margin: 0 0 1rem 0; padding-left: 2.5rem; font-size: 0.875rem; line-height: 1.6; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical">
                            ${task.description}
                        </p>
                        ` : ''}
                        
                        <!-- Progreso Simple con Verde -->
                        <div class="task-progress-box" style="margin-bottom: 1rem;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span class="task-progress-label">
                                    Progreso
                                </span>
                                <span class="task-progress-value">
                                    ${progress}%
                                </span>
                            </div>
                            <!-- Barra de progreso verde simple -->
                            <div style="height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; margin-bottom: 0.75rem;">
                                <div style="width: ${progress}%; height: 100%; background: #10b981 !important; border-radius: 4px; transition: width 0.6s ease;"></div>
                            </div>
                            <!-- Metadata y Acci√≥n -->
                            <div style="display: flex; align-items: center; justify-content: space-between; gap: 0.75rem;">
                                <div class="inline-text-light" style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; font-size: 0.75rem">
                                    <span class="task-status-badge task-status-${task.status}">
                                        <i class="fas fa-circle" style="font-size: 0.4rem;"></i>
                                        ${status.label}
                                    </span>
                                    ${daysInfo}
                                    ${task.coach?.name ? `<span style="display: flex; align-items: center; gap: 0.375rem;"><i class="fas fa-user-tie" style="font-size: 0.7rem; color: #667eea;"></i> ${task.coach.name.split(' ')[0]}</span>` : ''}
                                </div>
                                <button type="button" class="btn btn-sm" 
                                        style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 0.5rem 1rem; font-size: 0.8rem; font-weight: 700; border-radius: 8px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); letter-spacing: 0.01em;"
                                        onmouseover="this.style.background='linear-gradient(135deg, #5568d3 0%, #6a3e9a 100%)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.4)';"
                                        onmouseout="this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(102, 126, 234, 0.3)';"
                                        onclick="event.stopPropagation(); openTaskProgressModal(${task.id});">
                                    <i class="fas fa-pen" style="font-size: 0.75rem; margin-right: 0.375rem;"></i>
                                    Actualizar
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // LEGACY: Load evaluation history - Renombrada para compatibilidad (ahora manejada por Alpine)
        // Esta funci√≥n ya no se usa directamente, el wrapper global llama al m√©todo Alpine
        // Se mantiene por compatibilidad con c√≥digo legacy que pueda referenciarla

        // FUNCI√ìN renderProgressChart ELIMINADA POR PETICI√ìN DEL USUARIO
        

        // FUNCI√ìN createBasicTestChart ELIMINADA POR PETICI√ìN DEL USUARIO

        // TEST CHART FUNCTION - Para probar visualizaci√≥n
        // FUNCI√ìN renderTestProgressChart ELIMINADA POR PETICI√ìN DEL USUARIO
        // FUNCI√ìN createSecondChart ELIMINADA - Canvas no existe en el DOM

        // ‚ö° FASE 2: Lazy Loading de Chart.js
        async function loadChartJs() {
            if (window.Chart && window._chartjs_adapter_date_fns_loaded) {
                console.log('‚úÖ Chart.js y date adapter ya est√°n cargados');
                return true;
            }
            
            console.log('üîÑ [LAZY-LOAD] Cargando Chart.js y date adapter...');
            
            try {
                // Cargar Chart.js primero
                if (!window.Chart) {
                    await new Promise((resolve, reject) => {
                        const chartScript = document.createElement('script');
                        chartScript.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                        chartScript.onload = () => {
                            console.log('‚úÖ Chart.js cargado');
                            resolve();
                        };
                        chartScript.onerror = () => reject(new Error('Failed to load Chart.js'));
                        document.head.appendChild(chartScript);
                    });
                }
                
                // Luego cargar el date adapter
                if (!window._chartjs_adapter_date_fns_loaded) {
                    await new Promise((resolve, reject) => {
                        const adapterScript = document.createElement('script');
                        adapterScript.src = 'https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns';
                        adapterScript.onload = () => {
                            window._chartjs_adapter_date_fns_loaded = true;
                            console.log('‚úÖ Chart.js date adapter cargado');
                            resolve();
                        };
                        adapterScript.onerror = () => reject(new Error('Failed to load date adapter'));
                        document.head.appendChild(adapterScript);
                    });
                }
                
                window.chartJsLoaded = true;
                console.log('‚úÖ Chart.js y date adapter listos');
                return true;
            } catch (error) {
                console.error('‚ùå Error cargando Chart.js:', error);
                throw error;
            }
        }

        // NUEVO: Crear gr√°fico de tendencia de progreso
        let progressTrendChart = null;
        
        async function createProgressTrendChart() {
            
            try {
                // Obtener el canvas
                const canvas = document.getElementById('progressTrendChart');
                if (!canvas) {
                    console.error('‚ùå Canvas progressTrendChart no encontrado');
                    return;
                }
                
                // ‚ö° FASE 2: Cargar Chart.js din√°micamente si no est√° disponible
                if (typeof Chart === 'undefined') {
                    console.log('üìä Chart.js no disponible, cargando...');
                    try {
                        await loadChartJs();
                    } catch (error) {
                        console.error('‚ùå Error cargando Chart.js:', error);
                        canvas.parentElement.innerHTML = `
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                No se pudo cargar el gr√°fico. Por favor, recarga la p√°gina.
                            </div>
                        `;
                        return;
                    }
                }
                
                // Obtener datos del historial de evaluaciones
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-history`);
                const data = await response.json();
                
                if (!response.ok || !data.success || !data.history || data.history.length === 0) {
                    canvas.parentElement.innerHTML = `
                        <div class="empty-state text-center py-5">
                            <i class="fas fa-chart-line text-muted mb-3" style="font-size: 3rem;"></i>
                            <h5 class="text-muted">Sin datos suficientes</h5>
                            <p class="text-muted small">Completa m√°s evaluaciones para ver tu tendencia de progreso</p>
                        </div>
                    `;
                    return;
                }
                
                // Preparar datos para el gr√°fico - ordenar cronol√≥gicamente
                const history = data.history.slice().sort((a, b) => 
                    new Date(a.completed_at) - new Date(b.completed_at)
                );
                
                
                // Crear puntos de datos con fechas y porcentajes
                const dataPoints = history.map(item => {
                    const date = new Date(item.completed_at);
                    // Calcular porcentaje: (score / total_questions) * 100
                    const percentage = item.total_questions > 0 
                        ? (item.score / item.total_questions) * 100 
                        : 0;
                    
                    return {
                        x: date,
                        y: percentage,
                        label: item.assessment?.title || 'Sin t√≠tulo',
                        score: item.score,
                        totalQuestions: item.total_questions
                    };
                });
                
                
                // Crear un solo dataset con todas las evaluaciones conectadas cronol√≥gicamente
                const datasets = [{
                    label: 'Progreso General',
                    data: dataPoints,
                    backgroundColor: 'rgba(102, 126, 234, 0.7)',
                    borderColor: '#667eea',
                    borderWidth: 2,
                    borderRadius: 8,
                    barThickness: 'flex',
                    maxBarThickness: 60
                }];
                
                
                const ctx = canvas.getContext('2d');
                
                // Destruir gr√°fico anterior si existe
                if (progressTrendChart) {
                    progressTrendChart.destroy();
                }
                
                // Crear nuevo gr√°fico
                progressTrendChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 15,
                                    font: {
                                        size: 12,
                                        family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: '#667eea',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    title: function(context) {
                                        const dataPoint = context[0].raw;
                                        return dataPoint.label || 'Evaluaci√≥n';
                                    },
                                    label: function(context) {
                                        const dataPoint = context.raw;
                                        return [
                                            `Porcentaje: ${context.parsed.y.toFixed(1)}%`,
                                            `Puntaje: ${dataPoint.score}/${dataPoint.totalQuestions}`
                                        ];
                                    },
                                    afterLabel: function(context) {
                                        const date = new Date(context.parsed.x);
                                        return `Fecha: ${date.toLocaleDateString('es-ES', { 
                                            day: 'numeric', 
                                            month: 'short', 
                                            year: 'numeric' 
                                        })}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'day',
                                    displayFormats: {
                                        day: 'dd/MM'
                                    },
                                    tooltipFormat: 'dd/MM/yyyy'
                                },
                                title: {
                                    display: true,
                                    text: 'Fecha de Evaluaci√≥n',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 0,
                                    autoSkip: true,
                                    maxTicksLimit: 10
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Porcentaje de Respuestas Correctas',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toFixed(0) + '%';
                                    }
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            }
                        }
                    }
                });
                
                
            } catch (error) {
                console.error('‚ùå PROGRESS-TREND ERROR:', error);
                const canvas = document.getElementById('progressTrendChart');
                if (canvas && canvas.parentElement) {
                    canvas.parentElement.innerHTML = `
                        <div class="empty-state text-center py-5">
                            <i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 3rem;"></i>
                            <h5 class="text-muted">Error al cargar el gr√°fico</h5>
                            <p class="text-muted small">${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // Load content assigned to coachee
        // Variables globales para debugging
        let renderContentCallCount = 0;
        let isLoadingContent = false;
        
        // Definir renderContent PRIMERO para que est√© disponible inmediatamente
        function renderContent() {
            renderContentCallCount++;
            const container = document.getElementById('contentContainer');
            
            // Usar window.contentData si est√° disponible (Alpine.js), sino usar contentData local
            const dataSource = window.contentData || contentData;
            
            debugLog(`üé• RENDER-CONTENT: Iniciando renderizado #${renderContentCallCount}`, {
                contentData: dataSource,
                itemCount: dataSource?.length || 0,
                containerExists: !!container,
                containerCurrentHTML: container?.innerHTML?.substring(0, 100) + '...',
                usingWindowData: !!window.contentData
            });
            
            if (!dataSource || dataSource.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-video"></i><p>No tienes contenido asignado</p></div>';
                return;
            }

            // LIMPIAR COMPLETAMENTE EL CONTENEDOR ANTES DE RENDERIZAR
            container.innerHTML = '';
            debugLog('üßπ RENDER-CONTENT: Contenedor limpiado');

            let html = '<div class="row">';
            
            debugLog('üé• RENDER-CONTENT: Procesando items', {
                count: dataSource.length,
                items: dataSource.map(c => ({id: c.id, title: c.title, description: c.description}))
            });
            
            dataSource.forEach((content, index) => {
                debugLog(`üé• RENDER-ITEM ${index}:`, {
                    id: content.id,
                    title: content.title,
                    description: content.description,
                    cleanTitle: cleanVideoTitle(content.title),
                    cleanDescription: cleanVideoDescription(content.description)
                });
                const formattedDate = content.assigned_at ? 
                    new Date(content.assigned_at).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    }) : 'Sin fecha';
                
                const duration = content.duration ? 
                    Math.ceil(content.duration / 60) + ' min' : '';
                
                const viewedBadge = content.is_viewed ? 
                    '<span class="badge bg-success ms-2"><i class="fas fa-check"></i> Visto</span>' : 
                    '<span class="badge bg-secondary ms-2"><i class="fas fa-eye"></i> Pendiente</span>';
                
                // Extraer video ID para embebido (L√ìGICA ID√âNTICA AL FEED)
                const isVideo = content.content_type === 'video';
                const isDocument = content.content_type === 'document';
                
                // Detectar YouTube video ID
                let youtubeVideoId = null;
                if (content.content_url) {
                    if (content.content_url.includes('youtube.com/watch?v=')) {
                        youtubeVideoId = content.content_url.split('v=')[1]?.split('&')[0];
                    } else if (content.content_url.includes('youtu.be/')) {
                        youtubeVideoId = content.content_url.split('youtu.be/')[1]?.split('?')[0];
                    }
                }
                
                // Detectar Instagram video ID (Reels)
                let instagramVideoId = null;
                if (content.content_url) {
                    const instagramPatterns = [
                        /instagram\.com\/(?:p|reel|tv)\/([A-Za-z0-9_-]+)/,
                        /instagram\.com\/(?:p|reel|tv)\/([A-Za-z0-9_-]+)\//
                    ];
                    
                    for (const pattern of instagramPatterns) {
                        const match = content.content_url.match(pattern);
                        if (match && match[1]) {
                            instagramVideoId = match[1];
                            break;
                        }
                    }
                }
                
                debugLog(`üé• VIDEO IDs detectados:`, {
                    youtubeId: youtubeVideoId,
                    instagramId: instagramVideoId
                });
                
                // CONSTRUIR CARD CON VIDEO EMBEBIDO SI ES POSIBLE
                const cleanTitle = cleanVideoTitle(content.title);
                const cleanDescription = cleanVideoDescription(content.description);
                
                let videoEmbedHTML = '';
                
                if (isVideo && (youtubeVideoId || instagramVideoId)) {
                    if (youtubeVideoId) {
                        videoEmbedHTML = `
                        <div class="content-preview has-embedded-video">
                            <div class="ratio ratio-16x9" style="position: relative;">
                                <iframe 
                                    src="https://www.youtube.com/embed/${youtubeVideoId}?rel=0&modestbranding=1" 
                                    title="${cleanTitle}"
                                    frameborder="0" 
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                                    allowfullscreen
                                    style="border-radius: 8px; width: 100%; height: 100%;">
                                </iframe>
                                ${duration ? `<span class="duration-badge">${duration}</span>` : ''}
                            </div>
                        </div>
                        `;
                    } else if (instagramVideoId) {
                        videoEmbedHTML = `
                        <div class="content-preview has-embedded-video">
                            <div class="ratio ratio-9x16" style="position: relative;">
                                <iframe 
                                    src="https://www.instagram.com/p/${instagramVideoId}/embed" 
                                    title="${cleanTitle}"
                                    frameborder="0" 
                                    scrolling="no" 
                                    allowtransparency="true"
                                    style="border-radius: 8px; width: 100%; height: 100%;">
                                </iframe>
                                ${duration ? `<span class="duration-badge">${duration}</span>` : ''}
                            </div>
                        </div>
                        `;
                    }
                } else if (isDocument && content.content_url) {
                    videoEmbedHTML = `
                        <div class="content-preview">
                            <div style="width: 100%; height: 400px; background: #f5f5f5; overflow-y: auto; overflow-x: hidden; -webkit-overflow-scrolling: touch; position: relative; border-radius: 8px;">
                                <canvas id="doc-preview-content-${content.id}"
                                        width="1200"
                                        height="1000"
                                        style="width: 100%; height: auto; display: block; cursor: pointer;"
                                        onclick="window.open('${content.content_url}', '_blank')">
                                </canvas>
                                <div id="doc-loading-content-${content.id}" style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #6c757d; pointer-events: none;">
                                    <div class="spinner-border" role="status" style="width: 3rem; height: 3rem;">
                                        <span class="visually-hidden">Cargando...</span>
                                    </div>
                                    <p class="mt-2">Cargando documento...</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                html += `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="content-card ${content.is_viewed ? 'viewed' : ''}" data-content-id="${content.id}">
                            ${videoEmbedHTML}
                            
                            <div class="content-info mt-3">
                                <div class="content-header">
                                    <div class="content-type-icon">
                                        <i class="fas ${isVideo ? 'fa-play-circle' : 'fa-file-pdf'}"></i>
                                    </div>
                                    <div class="flex-grow-1">
                                        <h5 class="content-title mb-1">${cleanTitle}</h5>
                                        ${cleanDescription ? `
                                        <div class="content-description">
                                            <p class="mb-0">${cleanDescription}</p>
                                        </div>
                                        ` : ''}
                                        <div class="content-meta">
                                            <span><i class="far fa-calendar"></i> ${formattedDate}</span>
                                            ${duration ? `<span><i class="far fa-clock"></i> ${duration}</span>` : ''}
                                            ${viewedBadge}
                                        </div>
                                    </div>
                                </div>
                                <div class="content-actions mt-3">
                                    ${content.content_url ? `
                                    <a href="${content.content_url}" target="_blank" class="btn btn-sm btn-primary">
                                        <i class="fas ${isVideo ? 'fa-play' : 'fa-download'}"></i>
                                        ${isVideo ? 'Ver video' : 'Descargar'}
                                    </a>
                                    ` : ''}
                                    <button class="btn btn-sm btn-outline-success" onclick="markContentAsViewed(${content.id}, ${content.is_viewed})">
                                        <i class="fas fa-check"></i>
                                        ${content.is_viewed ? 'Visto' : 'Marcar como visto'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
            debugLog('‚úÖ RENDER-CONTENT: Renderizado completo');
            
            // Renderizar PDFs de documentos despu√©s de cargar el HTML
            contentList.forEach(content => {
                if (content.content_type === 'document' && content.content_url) {
                    const canvasId = 'doc-preview-content-' + content.id;
                    const canvas = document.getElementById(canvasId);
                    if (canvas) {
                        generateDocumentPreview(content.content_url, canvasId);
                    }
                }
            });
        }
        
        // Registrar globalmente para que Alpine.js pueda usarla
        window.renderContent = renderContent;
        
        async function loadContent() {
            // Evitar llamadas concurrentes
            if (isLoadingContent) {
                debugLog('‚è≥ LoadContent ya en progreso, omitiendo llamada duplicada');
                return;
            }
            
            isLoadingContent = true;
            debugLog('üé• LOAD-CONTENT: Iniciando carga de contenido...');
            
            try {
                debugLog('üé• Cargando contenido asignado...');
                
                const response = await fetch('/api/coachee/content', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                debugLog('‚úÖ Contenido cargado:', data);
                
                if (data.success) {
                    contentData = data.content || [];
                    
                    // FILTRAR DUPLICADOS POR ID
                    const uniqueContent = [];
                    const seenIds = new Set();
                    
                    contentData.forEach(item => {
                        if (!seenIds.has(item.id)) {
                            seenIds.add(item.id);
                            uniqueContent.push(item);
                        } else {
                            debugLog('‚ö†Ô∏è DUPLICADO DETECTADO Y REMOVIDO:', item);
                        }
                    });
                    
                    contentData = uniqueContent;
                    
                    debugLog('üé• LOAD-CONTENT: Datos procesados', {
                        originalCount: (data.content || []).length,
                        uniqueCount: contentData.length,
                        titles: contentData.map(c => c.title),
                        ids: contentData.map(c => c.id)
                    });
                    renderContent();
                } else {
                    throw new Error(data.error || 'Error desconocido cargando contenido');
                }
                
            } catch (error) {
                console.error('Error cargando contenido:', error);
                showToast('Error cargando contenido: ' + error.message, 'error');
                
                // Inicializar con datos vac√≠os
                contentData = [];
                
                document.getElementById('contentContainer').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando contenido</p></div>';
            } finally {
                isLoadingContent = false;
            }
        }

        // renderContent() ya est√° definida m√°s arriba y registrada globalmente
        // No duplicar la definici√≥n aqu√≠

        // Open content (video or document)
        function openContent(contentId, contentUrl, title) {
            
            // Verificar si este contenido tiene un video embebido activo
            const embeddedVideoIframe = document.getElementById(`youtube-${contentId}`);
            
            if (embeddedVideoIframe) {
                return; // No hacer nada si hay un iframe embebido
            }
            
            // Verificar tambi√©n si el contenedor padre tiene la clase has-embedded-video
            const embeddedContainer = document.querySelector(`#youtube-${contentId}`);
            if (embeddedContainer || document.querySelector(`.content-preview.has-embedded-video iframe[id="youtube-${contentId}"]`)) {
                return;
            }
            
            
            // Si es un video de YouTube, usar modal con iframe
            if (contentUrl.includes('youtube.com') || contentUrl.includes('youtu.be')) {
                openVideoModal(contentUrl, title);
            } else {
                // Para otros tipos de contenido, abrir en nueva pesta√±a
                window.open(contentUrl, '_blank');
            }
            
            // Marcar como visto autom√°ticamente al abrir
            markContentAsViewed(contentId);
        }

        // Open video in modal
        function openVideoModal(videoUrl, title) {
            // Convertir URL de YouTube a embed
            let embedUrl = videoUrl;
            if (videoUrl.includes('youtube.com/watch?v=')) {
                const videoId = videoUrl.split('v=')[1].split('&')[0];
                embedUrl = `https://www.youtube.com/embed/${videoId}`;
            } else if (videoUrl.includes('youtu.be/')) {
                const videoId = videoUrl.split('youtu.be/')[1].split('?')[0];
                embedUrl = `https://www.youtube.com/embed/${videoId}`;
            }
            
            const modalHtml = `
                <div class="modal fade" id="videoModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${escapeHtml(cleanVideoTitle(title))}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal">
                                    <span style="color: white; font-size: 1.2rem; font-weight: bold;">√ó</span>
                                </button>
                            </div>
                            <div class="modal-body p-0">
                                <div class="ratio ratio-16x9">
                                    <iframe src="${embedUrl}" allowfullscreen></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Eliminar modal anterior si existe
            const existingModal = document.getElementById('videoModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('videoModal'));
            modal.show();
            
            // Limpiar cuando se cierre
            document.getElementById('videoModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // Mark content as viewed
        async function markContentAsViewed(contentId) {
            try {
                const response = await fetch(`/api/coachee/content/${contentId}/mark-viewed`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Actualizar solo el contenido espec√≠fico en lugar de recargar todo
                    const contentItem = contentData.find(c => c.id === contentId);
                    if (contentItem) {
                        contentItem.is_viewed = true;
                        contentItem.viewed_at = new Date().toISOString();
                        renderContent(); // Re-renderizar con datos actualizados
                    }
                } else {
                    throw new Error(data.error || 'Error marcando contenido como visto');
                }
                
            } catch (error) {
                console.error('Error marcando contenido como visto:', error);
                showToast('Error marcando contenido como visto: ' + error.message, 'error');
            }
        }

        // Setup video tracking for embedded YouTube videos
        function setupVideoTracking(contentId) {
            
            const iframe = document.getElementById(`youtube-${contentId}`);
            if (!iframe) {
                return;
            }
            
            
            // Mark as viewed when iframe loads (auto-mark since video is now immediately accessible)
            setTimeout(() => {
                const contentItem = contentData.find(c => c.id === contentId);
                if (contentItem && !contentItem.is_viewed) {
                    markContentAsViewed(contentId);
                } else {
                }
            }, 1000);
        }

        // Render statistics
        function renderStatistics(statistics) {
            const container = document.getElementById('statisticsContainer');
            
            if (!statistics) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-calculator"></i><p>No hay estad√≠sticas disponibles</p></div>';
                return;
            }
            
            let statisticsHtml = `
                <div class="mb-4">
                    <h6 class="mb-2">Total de Evaluaciones</h6>
                    <div class="h4 text-primary">${statistics.total_evaluations || 0}</div>
                </div>
                
                <div class="mb-4">
                    <h6 class="mb-2">Puntuaci√≥n Promedio General</h6>
                    <div class="h4 text-success">${statistics.average_score ? Math.round(statistics.average_score) : '-'}${statistics.average_score ? '%' : ''}</div>
                </div>
            `;
            
            // Mostrar estad√≠sticas por tipo de evaluaci√≥n si est√°n disponibles
            if (statistics.by_assessment_type && Object.keys(statistics.by_assessment_type).length > 0) {
                statisticsHtml += `
                    <div class="mb-4">
                        <h6 class="mb-3"><i class="fas fa-chart-bar me-2"></i>Por Tipo de Evaluaci√≥n</h6>
                        <div class="row">
                `;
                
                // Definir colores para cada tipo de evaluaci√≥n (iguales a los del gr√°fico)
                const typeColors = {
                    'Asertividad': '#6282E3',
                    'DISC': '#A0D8CC',
                    'Inteligencia Emocional': '#F4A460',
                    'Liderazgo': '#FFB6C1',
                    'Trabajo en equipo': '#DDA0DD'
                };
                
                Object.entries(statistics.by_assessment_type).forEach(([type, stats]) => {
                    const color = typeColors[type] || '#6B8DA6';
                    
                    let trendIcon = '';
                    let trendColor = '';
                    let trendText = '';
                    
                    if (stats.improvement_trend === 'improving') {
                        trendIcon = 'fas fa-arrow-up';
                        trendColor = 'text-success';
                        trendText = 'Mejorando';
                    } else if (stats.improvement_trend === 'declining') {
                        trendIcon = 'fas fa-arrow-down';
                        trendColor = 'text-danger';
                        trendText = 'Descendiendo';
                    } else if (stats.improvement_trend === 'stable') {
                        trendIcon = 'fas fa-minus';
                        trendColor = 'text-warning';
                        trendText = 'Estable';
                    } else {
                        trendIcon = 'fas fa-question';
                        trendColor = 'text-muted';
                        trendText = 'Sin datos';
                    }
                    
                    statisticsHtml += `
                        <div class="col-12 mb-3">
                            <div class="p-3 rounded" style="background-color: rgba(255,255,255,0.5); border-left: 4px solid ${color};">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-0" style="color: ${color};">${type}</h6>
                                    <small class="text-muted">${stats.total_evaluations} evaluacion${stats.total_evaluations !== 1 ? 'es' : ''}</small>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <small class="text-muted">Promedio</small>
                                        <div class="h6 mb-0">${stats.average_score ? Math.round(stats.average_score) : '-'}${stats.average_score ? '%' : ''}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">√öltima</small>
                                        <div class="h6 mb-0">${stats.latest_score ? Math.round(stats.latest_score) : '-'}${stats.latest_score ? '%' : ''}</div>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="${trendColor}">
                                        <i class="${trendIcon} me-1"></i>
                                        ${trendText}
                                    </small>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                statisticsHtml += `
                        </div>
                    </div>
                `;
            } else {
                // Si no hay estad√≠sticas por tipo, mostrar estad√≠sticas generales
                let trendIcon = '';
                let trendColor = '';
                let trendText = '';
                
                if (statistics.improvement_trend === 'improving') {
                    trendIcon = 'fas fa-arrow-up';
                    trendColor = 'text-success';
                    trendText = 'Mejorando';
                } else if (statistics.improvement_trend === 'declining') {
                    trendIcon = 'fas fa-arrow-down';
                    trendColor = 'text-danger';
                    trendText = 'Descendiendo';
                } else if (statistics.improvement_trend === 'stable') {
                    trendIcon = 'fas fa-minus';
                    trendColor = 'text-warning';
                    trendText = 'Estable';
                } else {
                    trendIcon = 'fas fa-question';
                    trendColor = 'text-muted';
                    trendText = 'Sin datos';
                }
                
                statisticsHtml += `
                    <div class="mb-4">
                        <h6 class="mb-2">√öltima Puntuaci√≥n</h6>
                        <div class="h4 text-info">${statistics.latest_score ? Math.round(statistics.latest_score) : '-'}${statistics.latest_score ? '%' : ''}</div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="mb-2">Tendencia</h6>
                        <div class="h5 ${trendColor}">
                            <i class="${trendIcon} me-2"></i>
                            ${trendText}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = statisticsHtml;
        }

        // Render latest evaluation details
        function renderLatestEvaluationDetails(history) {
            const container = document.getElementById('latestEvaluationContainer');
            
            if (!history || history.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-bullseye"></i><p>No tienes evaluaciones completadas</p></div>';
                return;
            }
            
            const latest = history[history.length - 1];
            const dimensions = latest.dimensional_scores;
            
            container.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-4">Puntuaci√≥n General</h5>
                        <div class="text-center mb-4">
                            <div class="h1 text-primary">${Math.round(latest.total_score)}%</div>
                            <div class="h6 text-muted">${latest.assertiveness_level}</div>
                            <div class="small text-secondary mb-2">${latest.result_description || ''}</div>
                            <small class="text-muted">Completado el ${formatDate(latest.completed_at)}</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5 class="mb-4">An√°lisis por Dimensiones</h5>
                        ${Object.entries(dimensions).map(([key, value]) => {
                            const progressClass = value >= 75 ? 'high' : value >= 25 ? 'medium' : 'low';
                            const dimensionLabel = getDimensionLabel(key);
                            
                            return `
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small>${dimensionLabel}</small>
                                        <small>${Math.round(value)}%</small>
                                    </div>
                                    <div class="progress-bar-custom">
                                        <div class="progress-fill ${progressClass}" style="width: ${value}%"></div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // Open task progress modal
        function openTaskProgressModal(taskId) {
            const task = (window.tasksData || []).find(t => t.id === taskId);
            if (!task) {
                console.error('Task not found:', taskId, 'Available tasks:', window.tasksData);
                showToast('Error: Tarea no encontrada', 'error');
                return;
            }
            
            // Mostrar informaci√≥n de la tarea en el modal
            const modalBody = document.querySelector('#taskProgressModal .modal-body');
            const formHtml = `
                <!-- T√≠tulo del modal -->
                <h5 class="inline-text-dark" style="margin: 0 0 1.25rem 0; font-size: 1.125rem; font-weight: 600; display: flex; align-items: center">
                    <i class="fas fa-tasks" style="margin-right: 0.5rem; color: #667eea;"></i>
                    Actualizar Progreso
                </h5>
                
                <!-- Informaci√≥n de la tarea -->
                <div style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 1rem; border-radius: 8px; margin-bottom: 1.25rem; border-left: 3px solid #667eea;">
                    <h6 class="inline-text-dark" style="margin: 0 0 0.5rem 0; font-size: 0.95rem; font-weight: 600">
                        <i class="fas fa-clipboard-list" style="color: #667eea; margin-right: 0.5rem;"></i>
                        ${task.title}
                    </h6>
                    ${task.description ? `<p class="inline-text-light" style="margin: 0; font-size: 0.8rem; line-height: 1.4">${task.description}</p>` : ''}
                </div>
                
                <form id="taskProgressForm">
                    <input type="hidden" id="taskId" value="${taskId}" />
                    
                    <div class="mb-3">
                        <label for="taskStatus" class="form-label" style="font-weight: 600; color: #334155; font-size: 0.9rem;">
                            <i class="fas fa-flag" style="margin-right: 0.5rem; color: #667eea;"></i>
                            Estado de la Tarea
                        </label>
                        <select class="form-select" id="taskStatus" required style="font-size: 0.9rem;">
                            <option value="pending" ${task.status === 'pending' ? 'selected' : ''}>‚è≥ Pendiente</option>
                            <option value="in_progress" ${task.status === 'in_progress' ? 'selected' : ''}>üîÑ En Progreso</option>
                            <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>‚úÖ Completada</option>
                            <option value="blocked" ${task.status === 'blocked' ? 'selected' : ''}>üö´ Bloqueada</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="taskProgress" class="form-label" style="font-weight: 600; color: #334155; font-size: 0.9rem;">
                            <i class="fas fa-chart-line" style="margin-right: 0.5rem; color: #667eea;"></i>
                            Progreso
                        </label>
                        <input type="range" class="form-range" id="taskProgress" min="0" max="100" value="${task.progress_percentage || 0}" 
                               style="height: 8px; cursor: pointer;">
                        <div class="d-flex justify-content-between" class="inline-text-light" style="font-size: 0.8rem; margin-top: 0.5rem">
                            <span>0%</span>
                            <span id="progressValue" style="font-weight: 600; font-size: 1rem; color: #667eea;">${Math.round(task.progress_percentage || 0)}%</span>
                            <span>100%</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="taskNotes" class="form-label" style="font-weight: 600; color: #334155; font-size: 0.9rem;">
                            <i class="fas fa-sticky-note" style="margin-right: 0.5rem; color: #667eea;"></i>
                            Notas sobre tu progreso
                        </label>
                        <textarea class="form-control" id="taskNotes" rows="3" 
                                  placeholder="Comparte tus avances, desaf√≠os o comentarios..."
                                  style="font-size: 1rem; resize: none;"></textarea>
                        <small style="color: #94a3b8; font-size: 0.75rem; display: block; margin-top: 0.25rem;">
                            üí° Tu coach podr√° ver estos comentarios
                        </small>
                    </div>
                    
                    <!-- Botones de acci√≥n -->
                    <div style="display: flex; gap: 0.5rem; margin-top: 1.5rem;">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" 
                                style="flex: 1; padding: 0.625rem 1.25rem; font-weight: 600; border-radius: 8px; font-size: 0.875rem; background: #f3f4f6; color: #374151; border: 1px solid #e5e7eb;">
                            Cancelar
                        </button>
                        <button type="button" class="btn btn-task" onclick="saveTaskProgress()" 
                                style="flex: 1; padding: 0.625rem 1.25rem; font-weight: 600; border-radius: 8px; font-size: 0.875rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none;">
                            <i class="fas fa-save me-2"></i>
                            Guardar Progreso
                        </button>
                    </div>
                </form>
            `;
            
            modalBody.innerHTML = formHtml;
            
            // Update progress display when slider changes
            const progressSlider = document.getElementById('taskProgress');
            progressSlider.oninput = function() {
                const value = this.value;
                document.getElementById('progressValue').textContent = value + '%';
                
                // Actualizar estilo del track de la barra de progreso con gradiente verde
                this.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${value}%, #e5e7eb ${value}%, #e5e7eb 100%)`;
                
                // Cambiar color del badge seg√∫n progreso
                const progressValueEl = document.getElementById('progressValue');
                if (value >= 75) {
                    progressValueEl.style.color = '#059669';
                    progressValueEl.style.backgroundColor = '#d1fae5';
                } else if (value >= 50) {
                    progressValueEl.style.color = '#10b981';
                    progressValueEl.style.backgroundColor = '#ecfdf5';
                } else if (value >= 25) {
                    progressValueEl.style.color = '#f59e0b';
                    progressValueEl.style.backgroundColor = '#fef3c7';
                } else {
                    progressValueEl.style.color = '#6b7280';
                    progressValueEl.style.backgroundColor = '#f3f4f6';
                }
            };
            
            const modal = new bootstrap.Modal(document.getElementById('taskProgressModal'));
            modal.show();
            
            // Inicializar color de la barra al abrir el modal
            const currentProgress = progressSlider.value;
            progressSlider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${currentProgress}%, #e5e7eb ${currentProgress}%, #e5e7eb 100%)`;
            
            // Inicializar color del badge
            const progressValueEl = document.getElementById('progressValue');
            if (currentProgress >= 75) {
                progressValueEl.style.color = '#059669';
                progressValueEl.style.backgroundColor = '#d1fae5';
            } else if (currentProgress >= 50) {
                progressValueEl.style.color = '#10b981';
                progressValueEl.style.backgroundColor = '#ecfdf5';
            } else if (currentProgress >= 25) {
                progressValueEl.style.color = '#f59e0b';
                progressValueEl.style.backgroundColor = '#fef3c7';
            } else {
                progressValueEl.style.color = '#6b7280';
                progressValueEl.style.backgroundColor = '#f3f4f6';
            }
        }

        // Save task progress
        async function saveTaskProgress() {
            const taskId = document.getElementById('taskId').value;
            const status = document.getElementById('taskStatus').value;
            const progress = parseInt(document.getElementById('taskProgress').value);
            const notes = document.getElementById('taskNotes').value;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/tasks/${taskId}/progress`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        status: status,
                        progress_percentage: progress,
                        notes: notes
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Close modal first to avoid any flicker
                    const modal = bootstrap.Modal.getInstance(document.getElementById('taskProgressModal'));
                    if (modal) {
                        modal.hide();
                    }
                    
                    // Update task in local data immediately to avoid visual delay
                    if (window.tasksData) {
                        const taskIndex = window.tasksData.findIndex(t => t.id === parseInt(taskId));
                        if (taskIndex !== -1) {
                            window.tasksData[taskIndex].status = status;
                            window.tasksData[taskIndex].progress_percentage = progress;
                        }
                    }
                    
                    // GAMIFICACI√ìN: Mostrar notificaciones de puntos (Etapa 7-8)
                    if (data.gamification && data.gamification.points_awarded > 0) {
                        const pointsAwarded = data.gamification.points_awarded;
                        const levelUp = data.gamification.level_up;
                        const newLevel = data.gamification.new_level;
                        
                        console.log('üéÆ GAMIFICACI√ìN: Puntos otorgados:', pointsAwarded);
                        
                        // Toast de puntos ganados
                        showToast(`¬°Tarea completada! +${pointsAwarded} puntos üéâ`, 'success');
                        
                        // Si hubo level up, mostrar modal de celebraci√≥n
                        if (levelUp && newLevel) {
                            console.log('üéâ LEVEL UP:', newLevel);
                            setTimeout(() => {
                                showLevelUpModal(newLevel);
                            }, 1000);
                        }
                        
                        // Recargar badge de gamificaci√≥n
                        setTimeout(() => {
                            if (typeof loadGamificationData === 'function') {
                                loadGamificationData();
                            }
                        }, 1500);
                    } else {
                        // Show standard success message
                        showToast('Progreso actualizado exitosamente', 'success');
                    }
                    
                    // Refresh tasks and summary in background without blocking UI
                    setTimeout(async () => {
                        await loadTasks(true);
                        await loadDashboardSummary();
                    }, 100);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error actualizando progreso:', error);
                showToast('Error actualizando progreso: ' + error.message, 'error');
            }
        }

        // Start evaluation - FIXED VERSION
        async function startEvaluation(evaluationType) {
            try {
                
                // CR√çTICO: Validar y parsear el assessment_id
                const assessmentId = parseInt(evaluationType);
                
                if (isNaN(assessmentId) || assessmentId <= 0) {
                    console.error('‚ùå ERROR: assessment_id inv√°lido', {
                        received: evaluationType,
                        parsed: assessmentId
                    });
                    showToast('Error: ID de evaluaci√≥n inv√°lido', 'error');
                    return;
                }
                
                
                // Reset assessment state
                questions = [];
                currentQuestionIndex = 0;
                answers = {};
                isAssessmentActive = true;
                
                // Store current assessment ID for later use (usar el ID num√©rico validado)
                currentAssessmentId = assessmentId;
                
                // Show assessment tab
                document.getElementById('assessment-sidebar-item').style.display = 'block';
                
                // Switch to assessment tab
                showTab('assessment');
                
                // Load questions
                await loadAssessmentQuestions();
                
            } catch (error) {
                console.error('‚ùå Error starting assessment:', error);
                showToast('Error iniciando evaluaci√≥n: ' + error.message, 'error');
            }
        }

        // Load assessment questions
        async function loadAssessmentQuestions() {
            try {
                const url = `${API_BASE_URL}/api/questions?assessment_id=${currentAssessmentId}`;
                const response = await fetch(url, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        window.location.href = '/participant-access';
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.questions && data.questions.length > 0) {
                    questions = data.questions;
                    
                    // CR√çTICO: Verificar que questions.length es correcto
                    
                    // Validar integridad del correlativo
                    validateQuestionSequence();
                    
                    // Actualizar el t√≠tulo din√°micamente en el header de la evaluaci√≥n
                    const assessmentHeaderTitle = document.querySelector('#assessment .card-header h3');
                    if (assessmentHeaderTitle && data.assessment_title) {
                        assessmentHeaderTitle.innerHTML = `
                            <i class="fas fa-clipboard-check me-2"></i>
                            ${data.assessment_title}
                        `;
                    }
                    
                    // Guardar el t√≠tulo para uso posterior en resultados
                    window.currentAssessmentTitle = data.assessment_title;
                    
                    showAssessmentQuestion();
                } else {
                    throw new Error('No se encontraron preguntas v√°lidas');
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                showToast('Error cargando preguntas: ' + error.message, 'error');
            }
        }

        // NUEVA: Validar secuencia completa del correlativo
        function validateQuestionSequence() {
            
            const totalQuestions = questions.length;
            const expectedForIE = 12;
            const orders = questions.map(q => q.order).sort((a, b) => a - b);
            const ids = questions.map(q => q.id).sort((a, b) => a - b);
            
            // Verificar cantidad esperada
            const isCorrectCount = totalQuestions === expectedForIE;
            
            // Verificar secuencia consecutiva 1-12
            const expectedOrders = Array.from({length: expectedForIE}, (_, i) => i + 1);
            const isConsecutiveSequence = JSON.stringify(orders) === JSON.stringify(expectedOrders);
            
            // Verificar que cada √≠ndice del array corresponda al correlativo
            const arrayToOrderMatch = questions.every((q, index) => q.order === (index + 1));
            
            const validationResult = {
                totalQuestions: totalQuestions,
                expectedCount: expectedForIE,
                isCorrectCount: isCorrectCount,
                orders: orders,
                expectedOrders: expectedOrders,
                isConsecutiveSequence: isConsecutiveSequence,
                arrayToOrderMatch: arrayToOrderMatch,
                questionDetails: questions.map((q, index) => ({
                    arrayIndex: index,
                    questionId: q.id,
                    order: q.order,
                    orderMatchesIndex: q.order === (index + 1)
                }))
            };
            
            
            if (!isCorrectCount) {
                console.error('‚ùå ERROR: Cantidad incorrecta de preguntas', {
                    expected: expectedForIE,
                    received: totalQuestions
                });
            }
            
            if (!isConsecutiveSequence) {
                console.error('‚ùå ERROR: Correlativo no consecutivo', {
                    expected: expectedOrders,
                    received: orders
                });
            }
            
            if (!arrayToOrderMatch) {
                console.error('‚ùå ERROR: √çndices del array no coinciden con correlativo', validationResult.questionDetails);
                showToast('Error: La secuencia de preguntas no est√° ordenada correctamente', 'error');
            }
            
            if (isCorrectCount && isConsecutiveSequence && arrayToOrderMatch) {
            }
            
            return validationResult;
        }

        // Show current assessment question
        function showAssessmentQuestion() {
            
            if (currentQuestionIndex >= questions.length) {
                completeAssessment();
                return;
            }
            
            const question = questions[currentQuestionIndex];
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            
            // MEJORADO: Validaci√≥n del correlativo
            const expectedCorrelativo = currentQuestionIndex + 1;
            if (question.order !== expectedCorrelativo) {
                console.warn('‚ö†Ô∏è ADVERTENCIA: Correlativo inconsistente', {
                    questionId: question.id,
                    currentIndex: currentQuestionIndex,
                    questionOrder: question.order,
                    expectedOrder: expectedCorrelativo,
                    difference: question.order - expectedCorrelativo
                });
            }
            
            // Update progress bar
            document.getElementById('assessmentProgress').style.width = progress + '%';
            
            // Determinar opciones seg√∫n el tipo de evaluaci√≥n
            let likertOptions;
            
            if (currentAssessmentId === 6 || currentAssessmentId === "6") {  // Preparaci√≥n para crecer 2026
                likertOptions = getGrowthPreparationOptions(questions[currentQuestionIndex]);
            } else {
                // Opciones est√°ndar para escala Likert de 5 puntos (otras evaluaciones)
                likertOptions = [
                    'Totalmente en desacuerdo',
                    'En desacuerdo',
                    'Neutral',
                    'De acuerdo',
                    'Totalmente de acuerdo'
                ];
            }
            
            // Create question HTML - MODERNIZADO
            document.getElementById('questionContainer').innerHTML = `
                <div class="question-card">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <span class="question-title">
                            <i class="fas fa-question-circle"></i>
                            Pregunta ${question.order} de ${questions.length}
                        </span>
                        <span style="font-size: 0.875rem; color: #64748b; font-weight: 500;">
                            <i class="fas fa-clock me-1"></i>
                            ${Math.ceil((questions.length - currentQuestionIndex) * 0.5)} min restantes
                        </span>
                    </div>
                    <div class="question-text mb-4">${question.text}</div>
                    <div class="options-container" style="display: grid; gap: 12px;">
                        ${likertOptions.map((option, index) => `
                            <div class="form-check p-3 border rounded option-item auto-advance-option" onclick="selectAssessmentOption(${index + 1})" style="margin-bottom: 0;">
                                <input class="form-check-input" type="radio" name="question${currentQuestionIndex}" value="${index + 1}" id="option${index}">
                                <label class="form-check-label w-100 d-flex align-items-center gap-2" for="option${index}" style="cursor: pointer;">
                                    <span style="display: inline-flex; align-items: center; justify-content: center; width: 24px; height: 24px; border-radius: 50%; background: rgba(102, 126, 234, 0.1); font-size: 0.75rem; font-weight: 600; color: #667eea;">${index + 1}</span>
                                    <span style="flex: 1;">${option}</span>
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="text-center mt-4">
                        <button class="btn btn-primary-custom btn-lg manual-next-btn" onclick="nextAssessmentQuestion()" style="display: none; border-radius: 12px; padding: 12px 32px; font-weight: 600;">
                            <i class="fas fa-${currentQuestionIndex === questions.length - 1 ? 'flag-checkered' : 'arrow-right'} me-2"></i>
                            ${currentQuestionIndex === questions.length - 1 ? 'Finalizar Evaluaci√≥n' : 'Siguiente Pregunta'}
                        </button>
                    </div>
                </div>
            `;
            
            // Add fade-in animation to new question
            const questionCard = document.querySelector('.question-card');
            if (questionCard) {
                questionCard.style.opacity = '0';
                questionCard.style.transition = 'opacity 0.4s ease-in';
                setTimeout(() => {
                    questionCard.style.opacity = '1';
                }, 50);
            }
        }

        // Select assessment option - FIXED VERSION with double-click protection
        let isProcessingAnswer = false; // Protection flag
        
        function selectAssessmentOption(value) {
            // CRITICAL: Prevent double-click/double-processing
            if (isProcessingAnswer) {
                console.warn('‚ö†Ô∏è Ya hay una respuesta en proceso, ignorando clic duplicado');
                return;
            }
            
            // Validar que tenemos una pregunta actual v√°lida
            const currentQuestion = questions[currentQuestionIndex];
            if (!currentQuestion) {
                console.error('‚ùå ERROR: No hay pregunta actual v√°lida', {
                    currentQuestionIndex: currentQuestionIndex,
                    questionsLength: questions.length
                });
                showToast('Error: Pregunta no encontrada', 'error');
                return;
            }
            
            // Remove previous selections
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('bg-primary', 'text-white', 'selected');
                item.classList.add('bg-light');
            });
            
            // Mark selected option
            const selectedOption = document.querySelector(`input[value="${value}"]`);
            if (!selectedOption) {
                console.error('‚ùå ERROR: No se encontr√≥ la opci√≥n seleccionada', {value});
                showToast('Error: Opci√≥n no encontrada', 'error');
                return;
            }
            
            selectedOption.checked = true;
            const optionItem = selectedOption.closest('.option-item');
            optionItem.classList.remove('bg-light');
            optionItem.classList.add('bg-primary', 'text-white', 'selected');
            
            // Add visual feedback with animation
            optionItem.style.transform = 'scale(1.02)';
            setTimeout(() => {
                optionItem.style.transform = 'scale(1)';
            }, 150);
            
            // Show brief loading state
            const nextButton = document.querySelector('.btn-primary-custom');
            if (nextButton) {
                nextButton.disabled = true;
                nextButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Procesando...';
            }
            
            // CR√çTICO: Guardar la respuesta INMEDIATAMENTE usando question ID como clave
            const parsedValue = parseInt(value);
            if (isNaN(parsedValue)) {
                console.error('‚ùå ERROR: Valor de respuesta inv√°lido', {value, parsedValue});
                showToast('Error: Respuesta inv√°lida', 'error');
                return;
            }
            
            answers[currentQuestion.id] = parsedValue;
            
            // Verificar que la respuesta realmente se guard√≥
            if (answers[currentQuestion.id] !== parsedValue) {
                console.error('‚ùå ERROR CR√çTICO: La respuesta no se guard√≥ correctamente', {
                    expected: parsedValue,
                    stored: answers[currentQuestion.id]
                });
                showToast('Error guardando respuesta. Por favor intenta de nuevo.', 'error');
                
                // Restaurar el estado del bot√≥n
                if (nextButton) {
                    nextButton.disabled = false;
                    nextButton.innerHTML = '<i class="fas fa-arrow-right me-2"></i>Siguiente';
                }
                
                // Reset processing flag
                isProcessingAnswer = false;
                return;
            }
            
            // Set processing flag to prevent double-click
            isProcessingAnswer = true;
            
            // TODO VALIDADO: Auto-advance to next question after a brief delay
            setTimeout(() => {
                autoAdvanceQuestion();
            }, 300); // 300ms delay for better UX
        }
        
        // Auto-advance to next question - FIXED VERSION
        function autoAdvanceQuestion() {
            // Add fade-out animation to current question
            const questionCard = document.querySelector('.question-card');
            if (!questionCard) {
                console.error('‚ùå ERROR: No se encontr√≥ questionCard');
                isProcessingAnswer = false; // Reset flag on error
                return;
            }
            
            questionCard.style.transition = 'opacity 0.3s ease-out';
            questionCard.style.opacity = '0';
            
            setTimeout(() => {
                // CR√çTICO: Validar ANTES de incrementar el √≠ndice
                const currentQuestion = questions[currentQuestionIndex];
                
                // VALIDACI√ìN CR√çTICA: Verificar que la pregunta actual est√© respondida
                if (!currentQuestion) {
                    console.error('‚ùå ERROR CR√çTICO: currentQuestion es undefined', {
                        currentIndex: currentQuestionIndex,
                        questionsLength: questions.length
                    });
                    showToast('Error: Pregunta no encontrada', 'error');
                    questionCard.style.opacity = '1';
                    isProcessingAnswer = false; // Reset flag on error
                    return;
                }
                
                if (!answers[currentQuestion.id]) {
                    console.error('‚ùå ERROR CR√çTICO: Pregunta actual sin respuesta', {
                        questionId: currentQuestion.id,
                        questionOrder: currentQuestion.order,
                        index: currentQuestionIndex,
                        allAnswers: answers
                    });
                    showToast('Error: No se guard√≥ la respuesta. Por favor intenta de nuevo.', 'error');
                    questionCard.style.opacity = '1';
                    isProcessingAnswer = false; // Reset flag on error
                    return;
                }
                
                // TODO VALIDADO: Ahora s√≠ incrementar el √≠ndice
                const previousIndex = currentQuestionIndex;
                currentQuestionIndex++;
                
                // Decidir si mostrar siguiente pregunta o completar
                if (currentQuestionIndex < questions.length) {
                    // HAY M√ÅS PREGUNTAS: Mostrar la siguiente
                    const nextQuestion = questions[currentQuestionIndex];
                    
                    // Reset processing flag before showing next question
                    isProcessingAnswer = false;
                    showAssessmentQuestion();
                    
                } else {
                    // NO HAY M√ÅS PREGUNTAS: Validar y completar
                    const totalQuestionsExpected = questions.length;
                    const totalAnswered = Object.keys(answers).length;
                    
                    // VALIDACI√ìN FINAL: Verificar que TODAS las preguntas est√©n respondidas
                    const missingQuestions = questions.filter(q => !answers[q.id]);
                    
                    if (missingQuestions.length > 0) {
                        console.error('‚ùå ERROR FINAL: Faltan respuestas antes de completar', {
                            expected: totalQuestionsExpected,
                            received: totalAnswered,
                            missing: missingQuestions.map(q => ({
                                id: q.id, 
                                order: q.order, 
                                text: q.text.substring(0, 50) + '...'
                            }))
                        });
                        
                        showToast(`Error: Faltan ${missingQuestions.length} respuestas. Regresando a preguntas sin responder.`, 'error');
                        
                        // Ir a la PRIMERA pregunta sin responder
                        const firstMissingIndex = questions.findIndex(q => q.id === missingQuestions[0].id);
                        if (firstMissingIndex >= 0) {
                            currentQuestionIndex = firstMissingIndex;
                            isProcessingAnswer = false; // Reset flag before returning
                            showAssessmentQuestion();
                            return;
                        }
                    }
                    
                    // TODO VALIDADO: Completar la evaluaci√≥n
                    // Note: completeAssessment() will reset isProcessingAnswer after completion
                    completeAssessment();
                }
                
            }, 300); // Wait for fade-out animation
        }

        // Move to next assessment question (manual fallback)
        function nextAssessmentQuestion() {
            const selected = document.querySelector(`input[name="question${currentQuestionIndex}"]:checked`);
            
            if (!selected) {
                showToast('Por favor selecciona una respuesta', 'warning');
                return;
            }
            
            // Store answer using question ID - ALWAYS store it
            const currentQuestion = questions[currentQuestionIndex];
            if (currentQuestion && currentQuestion.id) {
                answers[currentQuestion.id] = parseInt(selected.value);
            }
            
            // Use the same auto-advance logic
            autoAdvanceQuestion();
        }

        // Complete assessment
        async function completeAssessment() {
            try {
                
                if (Object.keys(answers).length === 0) {
                    throw new Error('No hay respuestas guardadas');
                }
                
                // MEJORADO: Validaci√≥n final completa antes de enviar
                const totalAnswers = Object.keys(answers).length;
                const expectedAnswers = questions.length;
                
                // Verificar que todas las preguntas est√©n respondidas
                if (totalAnswers !== expectedAnswers) {
                    const missingQuestions = questions.filter(q => answers[q.id] === undefined);
                    console.error('‚ùå ERROR VALIDACI√ìN FINAL: Faltan respuestas', {
                        expected: expectedAnswers,
                        received: totalAnswers,
                        missing: missingQuestions.map(q => ({id: q.id, order: q.order, text: q.text.substring(0, 30)}))
                    });
                    
                    showToast(`Error: Faltan ${expectedAnswers - totalAnswers} respuestas. Evaluaci√≥n incompleta.`, 'error');
                    
                    // Ir a la primera pregunta sin responder
                    if (missingQuestions.length > 0) {
                        const firstMissingIndex = questions.findIndex(q => q.id === missingQuestions[0].id);
                        if (firstMissingIndex >= 0) {
                            currentQuestionIndex = firstMissingIndex;
                            showAssessmentQuestion();
                            return;
                        }
                    }
                    
                    throw new Error(`Evaluaci√≥n incompleta: ${totalAnswers}/${expectedAnswers} respuestas`);
                }
                
                // Convert answers to the format expected by the API
                const responses = [];
                for (const [questionId, answer] of Object.entries(answers)) {
                    // questionId is now the actual question ID, not an index
                    responses.push({
                        question_id: parseInt(questionId),
                        selected_option: answer
                    });
                }
                
                
                if (responses.length === 0) {
                    throw new Error('No se pudieron procesar las respuestas');
                }
                
                // Create user data for assessment
                const userData = {
                    age: 25, // Default age
                    gender: 'no_especificado'
                };
                
                const requestBody = {
                    age: userData.age,
                    gender: userData.gender,
                    responses: responses,
                    assessment_id: currentAssessmentId
                };
                
                
                // Send assessment data
                const response = await fetch(`${API_BASE_URL}/api/save_assessment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    showAssessmentResults(data);
                } else if (response.status === 409) {
                    // Evaluaci√≥n ya completada previamente
                    showToast(data.error || 'Ya has completado esta evaluaci√≥n previamente', 'warning');
                } else {
                    throw new Error(data.error || 'Error guardando evaluaci√≥n');
                }
                
            } catch (error) {
                console.error('Assessment completion error:', error);
                showToast('Error completando evaluaci√≥n: ' + error.message, 'error');
            }
        }

        // Show assessment results
        function showAssessmentResults(data) {
            
            // Reset processing flag when showing results
            isProcessingAnswer = false;
            
            // Extract result data from the correct location
            const result = data.result || data;
            const evaluationId = result.id;
            const score = Math.round(result.score);
            const resultText = result.result_text || '';
            
            // CR√çTICO: Guardar tambi√©n el assessment_id que se acaba de completar
            // Usar la variable global currentAssessmentId directamente
            const completedAssessmentId = currentAssessmentId;
            const completedAssessmentTitle = window.currentAssessmentTitle || 'Evaluaci√≥n';
            
            // Store the result_id and data for detailed view
            window.lastEvaluationId = evaluationId;
            window.lastAssessmentData = result; // Store complete result data
            window.lastCompletedAssessmentId = completedAssessmentId;
            window.lastCompletedAssessmentTitle = completedAssessmentTitle;
            
            if (!evaluationId) {
                console.error('‚ùå No evaluation ID found in response:', data);
                showToast('Error: No se encontr√≥ el ID de la evaluaci√≥n', 'error');
                return;
            }
            
            // Hide question container and reset assessment state
            document.getElementById('assessmentContainer').style.display = 'none';
            isAssessmentActive = false; // Reset assessment state
            
            // Hide assessment tab automatically when evaluation is completed
            document.getElementById('assessment-sidebar-item').style.display = 'none';
            
            // Switch back to evaluaciones-figma tab
            showTab('evaluaciones-figma');
            
            // Agregar listener para cuando se cierre el modal de detalles
            const modalElement = document.getElementById('evaluationDetailsModal');
            if (modalElement) {
                modalElement.addEventListener('hidden.bs.modal', async function handleModalClose() {
                    // Asegurar que volvemos al tab correcto con la sub-tab Completadas
                    showTab('evaluaciones-figma');
                    
                    // IMPORTANTE: Recargar evaluaciones para actualizar previous_attempts
                    await loadEvaluations(true);
                    
                    setTimeout(() => {
                        // Cambiar a la sub-tab de Completadas
                        const alpineData = Alpine.$data(document.body);
                        if (alpineData) {
                            alpineData.evaluationsSubTab = 'completadas';
                        }
                        
                        // Activar visualmente la sub-tab de Completadas
                        const completadasBtn = document.querySelector('[onclick*="completadas"]');
                        if (completadasBtn) {
                            completadasBtn.click();
                        }
                    }, 100);
                    
                    // Remover el listener despu√©s de usarlo
                    modalElement.removeEventListener('hidden.bs.modal', handleModalClose);
                }, { once: true });
            }
            
            // Mostrar directamente el modal de detalles de evaluaci√≥n con los datos reci√©n completados
            setTimeout(() => {
                viewEvaluationDetails(evaluationId);
            }, 1000); // Aumentar el tiempo para asegurar que los datos se guardan completamente
        }

        // Helper function to format dimension names
        function formatDimensionName(dimension) {
            const dimensionNames = {
                'comunicacion': 'Comunicaci√≥n',
                'derechos': 'Defensa de Derechos',
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza',
                'opiniones': 'Expresi√≥n de Opiniones'
            };
            return dimensionNames[dimension] || dimension.charAt(0).toUpperCase() + dimension.slice(1);
        }

        // View detailed results immediately after completing assessment
        async function viewDetailedResults() {
            
            if (window.lastEvaluationId) {
                try {
                    // If we have the assessment data in memory, use it immediately
                    if (window.lastAssessmentData && window.lastAssessmentData.dimensional_scores) {
                        await viewEvaluationDetails(window.lastEvaluationId);
                    } else {
                        await viewEvaluationDetails(window.lastEvaluationId);
                    }
                } catch (error) {
                    console.error('Error in viewDetailedResults:', error);
                    showToast('Error al cargar los detalles de la evaluaci√≥n', 'error');
                }
            } else {
                console.error('No evaluation ID available');
                showToast('Error: No se encontr√≥ el ID de la evaluaci√≥n. Intenta refrescar la p√°gina.', 'error');
            }
        }

        // Finish assessment and return to dashboard
        async function finishAssessment() {
            // Reset assessment state
            isAssessmentActive = false;
            
            // Hide assessment tab from sidebar
            document.getElementById('assessment-sidebar-item').style.display = 'none';
            
            // Cerrar el modal de resultados si est√° abierto
            const resultsModal = bootstrap.Modal.getInstance(document.getElementById('assessmentResultsModal'));
            if (resultsModal) {
                resultsModal.hide();
            }
            
            // Cerrar el modal de detalles de evaluaci√≥n si est√° abierto
            const evaluationDetailsModal = bootstrap.Modal.getInstance(document.getElementById('evaluationDetailsModal'));
            if (evaluationDetailsModal) {
                evaluationDetailsModal.hide();
            }
            
            // Show assessment container
            document.getElementById('assessmentContainer').style.display = 'block';
            
            // Switch back to evaluaciones-figma tab and show Tipos Disponibles section
            showTab('evaluaciones-figma');
            
            // Asegurar que la sub-tab de Tipos Disponibles est√© seleccionada
            setTimeout(() => {
                // Cambiar el estado del Alpine component
                const alpineData = Alpine.$data(document.body);
                if (alpineData) {
                    alpineData.evaluationsSubTab = 'disponibles';
                }
                
                // Activar visualmente la sub-tab de Tipos Disponibles
                const disponiblesBtn = document.querySelector('[onclick*="disponibles"]');
                if (disponiblesBtn) {
                    disponiblesBtn.click();
                }
            }, 100);
            
            // FORZAR re-renderizado completo para regenerar event listeners
            window.__forceEvaluationsRender = true;
            
            // Refresh data to show updated evaluations WITH FORCE REFRESH
            await loadEvaluations(true); // Force refresh to update previous_attempts
            await refreshDashboard();
            
            showToast('Evaluaci√≥n finalizada. Los datos se han actualizado.', 'success');
        }
        
        // View evaluation details
        async function viewEvaluationDetails(evaluationId) {
            try {
                
                // Cargar detalles de la evaluaci√≥n PRIMERO
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-details/${evaluationId}`);
                const data = await response.json();
                
                
                if (response.ok) {
                    // La API devuelve {success: true, evaluation: {...}}
                    if (data.success && data.evaluation) {
                        renderEvaluationDetails(data.evaluation);
                        
                        // Mostrar el modal DESPU√âS de renderizar el contenido
                        const modalElement = document.getElementById('evaluationDetailsModal');
                        
                        const modal = new bootstrap.Modal(modalElement, {
                            backdrop: false,
                            keyboard: true,
                            focus: true
                        });
                        modal.show();
                        
                        // NO bloquear el scroll del body
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                        
                        // Asegurar que el modal se pueda cerrar
                        modalElement.addEventListener('hidden.bs.modal', function () {
                            document.body.style.overflow = '';
                            document.body.style.paddingRight = '';
                        }, { once: true });
                        
                        // Verificar que Bootstrap agreg√≥ las clases
                        setTimeout(() => {
                            const computedStyle = window.getComputedStyle(modalElement);
                            
                            // Verificar backdrop
                            const backdrop = document.querySelector('.modal-backdrop');
                            if (backdrop) {
                            } else {
                            }
                        }, 300);
                    } else {
                        throw new Error('Estructura de datos inesperada');
                    }
                } else {
                    throw new Error(data.error || 'Error desconocido');
                }
            } catch (error) {
                console.error('‚ùå Error cargando detalles de evaluaci√≥n:', error);
                document.getElementById('evaluationDetailsContent').innerHTML = 
                    '<div class="text-center text-danger"><i class="fas fa-exclamation-triangle"></i><p>Error cargando detalles de la evaluaci√≥n</p></div>';
                showToast('Error cargando detalles de la evaluaci√≥n: ' + error.message, 'error');
            }
        }

        function renderEvaluationDetails(evaluation) {
            
            // CR√çTICO: Verificar si estamos mostrando la evaluaci√≥n correcta
            if (window.lastCompletedAssessmentId && evaluation.assessment_id !== window.lastCompletedAssessmentId) {
                console.error('‚ö†Ô∏è WARNING: Mostrando evaluaci√≥n diferente a la completada!', {
                    completed: window.lastCompletedAssessmentId,
                    completedTitle: window.lastCompletedAssessmentTitle,
                    showing: evaluation.assessment_id,
                    showingTitle: evaluation.assessment_title
                });
            }
            
            // Guardar el ID de la evaluaci√≥n actual para uso en solicitudes
            window.currentEvaluationId = evaluation.id;
            
            const container = document.getElementById('evaluationDetailsContent');
            
            // Si tenemos datos de la evaluaci√≥n m√°s reciente (cuando se acaba de completar)
            const currentData = window.lastAssessmentData;
            const useCurrent = currentData && window.lastEvaluationId && 
                             window.lastEvaluationId === evaluation.id;
            
            
            const data = useCurrent ? currentData : evaluation;
            const dimensionalScores = useCurrent ? currentData.dimensional_scores : evaluation.dimensional_scores;
            const recommendations = evaluation.recommendations || []; // SIEMPRE usar datos del servidor para recomendaciones
            const detailedAnalysis = useCurrent ? currentData.detailed_analysis : evaluation.detailed_analysis;
            
            // Determinar el tipo de evaluaci√≥n y configurar t√≠tulos apropiados
            const assessmentTitle = (evaluation.assessment_title || data.assessment_title || 'Evaluaci√≥n').toLowerCase();
            const isDiscAssessment = assessmentTitle.includes('disc') || assessmentTitle.includes('personalidad');
            const isEmotionalIntelligenceAssessment = assessmentTitle.includes('inteligencia emocional') || assessmentTitle.includes('emocional');
            const isLeadershipAssessment = assessmentTitle.includes('liderazgo') || assessmentTitle.includes('l√≠der');
            const isTeamworkAssessment = assessmentTitle.includes('trabajo en equipo') || assessmentTitle.includes('equipo') || assessmentTitle.includes('colaboraci√≥n');
            const isGrowthPreparationAssessment = assessmentTitle.includes('preparaci√≥n para crecer') || assessmentTitle.includes('crecer 2026');
            const isAssertivenessAssessment = assessmentTitle.includes('asertividad');
            
            let analysisTitle, chartTitle;
            if (isDiscAssessment) {
                analysisTitle = 'An√°lisis Completo DISC de Personalidad';
                chartTitle = 'Radar de Dimensiones DISC';
            } else if (isEmotionalIntelligenceAssessment) {
                analysisTitle = 'An√°lisis Completo de Inteligencia Emocional';
                chartTitle = 'Radar de Competencias Emocionales';
            } else if (isLeadershipAssessment) {
                analysisTitle = 'An√°lisis Completo de Habilidades de Liderazgo';
                chartTitle = 'Radar de Competencias de Liderazgo';
            } else if (isTeamworkAssessment) {
                analysisTitle = 'An√°lisis Completo de Trabajo en Equipo';
                chartTitle = 'Radar de Competencias de Colaboraci√≥n';
            } else if (isGrowthPreparationAssessment) {
                analysisTitle = 'An√°lisis de Preparaci√≥n para Crecer 2026';
                chartTitle = 'Radar de Dimensiones Empresariales';
            } else if (isAssertivenessAssessment) {
                analysisTitle = 'An√°lisis Completo de Asertividad';
                chartTitle = 'Radar de Competencias de Asertividad';
            } else {
                // Generic fallback para evaluaciones personalizadas
                analysisTitle = `An√°lisis de ${evaluation.assessment_title || 'Evaluaci√≥n'}`;
                chartTitle = 'Radar de Competencias';
            }
            
            // Layout completamente diferente para "Preparaci√≥n para crecer 2026"
            if (isGrowthPreparationAssessment) {
                const html = generateGrowthPreparationLayout(data, evaluation, dimensionalScores);
                container.innerHTML = html;
                
                // FORZAR SCROLL AL INICIO DEL MODAL (especialmente importante en m√≥vil)
                const modalBody = document.querySelector('#evaluationDetailsModal .modal-body');
                if (modalBody) {
                    modalBody.scrollTop = 0;
                }
                
                // Crear el gr√°fico radar espec√≠fico para crecimiento
                setTimeout(() => {
                    createGrowthRadarChart(dimensionalScores);
                    
                    // ASEGURAR SCROLL AL INICIO despu√©s de crear gr√°fico tambi√©n
                    if (modalBody) {
                        modalBody.scrollTop = 0;
                    }
                }, 100);
                
                return;
            }
            
            // Calcular porcentaje correcto seg√∫n el tipo de evaluaci√≥n
            let displayPercentage;
            const rawScore = data.score || evaluation.score || 0;
            
            console.log('üîç RENDER-DETAILS: Calculating display percentage:', {
                rawScore,
                is_percentage_eval: evaluation.is_percentage,
                is_percentage_data: data.is_percentage,
                isDiscAssessment,
                isLeadershipAssessment,
                isTeamworkAssessment,
                isEmotionalIntelligenceAssessment
            });
            
            // üî• NUEVO: Si el score ya es porcentaje (desde AssessmentHistory), no convertir
            if (evaluation.is_percentage || data.is_percentage) {
                displayPercentage = Math.round(rawScore);
                console.log('‚úÖ Using raw score as percentage:', displayPercentage);
            } else if (isLeadershipAssessment) {
                // Liderazgo: score es suma (10-50), convertir a porcentaje
                displayPercentage = Math.round((rawScore / 50) * 100);
                console.log('üìä Leadership conversion:', displayPercentage);
            } else if (isTeamworkAssessment) {
                // Trabajo en Equipo: score es suma (12-60), convertir a porcentaje
                displayPercentage = Math.round((rawScore / 60) * 100);
                console.log('üìä Teamwork conversion:', displayPercentage);
            } else if (isDiscAssessment) {
                // DISC: score es suma (16-80), convertir a porcentaje
                displayPercentage = Math.round((rawScore / 80) * 100);
                console.log('üìä DISC conversion:', displayPercentage);
            } else if (isEmotionalIntelligenceAssessment) {
                // IE: score es suma (12-60), convertir a porcentaje
                displayPercentage = Math.round((rawScore / 60) * 100);
                console.log('üìä EI conversion:', displayPercentage);
            } else {
                // Asertividad y otras: score ya es porcentaje
                displayPercentage = Math.round(rawScore);
                console.log('‚úÖ Default: Using raw score as percentage:', displayPercentage);
            }
            
            const html = `
                <!-- Resumen General - Estilo Figma -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%); border: 3px solid #e9ecef !important; border-radius: 1.25rem; box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);">
                            <div class="card-body text-center" style="padding: 2rem;">
                                <h4 class="mb-4" style="color: #1e293b; font-weight: 700; font-size: 1.75rem;">
                                    <i class="fas fa-chart-line me-2" style="color: #a855f7;"></i>${analysisTitle}
                                </h4>
                                <div class="row g-4">
                                    <div class="col-md-3">
                                        <div style="background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%); padding: 1.5rem; border-radius: 1rem; box-shadow: 0 8px 16px -4px rgba(168, 85, 247, 0.4);">
                                            <div class="display-4 fw-bold text-white mb-2">${displayPercentage}%</div>
                                            <div class="text-white" style="font-size: 0.95rem; opacity: 0.95; font-weight: 500;">Puntuaci√≥n Total</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div style="background: linear-gradient(135deg, #10b981 0%, #34d399 100%); padding: 1.5rem; border-radius: 1rem; box-shadow: 0 8px 16px -4px rgba(16, 185, 129, 0.4);">
                                            <div class="h4 fw-bold text-white mb-2" style="font-size: 1.25rem;">${isDiscAssessment ? getDiscLevelFromScore(rawScore) : (isEmotionalIntelligenceAssessment ? getEmotionalIntelligenceLevelFromScore(rawScore) : (isLeadershipAssessment ? getLeadershipLevelFromScore(rawScore) : (isTeamworkAssessment ? getTeamworkLevelFromScore(rawScore) : (isGrowthPreparationAssessment ? getGrowthPreparationLevelFromScore(rawScore) : getAssertiveLevelFromScore(rawScore)))))}</div>
                                            <div class="text-white" style="font-size: 0.875rem; opacity: 0.95; font-weight: 500;">${isDiscAssessment ? 'Perfil DISC' : (isEmotionalIntelligenceAssessment ? 'Nivel IE' : (isLeadershipAssessment ? 'Nivel Liderazgo' : (isTeamworkAssessment ? 'Nivel Equipo' : (isGrowthPreparationAssessment ? 'Nivel Prep.' : 'Nivel Asertividad'))))}</div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div style="background: linear-gradient(135deg, #3b82f6 0%, #60a5fa 100%); padding: 1.5rem; border-radius: 1rem; box-shadow: 0 8px 16px -4px rgba(59, 130, 246, 0.4);">
                                            <div class="h6 fw-bold text-white mb-2" style="font-size: 1rem;">${formatDate(data.completed_at || evaluation.completed_at)}</div>
                                            <div class="text-white" style="font-size: 0.875rem; opacity: 0.95; font-weight: 500;">
                                                <i class="fas fa-calendar-check me-1"></i>Completado
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div style="background: linear-gradient(135deg, #f97316 0%, #fb923c 100%); padding: 1.5rem; border-radius: 1rem; box-shadow: 0 8px 16px -4px rgba(249, 115, 22, 0.4);">
                                            <div class="h6 fw-bold text-white mb-2" style="font-size: 1rem;">${data.total_questions || evaluation.total_questions || (evaluation.responses ? evaluation.responses.length : 'N/A')}</div>
                                            <div class="text-white" style="font-size: 0.875rem; opacity: 0.95; font-weight: 500;">
                                                <i class="fas fa-question-circle me-1"></i>Preguntas
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${generateAssertivenessSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}
                ${generateDiscSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}
                ${generateEmotionalIntelligenceSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}
                ${generateTeamworkSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}

                ${(isDiscAssessment || isEmotionalIntelligenceAssessment || isTeamworkAssessment || (!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && !isGrowthPreparationAssessment)) ? `
                <!-- Secci√≥n de Contacto con Coach - Estilo Figma -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 1.25rem; box-shadow: 0 20px 25px -5px rgba(16, 185, 129, 0.3), 0 8px 10px -6px rgba(16, 185, 129, 0.2); overflow: hidden; position: relative;">
                            <div style="position: absolute; top: 0; right: 0; width: 200px; height: 200px; background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%); border-radius: 50%; transform: translate(30%, -30%);"></div>
                            <div class="card-body text-white" style="padding: 2rem; position: relative; z-index: 1;">
                                <div class="row align-items-center">
                                    <div class="col-lg-8">
                                        <div class="d-flex align-items-center mb-3">
                                            <div style="width: 60px; height: 60px; background: rgba(255, 255, 255, 0.2); border-radius: 1rem; display: flex; align-items: center; justify-content: center; margin-right: 1rem; backdrop-filter: blur(10px);">
                                                <i class="fas fa-user-graduate" style="font-size: 1.75rem;"></i>
                                            </div>
                                            <h4 class="mb-0 fw-bold" style="font-size: 1.75rem;">¬°Desarrolla tu Potencial!</h4>
                                        </div>
                                        <p class="mb-3" style="font-size: 1.05rem; line-height: 1.7; opacity: 0.95;">
                                            ${isDiscAssessment ? 
                                                'Descubre c√≥mo potenciar tu perfil de personalidad DISC con el apoyo de un coach especializado en desarrollo personal y profesional.' :
                                                isEmotionalIntelligenceAssessment ?
                                                'Potencia tu inteligencia emocional con el acompa√±amiento de un coach especializado en competencias emocionales y liderazgo.' :
                                                isLeadershipAssessment ?
                                                'Desarrolla tus habilidades de liderazgo con el acompa√±amiento de un coach especializado en desarrollo de l√≠deres y gesti√≥n de equipos.' :
                                                isTeamworkAssessment ?
                                                'Fortalece tus habilidades de trabajo en equipo con el apoyo de un coach especializado en colaboraci√≥n y liderazgo de equipos.' :
                                                'Puedes desarrollar y fortalecer tus habilidades de asertividad con el apoyo personalizado de un coach profesional.'
                                            }
                                            Nuestros expertos te ayudar√°n a crear un plan de desarrollo espec√≠fico para tus necesidades.
                                        </p>
                                        <div class="d-flex align-items-center" style="background: rgba(255, 255, 255, 0.15); padding: 0.75rem 1rem; border-radius: 0.75rem; backdrop-filter: blur(10px);">
                                            <i class="fas fa-gift me-2" style="font-size: 1.25rem;"></i>
                                            <strong style="font-size: 1.05rem;">Sesi√≥n gratuita de 30 minutos disponible</strong>
                                        </div>
                                    </div>
                                    <div class="col-lg-4 text-center mt-4 mt-lg-0">
                                        <button class="btn btn-light btn-lg w-100 mb-3" onclick="contactCoachForSession(event)" style="font-weight: 600; padding: 0.875rem 1.5rem; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); border: none; transition: all 0.2s;"
                                                onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1)'"
                                                onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)'">
                                            <i class="fas fa-calendar-plus me-2" style="color: #10b981;"></i>
                                            <span style="color: #1e293b;">Contactar Coach</span>
                                        </button>
                                        <div style="background: rgba(255, 255, 255, 0.15); padding: 0.625rem; border-radius: 0.5rem; backdrop-filter: blur(10px);">
                                            <i class="fas fa-clock me-1"></i>30 minutos ‚Ä¢ <i class="fas fa-gift me-1"></i>100% Gratis
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Gr√°fico Radar y An√°lisis Dimensional -->
                <div class="row mb-4">
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-radar me-2"></i>${chartTitle}</h5>
                            </div>
                            <div class="card-body">
                                <div class="radar-chart-container" style="position: relative; height: 300px;">
                                    <canvas id="radarChart" width="300" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-bar me-2"></i>Puntuaciones por Dimensi√≥n</h5>
                            </div>
                            <div class="card-body">
                                <div id="dimensionalScoresContainer">
                                    ${generateDimensionalScoresHTML(dimensionalScores)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                ${(!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && !isLeadershipAssessment && isGrowthPreparationAssessment) ? 
                    generateDetailedAnalysisHTML(detailedAnalysis || generateAnalysisFromScores(dimensionalScores)) : ''}
                
                ${(!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && !isLeadershipAssessment && isGrowthPreparationAssessment) ? `
                <!-- Respuestas Detalladas -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-list me-2"></i>Respuestas Detalladas</h5>
                            </div>
                            <div class="card-body">
                                ${generateResponsesHTML(evaluation.responses || [], evaluation.assessment_id || data.assessment_id)}
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Botones de Acci√≥n -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-end gap-3">
                            <button type="button" class="btn btn-outline-secondary btn-modal-action" data-bs-dismiss="modal">
                                <i class="fas fa-times"></i>
                                <span>Cerrar</span>
                            </button>
                            <button type="button" class="btn btn-success btn-modal-action" onclick="requestDevelopmentPlan()" id="requestPlanBtn">
                                <i class="fas fa-user-tie"></i>
                                <span class="btn-text-full">Solicitar Plan</span>
                                <span class="btn-text-short d-none">Plan</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            
            // FORZAR SCROLL AL INICIO DEL MODAL (especialmente importante en m√≥vil)
            // Hacer scroll al tope del modal-body inmediatamente
            const modalBody = document.querySelector('#evaluationDetailsModal .modal-body');
            if (modalBody) {
                modalBody.scrollTop = 0;
            }
            
            // Crear el gr√°fico radar despu√©s de insertar el HTML
            setTimeout(() => {
                createRadarChart(dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isLeadershipAssessment, isTeamworkAssessment);
                
                // ASEGURAR SCROLL AL INICIO despu√©s de crear gr√°fico tambi√©n
                if (modalBody) {
                    modalBody.scrollTop = 0;
                }
            }, 100);
        }

        function generateDimensionalScoresHTML(dimensionalScores) {
            if (!dimensionalScores) return '<p style="color: #666;">No hay datos dimensionales disponibles.</p>';
            
            let html = '';
            for (const [dimension, score] of Object.entries(dimensionalScores)) {
                const dimensionName = formatDimensionName(dimension);
                const percentage = Math.round(score);
                let colorClass = 'danger';
                if (percentage >= 70) colorClass = 'success';
                else if (percentage >= 50) colorClass = 'warning';
                
                html += `
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <strong style="color: #333;">${dimensionName}</strong>
                            <span class="badge bg-${colorClass}">${percentage}%</span>
                        </div>
                        <div class="progress" style="height: 10px; background: #e9ecef;">
                            <div class="progress-bar bg-${colorClass}" style="width: ${percentage}%"></div>
                        </div>
                        <small style="color: #666;">${getDimensionDescription(dimension, percentage)}</small>
                    </div>
                `;
            }
            return html;
        }

        function generateAnalysisFromScores(dimensionalScores) {
            if (!dimensionalScores) return null;
            
            const strengths = [];
            const improvementAreas = [];
            
            // Analizar cada dimensi√≥n
            for (const [dimension, score] of Object.entries(dimensionalScores)) {
                const percentage = Math.round(score);
                const dimensionName = formatDimensionName(dimension);
                
                if (percentage >= 70) {
                    // Es una fortaleza
                    strengths.push({
                        name: dimensionName,
                        score: percentage,
                        description: getDimensionDescription(dimension, percentage)
                    });
                } else if (percentage < 60) {
                    // Es un √°rea de mejora
                    const priority = percentage < 40 ? 'high' : 'medium';
                    improvementAreas.push({
                        name: dimensionName,
                        score: percentage,
                        description: getDimensionDescription(dimension, percentage),
                        priority: priority
                    });
                }
            }
            
            return {
                strengths: strengths,
                improvement_areas: improvementAreas
            };
        }

        function generateDetailedAnalysisHTML(analysis) {
            let html = '<div class="row mb-4">';
            
            // Fortalezas
            if (analysis.strengths && analysis.strengths.length > 0) {
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #28a745 !important;">
                            <div class="card-header" style="background: #d4edda; color: #155724;">
                                <h6 class="mb-0"><i class="fas fa-star me-2"></i>Fortalezas Identificadas</h6>
                            </div>
                            <div class="card-body">
                `;
                
                analysis.strengths.forEach(strength => {
                    html += `
                        <div class="d-flex align-items-start mb-3">
                            <div class="flex-shrink-0">
                                <span class="badge bg-success rounded-pill">${Math.round(strength.score)}%</span>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                <strong style="color: #333;">${strength.name}</strong>
                                <p class="mb-0 small" style="color: #666;">${strength.description}</p>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // √Åreas de mejora
            if (analysis.improvement_areas && analysis.improvement_areas.length > 0) {
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #ffc107 !important;">
                            <div class="card-header" style="background: #fff3cd; color: #856404;">
                                <h6 class="mb-0"><i class="fas fa-target me-2"></i>√Åreas de Mejora</h6>
                            </div>
                            <div class="card-body">
                `;
                
                analysis.improvement_areas.forEach(area => {
                    const priorityClass = area.priority === 'high' ? 'danger' : 'warning';
                    html += `
                        <div class="d-flex align-items-start mb-3">
                            <div class="flex-shrink-0">
                                <span class="badge bg-${priorityClass} rounded-pill">${Math.round(area.score)}%</span>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                <strong style="color: #333;">${area.name}</strong> 
                                <span class="badge bg-${priorityClass} ms-1">${area.priority}</span>
                                <p class="mb-0 small" style="color: #666;">${area.description}</p>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        // Funci√≥n compacta para mostrar recomendaciones de forma simplificada
        function generateCompactRecommendationsHTML(recommendations) {
            if (!recommendations || recommendations.length === 0) return '';
            
            let html = `
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #007bff !important;">
                            <div class="card-header d-flex align-items-center justify-content-between" style="background: #cce7ff; color: #004085;">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <h6 class="mb-0">Plan de Desarrollo</h6>
                                </div>
                                <span class="badge bg-primary">${recommendations.length} items</span>
                            </div>
                            <div class="card-body">
            `;
            
            recommendations.forEach((rec, index) => {
                const recText = typeof rec === 'string' ? rec : rec.text || rec.description || '';
                if (recText.trim()) {
                    // Detectar si es un encabezado (contiene **)
                    if (recText.includes('**')) {
                        const cleanText = recText.replace(/\*\*/g, '');
                        if (cleanText.includes('üéØ') || cleanText.includes('üöÄ')) {
                            html += `<div class="fw-bold text-primary mb-2 mt-3">${cleanText}</div>`;
                        } else {
                            html += `<div class="fw-bold text-dark mb-2">${cleanText}</div>`;
                        }
                    }
                    // Detectar si es una acci√≥n (empieza con ‚úì o ‚Ä¢)
                    else if (recText.startsWith('‚úì') || recText.startsWith('‚Ä¢')) {
                        html += `<div class="ms-3 mb-2"><span class="text-success fw-bold">${recText}</span></div>`;
                    }
                    // Texto normal no vac√≠o
                    else if (recText.trim() !== '') {
                        html += `<div class="mb-1"><small>${recText}</small></div>`;
                    }
                }
            });
            
            html += `
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return html;
        }
















        // Generar HTML de respuestas
        function generateResponsesHTML(responses, assessmentId = null) {
            if (!responses || responses.length === 0) {
                return '<p class="text-muted">No hay respuestas detalladas disponibles.</p>';
            }
            
            // Usar funci√≥n espec√≠fica para evaluaci√≥n "Preparaci√≥n para crecer 2026"
            if (assessmentId === 6) {
                return generateGrowthPreparationResponsesHTML(responses);
            }
            
            // L√≥gica original para otras evaluaciones (sin modificar)
            let optionLabels, maxScore;
            
            // Etiquetas est√°ndar para escala Likert de 5 puntos (evaluaciones originales)
            optionLabels = {
                1: 'Totalmente en desacuerdo',
                2: 'En desacuerdo', 
                3: 'Neutral',
                4: 'De acuerdo',
                5: 'Totalmente de acuerdo'
            };
            maxScore = 5;
            
            let html = '';
            responses.forEach((response, index) => {
                const selectedOption = response.selected_option || response.points || 0;
                const scoreClass = selectedOption >= 4 ? 'success' : 
                                  selectedOption === 3 ? 'warning' : 'danger';
                
                html += `
                    <div class="border-start border-3 border-primary ps-3 mb-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <strong>Pregunta ${index + 1}:</strong>
                                <p class="mb-1">${response.question_text}</p>
                                <small class="text-${scoreClass}">
                                    <i class="fas fa-check-circle me-1"></i>
                                    ${optionLabels[selectedOption] || response.answer_text || 'N/A'}
                                </small>
                            </div>
                            <span class="badge bg-${scoreClass} ms-2">${selectedOption}/${maxScore}</span>
                        </div>
                    </div>
                `;
            });
            return html;
        }
        
        function getCategoryType(title) {
            if (title.includes('Fortaleza') || title.includes('Excelente')) return 'strength';
            if (title.includes('General') || title.includes('Recomendaci√≥n')) return 'general';
            if (title.includes('Recuerda') || title.includes('Final')) return 'final';
            return 'dimension';
        }
        
        function getCategoryIcon(title) {
            if (title.includes('Comunicaci√≥n')) return 'fas fa-comments';
            if (title.includes('Derechos')) return 'fas fa-shield-alt';
            if (title.includes('Opiniones')) return 'fas fa-bullhorn';
            if (title.includes('Conflictos')) return 'fas fa-handshake';
            if (title.includes('Autoconfianza')) return 'fas fa-user-check';
            if (title.includes('Fortaleza')) return 'fas fa-star';
            if (title.includes('General')) return 'fas fa-clipboard-list';
            if (title.includes('Recuerda')) return 'fas fa-heart';
            return 'fas fa-lightbulb';
        }
        
        function getDimensionIcon(dimension) {
            const iconMap = {
                'comunicacion': 'fas fa-comments',
                'derechos': 'fas fa-shield-alt',
                'opiniones': 'fas fa-bullhorn',
                'conflictos': 'fas fa-handshake',
                'autoconfianza': 'fas fa-user-check',
                'general': 'fas fa-clipboard-list'
            };
            return iconMap[dimension] || 'fas fa-lightbulb';
        }
        
        function getCategoryClass(type, title) {
            if (title.includes('Fortaleza') || type === 'strength') return 'strengths-category';
            if (title.includes('General') || type === 'general') return 'general-recommendations';
            if (title.includes('Recuerda') || type === 'final') return 'final-message';
            return '';
        }
        
        function getPriorityIndicator(priority) {
            const priorityClass = `priority-${priority}`;
            return `<div class="priority-indicator ${priorityClass}"></div>`;
        }
        
        function extractScoreFromTitle(title) {
            const scoreMatch = title.match(/(\d+(?:\.\d+)?)%/);
            return scoreMatch ? parseFloat(scoreMatch[1]) : null;
        }

        // ========== FUNCIONES ESPEC√çFICAS PARA EVALUACI√ìN "PREPARACI√ìN PARA CRECER 2026" ==========
        // CACHE BUSTER: 2025-10-12-17:35:00
        
        function getGrowthPreparationOptions(question) {
            
            // Opciones espec√≠ficas por dimensi√≥n para la evaluaci√≥n de crecimiento
            const growthOptionsByDimension = {
                'Delegaci√≥n': ['Todo depende de m√≠', 'Delego algo, pero sigo resolviendo mucho', 'Mi equipo opera sin m√≠'],
                'Estructura organizacional': ['Todo es improvisado', 'Algunas √°reas tienen estructura', 'Todo est√° formalizado'],
                'Gesti√≥n del tiempo del due√±o': ['> 8 h', '4‚Äì7 h', '< 4 h (m√°s foco en estrategia)'],
                'Finanzas': ['No conf√≠o / errores frecuentes', 'Parcialmente actualizada', 'Confiable y oportuna'],
                'Crecimiento estrat√©gico': ['Miedo de perder control', 'Quiero crecer pero no s√© c√≥mo', 'Preparado con estrategia'],
                'Bienestar personal': ['Agotado', 'Cansado pero motivado', 'Con energ√≠a y foco'],
                'Visi√≥n a futuro': ['Frustrado', 'Inquieto pero optimista', 'Orgulloso']
            };
            
            
            // Probar tambi√©n con trim por si hay espacios
            const cleanDimension = question?.dimension?.trim();
            
            const options = growthOptionsByDimension[question?.dimension] || growthOptionsByDimension[cleanDimension] || ['Opci√≥n 1', 'Opci√≥n 2', 'Opci√≥n 3'];
            return options;
        }
        
        function generateGrowthPreparationResponsesHTML(responses) {
            
            if (!responses || responses.length === 0) {
                return '<div class="alert alert-warning">No hay respuestas detalladas disponibles.</div>';
            }

            // Mapeo de question_id a dimensi√≥n para "Preparaci√≥n para crecer 2026"
            const questionIdToDimension = {
                71: "Delegaci√≥n",
                72: "Estructura organizacional", 
                73: "Gesti√≥n del tiempo del due√±o",
                74: "Finanzas",
                75: "Crecimiento estrat√©gico",
                76: "Bienestar personal",
                77: "Visi√≥n a futuro"
            };
            
            // Opciones espec√≠ficas por dimensi√≥n
            const growthLabelsByDimension = {
                'Delegaci√≥n': {1: 'Todo depende de m√≠', 2: 'Delego algo, pero sigo resolviendo mucho', 3: 'Mi equipo opera sin m√≠'},
                'Estructura organizacional': {1: 'Todo es improvisado', 2: 'Algunas √°reas tienen estructura', 3: 'Todo est√° formalizado'},
                'Gesti√≥n del tiempo del due√±o': {1: '> 8 h', 2: '4‚Äì7 h', 3: '< 4 h (m√°s foco en estrategia)'},
                'Finanzas': {1: 'No conf√≠o / errores frecuentes', 2: 'Parcialmente actualizada', 3: 'Confiable y oportuna'},
                'Crecimiento estrat√©gico': {1: 'Miedo de perder control', 2: 'Quiero crecer pero no s√© c√≥mo', 3: 'Preparado con estrategia'},
                'Bienestar personal': {1: 'Agotado', 2: 'Cansado pero motivado', 3: 'Con energ√≠a y foco'},
                'Visi√≥n a futuro': {1: 'Frustrado', 2: 'Inquieto pero optimista', 3: 'Orgulloso'}
            };
            
            let html = '';
            responses.forEach((response, index) => {
                // Obtener la dimensi√≥n desde el mapeo usando question_id
                const dimension = questionIdToDimension[response.question_id] || response.dimension || 'Dimensi√≥n desconocida';
                const dimensionLabels = growthLabelsByDimension[dimension] || {1: 'Opci√≥n 1', 2: 'Opci√≥n 2', 3: 'Opci√≥n 3'};
                const selectedOption = response.selected_option || response.points || 1;
                const optionText = dimensionLabels[selectedOption] || 'N/A';
                
                const scoreClass = selectedOption === 3 ? 'success' : 
                                  selectedOption === 2 ? 'warning' : 'danger';
                
                html += `
                    <div class="border-start border-3 border-primary ps-3 mb-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <strong>${dimension}:</strong>
                                <p class="mb-1">${response.question_text}</p>
                                <small class="text-${scoreClass}">
                                    <i class="fas fa-check-circle me-1"></i>
                                    ${optionText}
                                </small>
                            </div>
                            <span class="badge bg-${scoreClass} ms-2">${selectedOption}/3</span>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        function getGrowthPreparationLevelFromScore(score) {
            // Sistema de sem√°foro basado en porcentajes espec√≠ficos
            if (score <= 30) {
                return "Alta dependencia (Rojo)";
            } else if (score <= 70) {
                return "En progreso (Amarillo)";
            } else {
                return "Preparado (Verde)";
            }
        }
        
        function generateGrowthPreparationLayout(data, evaluation, dimensionalScores) {
            const score = Math.round(data.score || evaluation.score);
            const resultText = data.result_text || evaluation.result_text || '';
            
            // Determinar el resultado basado en el puntaje
            let resultLevel, resultColor, resultIcon, respuestasC;
            if (score <= 30) {
                resultLevel = "Alta dependencia (Rojo)";
                resultColor = "#dc3545";
                resultIcon = "fas fa-exclamation-triangle";
                respuestasC = "0-2";
            } else if (score <= 70) {
                resultLevel = "En progreso (Amarillo)";
                resultColor = "#ffc107";
                resultIcon = "fas fa-clock";
                respuestasC = "3-4";
            } else {
                resultLevel = "Preparado (Verde)";
                resultColor = "#28a745";
                resultIcon = "fas fa-check-circle";
                respuestasC = "5-7";
            }
            
            return `
                <!-- Tu resultado destacado -->
                <div class="tu-resultado mb-4 p-4" style="background: ${resultColor} !important; color: white !important; border-radius: 15px; text-align: center; box-shadow: 0 6px 12px rgba(0,0,0,0.1);">
                    <h4 style="color: white !important; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5) !important;">
                        <i class="${resultIcon} me-2" style="color: white !important;"></i>
                        <span style="color: white !important; text-shadow: 2px 2px 4px rgba(0,0,0,0.5) !important;">${resultLevel}</span>
                    </h4>
                    <p style="margin: 0; font-size: 1.2em; line-height: 1.5; font-weight: 500; color: white !important;">
                        ${resultText.split(':')[1] ? resultText.split(':')[1].trim().split('\\n\\n')[0] : resultText.split('\\n\\n')[0]}
                    </p>
                </div>

                <!-- CTA Momento Clave -->
                <div class="cta-final mb-4">
                    <div class="card" style="background: #f8f9fa; border: none; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div class="card-body text-center" style="padding: 30px;">
                            <h4 style="color: #333; margin-bottom: 20px;">
                                <i class="fas fa-gift me-2" style="color: #4facfe;"></i>
                                Momento Clave para Tu Crecimiento
                            </h4>
                            <p style="color: #333; font-size: 1.1em; line-height: 1.6; margin-bottom: 25px; font-weight: 500;">
                                ‚ú® "Tu resultado muestra que este es el momento clave para ti. Por eso quiero regalarte una sesi√≥n gratuita de 30 min, donde veremos c√≥mo preparar tu negocio en este √∫ltimo trimestre y que el 2026 sea el a√±o en que veas realizados tus sue√±os de crecimiento."
                            </p>
                            
                            <!-- Dropdown para opciones de contacto -->
                            <div class="dropdown">
                                <button class="btn btn-light btn-lg dropdown-toggle" type="button" id="contactDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="padding: 12px 30px; border-radius: 25px; font-weight: bold; color: #333;">
                                    <i class="fas fa-calendar-plus me-2"></i>
                                    Agendar Sesi√≥n Gratuita
                                </button>
                                <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="contactDropdown" style="border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); min-width: 280px;">
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center py-3" href="https://wa.me/56994896670?text=Hola%2C%20me%20gustar%C3%ADa%20agendar%20una%20sesi%C3%B3n%20gratuita%20de%2030%20min%20para%20preparar%20mi%20negocio%20para%20el%202026" target="_blank" style="border-radius: 10px; margin: 5px;">
                                            <i class="fab fa-whatsapp me-3" style="color: #25D366; font-size: 1.2em;"></i>
                                            <div>
                                                <strong>WhatsApp</strong>
                                                <br><small class="text-muted">+56 9 9489 6670</small>
                                            </div>
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center py-3" href="mailto:coach@assessment.com?subject=Sesi√≥n%20Gratuita%20-%20Preparaci√≥n%202026&body=Hola%2C%0A%0AMe%20gustar%C3%ADa%20agendar%20una%20sesi%C3%B3n%20gratuita%20de%2030%20minutos%20para%20preparar%20mi%20negocio%20para%20el%202026.%0A%0AGracias." style="border-radius: 10px; margin: 5px;">
                                            <i class="fas fa-envelope me-3" style="color: #0ea5e9; font-size: 1.2em;"></i>
                                            <div>
                                                <strong>Email</strong>
                                                <br><small class="text-muted">Enviar correo al coach</small>
                                            </div>
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center py-3" href="tel:+56994896670" style="border-radius: 10px; margin: 5px;">
                                            <i class="fas fa-phone me-3" style="color: #10b981; font-size: 1.2em;"></i>
                                            <div>
                                                <strong>Llamada</strong>
                                                <br><small class="text-muted">+56 9 9489 6670</small>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- An√°lisis por Dimensiones -->
                <div class="row mb-4">
                    <div class="col-lg-6">
                        <div class="card h-100" style="border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div class="card-header" style="background: #667eea; color: white;">
                                <h5 style="margin: 0; color: white;">
                                    <i class="fas fa-chart-radar me-2"></i>
                                    Radar de Dimensiones Empresariales
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="radar-chart-container" style="position: relative; height: 300px;">
                                    <canvas id="growthRadarChart" style="max-width: 100%; height: auto;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card h-100" style="border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div class="card-header" style="background: #764ba2; color: white;">
                                <h5 style="margin: 0; color: white;">
                                    <i class="fas fa-tasks me-2"></i>
                                    Puntuaci√≥n por Dimensi√≥n
                                </h5>
                            </div>
                            <div class="card-body">
                                ${generateGrowthDimensionalScores(dimensionalScores)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateGrowthDimensionalScores(dimensionalScores) {
            if (!dimensionalScores) return '<p class="text-muted">No hay puntuaciones dimensionales disponibles.</p>';
            
            let html = '';
            Object.entries(dimensionalScores).forEach(([dimension, score]) => {
                // Calcular porcentaje correcto: (score - 1) / (3 - 1) * 100 = (score - 1) / 2 * 100
                const percentage = Math.round(((score - 1) / 2) * 100);
                let scoreColor, scoreIcon, scoreBadge;
                
                if (score >= 2.5) {
                    scoreColor = '#28a745';
                    scoreIcon = 'fas fa-check-circle';
                    scoreBadge = 'Verde';
                } else if (score >= 1.5) {
                    scoreColor = '#ffc107';
                    scoreIcon = 'fas fa-clock';
                    scoreBadge = 'Amarillo';
                } else {
                    scoreColor = '#dc3545';
                    scoreIcon = 'fas fa-exclamation-triangle';
                    scoreBadge = 'Rojo';
                }
                
                html += `
                    <div class="dimension-score mb-4" style="padding: 15px; border-left: 4px solid ${scoreColor}; background: #f8f9fa; border-radius: 0 8px 8px 0;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <strong style="color: #333; font-size: 1.05em;">${dimension}</strong>
                            <div class="d-flex align-items-center">
                                <span class="badge me-2" style="background: ${scoreColor}; color: white; padding: 4px 8px; border-radius: 12px;">
                                    ${scoreBadge}
                                </span>
                                <span style="color: ${scoreColor}; font-weight: bold;">
                                    <i class="${scoreIcon} me-1"></i>
                                    ${score}/3
                                </span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="progress flex-grow-1 me-3" style="height: 15px; background: #e9ecef; border-radius: 8px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);">
                                <div class="progress-bar" style="background: linear-gradient(90deg, ${scoreColor}, ${scoreColor}cc) !important; width: ${percentage}%; border-radius: 8px; transition: width 0.8s ease;">
                                </div>
                            </div>
                            <small style="color: #666; font-weight: 600; min-width: 40px; font-size: 0.9em;">${percentage}%</small>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        function createGrowthRadarChart(dimensionalScores) {
            if (!dimensionalScores) return;
            
            const canvas = document.getElementById('growthRadarChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Obtener dimensiones de la pantalla para optimizar visualizaci√≥n
            const isMobile = window.innerWidth <= 768;
            const isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
            
            // Mapear nombres largos a versiones m√°s cortas para m√≥viles
            const dimensionLabels = Object.keys(dimensionalScores).map(key => {
                const shortLabels = {
                    'Delegaci√≥n': isMobile ? 'Delegaci√≥n' : 'Delegaci√≥n',
                    'Estructura organizacional': isMobile ? 'Estructura' : isTablet ? 'Estructura Org.' : 'Estructura organizacional',
                    'Gesti√≥n del tiempo del due√±o': isMobile ? 'Tiempo' : isTablet ? 'Gesti√≥n Tiempo' : 'Gesti√≥n del tiempo del due√±o',
                    'Finanzas': 'Finanzas',
                    'Crecimiento estrat√©gico': isMobile ? 'Estrategia' : isTablet ? 'Crecimiento' : 'Crecimiento estrat√©gico',
                    'Bienestar personal': isMobile ? 'Bienestar' : 'Bienestar personal',
                    'Visi√≥n a futuro': isMobile ? 'Visi√≥n' : 'Visi√≥n a futuro'
                };
                return shortLabels[key] || key;
            });
            
            const values = Object.values(dimensionalScores);
            
            if (window.growthRadarChartInstance) {
                window.growthRadarChartInstance.destroy();
            }
            
            window.growthRadarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: dimensionLabels,
                    datasets: [{
                        label: 'Preparaci√≥n para Crecer',
                        data: values,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: isMobile ? 20 : 10,
                            bottom: isMobile ? 20 : 10,
                            left: isMobile ? 10 : 5,
                            right: isMobile ? 10 : 5
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 3,
                            min: 0,
                            ticks: {
                                stepSize: 1,
                                color: '#666',
                                font: {
                                    size: isMobile ? 10 : 12
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            angleLines: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            pointLabels: {
                                font: {
                                    size: isMobile ? 11 : isTablet ? 12 : 14,
                                    weight: 'bold'
                                },
                                color: '#333',
                                padding: isMobile ? 15 : 10
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    // Mostrar el nombre completo en el tooltip
                                    const index = tooltipItems[0].dataIndex;
                                    const fullNames = Object.keys(dimensionalScores);
                                    return fullNames[index];
                                }
                            }
                        }
                    }
                }
            });
            
            // Agregar estilos CSS b√°sicos para barras de progreso y radar responsive
            if (!document.getElementById('growth-progress-styles')) {
                const style = document.createElement('style');
                style.id = 'growth-progress-styles';
                style.innerHTML = `
                    .dimension-score .progress-bar {
                        border-radius: 8px;
                    }
                    
                    /* Estilos responsive para el radar de crecimiento */
                    .radar-chart-container {
                        overflow: hidden;
                    }
                    
                    @media (max-width: 768px) {
                        .radar-chart-container {
                            height: 280px !important;
                            padding: 10px;
                        }
                        
                        #growthRadarChart {
                            max-height: 260px;
                        }
                    }
                    
                    @media (max-width: 480px) {
                        .radar-chart-container {
                            height: 250px !important;
                            padding: 5px;
                        }
                        
                        #growthRadarChart {
                            max-height: 230px;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Agregar listener para redimensionamiento de pantalla
            if (!window.growthRadarResizeListener) {
                window.growthRadarResizeListener = function() {
                    if (window.growthRadarChartInstance && dimensionalScores) {
                        // Recrear el gr√°fico con las nuevas dimensiones
                        setTimeout(() => {
                            createGrowthRadarChart(dimensionalScores);
                        }, 100);
                    }
                };
                window.addEventListener('resize', window.growthRadarResizeListener);
            }
        }
        
        // ========== FIN FUNCIONES ESPEC√çFICAS PREPARACI√ìN PARA CRECER 2026 ==========

        function getAssertiveLevelFromScore(score) {
            if (score >= 85) return 'Muy Asertivo';
            if (score >= 70) return 'Asertivo';
            if (score >= 50) return 'Moderadamente Asertivo';
            return 'Poco Asertivo';
        }

        function getDiscLevelFromScore(score) {
            // Para DISC, el perfil se basa en las dimensiones dominantes
            // Aqu√≠ usamos un enfoque simplificado basado en el score general
            if (score >= 80) return 'Perfil Altamente Definido';
            if (score >= 60) return 'Perfil Moderadamente Definido';
            if (score >= 40) return 'Perfil Equilibrado';
            return 'Perfil en Desarrollo';
        }

        function getEmotionalIntelligenceLevelFromScore(score) {
            if (score >= 85) return 'Muy Alta';
            if (score >= 70) return 'Alta';
            if (score >= 55) return 'Moderada';
            if (score >= 40) return 'Baja';
            return 'Muy Baja';
        }

        function getTeamworkLevelFromScore(score) {
            if (score >= 85) return 'Colaborador Excepcional';
            if (score >= 70) return 'Colaborador Efectivo';
            if (score >= 55) return 'Colaborador Competente';
            if (score >= 40) return 'Colaborador en Desarrollo';
            return 'Necesita Desarrollar Habilidades';
        }

        function getLeadershipLevelFromScore(score) {
            if (score >= 40) return 'Liderazgo consolidado';
            if (score >= 30) return 'Liderazgo competente';
            if (score >= 20) return 'Liderazgo en desarrollo';
            return 'Liderazgo inicial';
        }

        function getDimensionDescription(dimension, score) {
            const descriptions = {
                'comunicacion': score >= 70 ? 'Excelente comunicaci√≥n interpersonal' : 'Oportunidad de mejorar la comunicaci√≥n',
                'derechos': score >= 70 ? 'Sabe defender sus derechos apropiadamente' : 'Necesita fortalecer la defensa de derechos',
                'opiniones': score >= 70 ? 'Expresa opiniones con confianza' : 'Puede mejorar la expresi√≥n de opiniones',
                'conflictos': score >= 70 ? 'Maneja conflictos efectivamente' : 'Requiere desarrollo en manejo de conflictos',
                'autoconfianza': score >= 70 ? 'Alta confianza en s√≠ mismo/a' : 'Oportunidad de fortalecer autoconfianza'
            };
            return descriptions[dimension] || '√Årea de desarrollo personal';
        }

        function formatDate(dateString) {
            try {
                // Crear fecha asumiendo que viene en UTC desde el backend
                const date = new Date(dateString + (dateString.includes('Z') ? '' : 'Z'));
                
                // Convertir a zona horaria de Santiago de Chile con formato compacto
                return date.toLocaleDateString('es-CL', {
                    timeZone: 'America/Santiago',
                    day: '2-digit',
                    month: '2-digit',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                }).replace(',', '');
            } catch (e) {
                return dateString;
            }
        }

        // Refresh dashboard
        async function refreshDashboard() {
            try {
                await Promise.all([
                    loadDashboardSummary(),
                    loadEvaluations(),
                    loadTasks(),
                    loadPendingEvaluations()
                    // Nota: loadContent() se carga solo cuando se activa la pesta√±a de contenido
                ]);
                
            } catch (error) {
                console.error('Error actualizando dashboard:', error);
                showToast('Error actualizando dashboard', 'error');
            }
        }

        // Variable global para almacenar el gr√°fico radar
        let radarChart = null;

        function createRadarChart(dimensionalScores, isDiscAssessment = false, isEmotionalIntelligenceAssessment = false, isLeadershipAssessment = false, isTeamworkAssessment = false) {

            const ctx = document.getElementById('radarChart');
            if (!ctx) {
                console.error('‚ùå RADAR ERROR: Canvas element with id "radarChart" not found');
                return;
            }
            
            if (!dimensionalScores) {
                console.error('‚ùå RADAR ERROR: dimensionalScores is null or undefined');
                return;
            }


            // Destruir gr√°fico existente si existe
            if (radarChart) {
                radarChart.destroy();
            }

            // Configurar dimensiones y datos seg√∫n el tipo de evaluaci√≥n
            let labels, dataValues, chartLabel;
            
            if (isDiscAssessment) {
                // Dimensiones DISC
                labels = [
                    'Dominante',
                    'Influyente', 
                    'Estable',
                    'Concienzudo'
                ];
                
                dataValues = [
                    dimensionalScores.Dominante || dimensionalScores.dominante || 0,
                    dimensionalScores.Influyente || dimensionalScores.influyente || 0,
                    dimensionalScores.Estable || dimensionalScores.estable || 0,
                    dimensionalScores.Concienzudo || dimensionalScores.concienzudo || 0
                ];
                
                chartLabel = 'Perfil DISC';
            } else if (isEmotionalIntelligenceAssessment) {
                // Dimensiones Inteligencia Emocional
                labels = [
                    'Autoconciencia',
                    'Autorregulaci√≥n',
                    'Automotivaci√≥n',
                    'Empat√≠a',
                    'Habilidades Sociales'
                ];

                dataValues = [
                    dimensionalScores.Autoconciencia || dimensionalScores.autoconciencia || 0,
                    dimensionalScores.Autorregulaci√≥n || dimensionalScores.autorregulacion || 0,
                    dimensionalScores.Automotivaci√≥n || dimensionalScores.automotivacion || 0,
                    dimensionalScores.Empat√≠a || dimensionalScores.empatia || 0,
                    dimensionalScores['Habilidades Sociales'] || dimensionalScores.habilidades_sociales || 0
                ];
                
                chartLabel = 'Perfil de Inteligencia Emocional';
            } else if (isLeadershipAssessment) {
                // Usar las dimensiones originales de Liderazgo (sin traducir)
                labels = Object.keys(dimensionalScores);
                dataValues = Object.values(dimensionalScores);
                chartLabel = 'Perfil de Liderazgo';
            } else if (isTeamworkAssessment) {
                // Usar las dimensiones originales de Trabajo en Equipo (sin traducir)
                labels = Object.keys(dimensionalScores);
                dataValues = Object.values(dimensionalScores);
                chartLabel = 'Perfil de Trabajo en Equipo';
            } else {
                // Dimensiones Asertividad (configuraci√≥n original)
                labels = [
                    'Comunicaci√≥n',
                    'Derechos',
                    'Opiniones',
                    'Conflictos',
                    'Autoconfianza'
                ];

                dataValues = [
                    dimensionalScores.comunicacion || 0,
                    dimensionalScores.derechos || 0,
                    dimensionalScores.opiniones || 0,
                    dimensionalScores.conflictos || 0,
                    dimensionalScores.autoconfianza || 0
                ];
                
                chartLabel = 'Nivel de Asertividad';
            }

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: chartLabel,
                        data: dataValues,
                        backgroundColor: 'rgba(98, 130, 227, 0.2)',
                        borderColor: 'rgba(98, 130, 227, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(98, 130, 227, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${Math.round(context.raw)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            min: 0,
                            ticks: {
                                stepSize: 20,
                                callback: function(value) {
                                    return value + '%';
                                },
                                color: '#6B8DA6',
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                color: 'rgba(107, 141, 166, 0.2)'
                            },
                            angleLines: {
                                color: 'rgba(107, 141, 166, 0.2)'
                            },
                            pointLabels: {
                                color: '#243447',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.2
                        }
                    }
                }
            });
            
        }

        function getStatusLabel(status) {
            const labels = {
                'pending': 'Pendiente',
                'in_progress': 'En Progreso',
                'completed': 'Completada',
                'cancelled': 'Cancelada'
            };
            return labels[status] || status;
        }

        function getDimensionLabel(key) {
            const labels = {
                'comunicacion': 'Comunicaci√≥n Directa',
                'derechos': 'Defensa de Derechos',
                'opiniones': 'Expresi√≥n de Opiniones',
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza'
            };
            return labels[key] || key;
        }

        // Setup event listeners
        function setupEventListeners() {
            // NOTA: Los elementos del sidebar ya tienen onclick="showTab()" en el HTML
            // NO agregamos event listeners adicionales para evitar duplicaci√≥n
            // El c√≥digo anterior causaba que loadTasks() se llamara DOS VECES
            
            // Sidebar click events - REMOVIDO para evitar duplicaci√≥n
            // Ya no es necesario porque tenemos onclick en el HTML

            // Modal close event listener
            const evaluationDetailsModal = document.getElementById('evaluationDetailsModal');
            if (evaluationDetailsModal) {
                evaluationDetailsModal.addEventListener('hidden.bs.modal', function () {
                    
                    // Reset assessment state completely
                    isAssessmentActive = false;
                    
                    // Ensure assessment tab is hidden
                    const assessmentTab = document.getElementById('assessment-tab-item');
                    if (assessmentTab) {
                        assessmentTab.style.display = 'none';
                    }
                    
                    // Ensure assessment container is visible
                    const assessmentContainer = document.getElementById('assessmentContainer');
                    if (assessmentContainer) {
                        assessmentContainer.style.display = 'block';
                    }
                    
                    // NO cambiar de tab - mantener usuario donde estaba
                    // Solo asegurar que estamos en el tab correcto si no est√° activo
                    const evaluationsTab = document.querySelector('[onclick*="evaluaciones-figma"]');
                    if (evaluationsTab && !evaluationsTab.classList.contains('active')) {
                        showTab('evaluaciones-figma');
                    }
                    
                    // Clear cached data
                    window.lastEvaluationId = null;
                    window.lastAssessmentData = null;
                    
                    // Force remove any modal backdrop that might be stuck
                    setTimeout(() => {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        backdrops.forEach(backdrop => {
                            backdrop.remove();
                        });
                        
                        // Remove modal-open class from body that might block interactions
                        document.body.classList.remove('modal-open');
                        
                        // Reset body styles that might affect scrolling/interaction
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                        
                        // NO refrescar el dashboard - mantener estado actual
                        // refreshDashboard(); // ‚ùå REMOVIDO - causaba p√©rdida de scroll/estado
                        
                    }, 100);
                    
                });
            }

            // Setup content tab listeners
            setupContentTabListeners();
            
            // Setup document filters
            setupDocumentFilters();
        }

        // Setup content tab event listeners
        function setupContentTabListeners() {
            // Event listeners para las pesta√±as internas de contenido
            const documentsTab = document.getElementById('documents-tab');
            if (documentsTab) {
                documentsTab.addEventListener('shown.bs.tab', function() {
                    debugLog('üìÑ Pesta√±a de documentos activada');
                    // Cargar documentos si no est√°n cargados recientemente
                    if (!documentsData || documentsData.length === 0 || 
                        !window.lastDocumentLoad || (Date.now() - window.lastDocumentLoad > 300000)) {
                        loadDocuments();
                    } else {
                        // Si ya est√°n cargados, solo renderizar de nuevo
                        renderDocuments();
                    }
                });
                
                // Tambi√©n cargar en click para compatibilidad
                documentsTab.addEventListener('click', function() {
                    setTimeout(() => {
                        if (!documentsData || documentsData.length === 0 || 
                            !window.lastDocumentLoad || (Date.now() - window.lastDocumentLoad > 300000)) {
                            loadDocuments();
                        }
                    }, 100);
                });
            }
        }

        // ===== DOCUMENT MANAGEMENT FUNCTIONS =====
        
        let documentsData = [];
        let isLoadingDocuments = false;
        let filteredDocuments = [];

        // Load documents from server
        async function loadDocuments() {
            if (isLoadingDocuments) {
                debugLog('‚è≥ LoadDocuments ya en progreso, omitiendo llamada duplicada');
                return;
            }
            
            isLoadingDocuments = true;
            debugLog('üìÑ Cargando documentos...');
            
            // Mostrar spinner de carga
            const documentsContainer = document.getElementById('documentsContainer');
            if (documentsContainer) {
                documentsContainer.innerHTML = `
                    <div class="loading-spinner text-center py-4">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Cargando documentos...</span>
                        </div>
                        <p class="mt-2 text-muted">Cargando documentos...</p>
                    </div>
                `;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/documents`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                documentsData = data.documents || [];
                filteredDocuments = [...documentsData];
                window.lastDocumentLoad = Date.now();
                
                debugLog('üìÑ Documentos cargados:', {
                    total: documentsData.length,
                    documents: documentsData.map(d => ({
                        id: d.id,
                        title: d.title,
                        category: d.category,
                        priority: d.priority
                    }))
                });
                
                renderDocuments();
                
            } catch (error) {
                debugLog('‚ùå Error cargando documentos:', error);
                const documentsContainer = document.getElementById('documentsContainer');
                if (documentsContainer) {
                    documentsContainer.innerHTML = 
                        '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>Error cargando documentos. Int√©ntalo de nuevo.</div>';
                }
            } finally {
                isLoadingDocuments = false;
            }
        }

        // Render documents grid
        function renderDocuments() {
            const container = document.getElementById('documentsGrid');
            const filtersContainer = document.getElementById('documentFilters');
            const documentsContainer = document.getElementById('documentsContainer');
            
            if (!documentsData || documentsData.length === 0) {
                if (documentsContainer) {
                    documentsContainer.innerHTML = 
                        '<div class="empty-state text-center py-5"><i class="fas fa-folder-open fa-3x text-muted mb-3"></i><h5 class="text-muted">No tienes documentos asignados</h5><p class="text-muted">Tu coach a√∫n no te ha enviado documentos.</p></div>';
                }
                if (filtersContainer) {
                    filtersContainer.style.display = 'none';
                }
                return;
            }
            
            // Ocultar el contenedor de loading y mostrar el grid
            if (documentsContainer) {
                documentsContainer.innerHTML = '';
            }
            
            // Mostrar filtros si hay documentos
            if (filtersContainer) {
                filtersContainer.style.display = 'block';
            }
            
            let html = '';
            
            filteredDocuments.forEach(doc => {
                const formatDate = (dateString) => {
                    if (!dateString) return 'Sin fecha';
                    return new Date(dateString).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                };
                
                const getPriorityBadge = (priority) => {
                    const badges = {
                        'urgente': 'bg-danger',
                        'alta': 'bg-warning text-dark',
                        'normal': 'bg-secondary'
                    };
                    return badges[priority] || 'bg-secondary';
                };
                
                const getCategoryIcon = (category) => {
                    const icons = {
                        'ejercicios': 'fas fa-dumbbell',
                        'teoria': 'fas fa-book',
                        'evaluacion': 'fas fa-clipboard-check',
                        'recursos': 'fas fa-tools',
                        'tarea': 'fas fa-tasks',
                        'referencias': 'fas fa-bookmark'
                    };
                    return icons[category] || 'fas fa-file';
                };
                
                const getFileTypeIcon = (filename) => {
                    if (!filename) return 'fas fa-file';
                    const ext = filename.split('.').pop().toLowerCase();
                    const icons = {
                        'pdf': 'fas fa-file-pdf text-danger',
                        'doc': 'fas fa-file-word text-primary',
                        'docx': 'fas fa-file-word text-primary',
                        'jpg': 'fas fa-image text-success',
                        'jpeg': 'fas fa-image text-success',
                        'png': 'fas fa-image text-success',
                        'gif': 'fas fa-image text-success',
                        'mp4': 'fas fa-file-video text-warning',
                        'mp3': 'fas fa-file-audio text-info',
                        'xlsx': 'fas fa-file-excel text-success',
                        'pptx': 'fas fa-file-powerpoint text-warning'
                    };
                    return icons[ext] || 'fas fa-file';
                };
                
                html += `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card document-card h-100 shadow-sm">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="d-flex align-items-center flex-grow-1 me-2">
                                        <i class="${getCategoryIcon(doc.category)} me-2 text-primary flex-shrink-0"></i>
                                        <span class="fw-bold text-truncate" title="${escapeHtml(doc.title)}">${escapeHtml(doc.title)}</span>
                                    </div>
                                    <span class="badge ${getPriorityBadge(doc.priority)} flex-shrink-0">${doc.priority}</span>
                                </div>
                            </div>
                            <div class="card-body d-flex flex-column">
                                ${doc.description ? `<p class="card-text text-muted small mb-3">${escapeHtml(doc.description)}</p>` : ''}
                                
                                <div class="document-files mb-3 flex-grow-1">
                                    ${doc.files && doc.files.length > 0 ? doc.files.map(file => `
                                        <div class="d-flex align-items-center justify-content-between p-2 border rounded mb-2 bg-light">
                                            <div class="d-flex align-items-center flex-grow-1 me-2 min-width-0">
                                                <i class="${getFileTypeIcon(file.filename)} me-2 flex-shrink-0"></i>
                                                <span class="text-truncate small" title="${escapeHtml(file.filename)}">${escapeHtml(file.filename)}</span>
                                            </div>
                                            <div class="btn-group btn-group-sm flex-shrink-0">
                                                <button class="btn btn-outline-primary btn-sm" 
                                                        onclick="previewDocument('${doc.id}', '${file.id}', '${escapeHtml(file.filename)}')"
                                                        title="Vista previa">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-outline-success btn-sm" 
                                                        onclick="downloadDocument('${doc.id}', '${file.id}', '${escapeHtml(file.filename)}')"
                                                        title="Descargar">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                            </div>
                                        </div>
                                    `).join('') : '<p class="text-muted small text-center py-3"><i class="fas fa-folder-open me-1"></i>No hay archivos adjuntos</p>'}
                                </div>
                                
                                <div class="mt-auto">
                                    <div class="d-flex justify-content-between align-items-center text-muted small">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-calendar me-1"></i>
                                            <span>${formatDate(doc.uploaded_at)}</span>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-user me-1"></i>
                                            <span class="text-truncate" title="${escapeHtml(doc.uploaded_by || 'Coach')}">${escapeHtml(doc.uploaded_by || 'Coach')}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (container) {
                container.innerHTML = html;
            }
        }

        // Preview document
        function previewDocument(documentId, fileId, filename) {
            debugLog('üîç Vista previa de documento:', {documentId, fileId, filename});
            
            const fileExtension = filename.split('.').pop().toLowerCase();
            const previewUrl = `${API_BASE_URL}/api/coachee/documents/${documentId}/files/${fileId}/preview`;
            
            let modalContent = '';
            
            if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) {
                // Preview para im√°genes
                modalContent = `
                    <div class="text-center">
                        <img src="${previewUrl}" class="img-fluid" alt="${escapeHtml(filename)}" 
                             style="max-height: 70vh; object-fit: contain;">
                    </div>
                `;
            } else if (fileExtension === 'pdf') {
                // Preview para PDFs
                modalContent = `
                    <div style="height: 70vh;">
                        <iframe src="${previewUrl}" width="100%" height="100%" frameborder="0">
                            <p>No se puede mostrar el PDF. <a href="${previewUrl}" target="_blank">Abrir en nueva ventana</a></p>
                        </iframe>
                    </div>
                `;
            } else {
                // Preview gen√©rico para otros tipos de archivo
                modalContent = `
                    <div class="text-center p-4">
                        <i class="fas fa-file fa-5x text-muted mb-3"></i>
                        <h5>${escapeHtml(filename)}</h5>
                        <p class="text-muted">Vista previa no disponible para este tipo de archivo</p>
                        <button class="btn btn-primary" onclick="downloadDocument('${documentId}', '${fileId}', '${filename}')">
                            <i class="fas fa-download me-2"></i>Descargar archivo
                        </button>
                    </div>
                `;
            }
            
            const modalHtml = `
                <div class="modal fade" id="documentPreviewModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-eye me-2"></i>
                                    Vista previa: ${escapeHtml(filename)}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ${modalContent}
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-success" onclick="downloadDocument('${documentId}', '${fileId}', '${filename}')">
                                    <i class="fas fa-download me-2"></i>Descargar
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Eliminar modal anterior si existe
            const existingModal = document.getElementById('documentPreviewModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('documentPreviewModal'));
            modal.show();
            
            // Limpiar cuando se cierre
            document.getElementById('documentPreviewModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // Download document
        function downloadDocument(documentId, fileId, filename) {
            debugLog('‚¨áÔ∏è Descargando documento:', {documentId, fileId, filename});
            
            const downloadUrl = `${API_BASE_URL}/api/coachee/documents/${documentId}/files/${fileId}/download`;
            
            // Crear elemento de descarga temporal
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = filename;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Filter documents
        function filterDocuments() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const searchTerm = document.getElementById('searchDocuments').value.toLowerCase();
            
            filteredDocuments = documentsData.filter(doc => {
                const matchesCategory = !categoryFilter || doc.category === categoryFilter;
                const matchesPriority = !priorityFilter || doc.priority === priorityFilter;
                const matchesSearch = !searchTerm || 
                    doc.title.toLowerCase().includes(searchTerm) ||
                    (doc.description && doc.description.toLowerCase().includes(searchTerm));
                
                return matchesCategory && matchesPriority && matchesSearch;
            });
            
            renderDocuments();
        }

        // Setup document filters
        function setupDocumentFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const searchInput = document.getElementById('searchDocuments');
            
            if (categoryFilter) {
                categoryFilter.addEventListener('change', filterDocuments);
            }
            
            if (priorityFilter) {
                priorityFilter.addEventListener('change', filterDocuments);
            }
            
            if (searchInput) {
                searchInput.addEventListener('input', filterDocuments);
            }
        }

        // Initialize application
        async function initializeApp() {
            debugLog('üöÄ Inicializando dashboard de coachee...');
            
            // TEST B√ÅSICO DE CHART.JS ELIMINADO POR PETICI√ìN DEL USUARIO
            // debugLog('üîµ Ejecutando test b√°sico de Chart.js...');
            // setTimeout(createBasicTestChart, 100); // ELIMINADO
            
            try {
                // Create animated particles
                createParticles();
                
                // Setup event listeners
                setupEventListeners();
                
                // Setup content tab listeners
                setupContentTabListeners();
                
                // Inicializar sincronizaci√≥n de avatar
                setupAvatarSync();
                debugLog('üîÑ Sistema de sincronizaci√≥n de avatar inicializado');
                
                // Load initial data
                debugLog('üìä Cargando perfil de usuario...');
                await loadUserProfile();
                
                debugLog('üìä Cargando resumen del dashboard...');
                await loadDashboardSummary();
                
                // Load data for active tab
                debugLog('üìä Cargando evaluaciones...');
                await loadEvaluations();
                
                // üî• FIX: Renderizar stats de Figma si el tab activo es evaluaciones-figma
                const savedTab = localStorage.getItem('coachee_activeTab');
                if (savedTab === 'evaluaciones-figma' && typeof renderFigmaStats === 'function') {
                    debugLog('üìä Renderizando estad√≠sticas de Figma en tab activo...');
                    renderFigmaStats();
                }
                
                debugLog('üìä Cargando tareas...');
                await loadTasks();
                
                debugLog('üìä Cargando historial de evaluaciones...');
                await loadEvaluationHistory();
                
                // GR√ÅFICO DE PRUEBA ELIMINADO POR PETICI√ìN DEL USUARIO
                // debugLog('üî• Creando gr√°fico de prueba...');
                // setTimeout(() => {
                //     renderTestProgressChart();
                // }, 1000); // Esperar 1 segundo para asegurar que todo est√© cargado
                
                // Forzar actualizaci√≥n final del mensaje de bienvenida
                updateWelcomeMessage();
                
                debugLog('‚úÖ Dashboard inicializado correctamente');
            } catch (error) {
                debugLog('‚ùå Error durante la inicializaci√≥n del dashboard', error);
                console.error('Error en initializeApp:', error);
            }
        }
        
        // FUNCI√ìN DE DEBUG TEMPORAL - Para ejecutar desde consola
        window.debugWelcomeMessage = function() {
            
            const welcomeEl = document.getElementById('welcomeMessage');
            
            // Buscar elementos similares
            const allSpans = document.querySelectorAll('span');
            allSpans.forEach((span, i) => {
                if (span.textContent?.includes('Welcome')) {
                }
            });
            
            // Forzar actualizaci√≥n
            if (welcomeEl && currentUser?.full_name) {
                welcomeEl.textContent = currentUser.full_name;
            } else {
            }
        };

        // FUNCI√ìN PARA FORZAR ACTUALIZACI√ìN MANUAL DEL NOMBRE
        window.forceUpdateUserName = async function() {
            
            try {
                // Intentar dashboard summary primero
                const response = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.success && data.summary?.coachee?.name) {
                        const userName = data.summary.coachee.name;
                        const welcomeText = userName;
                        const count = updateAllWelcomeMessages(welcomeText);
                        return true;
                    }
                }
                
                return false;
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                return false;
            }
        };

        // FUNCI√ìN DE EMERGENCIA: Limpiar duplicados y actualizar
        window.fixWelcomeMessage = function() {
            // Obtener todos los elementos con id="welcomeMessage"
            const allElements = document.querySelectorAll('#welcomeMessage');
            
            if (allElements.length > 1) {
                // Mantener solo el primer elemento, eliminar el resto
                for (let i = 1; i < allElements.length; i++) {
                    allElements[i].remove();
                }
            }
            
            // Actualizar el elemento restante
            const finalElement = document.getElementById('welcomeMessage');
            if (finalElement) {
                finalElement.textContent = 'Welcome, test15!';
                return true;
            }
            
            return false;
        };

        // FUNCI√ìN PARA ACTUALIZAR TODOS LOS ELEMENTOS WELCOMEMESSAGE
        window.updateAllWelcomeMessages = function(message) {
            // Usar querySelectorAll para obtener TODOS los elementos
            const allWelcomeElements = document.querySelectorAll('#welcomeMessage');
            
            allWelcomeElements.forEach((element, index) => {
                element.textContent = message;
            });
            
            return allWelcomeElements.length;
        };

        // FUNCI√ìN PARA FORZAR ACTUALIZACI√ìN CON DELAY
        window.forceUpdateWelcome = function() {
            setTimeout(() => {
                // M√©todo 1: Por ID
                let welcomeEl = document.getElementById('welcomeMessage');
                
                // M√©todo 2: Por selector CSS si no funciona ID
                if (!welcomeEl) {
                    welcomeEl = document.querySelector('#welcomeMessage');
                }
                
                // M√©todo 3: Buscar en todos los spans que contengan "Welcome"
                if (!welcomeEl) {
                    const spans = document.querySelectorAll('span');
                    for (let span of spans) {
                        if (span.textContent && span.textContent.includes('Welcome')) {
                            welcomeEl = span;
                            break;
                        }
                    }
                }
                
                if (welcomeEl) {
                    welcomeEl.textContent = 'Welcome, test15!';
                } else {
                    
                    // M√©todo 4: Crear el elemento si no existe
                    const h3 = document.querySelector('h3');
                    if (h3) {
                        h3.innerHTML = '<i class="fas fa-home me-2"></i><span id="welcomeMessage">Welcome, test15!</span>';
                    }
                }
            }, 2000); // Aumentar delay a 2 segundos
        };

        // Funci√≥n para actualizar el mensaje de bienvenida
        function updateWelcomeMessage() {
            if (currentUser && currentUser.full_name) {
                const welcomeText = currentUser.full_name;
                const updatedCount = updateAllWelcomeMessages(welcomeText);
            }
        }
        
        // Funci√≥n para actualizar el avatar del header
        function updateHeaderAvatar(forceRefresh = false) {
            if (currentUser && currentUser.full_name) {
                const avatarElement = document.getElementById('headerAvatarDashboard');
                if (avatarElement) {
                    // Si hay avatar_url, mostrar imagen
                    if (currentUser.avatar_url) {
                        avatarElement.innerHTML = `<img src="${currentUser.avatar_url}" alt="${currentUser.full_name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                    } else {
                        // Obtener iniciales del nombre
                        const nameParts = currentUser.full_name.trim().split(' ');
                        let initials = '';
                        if (nameParts.length >= 2) {
                            initials = nameParts[0].charAt(0) + nameParts[1].charAt(0);
                        } else {
                            initials = nameParts[0].charAt(0);
                        }
                        avatarElement.innerHTML = initials.toUpperCase();
                    }
                }
            }
        }
        
        // Sistema de sincronizaci√≥n de avatar entre pesta√±as
        function setupAvatarSync() {
            // Escuchar cambios en localStorage (cuando se actualiza en otra pesta√±a)
            window.addEventListener('storage', function(e) {
                if (e.key === 'avatarUpdated') {
                    // Recargar perfil del usuario
                    fetch(`${API_BASE_URL}/api/coachee/profile`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success && data.profile) {
                                // Actualizar currentUser con el nuevo avatar
                                currentUser = data.profile;
                                updateHeaderAvatar(true);
                            }
                        })
                        .catch(error => console.error('Error recargando perfil:', error));
                }
            });
            
            // Verificar cambios cada 5 segundos (para misma pesta√±a despu√©s de volver del perfil)
            setInterval(function() {
                const lastUpdate = localStorage.getItem('avatarUpdated');
                const lastCheck = sessionStorage.getItem('lastAvatarCheck') || '0';
                
                if (lastUpdate && lastUpdate > lastCheck) {
                    sessionStorage.setItem('lastAvatarCheck', Date.now().toString());
                    
                    // Recargar perfil del usuario
                    fetch(`${API_BASE_URL}/api/coachee/profile`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success && data.profile) {
                                // Actualizar currentUser con el nuevo avatar
                                currentUser = data.profile;
                                updateHeaderAvatar(true);
                            }
                        })
                        .catch(error => console.error('Error recargando perfil:', error));
                }
            }, 5000);
        }

        // Funci√≥n de emergencia para desbloquear el dashboard
        function forceUnlockDashboard() {
            
            // Reset all assessment states
            isAssessmentActive = false;
            
            // Hide assessment tab
            const assessmentTab = document.getElementById('assessment-tab-item');
            if (assessmentTab) {
                assessmentTab.style.display = 'none';
            }
            
            // Show assessment container
            const assessmentContainer = document.getElementById('assessmentContainer');
            if (assessmentContainer) {
                assessmentContainer.style.display = 'block';
            }
            
            // Force close all modals
            const allModals = document.querySelectorAll('.modal');
            allModals.forEach(modal => {
                const modalInstance = bootstrap.Modal.getInstance(modal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            });
            
            // Remove all modal backdrops
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(backdrop => {
                backdrop.remove();
            });
            
            // Remove modal-open class from body
            document.body.classList.remove('modal-open');
            
            // Reset body styles
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
            document.body.style.position = '';
            
            // Reset any stuck pointer-events
            document.body.style.pointerEvents = '';
            
            // Clear cached data
            window.lastEvaluationId = null;
            window.lastAssessmentData = null;
            
            // Switch to evaluations tab
            showTab('evaluations');
            
            // Force refresh
            refreshDashboard();
            
            showToast('Dashboard desbloqueado forzadamente', 'success');
        }

        // Make it globally accessible for debugging
        window.forceUnlockDashboard = forceUnlockDashboard;

        // Validar visibilidad de evaluaciones
        async function validateEvaluationVisibility(assessmentId = null) {
            try {
                showToast('Validando visibilidad de evaluaciones...', 'info');
                
                const url = assessmentId 
                    ? `/api/coachee/validate-visibility?assessment_id=${assessmentId}`
                    : '/api/coachee/validate-visibility';
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin'
                });
                
                const data = await response.json();
                
                if (data.valid) {
                    showValidationResults(data, true);
                } else {
                    showValidationResults(data, false);
                }
                
            } catch (error) {
                console.error('Error validando visibilidad:', error);
                showToast('Error al validar visibilidad de evaluaciones', 'error');
            }
        }

        // Mostrar resultados de validaci√≥n en modal
        function showValidationResults(data, isValid) {
            const modalHtml = `
                <div class="modal fade" id="validationModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header ${isValid ? 'bg-success' : 'bg-warning'} text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-${isValid ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
                                    Validaci√≥n de Visibilidad de Evaluaciones
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ${generateValidationReport(data, isValid)}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                ${isValid ? '<button type="button" class="btn btn-primary" onclick="refreshDashboard()" data-bs-dismiss="modal">Actualizar Dashboard</button>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal existente si existe
            const existingModal = document.getElementById('validationModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('validationModal'));
            modal.show();
            
            // Mostrar toast con resultado
            if (isValid) {
                showToast(`Validaci√≥n exitosa: ${data.available_assessments_count || 0} evaluaciones visibles`, 'success');
            } else {
                showToast(`Problema detectado: ${data.error}`, 'warning');
            }
        }

        // Generar reporte de validaci√≥n
        function generateValidationReport(data, isValid) {
            let html = '';
            
            if (isValid && data.coachee) {
                html += `
                    <div class="alert alert-success">
                        <h6><i class="fas fa-user me-2"></i>Informaci√≥n del Coachee</h6>
                        <strong>Nombre:</strong> ${data.coachee.full_name}<br>
                        <strong>Usuario:</strong> ${data.coachee.username}<br>
                        <strong>Coach:</strong> ${data.coachee.coach_name || 'No asignado'}
                    </div>
                `;
                
                if (data.summary) {
                    html += `
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="card text-center ${data.summary.can_see_evaluations ? 'border-success' : 'border-warning'}">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.available_assessments_count || 0}</h5>
                                        <p class="card-text">Evaluaciones Disponibles</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center border-info">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.completed_assessments_count || 0}</h5>
                                        <p class="card-text">Evaluaciones Completadas</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center border-primary">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.total_assessments_checked || 0}</h5>
                                        <p class="card-text">Total Evaluaciones</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                if (data.assessments && data.assessments.length > 0) {
                    html += `
                        <h6><i class="fas fa-list me-2"></i>Detalle de Evaluaciones</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Evaluaci√≥n</th>
                                        <th>Estado</th>
                                        <th>Preguntas</th>
                                        <th>Visible</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    data.assessments.forEach(assessment => {
                        const statusBadge = assessment.is_completed ? 'badge bg-success' : 
                                          assessment.visible ? 'badge bg-primary' : 'badge bg-secondary';
                        const statusText = assessment.is_completed ? 'Completada' : 
                                         assessment.visible ? 'Disponible' : 'No disponible';
                        const visibleIcon = assessment.visible ? 'fas fa-eye text-success' : 'fas fa-eye-slash text-muted';
                        
                        html += `
                            <tr>
                                <td><strong>${assessment.title}</strong></td>
                                <td><span class="${statusBadge}">${statusText}</span></td>
                                <td>${assessment.active_questions_count}</td>
                                <td><i class="${visibleIcon}"></i></td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            } else {
                html += `
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Problema Detectado</h6>
                        <strong>Error:</strong> ${data.error}<br>
                        ${data.details ? `<strong>Detalles:</strong> ${JSON.stringify(data.details, null, 2)}` : ''}
                    </div>
                `;
                
                if (data.error.includes('coach asignado')) {
                    html += `
                        <div class="alert alert-info">
                            <h6><i class="fas fa-info-circle me-2"></i>Soluci√≥n Recomendada</h6>
                            <p>Para ver evaluaciones necesitas tener un coach asignado. Contacta al administrador del sistema para:</p>
                            <ul>
                                <li>Asignarte un coach</li>
                                <li>Verificar tu cuenta</li>
                                <li>Obtener acceso a evaluaciones</li>
                            </ul>
                        </div>
                    `;
                }
            }
            
            return html;
        }

        // ‚ö° FASE 2: Verificar Chart.js y cargarlo si es necesario
        async function testChartJSAvailability() {
            
            if (typeof Chart === 'undefined') {
                console.log('üìä Chart.js no disponible, cargando...');
                try {
                    await loadChartJs();
                    console.log('‚úÖ Chart.js cargado exitosamente');
                    return true;
                } catch (error) {
                    console.error('‚ùå Error cargando Chart.js:', error);
                    document.body.insertAdjacentHTML('beforeend', 
                        '<div style="position: fixed; top: 10px; right: 10px; background: orange; color: white; padding: 20px; z-index: 9999; border-radius: 5px;">' +
                        '‚ö†Ô∏è Gr√°ficos deshabilitados temporalmente' +
                        '</div>'
                    );
                    setTimeout(() => {
                        document.querySelector('[style*="position: fixed"]')?.remove();
                    }, 3000);
                    return false;
                }
            } else {
                console.log('‚úÖ Chart.js ya estaba cargado');
                return true;
            }
        }

        // OPTIMIZACI√ìN: Flag global para prevenir inicializaci√≥n m√∫ltiple
        let isAppInitialized = false;
        
        async function safeInitializeApp() {
            if (isAppInitialized) {
                return;
            }
            isAppInitialized = true;
            
            testChartJSAvailability();
            await initializeApp();
            
            // Inicializar tooltips de Bootstrap
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
            
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', safeInitializeApp);
        } else {
            safeInitializeApp();
        }
        
        // DEBUG: Global functions for browser console debugging
        window.debugDashboard = {
            currentUser,
            dashboardData,
            evaluationsData,
            tasksData,
            contentData,
            API_BASE_URL,
            loadEvaluations,
            loadDashboardSummary,
            loadTasks,
            loadContent,
            openContent,
            markContentAsViewed,
            initializeApp,
            testConnection: async function() {
                try {
                    debugLog('üß™ Testing connection...');
                    const response = await fetch(`${API_BASE_URL}/api/coachee/evaluations`);
                    debugLog(`üì° Test response: ${response.status} ${response.statusText}`);
                    if (response.ok) {
                        const data = await response.json();
                        debugLog('üì¶ Test data:', data);
                        return data;
                    } else {
                        debugLog('‚ùå Test failed:', response);
                        return null;
                    }
                } catch (error) {
                    debugLog('‚ùå Test error:', error);
                    return null;
                }
            }
        };
        
        debugLog('üîß Global debugging functions available via window.debugDashboard');

        // ========== FORZAR COLORES SIMPLES EN NAV-TABS ========== 
        function forceConsistentColorsOnButtons() {
            // SOLO aplicar a botones dentro de #scheduleCoachTabs, NO al header
            const buttons = document.querySelectorAll('#scheduleCoachTabs .nav-link');
            
            buttons.forEach(button => {
                // Aplicar estilos inmediatamente
                button.style.setProperty('background', '#fff', 'important');
                button.style.setProperty('background-color', '#fff', 'important');
                button.style.setProperty('color', '#333', 'important');
                button.style.setProperty('border-color', '#dee2e6', 'important');
                
                const icon = button.querySelector('i');
                if (icon) {
                    icon.style.setProperty('color', '#333', 'important');
                }
                
                const spans = button.querySelectorAll('span:not(.badge)');
                spans.forEach(span => {
                    span.style.setProperty('color', '#333', 'important');
                });
                
                // Event listeners
                ['mousedown', 'mouseup', 'click', 'focus', 'blur', 'mouseover', 'mouseout'].forEach(eventType => {
                    button.addEventListener(eventType, function() {
                        this.style.setProperty('background', '#fff', 'important');
                        this.style.setProperty('background-color', '#fff', 'important');
                        this.style.setProperty('color', '#333', 'important');
                        this.style.setProperty('border-color', '#dee2e6', 'important');
                        
                        const icon = this.querySelector('i');
                        if (icon) {
                            icon.style.setProperty('color', '#333', 'important');
                        }
                        
                        const spans = this.querySelectorAll('span:not(.badge)');
                        spans.forEach(span => {
                            span.style.setProperty('color', '#333', 'important');
                        });
                    });
                });
                
                // Verificaci√≥n continua
                const currentButton = button;
                setInterval(() => {
                    currentButton.style.setProperty('background', '#fff', 'important');
                    currentButton.style.setProperty('background-color', '#fff', 'important');
                    currentButton.style.setProperty('color', '#333', 'important');
                    currentButton.style.setProperty('border-color', '#dee2e6', 'important');
                    
                    const icon = currentButton.querySelector('i');
                    if (icon) {
                        icon.style.setProperty('color', '#333', 'important');
                    }
                    
                    const spans = currentButton.querySelectorAll('span:not(.badge)');
                    spans.forEach(span => {
                        span.style.setProperty('color', '#333', 'important');
                    });
                }, 100);
            });
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar avatar con gradiente por defecto
            const headerAvatar = document.getElementById('headerAvatar');
            if (headerAvatar && !headerAvatar.querySelector('img')) {
                headerAvatar.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
            }
            
            // FORZAR colores de badges en el header (proteger contra sobrescritura)
            function forceHeaderBadgeColors() {
                // Badge de notificaciones (rojo)
                const notificationBadges = document.querySelectorAll('header button span[style*="background: #ef4444"]');
                notificationBadges.forEach(badge => {
                    badge.style.setProperty('background', '#ef4444', 'important');
                    badge.style.setProperty('border', '2px solid white', 'important');
                });
                
                // Badge de online status (verde)
                const onlineBadges = document.querySelectorAll('header button span[style*="background: #10b981"]');
                onlineBadges.forEach(badge => {
                    badge.style.setProperty('background', '#10b981', 'important');
                    badge.style.setProperty('border', '2px solid white', 'important');
                });
            }
            
            // Aplicar inmediatamente y peri√≥dicamente
            forceHeaderBadgeColors();
            setInterval(forceHeaderBadgeColors, 500);
            
            setTimeout(forceConsistentColorsOnButtons, 100);
            setTimeout(forceConsistentColorsOnButtons, 500);
            setTimeout(forceConsistentColorsOnButtons, 1000);
        });

        // ================================
        // COACHEE CALENDAR FUNCIONES
        // ================================

        // FullCalendar JS
        const calendarScript = document.createElement('script');
        calendarScript.src = 'https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js';
        calendarScript.onload = function() {
            initializeCoacheeScheduling();
        };
        document.head.appendChild(calendarScript);

        function initializeCoacheeScheduling() {
            loadCoachAvailability();
            loadMySessions();
            setupSessionRequestForm();
        }

        function loadCoachAvailability() {
            fetch('/api/coachee/coach-availability')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayCoachAvailability(data.availability, data.occupied_slots, data.coach_name);
                    } else {
                        document.getElementById('coachAvailabilityInfo').innerHTML = 
                            '<p class="avail-muted">No se pudo cargar la disponibilidad del coach</p>';
                    }
                })
                .catch(error => {
                    console.error('Error cargando disponibilidad del coach:', error);
                    document.getElementById('coachAvailabilityInfo').innerHTML = 
                        '<p class="text-danger">Error cargando disponibilidad</p>';
                });
        }

        function displayCoachAvailability(availability, occupiedSlots, coachName) {
            const container = document.getElementById('coachAvailabilityInfo');
            if (!container) return;
            
            // Crear t√≠tulo si no existe
            let titleElement = container.querySelector('.avail-title');
            if (!titleElement) {
                titleElement = document.createElement('h6');
                titleElement.className = 'avail-title mb-3';
                titleElement.style.fontSize = '1.1375rem';
                titleElement.style.fontWeight = '600';
                titleElement.style.color = '#111827';
                titleElement.innerHTML = '<i class="fas fa-info-circle me-2" style="color: #10b981; font-size: 1.1375rem;"></i>Disponibilidad del Coach';
                container.insertBefore(titleElement, container.firstChild);
            }
            
            // Buscar o crear contenedor de datos
            let dataContainer = container.querySelector('.avail-data');
            if (!dataContainer) {
                dataContainer = document.createElement('div');
                dataContainer.className = 'avail-data';
                container.appendChild(dataContainer);
            }
            
            if (availability.length === 0) {
                dataContainer.innerHTML = '<p class="avail-muted">El coach no ha configurado su disponibilidad</p>';
                return;
            }
            
            const dayNames = ['Domingo', 'Lunes', 'Martes', 'Mi√©rcoles', 'Jueves', 'Viernes', 'S√°bado'];
            
            let html = `<div class="mb-2 avail-card"><strong>${coachName}</strong></div>`;
            html += '<div class="mb-3"><small class="avail-muted">Horarios disponibles esta semana:</small></div>';
            
            // Calcular disponibilidad real para los pr√≥ximos 7 d√≠as
            const realAvailability = calculateRealAvailability(availability, occupiedSlots);
            
            if (realAvailability.length === 0) {
                html += '<div class="alert alert-info py-2"><small>No hay horarios disponibles en los pr√≥ximos 7 d√≠as.</small></div>';
            } else {
                realAvailability.forEach(slot => {
                    const date = new Date(slot.date + 'T12:00:00');
                    const dayName = dayNames[date.getDay()];
                    const dateStr = date.toLocaleDateString('es-ES', { 
                        day: '2-digit', 
                        month: '2-digit' 
                    });
                    
                    html += `
                        <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-success bg-opacity-10 border border-success border-opacity-25 rounded avail-card">
                            <div>
                                <span class="fw-medium">${dayName}</span>
                                <small class="avail-muted ms-1">${dateStr}</small>
                            </div>
                            <span class="avail-success fw-medium">${slot.start_time} - ${slot.end_time}</span>
                        </div>
                    `;
                });
            }
            
            // Mostrar pr√≥ximas sesiones ocupadas como referencia
            if (occupiedSlots.length > 0) {
                html += '<div class="mt-3 mb-2"><small class="avail-muted">Pr√≥ximas sesiones ocupadas:</small></div>';
                occupiedSlots.slice(0, 3).forEach(slot => {
                    const date = new Date(slot.date + 'T12:00:00');
                    const dateStr = date.toLocaleDateString('es-ES', { 
                        day: '2-digit', 
                        month: '2-digit' 
                    });
                    html += `
                        <div class="d-flex justify-content-between align-items-center mb-1 p-1 bg-warning bg-opacity-10 rounded avail-card">
                            <span class="small avail-muted">${dateStr}</span>
                            <span class="small avail-warning">${slot.start_time} - ${slot.end_time}</span>
                        </div>
                    `;
                });
            }
            
            dataContainer.innerHTML = html;
        }

        function calculateRealAvailability(generalAvailability, occupiedSlots) {
            const realSlots = [];
            const today = new Date();
            
            // Analizar los pr√≥ximos 7 d√≠as
            for (let i = 1; i <= 7; i++) {
                const targetDate = new Date(today);
                targetDate.setDate(today.getDate() + i);
                const dayOfWeek = targetDate.getDay();
                const dateStr = targetDate.toISOString().split('T')[0];
                
                // Buscar disponibilidad general para este d√≠a de la semana
                const dayAvailability = generalAvailability.filter(slot => slot.day_of_week === dayOfWeek);
                
                dayAvailability.forEach(generalSlot => {
                    // Buscar sesiones ocupadas en esta fecha espec√≠fica
                    const dayOccupied = occupiedSlots.filter(occupied => occupied.date === dateStr);
                    
                    // Calcular horarios libres
                    const freeSlots = calculateFreeTimeSlots(
                        generalSlot.start_time,
                        generalSlot.end_time,
                        dayOccupied
                    );
                    
                    // Agregar slots libres que sean de al menos 1 hora
                    freeSlots.forEach(freeSlot => {
                        if (getMinutesDifference(freeSlot.start, freeSlot.end) >= 60) {
                            realSlots.push({
                                date: dateStr,
                                start_time: freeSlot.start,
                                end_time: freeSlot.end,
                                day_of_week: dayOfWeek
                            });
                        }
                    });
                });
            }
            
            return realSlots;
        }

        function calculateFreeTimeSlots(startTime, endTime, occupiedSlots) {
            if (occupiedSlots.length === 0) {
                return [{ start: startTime, end: endTime }];
            }
            
            const freeSlots = [];
            let currentStart = startTime;
            
            // Ordenar slots ocupados por hora de inicio
            const sortedOccupied = occupiedSlots.sort((a, b) => 
                a.start_time.localeCompare(b.start_time)
            );
            
            sortedOccupied.forEach(occupied => {
                // Si hay espacio antes de esta sesi√≥n ocupada
                if (currentStart < occupied.start_time) {
                    freeSlots.push({
                        start: currentStart,
                        end: occupied.start_time
                    });
                }
                
                // Actualizar el siguiente inicio disponible
                currentStart = occupied.end_time > currentStart ? occupied.end_time : currentStart;
            });
            
            // Si queda tiempo despu√©s de la √∫ltima sesi√≥n ocupada
            if (currentStart < endTime) {
                freeSlots.push({
                    start: currentStart,
                    end: endTime
                });
            }
            
            return freeSlots;
        }

        function getMinutesDifference(startTime, endTime) {
            const [startHour, startMin] = startTime.split(':').map(Number);
            const [endHour, endMin] = endTime.split(':').map(Number);
            
            const startMinutes = startHour * 60 + startMin;
            const endMinutes = endHour * 60 + endMin;
            
            return endMinutes - startMinutes;
        }

        // Variable global para controlar que el formulario solo se configure una vez
        let sessionFormConfigured = false;

        function setupSessionRequestForm() {
            
            const form = document.getElementById('sessionRequestForm');
            if (!form) {
                console.warn('‚ö†Ô∏è Formulario sessionRequestForm no encontrado');
                return;
            }
            
            // ‚ö†Ô∏è IMPORTANTE: Solo configurar una vez para evitar event listeners duplicados
            if (sessionFormConfigured) {
                return;
            }
            
            // Verificar que todos los elementos existan
            const sessionDate = document.getElementById('sessionDate');
            const sessionStartTime = document.getElementById('sessionStartTime');
            const sessionEndTime = document.getElementById('sessionEndTime');
            
            if (!sessionDate || !sessionStartTime || !sessionEndTime) {
                console.warn('‚ö†Ô∏è Algunos campos del formulario no fueron encontrados');
                return;
            }
            
            
            // Configurar fecha m√≠nima (ma√±ana en zona horaria de Santiago)
            sessionDate.min = getSantiagoTomorrow();
            
            // Configurar dropdowns de tiempo para auto-completar
            function setupTimeDropdowns() {
                
                // Auto-completar hora de fin cuando se selecciona hora de inicio
                sessionStartTime.addEventListener('change', function() {
                    const startTime = this.value;
                    
                    if (startTime) {
                        const [hours, minutes] = startTime.split(':').map(Number);
                        let endHours = hours + 1;
                        
                        // Asegurar que no exceda las 20:30
                        if (endHours > 20 || (endHours === 20 && minutes > 0)) {
                            endHours = 20;
                            sessionEndTime.value = '20:30';
                        } else {
                            const endTime = `${String(endHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                            sessionEndTime.value = endTime;
                        }
                        
                    }
                });
                
                // Validar que la hora de fin sea posterior a la de inicio
                sessionEndTime.addEventListener('change', function() {
                    const startTime = sessionStartTime.value;
                    const endTime = this.value;
                    
                    if (startTime && endTime) {
                        const [startHours, startMinutes] = startTime.split(':').map(Number);
                        const [endHours, endMinutes] = endTime.split(':').map(Number);
                        
                        const startTotalMinutes = startHours * 60 + startMinutes;
                        const endTotalMinutes = endHours * 60 + endMinutes;
                        
                        if (endTotalMinutes <= startTotalMinutes) {
                            showNotification('La hora de fin debe ser posterior a la hora de inicio', 'error');
                            // Resetear a una hora v√°lida
                            const validEndHours = startHours + 1;
                            if (validEndHours <= 20) {
                                this.value = `${String(validEndHours).padStart(2, '0')}:${String(startMinutes).padStart(2, '0')}`;
                            } else {
                                this.value = '20:30';
                            }
                        }
                    }
                });
                
            }
            
            // Configurar dropdowns
            setupTimeDropdowns();
            
            // Agregar event listener al formulario (UNA SOLA VEZ)
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validar que todos los campos est√©n completos
                const startTime = sessionStartTime.value;
                const endTime = sessionEndTime.value;
                const date = sessionDate.value;
                const title = document.getElementById('sessionTitle').value;
                
                if (!date || !startTime || !endTime || !title.trim()) {
                    showNotification('Por favor, complete todos los campos obligatorios', 'error');
                    return;
                }
                
                // Validar fecha (no en el pasado)
                const selectedDate = new Date(date + 'T00:00:00');
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (selectedDate < today) {
                    showNotification('No se puede solicitar una sesi√≥n en una fecha pasada', 'error');
                    return;
                }
                
                // Los dropdowns ya garantizan horarios v√°lidos, proceder con la solicitud
                submitSessionRequest();
            });
            
            // Marcar como configurado para evitar configuraciones duplicadas
            sessionFormConfigured = true;
        }

        function submitSessionRequest() {
            const formData = {
                session_date: document.getElementById('sessionDate').value,
                start_time: document.getElementById('sessionStartTime').value,
                end_time: document.getElementById('sessionEndTime').value,
                title: document.getElementById('sessionTitle').value,
                description: document.getElementById('sessionDescription').value,
                location: document.getElementById('sessionLocation').value
            };
            
            if (!formData.session_date || !formData.start_time || !formData.end_time) {
                showNotification('Completa todos los campos requeridos', 'error');
                return;
            }
            
            // Validaci√≥n b√°sica: los dropdowns ya garantizan formato y rango v√°lidos
            // Solo validar que la hora de fin sea posterior a la de inicio
            const startTime = new Date(`2000-01-01T${formData.start_time}:00`);
            const endTime = new Date(`2000-01-01T${formData.end_time}:00`);
            
            if (endTime <= startTime) {
                showNotification('La hora de fin debe ser posterior a la de inicio', 'error');
                return;
            }
            
            // Validar duraci√≥n m√≠nima (30 minutos) y m√°xima (3 horas)
            const durationMs = endTime - startTime;
            const durationMinutes = durationMs / (1000 * 60);
            
            if (durationMinutes < 30) {
                showNotification('La sesi√≥n debe durar al menos 30 minutos', 'error');
                return;
            }
            
            if (durationMinutes > 180) {
                showNotification('La sesi√≥n no puede durar m√°s de 3 horas', 'error');
                return;
            }
            
            const submitBtn = document.querySelector('#sessionRequestForm button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Enviando...';
            submitBtn.disabled = true;
            
            fetch('/api/coachee/request-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Solicitud enviada correctamente. Tu coach te responder√° pronto.', 'success');
                    resetSessionForm();
                    loadMySessions(); // Refrescar las sesiones
                } else {
                    showNotification(data.error || 'Error enviando solicitud', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error enviando solicitud', 'error');
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        }

        function resetSessionForm() {
            document.getElementById('sessionRequestForm').reset();
            document.getElementById('sessionTitle').value = 'Sesi√≥n de Coaching';
            document.getElementById('sessionLocation').value = 'Virtual - Zoom';
        }

        function loadMySessions() {
            fetch('/api/coachee/my-sessions')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayMySessions(data.sessions);
                        updateMySessionsCount(data.sessions.length);
                    }
                })
                .catch(error => {
                    console.error('Error cargando mis sesiones:', error);
                    document.getElementById('mySessionsList').innerHTML = 
                        '<p class="text-danger">Error cargando sesiones</p>';
                });
        }

        function displayMySessions(sessions) {
            const container = document.getElementById('mySessionsList');
            if (!container) return;
            
            if (sessions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No tienes sesiones programadas</p>
                        <button class="btn btn-primary" onclick="showTab('schedule-coach'); document.getElementById('schedule-request-tab').click();">
                            <i class="fas fa-plus me-2"></i>Solicitar Primera Sesi√≥n
                        </button>
                    </div>
                `;
                return;
            }
            
            // Ordenar sesiones por fecha descendente (m√°s reciente primero)
            sessions.sort((a, b) => new Date(b.session_date + 'T12:00:00') - new Date(a.session_date + 'T12:00:00'));
            
            const html = sessions.map(session => {
                const statusColors = {
                    'pending': 'warning',
                    'confirmed': 'success',
                    'proposed': 'info',
                    'cancelled': 'danger',
                    'completed': 'secondary'
                };
                
                const statusTexts = {
                    'pending': 'Pendiente de confirmaci√≥n',
                    'confirmed': 'Confirmada',
                    'proposed': 'Propuesta pendiente',
                    'cancelled': 'Cancelada',
                    'completed': 'Completada'
                };
                
                const sessionDate = new Date(session.session_date + 'T12:00:00');
                const isProposal = session.status === 'proposed' && session.original_session_id;
                const isDirectAppointment = session.created_by_coach && session.status === 'pending';
                
                return `
                    <div class="card mb-3 my-session-card">
                        <div class="card-body my-session-card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h6 class="mb-1 my-session-title">${session.title}</h6>
                                    <p class="mb-1 my-session-text">
                                        <i class="fas fa-user me-1"></i>
                                        Coach: ${session.coach_name}
                                    </p>
                                    <p class="mb-1 my-session-text">
                                        <i class="fas fa-calendar me-1"></i>
                                        ${sessionDate.toLocaleDateString('es-ES', { 
                                            weekday: 'long', 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        })} a las ${session.start_time}
                                    </p>
                                    <p class="mb-1 my-session-text">
                                        <i class="fas fa-map-marker-alt me-1"></i>
                                        ${session.location || 'Por definir'}
                                    </p>
                                    ${session.description ? `<p class="mb-1 my-session-description">${session.description}</p>` : ''}
                                    ${isProposal && session.proposal_message ? 
                                        `<div class="alert alert-info alert-sm mt-2 mb-0">
                                            <i class="fas fa-info-circle me-1"></i>
                                            <strong>Mensaje del coach:</strong> ${session.proposal_message}
                                        </div>` : ''
                                    }
                                    ${isDirectAppointment && session.notification_message ? 
                                        `<div class="alert alert-primary alert-sm mt-2 mb-0">
                                            <i class="fas fa-envelope me-1"></i>
                                            <strong>Mensaje del coach:</strong> ${session.notification_message}
                                        </div>` : ''
                                    }
                                </div>
                                <div class="col-md-4 text-end">
                                    <span class="badge bg-${statusColors[session.status]} mb-2 d-block">
                                        ${statusTexts[session.status]}
                                    </span>
                                    ${isProposal ? `
                                        <div class="d-flex gap-1 justify-content-end">
                                            <button class="btn btn-success btn-sm" onclick="respondToProposal(${session.id}, 'accept_proposal')">
                                                <i class="fas fa-check me-1"></i>Aceptar
                                            </button>
                                            <button class="btn btn-danger btn-sm" onclick="respondToProposal(${session.id}, 'reject_proposal')">
                                                <i class="fas fa-times me-1"></i>Rechazar
                                            </button>
                                        </div>
                                    ` : ''}
                                    ${isDirectAppointment ? `
                                        <div class="d-flex gap-1 justify-content-end">
                                            <button class="btn btn-success btn-sm" onclick="respondToProposal(${session.id}, 'accept_direct')">
                                                <i class="fas fa-check me-1"></i>Aceptar
                                            </button>
                                            <button class="btn btn-danger btn-sm" onclick="respondToProposal(${session.id}, 'reject_direct')">
                                                <i class="fas fa-times me-1"></i>Rechazar
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function updateMySessionsCount(count) {
            const badge = document.getElementById('mySessionsCount');
            if (badge) {
                if (count > 0) {
                    badge.textContent = count;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function respondToProposal(sessionId, action) {
            let actionText, confirmMsg;
            
            if (action === 'accept_proposal') {
                actionText = 'aceptar esta propuesta';
                confirmMsg = '¬øEst√°s seguro de que quieres aceptar esta propuesta de cambio de horario?';
            } else if (action === 'reject_proposal') {
                actionText = 'rechazar esta propuesta';
                confirmMsg = '¬øEst√°s seguro de que quieres rechazar esta propuesta? La sesi√≥n original se mantendr√°.';
            } else if (action === 'accept_direct') {
                actionText = 'aceptar esta cita';
                confirmMsg = '¬øEst√°s seguro de que quieres aceptar esta cita? Se confirmar√° en tu calendario.';
            } else if (action === 'reject_direct') {
                actionText = 'rechazar esta cita';
                confirmMsg = '¬øEst√°s seguro de que quieres rechazar esta cita del coach?';
            }
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            fetch(`/api/coachee/session/${sessionId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ action: action })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message, 'success');
                    loadMySessions();
                } else {
                    showNotification(data.error || 'Error procesando respuesta', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error procesando respuesta', 'error');
            });
        }

        function refreshMySessions() {
            loadMySessions();
            showNotification('Sesiones actualizadas', 'info');
        }

        function activateRequestTab() {
            
            const requestTab = document.getElementById('schedule-request-tab');
            const requestPane = document.getElementById('schedule-request-pane');
            const mySessionsTab = document.getElementById('my-sessions-tab');
            const mySessionsPane = document.getElementById('my-sessions-pane');
            
            if (requestTab && requestPane && mySessionsTab && mySessionsPane) {
                // Desactivar pesta√±a de sesiones
                mySessionsTab.classList.remove('active');
                mySessionsTab.setAttribute('aria-selected', 'false');
                mySessionsPane.classList.remove('show', 'active');
                
                // Activar pesta√±a de solicitud
                requestTab.classList.add('active');
                requestTab.setAttribute('aria-selected', 'true');
                requestPane.classList.add('show', 'active');
                
                // Configurar formulario
                setTimeout(() => {
                    setupSessionRequestForm();
                }, 200);
            } else {
                console.error('‚ùå No se pudieron encontrar las pesta√±as para activar');
            }
        }

        function activateMySessionsTab() {
            
            const requestTab = document.getElementById('schedule-request-tab');
            const requestPane = document.getElementById('schedule-request-pane');
            const mySessionsTab = document.getElementById('my-sessions-tab');
            const mySessionsPane = document.getElementById('my-sessions-pane');
            
            if (requestTab && requestPane && mySessionsTab && mySessionsPane) {
                // Desactivar pesta√±a de solicitud
                requestTab.classList.remove('active');
                requestTab.setAttribute('aria-selected', 'false');
                requestPane.classList.remove('show', 'active');
                
                // Activar pesta√±a de sesiones
                mySessionsTab.classList.add('active');
                mySessionsTab.setAttribute('aria-selected', 'true');
                mySessionsPane.classList.add('show', 'active');
                
                // Cargar sesiones
                setTimeout(() => {
                    loadMySessions();
                }, 200);
            } else {
                console.error('‚ùå No se pudieron encontrar las pesta√±as para activar');
            }
        }

        function switchToRequestTab() {
            activateRequestTab();
            showNotification('Completa el formulario para solicitar una nueva sesi√≥n', 'info');
        }

        function showNotification(message, type = 'info') {
            // Crear notificaci√≥n temporal
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 15000; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-1"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Modificar showTab para incluir inicializaci√≥n de agendamiento
        const originalShowTab = window.showTab;
        window.showTab = function(tabId) {
            originalShowTab(tabId);
            
            if (tabId === 'schedule-coach') {
                setTimeout(initializeCoacheeScheduling, 100); // Peque√±o delay para asegurar que el DOM est√© listo
            }
        };

        // Agregar event listeners para las sub-pesta√±as del calendario
        document.addEventListener('DOMContentLoaded', function() {
            
            // Event listener para cuando se activa la pesta√±a "Solicitar Sesi√≥n"
            const scheduleRequestTab = document.getElementById('schedule-request-tab');
            if (scheduleRequestTab) {
                
                // Event listener para Bootstrap tab
                scheduleRequestTab.addEventListener('shown.bs.tab', function (e) {
                    setTimeout(setupSessionRequestForm, 100);
                });
                
                // Event listener manual para click
                scheduleRequestTab.addEventListener('click', function (e) {
                    e.preventDefault();
                    activateRequestTab();
                });
            } else {
                console.error('‚ùå Pesta√±a "Solicitar Sesi√≥n" no encontrada');
            }

            // Event listener para cuando se activa la pesta√±a "Mis Sesiones"
            const mySessionsTab = document.getElementById('my-sessions-tab');
            if (mySessionsTab) {
                
                mySessionsTab.addEventListener('shown.bs.tab', function (e) {
                    setTimeout(loadMySessions, 100);
                });
                
                // Event listener manual para click
                mySessionsTab.addEventListener('click', function (e) {
                    e.preventDefault();
                    activateMySessionsTab();
                });
            } else {
                console.error('‚ùå Pesta√±a "Mis Sesiones" no encontrada');
            }
        });

        // Funci√≥n para obtener fecha/hora en zona horaria de Santiago
        function getSantiagoDateTime() {
            const now = new Date();
            // Santiago de Chile: GMT-3 (horario de verano) o GMT-4 (horario est√°ndar)
            // Usar Intl.DateTimeFormat para obtener la hora local correcta
            const santiagoTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Santiago"}));
            return santiagoTime;
        }

        function getSantiagoDate() {
            const santiagoTime = getSantiagoDateTime();
            return santiagoTime.toISOString().split('T')[0];
        }

        function getSantiagoTomorrow() {
            const santiagoTime = getSantiagoDateTime();
            santiagoTime.setDate(santiagoTime.getDate() + 1);
            return santiagoTime.toISOString().split('T')[0];
        }

        // Funci√≥n para solicitar plan de desarrollo al coach
        async function requestDevelopmentPlan() {
            try {
                // Prellenar datos del usuario actual
                if (currentUser) {
                    document.getElementById('planName').value = currentUser.full_name || '';
                    document.getElementById('planEmail').value = currentUser.email || '';
                }
                
                // Guardar el ID de evaluaci√≥n actual
                document.getElementById('planEvaluationId').value = window.currentEvaluationId;
                
                // Cerrar el modal de detalles de evaluaci√≥n
                const detailsModal = bootstrap.Modal.getInstance(document.getElementById('evaluationDetailsModal'));
                if (detailsModal) {
                    detailsModal.hide();
                }
                
                // Abrir el nuevo modal de solicitud de plan
                setTimeout(() => {
                    const planModal = new bootstrap.Modal(document.getElementById('requestDevelopmentPlanModal'));
                    planModal.show();
                }, 300);
                
            } catch (error) {
                console.error('Error opening development plan modal:', error);
                showToast('Error abriendo formulario de solicitud', 'error');
            }
        }
        
        // Funci√≥n para enviar la solicitud de plan de desarrollo
        async function submitDevelopmentPlanRequest() {
            try {
                // Obtener datos del formulario
                const evaluationId = document.getElementById('planEvaluationId').value;
                const name = document.getElementById('planName').value.trim();
                const email = document.getElementById('planEmail').value.trim();
                const priority = document.getElementById('planPriority').value;
                const goals = document.getElementById('planGoals').value.trim();
                const message = document.getElementById('planMessage').value.trim();
                
                // Obtener √°reas de enfoque seleccionadas
                const focusAreas = [];
                if (document.getElementById('focusCommunication').checked) focusAreas.push('Comunicaci√≥n Efectiva');
                if (document.getElementById('focusLeadership').checked) focusAreas.push('Liderazgo de Equipos');
                if (document.getElementById('focusDecision').checked) focusAreas.push('Toma de Decisiones');
                if (document.getElementById('focusConflict').checked) focusAreas.push('Resoluci√≥n de Conflictos');
                if (document.getElementById('focusEmotional').checked) focusAreas.push('Inteligencia Emocional');
                if (document.getElementById('focusProductivity').checked) focusAreas.push('Productividad Personal');
                
                // Validar campos requeridos
                if (!priority) {
                    showToast('Por favor selecciona una prioridad', 'error');
                    return;
                }
                
                if (focusAreas.length === 0) {
                    showToast('Por favor selecciona al menos un √°rea de enfoque', 'error');
                    return;
                }
                
                // Preparar mensaje completo
                let fullMessage = `Solicitud de Plan de Desarrollo\n\n`;
                fullMessage += `√Åreas de enfoque seleccionadas:\n${focusAreas.map(a => `- ${a}`).join('\n')}\n\n`;
                if (goals) fullMessage += `Objetivos espec√≠ficos:\n${goals}\n\n`;
                if (message) fullMessage += `Mensaje adicional:\n${message}`;
                
                // Enviar solicitud al servidor
                const response = await fetch(`${API_BASE_URL}/api/coachee/request-development-plan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        evaluation_id: evaluationId,
                        priority: priority,
                        focus_areas: focusAreas,
                        goals: goals,
                        message: fullMessage
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showToast('¬°Solicitud enviada exitosamente! Tu coach te contactar√° pronto.', 'success');
                    
                    // Cerrar el modal
                    const planModal = bootstrap.Modal.getInstance(document.getElementById('requestDevelopmentPlanModal'));
                    if (planModal) {
                        planModal.hide();
                    }
                    
                    // Limpiar formulario
                    document.getElementById('requestDevelopmentPlanForm').reset();
                    
                    // Deshabilitar el bot√≥n en el modal de detalles si est√° visible
                    const btn = document.getElementById('requestPlanBtn');
                    if (btn) {
                        btn.disabled = true;
                        btn.innerHTML = '<i class="fas fa-check me-1"></i>Solicitud Enviada';
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-outline-success');
                    }
                } else {
                    throw new Error(data.error || 'Error enviando solicitud');
                }
            } catch (error) {
                console.error('Error submitting development plan request:', error);
                showToast('Error enviando solicitud: ' + error.message, 'error');
            }
        }

        // Funci√≥n para abrir modal de contacto con coach
        async function contactCoachForSession(event) {
            try {
                // Prellenar datos del usuario actual si est√°n disponibles
                if (currentUser) {
                    document.getElementById('contactName').value = currentUser.full_name || '';
                    document.getElementById('contactEmail').value = currentUser.email || '';
                }
                
                // Obtener el modal element
                const modalElement = document.getElementById('contactCoachModal');
                
                // Forzar z-index ANTES de mostrar el modal
                modalElement.style.zIndex = '1065';
                
                // Mostrar el modal
                const modal = new bootstrap.Modal(modalElement, {
                    backdrop: true,
                    keyboard: true,
                    focus: true
                });
                
                // Ajustar z-index del backdrop inmediatamente despu√©s de que se cree
                modalElement.addEventListener('show.bs.modal', function onShow() {
                    // Usar setTimeout para asegurar que el backdrop ya existe en el DOM
                    setTimeout(() => {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        if (backdrops.length > 0) {
                            // El √∫ltimo backdrop es el del modal actual
                            const lastBackdrop = backdrops[backdrops.length - 1];
                            lastBackdrop.style.zIndex = '1060';
                        }
                    }, 10);
                }, { once: true });
                
                // Confirmar ajuste despu√©s de que el modal est√© completamente visible
                modalElement.addEventListener('shown.bs.modal', function onShown() {
                    // Doble verificaci√≥n de z-index
                    modalElement.style.zIndex = '1065';
                    const backdrops = document.querySelectorAll('.modal-backdrop');
                    if (backdrops.length > 1) {
                        const lastBackdrop = backdrops[backdrops.length - 1];
                        lastBackdrop.style.zIndex = '1060';
                    }
                }, { once: true });
                
                modal.show();
                
            } catch (error) {
                console.error('Error opening contact coach modal:', error);
                showToast('Error abriendo formulario de contacto', 'error');
            }
        }
        
        // Funci√≥n para enviar el formulario de contacto al coach
        async function submitContactCoachForm() {
            try {
                // Obtener datos del formulario
                const name = document.getElementById('contactName').value.trim();
                const email = document.getElementById('contactEmail').value.trim();
                const phone = document.getElementById('contactPhone').value.trim();
                const whatsapp = document.getElementById('contactWhatsApp').value.trim();
                const contactMethod = document.querySelector('input[name="contactMethod"]:checked').value;
                const availability = document.getElementById('contactAvailability').value.trim();
                const message = document.getElementById('contactMessage').value.trim();
                
                // Validar campos requeridos
                if (!name || !email || !phone) {
                    showToast('Por favor completa todos los campos requeridos', 'error');
                    return;
                }
                
                // Enviar solicitud al backend
                const response = await fetch(`${API_BASE_URL}/api/coachee/contact-coach-session`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        evaluation_id: window.currentEvaluationId,
                        session_type: 'free_consultation',
                        contact_data: {
                            name: name,
                            email: email,
                            phone: phone,
                            whatsapp: whatsapp || phone,
                            preferred_method: contactMethod,
                            availability: availability,
                            message: message || 'Solicito una sesi√≥n gratuita de 30 minutos para desarrollar mis habilidades.'
                        }
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    // Cerrar el modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('contactCoachModal'));
                    if (modal) modal.hide();
                    
                    // Mostrar mensaje de √©xito
                    showToast('¬°Solicitud enviada! Un coach se contactar√° contigo pronto para coordinar tu sesi√≥n gratuita.', 'success');
                    
                    // Limpiar el formulario
                    document.getElementById('contactCoachForm').reset();
                    
                    // Opcional: Deshabilitar el bot√≥n "Contactar Coach" en los resultados
                    const buttons = document.querySelectorAll('button[onclick*="contactCoachForSession"]');
                    buttons.forEach(button => {
                        button.disabled = true;
                        button.innerHTML = '<i class="fas fa-check me-2"></i>Solicitud Enviada';
                        button.classList.remove('btn-light');
                        button.classList.add('btn-outline-success');
                    });
                } else {
                    throw new Error(data.error || 'Error enviando solicitud');
                }
            } catch (error) {
                console.error('Error submitting contact coach form:', error);
                showToast('Error enviando solicitud: ' + error.message, 'error');
            }
        }

        // Generar resumen espec√≠fico para evaluaci√≥n de Asertividad
        function generateAssertivenessSummary(score, dimensionalScores) {
            let summary = '';
            let generalRecommendation = '';
            
            if (score >= 80) {
                summary = 'Excelente nivel de asertividad. Mantienes un equilibrio perfecto entre expresar tus necesidades y respetar a otros.';
                generalRecommendation = 'Contin√∫a desarrollando tus habilidades de liderazgo y considera ser mentor de otros en el desarrollo de asertividad.';
            } else if (score >= 60) {
                summary = 'Buen nivel de asertividad. Tienes habilidades s√≥lidas con algunas √°reas de mejora espec√≠ficas.';
                generalRecommendation = 'Enf√≥cate en fortalecer las dimensiones con puntuaciones m√°s bajas. Practica t√©cnicas de comunicaci√≥n asertiva en situaciones desafiantes.';
            } else if (score >= 40) {
                summary = 'Nivel moderado de asertividad. Hay oportunidades significativas de desarrollo en varias √°reas.';
                generalRecommendation = 'Considera tomar un curso de comunicaci√≥n asertiva y practica t√©cnicas de autoconfianza. Trabaja en expresar tus opiniones de manera clara y respetuosa.';
            } else {
                summary = 'Nivel bajo de asertividad. Es prioritario desarrollar estas habilidades fundamentales.';
                generalRecommendation = 'Recomendamos trabajar con un coach o tomar capacitaci√≥n especializada en asertividad. Comienza con ejercicios de autoconfianza y expresi√≥n de necesidades b√°sicas.';
            }
            
            return { summary, generalRecommendation };
        }

        // Generar secci√≥n HTML de fortalezas y debilidades para Asertividad
        function generateAssertivenessSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluaci√≥n de Asertividad
            if (isDiscAssessment || isEmotionalIntelligenceAssessment || isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension) {
                            case 'comunicacion':
                                fortalezaMsg = 'Te comunicas de manera clara y directa, expresando tus ideas con confianza.';
                                break;
                            case 'derechos':
                                fortalezaMsg = 'Sabes defender tus derechos personales de manera equilibrada y respetuosa.';
                                break;
                            case 'opiniones':
                                fortalezaMsg = 'Expresas tus opiniones con seguridad y autenticidad.';
                                break;
                            case 'conflictos':
                                fortalezaMsg = 'Manejas los conflictos de manera constructiva y efectiva.';
                                break;
                            case 'autoconfianza':
                                fortalezaMsg = 'Tienes una s√≥lida confianza en ti mismo/a y en tus capacidades.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension) {
                            case 'comunicacion':
                                debilidadMsg = 'Puedes mejorar la claridad y efectividad en tu comunicaci√≥n.';
                                break;
                            case 'derechos':
                                debilidadMsg = 'Te resulta dif√≠cil defender tus derechos o establecer l√≠mites claros.';
                                break;
                            case 'opiniones':
                                debilidadMsg = 'Necesitas m√°s confianza para expresar tus opiniones en diferentes situaciones.';
                                break;
                            case 'conflictos':
                                debilidadMsg = 'Los conflictos te generan incomodidad y podr√≠as manejarlos de manera m√°s efectiva.';
                                break;
                            case 'autoconfianza':
                                debilidadMsg = 'Tu autoconfianza necesita fortalecerse para actuar con mayor seguridad.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las √°reas tienen potencial de mejora significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¬°Excelente! Todas las √°reas muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-line me-2"></i>An√°lisis de tu Perfil de Asertividad</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-thumbs-up me-2"></i>Tus Fortalezas
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-target me-2"></i>√Åreas de Oportunidad
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateDiscSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluaci√≥n DISC
            if (!isDiscAssessment || isEmotionalIntelligenceAssessment || isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales DISC
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'dominance':
                            case 'dominancia':
                                fortalezaMsg = 'Tienes una personalidad decidida y orientada a resultados, excelente para liderar y tomar decisiones dif√≠ciles.';
                                break;
                            case 'influence':
                            case 'influencia':
                                fortalezaMsg = 'Posees habilidades naturales para comunicar, motivar e influir positivamente en otros.';
                                break;
                            case 'steadiness':
                            case 'estabilidad':
                                fortalezaMsg = 'Eres una persona confiable, paciente y colaborativa, creando un ambiente de trabajo estable.';
                                break;
                            case 'conscientiousness':
                            case 'cumplimiento':
                                fortalezaMsg = 'Te destacas por tu atenci√≥n al detalle, calidad en el trabajo y cumplimiento de est√°ndares.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'dominance':
                            case 'dominancia':
                                debilidadMsg = 'Puedes desarrollar mayor asertividad y capacidad de liderazgo en situaciones desafiantes.';
                                break;
                            case 'influence':
                            case 'influencia':
                                debilidadMsg = 'Podr√≠as fortalecer tus habilidades de comunicaci√≥n e influencia interpersonal.';
                                break;
                            case 'steadiness':
                            case 'estabilidad':
                                debilidadMsg = 'Desarrollar mayor paciencia y habilidades de colaboraci√≥n te beneficiar√≠a en el trabajo en equipo.';
                                break;
                            case 'conscientiousness':
                            case 'cumplimiento':
                                debilidadMsg = 'Mejorar la atenci√≥n al detalle y sistematizaci√≥n te ayudar√° a alcanzar mayor calidad en tu trabajo.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las dimensiones tienen potencial de desarrollo significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¬°Excelente! Todas las dimensiones muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas (DISC) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-user-circle me-2"></i>An√°lisis de tu Perfil DISC de Personalidad</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-star me-2"></i>Tus Fortalezas Naturales
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-chart-line me-2"></i>√Åreas de Desarrollo
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateEmotionalIntelligenceSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluaci√≥n de Inteligencia Emocional
            if (isDiscAssessment || !isEmotionalIntelligenceAssessment || isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales de IE
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'autoconciencia':
                            case 'self_awareness':
                                fortalezaMsg = 'Tienes un excelente conocimiento de tus emociones y c√≥mo estas afectan tu comportamiento.';
                                break;
                            case 'autoregulacion':
                            case 'self_regulation':
                                fortalezaMsg = 'Posees gran habilidad para manejar y controlar tus emociones de manera constructiva.';
                                break;
                            case 'motivacion':
                            case 'motivation':
                                fortalezaMsg = 'Demuestras una fuerte motivaci√≥n interna y capacidad para mantener el enfoque en tus objetivos.';
                                break;
                            case 'empatia':
                            case 'empathy':
                                fortalezaMsg = 'Tienes una capacidad natural para entender y conectar con las emociones de otros.';
                                break;
                            case 'habilidades_sociales':
                            case 'social_skills':
                                fortalezaMsg = 'Destacas en el manejo de relaciones interpersonales y comunicaci√≥n emocional efectiva.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'autoconciencia':
                            case 'self_awareness':
                                debilidadMsg = 'Desarrollar mayor autoconciencia emocional te ayudar√° a entender mejor tus reacciones.';
                                break;
                            case 'autoregulacion':
                            case 'self_regulation':
                                debilidadMsg = 'Fortalecer la autoregulaci√≥n te permitir√° manejar mejor situaciones emocionales desafiantes.';
                                break;
                            case 'motivacion':
                            case 'motivation':
                                debilidadMsg = 'Trabajar en tu motivaci√≥n interna te dar√° mayor resistencia ante los obst√°culos.';
                                break;
                            case 'empatia':
                            case 'empathy':
                                debilidadMsg = 'Desarrollar mayor empat√≠a mejorar√° significativamente tus relaciones interpersonales.';
                                break;
                            case 'habilidades_sociales':
                            case 'social_skills':
                                debilidadMsg = 'Mejorar tus habilidades sociales te permitir√° comunicarte m√°s efectivamente con otros.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las competencias emocionales tienen potencial de desarrollo significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¬°Excelente! Todas las competencias muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas (IE) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-brain me-2"></i>An√°lisis de tu Inteligencia Emocional</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-heart me-2"></i>Tus Competencias Desarrolladas
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-seedling me-2"></i>Competencias en Desarrollo
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateTeamworkSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluaci√≥n de Trabajo en Equipo
            if (isDiscAssessment || isEmotionalIntelligenceAssessment || !isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales de Trabajo en Equipo
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'comunicacion':
                            case 'communication':
                                fortalezaMsg = 'Excelentes habilidades de comunicaci√≥n en equipo, facilitando la colaboraci√≥n efectiva.';
                                break;
                            case 'colaboracion':
                            case 'collaboration':
                                fortalezaMsg = 'Demuestras una gran capacidad para trabajar de manera colaborativa y constructiva con otros.';
                                break;
                            case 'liderazgo':
                            case 'leadership':
                                fortalezaMsg = 'Posees habilidades naturales de liderazgo que inspiran y gu√≠an al equipo hacia el √©xito.';
                                break;
                            case 'resolucion_conflictos':
                            case 'conflict_resolution':
                                fortalezaMsg = 'Tienes una excelente capacidad para resolver conflictos y mantener la armon√≠a del equipo.';
                                break;
                            case 'adaptabilidad':
                            case 'adaptability':
                                fortalezaMsg = 'Tu flexibilidad y adaptabilidad son fortalezas clave para el trabajo en equipos din√°micos.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'comunicacion':
                            case 'communication':
                                debilidadMsg = 'Mejorar tu comunicaci√≥n en equipo facilitar√° una colaboraci√≥n m√°s efectiva.';
                                break;
                            case 'colaboracion':
                            case 'collaboration':
                                debilidadMsg = 'Desarrollar mejores habilidades colaborativas te ayudar√° a contribuir m√°s al equipo.';
                                break;
                            case 'liderazgo':
                            case 'leadership':
                                debilidadMsg = 'Fortalecer tus habilidades de liderazgo te permitir√° guiar mejor a tu equipo.';
                                break;
                            case 'resolucion_conflictos':
                            case 'conflict_resolution':
                                debilidadMsg = 'Mejorar en resoluci√≥n de conflictos crear√° un ambiente de trabajo m√°s armonioso.';
                                break;
                            case 'adaptabilidad':
                            case 'adaptability':
                                debilidadMsg = 'Desarrollar mayor adaptabilidad te ayudar√° a responder mejor a los cambios del equipo.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las competencias de equipo tienen potencial de desarrollo significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¬°Excelente! Todas las competencias muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas (Trabajo en Equipo) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-users me-2"></i>An√°lisis de tus Competencias de Trabajo en Equipo</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-trophy me-2"></i>Tus Fortalezas Colaborativas
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-hand-holding-up me-2"></i>Competencias en Desarrollo
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        
        // ========== INSTAGRAM STYLE FEEDS FUNCTIONALITY ==========
        
        // Extender showTab para cargar feeds cuando se active la pesta√±a
        const existingShowTab = window.showTab;
        window.showTab = function(tabId) {
            existingShowTab(tabId);
            
            if (tabId === 'feeds') {
                setTimeout(loadInstagramFeeds, 100);
            }
        };
        
        // Funci√≥n para cargar feeds desde la API
        async function loadInstagramFeeds() {
            
            const container = document.getElementById('feedsContainer');
            if (!container) {
                return;
            }
            
            try {
                const response = await fetch('/api/coachee/content');
                const data = await response.json();
                
                
                if (data.success && data.content && data.content.length > 0) {
                    displayInstagramFeeds(data.content);
                } else {
                    displayNoFeeds();
                }
            } catch (error) {
                console.error('‚ùå Error loading feeds:', error);
                displayFeedsError();
            }
        }
        
        // Funci√≥n para mostrar feeds en formato Instagram
        function displayInstagramFeeds(content) {
            const container = document.getElementById('feedsContainer');
            if (!container) return;
            
            let feedsHTML = '';
            
            content.forEach((item, index) => {
                const videoId = extractYouTubeVideoId(item.content_url);
                const isYouTubeVideo = videoId && item.content_type === 'video';
                const isDocument = item.content_type === 'document';
                
                // Determinar el thumbnail/preview
                let thumbnail;
                if (isYouTubeVideo) {
                    thumbnail = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
                } else if (isDocument) {
                    // Para documentos, generaremos un preview
                    thumbnail = null; // Se generar√° din√°micamente
                } else {
                    // Fallback para otros tipos de video
                    thumbnail = 'data:image/svg+xml;base64,' + btoa(`
                        <svg width="600" height="400" xmlns="http://www.w3.org/2000/svg">
                            <rect width="600" height="400" fill="#f8f9fa"/>
                            <circle cx="300" cy="200" r="60" fill="#6c757d"/>
                            <polygon points="270,170 270,230 330,200" fill="white"/>
                        </svg>
                    `);
                }
                
                // Calcular tiempo relativo
                const timeAgo = getRelativeTime(item.assigned_at);
                
                feedsHTML += `
                    <div class="instagram-post">
                        <!-- Header del post -->
                        <div class="post-header">
                            <div class="post-author">
                                <div class="author-avatar">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="author-info">
                                    <h6>${item.coach_name}</h6>
                                    <small>${timeAgo}</small>
                                </div>
                            </div>
                            <button class="post-options">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>
                        
                        <!-- Media del post -->
                        <div class="post-media">
                            ${isYouTubeVideo ? `
                                <div class="ratio ratio-4x3">
                                    <iframe id="youtube-feed-${item.id}" 
                                        src="https://www.youtube.com/embed/${videoId}?enablejsapi=1" 
                                        title="${item.title}" 
                                        frameborder="0" 
                                        allowfullscreen
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        style="border-radius: 8px;">
                                    </iframe>
                                </div>
                            ` : isDocument ? `
                                <div class="document-preview-container" id="doc-container-${item.id}" style="position: relative; height: 280px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; transition: height 0.3s ease;">
                                    <div id="doc-content-${item.id}" style="width: 100%; height: 100%; overflow-y: auto;">
                                        <canvas id="doc-preview-${item.id}"
                                                width="1200"
                                                height="1000"
                                                style="width: 100%; height: auto; border-radius: 8px; display: block;">
                                        </canvas>
                                    </div>
                                    <div class="document-controls" style="position: absolute; top: 10px; right: 10px; display: flex; gap: 8px;">
                                        <div class="document-overlay" style="background: rgba(0,0,0,0.7); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer;"
                                             onclick="toggleDocumentExpand(${item.id}, '${item.content_url}')" title="Expandir/Contraer documento">
                                            <i id="expand-icon-${item.id}" class="fas fa-expand" style="color: white; font-size: 14px;"></i>
                                        </div>
                                        <div class="document-overlay" style="background: rgba(0,0,0,0.7); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer;"
                                             onclick="openDocumentFeed('${item.content_url}', '${item.title}')" title="Abrir en nueva pesta√±a">
                                            <i class="fas fa-external-link-alt" style="color: white; font-size: 14px;"></i>
                                        </div>
                                    </div>
                                </div>
                            ` : `
                                <div onclick="openVideoFeed('${item.content_url}')">
                                    <img src="${thumbnail}" 
                                         alt="${item.title}" 
                                         class="post-image"
                                         onerror="this.src='data:image/svg+xml;base64,${btoa(`
                                             <svg width="600" height="400" xmlns="http://www.w3.org/2000/svg">
                                                 <rect width="600" height="400" fill="#f8f9fa"/>
                                                 <circle cx="300" cy="200" r="60" fill="#6c757d"/>
                                                 <polygon points="270,170 270,230 330,200" fill="white"/>
                                                 <text x="300" y="280" font-family="Arial" font-size="18" text-anchor="middle" fill="#6c757d">Video</text>
                                             </svg>
                                         `)}'">
                                    <div class="video-overlay">
                                        <i class="fas fa-play"></i>
                                    </div>
                                </div>
                            `}
                        </div>
                        
                        <!-- Acciones del post -->
                        <div class="post-actions">
                            <div class="action-buttons">
                                <button class="action-btn" onclick="toggleLikeFeed(${item.id}, this)" title="Me gusta">
                                    <i class="far fa-heart"></i>
                                </button>
                                ${isYouTubeVideo ? `
                                    <button class="action-btn" disabled style="color: #28a745; opacity: 0.7;" title="Video embebido">
                                        <i class="fas fa-play-circle"></i>
                                    </button>
                                ` : isDocument ? `
                                    <button class="action-btn" onclick="openDocumentFeed('${item.content_url}', '${item.title}')" title="Abrir documento">
                                        <i class="far fa-file-alt"></i>
                                    </button>
                                ` : `
                                    <button class="action-btn" onclick="openVideoFeed('${item.content_url}')" title="Reproducir video">
                                        <i class="far fa-play-circle"></i>
                                    </button>
                                `}
                                <button class="action-btn" onclick="shareFeed(${item.id})" title="Compartir">
                                    <i class="far fa-paper-plane"></i>
                                </button>
                            </div>
                            <button class="action-btn" title="Guardar">
                                <i class="far fa-bookmark"></i>
                            </button>
                        </div>
                        
                        <!-- Informaci√≥n del post -->
                        <div class="post-info">
                            <div class="post-likes">
                                <strong>${Math.floor(Math.random() * 50) + 10} me gusta</strong>
                            </div>
                            <div class="post-caption">
                                <span class="username">${item.coach_name}</span>
                                ${item.title}
                                ${item.description ? '<br><small class="text-muted">' + item.description + '</small>' : ''}
                            </div>
                            <div class="post-time">
                                ${timeAgo}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = feedsHTML;
            
            // Generar previews de documentos despu√©s de insertar el HTML
            content.forEach(item => {
                if (item.content_type === 'document') {
                    const canvasId = `doc-preview-${item.id}`;
                    // Delay para asegurar que el canvas est√© en el DOM
                    setTimeout(() => {
                        const canvas = document.getElementById(canvasId);
                        if (canvas) {
                            generateDocumentPreview(item.content_url, canvasId);
                        } else {
                            console.error(`‚ùå [DOCUMENT PREVIEW] Canvas not found: ${canvasId}`);
                        }
                    }, 500);
                }
            });
        }
        
        // Funci√≥n para calcular tiempo relativo
        function getRelativeTime(dateString) {
            if (!dateString) return 'Hace un momento';
            
            const now = new Date();
            const date = new Date(dateString);
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays > 0) {
                return `Hace ${diffDays} d√≠a${diffDays > 1 ? 's' : ''}`;
            } else if (diffHours > 0) {
                return `Hace ${diffHours} hora${diffHours > 1 ? 's' : ''}`;
            } else {
                return 'Hace un momento';
            }
        }
        
        // Funci√≥n para extraer ID de YouTube
        function extractYouTubeVideoId(url) {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
        
        // Funci√≥n para abrir video en nueva pesta√±a
        function openVideoFeed(url) {
            window.open(url, '_blank');
        }
        
        // Funci√≥n para toggle like
        function toggleLikeFeed(contentId, button) {
            const icon = button.querySelector('i');
            if (icon.classList.contains('far')) {
                icon.classList.remove('far');
                icon.classList.add('fas');
                button.classList.add('liked');
            } else {
                icon.classList.remove('fas');
                icon.classList.add('far');
                button.classList.remove('liked');
            }
        }
        
        // Funci√≥n para compartir
        function shareFeed(contentId) {
            showToast('¬°Funcionalidad de compartir pr√≥ximamente!', 'info');
        }
        
        // Funci√≥n para abrir documento en nueva pesta√±a
        function openDocumentFeed(url, title) {
            window.open(url, '_blank');
        }
        
        // Funci√≥n para expandir/contraer documento en la vista
        function toggleDocumentExpand(itemId, url) {
            const container = document.getElementById(`doc-container-${itemId}`);
            const content = document.getElementById(`doc-content-${itemId}`);
            const icon = document.getElementById(`expand-icon-${itemId}`);
            
            if (!container) return;
            
            const isExpanded = container.getAttribute('data-expanded') === 'true';
            
            if (isExpanded) {
                // Contraer
                container.style.height = '280px';
                container.setAttribute('data-expanded', 'false');
                icon.className = 'fas fa-expand';
            } else {
                // Expandir
                container.style.height = '600px';
                container.setAttribute('data-expanded', 'true');
                icon.className = 'fas fa-compress';
                
                // Si a√∫n no se ha cargado el PDF completo, cargarlo ahora
                const canvas = document.getElementById(`doc-preview-${itemId}`);
                if (canvas && !canvas.getAttribute('data-full-loaded')) {
                    generateFullDocumentPreview(url, `doc-preview-${itemId}`);
                    canvas.setAttribute('data-full-loaded', 'true');
                }
            }
        }
        
        // Funci√≥n para generar vista completa del documento
        async function generateFullDocumentPreview(url, canvasId) {
            
            if (typeof pdfjsLib === 'undefined') {
                console.error('‚ùå [FULL PDF] PDF.js not loaded');
                return;
            }
            
            try {
                const canvas = document.getElementById(canvasId);
                if (!canvas) return;
                
                const loadingTask = pdfjsLib.getDocument(url);
                const pdf = await loadingTask.promise;
                
                
                // Renderizar la primera p√°gina con mejor calidad
                const page = await pdf.getPage(1);
                const viewport = page.getViewport({ scale: 2.0 }); // Mayor escala para mejor calidad
                
                canvas.width = viewport.width;
                canvas.height = viewport.height;
                
                const ctx = canvas.getContext('2d');
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                await page.render({
                    canvasContext: ctx,
                    viewport: viewport
                }).promise;
                
            } catch (error) {
                console.error('‚ùå [FULL PDF] Error loading document:', error);
            }
        }
        
        // Funciones de PDF.js para preview de documentos
    async function generatePDFPreview(url, canvasId, maxWidth = 1200, maxHeight = 1000) {
            
            if (typeof pdfjsLib === 'undefined') {
                console.error('‚ùå [PDF PREVIEW] PDF.js not loaded');
                return;
            }
            
            try {
                const canvas = document.getElementById(canvasId);
                if (!canvas) {
                    console.error('‚ùå [PDF PREVIEW] Canvas element not found:', canvasId);
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                
                // Configurar canvas con fondo blanco
                canvas.width = maxWidth;
                canvas.height = maxHeight;
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, maxWidth, maxHeight);
                
                
                // Cargar PDF con configuraci√≥n para CORS
                const loadingTask = pdfjsLib.getDocument({
                    url: url,
                    disableWorker: false,
                    disableAutoFetch: false,
                    disableStream: false
                });
                
                const pdf = await loadingTask.promise;
                
                // Obtener primera p√°gina
                const page = await pdf.getPage(1);
                const viewport = page.getViewport({ scale: 1 });
                
                // Calcular escala para ajustar al canvas manteniendo aspect ratio
                const scaleX = maxWidth / viewport.width;
                const scaleY = maxHeight / viewport.height;
                const scale = Math.min(scaleX, scaleY);
                
                const scaledViewport = page.getViewport({ scale });
                
                // Centrar la p√°gina en el canvas
                const offsetX = (maxWidth - scaledViewport.width) / 2;
                const offsetY = (maxHeight - scaledViewport.height) / 2;
                
                // Crear canvas temporal para renderizar la p√°gina
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = scaledViewport.width;
                tempCanvas.height = scaledViewport.height;
                
                // Renderizar p√°gina en canvas temporal
                const renderContext = {
                    canvasContext: tempCtx,
                    viewport: scaledViewport
                };
                
                await page.render(renderContext).promise;
                
                // Limpiar canvas principal con fondo blanco
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, maxWidth, maxHeight);
                
                // Dibujar p√°gina centrada en canvas principal
                ctx.drawImage(tempCanvas, offsetX, offsetY);
                
                
            } catch (error) {
                console.error('‚ùå Error generating PDF preview:', error);
                // Mostrar icono de error en el canvas
                const canvas = document.getElementById(canvasId);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    canvas.width = maxWidth;
                    canvas.height = maxHeight;
                    
                    // Fondo gris claro
                    ctx.fillStyle = '#f8f9fa';
                    ctx.fillRect(0, 0, maxWidth, maxHeight);
                    
                    // Dibujar texto de error
                    ctx.fillStyle = '#6c757d';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Vista previa no disponible', maxWidth/2, maxHeight/2 - 10);
                    ctx.fillText('üìÑ Documento PDF', maxWidth/2, maxHeight/2 + 10);
                }
            }
        }
        
        // Funci√≥n para generar preview de documento (unified)
        async function generateDocumentPreview(url, canvasId) {
            
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('‚ùå [DOC PREVIEW] Canvas not found:', canvasId);
                return;
            }

            const ctx = canvas.getContext('2d');
            canvas.width = 1200;
            canvas.height = 1000;
            
            // Mostrar indicador de carga inicial
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, 1200, 1000);
            ctx.fillStyle = '#6c757d';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Cargando documento...', 600, 500);
            
            // Verificar si es PDF
            if (url.toLowerCase().includes('.pdf') || url.includes('content_type=document') || url.includes('/download') || url.includes('/view') || url.includes('/preview')) {
                try {
                    await generatePDFPreview(url, canvasId, 1200, 1000);
                } catch (error) {
                    console.error('‚ùå [DOC PREVIEW] PDF preview failed:', error);
                    // Mostrar icono de error
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, 1200, 1000);
                    ctx.fillStyle = '#dc3545';
                    ctx.font = '32px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Error al cargar PDF', 600, 400);
                    ctx.fillStyle = '#6c757d';
                    ctx.font = '96px Arial';
                    ctx.fillText('üìÑ', 600, 700);
                }
            } else {
                // Para otros tipos de documento, mostrar icono gen√©rico
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, 1200, 1000);
                // Dibujar icono de documento
                ctx.fillStyle = '#495057';
                ctx.font = '96px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('üìÑ', 600, 500);
                // Texto descriptivo
                ctx.fillStyle = '#6c757d';
                ctx.font = '32px Arial';
                ctx.fillText('Documento', 600, 700);
            }
        }
        
        // Funci√≥n para refrescar feeds
        function refreshFeeds() {
            const container = document.getElementById('feedsContainer');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Actualizando feeds...</span>
                        </div>
                        <p class="text-muted">Actualizando contenido...</p>
                    </div>
                `;
            }
            setTimeout(loadInstagramFeeds, 1000);
        }
        
        // Funci√≥n para mostrar cuando no hay feeds
        function displayNoFeeds() {
            const container = document.getElementById('feedsContainer');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-stream fa-4x text-muted mb-3"></i>
                        <h5 class="text-muted">No hay feeds disponibles</h5>
                        <p class="text-muted">Tu coach a√∫n no ha compartido contenido contigo.</p>
                        <button class="btn btn-outline-primary" onclick="refreshFeeds()">
                            <i class="fas fa-sync-alt me-1"></i>Verificar nuevamente
                        </button>
                    </div>
                `;
            }
        }
        
        // Funci√≥n para mostrar error
        function displayFeedsError() {
            const container = document.getElementById('feedsContainer');
            if (container) {
                container.innerHTML = `
                    <div class="alert alert-warning text-center">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Error al cargar los feeds. 
                        <button class="btn btn-sm btn-outline-warning ms-2" onclick="refreshFeeds()">
                            Reintentar
                        </button>
                    </div>
                `;
            }
        }
        
        // ‚ú® AUTO-START ASSESSMENT: Detectar si viene de invitaci√≥n
        // AUTO-START ASSESSMENT: This block requires server-side template rendering.
        // If using Jinja, ensure this file is processed by Flask or Django.
        // If not using a template engine, remove or replace this block with valid JavaScript.
        
        // ============================================
        // FUNCI√ìN PARA CARGAR VIDEOS EN MI CONTENIDO
        // ============================================
        function loadContentVideos() {
            const loading = document.getElementById('contentLoading');
            const grid = document.getElementById('contentGrid');
            const empty = document.getElementById('contentEmpty');
            
            if (!loading || !grid || !empty) return;
            
            loading.style.display = 'block';
            grid.style.display = 'none';
            empty.style.display = 'none';
            
            fetch('/api/coachee/content', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                },
                credentials: 'include'
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                
                const videos = data.content || [];
                
                if (videos.length === 0) {
                    empty.style.display = 'block';
                    return;
                }
                
                grid.innerHTML = '';
                videos.forEach(video => {
                    const thumbnail = getYouTubeThumbnail(video.content_url);
                    
                    const col = document.createElement('div');
                    col.className = 'col-12 col-md-6 col-lg-4';
                    
                    col.innerHTML = `
                        <div class="card" style="border: 1px solid #e5e7eb; border-radius: 8px; overflow: hidden; cursor: pointer;">
                            <img src="${thumbnail}" 
                                 alt="${video.title}"
                                 style="width: 100%; height: 200px; object-fit: cover;"
                                 onclick="window.open('${video.content_url}', '_blank')">
                            <div style="padding: 1rem;">
                                <h6 style="font-size: 0.9375rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem;">${video.title}</h6>
                                <p style="font-size: 0.8125rem; color: #6b7280; margin-bottom: 0;">Por ${video.coach_name}</p>
                            </div>
                        </div>
                    `;
                    
                    grid.appendChild(col);
                });
                
                grid.style.display = 'flex';
            })
            .catch(error => {
                console.error('Error loading videos:', error);
                loading.style.display = 'none';
                empty.style.display = 'block';
            });
        }
        
        function getYouTubeThumbnail(url) {
            if (!url) return 'https://via.placeholder.com/320x180?text=Video';
            
            let videoId = null;
            
            if (url.includes('youtube.com/watch?v=')) {
                videoId = url.split('v=')[1].split('&')[0];
            } else if (url.includes('youtu.be/')) {
                videoId = url.split('youtu.be/')[1].split('?')[0];
            }
            
            if (videoId) {
                return `https://img.youtube.com/vi/${videoId}/mqdefault.jpg`;
            }
            
            return 'https://via.placeholder.com/320x180?text=Video';
        }
        
        // Cargar videos cuando se hace clic en la pesta√±a Mi Contenido
        document.addEventListener('DOMContentLoaded', function() {
            const contentTab = document.querySelector('button[data-bs-target="#content"]');
            if (contentTab) {
                contentTab.addEventListener('shown.bs.tab', function() {
                    loadContentVideos();
                });
            }
        });
        
    </script>
    
    <!-- Alpine.js - CARGAR DESPU√âS de que coacheeDashboardApp() est√© definido -->
    <script src="{{ url_for('static', filename='js/alpine.min.js') }}"></script>
    
    <!-- Script com√∫n para presentaci√≥n de recomendaciones -->
    <script src="{{ url_for('static', filename='js/recommendations.js') }}"></script>

    <!-- Bottom Navigation - Mejorada con Alpine.js -->
    <nav class="bottom-navigation">
        <!-- Feed -->
        <a href="/coachee-feed" class="nav-item">
            <i class="fas fa-rss"></i>
            <span>Feed</span>
        </a>
        
        <!-- Overview -->
        <button class="nav-item" 
                :class="{ 'active': activeTab === 'overview' }"
                @click.prevent="showDashboardDrawer = false; showTab('overview'); $nextTick(() => window.scrollTo(0,0))">
            <i class="fas fa-chart-pie"></i>
            <span>Overview</span>
        </button>
        
        <!-- Dashboard Menu (con drawer) -->
        <button class="nav-item" @click="showDashboardDrawer = true">
            <i class="fas fa-grip-horizontal"></i>
            <span>M√°s</span>
        </button>
    </nav>

    <!-- Dashboard Drawer (Men√∫ lateral deslizable) -->
    <div class="drawer-backdrop"
         :class="{ 'show': showDashboardDrawer }"
         @click="showDashboardDrawer = false">
    </div>

    <div class="dashboard-drawer"
         :class="{ 'show': showDashboardDrawer }">
        
        <!-- Handle visual para drag (opcional) -->
        <div class="drawer-handle"></div>
        
        <div class="drawer-header">
            <h3>Navegaci√≥n R√°pida</h3>
            <button class="drawer-close" @click="showDashboardDrawer = false">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="drawer-grid">
            <button class="drawer-item" 
                    :class="{ 'active': activeTab === 'overview' }"
                    @click="showTab('overview'); showDashboardDrawer = false; $nextTick(() => window.scrollTo(0,0))">
                <i class="fas fa-home"></i>
                <span>Overview</span>
            </button>
            
            <button class="drawer-item" 
                    :class="{ 'active': activeTab === 'evaluaciones-figma' }"
                    @click="showTab('evaluaciones-figma'); showDashboardDrawer = false; $nextTick(() => window.scrollTo(0,0))">
                <i class="fas fa-chart-bar"></i>
                <span>Evaluaciones</span>
            </button>

            <button class="drawer-item"
                    :class="{ 'active': activeTab === 'tasks' }"
                    @click="showTab('tasks'); showDashboardDrawer = false; $nextTick(() => window.scrollTo(0,0))">
                <i class="fas fa-tasks"></i>
                <span>Mis Acciones y Metas</span>
            </button>

            <button class="drawer-item"
                    :class="{ 'active': activeTab === 'content' }"
                    @click="showTab('content'); showDashboardDrawer = false; $nextTick(() => window.scrollTo(0,0))">
                <i class="fas fa-folder-open"></i>
                <span>Mi Contenido</span>
            </button>

            <button class="drawer-item"
                    :class="{ 'active': activeTab === 'progress' }"
                    @click="showTab('progress'); showDashboardDrawer = false; $nextTick(() => window.scrollTo(0,0))">
                <i class="fas fa-chart-line"></i>
                <span>Mi Progreso</span>
            </button>

            <button class="drawer-item"
                    :class="{ 'active': activeTab === 'development-plan' }"
                    @click="showTab('development-plan'); showDashboardDrawer = false; $nextTick(() => window.scrollTo(0,0))">
                <i class="fas fa-rocket"></i>
                <span>Mi Plan de Desarrollo</span>
            </button>

            <button class="drawer-item"
                    :class="{ 'active': activeTab === 'schedule-coach' }"
                    @click="showTab('schedule-coach'); showDashboardDrawer = false; $nextTick(() => window.scrollTo(0,0))">
                <i class="fas fa-calendar-alt"></i>
                <span>Agendar Coach</span>
            </button>
        </div>
    </div>

    <script>
        // Funci√≥n para confirmar logout desde dashboard
        function confirmLogoutFromDashboard() {
            if (confirm('¬øEst√°s seguro que deseas salir?')) {
                window.location.href = '/participant-access';
            }
        }
        
        // ============================================================================
        // FUNCIONES DE CAMBIO DE CONTRASE√ëA COACHEE
        // ============================================================================
        
        function openChangePasswordModalCoachee() {
            const modal = new bootstrap.Modal(document.getElementById('changePasswordModalCoachee'));
            modal.show();
            
            // Inicializar listeners de validaci√≥n en tiempo real
            setTimeout(() => {
                const newPasswordInput = document.getElementById('coacheeNewPassword');
                const confirmPasswordInput = document.getElementById('coacheeConfirmPassword');
                
                if (newPasswordInput) {
                    newPasswordInput.addEventListener('input', validatePasswordPolicyCoachee);
                }
                
                if (confirmPasswordInput) {
                    confirmPasswordInput.addEventListener('input', validatePasswordMatchCoachee);
                }
            }, 100);
        }
        
        // Validar pol√≠tica de contrase√±a en tiempo real
        function validatePasswordPolicyCoachee() {
            const password = document.getElementById('coacheeNewPassword').value;
            
            // Requisitos
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
            };
            
            // Actualizar indicadores visuales
            updateRequirementIndicatorCoachee('req-length-coachee', requirements.length);
            updateRequirementIndicatorCoachee('req-uppercase-coachee', requirements.uppercase);
            updateRequirementIndicatorCoachee('req-lowercase-coachee', requirements.lowercase);
            updateRequirementIndicatorCoachee('req-number-coachee', requirements.number);
            updateRequirementIndicatorCoachee('req-special-coachee', requirements.special);
            
            return Object.values(requirements).every(r => r);
        }
        
        // Actualizar indicador de requisito
        function updateRequirementIndicatorCoachee(elementId, isValid) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const icon = element.querySelector('i');
            
            if (isValid) {
                element.style.color = '#28a745';
                icon.className = 'fas fa-check-circle';
                icon.style.fontSize = '0.875rem';
            } else {
                element.style.color = '#6c757d';
                icon.className = 'fas fa-circle';
                icon.style.fontSize = '0.5rem';
            }
        }
        
        // Validar coincidencia de contrase√±as
        function validatePasswordMatchCoachee() {
            const newPassword = document.getElementById('coacheeNewPassword').value;
            const confirmPassword = document.getElementById('coacheeConfirmPassword').value;
            const indicator = document.getElementById('passwordMatchIndicatorCoachee');
            
            if (!indicator || !confirmPassword) return;
            
            if (newPassword === confirmPassword) {
                indicator.innerHTML = '<i class="fas fa-check-circle" style="color: #28a745; margin-right: 0.5rem;"></i>Las contrase√±as coinciden';
                indicator.style.color = '#28a745';
            } else {
                indicator.innerHTML = '<i class="fas fa-times-circle" style="color: #dc3545; margin-right: 0.5rem;"></i>Las contrase√±as no coinciden';
                indicator.style.color = '#dc3545';
            }
        }

        async function submitPasswordChangeCoachee() {
            const currentPassword = document.getElementById('coacheeCurrentPassword').value.trim();
            const newPassword = document.getElementById('coacheeNewPassword').value.trim();
            const confirmPassword = document.getElementById('coacheeConfirmPassword').value.trim();
            
            // Validar campos
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('‚ùå Todos los campos son requeridos');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('‚ùå Las contrase√±as nuevas no coinciden');
                return;
            }
            
            // Validar pol√≠tica completa
            const requirements = {
                length: newPassword.length >= 8,
                uppercase: /[A-Z]/.test(newPassword),
                lowercase: /[a-z]/.test(newPassword),
                number: /[0-9]/.test(newPassword),
                special: /[!@#$%^&*(),.?":{}|<>]/.test(newPassword)
            };
            
            const failedRequirements = [];
            if (!requirements.length) failedRequirements.push('m√≠nimo 8 caracteres');
            if (!requirements.uppercase) failedRequirements.push('al menos 1 letra may√∫scula');
            if (!requirements.lowercase) failedRequirements.push('al menos 1 letra min√∫scula');
            if (!requirements.number) failedRequirements.push('al menos 1 n√∫mero');
            if (!requirements.special) failedRequirements.push('al menos 1 s√≠mbolo especial');
            
            if (failedRequirements.length > 0) {
                alert('‚ùå La contrase√±a debe cumplir: ' + failedRequirements.join(', '));
                return;
            }
            
            try {
                const response = await fetch('/api/coachee/change-password', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        current_password: currentPassword,
                        new_password: newPassword,
                        confirm_password: confirmPassword
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('‚úÖ Contrase√±a actualizada correctamente');
                    bootstrap.Modal.getInstance(document.getElementById('changePasswordModalCoachee')).hide();
                    // Limpiar campos
                    document.getElementById('coacheeCurrentPassword').value = '';
                    document.getElementById('coacheeNewPassword').value = '';
                    document.getElementById('coacheeConfirmPassword').value = '';
                    // Limpiar indicadores
                    document.getElementById('passwordMatchIndicatorCoachee').innerHTML = '';
                    ['req-length-coachee', 'req-uppercase-coachee', 'req-lowercase-coachee', 'req-number-coachee', 'req-special-coachee'].forEach(id => {
                        updateRequirementIndicatorCoachee(id, false);
                    });
                } else {
                    alert('‚ùå Error: ' + (data.error || 'No se pudo cambiar la contrase√±a'));
                }
            } catch (error) {
                alert('‚ùå Error al cambiar la contrase√±a: ' + error.message);
            }
        }
    </script>

    <!-- Modal de Cambio de Contrase√±a para Coachee -->
    <div class="modal fade" id="changePasswordModalCoachee" tabindex="-1" aria-labelledby="changePasswordModalCoacheeLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="changePasswordModalCoacheeLabel">
                        <i class="fas fa-key me-2"></i>Cambiar Contrase√±a
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordFormCoachee" onsubmit="event.preventDefault(); submitPasswordChangeCoachee();">
                        <div class="mb-3">
                            <label for="coacheeCurrentPassword" class="form-label">
                                <i class="fas fa-lock me-1"></i>Contrase√±a Actual
                            </label>
                            <input type="password" class="form-control" id="coacheeCurrentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="coacheeNewPassword" class="form-label">
                                <i class="fas fa-key me-1"></i>Nueva Contrase√±a
                            </label>
                            <input type="password" class="form-control" id="coacheeNewPassword" required minlength="8">
                            
                            <!-- Indicadores de pol√≠tica de contrase√±a -->
                            <div id="passwordRequirementsCoachee" class="mt-2" style="font-size: 0.875rem;">
                                <div class="password-requirement" id="req-length-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    M√≠nimo 8 caracteres
                                </div>
                                <div class="password-requirement" id="req-uppercase-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    Al menos 1 letra may√∫scula
                                </div>
                                <div class="password-requirement" id="req-lowercase-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    Al menos 1 letra min√∫scula
                                </div>
                                <div class="password-requirement" id="req-number-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    Al menos 1 n√∫mero
                                </div>
                                <div class="password-requirement" id="req-special-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    Al menos 1 s√≠mbolo especial (!@#$%^&*)
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="coacheeConfirmPassword" class="form-label">
                                <i class="fas fa-check-circle me-1"></i>Confirmar Nueva Contrase√±a
                            </label>
                            <input type="password" class="form-control" id="coacheeConfirmPassword" required minlength="8">
                            <div id="passwordMatchIndicatorCoachee" style="font-size: 0.875rem; margin-top: 0.5rem;"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="submitPasswordChangeCoachee()">
                        <i class="fas fa-save me-1"></i>Cambiar Contrase√±a
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Contactar Coach para Sesi√≥n - COMPACTO Y RESPONSIVO -->
    <div class="modal fade" id="contactCoachModal" tabindex="-1" aria-labelledby="contactCoachModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header modal-header-coach">
                    <h5 class="modal-title" id="contactCoachModalLabel">
                        <i class="fas fa-user-tie"></i>
                        <span>Solicitar Sesi√≥n</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
                </div>
                <div class="modal-body" style="padding: 1.25rem;">
                    <!-- Banner compacto -->
                    <div class="alert alert-success mb-3" style="padding: 0.75rem 1rem; border-radius: 8px; border-left: 4px solid #10b981;">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-gift" style="font-size: 1.5rem; color: #10b981; margin-right: 0.75rem;"></i>
                            <div>
                                <strong style="font-size: 0.9375rem;">¬°Sesi√≥n gratuita de 30 minutos!</strong>
                                <p class="mb-0" style="font-size: 0.8125rem; color: #374151; margin-top: 0.125rem;">Te contactaremos pronto</p>
                            </div>
                        </div>
                    </div>
                    
                    <form id="contactCoachForm">
                        <!-- Datos b√°sicos en grid -->
                        <div class="row g-2 mb-3">
                            <div class="col-12">
                                <label for="contactName" class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem;">
                                    <i class="fas fa-user me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>Nombre <span class="text-danger">*</span>
                                </label>
                                <input type="text" class="form-control form-control-sm" id="contactName" required 
                                    style="border-radius: 6px; padding: 0.5rem 0.75rem; font-size: 0.9375rem;">
                            </div>
                        </div>
                        
                        <div class="row g-2 mb-3">
                            <div class="col-md-6">
                                <label for="contactEmail" class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem;">
                                    <i class="fas fa-envelope me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>Email <span class="text-danger">*</span>
                                </label>
                                <input type="email" class="form-control form-control-sm" id="contactEmail" required
                                    style="border-radius: 6px; padding: 0.5rem 0.75rem; font-size: 0.9375rem;">
                            </div>
                            <div class="col-md-6">
                                <label for="contactPhone" class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem;">
                                    <i class="fas fa-phone me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>Tel√©fono <span class="text-danger">*</span>
                                </label>
                                <input type="tel" class="form-control form-control-sm" id="contactPhone" placeholder="+56 9 1234 5678" required
                                    style="border-radius: 6px; padding: 0.5rem 0.75rem; font-size: 0.9375rem;">
                            </div>
                        </div>
                        
                        <!-- M√©todo de contacto con botones pills -->
                        <div class="mb-3">
                            <label class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem;">
                                <i class="fas fa-comments me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>¬øC√≥mo prefieres que te contactemos? <span class="text-danger">*</span>
                            </label>
                            <div class="d-flex flex-wrap gap-2">
                                <div class="form-check-pill">
                                    <input class="form-check-input d-none" type="radio" name="contactMethod" id="methodEmail" value="email" checked>
                                    <label class="btn btn-outline-primary btn-sm contact-method-btn" for="methodEmail" style="border-radius: 20px; padding: 0.4rem 1rem; font-size: 0.875rem; border-width: 2px;">
                                        <i class="fas fa-envelope me-1"></i>Email
                                    </label>
                                </div>
                                <div class="form-check-pill">
                                    <input class="form-check-input d-none" type="radio" name="contactMethod" id="methodPhone" value="phone">
                                    <label class="btn btn-outline-primary btn-sm contact-method-btn" for="methodPhone" style="border-radius: 20px; padding: 0.4rem 1rem; font-size: 0.875rem; border-width: 2px;">
                                        <i class="fas fa-phone me-1"></i>Llamada
                                    </label>
                                </div>
                                <div class="form-check-pill">
                                    <input class="form-check-input d-none" type="radio" name="contactMethod" id="methodWhatsApp" value="whatsapp">
                                    <label class="btn btn-outline-success btn-sm contact-method-btn" for="methodWhatsApp" style="border-radius: 20px; padding: 0.4rem 1rem; font-size: 0.875rem; border-width: 2px;">
                                        <i class="fab fa-whatsapp me-1"></i>WhatsApp
                                    </label>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Secci√≥n colapsable para opcionales -->
                        <div class="mb-2">
                            <button class="btn btn-link p-0 text-decoration-none" type="button" data-bs-toggle="collapse" data-bs-target="#optionalFields" aria-expanded="false" aria-controls="optionalFields" style="font-size: 0.875rem; color: #6b7280;">
                                <i class="fas fa-chevron-right me-1" id="collapseIcon"></i>
                                <span>Agregar informaci√≥n adicional (opcional)</span>
                            </button>
                        </div>
                        <div class="collapse" id="optionalFields">
                            <div class="row g-2">
                                <div class="col-12">
                                    <label for="contactAvailability" class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem;">
                                        <i class="fas fa-clock me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>Horario de Disponibilidad
                                    </label>
                                    <textarea class="form-control form-control-sm" id="contactAvailability" rows="2" 
                                        placeholder="Ej: Lunes a Viernes, 9:00-18:00"
                                        style="border-radius: 6px; padding: 0.5rem 0.75rem; font-size: 0.875rem; resize: none;"></textarea>
                                </div>
                                <div class="col-12">
                                    <label for="contactMessage" class="form-label" style="font-size: 0.875rem; font-weight: 600; margin-bottom: 0.375rem;">
                                        <i class="fas fa-message me-1" style="font-size: 0.8125rem; color: #6b7280;"></i>Mensaje Adicional
                                    </label>
                                    <textarea class="form-control form-control-sm" id="contactMessage" rows="2" 
                                        placeholder="Comparte informaci√≥n adicional..."
                                        style="border-radius: 6px; padding: 0.5rem 0.75rem; font-size: 0.875rem; resize: none;"></textarea>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer" style="padding: 0.75rem 1.25rem; border-top: 1px solid #e5e7eb;">
                    <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-dismiss="modal" style="border-radius: 6px; padding: 0.5rem 1rem; font-size: 0.875rem;">
                        Cancelar
                    </button>
                    <button type="button" class="btn btn-success btn-sm" onclick="submitContactCoachForm()" style="border-radius: 6px; padding: 0.5rem 1.25rem; font-size: 0.875rem; font-weight: 600;">
                        <i class="fas fa-paper-plane me-1"></i>Enviar Solicitud
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <style>
        /* Estilos para botones de m√©todo de contacto */
        .contact-method-btn {
            transition: all 0.2s ease;
        }
        
        .contact-method-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        input[type="radio"]:checked + .contact-method-btn {
            background-color: var(--bs-primary) !important;
            color: white !important;
            border-color: var(--bs-primary) !important;
        }
        
        input[type="radio"][value="whatsapp"]:checked + .contact-method-btn {
            background-color: #25d366 !important;
            border-color: #25d366 !important;
            color: white !important;
        }
        
        /* Animaci√≥n del √≠cono de colapso */
        #optionalFields.show ~ .mb-2 #collapseIcon {
            transform: rotate(90deg);
            transition: transform 0.2s ease;
        }
        
        #optionalFields.collapsing ~ .mb-2 #collapseIcon,
        #optionalFields:not(.show) ~ .mb-2 #collapseIcon {
            transform: rotate(0deg);
            transition: transform 0.2s ease;
        }
        
        /* Responsive adjustments */
        @media (max-width: 576px) {
            #contactCoachModal .modal-body {
                padding: 1rem !important;
            }
            
            #contactCoachModal .modal-footer {
                padding: 0.625rem 1rem !important;
                gap: 0.5rem;
            }
            
            #contactCoachModal .modal-footer button {
                flex: 1;
            }
            
            .contact-method-btn {
                font-size: 0.8125rem !important;
                padding: 0.375rem 0.875rem !important;
            }
        }
    </style>

                </div> <!-- End tab-content -->
            </div> <!-- End padding wrapper -->
        </main> <!-- End main content -->
    </div> <!-- End flex container -->

    <!-- Evaluation Details Modal - Moved outside all containers -->
    <div class="modal fade" id="evaluationDetailsModal" tabindex="-1" aria-labelledby="evaluationDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header modal-header-dark">
                    <h5 class="modal-title" id="evaluationDetailsModalLabel">
                        <i class="fas fa-chart-radar"></i>
                        <span>Detalles de Evaluaci√≥n</span>
                    </h5>
                    <button type="button" class="btn btn-sm" data-bs-dismiss="modal" aria-label="Cerrar" style="background: rgba(255, 255, 255, 0.25); border: none; color: white; padding: 0.5rem 1rem; border-radius: 0.5rem; backdrop-filter: blur(10px); font-weight: 600; transition: all 0.3s ease;">
                        <i class="fas fa-times me-1"></i>Cerrar
                    </button>
                </div>
                <div class="modal-body" id="evaluationDetailsContent">
                    <div class="loading-spinner">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Cargando detalles...</span>
                        </div>
                        <p class="text-muted mt-3 mb-0" style="font-size: 0.875rem;">Cargando informaci√≥n de tu evaluaci√≥n...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- üéÆ GAMIFICACI√ìN: Script para Card "Tu Nivel" - ETAPA 3 -->
    <script>
        // JavaScript puro para cargar gamificaci√≥n
        (function() {
            console.log('üéÆ Gamification vanilla script loaded');
            
            let dataLoaded = false;
            let loadedData = null;
            
            // Hacer loadGamificationData global para que pueda ser llamada desde saveTaskProgress
            window.loadGamificationData = async function loadGamificationData() {
                console.log('üéÆ Starting to load gamification data...');
                
                const loadingState = document.getElementById('loadingState');
                const errorState = document.getElementById('errorState');
                const contentState = document.getElementById('contentState');
                const gamificationCard = document.getElementById('gamificationCard');
                
                if (!loadingState || !gamificationCard) {
                    console.warn('üéÆ Gamification card elements not found, skipping...');
                    return;
                }
                
                // Si el card no es visible, esperar a que lo sea
                const overviewTab = document.getElementById('overview');
                if (overviewTab && window.getComputedStyle(overviewTab).display === 'none') {
                    console.log('üéÆ Overview tab not visible yet, data will be applied when visible');
                }
                
                try {
                    // Usar el mismo patr√≥n que dashboard-init (que funciona)
                    const response = await fetch('/api/coachee/points/summary');
                    
                    console.log('üéÆ Response status:', response.status);
                    
                    if (!response.ok) {
                        const text = await response.text();
                        console.error('üéÆ Response error text:', text);
                        const error = new Error('Error al cargar tu progreso');
                        error.status = response.status;
                        throw error;
                    }
                    
                    const data = await response.json();
                    console.log('üéÆ Data received:', data);
                    
                    if (data.success) {
                        // Guardar datos para aplicar cuando sea visible
                        loadedData = data.data;
                        dataLoaded = true;
                        
                        // Aplicar datos inmediatamente
                        applyGamificationData();
                        
                        console.log('üéÆ Gamification card data loaded successfully!');
                    } else {
                        throw new Error(data.error || 'Error desconocido');
                    }
                } catch (error) {
                    console.error('üéÆ Error loading gamification:', error);
                    
                    // Hide loading
                    if (loadingState) loadingState.style.display = 'none';
                    
                    // Show error or welcome message
                    if (errorState) {
                        errorState.style.display = 'block';
                        const errorMessage = document.getElementById('errorMessage');
                        const errorSubMessage = document.getElementById('errorSubMessage');
                        const errorIcon = document.getElementById('errorIcon');
                        const errorActionBtn = document.getElementById('errorActionBtn');
                        
                        // Detectar si es coachee nuevo (sin puntos a√∫n)
                        const isNewCoachee = error.message.includes('Error al cargar') || 
                                           error.status === 401;
                        
                        if (isNewCoachee) {
                            // Mensaje de bienvenida para coachee nuevo
                            if (errorIcon) errorIcon.className = 'fas fa-rocket';
                            if (errorMessage) errorMessage.textContent = '¬°Bienvenido a tu camino de crecimiento!';
                            if (errorSubMessage) errorSubMessage.textContent = 'Comienza completando las acciones y metas que tu coach ha preparado para ti. Cada logro te acercar√° a tus objetivos.';
                            if (errorActionBtn) errorActionBtn.style.display = 'inline-block';
                        } else {
                            // Error real
                            if (errorIcon) errorIcon.className = 'fas fa-exclamation-circle';
                            if (errorMessage) errorMessage.textContent = error.message;
                            if (errorSubMessage) errorSubMessage.textContent = 'Intenta recargar la p√°gina';
                            if (errorActionBtn) errorActionBtn.style.display = 'none';
                        }
                    }
                }
            };
            
            function applyGamificationData() {
                if (!dataLoaded || !loadedData) {
                    console.log('üéÆ No data to apply yet');
                    return;
                }
                
                console.log('üéÆ Applying gamification data to DOM...');
                
                const loadingState = document.getElementById('loadingState');
                const contentState = document.getElementById('contentState');
                
                // Hide loading, show content - usar setProperty para forzar
                if (loadingState) {
                    loadingState.style.setProperty('display', 'none', 'important');
                    console.log('üéÆ Loading hidden');
                }
                if (contentState) {
                    contentState.style.setProperty('display', 'block', 'important');
                    console.log('üéÆ Content shown');
                }
                
                // Update all fields - with safety checks
                const updateElement = (id, value, isClass = false) => {
                    const el = document.getElementById(id);
                    if (el) {
                        if (isClass) {
                            // Preserve inline styles when updating class
                            const currentStyle = el.getAttribute('style');
                            el.className = value;
                            if (currentStyle) {
                                el.setAttribute('style', currentStyle);
                            }
                            console.log('üéÆ Updated class for', id, ':', value);
                        } else {
                            el.textContent = value;
                        }
                    } else {
                        console.warn('üéÆ Element not found:', id);
                    }
                };
                
                const updateStyle = (id, property, value) => {
                    const el = document.getElementById(id);
                    if (el) {
                        el.style[property] = value;
                    }
                };
                
                // Ensure icon class has 'fas' prefix
                const iconClass = loadedData.level_icon.startsWith('fas ') ? loadedData.level_icon : 'fas ' + loadedData.level_icon;
                updateElement('levelIcon', iconClass, true);
                updateElement('currentLevel', loadedData.current_level);
                updateElement('levelName', loadedData.level_name);
                updateElement('totalPoints', loadedData.total_points);
                updateElement('pointsToNext', loadedData.points_to_next);
                updateElement('nextLevelName', loadedData.next_level_name);
                updateElement('nextLevelNameCard', loadedData.next_level_name);
                updateElement('pointsToNextCard', loadedData.points_to_next);
                updateStyle('progressBar', 'width', loadedData.progress + '%');
                updateElement('progressText', loadedData.progress);
                
                // Actualizar color de la barra de progreso - siempre verde
                const progressBar = document.getElementById('progressBar');
                if (progressBar) {
                    const greenColor = '#10b981'; // Verde fijo para el progreso
                    progressBar.style.setProperty('background', `linear-gradient(90deg, ${greenColor}, ${greenColor}dd)`, 'important');
                    progressBar.style.setProperty('box-shadow', `0 0 10px ${greenColor}80`, 'important');
                }
                
                // ETAPA 9: Actualizar stats cards
                updateElement('statTotalPoints', loadedData.total_points.toLocaleString());
                updateElement('statTasksCompleted', window.tasksData ? window.tasksData.filter(t => t.status === 'completed').length : 0);
                
                // Actualizar color de fondo del icono de nivel en stat card
                const statIconContainer = document.getElementById('statLevelIconContainer');
                if (statIconContainer && loadedData.level_color) {
                    statIconContainer.style.background = `linear-gradient(to bottom right, ${loadedData.level_color}, ${loadedData.level_color}dd)`;
                }
                
                // Contar tareas completadas (si hay datos de tareas)
                if (window.tasksData) {
                    const completedTasks = window.tasksData.filter(t => t.status === 'completed').length;
                    updateElement('statTasksCompleted', completedTasks);
                }
                
                // Mostrar stats cards si tiene puntos
                if (loadedData.total_points > 0) {
                    const statsCards = document.getElementById('gamificationStatsCards');
                    if (statsCards) {
                        statsCards.style.display = 'block';
                        console.log('üéÆ Stats cards shown');
                    }
                }
                
                console.log('üéÆ Gamification card rendered successfully!');
            }
            
            // Observer para detectar cuando el tab overview se hace visible
            const observeOverviewTab = () => {
                const overviewTab = document.getElementById('overview');
                if (!overviewTab) {
                    console.warn('üéÆ Overview tab not found');
                    return;
                }
                
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.attributeName === 'style') {
                            const display = window.getComputedStyle(overviewTab).display;
                            if (display !== 'none' && dataLoaded) {
                                console.log('üéÆ Overview tab became visible, applying data...');
                                applyGamificationData();
                            }
                        }
                    });
                });
                
                observer.observe(overviewTab, { attributes: true });
                
                // Tambi√©n verificar inmediatamente
                if (window.getComputedStyle(overviewTab).display !== 'none' && dataLoaded) {
                    applyGamificationData();
                }
            };
            
            // Ejecutar cuando la p√°gina est√© completamente lista
            // Esperar a que otros scripts se inicialicen primero
            window.addEventListener('load', function() {
                setTimeout(() => {
                    loadGamificationData();
                    observeOverviewTab();
                }, 1000); // Esperar 1 segundo despu√©s del load completo
            });
        })();
    </script>

    <!-- Alpine.js component registration (unused for now) -->
    <script>
        // Registrar componente cuando Alpine.js est√© listo
        document.addEventListener('alpine:init', () => {
            console.log('üéÆ Registrando componente de gamificaci√≥n...');
            
            Alpine.data('gamificationCard', () => ({
                points: null,
                loading: true,
                error: null,

                init() {
                    console.log('üéÆ Gamification card init() called');
                    this.loadPoints();
                },

                async loadPoints() {
                    console.log('üéÆ Starting loadPoints()...');
                    try {
                        this.loading = true;
                        this.error = null;

                        console.log('üéÆ Fetching /api/coachee/points/summary...');
                        const response = await fetch('/api/coachee/points/summary', {
                            method: 'GET',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            credentials: 'same-origin'
                        });

                        console.log('üéÆ Response status:', response.status);

                        if (!response.ok) {
                            const errorText = await response.text();
                            console.error('üéÆ API Error:', errorText);
                            
                            if (response.status === 401) {
                                throw new Error('Sesi√≥n no v√°lida - Por favor recarga la p√°gina');
                            }
                            throw new Error('Error al cargar puntos (' + response.status + ')');
                        }

                        const data = await response.json();
                        console.log('üéÆ Gamificaci√≥n cargada:', data);
                        this.points = data;

                    } catch (err) {
                        console.error('üéÆ Error cargando gamificaci√≥n:', err);
                        this.error = err.message || 'Error al cargar tu progreso';
                    } finally {
                        this.loading = false;
                        console.log('üéÆ Loading finished. Points:', this.points, 'Error:', this.error);
                    }
                }
            }));
        });
    </script>

</body>
</html>
