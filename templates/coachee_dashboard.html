<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InstaCoach - Dashboard</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts - Lobster Two -->
    <link href="https://fonts.googleapis.com/css2?family=Lobster+Two:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- PDF.js para previsualización de documentos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configurar PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>
    <script src="/static/js/recommendations.js?v={{ get_file_version('js/recommendations.js') }}"></script>
    <link rel="stylesheet" href="/static/css/unified-dashboard.css?v={{ get_file_version('css/unified-dashboard.css') }}">
    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        /* Variables CSS para recomendaciones unificadas - IGUAL QUE COACH */
        :root {
            --calm-primary: #1E3A8A;        /* Deep Blue */
            --calm-secondary: #3B82F6;      /* Bright Blue */
            --calm-accent: #06B6D4;         /* Cyan */
            --calm-light: #EFF6FF;          /* Very Light Blue */
            --calm-dark: #1E293B;           /* Dark Slate */
            --calm-white: #FFFFFF;
            --calm-gray-50: #F8FAFC;
            --calm-gray-100: #F1F5F9;
        }
        
        /* COLORES DE PRIORIDADES Y CATEGORÍAS - COPIADOS DEL COACH DASHBOARD */
        .priority-high {
            border-top-color: #ef4444;
        }
        
        .priority-medium {
            border-top-color: #f59e0b;
        }
        
        .priority-low {
            border-top-color: #06b6d4;
        }
        
        .priority-growth {
            border-top-color: #10b981;
        }
        
        /* Estilos para dropdowns de tiempo en formato 24 horas */
        .time-select-24h {
            font-family: 'Courier New', monospace !important;
            font-weight: bold !important;
            font-size: 1.1em !important;
            text-align: center !important;
            color: #1E3A8A !important;
            background-color: #f8f9fa !important;
            border: 2px solid #e9ecef !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e") !important;
        }
        
        .time-select-24h:focus {
            border-color: #1E3A8A !important;
            box-shadow: 0 0 0 0.2rem rgba(30, 58, 138, 0.25) !important;
            background-color: white !important;
        }
        
        .time-select-24h option {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #1E3A8A;
            background-color: white;
            padding: 8px;
        }
        
        .time-select-24h option:hover {
            background-color: #f8f9fa !important;
        }
        
        .time-select-24h option:checked,
        .time-select-24h option:selected {
            background-color: #1E3A8A !important;
            color: white !important;
        }
        
        .time-input-24h {
            font-family: 'Courier New', monospace !important;
            font-weight: bold !important;
            font-size: 1.1em !important;
            letter-spacing: 1px !important;
            text-align: center !important;
            color: #1E3A8A !important;
            background-color: #f8f9fa !important;
            border: 2px solid #e9ecef !important;
        }
        
        .time-input-24h:focus {
            border-color: #1E3A8A !important;
            box-shadow: 0 0 0 0.2rem rgba(30, 58, 138, 0.25) !important;
            background-color: white !important;
        }
        
        .time-input-24h.is-valid {
            border-color: #28a745 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='m2.3 6.73 1.42 1.42 3.47-3.47'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right calc(0.375em + 0.1875rem) center !important;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem) !important;
        }
        
        .time-input-24h.is-invalid {
            border-color: #dc3545 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 4.2.4-.4.4.4-.4.4.4.4-.4.4-.4-.4-.4.4-.4-.4.4-.4-.4-.4.4-.4Z'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right calc(0.375em + 0.1875rem) center !important;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem) !important;
        }
        
        input[type="time"][data-format="24h"] {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1.1em;
            letter-spacing: 1px;
        }
        
        input[type="time"][data-format="24h"]::-webkit-calendar-picker-indicator {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="%23666" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-6V7h2v4h4v2z"/></svg>') no-repeat;
        }
        
        /* Asegurar que el formato sea siempre 24h */
        input[type="time"][data-format="24h"]::-webkit-datetime-edit-hour-field {
            color: #1E3A8A;
            font-weight: bold;
        }
        
        input[type="time"][data-format="24h"]::-webkit-datetime-edit-minute-field {
            color: #1E3A8A;
            font-weight: bold;
        }
        
        /* ESTILOS PARA SIDEBAR PANEL DE CONTROL - IGUAL QUE COACH */
        .sidebar {
            background: white !important;
            border: 1px solid #dee2e6 !important;
        }
        
        .sidebar-white {
            background: white !important;
            background-color: white !important;
        }
        
        .sidebar-force-white {
            background: white !important;
            background-color: white !important;
        }
        
        .sidebar-header-white {
            background: #f8f9fa !important;
            background-color: #f8f9fa !important;
            color: #333 !important;
            border-bottom: 1px solid #dee2e6 !important;
        }
        
        .sidebar-header-force {
            background: #f8f9fa !important;
            background-color: #f8f9fa !important;
            color: #333 !important;
            border-bottom: 1px solid #dee2e6 !important;
        }
        
        .sidebar-title-white {
            color: #333 !important;
            font-weight: 600 !important;
        }
        
        .sidebar-title-force {
            color: #333 !important;
            font-weight: 600 !important;
        }
        
        .list-group-item {
            background-color: white !important;
            color: #333 !important;
            border-color: #dee2e6 !important;
            transition: all 0.2s ease !important;
        }
        
        .list-group-item:hover {
            background-color: #f8f9fa !important;
            color: #333 !important;
        }
        
        .list-group-item.active {
            background-color: #007bff !important;
            border-color: #007bff !important;
            color: white !important;
        }
        
        .list-group-item i {
            color: inherit !important;
        }
        
        /* CATEGORÍAS DE RECOMENDACIONES */
        .general-recommendations {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }
        
        .general-recommendations .category-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white;
            border-bottom-color: var(--calm-primary);
        }
        
        .general-recommendations .category-title {
            color: white;
        }
        
        .strengths-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .strengths-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .strengths-category .category-title {
            color: white;
        }
        
        .strengths-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .strengths-category .recommendation-item:before {
            background: #10b981;
            content: "★";
        }
        
        .final-message {
            border: 2px solid #8b5cf6;
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
        }
        
        .final-message .category-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-bottom-color: #8b5cf6;
        }
        
        .final-message .category-title {
            color: white;
        }
        
        .final-message .recommendation-item {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-left-color: #8b5cf6;
        }
        
        /* ESTILOS DE CONTRASTE ALTO - SIN TRANSPARENCIAS - v2.3 - UNIFICADO CON COACH */
        body {
            background: #f8f9fa !important;
            color: #333 !important;
        }
        
        /* Cards con fondo blanco sólido */
        .card,
        .glass-card,
        .modal-content {
            background: white !important;
            border: 1px solid #dee2e6 !important;
            color: #333 !important;
            backdrop-filter: none !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            border-radius: 0.5rem !important;
        }
        
        .card.bg-dark {
            background: white !important;
            border: 1px solid #dee2e6 !important;
        }
        
        .card.bg-dark .card-body {
            background: white !important;
        }
        
        /* Textos con contraste */
        .text-white,
        .text-muted,
        .card.bg-dark .text-white,
        .card.bg-dark .text-muted {
            color: #333 !important;
        }
        
        .text-primary {
            color: #0066cc !important;
        }
        
        /* Botones con colores sólidos */
        .btn-outline-light {
            border-color: #dee2e6 !important;
            color: #333 !important;
            background: white !important;
        }
        
        .btn-outline-light:hover {
            background: #f8f9fa !important;
            border-color: #adb5bd !important;
            color: #333 !important;
        }
        
        .btn-primary {
            background: #007bff !important;
            border-color: #007bff !important;
            color: white !important;
        }
        
        .btn-success {
            background: #28a745 !important;
            border-color: #28a745 !important;
            color: white !important;
        }
        
        .btn-info {
            background: #17a2b8 !important;
            border-color: #17a2b8 !important;
            color: white !important;
        }
        
        /* Modal con fondo sólido */
        .modal-content {
            background: white !important;
            color: #333 !important;
        }
        
        .modal-header {
            background: #f8f9fa !important;
            border-bottom: 1px solid #dee2e6 !important;
        }
        
        .modal-title {
            color: #333 !important;
        }
        
        /* Progress bars */
        .progress {
            background: #e9ecef !important;
        }
        
        .progress-bar {
            background: #007bff !important;
        }
        
        /* ESTILOS GENERALES PARA DASHBOARD HEADER - ESTILO FEED */
        /* Header - UNIFICADO CON FEED */
        .feed-header {
            background: white;
            border-bottom: 1px solid #dbdbdb;
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .feed-header h3 {
            font-family: 'Lobster Two', cursive !important;
            font-size: 32px !important;
            font-weight: 400 !important;
            margin: 0 !important;
            color: #262626 !important;
            letter-spacing: 0.5px !important;
            line-height: 1.2 !important;
        }
        
        /* Responsive font sizes for InstaCoach title */
        @media (max-width: 768px) {
            .feed-header h3 {
                font-size: 40px !important;
            }
        }
        
        @media (max-width: 576px) {
            .feed-header h3 {
                font-size: 36px !important;
            }
        }
        
        /* Extra specificity for h3 to override any Bootstrap or default styles */
        .feed-header > div > h3,
        #instacoach-title {
            font-family: 'Lobster Two', cursive !important;
            font-size: 32px !important;
        }
        
        @media (max-width: 768px) {
            .feed-header > div > h3,
            #instacoach-title {
                font-size: 40px !important;
            }
        }
        
        @media (max-width: 576px) {
            .feed-header > div > h3,
            #instacoach-title {
                font-size: 36px !important;
            }
        }
        
        .feed-header .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feed-header .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            overflow: hidden;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .feed-header .user-avatar:hover {
            transform: scale(1.08);
        }
        
        .feed-header .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .feed-header .dropdown .btn-link {
            font-size: 20px;
            text-decoration: none;
            opacity: 0.9;
            transition: opacity 0.2s;
            color: #262626 !important;
        }
        
        .feed-header .dropdown .btn-link:hover {
            opacity: 1;
            color: #000000 !important;
        }
        
        .feed-header .dropdown-menu {
            min-width: 200px;
        }
        
        /* STATISTICS CARDS MEJORADAS - DISEÑO MODERNO Y ATRACTIVO */
        .stats-card-mobile {
            margin-bottom: 1rem !important;
            min-height: 140px !important;
        }
        
        .stats-card-mobile .card {
            height: 100% !important;
            min-height: 140px !important;
            border: none !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08) !important;
            border-radius: 1rem !important;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            overflow: hidden !important;
            position: relative !important;
        }
        
        .stats-card-mobile .card:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 20px rgba(0,0,0,0.12) !important;
        }
        
        /* TARJETA CLICKEABLE DE ESTADÍSTICAS */
        .stats-card-clickable {
            transition: all 0.3s ease !important;
            user-select: none !important;
        }
        
        .stats-card-clickable:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
        }
        
        .stats-card-clickable:hover .fa-clipboard-check {
            color: #28a745 !important;
            transform: scale(1.1) !important;
        }
        
        .stats-card-clickable:hover .fa-tasks {
            color: #ffc107 !important;
            transform: scale(1.1) !important;
        }
        
        .stats-card-clickable:hover .fa-exclamation-triangle {
            color: #dc3545 !important;
            transform: scale(1.1) !important;
        }
        
        .stats-card-clickable:active {
            transform: translateY(-1px) !important;
            box-shadow: 0 6px 15px rgba(0,0,0,0.12) !important;
        }
        
        .stats-card-mobile .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--calm-primary) 0%, var(--calm-secondary) 100%);
        }
        
        .stats-card-mobile .card-body {
            display: flex !important;
            flex-direction: column !important;
            justify-content: center !important;
            align-items: center !important;
            text-align: center !important;
            padding: 1.5rem 1rem !important;
            height: 100% !important;
            position: relative !important;
        }
        
        .stats-card-mobile .fa-2x {
            font-size: 2.25rem !important;
            margin-bottom: 0.75rem !important;
            opacity: 0.8 !important;
            transition: transform 0.2s ease !important;
        }
        
        .stats-card-mobile .card:hover .fa-2x {
            transform: scale(1.1) !important;
        }
        
        .stats-card-mobile h4 {
            font-size: 2rem !important;
            font-weight: 700 !important;
            margin-bottom: 0.25rem !important;
            line-height: 1.2 !important;
            color: #2c3e50 !important;
        }
        
        .stats-card-mobile .text-muted {
            font-size: 0.8rem !important;
            font-weight: 500 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            color: #6c757d !important;
        }
        
        /* RESPONSIVE PARA ESTADÍSTICAS - DISEÑO MEJORADO */
        @media (max-width: 768px) {
            .stats-card-mobile {
                margin-bottom: 1rem !important;
                height: 100% !important;
            }
            
            .stats-card-mobile .card {
                height: 100% !important;
                min-height: 130px !important;
                border-radius: 1rem !important;
                box-shadow: 0 3px 10px rgba(0,0,0,0.08) !important;
            }
            
            .stats-card-mobile .card:hover {
                transform: translateY(-1px) !important;
                box-shadow: 0 6px 16px rgba(0,0,0,0.12) !important;
            }
            
            .stats-card-mobile .card-body {
                padding: 1.25rem 1rem !important;
                display: flex !important;
                flex-direction: column !important;
                align-items: center !important;
                justify-content: center !important;
                text-align: center !important;
            }
            
            .stats-card-mobile .fa-2x {
                font-size: 1.8rem !important;
                margin-bottom: 0.5rem !important;
                opacity: 0.9 !important;
            }
            
            .stats-card-mobile h4 {
                font-size: 1.75rem !important;
                font-weight: 700 !important;
                margin-bottom: 0.25rem !important;
                color: #2c3e50 !important;
            }
            
            .stats-card-mobile .text-muted {
                font-size: 0.75rem !important;
                font-weight: 600 !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
                color: #6c757d !important;
            }
            
            /* Colores específicos para cada tipo de estadística */
            .stats-card-mobile:nth-child(1) .card::before {
                background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%) !important;
            }
            
            .stats-card-mobile:nth-child(2) .card::before {
                background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%) !important;
            }
            
            .stats-card-mobile:nth-child(3) .card::before {
                background: linear-gradient(90deg, #fa709a 0%, #fee140 100%) !important;
            }
            
            .stats-card-mobile:nth-child(4) .card::before {
                background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%) !important;
            }
            
            /* NAVEGACIÓN OPTIMIZADA PARA MÓVIL */
            .nav-tabs {
                border-bottom: 1px solid #e9ecef !important;
                margin-bottom: 1rem !important;
                flex-wrap: wrap !important;
                gap: 0.25rem !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1rem !important;
                font-size: 0.9rem !important;
                font-weight: 500 !important;
                color: #6c757d !important;
                background: #f8f9fa !important;
                border: 1px solid #dee2e6 !important;
                border-radius: 0.5rem !important;
                margin-bottom: 0.25rem !important;
                transition: all 0.2s ease !important;
                white-space: nowrap !important;
                text-align: center !important;
                min-height: 44px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.5rem !important;
            }
            
            .nav-tabs .nav-link:hover {
                background: #e9ecef !important;
                color: #495057 !important;
                transform: translateY(-1px) !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            }
            
            .nav-tabs .nav-link.active {
                background: #007bff !important;
                color: #ffffff !important;
                border-color: #007bff !important;
                font-weight: 600 !important;
                box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            }
            
            /* Asegurar texto blanco en botones activos */
            .nav-tabs .nav-link.active,
            .nav-tabs .nav-link.active:hover,
            .nav-tabs .nav-link.active:focus,
            .nav-tabs .nav-link.active:active {
                color: #ffffff !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1rem !important;
                flex-shrink: 0 !important;
            }
            
            /* Tab content optimizado para móvil */
            .tab-content {
                padding: 1rem 0 !important;
            }
            
            .tab-pane {
                animation: fadeIn 0.3s ease-in-out !important;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            /* MODALES OPTIMIZADOS PARA MÓVIL */
            .modal-dialog {
                margin: 0.5rem !important;
                max-width: calc(100vw - 1rem) !important;
                height: calc(100vh - 1rem) !important;
                max-height: calc(100vh - 1rem) !important;
            }
            
            .modal-content {
                height: 100% !important;
                border-radius: 1rem !important;
                border: none !important;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2) !important;
                overflow: hidden !important;
            }
            
            .modal-header {
                background: linear-gradient(135deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                color: white !important;
                border-bottom: none !important;
                padding: 1.25rem !important;
                flex-shrink: 0 !important;
            }
            
            .modal-title {
                color: white !important;
                font-weight: 600 !important;
                font-size: 1.1rem !important;
            }
            
            .modal-header .btn-close {
                background: rgba(255, 255, 255, 0.2) !important;
                opacity: 1 !important;
                border-radius: 0.5rem !important;
                padding: 0.5rem !important;
                margin: 0 !important;
            }
            
            /* Específico para evaluation details modal en móvil */
            #evaluationDetailsModal .modal-header .btn-close {
                filter: invert(1) !important;
                background: rgba(255, 255, 255, 0.1) !important;
            }
            
            #evaluationDetailsModal .modal-header .btn-close:hover {
                filter: invert(1) !important;
                background: rgba(255, 255, 255, 0.2) !important;
                opacity: 0.9 !important;
            }
            
            .modal-body {
                padding: 1.25rem !important;
                overflow-y: auto !important;
                flex: 1 !important;
                -webkit-overflow-scrolling: touch !important;
            }
            
            .modal-footer {
                background: #f8f9fa !important;
                border-top: 1px solid #e9ecef !important;
                padding: 1rem 1.25rem !important;
                flex-shrink: 0 !important;
                gap: 0.75rem !important;
            }
            
            .modal-footer .btn {
                min-height: 44px !important;
                padding: 0.75rem 1.5rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                flex: 1 !important;
            }
            
            /* Modal backdrop más oscuro en móvil */
            .modal-backdrop {
                background-color: rgba(0, 0, 0, 0.6) !important;
            }
            
            /* Animación mejorada para móvil */
            .modal.fade .modal-dialog {
                transform: translateY(100%) !important;
                transition: transform 0.3s ease-out !important;
            }
            
            .modal.show .modal-dialog {
                transform: translateY(0) !important;
            }
            
            /* BOTONES Y FORMULARIOS OPTIMIZADOS PARA MÓVIL */
            .btn {
                min-height: 44px;
                padding: 0.75rem 1rem;
            }
            
            .btn-sm {
                min-height: 40px;
                padding: 0.5rem 0.75rem;
            }
            
            /* FORMULARIOS OPTIMIZADOS PARA MÓVIL */
            .form-control, .form-select {
                min-height: 44px !important;
                padding: 0.75rem 1rem !important;
                font-size: 0.95rem !important;
                border: 2px solid #e9ecef !important;
                border-radius: 0.5rem !important;
                background: #ffffff !important;
                transition: all 0.2s ease !important;
            }
            
            .form-control:focus, .form-select:focus {
                border-color: #007bff !important;
                box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.15) !important;
                outline: none !important;
                transform: scale(1.02) !important;
            }
            
            .form-label {
                font-weight: 600 !important;
                color: #495057 !important;
                margin-bottom: 0.5rem !important;
                font-size: 0.9rem !important;
            }
            
            .input-group {
                gap: 0.5rem !important;
            }
            
            .input-group-text {
                min-height: 44px !important;
                padding: 0.75rem 1rem !important;
                background: #f8f9fa !important;
                border: 2px solid #e9ecef !important;
                border-radius: 0.5rem !important;
                font-weight: 500 !important;
            }
            
            /* BADGES Y PILLS OPTIMIZADOS */
            .badge {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.75rem !important;
                font-weight: 600 !important;
                border-radius: 0.375rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
            }
            
            .badge-pill {
                border-radius: 10rem !important;
                padding: 0.375rem 0.75rem !important;
            }
            
            /* TIPOGRAFÍA Y ESPACIADO OPTIMIZADO PARA MÓVIL - IGUALADO CON FEED */
            /* Se eliminó font-size de body para usar defaults del navegador como Feed */
            
            /* Espaciado de secciones optimizado */
            .container-fluid {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }
            
            .row {
                margin-left: -0.5rem !important;
                margin-right: -0.5rem !important;
            }
            
            .col, [class*="col-"] {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
                margin-bottom: 1rem !important;
            }
            
            .mb-1 { margin-bottom: 0.5rem !important; }
            .mb-2 { margin-bottom: 0.75rem !important; }
            .mb-3 { margin-bottom: 1rem !important; }
            .mb-4 { margin-bottom: 1.5rem !important; }
            .mb-5 { margin-bottom: 2rem !important; }
            
            .mt-1 { margin-top: 0.5rem !important; }
            .mt-2 { margin-top: 0.75rem !important; }
            .mt-3 { margin-top: 1rem !important; }
            .mt-4 { margin-top: 1.5rem !important; }
            .mt-5 { margin-top: 2rem !important; }
            
            .py-1 { padding-top: 0.5rem !important; padding-bottom: 0.5rem !important; }
            .py-2 { padding-top: 0.75rem !important; padding-bottom: 0.75rem !important; }
            .py-3 { padding-top: 1rem !important; padding-bottom: 1rem !important; }
            .py-4 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
            .py-5 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
            
            /* Texto optimizado para legibilidad */
            .text-small { font-size: 0.8rem !important; }
            .text-large { font-size: 1.1rem !important; }
            .text-xs { font-size: 0.7rem !important; }
            
            .fw-light { font-weight: 300 !important; }
            .fw-normal { font-weight: 400 !important; }
            .fw-medium { font-weight: 500 !important; }
            .fw-semibold { font-weight: 600 !important; }
            .fw-bold { font-weight: 700 !important; }
            
            /* Lista y contenido mejorado */
            ul, ol {
                padding-left: 1.5rem !important;
                margin-bottom: 1rem !important;
            }
            
            li {
                margin-bottom: 0.25rem !important;
                line-height: 1.5 !important;
            }
            
            .list-unstyled {
                padding-left: 0 !important;
            }
            
            .list-unstyled li {
                margin-bottom: 0.5rem !important;
            }
        }

        /* OPTIMIZACIÓN ESPECÍFICA PARA TABLET (768px - 1024px) */
        @media (min-width: 768px) and (max-width: 1024px) {
            .container-fluid {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
            
            /* Cards de estadísticas más grandes en tablet */
            .stats-card-mobile {
                margin-bottom: 1.5rem !important;
            }
            
            .stats-card-mobile .card {
                min-height: 160px !important;
                border-radius: 0.75rem !important;
            }
            
            .stats-card-mobile .card-body {
                padding: 2rem 1.5rem !important;
            }
            
            .stats-card-mobile .fa-2x {
                font-size: 2.5rem !important;
                margin-bottom: 1rem !important;
            }
            
            .stats-card-mobile h4 {
                font-size: 2.5rem !important;
                margin-bottom: 0.5rem !important;
            }
            
            .stats-card-mobile .text-muted {
                font-size: 0.9rem !important;
            }
            
            /* Gráficos más grandes en tablet */
            .chart-container {
                min-height: 350px !important;
                padding: 1.5rem !important;
            }
            
            .radar-chart-container {
                min-height: 400px !important;
            }
            
            /* Grid más eficiente para contenido principal */
            .row > .col-lg-6 {
                margin-bottom: 2rem !important;
            }
            
            .row > .col-lg-12 {
                margin-bottom: 2rem !important;
            }
            
            /* Cards de evaluaciones optimizadas para tablet */
            .evaluation-item {
                padding: 1.75rem !important;
                margin-bottom: 1.5rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.08) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .evaluation-item::before {
                height: 5px !important;
                border-radius: 0 0 5px 5px !important;
            }
            
            .evaluation-item:hover {
                transform: translateY(-4px) !important;
                box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
            }
            
            .evaluation-score {
                font-size: 2.75rem !important;
                font-weight: 800 !important;
                margin-bottom: 0.75rem !important;
                text-align: center !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                -webkit-background-clip: text !important;
                -webkit-text-fill-color: transparent !important;
                background-clip: text !important;
            }
            
            .evaluation-level {
                font-size: 1.2rem !important;
                font-weight: 700 !important;
                text-align: center !important;
                margin-bottom: 1.25rem !important;
                color: #2c3e50 !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
            }
            
            .evaluation-description {
                padding: 1.5rem !important;
                font-size: 1rem !important;
                line-height: 1.6 !important;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
                border-radius: 0.75rem !important;
                border-left: 5px solid var(--calm-primary) !important;
                color: #495057 !important;
            }
            
            .evaluation-date {
                font-size: 0.9rem !important;
                color: #6c757d !important;
                font-weight: 500 !important;
                text-align: center !important;
                margin-top: 1.25rem !important;
                padding: 0.75rem !important;
                background: rgba(108, 117, 125, 0.1) !important;
                border-radius: 0.5rem !important;
            }
            
            /* Cards de tareas optimizadas para tablet */
            .task-item {
                padding: 1.75rem !important;
                margin-bottom: 1.5rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.08) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .task-item::before {
                width: 5px !important;
                background: linear-gradient(180deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                border-radius: 0 5px 5px 0 !important;
            }
            
            .task-item:hover {
                transform: translateY(-4px) !important;
                box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
            }
            
            .task-header {
                display: flex !important;
                justify-content: space-between !important;
                align-items: flex-start !important;
                margin-bottom: 1.25rem !important;
                gap: 1rem !important;
            }
            
            .task-title {
                font-size: 1.2rem !important;
                font-weight: 700 !important;
                color: #2c3e50 !important;
                line-height: 1.4 !important;
                flex: 1 !important;
            }
            
            .task-description {
                font-size: 1rem !important;
                color: #495057 !important;
                margin-bottom: 1.25rem !important;
                line-height: 1.6 !important;
                background: rgba(248, 249, 250, 0.8) !important;
                padding: 1rem !important;
                border-radius: 0.5rem !important;
                border-left: 4px solid var(--calm-accent) !important;
            }
            
            .task-meta {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 0.75rem !important;
                margin-bottom: 1.25rem !important;
                align-items: center !important;
            }
            
            .task-badge {
                padding: 0.5rem 1rem !important;
                font-size: 0.8rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
                min-height: 32px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .task-progress {
                margin-top: 1.25rem !important;
                padding: 1rem !important;
                background: rgba(233, 236, 239, 0.5) !important;
                border-radius: 0.5rem !important;
            }
            
            /* Modales optimizados para tablet */
            .modal-dialog {
                max-width: 900px !important;
                margin: 2rem auto !important;
            }
            
            .modal-xl {
                max-width: 1100px !important;
            }
            
            .modal-content {
                border-radius: 1rem !important;
                border: none !important;
                box-shadow: 0 15px 50px rgba(0,0,0,0.15) !important;
                overflow: hidden !important;
            }
            
            .modal-header {
                background: linear-gradient(135deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                color: white !important;
                border-bottom: none !important;
                padding: 1.5rem !important;
            }
            
            .modal-title {
                color: white !important;
                font-weight: 600 !important;
                font-size: 1.25rem !important;
            }
            
            .modal-header .btn-close {
                background: rgba(255, 255, 255, 0.2) !important;
                opacity: 1 !important;
                border-radius: 0.5rem !important;
                padding: 0.75rem !important;
                margin: 0 !important;
            }
            
            .modal-body {
                padding: 2rem !important;
                max-height: 70vh !important;
                overflow-y: auto !important;
            }
            
            .modal-footer {
                background: #f8f9fa !important;
                border-top: 1px solid #e9ecef !important;
                padding: 1.25rem 2rem !important;
                gap: 1rem !important;
            }
            
            .modal-footer .btn {
                min-height: 44px !important;
                padding: 0.75rem 2rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
            }
            
            /* Navegación de pestañas mejorada para tablet */
            .nav-tabs {
                border-bottom: 2px solid #e9ecef !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1.5rem !important;
                font-size: 1rem !important;
                font-weight: 500 !important;
                color: #6c757d !important;
                border-radius: 0.5rem 0.5rem 0 0 !important;
                margin-right: 0.25rem !important;
                background: #f8f9fa !important;
                border: 1px solid #dee2e6 !important;
                border-bottom: none !important;
                transition: all 0.2s ease !important;
            }
            
            .nav-tabs .nav-link:hover {
                background: #e9ecef !important;
                color: #495057 !important;
                transform: translateY(-1px) !important;
            }
            
            .nav-tabs .nav-link.active {
                background: #007bff !important;
                color: #ffffff !important;
                border-color: #007bff !important;
                font-weight: 600 !important;
                box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            }
            
            /* ========== ANULAR BOOTSTRAP EN TABLET TAMBIÉN ========== */
            
            /* MÁXIMA ESPECIFICIDAD - Tablet nav-link effects */
            ul.nav.nav-tabs li.nav-item button.nav-link:active,
            ul.nav.nav-tabs li.nav-item button.nav-link.active:active,
            .nav-tabs .nav-item .nav-link:active,
            .nav-tabs .nav-item .nav-link.active:active,
            button.nav-link:active,
            button.nav-link.active:active {
                transform: none !important;
                box-shadow: inherit !important;
                opacity: 1 !important;
                filter: none !important;
                background: #007bff !important;
                color: #ffffff !important;
                transition: none !important;
                border-color: #007bff !important;
            }
            
            /* Asegurar texto blanco en botones activos - tablet */
            .nav-tabs .nav-link.active,
            .nav-tabs .nav-link.active:hover,
            .nav-tabs .nav-link.active:focus,
            .nav-tabs .nav-link.active:active {
                color: #ffffff !important;
                background: #007bff !important;
                transform: none !important;
                opacity: 1 !important;
                filter: none !important;
                border-color: #007bff !important;
                box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1.1rem !important;
                margin-right: 0.5rem !important;
            }
            
            /* Espaciado mejorado entre secciones */
            .dashboard-card {
                margin-bottom: 2rem !important;
            }
            
            .tab-content {
                padding: 1.5rem !important;
            }
            
            /* Botones y formularios optimizados para tablet */
            .btn {
                min-height: 44px !important;
                padding: 0.75rem 1.5rem !important;
                font-size: 0.95rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                border: none !important;
                transition: all 0.2s ease !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.5rem !important;
                touch-action: manipulation !important;
            }
            
            .btn:hover, .btn:focus {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 16px rgba(0,0,0,0.15) !important;
            }
            
            .btn-lg {
                min-height: 52px !important;
                padding: 1rem 2.5rem !important;
                font-size: 1.1rem !important;
                font-weight: 700 !important;
            }
            
            .btn-sm {
                min-height: 40px;
                padding: 0.5rem 0.75rem;
            }
            
            /* Formularios optimizados para tablet */
            .form-control, .form-select {
                min-height: 44px !important;
                padding: 0.75rem 1.25rem !important;
                font-size: 1rem !important;
                border: 2px solid #e9ecef !important;
                border-radius: 0.5rem !important;
                transition: all 0.2s ease !important;
            }
            
            .form-control:focus, .form-select:focus {
                border-color: #007bff !important;
                box-shadow: 0 0 0 0.25rem rgba(0,123,255,0.15) !important;
                transform: scale(1.01) !important;
            }
            
            .form-label {
                font-weight: 600 !important;
                font-size: 0.95rem !important;
                margin-bottom: 0.75rem !important;
            }
            
            .input-group-text {
                min-height: 44px !important;
                padding: 0.75rem 1.25rem !important;
                font-size: 0.95rem !important;
            }
            
            .badge {
                padding: 0.5rem 1rem !important;
                font-size: 0.8rem !important;
                font-weight: 600 !important;
            }
            
            /* TIPOGRAFÍA Y ESPACIADO OPTIMIZADO PARA TABLET - IGUALADO CON FEED */
            /* Se eliminó font-size de body para usar defaults del navegador como Feed */
            
            /* Espaciado de secciones optimizado para tablet */
            .container-fluid {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
            
            .row {
                margin-left: -1rem !important;
                margin-right: -1rem !important;
            }
            
            .col, [class*="col-"] {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            /* Margens y padding más generosos */
            .mb-1 { margin-bottom: 0.75rem !important; }
            .mb-2 { margin-bottom: 1rem !important; }
            .mb-3 { margin-bottom: 1.5rem !important; }
            .mb-4 { margin-bottom: 2rem !important; }
            .mb-5 { margin-bottom: 2.5rem !important; }
            
            .py-1 { padding-top: 0.75rem !important; padding-bottom: 0.75rem !important; }
            .py-2 { padding-top: 1rem !important; padding-bottom: 1rem !important; }
            .py-3 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
            .py-4 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
            .py-5 { padding-top: 2.5rem !important; padding-bottom: 2.5rem !important; }
            
            /* Lista optimizada para tablet */
            ul, ol {
                padding-left: 2rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            li {
                margin-bottom: 0.5rem !important;
                line-height: 1.6 !important;
            }
        }

        /* ANIMACIONES Y TRANSICIONES SUAVES - EXPERIENCIA MEJORADA */
        
        /* Transiciones globales para elementos interactivos */
        .card, .btn, .progress-bar, .form-control, .form-select, .modal-content, 
        .nav-link, .dropdown-menu, .alert, .badge, .task-item, .evaluation-item,
        .stats-card-mobile .card {
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1) !important;
        }
        
        /* Animaciones de hover mejoradas */
        .card:hover, .btn:hover, .nav-link:hover, .task-item:hover, 
        .evaluation-item:hover, .stats-card-mobile .card:hover {
            transition: all 0.2s ease-out !important;
        }
        
        /* Animación de click/active para botones */
        .btn:active {
            transform: scale(0.98) !important;
            transition: transform 0.1s ease !important;
        }
        
        /* Eliminar TODOS los efectos en nav-links para evitar oscurecimiento */
        .nav-link:active,
        .nav-tabs .nav-link:active,
        .nav-tabs .nav-link.active:active {
            transform: none !important;
            box-shadow: inherit !important;
            opacity: 1 !important;
            filter: none !important;
            background: inherit !important;
            color: inherit !important;
            transition: none !important;
        }
        
        /* Forzar color blanco en botones activos específicamente */
        .nav-tabs .nav-link.active:active {
            color: #ffffff !important;
            background: #007bff !important;
        }
        
        /* ============ ANULAR BOOTSTRAP 5.3.3 COMPLETAMENTE ============ */
        
        /* MÁXIMA ESPECIFICIDAD - Anular Bootstrap nav-link effects */
        ul.nav.nav-tabs li.nav-item button.nav-link:active,
        ul.nav.nav-tabs li.nav-item button.nav-link.active:active,
        .nav-tabs .nav-item .nav-link:active,
        .nav-tabs .nav-item .nav-link.active:active,
        button.nav-link:active,
        button.nav-link.active:active {
            transform: none !important;
            box-shadow: inherit !important;
            opacity: 1 !important;
            filter: none !important;
            background: #007bff !important;
            color: #ffffff !important;
            transition: none !important;
            border-color: #007bff !important;
            text-decoration: none !important;
        }
        
        /* Anular TODOS los efectos de Bootstrap en nav-links */
        .nav-link:active,
        .nav-link:focus,
        .nav-link:hover:active,
        .nav-tabs .nav-link:active,
        .nav-tabs .nav-link:focus,
        .nav-tabs .nav-link:hover:active {
            background-color: inherit !important;
            border-color: inherit !important;
            color: inherit !important;
            transform: none !important;
            box-shadow: none !important;
            opacity: 1 !important;
            filter: none !important;
        }
        
        /* FORZAR estilos en botones activos específicamente */
        .nav-tabs .nav-link.active:active,
        .nav-tabs .nav-link.active:focus,
        .nav-tabs .nav-link.active:hover:active {
            background-color: #007bff !important;
            border-color: #007bff !important;
            color: #ffffff !important;
            transform: none !important;
            box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            opacity: 1 !important;
            filter: none !important;
        }
        
        /* Eliminar highlight táctil en dispositivos móviles */
        .nav-link {
            -webkit-tap-highlight-color: transparent !important;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
            -khtml-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            outline: none !important;
        }
        
        .nav-link:focus {
            outline: none !important;
            box-shadow: none !important;
        }
        
        /* ========== FUERZA BRUTA: TEXTO BLANCO SIEMPRE ========== */
        
        /* NIVEL 1: Especificidad máxima con IDs */
        #scheduleCoachTabs.nav.nav-tabs .nav-item .nav-link:active,
        #scheduleCoachTabs.nav.nav-tabs .nav-item .nav-link.active:active,
        #scheduleCoachTabs .nav-link:active,
        #scheduleCoachTabs .nav-link.active:active {
            background-color: #007bff !important;
            border-color: #007bff !important;
            color: #ffffff !important;
            transform: none !important;
            box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            opacity: 1 !important;
            filter: none !important;
            transition: none !important;
            outline: none !important;
        }
        
        /* NIVEL 2: Fuerza bruta - TODOS los selectores posibles */
        #scheduleCoachTabs button:active,
        #scheduleCoachTabs button.active:active,
        #scheduleCoachTabs .nav-link:active,
        #scheduleCoachTabs .nav-link.active:active,
        #scheduleCoachTabs .nav-tabs .nav-link:active,
        #scheduleCoachTabs .nav-tabs .nav-link.active:active,
        ul#scheduleCoachTabs.nav.nav-tabs li.nav-item button.nav-link:active,
        ul#scheduleCoachTabs.nav.nav-tabs li.nav-item button.nav-link.active:active {
            color: #ffffff !important;
            background-color: #007bff !important;
            border-color: #007bff !important;
        }
        
        /* NIVEL 3: Fuerza bruta - Selectores de atributo */
        button[id="schedule-request-tab"]:active,
        button[id="my-sessions-tab"]:active,
        button[id="schedule-request-tab"].active:active,
        button[id="my-sessions-tab"].active:active {
            color: #ffffff !important;
            background-color: #007bff !important;
            border-color: #007bff !important;
        }
        
        /* NIVEL 4: JavaScript override backup */
        .force-white-text:active,
        .force-white-text.active:active {
            color: #ffffff !important;
            background-color: #007bff !important;
        }
        
        /* NIVEL 5: NUCLEAR OPTION - Aplicar DESPUÉS de Bootstrap */
        @media screen {
            #schedule-request-tab,
            #my-sessions-tab {
                transition: none !important;
            }
            
            #schedule-request-tab.active,
            #my-sessions-tab.active {
                color: #ffffff !important;
                background-color: #007bff !important;
                border-color: #007bff !important;
            }
            
            #schedule-request-tab:active,
            #schedule-request-tab.active:active,
            #my-sessions-tab:active,
            #my-sessions-tab.active:active {
                color: #ffffff !important;
                background-color: #007bff !important;
                border-color: #007bff !important;
                transform: none !important;
                opacity: 1 !important;
                filter: none !important;
                box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            }
        }
        
        /* Animación de entrada para cards */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }
        
        /* Aplicar animaciones a elementos específicos */
        .stats-card-mobile .card {
            animation: fadeInUp 0.6s ease-out forwards;
        }
        
        .stats-card-mobile:nth-child(1) .card { animation-delay: 0.1s; }
        .stats-card-mobile:nth-child(2) .card { animation-delay: 0.2s; }
        .stats-card-mobile:nth-child(3) .card { animation-delay: 0.3s; }
        .stats-card-mobile:nth-child(4) .card { animation-delay: 0.4s; }
        
        .task-item {
            animation: slideInLeft 0.5s ease-out forwards;
        }
        
        .evaluation-item {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        
        /* Loading state para botones */
        .btn:disabled {
            position: relative;
            overflow: hidden;
        }
        
        .btn:disabled::before {
            content: '';
            position: absolute;
            top: 0;
            left: -200px;
            width: 200px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 1.5s infinite;
        }
        
        /* Animación de progreso para barras */
        .progress-bar {
            transition: width 0.8s ease-out !important;
        }
        
        /* Mejoras para modales */
        .modal.fade .modal-dialog {
            transform: translateY(-50px);
            transition: transform 0.3s ease-out;
        }
        
        .modal.show .modal-dialog {
            transform: translateY(0);
        }
        
        /* Hover effects especiales */
        .nav-tabs .nav-link {
            position: relative;
            overflow: hidden;
        }
        
        .nav-tabs .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--calm-primary), var(--calm-secondary));
            transition: width 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover::before,
        .nav-tabs .nav-link.active::before {
            width: 100%;
        }
        
        /* Smooth scroll para navegación */
        html {
            scroll-behavior: smooth;
        }
        
        /* REDUCIR TAMAÑO BASE DE REM EN MÓVIL PARA IGUALAR CON FEED */
        @media (max-width: 768px) {
            html {
                font-size: 14px; /* Reduce rem base de 16px a 14px en tablet (12.5% más pequeño) */
            }
        }
        
        @media (max-width: 576px) {
            html {
                font-size: 13px; /* Reduce rem base a 13px en móvil (18.75% más pequeño) */
            }
        }
        
        /* Micro-interacciones para badges */
        .task-badge, .badge {
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
        }
        
        .task-badge:hover, .badge:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
        }
        
        /* Animación de focus para formularios */
        .form-control:focus, .form-select:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 0.2rem rgba(var(--calm-primary-rgb), 0.25) !important;
        }
        
        /* Stagger animation para listas */
        .task-item:nth-child(1) { animation-delay: 0.1s; }
        .task-item:nth-child(2) { animation-delay: 0.2s; }
        .task-item:nth-child(3) { animation-delay: 0.3s; }
        .task-item:nth-child(4) { animation-delay: 0.4s; }
        .task-item:nth-child(5) { animation-delay: 0.5s; }
        
        .evaluation-item:nth-child(1) { animation-delay: 0.1s; }
        .evaluation-item:nth-child(2) { animation-delay: 0.2s; }
        .evaluation-item:nth-child(3) { animation-delay: 0.3s; }
        .evaluation-item:nth-child(4) { animation-delay: 0.4s; }
        
        /* Reducir animaciones si el usuario prefiere menos movimiento */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(90, 103, 216, 0.08); /* Calm's signature blue with very low opacity */
            border-radius: 50%;
            animation: float 25s infinite linear; /* Slower, more peaceful animation */
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Custom header */
        .custom-header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--calm-border);
            position: relative;
            z-index: 2;
            box-shadow: 0 1px 20px rgba(90, 103, 216, 0.06); /* Softer shadow with new blue */
        }

        .custom-header .navbar-brand {
            color: var(--calm-text-primary) !important;
            font-weight: 600;
            font-size: 1.5rem;
        }

        .user-display {
            color: var(--calm-text-primary);
            font-weight: 500;
            background: var(--calm-surface-elevated);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            border: 1px solid var(--calm-border);
        }

        /* Logout button styles */
        .logout-btn {
            background: var(--calm-surface-elevated);
            border: 1px solid var(--calm-border);
            color: var(--calm-text-primary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-left: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: var(--calm-primary);
            border-color: var(--calm-primary);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.25); /* Updated with new primary color */
        }

        .logout-btn:active {
            transform: translateY(0);
        }

        /* Responsive styles for logout button */
        @media (max-width: 768px) {
            .logout-btn {
                margin-left: 0.5rem;
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .logout-btn .fa-sign-out-alt {
                margin-right: 0.3rem;
            }
            
            .user-display {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 576px) {
            .logout-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
            }
            
            .logout-btn span {
                display: none; /* Hide text on very small screens */
            }
            
            .logout-btn {
                margin-left: 0.3rem;
            }
        }

        /* Main container */
        .main-container {
            position: relative;
            z-index: 2;
            min-height: calc(100vh - 80px);
            padding: 2rem 1rem;
        }

        /* Dashboard cards - OPTIMIZADO PARA MÓVIL Y TABLET */
        .dashboard-card {
            background: linear-gradient(135deg, #FFFFFF 0%, #EFF6FF 100%) !important;
            border-radius: 16px !important;
            box-shadow: 0 8px 32px rgba(30, 58, 138, 0.15) !important;
            overflow: hidden !important;
            margin-bottom: 2rem !important;
            border: 2px solid var(--calm-primary) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
        }

        .dashboard-card:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 12px 40px rgba(30, 58, 138, 0.25) !important;
        }

        /* CARDS MÓVIL OPTIMIZADAS */
        @media (max-width: 768px) {
            .dashboard-card {
                margin-bottom: 1.5rem !important;
                border-radius: 12px !important;
                box-shadow: 0 4px 16px rgba(30, 58, 138, 0.12) !important;
                border: 1px solid var(--calm-primary) !important;
            }
            
            .dashboard-card:hover {
                transform: translateY(-1px) !important;
                box-shadow: 0 6px 20px rgba(30, 58, 138, 0.18) !important;
            }
            
            /* Layout en columna para móvil */
            .row .col-lg-6 {
                margin-bottom: 1rem !important;
            }
            
            .row .col-lg-6:last-child {
                margin-bottom: 0 !important;
            }
        }

        /* CARDS TABLET OPTIMIZADAS */
        @media (min-width: 768px) and (max-width: 1024px) {
            .dashboard-card {
                margin-bottom: 1.75rem !important;
                border-radius: 14px !important;
                box-shadow: 0 6px 24px rgba(30, 58, 138, 0.14) !important;
            }
            
            .dashboard-card:hover {
                transform: translateY(-1px) !important;
                box-shadow: 0 8px 28px rgba(30, 58, 138, 0.22) !important;
            }
        }

        /* GRID RESPONSIVO MEJORADO */
        @media (max-width: 992px) {
            .row {
                margin-left: 0 !important;
                margin-right: 0 !important;
            }
            
            .row > [class*="col-"] {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }
        }

        @media (max-width: 768px) {
            .row > [class*="col-"] {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
                margin-bottom: 1rem !important;
            }
        }

        .card-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
            padding: 1.5rem !important;
            border-bottom: 1px solid var(--calm-border) !important;
            color: #FFFFFF !important;
            border-radius: 16px 16px 0 0 !important;
        }

        .card-header h3 {
            margin: 0 !important;
            color: #FFFFFF !important;
            font-weight: 600 !important;
            font-size: 1.25rem !important;
            line-height: 1.4 !important;
        }

        .card-header * {
            color: #FFFFFF !important;
        }

        /* CARD HEADERS MÓVIL OPTIMIZADOS */
        @media (max-width: 768px) {
            .card-header {
                padding: 1rem 1.25rem !important;
                border-radius: 12px 12px 0 0 !important;
            }
            
            .card-header h3 {
                font-size: 1.1rem !important;
                font-weight: 700 !important;
                line-height: 1.3 !important;
            }
            
            .card-header i {
                font-size: 1rem !important;
                margin-right: 0.5rem !important;
            }
        }

        /* CARD HEADERS TABLET OPTIMIZADOS */
        @media (min-width: 768px) and (max-width: 1024px) {
            .card-header {
                padding: 1.25rem 1.5rem !important;
                border-radius: 14px 14px 0 0 !important;
            }
            
            .card-header h3 {
                font-size: 1.2rem !important;
                font-weight: 650 !important;
            }
            
            .card-header i {
                font-size: 1.1rem !important;
                margin-right: 0.6rem !important;
            }
        }

        /* CARD BODY RESPONSIVO */
        .card-body {
            padding: 1.5rem !important;
        }

        @media (max-width: 768px) {
            .card-body {
                padding: 1rem 1.25rem !important;
            }
        }

        @media (min-width: 768px) and (max-width: 1024px) {
            .card-body {
                padding: 1.25rem 1.5rem !important;
            }
        }

        /* TAB CONTENT RESPONSIVO */
        .tab-content {
            padding: 1rem 0 !important;
        }

        .tab-pane {
            min-height: 400px !important;
        }

        /* CONTENIDO DE PESTAÑAS MÓVIL */
        @media (max-width: 768px) {
            .tab-content {
                padding: 0.75rem 0 !important;
            }
            
            .tab-pane {
                min-height: 300px !important;
            }
            
            /* Layout stack en móvil */
            .tab-pane .row .col-lg-6 {
                width: 100% !important;
                margin-bottom: 1.5rem !important;
            }
            
            .tab-pane .row .col-lg-6:last-child {
                margin-bottom: 1rem !important;
            }
        }

        /* CONTENIDO DE PESTAÑAS TABLET */
        @media (min-width: 768px) and (max-width: 1024px) {
            .tab-content {
                padding: 0.875rem 0 !important;
            }
            
            .tab-pane {
                min-height: 350px !important;
            }
            
            .tab-pane .row .col-lg-6 {
                margin-bottom: 1.25rem !important;
            }
        }

        /* LOADING STATES MEJORADOS */
        .loading-spinner {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            min-height: 200px !important;
            flex-direction: column !important;
        }

        .spinner-border-custom {
            color: var(--calm-primary) !important;
            width: 2.5rem !important;
            height: 2.5rem !important;
        }

        @media (max-width: 768px) {
            .loading-spinner {
                min-height: 150px !important;
            }
            
            .spinner-border-custom {
                width: 2rem !important;
                height: 2rem !important;
            }
        }

        /* Sobrescribir clases de Bootstrap dentro de headers azules */
        .card-header .text-muted,
        .card-header .text-secondary,
        .card-header small,
        .card-header span {
            color: #FFFFFF !important; /* FORZAR BLANCO PARA TEXTO EN HEADERS AZULES */
        }

        /* Sobrescribir texto en pestañas con fondo azul */
        .nav-tabs .nav-link .text-muted,
        .nav-tabs .nav-link .text-secondary,
        .nav-tabs .nav-link small,
        .nav-tabs .nav-link span {
            color: #FFFFFF !important; /* FORZAR BLANCO PARA TEXTO EN PESTAÑAS AZULES */
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Navigation tabs - MEJORADO PARA MÓVIL Y TABLET */
        .nav-tabs {
            border-bottom: 2px solid var(--calm-primary) !important;
            margin-bottom: 2rem !important;
            background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%) !important;
            border-radius: 12px 12px 0 0 !important;
            padding: 0.75rem !important;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.1) !important;
            overflow-x: auto !important;
            overflow-y: hidden !important;
            white-space: nowrap !important;
            -webkit-overflow-scrolling: touch !important;
        }

        .nav-tabs .nav-link {
            border: none !important;
            border-radius: 8px !important;
            color: white !important;
            font-weight: 600 !important;
            padding: 1rem 1.5rem !important;
            transition: all 0.3s ease !important;
            margin: 0 0.25rem !important;
            position: relative !important;
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3) !important;
            min-height: 48px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            text-decoration: none !important;
            flex-shrink: 0 !important;
        }

        .nav-tabs .nav-link:hover {
            color: white !important;
            background: linear-gradient(135deg, #1D4ED8 0%, #1E3A8A 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.5) !important;
        }

        .nav-tabs .nav-link.active {
            color: white !important;
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            border-bottom: none !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6) !important;
        }

        /* NAVEGACIÓN MÓVIL OPTIMIZADA */
        @media (max-width: 768px) {
            .nav-tabs {
                padding: 0.5rem !important;
                margin-bottom: 1.5rem !important;
                border-radius: 8px 8px 0 0 !important;
                scrollbar-width: none !important;
                -ms-overflow-style: none !important;
            }
            
            .nav-tabs::-webkit-scrollbar {
                display: none !important;
            }
            
            .nav-tabs .nav-item {
                display: inline-block !important;
                flex-shrink: 0 !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1rem !important;
                margin: 0 0.25rem !important;
                font-size: 0.9rem !important;
                min-width: auto !important;
                white-space: nowrap !important;
                min-height: 44px !important;
                border-radius: 6px !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1rem !important;
                margin-right: 0.5rem !important;
            }
            
            /* Scroll suave para pestañas */
            .nav-tabs {
                scroll-behavior: smooth !important;
            }
        }

        /* NAVEGACIÓN TABLET OPTIMIZADA */
        @media (min-width: 768px) and (max-width: 1024px) {
            .nav-tabs {
                padding: 0.75rem !important;
                margin-bottom: 2rem !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.875rem 1.25rem !important;
                font-size: 0.95rem !important;
                margin: 0 0.25rem !important;
                min-height: 46px !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1.1rem !important;
                margin-right: 0.6rem !important;
            }
        }

        /* Móvil muy pequeño - iconos solo */
        @media (max-width: 480px) {
            .nav-tabs .nav-link {
                padding: 0.625rem 0.75rem !important;
                font-size: 0.85rem !important;
            }
            
            .nav-tabs .nav-link span {
                display: none !important;
            }
            
            .nav-tabs .nav-link i {
                margin-right: 0 !important;
            }
        }

        /* Evaluaciones Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#evaluations-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#evaluations-tab:hover,
        .nav-tabs .nav-link#evaluations-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
            color: white !important;
        }

        /* Assessment Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#assessment-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#assessment-tab:hover,
        .nav-tabs .nav-link#assessment-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
            color: white !important;
        }

        /* Tareas Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#tasks-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#tasks-tab:hover,
        .nav-tabs .nav-link#tasks-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            color: white !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
        }

        /* Progreso Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#progress-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#progress-tab:hover,
        .nav-tabs .nav-link#progress-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            color: white !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
        }

        /* Iconos con animación */
        .nav-tabs .nav-link i {
            transition: transform 0.3s ease;
        }

        .nav-tabs .nav-link:hover i,
        .nav-tabs .nav-link.active i {
            transform: scale(1.1);
        }

        /* Buttons */
        .btn-primary-custom {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.2); /* Updated with new primary color */
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(90, 103, 216, 0.4); /* Updated with new primary color */
            color: white;
        }

        .btn-success-custom {
            background: var(--success-gradient);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-success-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(104, 211, 145, 0.4); /* Updated with new secondary/success color */
            color: white;
        }

        .btn-warning-custom {
            background: var(--warning-gradient);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-warning-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(237, 137, 54, 0.4); /* Updated with new accent/warning color */
            color: white;
        }

        /* Botones específicos para evaluaciones */
        .btn-evaluation {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-evaluation:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            color: white;
        }

        /* Botones específicos para tareas */
        .btn-task {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-task:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
            color: white;
        }

        /* Botones específicos para progreso */
        .btn-progress {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .btn-progress:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
            color: white;
        }

        /* Botones de outline para acciones secundarias */
        .btn-outline-evaluation {
            background: transparent;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #3b82f6;
            transition: all 0.3s ease;
        }

        .btn-outline-evaluation:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-outline-task {
            background: transparent;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #f59e0b;
            transition: all 0.3s ease;
        }

        .btn-outline-task:hover {
            background: #f59e0b;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-outline-progress {
            background: transparent;
            border: 2px solid #8b5cf6;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #8b5cf6;
            transition: all 0.3s ease;
        }

        .btn-outline-progress:hover {
            background: #8b5cf6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        /* ESTILOS DE RECOMENDACIONES - COPIADOS DEL COACH DASHBOARD */
        .category-content {
            padding: 1.25rem;
        }
        
        .recommendation-item {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--calm-accent);
            position: relative;
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .recommendation-item:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-left-color: var(--calm-primary);
            transform: translateX(5px) translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--bs-primary) !important;
        }
        
        .recommendation-item:before {
            content: "✓";
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--calm-accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .recommendation-text {
            margin-left: 1.5rem;
            line-height: 1.6;
            color: #334155;
            font-weight: 500;
        }
        
        /* Estilos especiales para subcategorías de dimensiones */
        .dimension-subcategory {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            margin-bottom: 2rem;
        }
        
        .subcategory-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white;
            padding: 1.25rem;
            border-bottom: 3px solid var(--calm-accent);
        }
        
        .subcategory-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .subcategory-info {
            flex: 1;
        }
        
        .subcategory-title {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }

        /* ANIMACIONES - COPIADAS DEL COACH DASHBOARD */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .action-list li {
            position: relative;
            padding-left: 0.5rem;
        }
        
        .action-list li:before {
            content: "→";
            position: absolute;
            left: -0.5rem;
            color: var(--bs-primary);
            font-weight: bold;
        }
        
        .item-number {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Summary cards */
        .summary-card {
            background: var(--calm-surface);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--calm-border);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 20px rgba(90, 103, 216, 0.05); /* Updated with new primary color */
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(90, 103, 216, 0.1); /* Updated with new primary color */
        }

        .summary-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: white;
        }

        .summary-icon.primary {
            background: var(--primary-gradient);
        }

        .summary-icon.success {
            background: var(--success-gradient);
        }

        .summary-icon.warning {
            background: var(--warning-gradient);
        }

        .summary-icon.danger {
            background: var(--danger-gradient);
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .summary-label {
            color: var(--calm-text-muted); /* Usando color muted mejorado para mejor contraste */
            font-weight: 500;
        }

        /* EVALUATION CARDS MODERNIZADAS - DISEÑO COLORIDO Y ATRACTIVO */
        .evaluation-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
            border: none !important;
            border-radius: 1rem !important;
            padding: 1.5rem !important;
            margin-bottom: 1.25rem !important;
            color: #333 !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .evaluation-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        }
        
        /* Headers coloridos para diferentes tipos de evaluación */
        .evaluation-item[data-type="disc"]::before {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%) !important;
        }
        
        .evaluation-item[data-type="emotional"]::before {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%) !important;
        }
        
        .evaluation-item[data-type="leadership"]::before {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%) !important;
        }
        
        .evaluation-item[data-type="teamwork"]::before {
            background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%) !important;
        }
        
        .evaluation-item[data-type="assertiveness"]::before {
            background: linear-gradient(90deg, #fa709a 0%, #fee140 100%) !important;
        }

        .evaluation-item:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        }

        .evaluation-score {
            font-size: 2.25rem !important;
            font-weight: 700 !important;
            margin-bottom: 0.5rem !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        .evaluation-level {
            font-weight: 600 !important;
            margin-bottom: 1rem !important;
            color: #2c3e50 !important;
            font-size: 1.1rem !important;
        }

        .evaluation-description {
            line-height: 1.5 !important;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
            padding: 1rem !important;
            border-radius: 0.75rem !important;
            border-left: 4px solid var(--calm-primary) !important;
            color: #6c757d !important;
            font-size: 0.95rem !important;
        }

        .evaluation-date {
            color: #6c757d !important;
            font-size: 0.85rem !important;
            font-weight: 500 !important;
            margin-top: 1rem !important;
        }
        
        /* EVALUATION CARDS RESPONSIVE - MÓVIL MEJORADO */
        @media (max-width: 768px) {
            .evaluation-item {
                padding: 1.5rem 1.25rem !important;
                margin-bottom: 1.25rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                transition: all 0.2s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .evaluation-item::before {
                height: 4px !important;
                border-radius: 0 0 4px 4px !important;
            }
            
            .evaluation-score {
                font-size: 2.5rem !important;
                font-weight: 800 !important;
                margin-bottom: 0.75rem !important;
                text-align: center !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                -webkit-background-clip: text !important;
                -webkit-text-fill-color: transparent !important;
                background-clip: text !important;
                line-height: 1.1 !important;
            }
            
            .evaluation-level {
                font-size: 1.1rem !important;
                font-weight: 700 !important;
                text-align: center !important;
                color: #2c3e50 !important;
                margin-bottom: 1rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
            }
            
            .evaluation-description {
                padding: 1.25rem !important;
                font-size: 0.95rem !important;
                line-height: 1.6 !important;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
                border-radius: 0.75rem !important;
                border-left: 4px solid var(--calm-primary) !important;
                color: #495057 !important;
                margin-bottom: 1rem !important;
            }
            
            .evaluation-date {
                font-size: 0.85rem !important;
                color: #6c757d !important;
                font-weight: 500 !important;
                text-align: center !important;
                padding: 0.5rem !important;
                background: rgba(108, 117, 125, 0.1) !important;
                border-radius: 0.5rem !important;
                margin-top: 1rem !important;
            }
            
            .evaluation-item:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.12) !important;
            }
            
            /* Estilos específicos por tipo de evaluación en móvil */
            .evaluation-item[data-type="disc"] {
                background: linear-gradient(135deg, #ffffff 0%, #f3f2ff 100%) !important;
            }
            
            .evaluation-item[data-type="emotional"] {
                background: linear-gradient(135deg, #ffffff 0%, #fff0f5 100%) !important;
            }
            
            .evaluation-item[data-type="leadership"] {
                background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%) !important;
            }
            
            .evaluation-item[data-type="teamwork"] {
                background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%) !important;
            }
            
            .evaluation-item[data-type="assertiveness"] {
                background: linear-gradient(135deg, #ffffff 0%, #fffaf0 100%) !important;
            }
        }
        
        /* OVERRIDE GLOBAL PARA FORZAR ESTILOS LIMPIOS */
        .glass-card,
        .card,
        .modal-content,
        [style*="background"],
        [class*="glass"] {
            background: white !important;
            backdrop-filter: none !important;
            border: 1px solid #dee2e6 !important;
            color: #333 !important;
        }
        
        .text-white,
        .text-white-50,
        .text-gradient {
            color: #333 !important;
        }
        
        /* ANULAR REGLA PROBLEMÁTICA ESPECÍFICAMENTE PARA GENERAL-RECOMMENDATIONS */
        .general-recommendations .text-white,
        .general-recommendations .text-white-50,
        .general-recommendations .text-gradient {
            color: white !important;
        }
        
        .text-muted {
            color: #666 !important;
        }

        /* TASK CARDS MODERNIZADAS - DISEÑO ATRACTIVO Y FUNCIONAL */
        .task-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
            border: none !important;
            border-radius: 1rem !important;
            padding: 1.5rem !important;
            margin-bottom: 1.25rem !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .task-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--calm-primary) 0%, var(--calm-secondary) 100%);
        }
        
        .task-item:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 20px rgba(0,0,0,0.12) !important;
        }

        .task-header {
            display: flex !important;
            justify-content: space-between !important;
            align-items: flex-start !important;
            margin-bottom: 1rem !important;
        }

        .task-title {
            font-weight: 600 !important;
            color: #2c3e50 !important;
            margin-bottom: 0.5rem !important;
            font-size: 1.1rem !important;
            line-height: 1.4 !important;
        }

        .task-description {
            color: #6c757d !important;
            margin-bottom: 1rem !important;
            line-height: 1.5 !important;
            font-size: 0.95rem !important;
        }

        .task-meta {
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 0.75rem !important;
            margin-bottom: 1rem !important;
            align-items: center !important;
        }

        .task-badge {
            padding: 0.35rem 0.85rem !important;
            border-radius: 1rem !important;
            font-size: 0.75rem !important;
            font-weight: 600 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.3px !important;
            border: none !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: 0.25rem !important;
        }

        .task-badge.priority-high {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(238, 90, 36, 0.3) !important;
        }

        .task-badge.priority-medium {
            background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(254, 202, 87, 0.3) !important;
        }

        .task-badge.priority-low {
            background: linear-gradient(135deg, #48cae4 0%, #0077b6 100%) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(72, 202, 228, 0.3) !important;
        }

        .task-badge.status-pending {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%) !important;
            color: white !important;
        }

        .task-badge.status-in_progress {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%) !important;
            color: white !important;
        }

        .task-badge.status-completed {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%) !important;
            color: white !important;
        }

        /* TASK CARDS RESPONSIVE - MÓVIL MEJORADO */
        @media (max-width: 768px) {
            .task-item {
                padding: 1.5rem 1.25rem !important;
                margin-bottom: 1.25rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08) !important;
                transition: all 0.2s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .task-item::before {
                width: 4px !important;
                background: linear-gradient(180deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                border-radius: 0 4px 4px 0 !important;
            }
            
            .task-header {
                display: flex !important;
                flex-direction: column !important;
                gap: 0.75rem !important;
                margin-bottom: 1rem !important;
            }
            
            .task-title {
                font-size: 1.1rem !important;
                font-weight: 700 !important;
                color: #2c3e50 !important;
                margin-bottom: 0 !important;
                line-height: 1.4 !important;
            }
            
            .task-description {
                font-size: 0.95rem !important;
                color: #495057 !important;
                margin-bottom: 1rem !important;
                line-height: 1.5 !important;
                background: rgba(248, 249, 250, 0.8) !important;
                padding: 0.75rem !important;
                border-radius: 0.5rem !important;
                border-left: 3px solid var(--calm-accent) !important;
            }
            
            .task-meta {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
                margin-bottom: 1rem !important;
                align-items: center !important;
            }
            
            .task-badge {
                padding: 0.4rem 0.8rem !important;
                font-size: 0.75rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
                min-height: 28px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .task-progress {
                margin-top: 1rem !important;
                padding: 0.75rem !important;
                background: rgba(233, 236, 239, 0.5) !important;
                border-radius: 0.5rem !important;
            }
            
            .task-item:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.12) !important;
            }
            
            /* Colores específicos para diferentes estados de tareas */
            .task-item[data-status="pending"]::before {
                background: linear-gradient(180deg, #f39c12 0%, #e67e22 100%) !important;
            }
            
            .task-item[data-status="in-progress"]::before {
                background: linear-gradient(180deg, #3498db 0%, #2980b9 100%) !important;
            }
            
            .task-item[data-status="completed"]::before {
                background: linear-gradient(180deg, #2ecc71 0%, #27ae60 100%) !important;
            }
            
            .task-item[data-priority="high"] {
                background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%) !important;
                border-color: rgba(239, 68, 68, 0.1) !important;
            }
            
            .task-item[data-priority="medium"] {
                background: linear-gradient(135deg, #ffffff 0%, #fffbf0 100%) !important;
                border-color: rgba(245, 158, 11, 0.1) !important;
            }
            
            .task-item[data-priority="low"] {
                background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%) !important;
                border-color: rgba(34, 197, 94, 0.1) !important;
            }
        }

        /* CONTENT CARDS STYLES */
        .content-card {
            background: #ffffff;
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            height: 100%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 12px;
        }

        .content-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            z-index: 1;
        }

        .content-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .content-card:hover::before {
            transform: scaleX(1);
        }

        .content-card.viewed {
            border-color: rgba(34, 197, 94, 0.4);
        }

        .content-card.viewed::before {
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
        }

        /* Preview styles */
        .content-preview {
            position: relative;
            cursor: pointer;
        }

        .content-preview.has-embedded-video {
            cursor: default;
            pointer-events: none;
        }

        .content-preview.has-embedded-video .ratio iframe {
            pointer-events: all;
            cursor: default;
        }

        .content-preview .ratio iframe {
            border-radius: 8px;
        }

        .duration-badge {
            position: relative;
            margin-top: 8px;
            display: inline-block;
        }

        .content-header {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .content-type-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .content-card.viewed .content-type-icon {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }

        .content-info {
            flex: 1;
            min-width: 0;
        }

        .content-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .content-description {
            margin: 0.75rem 0;
            padding: 0.75rem;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 8px;
        }

        .content-description p {
            margin: 0;
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
        }

        .content-meta {
            margin: 0.75rem 0;
            font-size: 0.85rem;
            color: #64748b;
        }

        .content-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .content-actions .btn {
            border-radius: 8px;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .content-actions .btn:hover {
            transform: translateY(-1px);
        }

        /* Content responsive */
        @media (max-width: 768px) {
            .content-card {
                padding: 1rem;
            }
            
            .content-header {
                gap: 0.5rem;
            }
            
            .content-type-icon {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .content-title {
                font-size: 0.95rem;
            }
            
            .content-actions {
                gap: 0.25rem;
            }
            
            .content-actions .btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }

        /* Progress bars */
        .progress-container {
            margin: 1rem 0;
        }

        .progress-bar-custom {
            height: 8px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-fill.low {
            background: var(--danger-gradient);
        }

        .progress-fill.medium {
            background: var(--warning-gradient);
        }

        .progress-fill.high {
            background: var(--success-gradient);
        }

        /* Chart container */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            min-height: 350px;
            max-height: 500px;
            position: relative;
            overflow: visible;
        }
        
        /* Progress chart specific container */
        .progress-chart-wrapper {
            margin-bottom: 2rem;
        }
        
        .progress-chart-wrapper .chart-container {
            height: 350px;
            margin-bottom: 1rem;
        }
        
        /* Progress info card */
        .progress-info-card {
            margin-top: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .progress-info-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Progress tab specific styles */
        #progress .dashboard-card {
            margin-bottom: 2rem;
        }
        
        #progress .row {
            margin-bottom: 1.5rem;
        }
        
        #progress .row:last-child {
            margin-bottom: 0;
        }
        
        /* Responsive adjustments for progress section */
        @media (max-width: 991.98px) {
            .progress-chart-wrapper .chart-container {
                height: 300px;
            }
            
            #progress .col-lg-8,
            #progress .col-lg-4 {
                margin-bottom: 1.5rem;
            }
        }
        
        @media (max-width: 767.98px) {
            .progress-chart-wrapper .chart-container {
                height: 250px;
                padding: 1rem;
            }
            
            .progress-info-card {
                font-size: 0.9rem;
            }
            
            .progress-info-card .h4 {
                font-size: 1.25rem;
            }
            
            .progress-info-card .h5 {
                font-size: 1.1rem;
            }
        }

        /* Responsive Radar Chart Container */
        .radar-chart-container {
            position: relative;
            width: 100%;
            height: 350px; /* Base height */
            max-width: 100%;
            margin: 0 auto;
        }

        .radar-chart-container canvas {
            max-width: 100% !important;
            height: auto !important;
        }

        /* Mobile optimizations for radar chart */
        @media (max-width: 576px) {
            .radar-chart-container {
                height: 280px; /* Smaller on mobile but still prominent */
                padding: 0 0.5rem;
            }
        }

        @media (min-width: 577px) and (max-width: 768px) {
            .radar-chart-container {
                height: 320px; /* Medium size for tablets */
            }
        }

        @media (min-width: 769px) and (max-width: 991px) {
            .radar-chart-container {
                height: 350px; /* Standard size for larger tablets */
            }
        }

        @media (min-width: 992px) {
            .radar-chart-container {
                height: 380px; /* Largest size for desktop */
            }
        }

        /* Loading states */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner-border-custom {
            width: 3rem;
            height: 3rem;
            border: 0.3em solid rgba(102, 126, 234, 0.25);
            border-top-color: #667eea;
        }

        /* Empty states */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--calm-text-muted); /* Mejorado para mejor contraste */
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Assessment specific styles */
        .question-card {
            background: var(--surface-elevated);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1rem;
        }

        .question-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .question-text {
            color: var(--text-primary);
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .option-item {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--border-color) !important;
        }

        .option-item:hover {
            border-color: #667eea !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .option-item.bg-primary {
            border-color: #667eea !important;
            background: var(--primary-gradient) !important;
        }

        .option-item .form-check-input {
            margin-top: 0.125rem;
        }
        
        /* Auto-advance enhancements for assessment */
        .auto-advance-option {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid var(--calm-border-light) !important;
        }
        
        .auto-advance-option:hover {
            border-color: var(--calm-primary) !important;
            background-color: var(--calm-primary-ultra-light) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(98, 130, 227, 0.15);
        }
        
        .auto-advance-option.selected {
            border-color: var(--calm-primary) !important;
            background-color: var(--calm-primary) !important;
            color: white !important;
            transform: scale(1);
            box-shadow: 0 6px 16px rgba(98, 130, 227, 0.3);
        }
        
        .auto-advance-option.selected .form-check-label {
            color: white !important;
            font-weight: 600;
        }
        
        .auto-advance-option .form-check-input {
            display: none; /* Hide radio buttons for cleaner look */
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Loading state for buttons */
        .btn-primary-custom:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* Evaluation Details Modal Styles */
        #evaluationDetailsModal .modal-dialog {
            max-width: 95%;
        }
        
        #evaluationDetailsModal .modal-content {
            background: #ffffff;
            border: 1px solid #dee2e6;
            color: #333;
        }
        
        #evaluationDetailsModal .modal-header {
            background: #f8f9fa !important;
            border-bottom: 1px solid #dee2e6 !important;
            color: #333 !important;
        }
        
        /* Header dark para evaluation details modal */
        #evaluationDetailsModal .modal-header.modal-header-dark {
            background: var(--calm-primary) !important;
            background-color: var(--calm-primary) !important;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2) !important;
            color: #ffffff !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark .modal-title,
        #evaluationDetailsModal .modal-header.modal-header-dark h5 {
            color: #ffffff !important;
            font-weight: 700 !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark i {
            color: #ffffff !important;
        }
        
        /* Botones en el header */
        #evaluationDetailsModal .modal-header .btn {
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
            font-size: 0.875rem !important;
        }
        
        #evaluationDetailsModal .modal-header .btn-light {
            background: rgba(255, 255, 255, 0.9) !important;
            color: var(--calm-primary) !important;
        }
        
        #evaluationDetailsModal .modal-header .btn-outline-light {
            background: transparent !important;
            color: #ffffff !important;
            border-color: rgba(255, 255, 255, 0.5) !important;
        }
        
        #evaluationDetailsModal .modal-header .btn-outline-light:hover {
            background: rgba(255, 255, 255, 0.1) !important;
            color: #ffffff !important;
        }
        
        /* Asegurar que el botón close sea blanco en evaluation details modal */
        #evaluationDetailsModal .modal-header .btn-close {
            filter: invert(1) !important;
            opacity: 1 !important;
        }
        
        #evaluationDetailsModal .modal-header .btn-close:hover {
            filter: invert(1) !important;
            opacity: 0.8 !important;
        }
        
        #evaluationDetailsModal .modal-header .modal-title,
        #evaluationDetailsModal .modal-header h5 {
            color: #333 !important;
            font-weight: 700 !important;
        }
        
        #evaluationDetailsModal .modal-header i {
            color: #333 !important;
        }
        
        #evaluationDetailsModal .modal-body {
            background: #ffffff;
            color: #333;
        }
        
        #evaluationDetailsModal .card {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            color: #333;
        }
        
        #evaluationDetailsModal h4,
        #evaluationDetailsModal h5,
        #evaluationDetailsModal h6 {
            color: #333 !important;
        }
        
        /* SOLUCIÓN FINAL: MÁS ESPECÍFICO QUE LA REGLA ANTERIOR */
        #evaluationDetailsModal .general-recommendations h6.category-title {
            color: white !important;
        }
        
        /* ESTILOS PARA EL MODAL DE RESULTADOS DE EVALUACIÓN - MISMOS QUE EVALUATIONDETAILSMODAL */
        #assessmentResultsModal .modal-header.modal-header-dark,
        #assessmentResultsModal .modal-header,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header {
            background: var(--calm-primary) !important;
            background-color: var(--calm-primary) !important;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2) !important;
            padding: 1.25rem 1.5rem !important;
            color: #ffffff !important;
        }
        
        #assessmentResultsModal .modal-header .modal-title,
        #assessmentResultsModal .modal-header h5,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header .modal-title {
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 1.3rem !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
            letter-spacing: 0.5px !important;
        }
        
        #assessmentResultsModal .modal-header .modal-title i,
        #assessmentResultsModal .modal-header i,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header i {
            color: #ffffff !important;
            opacity: 1 !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
        }
        
        /* Forzar color blanco en TODOS los elementos del header con máxima especificidad */
        #assessmentResultsModal .modal-header,
        #assessmentResultsModal .modal-header h1,
        #assessmentResultsModal .modal-header h2,
        #assessmentResultsModal .modal-header h3,
        #assessmentResultsModal .modal-header h4,
        #assessmentResultsModal .modal-header h5,
        #assessmentResultsModal .modal-header h6,
        #assessmentResultsModal .modal-header span,
        #assessmentResultsModal .modal-header div:not(.d-flex):not(.gap-2) {
            color: #ffffff !important;
            background: transparent !important;
        }
        
        /* Asegurar que el contenedor de botones sea clickeable */
        #assessmentResultsModal .modal-header .d-flex,
        #assessmentResultsModal .modal-header .gap-2 {
            pointer-events: auto !important;
            z-index: 1000 !important;
        }
        
        /* Botones de la cabecera del modal de resultados */
        #assessmentResultsModal .modal-header .btn,
        #assessmentResultsModal .modal-header .btn-close,
        #assessmentResultsModal .modal-header .btn-secondary,
        #assessmentResultsModal .modal-header .btn-danger,
        #assessmentResultsModal .modal-header button {
            background-color: #6c757d !important;
            border: 1px solid #5a6268 !important;
            color: white !important;
            border-radius: 6px !important;
            padding: 8px 16px !important;
            transition: all 0.3s ease !important;
            font-weight: 600 !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            margin-left: 8px !important;
            pointer-events: auto !important;
            cursor: pointer !important;
            z-index: 999 !important;
            position: relative !important;
        }
        
        #assessmentResultsModal .modal-header .btn:hover,
        #assessmentResultsModal .modal-header .btn-close:hover,
        #assessmentResultsModal .modal-header .btn-secondary:hover,
        #assessmentResultsModal .modal-header .btn-danger:hover,
        #assessmentResultsModal .modal-header button:hover {
            background-color: #5a6268 !important;
            border-color: #4e555b !important;
            color: white !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
            pointer-events: auto !important;
            cursor: pointer !important;
        }
        
        /* Especificidad ultra-alta para el background del modal de resultados */
        body #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header.modal-header-dark,
        body #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header {
            background: #1E3A8A !important;
            background-color: #1E3A8A !important;
            color: #ffffff !important;
        }

        /* Estilos específicos para el modal de video */
        #videoModal .modal-header {
            background: #1E3A8A !important;
            color: white !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        #videoModal .modal-header .modal-title {
            color: white !important;
            font-weight: 600 !important;
            flex-grow: 1 !important;
            margin-right: 1rem !important;
        }

        #videoModal .modal-header .btn-close {
            background: rgba(0, 0, 0, 0.6) !important;
            opacity: 1 !important;
            border-radius: 0.375rem !important;
            padding: 0.375rem !important;
            margin: 0 !important;
            margin-left: auto !important;
            border: none !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        #videoModal .modal-header .btn-close:hover {
            background: rgba(0, 0, 0, 0.8) !important;
            transform: scale(1.05) !important;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3) !important;
        }

        #videoModal .modal-header .btn-close span {
            color: white !important;
            font-size: 1.2rem !important;
            font-weight: bold !important;
            line-height: 1 !important;
        }
        
        /* Estilos específicos para la sección de completado */
        #assessmentResultsModal .assessment-completion-section {
            background: linear-gradient(135deg, var(--calm-primary), var(--calm-secondary)) !important;
            color: white !important;
            padding: 2rem !important;
            border-radius: 12px !important;
            margin-bottom: 2rem !important;
            box-shadow: 0 4px 20px rgba(30, 58, 138, 0.3) !important;
        }
        
        #assessmentResultsModal .assessment-score-display {
            font-size: 3.5rem !important;
            font-weight: 800 !important;
            color: #ffffff !important;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        }
        
        #assessmentResultsModal .assessment-level-display {
            font-size: 1.5rem !important;
            font-weight: 600 !important;
            color: #ffffff !important;
            margin-top: 0.5rem !important;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.2) !important;
        }

        /* Estilos profesionales para recomendaciones categorizadas */
        .recommendations-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            border: 2px solid var(--calm-accent);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .recommendations-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white !important;
            padding: 1.5rem;
            border-bottom: 3px solid var(--calm-accent);
            position: relative;
        }
        
        .recommendations-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--calm-accent) 0%, #0ea5e9 50%, var(--calm-accent) 100%);
        }
        
        .recommendation-category {
            background: white;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .recommendation-category:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
            border-color: var(--calm-accent);
        }
        
        .category-header {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-bottom: 2px solid #e2e8f0;
            padding: 1rem 1.25rem;
            position: relative;
        }
        
        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--calm-accent) 0%, #0ea5e9 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 0.75rem;
        }
        
        .score-badge {
            background: linear-gradient(135deg, var(--calm-secondary) 0%, var(--calm-accent) 100%);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .priority-indicator {
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-top: 15px solid;
        }
        
        .priority-high {
            border-top-color: #ef4444;
        }
        
        .priority-medium {
            border-top-color: #f59e0b;
        }
        
        .priority-low {
            border-top-color: #06b6d4;
        }
        
        .priority-growth {
            border-top-color: #10b981;
        }
        
        .category-content {
            padding: 1.25rem;
        }
        
        .recommendation-item {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--calm-accent);
            position: relative;
            transition: all 0.2s ease;
        }
        
        .recommendation-item:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-left-color: var(--calm-primary);
            transform: translateX(5px);
        }
        
        .recommendation-item:before {
            content: "✓";
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--calm-accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .recommendation-text {
            margin-left: 1.5rem;
            line-height: 1.6;
            color: #334155;
            font-weight: 500;
        }
        

        
        .strengths-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .strengths-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .strengths-category .category-title {
            color: white;
        }
        
        .strengths-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .strengths-category .recommendation-item:before {
            background: #10b981;
            content: "★";
        }
        
        .final-message {
            border: 2px solid #8b5cf6;
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
        }
        
        .final-message .category-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-bottom-color: #8b5cf6;
        }
        
        .final-message .category-title {
            color: white;
        }
        
        .final-message .recommendation-item {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-left-color: #8b5cf6;
        }
        
        /* Estilos especiales para subcategorías de dimensiones */
        .dimension-subcategory {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            margin-bottom: 2rem;
        }
        
        .subcategory-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white;
            padding: 1.25rem;
            border-bottom: 3px solid var(--calm-accent);
        }
        
        .subcategory-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .subcategory-info {
            flex: 1;
        }
        
        .subcategory-title {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }
        
        .subcategory-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .dimension-icon {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        .score-container {
            text-align: center;
        }
        
        .score-badge-large {
            display: block;
            font-size: 1.5rem;
            font-weight: 800;
            padding: 0.75rem 1.25rem;
            border-radius: 25px;
            margin-bottom: 0.25rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        .score-critical {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .score-needs-improvement {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .score-good {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }
        
        .score-excellent {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .score-level {
            font-size: 0.8rem;
            font-weight: 600;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .subcategory-content {
            padding: 1.5rem;
            background: white;
        }
        
        .dimension-item {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--calm-primary);
        }
        
        .dimension-item:hover {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-left-color: #1D4ED8;
        }
        
        .dimension-item:before {
            background: var(--calm-primary);
            content: "→";
        }
        
        .congratulations-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .congratulations-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .congratulations-category .category-title {
            color: white;
        }
        
        .congratulations-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .congratulations-category .recommendation-item:before {
            background: #10b981;
            content: "🎉";
        }
        
        .dimension-category {
            border: 2px solid var(--calm-primary);
        }
        
        .dimension-category .priority-indicator {
            display: none; /* Hide priority indicator for dimension subcategories */
        }
        
        /* Responsive adjustments for subcategories */
        @media (max-width: 768px) {
            .subcategory-title-container {
                flex-direction: column;
                text-align: center;
            }
            
            .score-badge-large {
                font-size: 1.25rem;
                padding: 0.5rem 1rem;
            }
        }

        .progress-bar-custom {
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-fill.high {
            background: var(--success-gradient);
        }

        .progress-fill.medium {
            background: var(--warning-gradient);
        }

        .progress-fill.low {
            background: var(--danger-gradient);
        }

        .dimension-score-card {
            transition: transform 0.2s ease;
        }

        .dimension-score-card:hover {
            transform: translateY(-2px);
        }

        .evaluation-section {
            border-left: 4px solid var(--primary-gradient);
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }

        .response-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        /* Improved Assessment Results Styles */
        .assessment-result-card {
            background: var(--calm-surface);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(90, 103, 216, 0.08);
            overflow: hidden;
            margin-bottom: 2rem;
            border: 1px solid var(--calm-border);
            transition: all 0.3s ease;
        }

        .assessment-result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(90, 103, 216, 0.12);
        }

        .assessment-result-header {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .assessment-result-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="60" cy="10" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="70" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="60" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
            pointer-events: none;
        }

        .assessment-score-display {
            font-size: 4rem;
            font-weight: 800;
            margin: 0.5rem 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
        }

        .assessment-level-display {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            opacity: 0.95;
            position: relative;
            z-index: 2;
        }

        .assessment-completion-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 1rem;
            position: relative;
            z-index: 2;
        }

        .assessment-result-body {
            padding: 2rem;
        }

        .assessment-interpretation {
            background: var(--calm-surface-elevated);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid var(--calm-primary);
        }

        .assessment-interpretation h5 {
            color: var(--calm-primary);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .assessment-interpretation p {
            color: var(--calm-text-secondary);
            line-height: 1.6;
            margin-bottom: 0;
        }

        .dimensions-overview {
            background: var(--calm-surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--calm-border);
        }

        .dimensions-overview h6 {
            color: var(--calm-text-primary);
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }

        .dimension-item {
            background: var(--calm-surface-elevated);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--calm-border);
            transition: all 0.2s ease;
        }

        .dimension-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.08);
        }

        .dimension-item:last-child {
            margin-bottom: 0;
        }

        .dimension-label {
            font-weight: 600;
            color: var(--calm-text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .dimension-score {
            font-weight: 700;
            color: var(--calm-primary);
        }

        .dimension-progress {
            background: var(--calm-border);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .dimension-progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease-in-out;
            background: var(--primary-gradient);
            position: relative;
        }

        .dimension-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .assessment-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .assessment-action-btn {
            background: var(--calm-surface-elevated);
            border: 2px solid var(--calm-border);
            color: var(--calm-text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .assessment-action-btn:hover {
            background: var(--calm-primary);
            border-color: var(--calm-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(90, 103, 216, 0.25);
        }

        .assessment-action-btn.primary {
            background: var(--primary-gradient);
            border-color: var(--calm-primary);
            color: white;
        }

        .assessment-action-btn.primary:hover {
            background: var(--calm-primary-dark);
            border-color: var(--calm-primary-dark);
            color: white;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .assessment-score-display {
                font-size: 3rem;
            }
            
            .assessment-level-display {
                font-size: 1.2rem;
            }
            
            .assessment-result-header {
                padding: 1.5rem;
            }
            
            .assessment-result-body {
                padding: 1.5rem;
            }
            
            .assessment-actions {
                flex-direction: column;
            }
            
            .assessment-action-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Utilities */
        .hidden { display: none !important; }
        .visible { display: block !important; }
        /* ========== FORZAR CONTRASTE GLOBAL - ANULAR BOOTSTRAP ========== */
        
        /* Anular todas las clases de texto claras de Bootstrap */
        .text-muted {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris claro */
        }
        
        .text-secondary {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris */
        }
        
        .text-light {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris claro */
        }
        
        /* Forzar contraste en summary cards */
        .summary-card {
            background: #FFFFFF !important; /* Fondo blanco puro */
            border: 2px solid var(--calm-primary) !important; /* Borde azul visible */
            box-shadow: 0 4px 20px rgba(30, 58, 138, 0.15) !important;
        }
        
        .summary-card .summary-number {
            color: var(--calm-primary) !important; /* Azul para números */
            font-weight: 800 !important;
        }
        
        .summary-card .summary-label {
            color: var(--calm-text-primary) !important; /* Negro para etiquetas */
            font-weight: 600 !important;
        }
        
        /* Forzar contraste en evaluation cards */
        .evaluation-item {
            background: #FFFFFF !important;
            border: 2px solid var(--calm-border) !important;
        }
        
        .evaluation-item .text-muted,
        .evaluation-item .small {
            color: var(--calm-text-muted) !important;
        }
        
        /* Task cards con mejor contraste */
        .task-item {
            background: #FFFFFF !important;
            border: 2px solid var(--calm-border) !important;
        }
        
        .task-item .text-muted {
            color: var(--calm-text-muted) !important;
        }
        
        /* Botones con contraste mejorado */
        .btn-outline-evaluation,
        .btn-outline-task,
        .btn-outline-progress {
            background: #FFFFFF !important;
            border-width: 2px !important;
            font-weight: 700 !important;
        }
        
        /* Asegurar que los iconos sean visibles */
        .summary-icon {
            border: 2px solid currentColor !important;
            background: rgba(255, 255, 255, 0.9) !important;
        }
        
        .summary-icon.primary {
            color: var(--calm-primary) !important;
            background: rgba(30, 58, 138, 0.1) !important;
        }
        
        .summary-icon.success {
            color: var(--calm-mint-green) !important;
            background: rgba(16, 185, 129, 0.1) !important;
        }
        
        .summary-icon.warning {
            color: #F59E0B !important;
            background: rgba(245, 158, 11, 0.1) !important;
        }
        
        .summary-icon.danger {
            color: #EF4444 !important;
            background: rgba(239, 68, 68, 0.1) !important;
        }
        
        /* Headers de cards más legibles */
        .card-header p {
            color: rgba(255, 255, 255, 0.9) !important;
        }
        
        /* ========== FIN FORZAR CONTRASTE ========== */

        /* === SISTEMA DE TEMAS PARA COACHEE DASHBOARD === */
        /* Tema Día (por defecto) */
        :root {
            --theme-bg-primary: var(--calm-gradient-primary);
            --theme-bg-secondary: var(--calm-light);
            --theme-text-primary: var(--calm-white);
            --theme-text-secondary: var(--calm-gray-600);
            --theme-text-muted: rgba(255, 255, 255, 0.7);
            --theme-card-bg: rgba(255, 255, 255, 0.1);
            --theme-card-border: rgba(255, 255, 255, 0.2);
            --theme-shadow: var(--calm-shadow-soft);
            --theme-glass-bg: rgba(30, 58, 138, 0.08);
            --theme-glass-border: rgba(59, 130, 246, 0.12);
        }

        /* Tema Noche - COPIADO DEL COACH DASHBOARD */
        [data-theme="dark"] {
            /* Tema oscuro con tonos azulados del landing page */
            --theme-bg-primary: #3B82F6;        /* Bright Blue principal */
            --theme-bg-secondary: #3B82F6;      /* Bright Blue secundario */
            --theme-bg-card: rgba(51, 65, 85, 0.9);  /* Cards con tono azulado */
            --theme-text-primary: #F8FAFC;
            --theme-text-secondary: #CBD5E1;
            --theme-text-muted: #94A3B8;
            --theme-border-primary: rgba(148, 163, 184, 0.2);
            --theme-border-secondary: rgba(148, 163, 184, 0.3);
            --theme-shadow: rgba(30, 58, 138, 0.2);  /* Sombras con tinte azul */
            --theme-accent: #3B82F6;             /* Azul del landing page */
            --theme-accent-hover: #60A5FA;       /* Azul más claro al hover */
        }

        /* Aplicar variables a elementos base */
        [data-theme="dark"] body {
            background: var(--theme-bg-primary) !important;
            color: var(--theme-text-primary) !important;
            transition: background-color 0.3s ease, color 0.3s ease !important;
        }

        /* === ESTILOS PARA TEMA NOCTURNO MEJORADOS === */
        [data-theme="dark"] .glass-card {
            background: rgba(59, 130, 246, 0.85) !important;  /* Azul principal #3B82F6 con transparencia */
            border-color: rgba(59, 130, 246, 0.3) !important;  /* Borde azul */
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15) !important;  /* Sombra azul */
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .glass-card:hover {
            background: rgba(59, 130, 246, 0.95) !important;  /* Azul más sólido en hover */
            border-color: rgba(59, 130, 246, 0.4) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.25) !important;
        }

        [data-theme="dark"] .glass-card h3,
        [data-theme="dark"] .glass-card h4,
        [data-theme="dark"] .glass-card h5,
        [data-theme="dark"] .glass-card h6 {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .glass-card .text-muted {
            color: var(--theme-text-muted) !important;
        }

        [data-theme="dark"] .text-white-50 {
            color: var(--theme-text-secondary) !important;
        }

        [data-theme="dark"] .btn-outline-light {
            border-color: #06B6D4 !important;
            color: #06B6D4 !important;
            background: rgba(6, 182, 212, 0.1) !important;
        }

        [data-theme="dark"] .btn-outline-light:hover {
            background-color: rgba(6, 182, 212, 0.2) !important;
            border-color: #0284C7 !important;
            color: #0284C7 !important;
        }

        [data-theme="dark"] .btn-outline-light i {
            color: #06B6D4 !important;
        }

        [data-theme="dark"] .btn-outline-light:hover i {
            color: #0284C7 !important;
        }

        [data-theme="dark"] .btn-primary {
            background: linear-gradient(135deg, #3B82F6, #3B82F6) !important;  /* Bright Blue uniforme */
            border-color: #3B82F6 !important;
            color: #FFFFFF !important;
        }

        [data-theme="dark"] .btn-primary:hover {
            background: linear-gradient(135deg, #3B82F6, #2563EB) !important;  /* Hover con variación sutil */
            border-color: #3B82F6 !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        [data-theme="dark"] .btn-outline-primary {
            color: #3B82F6 !important;
            border-color: #3B82F6 !important;
            background: transparent !important;
        }

        [data-theme="dark"] .btn-outline-primary:hover {
            background: #3B82F6 !important;
            border-color: #3B82F6 !important;
            color: white !important;
        }

        [data-theme="dark"] .modal-content {
            background: rgba(51, 65, 85, 0.95) !important;  /* Azul grisáceo */
            border-color: rgba(59, 130, 246, 0.2) !important;  /* Borde azul suave */
            box-shadow: 0 20px 40px rgba(30, 58, 138, 0.25) !important;  /* Sombra azulada */
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .modal-header {
            border-color: rgba(59, 130, 246, 0.2) !important;
            background: rgba(51, 65, 85, 0.95) !important;
        }

        [data-theme="dark"] .modal-footer {
            border-color: rgba(59, 130, 246, 0.2) !important;
            background: rgba(51, 65, 85, 0.95) !important;
        }

        [data-theme="dark"] .modal-title {
            color: var(--theme-text-primary) !important;
        }

        /* Estilos específicos para asegurar que todos los textos sean visibles en modo noche */
        [data-theme="dark"] .card-header h3,
        [data-theme="dark"] .card-header h4,
        [data-theme="dark"] .card-header h5,
        [data-theme="dark"] .card-header h6 {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .evaluation-item h6 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Estilo para títulos de evaluaciones disponibles (h5) */
        [data-theme="dark"] .evaluation-item h5 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Override específico para evaluaciones disponibles dentro del card-body */
        [data-theme="dark"] #availableEvaluations .evaluation-item h5,
        [data-theme="dark"] .card-body .evaluation-item h5 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Estilos para evaluaciones completadas - mantener colores originales */
        [data-theme="dark"] .evaluation-score.text-success,
        [data-theme="dark"] .evaluation-level.text-success {
            color: #10B981 !important; /* Verde más brillante para modo noche */
            font-weight: bold !important;
        }

        [data-theme="dark"] .evaluation-score.text-warning,
        [data-theme="dark"] .evaluation-level.text-warning {
            color: #F59E0B !important; /* Amarillo más brillante para modo noche */
            font-weight: bold !important;
        }

        [data-theme="dark"] .evaluation-score.text-danger,
        [data-theme="dark"] .evaluation-level.text-danger {
            color: #EF4444 !important; /* Rojo más brillante para modo noche */
            font-weight: bold !important;
        }

        /* Override más específico para evaluaciones completadas */
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-success,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-success {
            color: #10B981 !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-warning,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-warning {
            color: #F59E0B !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-danger,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-danger {
            color: #EF4444 !important;
            font-weight: bold !important;
        }

        /* Estilos para tareas asignadas en modo noche */
        [data-theme="dark"] .task-item .task-title {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] .task-item .task-description {
            color: #2d3748 !important;
        }

        [data-theme="dark"] .task-item .text-muted,
        [data-theme="dark"] .task-item small {
            color: #4a5568 !important;
        }

        [data-theme="dark"] .task-badge {
            color: #1a1a1a !important;
            background: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid #4a5568 !important;
        }

        /* Estilos específicos para badges de prioridad en modo noche */
        [data-theme="dark"] .task-badge.priority-high {
            background: #FED7D7 !important;
            color: #C53030 !important;
        }

        [data-theme="dark"] .task-badge.priority-medium {
            background: #FEEBC8 !important;
            color: #DD6B20 !important;
        }

        [data-theme="dark"] .task-badge.priority-low {
            background: #C6F6D5 !important;
            color: #38A169 !important;
        }

        /* Estilos para badges de estado en modo noche */
        [data-theme="dark"] .task-badge.status-pending {
            background: #BEE3F8 !important;
            color: #2B6CB0 !important;
        }

        [data-theme="dark"] .task-badge.status-in_progress {
            background: #FEEBC8 !important;
            color: #DD6B20 !important;
        }

        [data-theme="dark"] .task-badge.status-completed {
            background: #C6F6D5 !important;
            color: #38A169 !important;
        }

        /* Override específico para contenedor de tareas */
        [data-theme="dark"] #tasksContainer .task-item h5,
        [data-theme="dark"] #tasksContainer .task-item .task-title {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #tasksContainer .task-item p,
        [data-theme="dark"] #tasksContainer .task-item .task-description {
            color: #2d3748 !important;
        }

        [data-theme="dark"] .dashboard-card h3 {
            color: var(--theme-text-primary) !important;
        }

        /* Corregir el problema específico del card-header que fuerza texto blanco */
        [data-theme="dark"] .card-header,
        [data-theme="dark"] .card-header *,
        [data-theme="dark"] .card-header .text-muted,
        [data-theme="dark"] .card-header .text-secondary,
        [data-theme="dark"] .card-header small,
        [data-theme="dark"] .card-header span {
            color: #000000 !important;
        }

        /* Aplicar color negro oscuro y bold para h3 en card-header - MÁS ESPECÍFICO */
        [data-theme="dark"] .dashboard-card .card-header h3,
        [data-theme="dark"] .card-header h3.mb-0 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Override final super específico para el texto "Evaluación de Asertividad" */
        [data-theme="dark"] #assessment .dashboard-card .card-header h3,
        [data-theme="dark"] .tab-pane .dashboard-card .card-header h3 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Excepciones para elementos que deben mantener su color */
        [data-theme="dark"] .btn,
        [data-theme="dark"] .badge,
        [data-theme="dark"] .progress-bar,
        [data-theme="dark"] .evaluation-score {
            color: inherit !important;
        }

        /* Formularios en tema nocturno */
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .form-select {
            background: rgba(51, 65, 85, 0.8) !important;
            border-color: rgba(59, 130, 246, 0.3) !important;
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .form-control:focus,
        [data-theme="dark"] .form-select:focus {
            background: rgba(51, 65, 85, 0.9) !important;
            border-color: #3B82F6 !important;
            color: var(--theme-text-primary) !important;
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25) !important;
        }

        [data-theme="dark"] .form-control::placeholder {
            color: var(--theme-text-muted) !important;
        }

        /* Badges en tema nocturno */
        [data-theme="dark"] .badge.bg-primary {
            background-color: #3B82F6 !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .badge.bg-success {
            background-color: #10B981 !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .badge.bg-warning {
            background-color: #F59E0B !important;
            color: #0F172A !important;
        }

        [data-theme="dark"] .badge.bg-danger {
            background-color: #EF4444 !important;
            color: #F8FAFC !important;
        }

        /* Progress bars en tema nocturno */
        [data-theme="dark"] .progress {
            background-color: rgba(30, 41, 59, 0.5) !important;
        }

        /* Tablas en tema nocturno */
        [data-theme="dark"] .table {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .table-striped > tbody > tr:nth-of-type(odd) > td {
            background-color: rgba(30, 41, 59, 0.3) !important;
        }

        /* Canvas/gráficos en tema nocturno */
        [data-theme="dark"] canvas {
            filter: brightness(0.9) contrast(1.1);
        }

        /* Transiciones suaves */
        body,
        .glass-card,
        .card,
        .btn,
        .form-control,
        .form-select,
        .modal-content {
            transition: all 0.3s ease;
        }

        /* === MEJORAS COMPREHENSIVAS PARA MODO NOCHE === */
        
        /* Mejoras para títulos y encabezados en modo noche */
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6 {
            color: #F8FAFC !important;
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        /* Mejoras para texto general en modo noche */
        [data-theme="dark"] p,
        [data-theme="dark"] span,
        [data-theme="dark"] div,
        [data-theme="dark"] label {
            color: #E2E8F0 !important;
            text-shadow: none !important;
        }

        /* Mejoras para enlaces en modo noche */
        [data-theme="dark"] a {
            color: #60A5FA !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] a:hover {
            color: #93C5FD !important;
            text-decoration: underline !important;
        }

        /* Mejoras para botones en modo noche */
        [data-theme="dark"] .btn {
            background: rgba(59, 130, 246, 0.9) !important;
            border: 1px solid rgba(59, 130, 246, 0.6) !important;
            color: #FFFFFF !important;
            text-shadow: none !important;
            backdrop-filter: none !important;
        }

        [data-theme="dark"] .btn:hover {
            background: rgba(59, 130, 246, 1) !important;
            border-color: rgba(59, 130, 246, 0.8) !important;
            color: #FFFFFF !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4) !important;
        }

        /* Mejoras para botones secundarios en modo noche */
        [data-theme="dark"] .btn-secondary {
            background: rgba(148, 163, 184, 0.6) !important;
            border-color: rgba(148, 163, 184, 0.4) !important;
            color: #FFFFFF !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.8) !important;
            color: #FFFFFF !important;
        }

        /* Estilos adicionales para cards y elementos específicos */
        [data-theme="dark"] .card {
            background: var(--theme-bg-card) !important;
            border-color: rgba(59, 130, 246, 0.2) !important;
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .card-header {
            background: var(--theme-bg-card) !important;
            border-bottom-color: rgba(59, 130, 246, 0.2) !important;
        }

        [data-theme="dark"] .card-body {
            background: var(--theme-bg-card) !important;
        }

        [data-theme="dark"] .navbar {
            background: var(--theme-bg-primary) !important;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2) !important;
        }

        [data-theme="dark"] .navbar-brand {
            color: var(--theme-text-primary) !important;
        }

        /* Estilos finales globales */
        [data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, 
        [data-theme="dark"] h4, [data-theme="dark"] h5, [data-theme="dark"] h6,
        [data-theme="dark"] p, [data-theme="dark"] span, [data-theme="dark"] div {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .text-dark {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .bg-light, [data-theme="dark"] .bg-white {
            background: var(--theme-bg-card) !important;
        }

        [data-theme="dark"] .form-control:focus,
        [data-theme="dark"] .form-select:focus {
            background: rgba(30, 41, 59, 0.95) !important;
            border-color: #3B82F6 !important;
            box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.4) !important;
            color: #FFFFFF !important;
        }

        /* Mejoras para tablas en modo noche */
        [data-theme="dark"] .table {
            background: rgba(30, 41, 59, 0.6) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .table th {
            background: rgba(59, 130, 246, 0.2) !important;
            color: #F8FAFC !important;
            border-color: rgba(148, 163, 184, 0.3) !important;
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        [data-theme="dark"] .table td {
            border-color: rgba(148, 163, 184, 0.2) !important;
            color: #E2E8F0 !important;
        }

        /* Mejoras para badges en modo noche */
        [data-theme="dark"] .badge {
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        /* Mejoras para alerts en modo noche */
        [data-theme="dark"] .alert {
            background: rgba(30, 41, 59, 0.9) !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            color: #F8FAFC !important;
            backdrop-filter: none !important;
        }

        [data-theme="dark"] .alert-info {
            background: rgba(59, 130, 246, 0.2) !important;
            border-color: rgba(59, 130, 246, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-success {
            background: rgba(16, 185, 129, 0.2) !important;
            border-color: rgba(16, 185, 129, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-warning {
            background: rgba(245, 158, 11, 0.2) !important;
            border-color: rgba(245, 158, 11, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-danger {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: rgba(239, 68, 68, 0.4) !important;
            color: #F8FAFC !important;
        }

        /* Mejoras para dropdowns en modo noche */
        [data-theme="dark"] .dropdown-menu {
            background: rgba(30, 41, 59, 0.98) !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            backdrop-filter: none !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6) !important;
        }

        [data-theme="dark"] .dropdown-item {
            color: #E2E8F0 !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] .dropdown-item:hover {
            background: rgba(59, 130, 246, 0.3) !important;
            color: #F8FAFC !important;
        }

        /* Mejoras para scrollbars en modo noche */
        [data-theme="dark"] ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 4px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.6);
            border-radius: 4px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.8);
        }

        /* === ELIMINACIÓN TOTAL DE EFECTOS BLUR EN MODO NOCHE === */
        
        /* Override general para eliminar todos los backdrop-filter y filter blur en modo noche */
        [data-theme="dark"] *,
        [data-theme="dark"] *::before,
        [data-theme="dark"] *::after {
            backdrop-filter: none !important;
        }
        
        /* Específicamente para elementos que pueden tener blur */
        [data-theme="dark"] .glass-card,
        [data-theme="dark"] .card,
        [data-theme="dark"] .modal-content,
        [data-theme="dark"] .navbar,
        [data-theme="dark"] .btn,
        [data-theme="dark"] .alert,
        [data-theme="dark"] .dropdown-menu,
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .badge {
            backdrop-filter: none !important;
            filter: none !important;
        }
        
        /* Asegurar que el texto sea completamente nítido */
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6,
        [data-theme="dark"] p,
        [data-theme="dark"] span,
        [data-theme="dark"] div,
        [data-theme="dark"] label,
        [data-theme="dark"] a,
        [data-theme="dark"] button {
            text-rendering: optimizeLegibility !important;
            -webkit-font-smoothing: antialiased !important;
            -moz-osx-font-smoothing: grayscale !important;
        }

        /* Estilos para presentación compacta de recomendaciones */
        .compact-recommendations .card {
            transition: all 0.2s ease;
        }
        
        .compact-recommendations .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15) !important;
        }
        
        .compact-recommendations .card-header {
            border-bottom: 2px solid #007bff;
        }
        
        .compact-recommendations .fw-bold {
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .compact-recommendations small {
            font-size: 0.8rem;
            line-height: 1.3;
        }
        
        .compact-recommendations .text-primary {
            color: #007bff !important;
            border-bottom: 1px solid rgba(0, 123, 255, 0.2);
            padding-bottom: 2px;
            margin-bottom: 8px !important;
        }
        
        .compact-recommendations .ms-3 {
            padding-left: 1rem;
            border-left: 2px solid #e9ecef;
            margin-left: 0.5rem;
        }
        
        .compact-recommendations .badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }
        
        /* ========== OPTIMIZACIÓN MÓVIL PARA MODAL DE EVALUACIÓN ========== */
        @media (max-width: 768px) {
            /* Modal de evaluación a pantalla completa en móvil */
            #evaluationDetailsModal .modal-dialog {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 !important;
                height: 100vh !important;
                max-height: 100vh !important;
            }
            
            #evaluationDetailsModal .modal-content {
                height: 100vh !important;
                max-height: 100vh !important;
                border-radius: 0;
                border: none;
                display: flex;
                flex-direction: column;
            }
            
            #evaluationDetailsModal .modal-header {
                padding: 15px;
                border-bottom: 1px solid #dee2e6;
                flex-shrink: 0;
            }
            
            #evaluationDetailsModal .modal-body {
                padding: 15px;
                overflow-y: auto;
                flex: 1;
                -webkit-overflow-scrolling: touch;
            }
            
            #evaluationDetailsModal .modal-footer {
                padding: 15px;
                border-top: 1px solid #dee2e6;
                flex-shrink: 0;
            }
            
            /* Ajustar elementos internos del modal para móvil */
            #evaluationDetailsModal .modal-title {
                font-size: 1.1rem;
                line-height: 1.3;
            }
            
            #evaluationDetailsModal .btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            #evaluationDetailsModal .table-responsive {
                font-size: 13px;
            }
            
            #evaluationDetailsModal .chart-container {
                height: 250px !important;
            }
        }
        
        /* Para pantallas muy pequeñas (móviles en horizontal o muy pequeños) */
        @media (max-width: 576px) {
            #evaluationDetailsModal .modal-header {
                padding: 10px;
            }
            
            #evaluationDetailsModal .modal-body {
                padding: 10px;
            }
            
            #evaluationDetailsModal .modal-footer {
                padding: 10px;
            }
            
            #evaluationDetailsModal .modal-title {
                font-size: 1rem;
            }
            
            #evaluationDetailsModal .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
        }

        /* ========== MEJORAS RESPONSIVAS PARA SCHEDULE COACH MODULE ========== */
        @media (max-width: 768px) {
            /* Schedule Coach - Pestañas responsivas */
            #scheduleCoachTabs {
                flex-wrap: nowrap !important;
                overflow-x: auto !important;
                border-bottom: 1px solid #dee2e6 !important;
                scrollbar-width: none !important; /* Firefox */
                -ms-overflow-style: none !important; /* IE/Edge */
            }
            
            #scheduleCoachTabs::-webkit-scrollbar {
                display: none !important; /* Chrome/Safari */
            }
            
            #scheduleCoachTabs .nav-item {
                flex-shrink: 0 !important;
            }
            
            #scheduleCoachTabs .nav-link {
                white-space: nowrap !important;
                padding: 8px 12px !important;
                font-size: 0.85rem !important;
            }
            
            /* Schedule Coach - Layout responsivo */
            #schedule-coach .col-lg-8,
            #schedule-coach .col-lg-4 {
                margin-bottom: 1rem !important;
            }
            
            /* Formulario de solicitud - Stack vertical en mobile */
            #sessionRequestForm .row.g-3 .col-md-6 {
                margin-bottom: 1rem !important;
            }
            
            #sessionRequestForm .form-label {
                font-size: 0.9rem !important;
                margin-bottom: 0.25rem !important;
            }
            
            #sessionRequestForm .form-control,
            #sessionRequestForm .form-select {
                font-size: 0.9rem !important;
                padding: 0.5rem !important;
            }
            
            #sessionRequestForm .form-text {
                font-size: 0.75rem !important;
            }
            
            /* Información del coach más compacta */
            #coachAvailabilityInfo {
                padding: 0.75rem !important;
            }
            
            #coachAvailabilityInfo .list-group-item {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.85rem !important;
            }
            
            /* Tips para agendar más compactos */
            #schedule-coach .card .list-unstyled li {
                margin-bottom: 0.75rem !important;
                font-size: 0.85rem !important;
            }
            
            /* Lista de sesiones responsiva */
            #mySessionsList .card {
                margin-bottom: 0.75rem !important;
            }
            
            #mySessionsList .card-body {
                padding: 0.75rem !important;
            }
            
            #mySessionsList .card-title {
                font-size: 1rem !important;
            }
            
            #mySessionsList .card-text {
                font-size: 0.85rem !important;
            }
            
            /* Botones de sesión más compactos */
            #mySessionsList .btn-group {
                flex-direction: column !important;
                width: 100% !important;
            }
            
            #mySessionsList .btn-group .btn {
                border-radius: 0.375rem !important;
                margin-bottom: 0.25rem !important;
                font-size: 0.8rem !important;
                padding: 0.375rem 0.75rem !important;
            }
        }

        @media (max-width: 576px) {
            /* Mobile específico para schedule coach */
            #scheduleCoachTabs .nav-link {
                padding: 6px 8px !important;
                font-size: 0.8rem !important;
            }
            
            #scheduleCoachTabs .nav-link i {
                margin-right: 4px !important;
            }
            
            /* Ocultar texto en iconos en pantallas muy pequeñas */
            #scheduleCoachTabs .nav-link .d-none {
                display: none !important;
            }
            
            /* Formulario más compacto */
            #sessionRequestForm .card-body {
                padding: 0.75rem !important;
            }
            
            #sessionRequestForm .btn {
                width: 100% !important;
                padding: 0.75rem !important;
                font-size: 0.9rem !important;
            }
            
            /* Cards de información más pequeñas */
            #schedule-coach .card-header h6 {
                font-size: 0.9rem !important;
            }
            
            #schedule-coach .card-body {
                padding: 0.75rem !important;
            }
            
            /* Lista de sesiones en mobile */
            #mySessionsList .card-body {
                padding: 0.5rem !important;
            }
            
            #mySessionsList .badge {
                font-size: 0.7rem !important;
            }
            
            /* Botones de acción stack vertical */
            #my-sessions-pane .d-flex {
                flex-direction: column !important;
                gap: 0.5rem !important;
            }
            
            #my-sessions-pane .d-flex .btn {
                width: 100% !important;
            }
        }

        /* Tablet específico para schedule coach */
        @media (min-width: 769px) and (max-width: 1024px) {
            #schedule-coach .col-lg-4 {
                margin-top: 1rem !important;
            }
            
            #scheduleCoachTabs .nav-link {
                padding: 10px 16px !important;
            }
            
            /* Formulario en 2 columnas en tablet */
            #sessionRequestForm .row.g-3 {
                margin: 0 -0.5rem !important;
            }
            
            #sessionRequestForm .col-md-6 {
                padding: 0 0.5rem !important;
            }
            
            /* Cards de información lado a lado en tablet */
            #schedule-coach .col-lg-4 .card {
                margin-bottom: 1rem !important;
            }
        }

        /* Mejoras adicionales para mejor UX en todos los dispositivos */
        #schedule-coach .nav-tabs .nav-link.active {
            background-color: var(--theme-card-bg, #fff) !important;
            border-color: var(--theme-border, #dee2e6) !important;
            color: var(--theme-text, #495057) !important;
        }
        
        #schedule-coach .tab-content {
            border: 1px solid var(--theme-border, #dee2e6) !important;
            border-top: none !important;
            border-radius: 0 0 0.375rem 0.375rem !important;
            background-color: var(--theme-card-bg, #fff) !important;
            padding: 1rem !important;
        }
        
        @media (max-width: 768px) {
            #schedule-coach .tab-content {
                padding: 0.75rem !important;
            }
        }
        /* Document card styles */
        .document-card {
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
            height: 100%;
        }
        
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15) !important;
            border-color: #007bff;
        }
        
        .document-card .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #dee2e6;
            padding: 0.75rem;
            min-height: 60px;
            display: flex;
            align-items: center;
        }
        
        .document-card .card-body {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }
        
        .document-files .border {
            transition: all 0.2s ease;
            background-color: #f8f9fa;
        }
        
        .document-files .border:hover {
            background-color: #e3f2fd;
            border-color: #007bff !important;
        }
        
        /* Utility classes for better text handling */
        .min-width-0 {
            min-width: 0;
        }
        
        .flex-shrink-0 {
            flex-shrink: 0;
        }
        
        .text-truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        /* Document filters */
        #documentFilters {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #dee2e6;
        }
        
        /* Content tabs styling */
        #contentTabs .nav-link {
            color: #6c757d;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        #contentTabs .nav-link:hover {
            color: #007bff;
            border-bottom-color: #007bff;
        }
        
        #contentTabs .nav-link.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: none;
            font-weight: 600;
        }
        
        /* Dark theme support for document cards */
        [data-theme="dark"] .document-card {
            background: #2d3748;
            border-color: #4a5568;
        }
        
        [data-theme="dark"] .document-card:hover {
            border-color: #63b3ed;
            box-shadow: 0 4px 12px rgba(99, 179, 237, 0.15) !important;
        }
        
        [data-theme="dark"] .document-card .card-header {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            border-bottom-color: #4a5568;
        }
        
        [data-theme="dark"] .document-files .border {
            background-color: #374151;
            border-color: #4a5568;
        }
        
        [data-theme="dark"] .document-files .border:hover {
            background-color: #1e3a8a;
            border-color: #63b3ed !important;
        }
        
        [data-theme="dark"] .document-card .card-header {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border-bottom-color: #4a5568;
            color: #e2e8f0;
        }
        
        [data-theme="dark"] #documentFilters {
            background: #2d3748;
            border-color: #4a5568;
        }
        
        [data-theme="dark"] .document-files .border:hover {
            background-color: #4a5568;
            border-color: #63b3ed !important;
        }
        
        [data-theme="dark"] #contentTabs .nav-link {
            color: #a0aec0;
        }
        
        [data-theme="dark"] #contentTabs .nav-link:hover {
            color: #63b3ed;
            border-bottom-color: #63b3ed;
        }
        
        [data-theme="dark"] #contentTabs .nav-link.active {
            color: #63b3ed;
            border-bottom-color: #63b3ed;
        }
        
        /* Empty state styling for documents */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        [data-theme="dark"] .empty-state {
            color: #a0aec0;
        }
        
        /* ========== INSTAGRAM STYLE FEEDS ========== */
        .feeds-container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .instagram-post {
            background: white;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .post-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .post-author {
            display: flex;
            align-items: center;
        }
        
        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            margin-right: 12px;
        }
        
        .author-info h6 {
            margin: 0;
            font-weight: 600;
            font-size: 14px;
        }
        
        .author-info small {
            font-size: 12px;
            color: #8e8e8e;
        }
        
        .post-options {
            background: none;
            border: none;
            color: #8e8e8e;
            font-size: 16px;
            cursor: pointer;
        }
        
        .post-media {
            position: relative;
            width: 100%;
            background: #000;
        }

        .post-media .ratio {
            background: #000;
            border-radius: 0;
            max-height: 280px; /* Limitar altura máxima para que se vean los iconos */
        }

        .post-media .ratio-4x3 {
            max-height: 280px;
            overflow: hidden;
        }

        .post-media .ratio iframe {
            border-radius: 0;
            height: 280px;
            width: 100%;
            object-fit: cover;
        }
        
        .post-image {
            width: 100%;
            height: 280px; /* Misma altura que los videos */
            object-fit: cover;
            display: block;
        }
        
        .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .video-overlay:hover {
            background: rgba(0,0,0,0.9);
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .video-overlay i {
            color: white;
            font-size: 24px;
            margin-left: 3px;
        }
        
        .post-actions {
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 16px;
        }
        
        .action-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #262626;
            transition: color 0.2s ease;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            min-height: 40px;
        }

        .action-btn i {
            font-size: 24px !important;
            line-height: 1;
            font-family: "Font Awesome 6 Free" !important;
            font-weight: 400 !important;
            display: inline-block;
        }

        .action-btn i.fas {
            font-weight: 900 !important;
        }

        .action-btn small {
            margin-left: 4px;
            font-size: 10px;
            white-space: nowrap;
        }

        /* Asegurar que los iconos FontAwesome se vean */
        .post-actions .action-btn i:before {
            font-family: "Font Awesome 6 Free" !important;
        }
        
        .action-btn:hover {
            color: #8e8e8e;
        }
        
        .action-btn.liked {
            color: #ed4956;
        }
        
        .post-info {
            padding: 0 16px 16px;
        }
        
        .post-likes {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .post-caption {
            font-size: 14px;
            line-height: 1.4;
        }
        
        .post-caption .username {
            font-weight: 600;
            margin-right: 8px;
        }
        
        .post-time {
            color: #8e8e8e;
            font-size: 12px;
            margin-top: 8px;
        }
        
        /* Dark theme for Instagram posts */
        [data-theme="dark"] .instagram-post {
            background: #1a1a1a;
            border-color: #333;
        }
        
        [data-theme="dark"] .author-info h6,
        [data-theme="dark"] .action-btn,
        [data-theme="dark"] .post-likes,
        [data-theme="dark"] .post-caption {
            color: #ffffff;
        }
        
        [data-theme="dark"] .author-info small,
        [data-theme="dark"] .post-time {
            color: #8e8e8e;
        }
        
        [data-theme="dark"] .action-btn:hover {
            color: #dbdbdb;
        }
        
        /* Bottom Navigation - Estilo LinkedIn */
        .bottom-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            border-top: 1px solid #dbdbdb;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 8px;
            transition: color 0.2s;
            color: #8e8e8e;
            text-decoration: none;
        }
        
        .nav-item i {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .nav-item span {
            font-size: 11px;
            font-weight: 500;
        }
        
        .nav-item:hover,
        .nav-item.active {
            color: #0a66c2;
        }
        
        .nav-item.active {
            color: #262626;
        }
        
        /* Espacio inferior para evitar que el contenido quede debajo del nav */
        body {
            padding-bottom: 70px;
        }
        
        /* Tema oscuro para bottom navigation */
        [data-theme="dark"] .bottom-navigation {
            background: #1a1a1a;
            border-top-color: #2a2a2a;
        }
        
        [data-theme="dark"] .nav-item {
            color: #8e8e8e;
        }
        
        [data-theme="dark"] .nav-item:hover,
        [data-theme="dark"] .nav-item.active {
            color: #0a66c2;
        }
    </style>
</head>
<body>
    <!-- Animated background particles -->
    <div class="particles">
        <!-- Particles will be generated by JavaScript -->
    </div>

    <!-- Header - UNIFICADO CON FEED -->
    <div class="feed-header">
        <div>
            <h3 id="instacoach-title">InstaCoach</h3>
            <p class="mb-0" style="font-size: 14px; margin-top: 4px; color: #8e8e8e;">Welcome <span id="welcomeMessage"></span></p>
        </div>
        <div class="user-info">
            <div class="user-avatar" id="headerAvatarDashboard">
                <i class="fas fa-user"></i>
            </div>
            <div class="dropdown">
                <button class="btn btn-link p-0 ms-2" type="button" id="userMenuDropdownDashboard" data-bs-toggle="dropdown" aria-expanded="false" style="color: #262626;">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuDropdownDashboard">
                    <li><a class="dropdown-item" href="/coachee-profile"><i class="fas fa-user-circle me-2"></i>Mi Perfil</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="/participant-access"><i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión</a></li>
                </ul>
            </div>
        </div>
    </div>

<div class="container-fluid py-4">
        
        <!-- Statistics Cards - UNIFICADO CON COACH -->
        <div class="row mb-4">
            <div class="col-6 col-md-3 stats-card-mobile">
                <div class="card bg-dark border-secondary text-center stats-card-clickable" 
                     onclick="navigateToCompletedEvaluations()" 
                     style="cursor: pointer;" 
                     data-bs-toggle="tooltip" 
                     data-bs-placement="top" 
                     title="Click para ver evaluaciones completadas">
                    <div class="card-body">
                        <i class="fas fa-clipboard-check fa-2x text-success mb-3"></i>
                        <h4 class="text-white" id="totalEvaluations">0</h4>
                        <p class="text-muted mb-0">Evaluaciones Completadas</p>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-3 stats-card-mobile">
                <div class="card bg-dark border-secondary text-center">
                    <div class="card-body">
                        <i class="fas fa-chart-line fa-2x text-info mb-3"></i>
                        <h4 class="text-white" id="latestScore">0</h4>
                        <p class="text-muted mb-0">Última Puntuación</p>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-3 stats-card-mobile">
                <div class="card bg-dark border-secondary text-center stats-card-clickable" 
                     onclick="navigateToTasks()" 
                     style="cursor: pointer;" 
                     data-bs-toggle="tooltip" 
                     data-bs-placement="top" 
                     title="Click para ver tareas pendientes">
                    <div class="card-body">
                        <i class="fas fa-tasks fa-2x text-warning mb-3"></i>
                        <h4 class="text-white" id="pendingTasks">0</h4>
                        <p class="text-muted mb-0">Tareas Pendientes</p>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-3 stats-card-mobile">
                <div class="card bg-dark border-secondary text-center stats-card-clickable" 
                     onclick="navigateToOverdueTasks()" 
                     style="cursor: pointer;" 
                     data-bs-toggle="tooltip" 
                     data-bs-placement="top" 
                     title="Click para ver tareas vencidas">
                    <div class="card-body">
                        <i class="fas fa-exclamation-triangle fa-2x text-danger mb-3"></i>
                        <h4 class="text-white" id="overdueTasks">0</h4>
                        <p class="text-muted mb-0">Tareas Vencidas</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Sidebar Navigation - Panel de Control -->
            <div class="col-md-3">
                <div class="card sidebar sidebar-white sidebar-force-white" style="background: white !important; background-color: white !important; border: 1px solid #dee2e6 !important;">
                    <div class="card-header sidebar-header-white sidebar-header-force" style="background: #f8f9fa !important; background-color: #f8f9fa !important; color: #333 !important; border-bottom: 1px solid #dee2e6 !important;">
                        <h6 class="mb-0 sidebar-title-white sidebar-title-force" style="color: #333 !important; font-weight: 600 !important;">
                            <i class="fas fa-tachometer-alt me-2" style="color: #333 !important;"></i>Panel de Control
                        </h6>
                    </div>
                    <div class="card-body p-0">
                        <div class="list-group list-group-flush">
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action border-secondary active" 
                               onclick="showTab('evaluations'); return false;" data-tab="evaluations">
                                <i class="fas fa-clipboard-list me-3"></i>Evaluaciones
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action border-secondary" id="assessment-sidebar-item" style="display: none;"
                               onclick="showTab('assessment'); return false;" data-tab="assessment">
                                <i class="fas fa-play-circle me-3"></i>Evaluación Activa
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action border-secondary" 
                               onclick="showTab('tasks'); return false;" data-tab="tasks">
                                <i class="fas fa-tasks me-3"></i>Tareas
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action border-secondary" 
                               onclick="showTab('content'); return false;" data-tab="content">
                                <i class="fas fa-play-circle me-3"></i>Contenido
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action border-secondary" 
                               onclick="showTab('progress'); return false;" data-tab="progress">
                                <i class="fas fa-chart-area me-3"></i>Progreso
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action border-secondary" 
                               onclick="showTab('schedule-coach'); return false;" data-tab="schedule-coach">
                                <i class="fas fa-calendar-plus me-3"></i>Agendar Coach
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="col-md-9">
                <!-- Tab Content -->
                <div class="tab-content" id="mainTabContent">
                <!-- Evaluations Tab -->
                <div class="tab-pane fade show active" id="evaluations" role="tabpanel">
                    <div class="row">
                        <!-- Available Evaluations -->
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h3 class="mb-0">
                                        <i class="fas fa-plus-circle me-2"></i>
                                        Evaluaciones Disponibles
                                    </h3>
                                </div>
                                <div class="card-body" id="availableEvaluations">
                                    <div class="loading-spinner">
                                        <div class="spinner-border spinner-border-custom" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Completed Evaluations -->
                        <div class="col-lg-6">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-history me-2"></i>
                                        Evaluaciones Completadas
                                    </h3>
                                </div>
                                <div class="card-body" id="completedEvaluations">
                                    <div class="loading-spinner">
                                        <div class="spinner-border spinner-border-custom" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assessment Tab (Hidden by default) -->
                <div class="tab-pane fade" id="assessment" role="tabpanel">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>
                                <i class="fas fa-clipboard-check me-2"></i>
                                Evaluación de Asertividad
                            </h3>
                            <div class="progress mt-3">
                                <div class="progress-bar" role="progressbar" id="assessmentProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="card-body" id="assessmentContainer">
                            <div id="questionContainer">
                                <!-- Questions will be loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Assessment Results Modal -->
                    <div class="modal fade" id="assessmentResultsModal" tabindex="-1" aria-labelledby="assessmentResultsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <div class="modal-header modal-header-dark">
                                    <h5 class="modal-title" id="assessmentResultsModalLabel">
                                        <i class="fas fa-check-circle me-2"></i>
                                        ¡Evaluación Completada!
                                    </h5>
                                    <div class="d-flex align-items-center justify-content-end gap-2">
                                        <button type="button" class="btn btn-outline-light btn-sm" onclick="printEvaluationReport()" title="Imprimir Reporte">
                                            <i class="fas fa-print me-1"></i>
                                            Imprimir
                                        </button>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                </div>
                                <div class="modal-body" id="assessmentResultsContent">
                                    <div class="assessment-completion-section text-center mb-4">
                                        <div class="assessment-score-display" id="assessmentScore">0%</div>
                                        <h3 class="assessment-level-display" id="assessmentLevel">Nivel de Asertividad</h3>
                                    </div>
                                    <div id="assessmentInterpretation">
                                        <!-- Results interpretation will be loaded here -->
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" onclick="finishAssessment()">
                                        <i class="fas fa-check me-2"></i>
                                        Finalizar y Volver
                                    </button>
                                    <button type="button" class="btn btn-primary-custom" onclick="viewDetailedResults()">
                                        <i class="fas fa-chart-radar me-2"></i>
                                        Ver Análisis Completo
                                    </button>
                                    <button type="button" class="btn btn-progress" onclick="printEvaluationReport()">
                                        <i class="fas fa-print me-2"></i>
                                        Imprimir Reporte
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tasks Tab -->
                <div class="tab-pane fade" id="tasks" role="tabpanel">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>
                                <i class="fas fa-tasks me-2"></i>
                                Mis Tareas Asignadas
                            </h3>
                        </div>
                        <div class="card-body" id="tasksContainer">
                            <div class="loading-spinner">
                                <div class="spinner-border spinner-border-custom" role="status">
                                    <span class="visually-hidden">Cargando tareas...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Tab -->
                <div class="tab-pane fade" id="content" role="tabpanel">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>
                                <i class="fas fa-folder-open me-2"></i>
                                Mi Contenido
                            </h3>
                        </div>
                        <div class="card-body">
                            <!-- Pestañas para organizar el contenido -->
                            <ul class="nav nav-tabs mb-4" id="contentTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="videos-tab" data-bs-toggle="tab" 
                                        data-bs-target="#videos-pane" type="button" role="tab">
                                        <i class="fas fa-play-circle me-1"></i>Videos
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="documents-tab" data-bs-toggle="tab" 
                                        data-bs-target="#documents-pane" type="button" role="tab">
                                        <i class="fas fa-file-alt me-1"></i>Documentos
                                    </button>
                                </li>
                            </ul>

                            <!-- Contenido de las pestañas -->
                            <div class="tab-content" id="contentTabContent">
                                <!-- Pestaña: Videos -->
                                <div class="tab-pane fade show active" id="videos-pane" role="tabpanel">
                                    <div id="contentContainer">
                                        <div class="loading-spinner">
                                            <div class="spinner-border spinner-border-custom" role="status">
                                                <span class="visually-hidden">Cargando videos...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Pestaña: Documentos -->
                                <div class="tab-pane fade" id="documents-pane" role="tabpanel">
                                    <div id="documentsContainer">
                                        <div class="loading-spinner">
                                            <div class="spinner-border spinner-border-custom" role="status">
                                                <span class="visually-hidden">Cargando documentos...</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Filtros y búsqueda para documentos -->
                                    <div class="row mb-3" style="display: none;" id="documentFilters">
                                        <div class="col-md-4">
                                            <select class="form-select" id="categoryFilter">
                                                <option value="">Todas las categorías</option>
                                                <option value="ejercicios">Ejercicios y Actividades</option>
                                                <option value="teoria">Material Teórico</option>
                                                <option value="evaluacion">Evaluaciones Complementarias</option>
                                                <option value="recurso">Recursos de Apoyo</option>
                                                <option value="tarea">Tareas y Asignaciones</option>
                                                <option value="referencias">Referencias y Bibliografía</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <select class="form-select" id="priorityFilter">
                                                <option value="">Todas las prioridades</option>
                                                <option value="urgente">Urgente</option>
                                                <option value="alta">Alta</option>
                                                <option value="normal">Normal</option>
                                            </select>
                                        </div>
                                        <div class="col-md-4">
                                            <input type="text" class="form-control" id="searchDocuments" 
                                                   placeholder="Buscar documentos...">
                                        </div>
                                    </div>
                                    
                                    <!-- Grid de documentos -->
                                    <div id="documentsGrid" class="row">
                                        <!-- Los documentos se cargarán aquí dinámicamente -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progress Tab -->
                <div class="tab-pane fade" id="progress" role="tabpanel">
                    <div class="row">
                        <!-- Sección de historial eliminada -->
                    </div>

                    <!-- Statistics Row -->
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-calculator me-2"></i>
                                        Estadísticas
                                    </h3>
                                </div>
                                <div class="card-body" id="statisticsContainer">
                                    <div class="loading-spinner">
                                        <div class="spinner-border spinner-border-custom" role="status">
                                            <span class="visually-hidden">Cargando estadísticas...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Latest Evaluation Details -->
                    <div class="row">
                        <div class="col-12">
                            <div class="dashboard-card" id="latestEvaluationDetails">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-bullseye me-2"></i>
                                        Última Evaluación - Análisis Detallado
                                    </h3>
                                </div>
                                <div class="card-body" id="latestEvaluationContainer">
                                    <div class="loading-spinner">
                                        <div class="spinner-border spinner-border-custom" role="status">
                                            <span class="visually-hidden">Cargando análisis...</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Schedule Coach Tab -->
                <div class="tab-pane fade" id="schedule-coach" role="tabpanel">
                    <div class="row">
                        <div class="col-12">
                            <div class="dashboard-card">
                                <div class="card-header">
                                    <h3>
                                        <i class="fas fa-calendar-plus me-2"></i>
                                        Agendar Sesión con mi Coach
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <!-- Pestañas para organizar el contenido -->
                                    <ul class="nav nav-tabs mb-4" id="scheduleCoachTabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link active force-white-text" id="schedule-request-tab" data-bs-toggle="tab" 
                                                data-bs-target="#schedule-request-pane" type="button" role="tab" 
                                                aria-controls="schedule-request-pane" aria-selected="true"
                                                style="color: #ffffff !important; background-color: #007bff !important; border-color: #007bff !important;">
                                                <i class="fas fa-plus me-1"></i>Solicitar Sesión
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link position-relative force-white-text" id="my-sessions-tab" data-bs-toggle="tab" 
                                                data-bs-target="#my-sessions-pane" type="button" role="tab"
                                                aria-controls="my-sessions-pane" aria-selected="false">
                                                <i class="fas fa-calendar me-1"></i>Mis Sesiones
                                                <span class="badge bg-info rounded-pill ms-1" id="mySessionsCount" style="display: none;">0</span>
                                            </button>
                                        </li>
                                    </ul>

                                    <!-- Contenido de las pestañas -->
                                    <div class="tab-content" id="scheduleCoachTabContent">
                                        
                                        <!-- Pestaña: Solicitar Sesión -->
                                        <div class="tab-pane fade show active" id="schedule-request-pane" role="tabpanel" 
                                             aria-labelledby="schedule-request-tab" tabindex="0">
                                            <div class="row">
                                                <div class="col-lg-8">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h6 class="mb-0">
                                                                <i class="fas fa-calendar-plus me-2"></i>
                                                                Nueva Solicitud de Sesión
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <form id="sessionRequestForm">
                                                                <div class="row g-3">
                                                                    <div class="col-12">
                                                                        <label for="sessionDate" class="form-label">Fecha Preferida</label>
                                                                        <input type="date" class="form-control" id="sessionDate" required>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <label for="sessionStartTime" class="form-label">Hora de Inicio</label>
                                                                        <select class="form-select time-select-24h" id="sessionStartTime" required>
                                                                            <option value="">Seleccionar hora</option>
                                                                            <option value="08:00">08:00</option>
                                                                            <option value="08:30">08:30</option>
                                                                            <option value="09:00">09:00</option>
                                                                            <option value="09:30">09:30</option>
                                                                            <option value="10:00" selected>10:00</option>
                                                                            <option value="10:30">10:30</option>
                                                                            <option value="11:00">11:00</option>
                                                                            <option value="11:30">11:30</option>
                                                                            <option value="12:00">12:00</option>
                                                                            <option value="12:30">12:30</option>
                                                                            <option value="13:00">13:00</option>
                                                                            <option value="13:30">13:30</option>
                                                                            <option value="14:00">14:00</option>
                                                                            <option value="14:30">14:30</option>
                                                                            <option value="15:00">15:00</option>
                                                                            <option value="15:30">15:30</option>
                                                                            <option value="16:00">16:00</option>
                                                                            <option value="16:30">16:30</option>
                                                                            <option value="17:00">17:00</option>
                                                                            <option value="17:30">17:30</option>
                                                                            <option value="18:00">18:00</option>
                                                                            <option value="18:30">18:30</option>
                                                                            <option value="19:00">19:00</option>
                                                                            <option value="19:30">19:30</option>
                                                                            <option value="20:00">20:00</option>
                                                                        </select>
                                                                        <div class="form-text">Horario disponible: 08:00 - 20:00</div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <label for="sessionEndTime" class="form-label">Hora de Fin</label>
                                                                        <select class="form-select time-select-24h" id="sessionEndTime" required>
                                                                            <option value="">Seleccionar hora</option>
                                                                            <option value="08:30">08:30</option>
                                                                            <option value="09:00">09:00</option>
                                                                            <option value="09:30">09:30</option>
                                                                            <option value="10:00">10:00</option>
                                                                            <option value="10:30">10:30</option>
                                                                            <option value="11:00" selected>11:00</option>
                                                                            <option value="11:30">11:30</option>
                                                                            <option value="12:00">12:00</option>
                                                                            <option value="12:30">12:30</option>
                                                                            <option value="13:00">13:00</option>
                                                                            <option value="13:30">13:30</option>
                                                                            <option value="14:00">14:00</option>
                                                                            <option value="14:30">14:30</option>
                                                                            <option value="15:00">15:00</option>
                                                                            <option value="15:30">15:30</option>
                                                                            <option value="16:00">16:00</option>
                                                                            <option value="16:30">16:30</option>
                                                                            <option value="17:00">17:00</option>
                                                                            <option value="17:30">17:30</option>
                                                                            <option value="18:00">18:00</option>
                                                                            <option value="18:30">18:30</option>
                                                                            <option value="19:00">19:00</option>
                                                                            <option value="19:30">19:30</option>
                                                                            <option value="20:00">20:00</option>
                                                                            <option value="20:30">20:30</option>
                                                                        </select>
                                                                        <div class="form-text">Horario disponible: 08:30 - 20:30</div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <label for="sessionTitle" class="form-label">Título de la Sesión</label>
                                                                        <input type="text" class="form-control" id="sessionTitle" 
                                                                            placeholder="Ej: Sesión de desarrollo personal" value="Sesión de Coaching">
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <label for="sessionDescription" class="form-label">Descripción (opcional)</label>
                                                                        <textarea class="form-control" id="sessionDescription" rows="3" 
                                                                            placeholder="Describe brevemente el tema que te gustaría trabajar..."></textarea>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <label for="sessionLocation" class="form-label">Modalidad Preferida</label>
                                                                        <select class="form-select" id="sessionLocation">
                                                                            <option value="Virtual - Zoom">Virtual - Zoom</option>
                                                                            <option value="Virtual - Teams">Virtual - Teams</option>
                                                                            <option value="Virtual - Meet">Virtual - Google Meet</option>
                                                                            <option value="Presencial">Presencial</option>
                                                                            <option value="Por definir">Por definir</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <button type="submit" class="btn btn-primary">
                                                                            <i class="fas fa-paper-plane me-2"></i>Enviar Solicitud
                                                                        </button>
                                                                        <button type="button" class="btn btn-outline-secondary ms-2" onclick="resetSessionForm()">
                                                                            <i class="fas fa-undo me-2"></i>Limpiar
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="col-lg-4">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h6 class="mb-0">
                                                                <i class="fas fa-info-circle me-2"></i>
                                                                Disponibilidad del Coach
                                                            </h6>
                                                        </div>
                                                        <div class="card-body" id="coachAvailabilityInfo">
                                                            <div class="text-center py-3">
                                                                <div class="spinner-border spinner-border-sm" role="status">
                                                                    <span class="visually-hidden">Cargando disponibilidad...</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="card mt-3">
                                                        <div class="card-header">
                                                            <h6 class="mb-0">
                                                                <i class="fas fa-lightbulb me-2"></i>
                                                                Tips para Agendar
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <ul class="list-unstyled mb-0">
                                                                <li class="mb-2">
                                                                    <i class="fas fa-check text-success me-2"></i>
                                                                    Planifica con al menos 24 horas de anticipación
                                                                </li>
                                                                <li class="mb-2">
                                                                    <i class="fas fa-check text-success me-2"></i>
                                                                    Describe el tema que quieres trabajar
                                                                </li>
                                                                <li class="mb-2">
                                                                    <i class="fas fa-check text-success me-2"></i>
                                                                    Verifica tu disponibilidad antes de solicitar
                                                                </li>
                                                                <li class="mb-0">
                                                                    <i class="fas fa-check text-success me-2"></i>
                                                                    Tu coach responderá en máximo 24 horas
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Pestaña: Mis Sesiones -->
                                        <div class="tab-pane fade" id="my-sessions-pane" role="tabpanel" 
                                             aria-labelledby="my-sessions-tab" tabindex="0">
                                            <div class="row">
                                                <div class="col-12">
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <h6 class="mb-0">
                                                            <i class="fas fa-calendar me-2"></i>
                                                            Mis Sesiones Programadas
                                                        </h6>
                                                        <div>
                                                            <button class="btn btn-primary btn-sm me-2" onclick="switchToRequestTab()">
                                                                <i class="fas fa-plus me-1"></i>Solicitar Sesión
                                                            </button>
                                                            <button class="btn btn-outline-primary btn-sm" onclick="refreshMySessions()">
                                                                <i class="fas fa-sync-alt me-1"></i>Actualizar
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="mySessionsList">
                                                        <div class="text-center py-4">
                                                            <div class="spinner-border text-primary" role="status">
                                                                <span class="visually-hidden">Cargando sesiones...</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1060;">
        <div id="toastNotification" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">Notificación</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <!-- Toast message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Task Progress Modal -->
    <div class="modal fade" id="taskProgressModal" tabindex="-1" aria-labelledby="taskProgressModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskProgressModalLabel">
                        <i class="fas fa-tasks me-2"></i>
                        Actualizar Progreso de Tarea
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="taskProgressForm">
                        <input type="hidden" id="taskId" />
                        
                        <div class="mb-3">
                            <label for="taskStatus" class="form-label">Estado de la Tarea</label>
                            <select class="form-select" id="taskStatus" required>
                                <option value="pending">Pendiente</option>
                                <option value="in_progress">En Progreso</option>
                                <option value="completed">Completada</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="taskProgress" class="form-label">Progreso (%)</label>
                            <input type="range" class="form-range" id="taskProgress" min="0" max="100" value="0">
                            <div class="d-flex justify-content-between">
                                <span>0%</span>
                                <span id="progressValue">0%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="taskNotes" class="form-label">Notas (Opcional)</label>
                            <textarea class="form-control" id="taskNotes" rows="3" placeholder="Añade comentarios sobre tu progreso..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-task" onclick="saveTaskProgress()">
                        <i class="fas fa-save me-2"></i>
                        Guardar Progreso
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Evaluation Details Modal -->
    <div class="modal fade" id="evaluationDetailsModal" tabindex="-1" aria-labelledby="evaluationDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header modal-header-dark">
                    <h5 class="modal-title" id="evaluationDetailsModalLabel">
                        <i class="fas fa-chart-radar me-2"></i>
                        Detalles de Evaluación
                    </h5>
                    <div class="d-flex align-items-center justify-content-end gap-2">
                        <button type="button" class="btn btn-outline-light btn-sm" onclick="printEvaluationReport()" title="Imprimir Reporte">
                            <i class="fas fa-print me-1"></i>
                            Imprimir
                        </button>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
                <div class="modal-body" id="evaluationDetailsContent">
                    <div class="loading-spinner">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Cargando detalles...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-success" onclick="requestDevelopmentPlan()" id="requestPlanBtn">
                        <i class="fas fa-user-tie me-2"></i>
                        Solicitar Plan de Desarrollo
                    </button>
                    <button type="button" class="btn btn-progress" onclick="printEvaluationReport()">
                        <i class="fas fa-print me-2"></i>
                        Imprimir Reporte
                    </button>
                </div>
            </div>
        </div>
    </div>

</div> <!-- Close container-fluid -->

    <script>
        // API configuration
        const API_BASE_URL = window.location.origin;
        
        // DEBUG: Add debugging function
        function debugLog(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`🐛 [${timestamp}] ${message}`, data || '');
        }
        
        // Helper function to escape HTML entities
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Helper function to clean video titles from problematic prefixes
        function cleanVideoTitle(title) {
            if (!title) return title;
            
            // Si el título empieza con "(Video de", limpiar esa parte
            if (title.startsWith('(Video de')) {
                const closeParenIndex = title.indexOf(')');
                if (closeParenIndex !== -1) {
                    const cleanedTitle = title.substring(closeParenIndex + 1).trim();
                    return cleanedTitle || 'Video educativo';
                }
            }
            
            return title;
        }
        
        // Helper function to clean video descriptions from problematic prefixes
        function cleanVideoDescription(description) {
            if (!description) return description;
            
            // Si la descripción empieza con "Video de", limpiar esa parte
            if (description.startsWith('Video de ')) {
                return description.substring(9).trim() || 'Contenido educativo asignado por el coach';
            }
            
            return description;
        }
        
        // DEBUG: Override fetch to log all requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            debugLog(`🌐 FETCH REQUEST: ${args[0]}`, args[1]);
            return originalFetch.apply(this, args)
                .then(response => {
                    debugLog(`📥 FETCH RESPONSE: ${args[0]} - Status: ${response.status}`);
                    return response;
                })
                .catch(error => {
                    debugLog(`❌ FETCH ERROR: ${args[0]}`, error);
                    throw error;
                });
        };
        
        debugLog("🚀 Coachee Dashboard JavaScript loaded");
        
        // Application state
        let currentUser = null;
        let dashboardData = null;
        let evaluationsData = null;
        let tasksData = null;
        let contentData = null;
        // let progressChart = null; // ELIMINADO
        // let testProgressChart = null; // ELIMINADO

        // Assessment state
        let questions = [];
        let currentQuestionIndex = 0;
        let answers = {};
        let isAssessmentActive = false;
        let currentAssessmentId = null;
        
        // CACHE BUSTER: Verificar que JavaScript se cargó correctamente
        console.log('🔄 COACHEE DASHBOARD LOADED - TIMESTAMP: 2025-10-12-17:35:00');
        console.log('✅ Funciones de Preparación para crecer 2026 disponibles');

        // Logout function
        async function logout() {
            try {
                // Show loading state
                const logoutBtn = document.querySelector('.logout-btn');
                const originalContent = logoutBtn.innerHTML;
                logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Cerrando...';
                logoutBtn.disabled = true;

                // Call logout API específico para coachee
                const response = await fetch(`${API_BASE_URL}/api/coachee/logout`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                // Always redirect to participant access page regardless of API response
                window.location.href = '/participant-access';
                
            } catch (error) {
                console.error('Error during logout:', error);
                // Even if there's an error, redirect to participant access page
                window.location.href = '/participant-access';
            }
        }

        // Initialize particles animation
        function createParticles() {
            const particlesContainer = document.querySelector('.particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.width = particle.style.height = (Math.random() * 4 + 2) + 'px';
                particle.style.animationDuration = (Math.random() * 10 + 20) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // Función para navegar a evaluaciones completadas
        function navigateToCompletedEvaluations() {
            // Primero activar la pestaña de evaluaciones con el nuevo sistema
            showTab('evaluations');
            
            // Hacer scroll hacia la sección de evaluaciones completadas
            setTimeout(() => {
                const completedSection = document.getElementById('completedEvaluations');
                if (completedSection) {
                    completedSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                    // Destacar brevemente la sección
                    completedSection.style.border = '2px solid #28a745';
                    completedSection.style.borderRadius = '0.5rem';
                    setTimeout(() => {
                        completedSection.style.border = '';
                        completedSection.style.borderRadius = '';
                    }, 2000);
                }
            }, 100);
        }

        // Función para navegar a la sección de tareas
        function navigateToTasks() {
            // Primero activar la pestaña de tareas con el nuevo sistema
            showTab('tasks');
            
            // Hacer scroll hacia la sección de tareas
            setTimeout(() => {
                const tasksSection = document.getElementById('tasks');
                if (tasksSection) {
                    tasksSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                    // Destacar brevemente la sección
                    tasksSection.style.border = '2px solid #ffc107';
                    tasksSection.style.borderRadius = '0.5rem';
                    setTimeout(() => {
                        tasksSection.style.border = '';
                        tasksSection.style.borderRadius = '';
                    }, 2000);
                }
            }, 100);
        }

        // Función para navegar a las tareas vencidas
        function navigateToOverdueTasks() {
            // Primero activar la pestaña de tareas con el nuevo sistema
            showTab('tasks');
            
            // Hacer scroll hacia la sección de tareas
            setTimeout(() => {
                const tasksSection = document.getElementById('tasks');
                if (tasksSection) {
                    tasksSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                    // Destacar brevemente la sección con color rojo (danger)
                    tasksSection.style.border = '2px solid #dc3545';
                    tasksSection.style.borderRadius = '0.5rem';
                    setTimeout(() => {
                        tasksSection.style.border = '';
                        tasksSection.style.borderRadius = '';
                    }, 2000);
                    
                    // Destacar visualmente las tareas vencidas dentro del contenedor
                    setTimeout(() => {
                        const tasksContainer = document.getElementById('tasksContainer');
                        if (tasksContainer) {
                            // Buscar todas las tareas vencidas y destacarlas
                            const overdueTasks = tasksContainer.querySelectorAll('.task-item[data-status="overdue"], .task-item.overdue, .task-item .text-danger');
                            overdueTasks.forEach(task => {
                                task.style.background = 'rgba(220, 53, 69, 0.1)';
                                task.style.border = '2px solid rgba(220, 53, 69, 0.3)';
                                task.style.borderRadius = '0.5rem';
                                
                                // Quitar el destacado después de 3 segundos
                                setTimeout(() => {
                                    task.style.background = '';
                                    task.style.border = '';
                                    task.style.borderRadius = '';
                                }, 3000);
                            });
                        }
                    }, 500);
                }
            }, 100);
        }

        // Función para cambiar de tab con el sistema de sidebar
        function showTab(tabId) {
            // Ocultar todos los tab-panes
            const allTabPanes = document.querySelectorAll('.tab-pane');
            allTabPanes.forEach(pane => {
                pane.classList.remove('show', 'active');
            });
            
            // Mostrar el tab-pane seleccionado
            const targetPane = document.getElementById(tabId);
            if (targetPane) {
                targetPane.classList.add('show', 'active');
            }
            
            // Actualizar el estado activo en el sidebar
            const allSidebarItems = document.querySelectorAll('.list-group-item');
            allSidebarItems.forEach(item => {
                item.classList.remove('active');
            });
            
            // Activar el item del sidebar correspondiente
            const activeItem = document.querySelector(`[data-tab="${tabId}"]`);
            if (activeItem) {
                activeItem.classList.add('active');
            }
            
            // Cargar contenido específico según la pestaña
            if (tabId === 'content') {
                // Cuando se muestra Mi Contenido, activar la pestaña de documentos y cargar datos
                setTimeout(() => {
                    const documentsTab = document.getElementById('documents-tab');
                    if (documentsTab && !documentsTab.classList.contains('active')) {
                        documentsTab.click();
                    }
                    // Cargar documentos si no están cargados o si han pasado más de 5 minutos
                    if (!documentsData || documentsData.length === 0 || 
                        !window.lastDocumentLoad || (Date.now() - window.lastDocumentLoad > 300000)) {
                        loadDocuments();
                    }
                }, 100);
            }
            
            // Manejar el item especial de evaluación activa
            if (tabId === 'assessment') {
                const assessmentSidebarItem = document.getElementById('assessment-sidebar-item');
                if (assessmentSidebarItem) {
                    assessmentSidebarItem.style.display = 'block';
                }
            }
        }

        // Toast notification system
        function showToast(message, type = 'info') {
            const toastElement = document.getElementById('toastNotification');
            const toastBody = toastElement.querySelector('.toast-body');
            const toastHeader = toastElement.querySelector('.toast-header');
            
            // Update icon
            const icon = toastHeader.querySelector('i');
            switch (type) {
                case 'success':
                    icon.className = 'fas fa-check-circle text-success me-2';
                    break;
                case 'error':
                    icon.className = 'fas fa-exclamation-circle text-danger me-2';
                    break;
                case 'warning':
                    icon.className = 'fas fa-exclamation-triangle text-warning me-2';
                    break;
                default:
                    icon.className = 'fas fa-info-circle text-primary me-2';
            }
            
            toastBody.textContent = message;
            
            const toast = new bootstrap.Toast(toastElement, {
                autohide: true,
                delay: 5000
            });
            toast.show();
        }

        // Load user profile
        async function loadUserProfile() {
            try {
                console.log('🔍 Cargando perfil de usuario...');
                
                // Esperar a que el DOM esté completamente cargado
                if (document.readyState === 'loading') {
                    await new Promise(resolve => document.addEventListener('DOMContentLoaded', resolve));
                }
                
                // SOLUCIÓN: Obtener nombre real del usuario automáticamente
                console.log('🔧 MODO AUTOMÁTICO: Obteniendo nombre del usuario...');
                
                // PRIORIDAD 1: Usar endpoint específico de coachee (más confiable)
                console.log('🎯 PRIORIDAD 1: Intentando dashboard-summary (específico de coachee)...');
                try {
                    const summaryResponse = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                    console.log('🌐 Dashboard summary response status:', summaryResponse.status);
                    
                    if (summaryResponse.ok) {
                        const summaryData = await summaryResponse.json();
                        console.log('📊 Dashboard summary FULL data:', JSON.stringify(summaryData, null, 2));
                        
                        if (summaryData.success && summaryData.summary?.coachee?.name) {
                            const userName = summaryData.summary.coachee.name;
                            console.log('👤 Nombre del COACHEE (dashboard-summary):', userName);
                            console.log('📧 Email del COACHEE (dashboard-summary):', summaryData.summary.coachee.email);
                            console.log('🖼️ Avatar del COACHEE (dashboard-summary):', summaryData.summary.coachee.avatar_url);
                            
                            // Mostrar también info del coach para comparar
                            if (summaryData.summary?.coach) {
                                console.log('👔 Nombre del COACH:', summaryData.summary.coach.name);
                                console.log('📧 Email del COACH:', summaryData.summary.coach.email);
                            }
                            
                            // Crear objeto currentUser con los datos del coachee
                            currentUser = {
                                full_name: userName,
                                email: summaryData.summary.coachee.email,
                                avatar_url: summaryData.summary.coachee.avatar_url
                            };
                            
                            const welcomeText = userName;
                            updateAllWelcomeMessages(welcomeText);
                            updateHeaderAvatar();
                            console.log('✅ Actualizado con nombre y avatar del dashboard summary:', welcomeText);
                            return;
                        } else {
                            console.log('❌ Dashboard summary no tiene nombre de usuario');
                        }
                    } else {
                        console.log('❌ Dashboard summary response not ok:', summaryResponse.status);
                    }
                } catch (summaryError) {
                    console.log('⚠️ Dashboard summary error:', summaryError.message);
                }
                
                // PRIORIDAD 2: Fallback a /api/coachee/profile (específico para coachees con avatar)
                console.log('🔄 PRIORIDAD 2: Fallback a coachee/profile (con avatar)...');
                try {
                    const response = await fetch(`${API_BASE_URL}/api/coachee/profile`);
                    console.log('🌐 coachee/profile response status:', response.status);
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('📥 API /api/coachee/profile response:', JSON.stringify(data, null, 2));
                        
                        if (data.success && data.profile?.full_name) {
                            const realName = data.profile.full_name;
                            console.log('👤 Nombre obtenido (coachee/profile):', realName);
                            console.log('📧 Email (coachee/profile):', data.profile.email);
                            console.log('🎭 Role (coachee/profile):', data.profile.role);
                            console.log('🖼️ Avatar (coachee/profile):', data.profile.avatar_url);
                            
                            const realWelcomeText = realName;
                            updateAllWelcomeMessages(realWelcomeText);
                            console.log('✅ Actualizado con coachee/profile:', realWelcomeText);
                            currentUser = data.profile;
                            updateHeaderAvatar();
                            return;
                        }
                    }
                } catch (apiError) {
                    console.log('⚠️ coachee/profile API error:', apiError.message);
                }
                
                // Último fallback: mantener mensaje genérico
                console.log('🔄 Manteniendo mensaje genérico - todos los endpoints fallaron');
                
            } catch (error) {
                console.error('❌ Error cargando perfil:', error);
                
                // Fallback: mantener mensaje genérico si hay error total
                console.log('🔄 Error total - manteniendo mensaje genérico de bienvenida');
            }
        }

        // Load dashboard summary
        async function loadDashboardSummary() {
            try {
                console.log('Fetching dashboard summary from:', `${API_BASE_URL}/api/coachee/dashboard-summary`);
                const response = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                
                console.log('Response status:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Raw API response data:', data);
                
                if (data && data.summary) {
                    dashboardData = data.summary;
                    console.log('Dashboard data set to:', dashboardData);
                    updateSummaryCards();
                    updateUserInfo();
                } else {
                    console.error('Formato de datos inesperado:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                console.error('Error cargando resumen:', error);
                showToast('Error cargando resumen del dashboard: ' + error.message, 'error');
                
                // Inicializar con datos vacíos para evitar errores
                dashboardData = {
                    evaluation_summary: { total_completed: 0 },
                    latest_evaluation: null,
                    tasks_summary: { pending: 0, overdue: 0 },
                    coachee: {}
                };
                updateSummaryCards();
                updateUserInfo();
            }
        }

        // Update summary cards
        function updateSummaryCards() {
            if (!dashboardData) return;
            
            // Actualizar elementos del DOM de manera segura
            const totalEvaluationsElement = document.getElementById('totalEvaluations');
            const latestScoreElement = document.getElementById('latestScore');
            const pendingTasksElement = document.getElementById('pendingTasks');
            const overdueTasksElement = document.getElementById('overdueTasks');
            
            if (totalEvaluationsElement) {
                totalEvaluationsElement.textContent = 
                    (dashboardData.evaluation_summary && dashboardData.evaluation_summary.total_completed) || '0';
            }
            
            if (latestScoreElement) {
                latestScoreElement.textContent = 
                    (dashboardData.latest_evaluation && dashboardData.latest_evaluation.total_score) ? 
                    `${Math.round(dashboardData.latest_evaluation.total_score)}%` : '-';
            }
            
            if (pendingTasksElement) {
                pendingTasksElement.textContent = 
                    (dashboardData.tasks_summary && dashboardData.tasks_summary.pending) || '0';
            }
            
            if (overdueTasksElement) {
                overdueTasksElement.textContent = 
                    (dashboardData.tasks_summary && dashboardData.tasks_summary.overdue) || '0';
            }
        }

        // Update user info
        function updateUserInfo() {
            if (!dashboardData) return;
            
            const userInfoElement = document.getElementById('userInfo');
            if (!userInfoElement) return;
            
            const coacheeData = dashboardData.coachee;
            
            if (coacheeData && coacheeData.joined_at) {
                const joinedDate = new Date(coacheeData.joined_at).toLocaleDateString('es-ES');
                userInfoElement.textContent = `Miembro desde: ${joinedDate}`;
            } else if (coacheeData && coacheeData.email) {
                userInfoElement.textContent = coacheeData.email;
            } else {
                userInfoElement.textContent = 'Información no disponible';
            }
        }

        // Load evaluations data
        async function loadEvaluations() {
            try {
                debugLog('🔍 Iniciando carga de evaluaciones...');
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluations`);
                
                debugLog(`📡 Response status: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                debugLog('📦 Datos de evaluaciones recibidos:', data);
                
                if (data && typeof data === 'object') {
                    evaluationsData = data; // Ahora contiene {available: {}, completed: []}
                    debugLog('✅ Renderizando evaluaciones disponibles...');
                    renderAvailableEvaluations();
                    debugLog('✅ Renderizando evaluaciones completadas...');
                    renderCompletedEvaluations();
                } else {
                    console.error('Formato de datos inesperado:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                debugLog('❌ Error cargando evaluaciones', error);
                console.error('Error cargando evaluaciones:', error);
                showToast('Error cargando evaluaciones: ' + error.message, 'error');
                
                // Inicializar con datos vacíos
                evaluationsData = { available: {}, completed: [] };
                
                // Show error in both containers
                document.getElementById('availableEvaluations').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando evaluaciones disponibles</p></div>';
                document.getElementById('completedEvaluations').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando historial de evaluaciones</p></div>';
            }
        }

        // Helper function to get assertativeness level
        function getAssertativenessLevel(score) {
            if (score >= 80) return 'Muy Asertivo';
            if (score >= 65) return 'Asertivo';
            if (score >= 50) return 'Moderadamente Asertivo';
            if (score >= 35) return 'Poco Asertivo';
            return 'Muy Poco Asertivo';
        }

        // Render available evaluations
        function renderAvailableEvaluations() {
            const container = document.getElementById('availableEvaluations');
            
            // Verificar si hay un mensaje específico (sin coach o sin invitación)
            if (evaluationsData && evaluationsData.message) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div class="empty-state-title">Información</div>
                        <div class="empty-state-description">${evaluationsData.message}</div>
                    </div>
                `;
                return;
            }
            
            if (!evaluationsData || !evaluationsData.available || Object.keys(evaluationsData.available).length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <div class="empty-state-title">Sin evaluaciones disponibles</div>
                        <div class="empty-state-description">No hay evaluaciones disponibles en este momento</div>
                    </div>
                `;
                return;
            }
            
            let html = '<ul class="results-list">';
            Object.values(evaluationsData.available).forEach(evaluation => {
                html += `
                    <li class="results-list-item fade-in">
                        <div class="evaluation-status evaluation-status-not-started">
                            <i class="fas fa-play-circle unified-icon-lg"></i>
                        </div>
                        <div class="results-list-item-content">
                            <div class="results-list-item-title">${evaluation.title}</div>
                            <div class="results-list-item-subtitle">${evaluation.description}</div>
                            <div class="d-flex align-items-center gap-3 mt-2">
                                <small class="text-muted">
                                    <i class="fas fa-question-circle unified-icon-sm me-1"></i>
                                    ${evaluation.total_questions} preguntas
                                </small>
                                <small class="text-muted">
                                    <i class="fas fa-user-tie unified-icon-sm me-1"></i>
                                    Coach: ${evaluation.coach_name || 'No asignado'}
                                </small>
                            </div>
                        </div>
                        <div class="results-list-item-meta">
                            <button class="unified-btn unified-btn-primary" onclick="startEvaluation('${evaluation.id}')">
                                <i class="fas fa-play unified-icon-sm"></i>
                                Comenzar
                            </button>
                        </div>
                    </li>
                `;
            });
            html += '</ul>';
            
            container.innerHTML = html;
        }

        // Render completed evaluations
        function renderCompletedEvaluations() {
            const container = document.getElementById('completedEvaluations');
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                container.innerHTML = '<div class="unified-empty-state"><i class="fas fa-clipboard-list"></i><p>Aún no has completado ninguna evaluación</p></div>';
                return;
            }
            
            let html = '<div class="results-list">';
            evaluationsData.completed.forEach(evaluation => {
                const score = evaluation.score || 0;
                
                // Usar el título real del assessment o un título por defecto
                const assessmentTitle = evaluation.assessment_title || 'Evaluación completada';
                
                // Función para obtener el nivel basado en el tipo de evaluación
                function getEvaluationLevel(score, title) {
                    if (title && title.includes('DISC')) {
                        // Para evaluaciones DISC, mostrar información de personalidad
                        if (score >= 80) return 'Perfil Dominante';
                        if (score >= 60) return 'Perfil Influyente';
                        if (score >= 40) return 'Perfil Estable';
                        return 'Perfil Concienzudo';
                    } else if (title && title.includes('Preparación para crecer 2026')) {
                        // Para evaluaciones de Preparación para crecer 2026
                        if (score >= 85) return 'Preparado';      // Verde
                        if (score >= 60) return 'En progreso';    // Amarillo
                        return 'Alta dependencia';                // Rojo
                    } else {
                        // Para evaluaciones de Asertividad, usar la función existente
                        return getAssertativenessLevel(score);
                    }
                }
                
                html += `
                    <div class="unified-card">
                        <div class="unified-card-header">
                            <h5 class="unified-card-title">${assessmentTitle}</h5>
                            <div class="score-display">
                                <span class="score-value">${Math.round(score)}%</span>
                            </div>
                        </div>
                        <div class="unified-card-body">
                            <div class="evaluation-level">${getEvaluationLevel(score, assessmentTitle)}</div>
                            <div class="evaluation-description">${evaluation.result_text || 'Evaluación completada con éxito'}</div>
                            <div class="evaluation-meta">
                                <span class="meta-date">
                                    <i class="fas fa-calendar-alt"></i>
                                    ${formatDate(evaluation.completed_at)}
                                </span>
                            </div>
                        </div>
                        <div class="unified-card-footer">
                            <button class="unified-btn unified-btn-primary" onclick="viewEvaluationDetails(${evaluation.id})">
                                <i class="fas fa-eye"></i>
                                Ver Detalles
                            </button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        // Load tasks data
        async function loadTasks() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/tasks`, {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (Array.isArray(data)) {
                    tasksData = data; // La API devuelve directamente el array
                    renderTasks();
                } else {
                    console.error('Formato de datos inesperado para tareas:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                console.error('Error cargando tareas:', error);
                showToast('Error cargando tareas: ' + error.message, 'error');
                
                // Inicializar con datos vacíos
                tasksData = [];
                
                document.getElementById('tasksContainer').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando tareas</p></div>';
            }
        }

        // Render tasks
        function renderTasks() {
            const container = document.getElementById('tasksContainer');
            
            if (!tasksData || tasksData.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-tasks"></i><p>No tienes tareas asignadas</p></div>';
                return;
            }
            
            let html = '';
            tasksData.forEach(task => {
                const priorityClass = `priority-${task.priority}`;
                const statusClass = `status-${task.status}`;
                const progressClass = task.progress_percentage >= 75 ? 'high' : 
                                     task.progress_percentage >= 25 ? 'medium' : 'low';
                
                html += `
                    <div class="task-item">
                        <div class="task-header">
                            <div class="flex-grow-1">
                                <h5 class="task-title">${task.title}</h5>
                                <p class="task-description">${task.description}</p>
                            </div>
                        </div>
                        
                        <div class="task-meta">
                            <span class="task-badge ${priorityClass}">
                                <i class="fas fa-flag me-1"></i>
                                ${task.priority}
                            </span>
                            <span class="task-badge ${statusClass}">
                                <i class="fas fa-circle me-1"></i>
                                ${getStatusLabel(task.status)}
                            </span>
                            ${task.category ? `<span class="task-badge"><i class="fas fa-tag me-1"></i>${task.category}</span>` : ''}
                            ${task.due_date ? `<span class="task-badge"><i class="fas fa-calendar me-1"></i>${formatDate(task.due_date)}</span>` : ''}
                        </div>
                        
                        <div class="progress-container">
                            <div class="d-flex justify-content-between mb-1">
                                <small>Progreso</small>
                                <small>${Math.round(task.progress_percentage)}%</small>
                            </div>
                            <div class="progress-bar-custom">
                                <div class="progress-fill ${progressClass}" style="width: ${task.progress_percentage}%"></div>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-between align-items-center mt-3">
                            <small class="text-muted">
                                Coach: ${task.coach.name}
                                ${task.last_update ? `• Actualizado: ${formatDate(task.last_update)}` : ''}
                            </small>
                            <button class="btn btn-sm btn-task" onclick="openTaskProgressModal(${task.id})">
                                <i class="fas fa-edit me-1"></i>
                                Actualizar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Load evaluation history for progress chart
        async function loadEvaluationHistory() {
            console.log('🔍 LOAD-EVALUATION-HISTORY: Function called');
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-history`);
                const data = await response.json();
                
                console.log('🔍 DEBUG: loadEvaluationHistory response:', data);
                
                if (response.ok) {
                    console.log('🔍 DEBUG: progress_data:', data.progress_data);
                    console.log('🔍 DEBUG: history length:', data.history?.length);
                    
                    // renderProgressChart(data.progress_data, data.history); // ELIMINADO
                    // renderTestProgressChart(); // TEST: ELIMINADO
                    
                    console.log('🔥 CALLING createSecondChart()...');
                    createSecondChart(); // NUEVO: Crear segundo gráfico visible
                    console.log('🔥 createSecondChart() called!');
                    
                    renderStatistics(data.statistics);
                    renderLatestEvaluationDetails(data.history);
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error cargando historial:', error);
                showToast('Error cargando historial de evaluaciones', 'error');
                
                document.getElementById('statisticsContainer').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando estadísticas</p></div>';
            }
        }

        // FUNCIÓN renderProgressChart ELIMINADA POR PETICIÓN DEL USUARIO
        

        // FUNCIÓN createBasicTestChart ELIMINADA POR PETICIÓN DEL USUARIO

        // TEST CHART FUNCTION - Para probar visualización
        // FUNCIÓN renderTestProgressChart ELIMINADA POR PETICIÓN DEL USUARIO

        // NUEVO: Crear segundo gráfico visible
        function createSecondChart() {
            console.log('🔥 CREATING SECOND CHART: Starting...');
            
            try {
                // Verificar que exista el canvas
                const canvas = document.getElementById('secondProgressChart');
                console.log('🔥 Canvas found:', !!canvas);
                
                if (!canvas) {
                    console.error('❌ Canvas secondProgressChart no encontrado');
                    return;
                }
                
                // Verificar Chart.js
                if (typeof Chart === 'undefined') {
                    console.error('❌ Chart.js no está disponible');
                    return;
                }
                
                console.log('✅ Chart.js disponible, versión:', Chart.version);
                
                const ctx = canvas.getContext('2d');
                
                // Datos simples de ejemplo
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo'],
                        datasets: [{
                            label: 'Progreso Ejemplo',
                            data: [20, 35, 50, 65, 80],
                            borderColor: '#ff6b6b',
                            backgroundColor: '#ff6b6b33',
                            borderWidth: 3,
                            pointRadius: 8
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
                
                console.log('✅ SECOND CHART: Creado exitosamente!');
                
                // Actualizar estado
                const statusDiv = document.getElementById('secondChartStatus');
                if (statusDiv) {
                    statusDiv.textContent = '✅ Segundo gráfico creado exitosamente!';
                    statusDiv.style.color = 'green';
                }
                
            } catch (error) {
                console.error('❌ SECOND CHART ERROR:', error);
                const statusDiv = document.getElementById('secondChartStatus');
                if (statusDiv) {
                    statusDiv.textContent = `❌ Error: ${error.message}`;
                    statusDiv.style.color = 'red';
                }
            }
        }

        // Load content assigned to coachee
        // Variables globales para debugging
        let renderContentCallCount = 0;
        let isLoadingContent = false;
        async function loadContent() {
            // Evitar llamadas concurrentes
            if (isLoadingContent) {
                debugLog('⏳ LoadContent ya en progreso, omitiendo llamada duplicada');
                return;
            }
            
            isLoadingContent = true;
            debugLog('🎥 LOAD-CONTENT: Iniciando carga de contenido...');
            
            try {
                debugLog('🎥 Cargando contenido asignado...');
                
                const response = await fetch('/api/coachee/content', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                debugLog('✅ Contenido cargado:', data);
                
                if (data.success) {
                    contentData = data.content || [];
                    
                    // FILTRAR DUPLICADOS POR ID
                    const uniqueContent = [];
                    const seenIds = new Set();
                    
                    contentData.forEach(item => {
                        if (!seenIds.has(item.id)) {
                            seenIds.add(item.id);
                            uniqueContent.push(item);
                        } else {
                            debugLog('⚠️ DUPLICADO DETECTADO Y REMOVIDO:', item);
                        }
                    });
                    
                    contentData = uniqueContent;
                    
                    debugLog('🎥 LOAD-CONTENT: Datos procesados', {
                        originalCount: (data.content || []).length,
                        uniqueCount: contentData.length,
                        titles: contentData.map(c => c.title),
                        ids: contentData.map(c => c.id)
                    });
                    renderContent();
                } else {
                    throw new Error(data.error || 'Error desconocido cargando contenido');
                }
                
            } catch (error) {
                console.error('Error cargando contenido:', error);
                showToast('Error cargando contenido: ' + error.message, 'error');
                
                // Inicializar con datos vacíos
                contentData = [];
                
                document.getElementById('contentContainer').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando contenido</p></div>';
            } finally {
                isLoadingContent = false;
            }
        }

        // Render content
        function renderContent() {
            renderContentCallCount++;
            const container = document.getElementById('contentContainer');
            
            debugLog(`🎥 RENDER-CONTENT: Iniciando renderizado #${renderContentCallCount}`, {
                contentData: contentData,
                itemCount: contentData?.length || 0,
                containerExists: !!container,
                containerCurrentHTML: container?.innerHTML?.substring(0, 100) + '...'
            });
            
            if (!contentData || contentData.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-video"></i><p>No tienes contenido asignado</p></div>';
                return;
            }

            // LIMPIAR COMPLETAMENTE EL CONTENEDOR ANTES DE RENDERIZAR
            container.innerHTML = '';
            debugLog('🧹 RENDER-CONTENT: Contenedor limpiado');

            let html = '<div class="row">';
            
            debugLog('🎥 RENDER-CONTENT: Procesando items', {
                count: contentData.length,
                items: contentData.map(c => ({id: c.id, title: c.title, description: c.description}))
            });
            
            contentData.forEach((content, index) => {
                debugLog(`🎥 RENDER-ITEM ${index}:`, {
                    id: content.id,
                    title: content.title,
                    description: content.description,
                    cleanTitle: cleanVideoTitle(content.title),
                    cleanDescription: cleanVideoDescription(content.description)
                });
                const formattedDate = content.assigned_at ? 
                    new Date(content.assigned_at).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    }) : 'Sin fecha';
                
                const duration = content.duration ? 
                    Math.ceil(content.duration / 60) + ' min' : '';
                
                const viewedBadge = content.is_viewed ? 
                    '<span class="badge bg-success ms-2"><i class="fas fa-check"></i> Visto</span>' : 
                    '<span class="badge bg-secondary ms-2"><i class="fas fa-eye"></i> Pendiente</span>';
                
                // Extraer video ID para embebido si es YouTube
                let embedContent = '';
                let hasEmbeddedPlayer = false;
                const isVideo = content.content_type === 'video';
                
                if (isVideo && (content.content_url.includes('youtube.com') || content.content_url.includes('youtu.be'))) {
                    let videoId = '';
                    if (content.content_url.includes('youtube.com/watch?v=')) {
                        videoId = content.content_url.split('v=')[1].split('&')[0];
                    } else if (content.content_url.includes('youtu.be/')) {
                        videoId = content.content_url.split('youtu.be/')[1].split('?')[0];
                    }
                    
                    if (videoId) {
                        hasEmbeddedPlayer = true;
                        console.log(`🎬 RENDER: Creating embedded iframe for content ${content.id} with videoId=${videoId}`);
                        embedContent = `
                            <div class="ratio ratio-16x9">
                                <iframe id="youtube-${content.id}" 
                                    src="https://www.youtube.com/embed/${videoId}?enablejsapi=1" 
                                    title="${escapeHtml(cleanVideoTitle(content.title))}" 
                                    frameborder="0" 
                                    allowfullscreen
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    style="border-radius: 8px;"
                                    onload="setupVideoTracking(${content.id})">
                                </iframe>
                            </div>
                        `;
                        console.log(`✅ RENDER: Embedded iframe created for content ${content.id}`);
                    }
                }
                
                // Si no es un video de YouTube, usar imagen thumbnail o placeholder
                if (!embedContent) {
                    const thumbnailUrl = content.thumbnail_url || 'https://via.placeholder.com/320x180/e9ecef/6c757d?text=Contenido';
                    embedContent = `
                        <div class="ratio ratio-16x9">
                            <div style="background-image: url('${thumbnailUrl}'); background-size: cover; background-position: center; border-radius: 8px; display: flex; align-items: center; justify-content: center;">
                                <div style="background: rgba(0,0,0,0.7); color: white; padding: 10px 15px; border-radius: 6px;">
                                    <i class="fas fa-${isVideo ? 'play' : 'file-alt'} me-2"></i>
                                    ${isVideo ? 'Ver Contenido' : 'Abrir Documento'}
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                html += `
                    <div class="col-lg-6 col-xl-4 mb-3">
                        <div class="content-card ${content.is_viewed ? 'viewed' : ''}">
                            <!-- Vista previa del contenido (estilo coach dashboard) -->
                            <div class="content-preview mb-3 ${hasEmbeddedPlayer ? 'has-embedded-video' : ''}">
                                ${embedContent}
                            </div>
                            
                            <div class="content-header" style="padding: 0;">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="content-info flex-grow-1">
                                        <h6 class="content-title mb-1" style="font-weight: 600; line-height: 1.3;">${escapeHtml(cleanVideoTitle(content.title))}</h6>
                                        <small class="text-muted">Por ${escapeHtml(content.coach_name)}</small>
                                        ${duration ? `<div class="mt-1"><span class="badge bg-light text-dark"><i class="fas fa-clock me-1"></i>${duration}</span></div>` : ''}
                                    </div>
                                    ${viewedBadge}
                                </div>
                            </div>
                            
                            ${content.description ? `
                                <div class="content-description" style="padding: 0; margin-top: 8px;">
                                    <p class="text-muted small mb-2" style="line-height: 1.4;">${escapeHtml(cleanVideoDescription(content.description))}</p>
                                </div>
                            ` : ''}
                            
                            <div class="content-meta" style="padding: 0; margin-top: 8px;">
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>
                                    Asignado: ${formattedDate}
                                </small>
                            </div>
                            
                            <div class="content-actions" style="padding: 0; margin-top: 12px; border-top: 1px solid #e9ecef; padding-top: 12px;">
                                ${hasEmbeddedPlayer ? `
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-success">
                                            <i class="fas fa-play-circle me-1"></i>
                                            Video listo para reproducir
                                        </small>
                                        <small class="text-muted">
                                            <i class="fas fa-eye me-1"></i>
                                            ${content.view_count || 0} vistas
                                        </small>
                                    </div>
                                ` : `
                                    <button class="btn btn-primary btn-sm" onclick="openContent(${content.id}, '${content.content_url}', '${content.title}')">
                                        <i class="fas fa-play me-1"></i>
                                        ${content.content_type === 'video' ? 'Ver Video' : 'Abrir Contenido'}
                                    </button>
                                    ${!content.is_viewed ? `
                                        <button class="btn btn-outline-success btn-sm ms-2" onclick="markContentAsViewed(${content.id})">
                                            <i class="fas fa-check me-1"></i>
                                            Marcar como Visto
                                        </button>
                                    ` : ''}
                                `}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            debugLog('🎥 RENDER-CONTENT: HTML generado', {
                htmlLength: html.length,
                finalHTML: html.substring(0, 200) + '...',
                aboutToSetInnerHTML: true
            });
            
            // Verificar estado antes de setear innerHTML
            debugLog('🔍 PRE-SET: Container state', {
                currentHTML: container.innerHTML.substring(0, 100) + '...',
                currentHTMLLength: container.innerHTML.length
            });
            
            container.innerHTML = html;
            
            // Verificar estado después de setear innerHTML  
            debugLog('✅ POST-SET: Container updated', {
                newHTML: container.innerHTML.substring(0, 100) + '...',
                newHTMLLength: container.innerHTML.length,
                childCount: container.children.length
            });
        }

        // Open content (video or document)
        function openContent(contentId, contentUrl, title) {
            console.log(`🎬 OPEN-CONTENT: Called for contentId=${contentId}, contentUrl=${contentUrl}`);
            
            // Verificar si este contenido tiene un video embebido activo
            const embeddedVideoIframe = document.getElementById(`youtube-${contentId}`);
            console.log(`🔍 OPEN-CONTENT: Looking for iframe with ID youtube-${contentId}`, {
                found: !!embeddedVideoIframe,
                iframe: embeddedVideoIframe
            });
            
            if (embeddedVideoIframe) {
                console.log(`🚫 OPEN-CONTENT: Ignorando openContent para video embebido ${contentId} - iframe existe`);
                return; // No hacer nada si hay un iframe embebido
            }
            
            // Verificar también si el contenedor padre tiene la clase has-embedded-video
            const embeddedContainer = document.querySelector(`#youtube-${contentId}`);
            if (embeddedContainer || document.querySelector(`.content-preview.has-embedded-video iframe[id="youtube-${contentId}"]`)) {
                console.log(`🚫 OPEN-CONTENT: Ignorando openContent para video embebido ${contentId} - contenedor embebido detectado`);
                return;
            }
            
            console.log(`✅ OPEN-CONTENT: Procediendo con apertura normal para ${contentId}`);
            
            // Si es un video de YouTube, usar modal con iframe
            if (contentUrl.includes('youtube.com') || contentUrl.includes('youtu.be')) {
                console.log(`🎥 OPEN-CONTENT: Abriendo modal para video ${contentId}`);
                openVideoModal(contentUrl, title);
            } else {
                console.log(`📄 OPEN-CONTENT: Abriendo en nueva pestaña para ${contentId}`);
                // Para otros tipos de contenido, abrir en nueva pestaña
                window.open(contentUrl, '_blank');
            }
            
            // Marcar como visto automáticamente al abrir
            markContentAsViewed(contentId);
        }

        // Open video in modal
        function openVideoModal(videoUrl, title) {
            // Convertir URL de YouTube a embed
            let embedUrl = videoUrl;
            if (videoUrl.includes('youtube.com/watch?v=')) {
                const videoId = videoUrl.split('v=')[1].split('&')[0];
                embedUrl = `https://www.youtube.com/embed/${videoId}`;
            } else if (videoUrl.includes('youtu.be/')) {
                const videoId = videoUrl.split('youtu.be/')[1].split('?')[0];
                embedUrl = `https://www.youtube.com/embed/${videoId}`;
            }
            
            const modalHtml = `
                <div class="modal fade" id="videoModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${escapeHtml(cleanVideoTitle(title))}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal">
                                    <span style="color: white; font-size: 1.2rem; font-weight: bold;">×</span>
                                </button>
                            </div>
                            <div class="modal-body p-0">
                                <div class="ratio ratio-16x9">
                                    <iframe src="${embedUrl}" allowfullscreen></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Eliminar modal anterior si existe
            const existingModal = document.getElementById('videoModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('videoModal'));
            modal.show();
            
            // Limpiar cuando se cierre
            document.getElementById('videoModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // Mark content as viewed
        async function markContentAsViewed(contentId) {
            try {
                const response = await fetch(`/api/coachee/content/${contentId}/mark-viewed`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Actualizar solo el contenido específico en lugar de recargar todo
                    const contentItem = contentData.find(c => c.id === contentId);
                    if (contentItem) {
                        contentItem.is_viewed = true;
                        contentItem.viewed_at = new Date().toISOString();
                        renderContent(); // Re-renderizar con datos actualizados
                    }
                } else {
                    throw new Error(data.error || 'Error marcando contenido como visto');
                }
                
            } catch (error) {
                console.error('Error marcando contenido como visto:', error);
                showToast('Error marcando contenido como visto: ' + error.message, 'error');
            }
        }

        // Setup video tracking for embedded YouTube videos
        function setupVideoTracking(contentId) {
            console.log(`🎯 SETUP-VIDEO-TRACKING: Called for contentId=${contentId}`);
            
            const iframe = document.getElementById(`youtube-${contentId}`);
            if (!iframe) {
                console.log(`❌ SETUP-VIDEO-TRACKING: No iframe found for youtube-${contentId}`);
                return;
            }
            
            console.log(`✅ SETUP-VIDEO-TRACKING: Iframe found for youtube-${contentId}`, iframe);
            
            // Mark as viewed when iframe loads (auto-mark since video is now immediately accessible)
            setTimeout(() => {
                const contentItem = contentData.find(c => c.id === contentId);
                if (contentItem && !contentItem.is_viewed) {
                    console.log(`📺 SETUP-VIDEO-TRACKING: Auto-marking video ${contentId} as viewed (embedded and accessible)`);
                    markContentAsViewed(contentId);
                } else {
                    console.log(`ℹ️ SETUP-VIDEO-TRACKING: Video ${contentId} already viewed or not found in contentData`);
                }
            }, 1000);
        }

        // Render statistics
        function renderStatistics(statistics) {
            const container = document.getElementById('statisticsContainer');
            
            if (!statistics) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-calculator"></i><p>No hay estadísticas disponibles</p></div>';
                return;
            }
            
            let statisticsHtml = `
                <div class="mb-4">
                    <h6 class="mb-2">Total de Evaluaciones</h6>
                    <div class="h4 text-primary">${statistics.total_evaluations || 0}</div>
                </div>
                
                <div class="mb-4">
                    <h6 class="mb-2">Puntuación Promedio General</h6>
                    <div class="h4 text-success">${statistics.average_score ? Math.round(statistics.average_score) : '-'}${statistics.average_score ? '%' : ''}</div>
                </div>
            `;
            
            // Mostrar estadísticas por tipo de evaluación si están disponibles
            if (statistics.by_assessment_type && Object.keys(statistics.by_assessment_type).length > 0) {
                statisticsHtml += `
                    <div class="mb-4">
                        <h6 class="mb-3"><i class="fas fa-chart-bar me-2"></i>Por Tipo de Evaluación</h6>
                        <div class="row">
                `;
                
                // Definir colores para cada tipo de evaluación (iguales a los del gráfico)
                const typeColors = {
                    'Asertividad': '#6282E3',
                    'DISC': '#A0D8CC',
                    'Inteligencia Emocional': '#F4A460',
                    'Liderazgo': '#FFB6C1',
                    'Trabajo en equipo': '#DDA0DD'
                };
                
                Object.entries(statistics.by_assessment_type).forEach(([type, stats]) => {
                    const color = typeColors[type] || '#6B8DA6';
                    
                    let trendIcon = '';
                    let trendColor = '';
                    let trendText = '';
                    
                    if (stats.improvement_trend === 'improving') {
                        trendIcon = 'fas fa-arrow-up';
                        trendColor = 'text-success';
                        trendText = 'Mejorando';
                    } else if (stats.improvement_trend === 'declining') {
                        trendIcon = 'fas fa-arrow-down';
                        trendColor = 'text-danger';
                        trendText = 'Descendiendo';
                    } else if (stats.improvement_trend === 'stable') {
                        trendIcon = 'fas fa-minus';
                        trendColor = 'text-warning';
                        trendText = 'Estable';
                    } else {
                        trendIcon = 'fas fa-question';
                        trendColor = 'text-muted';
                        trendText = 'Sin datos';
                    }
                    
                    statisticsHtml += `
                        <div class="col-12 mb-3">
                            <div class="p-3 rounded" style="background-color: rgba(255,255,255,0.5); border-left: 4px solid ${color};">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-0" style="color: ${color};">${type}</h6>
                                    <small class="text-muted">${stats.total_evaluations} evaluacion${stats.total_evaluations !== 1 ? 'es' : ''}</small>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <small class="text-muted">Promedio</small>
                                        <div class="h6 mb-0">${stats.average_score ? Math.round(stats.average_score) : '-'}${stats.average_score ? '%' : ''}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Última</small>
                                        <div class="h6 mb-0">${stats.latest_score ? Math.round(stats.latest_score) : '-'}${stats.latest_score ? '%' : ''}</div>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="${trendColor}">
                                        <i class="${trendIcon} me-1"></i>
                                        ${trendText}
                                    </small>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                statisticsHtml += `
                        </div>
                    </div>
                `;
            } else {
                // Si no hay estadísticas por tipo, mostrar estadísticas generales
                let trendIcon = '';
                let trendColor = '';
                let trendText = '';
                
                if (statistics.improvement_trend === 'improving') {
                    trendIcon = 'fas fa-arrow-up';
                    trendColor = 'text-success';
                    trendText = 'Mejorando';
                } else if (statistics.improvement_trend === 'declining') {
                    trendIcon = 'fas fa-arrow-down';
                    trendColor = 'text-danger';
                    trendText = 'Descendiendo';
                } else if (statistics.improvement_trend === 'stable') {
                    trendIcon = 'fas fa-minus';
                    trendColor = 'text-warning';
                    trendText = 'Estable';
                } else {
                    trendIcon = 'fas fa-question';
                    trendColor = 'text-muted';
                    trendText = 'Sin datos';
                }
                
                statisticsHtml += `
                    <div class="mb-4">
                        <h6 class="mb-2">Última Puntuación</h6>
                        <div class="h4 text-info">${statistics.latest_score ? Math.round(statistics.latest_score) : '-'}${statistics.latest_score ? '%' : ''}</div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="mb-2">Tendencia</h6>
                        <div class="h5 ${trendColor}">
                            <i class="${trendIcon} me-2"></i>
                            ${trendText}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = statisticsHtml;
        }

        // Render latest evaluation details
        function renderLatestEvaluationDetails(history) {
            const container = document.getElementById('latestEvaluationContainer');
            
            if (!history || history.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-bullseye"></i><p>No hay evaluaciones completadas</p></div>';
                return;
            }
            
            const latest = history[history.length - 1];
            const dimensions = latest.dimensional_scores;
            
            container.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-4">Puntuación General</h5>
                        <div class="text-center mb-4">
                            <div class="h1 text-primary">${Math.round(latest.total_score)}%</div>
                            <div class="h6 text-muted">${latest.assertiveness_level}</div>
                            <div class="small text-secondary mb-2">${latest.result_description || ''}</div>
                            <small class="text-muted">Completado el ${formatDate(latest.completed_at)}</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5 class="mb-4">Análisis por Dimensiones</h5>
                        ${Object.entries(dimensions).map(([key, value]) => {
                            const progressClass = value >= 75 ? 'high' : value >= 25 ? 'medium' : 'low';
                            const dimensionLabel = getDimensionLabel(key);
                            
                            return `
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small>${dimensionLabel}</small>
                                        <small>${Math.round(value)}%</small>
                                    </div>
                                    <div class="progress-bar-custom">
                                        <div class="progress-fill ${progressClass}" style="width: ${value}%"></div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // Open task progress modal
        function openTaskProgressModal(taskId) {
            const task = tasksData.find(t => t.id === taskId);
            if (!task) return;
            
            document.getElementById('taskId').value = taskId;
            document.getElementById('taskStatus').value = task.status;
            document.getElementById('taskProgress').value = task.progress_percentage;
            document.getElementById('progressValue').textContent = Math.round(task.progress_percentage) + '%';
            document.getElementById('taskNotes').value = '';
            
            // Update progress display when slider changes
            const progressSlider = document.getElementById('taskProgress');
            progressSlider.oninput = function() {
                document.getElementById('progressValue').textContent = this.value + '%';
            };
            
            const modal = new bootstrap.Modal(document.getElementById('taskProgressModal'));
            modal.show();
        }

        // Save task progress
        async function saveTaskProgress() {
            const taskId = document.getElementById('taskId').value;
            const status = document.getElementById('taskStatus').value;
            const progress = parseInt(document.getElementById('taskProgress').value);
            const notes = document.getElementById('taskNotes').value;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/tasks/${taskId}/progress`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        status: status,
                        progress_percentage: progress,
                        notes: notes
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('taskProgressModal'));
                    modal.hide();
                    
                    // Refresh tasks
                    await loadTasks();
                    await loadDashboardSummary();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error actualizando progreso:', error);
                showToast('Error actualizando progreso: ' + error.message, 'error');
            }
        }

        // Start evaluation
        async function startEvaluation(evaluationType) {
            try {
                
                // Reset assessment state
                questions = [];
                currentQuestionIndex = 0;
                answers = {};
                isAssessmentActive = true;
                
                // Store current assessment ID for later use
                currentAssessmentId = evaluationType;
                
                // Show assessment tab
                document.getElementById('assessment-sidebar-item').style.display = 'block';
                
                // Switch to assessment tab
                showTab('assessment');
                
                // Load questions
                await loadAssessmentQuestions();
                
            } catch (error) {
                console.error('Error starting assessment:', error);
                showToast('Error iniciando evaluación: ' + error.message, 'error');
            }
        }

        // Load assessment questions
        async function loadAssessmentQuestions() {
            try {
                const url = `${API_BASE_URL}/api/questions?assessment_id=${currentAssessmentId}`;
                const response = await fetch(url, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        window.location.href = '/login?role=coachee';
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.questions && data.questions.length > 0) {
                    questions = data.questions;
                    
                    // MEJORADO: Validación completa del correlativo al cargar
                    console.log('🔍 DEBUG PREGUNTAS CARGADAS:', {
                        total: questions.length,
                        first5: questions.slice(0, 5).map(q => ({
                            id: q.id,
                            order: q.order,
                            text: q.text.substring(0, 30) + '...'
                        }))
                    });
                    
                    // Validar integridad del correlativo
                    validateQuestionSequence();
                    
                    // Actualizar el título dinámicamente en el header de la evaluación
                    const assessmentHeaderTitle = document.querySelector('#assessment .card-header h3');
                    if (assessmentHeaderTitle && data.assessment_title) {
                        assessmentHeaderTitle.innerHTML = `
                            <i class="fas fa-clipboard-check me-2"></i>
                            ${data.assessment_title}
                        `;
                        console.log('🎯 FRONTEND: Título actualizado a:', data.assessment_title);
                    }
                    
                    // Guardar el título para uso posterior en resultados
                    window.currentAssessmentTitle = data.assessment_title;
                    
                    showAssessmentQuestion();
                } else {
                    throw new Error('No se encontraron preguntas válidas');
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                showToast('Error cargando preguntas: ' + error.message, 'error');
            }
        }

        // NUEVA: Validar secuencia completa del correlativo
        function validateQuestionSequence() {
            console.log('🔍 VALIDANDO SECUENCIA DE PREGUNTAS...');
            
            const totalQuestions = questions.length;
            const expectedForIE = 12;
            const orders = questions.map(q => q.order).sort((a, b) => a - b);
            const ids = questions.map(q => q.id).sort((a, b) => a - b);
            
            // Verificar cantidad esperada
            const isCorrectCount = totalQuestions === expectedForIE;
            
            // Verificar secuencia consecutiva 1-12
            const expectedOrders = Array.from({length: expectedForIE}, (_, i) => i + 1);
            const isConsecutiveSequence = JSON.stringify(orders) === JSON.stringify(expectedOrders);
            
            // Verificar que cada índice del array corresponda al correlativo
            const arrayToOrderMatch = questions.every((q, index) => q.order === (index + 1));
            
            const validationResult = {
                totalQuestions: totalQuestions,
                expectedCount: expectedForIE,
                isCorrectCount: isCorrectCount,
                orders: orders,
                expectedOrders: expectedOrders,
                isConsecutiveSequence: isConsecutiveSequence,
                arrayToOrderMatch: arrayToOrderMatch,
                questionDetails: questions.map((q, index) => ({
                    arrayIndex: index,
                    questionId: q.id,
                    order: q.order,
                    orderMatchesIndex: q.order === (index + 1)
                }))
            };
            
            console.log('📊 RESULTADO VALIDACIÓN CORRELATIVO:', validationResult);
            
            if (!isCorrectCount) {
                console.error('❌ ERROR: Cantidad incorrecta de preguntas', {
                    expected: expectedForIE,
                    received: totalQuestions
                });
            }
            
            if (!isConsecutiveSequence) {
                console.error('❌ ERROR: Correlativo no consecutivo', {
                    expected: expectedOrders,
                    received: orders
                });
            }
            
            if (!arrayToOrderMatch) {
                console.error('❌ ERROR: Índices del array no coinciden con correlativo', validationResult.questionDetails);
                showToast('Error: La secuencia de preguntas no está ordenada correctamente', 'error');
            }
            
            if (isCorrectCount && isConsecutiveSequence && arrayToOrderMatch) {
                console.log('✅ VALIDACIÓN EXITOSA: Correlativo perfecto 1-12 consecutivo');
            }
            
            return validationResult;
        }

        // Show current assessment question
        function showAssessmentQuestion() {
            if (currentQuestionIndex >= questions.length) {
                completeAssessment();
                return;
            }
            
            const question = questions[currentQuestionIndex];
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            
            // MEJORADO: Validación del correlativo
            const expectedCorrelativo = currentQuestionIndex + 1;
            if (question.order !== expectedCorrelativo) {
                console.warn('⚠️ ADVERTENCIA: Correlativo inconsistente', {
                    questionId: question.id,
                    currentIndex: currentQuestionIndex,
                    questionOrder: question.order,
                    expectedOrder: expectedCorrelativo,
                    difference: question.order - expectedCorrelativo
                });
            }
            
            // Update progress bar
            document.getElementById('assessmentProgress').style.width = progress + '%';
            
            // Determinar opciones según el tipo de evaluación
            let likertOptions;
            
            // DEBUG: Verificar qué assessment ID se está usando
            console.log('🔍 DEBUG OPCIONES:', {
                currentAssessmentId: currentAssessmentId,
                assessmentIdType: typeof currentAssessmentId,
                isEvaluacion6: currentAssessmentId === 6,
                questionDimension: questions[currentQuestionIndex]?.dimension,
                questionText: questions[currentQuestionIndex]?.text
            });
            
            if (currentAssessmentId === 6 || currentAssessmentId === "6") {  // Preparación para crecer 2026
                console.log('✅ Usando opciones específicas para Preparación para crecer 2026');
                likertOptions = getGrowthPreparationOptions(questions[currentQuestionIndex]);
            } else {
                console.log('➡️ Usando opciones estándar de Likert');
                // Opciones estándar para escala Likert de 5 puntos (otras evaluaciones)
                likertOptions = [
                    'Totalmente en desacuerdo',
                    'En desacuerdo',
                    'Neutral',
                    'De acuerdo',
                    'Totalmente de acuerdo'
                ];
            }
            
            // DEBUG: Log question details mejorado
            console.log('🔍 DEBUG PREGUNTA MOSTRADA:', {
                currentQuestionIndex: currentQuestionIndex,
                displayNumber: question.order, // USAR ORDEN DE LA PREGUNTA, NO ÍNDICE
                questionId: question.id,
                questionOrder: question.order,
                expectedCorrelativo: expectedCorrelativo,
                correlatioMatch: question.order === expectedCorrelativo,
                totalQuestions: questions.length,
                questionText: question.text.substring(0, 50) + '...',
                progressPercentage: Math.round(progress),
                hasStoredAnswer: answers[question.id] !== undefined
            });
            
            // Create question HTML
            document.getElementById('questionContainer').innerHTML = `
                <div class="question-card">
                    <div class="question-title mb-3">
                        <i class="fas fa-question-circle me-2"></i>
                        Pregunta ${question.order} de ${questions.length}
                    </div>
                    <div class="question-text mb-4">${question.text}</div>
                    <div class="options-container mb-4">
                        ${likertOptions.map((option, index) => `
                            <div class="form-check mb-3 p-3 border rounded option-item auto-advance-option" onclick="selectAssessmentOption(${index + 1})">
                                <input class="form-check-input" type="radio" name="question${currentQuestionIndex}" value="${index + 1}" id="option${index}">
                                <label class="form-check-label w-100" for="option${index}">
                                    ${option}
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="text-center">
                        <button class="btn btn-primary-custom btn-lg manual-next-btn" onclick="nextAssessmentQuestion()" style="display: none;">
                            <i class="fas fa-${currentQuestionIndex === questions.length - 1 ? 'flag-checkered' : 'arrow-right'} me-2"></i>
                            ${currentQuestionIndex === questions.length - 1 ? 'Finalizar Evaluación' : 'Siguiente Pregunta'}
                        </button>
                    </div>
                </div>
            `;
            
            // Add fade-in animation to new question
            const questionCard = document.querySelector('.question-card');
            if (questionCard) {
                questionCard.style.opacity = '0';
                questionCard.style.transition = 'opacity 0.4s ease-in';
                setTimeout(() => {
                    questionCard.style.opacity = '1';
                }, 50);
            }
        }

        // Select assessment option
        function selectAssessmentOption(value) {
            // Remove previous selections
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('bg-primary', 'text-white', 'selected');
                item.classList.add('bg-light');
            });
            
            // Mark selected option
            const selectedOption = document.querySelector(`input[value="${value}"]`);
            if (selectedOption) {
                selectedOption.checked = true;
                const optionItem = selectedOption.closest('.option-item');
                optionItem.classList.remove('bg-light');
                optionItem.classList.add('bg-primary', 'text-white', 'selected');
                
                // Add visual feedback with animation
                optionItem.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    optionItem.style.transform = 'scale(1)';
                }, 150);
                
                // Show brief loading state
                const nextButton = document.querySelector('.btn-primary-custom');
                if (nextButton) {
                    nextButton.disabled = true;
                    nextButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Procesando...';
                }
                
                // Store the answer immediately using question ID as key
                const currentQuestion = questions[currentQuestionIndex];
                if (currentQuestion && currentQuestion.id) {
                    answers[currentQuestion.id] = parseInt(value);
                    console.log('🔍 DEBUG RESPUESTA GUARDADA:', {
                        questionIndex: currentQuestionIndex,
                        questionId: currentQuestion.id,
                        questionOrder: currentQuestion.order,
                        selectedValue: parseInt(value),
                        totalAnswers: Object.keys(answers).length
                    });
                }
                
                // Auto-advance to next question after a brief delay
                setTimeout(() => {
                    autoAdvanceQuestion();
                }, 300); // 300ms delay for better UX
            }
        }
        
        // Auto-advance to next question
        function autoAdvanceQuestion() {
            // Add fade-out animation to current question
            const questionCard = document.querySelector('.question-card');
            if (questionCard) {
                questionCard.style.transition = 'opacity 0.3s ease-out';
                questionCard.style.opacity = '0';
                
                setTimeout(() => {
                    console.log('🔍 DEBUG ANTES DEL AVANCE:', {
                        currentIndex: currentQuestionIndex,
                        currentQuestionId: questions[currentQuestionIndex]?.id,
                        currentQuestionOrder: questions[currentQuestionIndex]?.order,
                        totalQuestionsLoaded: questions.length,
                        answersSoFar: Object.keys(answers).length,
                        answeredQuestionIds: Object.keys(answers).map(id => parseInt(id)).sort()
                    });
                    
                    // MEJORADO: Validar que no nos saltemos ninguna pregunta
                    const currentQuestion = questions[currentQuestionIndex];
                    if (currentQuestion && !answers[currentQuestion.id]) {
                        console.warn('⚠️ ADVERTENCIA: Pregunta sin respuesta detectada', {
                            questionId: currentQuestion.id,
                            questionOrder: currentQuestion.order,
                            index: currentQuestionIndex
                        });
                        // No avanzar si no hay respuesta
                        questionCard.style.opacity = '1';
                        return;
                    }
                    
                    currentQuestionIndex++;
                    
                    console.log('🔍 DEBUG DESPUÉS DEL AVANCE:', {
                        newIndex: currentQuestionIndex,
                        totalQuestions: questions.length,
                        nextQuestionId: questions[currentQuestionIndex]?.id,
                        nextQuestionOrder: questions[currentQuestionIndex]?.order,
                        willComplete: currentQuestionIndex >= questions.length
                    });
                    
                    // MEJORADO: Validación adicional del correlativo
                    if (currentQuestionIndex < questions.length) {
                        const nextQuestion = questions[currentQuestionIndex];
                        console.log('🎯 NAVEGANDO A PREGUNTA:', {
                            arrayIndex: currentQuestionIndex,
                            questionId: nextQuestion.id,
                            correlativo: nextQuestion.order,
                            expectedCorrelativo: currentQuestionIndex + 1,
                            isCorrectSequence: nextQuestion.order === (currentQuestionIndex + 1)
                        });
                        showAssessmentQuestion();
                    } else {
                        // Complete assessment - MEJORADO: Verificación final dinámica
                        const totalQuestionsExpected = questions.length; // Usar el número real de preguntas cargadas
                        const totalAnswered = Object.keys(answers).length;
                        
                        console.log('🎯 COMPLETANDO EVALUACIÓN - Resumen final:', {
                            assessmentType: currentAssessmentId === 2 ? 'DISC' : (currentAssessmentId === 3 ? 'IE' : 'OTRA'),
                            totalQuestionsExpected: totalQuestionsExpected,
                            totalAnswersCollected: totalAnswered,
                            questionIds: questions.map(q => q.id).sort(),
                            answeredIds: Object.keys(answers).map(id => parseInt(id)).sort(),
                            missingIds: questions.map(q => q.id).filter(id => !answers[id]),
                            isComplete: totalAnswered === totalQuestionsExpected,
                            currentAssessmentId: currentAssessmentId
                        });
                        
                        // Validar que tengamos todas las respuestas antes de completar
                        if (totalAnswered < totalQuestionsExpected) {
                            console.error('❌ ERROR: Faltan respuestas, no se puede completar', {
                                expected: totalQuestionsExpected,
                                received: totalAnswered,
                                missing: questions.map(q => q.id).filter(id => !answers[id])
                            });
                            showToast('Error: Faltan respuestas. Reiniciando evaluación...', 'error');
                            // Reiniciar desde la primera pregunta no respondida
                            const firstMissing = questions.findIndex(q => !answers[q.id]);
                            if (firstMissing >= 0) {
                                currentQuestionIndex = firstMissing;
                                showAssessmentQuestion();
                                return;
                            }
                        }
                        
                        completeAssessment();
                    }
                }, 300); // Wait for fade-out animation
            }
        }

        // Move to next assessment question (manual fallback)
        function nextAssessmentQuestion() {
            const selected = document.querySelector(`input[name="question${currentQuestionIndex}"]:checked`);
            
            if (!selected) {
                showToast('Por favor selecciona una respuesta', 'warning');
                return;
            }
            
            // Store answer using question ID - ALWAYS store it
            const currentQuestion = questions[currentQuestionIndex];
            if (currentQuestion && currentQuestion.id) {
                answers[currentQuestion.id] = parseInt(selected.value);
                console.log('🔍 DEBUG RESPUESTA MANUAL:', {
                    questionIndex: currentQuestionIndex,
                    questionId: currentQuestion.id,
                    selectedValue: parseInt(selected.value),
                    totalAnswersNow: Object.keys(answers).length
                });
            }
            
            // Use the same auto-advance logic
            autoAdvanceQuestion();
        }

        // Complete assessment
        async function completeAssessment() {
            try {
                console.log('Answers object:', answers);
                console.log('Questions array:', questions);
                
                if (Object.keys(answers).length === 0) {
                    throw new Error('No hay respuestas guardadas');
                }
                
                // MEJORADO: Validación final completa antes de enviar
                const totalAnswers = Object.keys(answers).length;
                const expectedAnswers = questions.length;
                
                console.log('🔍 VALIDACIÓN FINAL ANTES DEL ENVÍO:', {
                    assessmentType: currentAssessmentId === 2 ? 'DISC' : (currentAssessmentId === 3 ? 'IE' : 'OTRA'),
                    currentAssessmentId: currentAssessmentId,
                    totalAnswersProvided: totalAnswers,
                    expectedAnswersFromQuestions: expectedAnswers,
                    answeredQuestionIds: Object.keys(answers).map(id => parseInt(id)).sort(),
                    expectedQuestionIds: questions.map(q => q.id).sort(),
                    allQuestionsAnswered: questions.every(q => answers[q.id] !== undefined),
                    missingQuestions: questions.filter(q => answers[q.id] === undefined).map(q => ({id: q.id, order: q.order}))
                });
                
                // Verificar que todas las preguntas estén respondidas
                if (totalAnswers !== expectedAnswers) {
                    const missingQuestions = questions.filter(q => answers[q.id] === undefined);
                    console.error('❌ ERROR VALIDACIÓN FINAL: Faltan respuestas', {
                        expected: expectedAnswers,
                        received: totalAnswers,
                        missing: missingQuestions.map(q => ({id: q.id, order: q.order, text: q.text.substring(0, 30)}))
                    });
                    
                    showToast(`Error: Faltan ${expectedAnswers - totalAnswers} respuestas. Evaluación incompleta.`, 'error');
                    
                    // Ir a la primera pregunta sin responder
                    if (missingQuestions.length > 0) {
                        const firstMissingIndex = questions.findIndex(q => q.id === missingQuestions[0].id);
                        if (firstMissingIndex >= 0) {
                            currentQuestionIndex = firstMissingIndex;
                            showAssessmentQuestion();
                            return;
                        }
                    }
                    
                    throw new Error(`Evaluación incompleta: ${totalAnswers}/${expectedAnswers} respuestas`);
                }
                
                // Convert answers to the format expected by the API
                const responses = [];
                for (const [questionId, answer] of Object.entries(answers)) {
                    // questionId is now the actual question ID, not an index
                    responses.push({
                        question_id: parseInt(questionId),
                        selected_option: answer
                    });
                }
                
                console.log('🔍 DEBUG ENVÍO:', {
                    totalAnswers: Object.keys(answers).length,
                    questionIds: Object.keys(answers).map(id => parseInt(id)),
                    responses: responses,
                    validationPassed: true
                });
                
                console.log('Converted responses:', responses);
                
                if (responses.length === 0) {
                    throw new Error('No se pudieron procesar las respuestas');
                }
                
                // Create user data for assessment
                const userData = {
                    age: 25, // Default age
                    gender: 'no_especificado'
                };
                
                const requestBody = {
                    age: userData.age,
                    gender: userData.gender,
                    responses: responses,
                    assessment_id: currentAssessmentId
                };
                
                console.log('Request body:', requestBody);
                
                // Send assessment data
                const response = await fetch(`${API_BASE_URL}/api/save_assessment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                console.log('API response:', data);
                
                if (response.ok && data.success) {
                    showAssessmentResults(data);
                } else if (response.status === 409) {
                    // Evaluación ya completada previamente
                    showToast(data.error || 'Ya has completado esta evaluación previamente', 'warning');
                } else {
                    throw new Error(data.error || 'Error guardando evaluación');
                }
                
            } catch (error) {
                console.error('Assessment completion error:', error);
                showToast('Error completando evaluación: ' + error.message, 'error');
            }
        }

        // Show assessment results
        function showAssessmentResults(data) {
            console.log('showAssessmentResults received:', data);
            
            // Extract result data from the correct location
            const result = data.result || data;
            const evaluationId = result.id;
            const score = Math.round(result.score);
            const resultText = result.result_text || '';
            
            // Store the result_id and data for detailed view
            window.lastEvaluationId = evaluationId;
            window.lastAssessmentData = result; // Store complete result data
            
            console.log('Stored evaluation ID:', evaluationId);
            console.log('Stored assessment data:', result);
            
            if (!evaluationId) {
                console.error('No evaluation ID found in response:', data);
                showToast('Error: No se encontró el ID de la evaluación', 'error');
                return;
            }
            
            // Hide question container and reset assessment state
            document.getElementById('assessmentContainer').style.display = 'none';
            isAssessmentActive = false; // Reset assessment state
            
            // Hide assessment tab automatically when evaluation is completed
            document.getElementById('assessment-sidebar-item').style.display = 'none';
            
            // Switch back to evaluations tab
            showTab('evaluations');
            
            // Mostrar directamente el modal de detalles de evaluación con los datos recién completados
            setTimeout(() => {
                viewEvaluationDetails(evaluationId);
            }, 1000); // Aumentar el tiempo para asegurar que los datos se guardan completamente
        }

        // Helper function to format dimension names
        function formatDimensionName(dimension) {
            const dimensionNames = {
                'comunicacion': 'Comunicación',
                'derechos': 'Defensa de Derechos',
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza',
                'opiniones': 'Expresión de Opiniones'
            };
            return dimensionNames[dimension] || dimension.charAt(0).toUpperCase() + dimension.slice(1);
        }

        // View detailed results immediately after completing assessment
        async function viewDetailedResults() {
            console.log('viewDetailedResults called');
            console.log('lastEvaluationId:', window.lastEvaluationId);
            console.log('lastAssessmentData:', window.lastAssessmentData);
            
            if (window.lastEvaluationId) {
                try {
                    // If we have the assessment data in memory, use it immediately
                    if (window.lastAssessmentData && window.lastAssessmentData.dimensional_scores) {
                        console.log('Using cached assessment data');
                        await viewEvaluationDetails(window.lastEvaluationId);
                    } else {
                        console.log('Fetching fresh evaluation details from server');
                        await viewEvaluationDetails(window.lastEvaluationId);
                    }
                } catch (error) {
                    console.error('Error in viewDetailedResults:', error);
                    showToast('Error al cargar los detalles de la evaluación', 'error');
                }
            } else {
                console.error('No evaluation ID available');
                showToast('Error: No se encontró el ID de la evaluación. Intenta refrescar la página.', 'error');
            }
        }

        // Finish assessment and return to dashboard
        function finishAssessment() {
            // Reset assessment state
            isAssessmentActive = false;
            
            // Hide assessment tab
            document.getElementById('assessment-sidebar-item').style.display = 'none';
            
            // Cerrar el modal de detalles de evaluación si está abierto
            const evaluationDetailsModal = bootstrap.Modal.getInstance(document.getElementById('evaluationDetailsModal'));
            if (evaluationDetailsModal) {
                evaluationDetailsModal.hide();
            }
            
            // Show assessment container
            document.getElementById('assessmentContainer').style.display = 'block';
            
            // Switch back to evaluations tab
            showTab('evaluations');
            
            // Refresh data
            refreshDashboard();
            
            showToast('Evaluación finalizada. Los datos se han actualizado.', 'success');
        }
        
        // View evaluation details
        async function viewEvaluationDetails(evaluationId) {
            try {
                console.log('Loading evaluation details for ID:', evaluationId);
                
                // Mostrar el modal
                const modal = new bootstrap.Modal(document.getElementById('evaluationDetailsModal'));
                modal.show();
                
                // Cargar detalles de la evaluación
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-details/${evaluationId}`);
                const data = await response.json();
                
                console.log('API response:', data);
                
                if (response.ok) {
                    // La API devuelve {success: true, evaluation: {...}}
                    if (data.success && data.evaluation) {
                        renderEvaluationDetails(data.evaluation);
                    } else {
                        throw new Error('Estructura de datos inesperada');
                    }
                } else {
                    throw new Error(data.error || 'Error desconocido');
                }
            } catch (error) {
                console.error('Error cargando detalles de evaluación:', error);
                document.getElementById('evaluationDetailsContent').innerHTML = 
                    '<div class="text-center text-danger"><i class="fas fa-exclamation-triangle"></i><p>Error cargando detalles de la evaluación</p></div>';
                showToast('Error cargando detalles de la evaluación: ' + error.message, 'error');
            }
        }

        function renderEvaluationDetails(evaluation) {
            console.log('renderEvaluationDetails called with:', evaluation);
            console.log('Current cached data:', window.lastAssessmentData);
            console.log('Last evaluation ID:', window.lastEvaluationId);
            
            // Guardar el ID de la evaluación actual para uso en solicitudes
            window.currentEvaluationId = evaluation.id;
            
            const container = document.getElementById('evaluationDetailsContent');
            
            // Si tenemos datos de la evaluación más reciente (cuando se acaba de completar)
            const currentData = window.lastAssessmentData;
            const useCurrent = currentData && window.lastEvaluationId && 
                             window.lastEvaluationId === evaluation.id;
            
            console.log('Using current cached data:', useCurrent);
            
            const data = useCurrent ? currentData : evaluation;
            const dimensionalScores = useCurrent ? currentData.dimensional_scores : evaluation.dimensional_scores;
            const recommendations = evaluation.recommendations || []; // SIEMPRE usar datos del servidor para recomendaciones
            const detailedAnalysis = useCurrent ? currentData.detailed_analysis : evaluation.detailed_analysis;
            
            // Determinar el tipo de evaluación y configurar títulos apropiados
            const assessmentTitle = evaluation.assessment_title || data.assessment_title || 'Evaluación';
            const isDiscAssessment = assessmentTitle.includes('DISC');
            const isEmotionalIntelligenceAssessment = assessmentTitle.includes('Inteligencia Emocional');
            const isTeamworkAssessment = assessmentTitle.includes('Trabajo en Equipo');
            const isGrowthPreparationAssessment = assessmentTitle.includes('Preparación para crecer 2026');
            
            let analysisTitle, chartTitle;
            if (isDiscAssessment) {
                analysisTitle = 'Análisis Completo DISC de Personalidad';
                chartTitle = 'Radar de Dimensiones DISC';
            } else if (isEmotionalIntelligenceAssessment) {
                analysisTitle = 'Análisis Completo de Inteligencia Emocional';
                chartTitle = 'Radar de Competencias Emocionales';
            } else if (isTeamworkAssessment) {
                analysisTitle = 'Análisis Completo de Trabajo en Equipo';
                chartTitle = 'Radar de Competencias de Colaboración';
            } else if (isGrowthPreparationAssessment) {
                analysisTitle = 'Análisis de Preparación para Crecer 2026';
                chartTitle = 'Radar de Dimensiones Empresariales';
            } else {
                analysisTitle = 'Análisis Completo de Asertividad';
                chartTitle = 'Radar de Competencias';
            }
            
            console.log('Assessment type detected:', { assessmentTitle, isDiscAssessment, analysisTitle });
            console.log('Final data to use:', data);
            console.log('Dimensional scores:', dimensionalScores);
            console.log('Recommendations from server:', recommendations);
            console.log('Recommendations count:', recommendations ? recommendations.length : 0);
            
            // Layout completamente diferente para "Preparación para crecer 2026"
            if (isGrowthPreparationAssessment) {
                const html = generateGrowthPreparationLayout(data, evaluation, dimensionalScores);
                container.innerHTML = html;
                
                // Crear el gráfico radar específico para crecimiento
                setTimeout(() => {
                    createGrowthRadarChart(dimensionalScores);
                }, 100);
                
                return;
            }
            
            const html = `
                <!-- Resumen General -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-body text-center">
                                <h4 class="mb-3" style="color: #333;">${analysisTitle}</h4>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="h2" style="color: #007bff;">${Math.round(data.score || evaluation.score)}%</div>
                                        <div style="color: #666;">Puntuación Total</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h4" style="color: #28a745;">${isDiscAssessment ? getDiscLevelFromScore(data.score || evaluation.score) : (isEmotionalIntelligenceAssessment ? getEmotionalIntelligenceLevelFromScore(data.score || evaluation.score) : (isTeamworkAssessment ? getTeamworkLevelFromScore(data.score || evaluation.score) : (isGrowthPreparationAssessment ? getGrowthPreparationLevelFromScore(data.score || evaluation.score) : getAssertiveLevelFromScore(data.score || evaluation.score))))}</div>
                                        <div style="color: #666;">${isDiscAssessment ? 'Perfil DISC Dominante' : (isEmotionalIntelligenceAssessment ? 'Nivel de Inteligencia Emocional' : (isTeamworkAssessment ? 'Nivel de Trabajo en Equipo' : (isGrowthPreparationAssessment ? 'Nivel de Preparación' : 'Nivel de Asertividad')))}</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h6" style="color: #333;">${formatDate(data.completed_at || evaluation.completed_at)}</div>
                                        <div style="color: #666;">Fecha de Completado</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h6" style="color: #333;">${data.total_questions || evaluation.total_questions || (evaluation.responses ? evaluation.responses.length : 'N/A')}</div>
                                        <div style="color: #666;">Preguntas Respondidas</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${generateAssertivenessSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}
                ${generateDiscSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}
                ${generateEmotionalIntelligenceSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}
                ${generateTeamworkSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}

                ${(isDiscAssessment || isEmotionalIntelligenceAssessment || isTeamworkAssessment || (!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && !isGrowthPreparationAssessment)) ? `
                <!-- Sección de Contacto con Coach -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border: 1px solid #dee2e6;">
                            <div class="card-body text-white text-center">
                                <div class="row align-items-center">
                                    <div class="col-lg-8">
                                        <h4 class="mb-3"><i class="fas fa-user-graduate me-2"></i>¡Desarrolla tu Potencial!</h4>
                                        <p class="mb-3" style="font-size: 1.1em; line-height: 1.6;">
                                            ${isDiscAssessment ? 
                                                'Descubre cómo potenciar tu perfil de personalidad DISC con el apoyo de un coach especializado en desarrollo personal y profesional.' :
                                                isEmotionalIntelligenceAssessment ?
                                                'Potencia tu inteligencia emocional con el acompañamiento de un coach especializado en competencias emocionales y liderazgo.' :
                                                isTeamworkAssessment ?
                                                'Fortalece tus habilidades de trabajo en equipo con el apoyo de un coach especializado en colaboración y liderazgo de equipos.' :
                                                'Puedes desarrollar y fortalecer tus habilidades de asertividad con el apoyo personalizado de un coach profesional.'
                                            }
                                            Nuestros expertos te ayudarán a crear un plan de desarrollo específico para tus necesidades.
                                        </p>
                                        <p class="mb-0" style="font-size: 1em;">
                                            <i class="fas fa-gift me-2"></i><strong>¡Sesión gratuita de 30 minutos disponible!</strong>
                                        </p>
                                    </div>
                                    <div class="col-lg-4">
                                        <button class="btn btn-light btn-lg" onclick="contactCoachForSession()" style="color: #28a745; font-weight: bold;">
                                            <i class="fas fa-calendar-plus me-2"></i>
                                            Contactar Coach
                                        </button>
                                        <div class="mt-2">
                                            <small style="opacity: 0.9;">
                                                <i class="fas fa-clock me-1"></i>30 min • <i class="fas fa-gift me-1"></i>Gratis
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Gráfico Radar y Análisis Dimensional -->
                <div class="row mb-4">
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-radar me-2"></i>${chartTitle}</h5>
                            </div>
                            <div class="card-body">
                                <div class="radar-chart-container" style="position: relative; height: 300px;">
                                    <canvas id="radarChart" width="300" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-bar me-2"></i>Puntuaciones por Dimensión</h5>
                            </div>
                            <div class="card-body">
                                <div id="dimensionalScoresContainer">
                                    ${generateDimensionalScoresHTML(dimensionalScores)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                ${(!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && isGrowthPreparationAssessment) ? 
                    generateDetailedAnalysisHTML(detailedAnalysis || generateAnalysisFromScores(dimensionalScores)) : ''}
                ${(!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && isGrowthPreparationAssessment) && recommendations && recommendations.length > 0 ? 
                    generateCompactRecommendationsHTML(recommendations) : ''}
                
                ${(!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && isGrowthPreparationAssessment) ? `
                <!-- Respuestas Detalladas -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-list me-2"></i>Respuestas Detalladas</h5>
                            </div>
                            <div class="card-body">
                                ${generateResponsesHTML(evaluation.responses || [], evaluation.assessment_id || data.assessment_id)}
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}
            `;
            
            container.innerHTML = html;
            
            // Crear el gráfico radar después de insertar el HTML
            setTimeout(() => {
                console.log('🎯 CALLING RADAR: About to call createRadarChart with:', {
                    dimensionalScores,
                    isDiscAssessment,
                    isEmotionalIntelligenceAssessment,
                    assessmentTitle
                });
                createRadarChart(dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment);
            }, 100);
        }

        function generateDimensionalScoresHTML(dimensionalScores) {
            if (!dimensionalScores) return '<p style="color: #666;">No hay datos dimensionales disponibles.</p>';
            
            let html = '';
            for (const [dimension, score] of Object.entries(dimensionalScores)) {
                const dimensionName = formatDimensionName(dimension);
                const percentage = Math.round(score);
                let colorClass = 'danger';
                if (percentage >= 70) colorClass = 'success';
                else if (percentage >= 50) colorClass = 'warning';
                
                html += `
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <strong style="color: #333;">${dimensionName}</strong>
                            <span class="badge bg-${colorClass}">${percentage}%</span>
                        </div>
                        <div class="progress" style="height: 10px; background: #e9ecef;">
                            <div class="progress-bar bg-${colorClass}" style="width: ${percentage}%"></div>
                        </div>
                        <small style="color: #666;">${getDimensionDescription(dimension, percentage)}</small>
                    </div>
                `;
            }
            return html;
        }

        function generateAnalysisFromScores(dimensionalScores) {
            if (!dimensionalScores) return null;
            
            const strengths = [];
            const improvementAreas = [];
            
            // Analizar cada dimensión
            for (const [dimension, score] of Object.entries(dimensionalScores)) {
                const percentage = Math.round(score);
                const dimensionName = formatDimensionName(dimension);
                
                if (percentage >= 70) {
                    // Es una fortaleza
                    strengths.push({
                        name: dimensionName,
                        score: percentage,
                        description: getDimensionDescription(dimension, percentage)
                    });
                } else if (percentage < 60) {
                    // Es un área de mejora
                    const priority = percentage < 40 ? 'high' : 'medium';
                    improvementAreas.push({
                        name: dimensionName,
                        score: percentage,
                        description: getDimensionDescription(dimension, percentage),
                        priority: priority
                    });
                }
            }
            
            return {
                strengths: strengths,
                improvement_areas: improvementAreas
            };
        }

        function generateDetailedAnalysisHTML(analysis) {
            let html = '<div class="row mb-4">';
            
            // Fortalezas
            if (analysis.strengths && analysis.strengths.length > 0) {
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #28a745 !important;">
                            <div class="card-header" style="background: #d4edda; color: #155724;">
                                <h6 class="mb-0"><i class="fas fa-star me-2"></i>Fortalezas Identificadas</h6>
                            </div>
                            <div class="card-body">
                `;
                
                analysis.strengths.forEach(strength => {
                    html += `
                        <div class="d-flex align-items-start mb-3">
                            <div class="flex-shrink-0">
                                <span class="badge bg-success rounded-pill">${Math.round(strength.score)}%</span>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                <strong style="color: #333;">${strength.name}</strong>
                                <p class="mb-0 small" style="color: #666;">${strength.description}</p>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Áreas de mejora
            if (analysis.improvement_areas && analysis.improvement_areas.length > 0) {
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #ffc107 !important;">
                            <div class="card-header" style="background: #fff3cd; color: #856404;">
                                <h6 class="mb-0"><i class="fas fa-target me-2"></i>Áreas de Mejora</h6>
                            </div>
                            <div class="card-body">
                `;
                
                analysis.improvement_areas.forEach(area => {
                    const priorityClass = area.priority === 'high' ? 'danger' : 'warning';
                    html += `
                        <div class="d-flex align-items-start mb-3">
                            <div class="flex-shrink-0">
                                <span class="badge bg-${priorityClass} rounded-pill">${Math.round(area.score)}%</span>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                <strong style="color: #333;">${area.name}</strong> 
                                <span class="badge bg-${priorityClass} ms-1">${area.priority}</span>
                                <p class="mb-0 small" style="color: #666;">${area.description}</p>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        // Función compacta para mostrar recomendaciones de forma simplificada
        function generateCompactRecommendationsHTML(recommendations) {
            if (!recommendations || recommendations.length === 0) return '';
            
            let html = `
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #007bff !important;">
                            <div class="card-header d-flex align-items-center justify-content-between" style="background: #cce7ff; color: #004085;">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <h6 class="mb-0">Plan de Desarrollo</h6>
                                </div>
                                <span class="badge bg-primary">${recommendations.length} items</span>
                            </div>
                            <div class="card-body">
            `;
            
            recommendations.forEach((rec, index) => {
                const recText = typeof rec === 'string' ? rec : rec.text || rec.description || '';
                if (recText.trim()) {
                    // Detectar si es un encabezado (contiene **)
                    if (recText.includes('**')) {
                        const cleanText = recText.replace(/\*\*/g, '');
                        if (cleanText.includes('🎯') || cleanText.includes('🚀')) {
                            html += `<div class="fw-bold text-primary mb-2 mt-3">${cleanText}</div>`;
                        } else {
                            html += `<div class="fw-bold text-dark mb-2">${cleanText}</div>`;
                        }
                    }
                    // Detectar si es una acción (empieza con ✓ o •)
                    else if (recText.startsWith('✓') || recText.startsWith('•')) {
                        html += `<div class="ms-3 mb-2"><span class="text-success fw-bold">${recText}</span></div>`;
                    }
                    // Texto normal no vacío
                    else if (recText.trim() !== '') {
                        html += `<div class="mb-1"><small>${recText}</small></div>`;
                    }
                }
            });
            
            html += `
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return html;
        }
















        // Generar HTML de respuestas
        function generateResponsesHTML(responses, assessmentId = null) {
            if (!responses || responses.length === 0) {
                return '<p class="text-muted">No hay respuestas detalladas disponibles.</p>';
            }
            
            // Usar función específica para evaluación "Preparación para crecer 2026"
            if (assessmentId === 6) {
                return generateGrowthPreparationResponsesHTML(responses);
            }
            
            // Lógica original para otras evaluaciones (sin modificar)
            let optionLabels, maxScore;
            
            // Etiquetas estándar para escala Likert de 5 puntos (evaluaciones originales)
            optionLabels = {
                1: 'Totalmente en desacuerdo',
                2: 'En desacuerdo', 
                3: 'Neutral',
                4: 'De acuerdo',
                5: 'Totalmente de acuerdo'
            };
            maxScore = 5;
            
            let html = '';
            responses.forEach((response, index) => {
                const selectedOption = response.selected_option || response.points || 0;
                const scoreClass = selectedOption >= 4 ? 'success' : 
                                  selectedOption === 3 ? 'warning' : 'danger';
                
                html += `
                    <div class="border-start border-3 border-primary ps-3 mb-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <strong>Pregunta ${index + 1}:</strong>
                                <p class="mb-1">${response.question_text}</p>
                                <small class="text-${scoreClass}">
                                    <i class="fas fa-check-circle me-1"></i>
                                    ${optionLabels[selectedOption] || response.answer_text || 'N/A'}
                                </small>
                            </div>
                            <span class="badge bg-${scoreClass} ms-2">${selectedOption}/${maxScore}</span>
                        </div>
                    </div>
                `;
            });
            return html;
        }
        
        function getCategoryType(title) {
            if (title.includes('Fortaleza') || title.includes('Excelente')) return 'strength';
            if (title.includes('General') || title.includes('Recomendación')) return 'general';
            if (title.includes('Recuerda') || title.includes('Final')) return 'final';
            return 'dimension';
        }
        
        function getCategoryIcon(title) {
            if (title.includes('Comunicación')) return 'fas fa-comments';
            if (title.includes('Derechos')) return 'fas fa-shield-alt';
            if (title.includes('Opiniones')) return 'fas fa-bullhorn';
            if (title.includes('Conflictos')) return 'fas fa-handshake';
            if (title.includes('Autoconfianza')) return 'fas fa-user-check';
            if (title.includes('Fortaleza')) return 'fas fa-star';
            if (title.includes('General')) return 'fas fa-clipboard-list';
            if (title.includes('Recuerda')) return 'fas fa-heart';
            return 'fas fa-lightbulb';
        }
        
        function getDimensionIcon(dimension) {
            const iconMap = {
                'comunicacion': 'fas fa-comments',
                'derechos': 'fas fa-shield-alt',
                'opiniones': 'fas fa-bullhorn',
                'conflictos': 'fas fa-handshake',
                'autoconfianza': 'fas fa-user-check',
                'general': 'fas fa-clipboard-list'
            };
            return iconMap[dimension] || 'fas fa-lightbulb';
        }
        
        function getCategoryClass(type, title) {
            if (title.includes('Fortaleza') || type === 'strength') return 'strengths-category';
            if (title.includes('General') || type === 'general') return 'general-recommendations';
            if (title.includes('Recuerda') || type === 'final') return 'final-message';
            return '';
        }
        
        function getPriorityIndicator(priority) {
            const priorityClass = `priority-${priority}`;
            return `<div class="priority-indicator ${priorityClass}"></div>`;
        }
        
        function extractScoreFromTitle(title) {
            const scoreMatch = title.match(/(\d+(?:\.\d+)?)%/);
            return scoreMatch ? parseFloat(scoreMatch[1]) : null;
        }

        // ========== FUNCIONES ESPECÍFICAS PARA EVALUACIÓN "PREPARACIÓN PARA CRECER 2026" ==========
        // CACHE BUSTER: 2025-10-12-17:35:00
        
        function getGrowthPreparationOptions(question) {
            console.log('🎯 === INICIO getGrowthPreparationOptions ===');
            console.log('🎯 Full question object:', JSON.stringify(question, null, 2));
            console.log('🔍 Question dimension EXACT:', `"${question?.dimension}"`);
            console.log('🔍 Question dimension length:', question?.dimension?.length);
            console.log('🔍 Question dimension type:', typeof question?.dimension);
            
            // Opciones específicas por dimensión para la evaluación de crecimiento
            const growthOptionsByDimension = {
                'Delegación': ['Todo depende de mí', 'Delego algo, pero sigo resolviendo mucho', 'Mi equipo opera sin mí'],
                'Estructura organizacional': ['Todo es improvisado', 'Algunas áreas tienen estructura', 'Todo está formalizado'],
                'Gestión del tiempo del dueño': ['> 8 h', '4–7 h', '< 4 h (más foco en estrategia)'],
                'Finanzas': ['No confío / errores frecuentes', 'Parcialmente actualizada', 'Confiable y oportuna'],
                'Crecimiento estratégico': ['Miedo de perder control', 'Quiero crecer pero no sé cómo', 'Preparado con estrategia'],
                'Bienestar personal': ['Agotado', 'Cansado pero motivado', 'Con energía y foco'],
                'Visión a futuro': ['Frustrado', 'Inquieto pero optimista', 'Orgulloso']
            };
            
            console.log('🔍 Available dimensions in code:', Object.keys(growthOptionsByDimension));
            console.log('🔍 Exact match test:', growthOptionsByDimension.hasOwnProperty(question?.dimension));
            
            // Probar también con trim por si hay espacios
            const cleanDimension = question?.dimension?.trim();
            console.log('🔍 Clean dimension:', `"${cleanDimension}"`);
            console.log('🔍 Clean match test:', growthOptionsByDimension.hasOwnProperty(cleanDimension));
            
            const options = growthOptionsByDimension[question?.dimension] || growthOptionsByDimension[cleanDimension] || ['Opción 1', 'Opción 2', 'Opción 3'];
            console.log('🎯 Final options returned:', options);
            console.log('🎯 === FIN getGrowthPreparationOptions ===');
            return options;
        }
        
        function generateGrowthPreparationResponsesHTML(responses) {
            console.log('🔍 generateGrowthPreparationResponsesHTML - responses count:', responses ? responses.length : 0);
            
            if (!responses || responses.length === 0) {
                console.log('⚠️ No responses available');
                return '<div class="alert alert-warning">No hay respuestas detalladas disponibles.</div>';
            }

            // Mapeo de question_id a dimensión para "Preparación para crecer 2026"
            const questionIdToDimension = {
                71: "Delegación",
                72: "Estructura organizacional", 
                73: "Gestión del tiempo del dueño",
                74: "Finanzas",
                75: "Crecimiento estratégico",
                76: "Bienestar personal",
                77: "Visión a futuro"
            };
            
            // Opciones específicas por dimensión
            const growthLabelsByDimension = {
                'Delegación': {1: 'Todo depende de mí', 2: 'Delego algo, pero sigo resolviendo mucho', 3: 'Mi equipo opera sin mí'},
                'Estructura organizacional': {1: 'Todo es improvisado', 2: 'Algunas áreas tienen estructura', 3: 'Todo está formalizado'},
                'Gestión del tiempo del dueño': {1: '> 8 h', 2: '4–7 h', 3: '< 4 h (más foco en estrategia)'},
                'Finanzas': {1: 'No confío / errores frecuentes', 2: 'Parcialmente actualizada', 3: 'Confiable y oportuna'},
                'Crecimiento estratégico': {1: 'Miedo de perder control', 2: 'Quiero crecer pero no sé cómo', 3: 'Preparado con estrategia'},
                'Bienestar personal': {1: 'Agotado', 2: 'Cansado pero motivado', 3: 'Con energía y foco'},
                'Visión a futuro': {1: 'Frustrado', 2: 'Inquieto pero optimista', 3: 'Orgulloso'}
            };
            
            let html = '';
            responses.forEach((response, index) => {
                // Obtener la dimensión desde el mapeo usando question_id
                const dimension = questionIdToDimension[response.question_id] || response.dimension || 'Dimensión desconocida';
                const dimensionLabels = growthLabelsByDimension[dimension] || {1: 'Opción 1', 2: 'Opción 2', 3: 'Opción 3'};
                const selectedOption = response.selected_option || response.points || 1;
                const optionText = dimensionLabels[selectedOption] || 'N/A';
                
                const scoreClass = selectedOption === 3 ? 'success' : 
                                  selectedOption === 2 ? 'warning' : 'danger';
                
                html += `
                    <div class="border-start border-3 border-primary ps-3 mb-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <strong>${dimension}:</strong>
                                <p class="mb-1">${response.question_text}</p>
                                <small class="text-${scoreClass}">
                                    <i class="fas fa-check-circle me-1"></i>
                                    ${optionText}
                                </small>
                            </div>
                            <span class="badge bg-${scoreClass} ms-2">${selectedOption}/3</span>
                        </div>
                    </div>
                `;
            });
            
            console.log('✅ Generated responses HTML for', responses.length, 'items');
            return html;
        }
        
        function getGrowthPreparationLevelFromScore(score) {
            // Sistema de semáforo basado en porcentajes específicos
            if (score <= 30) {
                return "Alta dependencia (Rojo)";
            } else if (score <= 70) {
                return "En progreso (Amarillo)";
            } else {
                return "Preparado (Verde)";
            }
        }
        
        function generateGrowthPreparationLayout(data, evaluation, dimensionalScores) {
            const score = Math.round(data.score || evaluation.score);
            const resultText = data.result_text || evaluation.result_text || '';
            
            // Determinar el resultado basado en el puntaje
            let resultLevel, resultColor, resultIcon, respuestasC;
            if (score <= 30) {
                resultLevel = "Alta dependencia (Rojo)";
                resultColor = "#dc3545";
                resultIcon = "fas fa-exclamation-triangle";
                respuestasC = "0-2";
            } else if (score <= 70) {
                resultLevel = "En progreso (Amarillo)";
                resultColor = "#ffc107";
                resultIcon = "fas fa-clock";
                respuestasC = "3-4";
            } else {
                resultLevel = "Preparado (Verde)";
                resultColor = "#28a745";
                resultIcon = "fas fa-check-circle";
                respuestasC = "5-7";
            }
            
            return `
                <!-- Tu resultado destacado -->
                <div class="tu-resultado mb-4 p-4" style="background: ${resultColor} !important; color: white !important; border-radius: 15px; text-align: center; box-shadow: 0 6px 12px rgba(0,0,0,0.1);">
                    <h4 style="color: white !important; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5) !important;">
                        <i class="${resultIcon} me-2" style="color: white !important;"></i>
                        <span style="color: white !important; text-shadow: 2px 2px 4px rgba(0,0,0,0.5) !important;">${resultLevel}</span>
                    </h4>
                    <p style="margin: 0; font-size: 1.2em; line-height: 1.5; font-weight: 500; color: white !important;">
                        ${resultText.split(':')[1] ? resultText.split(':')[1].trim().split('\\n\\n')[0] : resultText.split('\\n\\n')[0]}
                    </p>
                </div>

                <!-- CTA Momento Clave -->
                <div class="cta-final mb-4">
                    <div class="card" style="background: #f8f9fa; border: none; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div class="card-body text-center" style="padding: 30px;">
                            <h4 style="color: #333; margin-bottom: 20px;">
                                <i class="fas fa-gift me-2" style="color: #4facfe;"></i>
                                Momento Clave para Tu Crecimiento
                            </h4>
                            <p style="color: #333; font-size: 1.1em; line-height: 1.6; margin-bottom: 25px; font-weight: 500;">
                                ✨ "Tu resultado muestra que este es el momento clave para ti. Por eso quiero regalarte una sesión gratuita de 30 min, donde veremos cómo preparar tu negocio en este último trimestre y que el 2026 sea el año en que veas realizados tus sueños de crecimiento."
                            </p>
                            
                            <!-- Dropdown para opciones de contacto -->
                            <div class="dropdown">
                                <button class="btn btn-light btn-lg dropdown-toggle" type="button" id="contactDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="padding: 12px 30px; border-radius: 25px; font-weight: bold; color: #333;">
                                    <i class="fas fa-calendar-plus me-2"></i>
                                    Agendar Sesión Gratuita
                                </button>
                                <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="contactDropdown" style="border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); min-width: 280px;">
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center py-3" href="https://wa.me/56994896670?text=Hola%2C%20me%20gustar%C3%ADa%20agendar%20una%20sesi%C3%B3n%20gratuita%20de%2030%20min%20para%20preparar%20mi%20negocio%20para%20el%202026" target="_blank" style="border-radius: 10px; margin: 5px;">
                                            <i class="fab fa-whatsapp me-3" style="color: #25D366; font-size: 1.2em;"></i>
                                            <div>
                                                <strong>WhatsApp</strong>
                                                <br><small class="text-muted">+56 9 9489 6670</small>
                                            </div>
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center py-3" href="mailto:coach@assessment.com?subject=Sesión%20Gratuita%20-%20Preparación%202026&body=Hola%2C%0A%0AMe%20gustar%C3%ADa%20agendar%20una%20sesi%C3%B3n%20gratuita%20de%2030%20minutos%20para%20preparar%20mi%20negocio%20para%20el%202026.%0A%0AGracias." style="border-radius: 10px; margin: 5px;">
                                            <i class="fas fa-envelope me-3" style="color: #0ea5e9; font-size: 1.2em;"></i>
                                            <div>
                                                <strong>Email</strong>
                                                <br><small class="text-muted">Enviar correo al coach</small>
                                            </div>
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center py-3" href="tel:+56994896670" style="border-radius: 10px; margin: 5px;">
                                            <i class="fas fa-phone me-3" style="color: #10b981; font-size: 1.2em;"></i>
                                            <div>
                                                <strong>Llamada</strong>
                                                <br><small class="text-muted">+56 9 9489 6670</small>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Análisis por Dimensiones -->
                <div class="row mb-4">
                    <div class="col-lg-6">
                        <div class="card h-100" style="border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div class="card-header" style="background: #667eea; color: white;">
                                <h5 style="margin: 0; color: white;">
                                    <i class="fas fa-chart-radar me-2"></i>
                                    Radar de Dimensiones Empresariales
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="radar-chart-container" style="position: relative; height: 300px;">
                                    <canvas id="growthRadarChart" style="max-width: 100%; height: auto;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card h-100" style="border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div class="card-header" style="background: #764ba2; color: white;">
                                <h5 style="margin: 0; color: white;">
                                    <i class="fas fa-tasks me-2"></i>
                                    Puntuación por Dimensión
                                </h5>
                            </div>
                            <div class="card-body">
                                ${generateGrowthDimensionalScores(dimensionalScores)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateGrowthDimensionalScores(dimensionalScores) {
            if (!dimensionalScores) return '<p class="text-muted">No hay puntuaciones dimensionales disponibles.</p>';
            
            let html = '';
            Object.entries(dimensionalScores).forEach(([dimension, score]) => {
                // Calcular porcentaje correcto: (score - 1) / (3 - 1) * 100 = (score - 1) / 2 * 100
                const percentage = Math.round(((score - 1) / 2) * 100);
                let scoreColor, scoreIcon, scoreBadge;
                
                if (score >= 2.5) {
                    scoreColor = '#28a745';
                    scoreIcon = 'fas fa-check-circle';
                    scoreBadge = 'Verde';
                } else if (score >= 1.5) {
                    scoreColor = '#ffc107';
                    scoreIcon = 'fas fa-clock';
                    scoreBadge = 'Amarillo';
                } else {
                    scoreColor = '#dc3545';
                    scoreIcon = 'fas fa-exclamation-triangle';
                    scoreBadge = 'Rojo';
                }
                
                html += `
                    <div class="dimension-score mb-4" style="padding: 15px; border-left: 4px solid ${scoreColor}; background: #f8f9fa; border-radius: 0 8px 8px 0;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <strong style="color: #333; font-size: 1.05em;">${dimension}</strong>
                            <div class="d-flex align-items-center">
                                <span class="badge me-2" style="background: ${scoreColor}; color: white; padding: 4px 8px; border-radius: 12px;">
                                    ${scoreBadge}
                                </span>
                                <span style="color: ${scoreColor}; font-weight: bold;">
                                    <i class="${scoreIcon} me-1"></i>
                                    ${score}/3
                                </span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="progress flex-grow-1 me-3" style="height: 15px; background: #e9ecef; border-radius: 8px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);">
                                <div class="progress-bar" style="background: linear-gradient(90deg, ${scoreColor}, ${scoreColor}cc) !important; width: ${percentage}%; border-radius: 8px; transition: width 0.8s ease;">
                                </div>
                            </div>
                            <small style="color: #666; font-weight: 600; min-width: 40px; font-size: 0.9em;">${percentage}%</small>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        function createGrowthRadarChart(dimensionalScores) {
            if (!dimensionalScores) return;
            
            const canvas = document.getElementById('growthRadarChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Obtener dimensiones de la pantalla para optimizar visualización
            const isMobile = window.innerWidth <= 768;
            const isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
            
            // Mapear nombres largos a versiones más cortas para móviles
            const dimensionLabels = Object.keys(dimensionalScores).map(key => {
                const shortLabels = {
                    'Delegación': isMobile ? 'Delegación' : 'Delegación',
                    'Estructura organizacional': isMobile ? 'Estructura' : isTablet ? 'Estructura Org.' : 'Estructura organizacional',
                    'Gestión del tiempo del dueño': isMobile ? 'Tiempo' : isTablet ? 'Gestión Tiempo' : 'Gestión del tiempo del dueño',
                    'Finanzas': 'Finanzas',
                    'Crecimiento estratégico': isMobile ? 'Estrategia' : isTablet ? 'Crecimiento' : 'Crecimiento estratégico',
                    'Bienestar personal': isMobile ? 'Bienestar' : 'Bienestar personal',
                    'Visión a futuro': isMobile ? 'Visión' : 'Visión a futuro'
                };
                return shortLabels[key] || key;
            });
            
            const values = Object.values(dimensionalScores);
            
            if (window.growthRadarChartInstance) {
                window.growthRadarChartInstance.destroy();
            }
            
            window.growthRadarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: dimensionLabels,
                    datasets: [{
                        label: 'Preparación para Crecer',
                        data: values,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: isMobile ? 20 : 10,
                            bottom: isMobile ? 20 : 10,
                            left: isMobile ? 10 : 5,
                            right: isMobile ? 10 : 5
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 3,
                            min: 0,
                            ticks: {
                                stepSize: 1,
                                color: '#666',
                                font: {
                                    size: isMobile ? 10 : 12
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            angleLines: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            pointLabels: {
                                font: {
                                    size: isMobile ? 11 : isTablet ? 12 : 14,
                                    weight: 'bold'
                                },
                                color: '#333',
                                padding: isMobile ? 15 : 10
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    // Mostrar el nombre completo en el tooltip
                                    const index = tooltipItems[0].dataIndex;
                                    const fullNames = Object.keys(dimensionalScores);
                                    return fullNames[index];
                                }
                            }
                        }
                    }
                }
            });
            
            // Agregar estilos CSS básicos para barras de progreso y radar responsive
            if (!document.getElementById('growth-progress-styles')) {
                const style = document.createElement('style');
                style.id = 'growth-progress-styles';
                style.innerHTML = `
                    .dimension-score .progress-bar {
                        border-radius: 8px;
                    }
                    
                    /* Estilos responsive para el radar de crecimiento */
                    .radar-chart-container {
                        overflow: hidden;
                    }
                    
                    @media (max-width: 768px) {
                        .radar-chart-container {
                            height: 280px !important;
                            padding: 10px;
                        }
                        
                        #growthRadarChart {
                            max-height: 260px;
                        }
                    }
                    
                    @media (max-width: 480px) {
                        .radar-chart-container {
                            height: 250px !important;
                            padding: 5px;
                        }
                        
                        #growthRadarChart {
                            max-height: 230px;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Agregar listener para redimensionamiento de pantalla
            if (!window.growthRadarResizeListener) {
                window.growthRadarResizeListener = function() {
                    if (window.growthRadarChartInstance && dimensionalScores) {
                        // Recrear el gráfico con las nuevas dimensiones
                        setTimeout(() => {
                            createGrowthRadarChart(dimensionalScores);
                        }, 100);
                    }
                };
                window.addEventListener('resize', window.growthRadarResizeListener);
            }
        }
        
        // ========== FIN FUNCIONES ESPECÍFICAS PREPARACIÓN PARA CRECER 2026 ==========

        function getAssertiveLevelFromScore(score) {
            if (score >= 85) return 'Muy Asertivo';
            if (score >= 70) return 'Asertivo';
            if (score >= 50) return 'Moderadamente Asertivo';
            return 'Poco Asertivo';
        }

        function getDiscLevelFromScore(score) {
            // Para DISC, el perfil se basa en las dimensiones dominantes
            // Aquí usamos un enfoque simplificado basado en el score general
            if (score >= 80) return 'Perfil Altamente Definido';
            if (score >= 60) return 'Perfil Moderadamente Definido';
            if (score >= 40) return 'Perfil Equilibrado';
            return 'Perfil en Desarrollo';
        }

        function getEmotionalIntelligenceLevelFromScore(score) {
            if (score >= 85) return 'Muy Alta';
            if (score >= 70) return 'Alta';
            if (score >= 55) return 'Moderada';
            if (score >= 40) return 'Baja';
            return 'Muy Baja';
        }

        function getTeamworkLevelFromScore(score) {
            if (score >= 85) return 'Colaborador Excepcional';
            if (score >= 70) return 'Colaborador Efectivo';
            if (score >= 55) return 'Colaborador Competente';
            if (score >= 40) return 'Colaborador en Desarrollo';
            return 'Necesita Desarrollar Habilidades';
        }

        function getDimensionDescription(dimension, score) {
            const descriptions = {
                'comunicacion': score >= 70 ? 'Excelente comunicación interpersonal' : 'Oportunidad de mejorar la comunicación',
                'derechos': score >= 70 ? 'Sabe defender sus derechos apropiadamente' : 'Necesita fortalecer la defensa de derechos',
                'opiniones': score >= 70 ? 'Expresa opiniones con confianza' : 'Puede mejorar la expresión de opiniones',
                'conflictos': score >= 70 ? 'Maneja conflictos efectivamente' : 'Requiere desarrollo en manejo de conflictos',
                'autoconfianza': score >= 70 ? 'Alta confianza en sí mismo/a' : 'Oportunidad de fortalecer autoconfianza'
            };
            return descriptions[dimension] || 'Área de desarrollo personal';
        }

        function formatDate(dateString) {
            try {
                // Crear fecha asumiendo que viene en UTC desde el backend
                const date = new Date(dateString + (dateString.includes('Z') ? '' : 'Z'));
                
                // Convertir a zona horaria de Santiago de Chile con formato 24 horas
                return date.toLocaleDateString('es-CL', {
                    timeZone: 'America/Santiago',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            } catch (e) {
                return dateString;
            }
        }

        // Refresh dashboard
        async function refreshDashboard() {
            try {
                await Promise.all([
                    loadDashboardSummary(),
                    loadEvaluations(),
                    loadTasks()
                    // Nota: loadContent() se carga solo cuando se activa la pestaña de contenido
                ]);
                
            } catch (error) {
                console.error('Error actualizando dashboard:', error);
                showToast('Error actualizando dashboard', 'error');
            }
        }

        // Variable global para almacenar el gráfico radar
        let radarChart = null;

        function createRadarChart(dimensionalScores, isDiscAssessment = false, isEmotionalIntelligenceAssessment = false) {
            console.log('🎯 RADAR DEBUG: Function called with params:', {
                isDiscAssessment,
                isEmotionalIntelligenceAssessment,
                dimensionalScores,
                hasCanvas: !!document.getElementById('radarChart')
            });

            const ctx = document.getElementById('radarChart');
            if (!ctx) {
                console.error('❌ RADAR ERROR: Canvas element with id "radarChart" not found');
                return;
            }
            
            if (!dimensionalScores) {
                console.error('❌ RADAR ERROR: dimensionalScores is null or undefined');
                return;
            }

            console.log('✅ RADAR DEBUG: Canvas found, creating chart with scores:', dimensionalScores);

            // Destruir gráfico existente si existe
            if (radarChart) {
                radarChart.destroy();
            }

            // Configurar dimensiones y datos según el tipo de evaluación
            let labels, dataValues, chartLabel;
            
            if (isDiscAssessment) {
                console.log('📊 RADAR DEBUG: Using DISC configuration');
                // Dimensiones DISC
                labels = [
                    'Dominante',
                    'Influyente', 
                    'Estable',
                    'Concienzudo'
                ];
                
                dataValues = [
                    dimensionalScores.Dominante || dimensionalScores.dominante || 0,
                    dimensionalScores.Influyente || dimensionalScores.influyente || 0,
                    dimensionalScores.Estable || dimensionalScores.estable || 0,
                    dimensionalScores.Concienzudo || dimensionalScores.concienzudo || 0
                ];
                
                chartLabel = 'Perfil DISC';
            } else if (isEmotionalIntelligenceAssessment) {
                console.log('🧠 RADAR DEBUG: Using Emotional Intelligence configuration');
                // Dimensiones Inteligencia Emocional
                labels = [
                    'Autoconciencia',
                    'Autorregulación',
                    'Automotivación',
                    'Empatía',
                    'Habilidades Sociales'
                ];

                dataValues = [
                    dimensionalScores.Autoconciencia || dimensionalScores.autoconciencia || 0,
                    dimensionalScores.Autorregulación || dimensionalScores.autorregulacion || 0,
                    dimensionalScores.Automotivación || dimensionalScores.automotivacion || 0,
                    dimensionalScores.Empatía || dimensionalScores.empatia || 0,
                    dimensionalScores['Habilidades Sociales'] || dimensionalScores.habilidades_sociales || 0
                ];
                
                chartLabel = 'Perfil de Inteligencia Emocional';
                console.log('🧠 RADAR DEBUG: IE data values:', dataValues);
            } else {
                console.log('💬 RADAR DEBUG: Using Assertiveness configuration');
                // Dimensiones Asertividad (configuración original)
                labels = [
                    'Comunicación',
                    'Derechos',
                    'Opiniones',
                    'Conflictos',
                    'Autoconfianza'
                ];

                dataValues = [
                    dimensionalScores.comunicacion || 0,
                    dimensionalScores.derechos || 0,
                    dimensionalScores.opiniones || 0,
                    dimensionalScores.conflictos || 0,
                    dimensionalScores.autoconfianza || 0
                ];
                
                chartLabel = 'Nivel de Asertividad';
            }

            console.log('📊 RADAR DEBUG: Final chart config:', {
                labels,
                dataValues,
                chartLabel
            });

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: chartLabel,
                        data: dataValues,
                        backgroundColor: 'rgba(98, 130, 227, 0.2)',
                        borderColor: 'rgba(98, 130, 227, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(98, 130, 227, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${Math.round(context.raw)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            min: 0,
                            ticks: {
                                stepSize: 20,
                                callback: function(value) {
                                    return value + '%';
                                },
                                color: '#6B8DA6',
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                color: 'rgba(107, 141, 166, 0.2)'
                            },
                            angleLines: {
                                color: 'rgba(107, 141, 166, 0.2)'
                            },
                            pointLabels: {
                                color: '#243447',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.2
                        }
                    }
                }
            });
            
            console.log('✅ RADAR DEBUG: Chart created successfully!');
        }

        function getStatusLabel(status) {
            const labels = {
                'pending': 'Pendiente',
                'in_progress': 'En Progreso',
                'completed': 'Completada',
                'cancelled': 'Cancelada'
            };
            return labels[status] || status;
        }

        function getDimensionLabel(key) {
            const labels = {
                'comunicacion': 'Comunicación Directa',
                'derechos': 'Defensa de Derechos',
                'opiniones': 'Expresión de Opiniones',
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza'
            };
            return labels[key] || key;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Sidebar click events
            document.querySelectorAll('.list-group-item[data-tab]').forEach(item => {
                item.addEventListener('click', function (event) {
                    const target = this.getAttribute('data-tab');
                    
                    // Load data when tabs are activated
                    if (target === 'tasks') {
                        loadTasks(); // Siempre cargar tareas para mantener datos actualizados
                    } else if (target === 'content') {
                        // Solo cargar contenido si no se ha cargado ya o si está vacío
                        if (!contentData || contentData.length === 0) {
                            loadContent();
                        }
                    } else if (target === 'progress') {
                        loadEvaluationHistory();
                    }
                });
            });

            // Modal close event listener
            const evaluationDetailsModal = document.getElementById('evaluationDetailsModal');
            if (evaluationDetailsModal) {
                evaluationDetailsModal.addEventListener('hidden.bs.modal', function () {
                    console.log('Modal cerrado - restableciendo estado del dashboard');
                    
                    // Reset assessment state completely
                    isAssessmentActive = false;
                    
                    // Ensure assessment tab is hidden
                    const assessmentTab = document.getElementById('assessment-tab-item');
                    if (assessmentTab) {
                        assessmentTab.style.display = 'none';
                    }
                    
                    // Ensure assessment container is visible
                    const assessmentContainer = document.getElementById('assessmentContainer');
                    if (assessmentContainer) {
                        assessmentContainer.style.display = 'block';
                    }
                    
                    // Switch to evaluations tab to ensure proper state
                    showTab('evaluations');
                    
                    // Clear cached data
                    window.lastEvaluationId = null;
                    window.lastAssessmentData = null;
                    
                    // Force remove any modal backdrop that might be stuck
                    setTimeout(() => {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        backdrops.forEach(backdrop => {
                            console.log('Removing stuck backdrop:', backdrop);
                            backdrop.remove();
                        });
                        
                        // Remove modal-open class from body that might block interactions
                        document.body.classList.remove('modal-open');
                        
                        // Reset body styles that might affect scrolling/interaction
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                        
                        // Force refresh dashboard to ensure all elements are clickable
                        refreshDashboard();
                        
                        console.log('Dashboard completamente desbloqueado');
                    }, 100);
                    
                    console.log('Estado del dashboard restablecido completamente');
                });
            }

            // Setup content tab listeners
            setupContentTabListeners();
            
            // Setup document filters
            setupDocumentFilters();
        }

        // Setup content tab event listeners
        function setupContentTabListeners() {
            // Event listeners para las pestañas internas de contenido
            const documentsTab = document.getElementById('documents-tab');
            if (documentsTab) {
                documentsTab.addEventListener('shown.bs.tab', function() {
                    debugLog('📄 Pestaña de documentos activada');
                    // Cargar documentos si no están cargados recientemente
                    if (!documentsData || documentsData.length === 0 || 
                        !window.lastDocumentLoad || (Date.now() - window.lastDocumentLoad > 300000)) {
                        loadDocuments();
                    } else {
                        // Si ya están cargados, solo renderizar de nuevo
                        renderDocuments();
                    }
                });
                
                // También cargar en click para compatibilidad
                documentsTab.addEventListener('click', function() {
                    setTimeout(() => {
                        if (!documentsData || documentsData.length === 0 || 
                            !window.lastDocumentLoad || (Date.now() - window.lastDocumentLoad > 300000)) {
                            loadDocuments();
                        }
                    }, 100);
                });
            }
        }

        // ===== DOCUMENT MANAGEMENT FUNCTIONS =====
        
        let documentsData = [];
        let isLoadingDocuments = false;
        let filteredDocuments = [];

        // Load documents from server
        async function loadDocuments() {
            if (isLoadingDocuments) {
                debugLog('⏳ LoadDocuments ya en progreso, omitiendo llamada duplicada');
                return;
            }
            
            isLoadingDocuments = true;
            debugLog('📄 Cargando documentos...');
            
            // Mostrar spinner de carga
            const documentsContainer = document.getElementById('documentsContainer');
            if (documentsContainer) {
                documentsContainer.innerHTML = `
                    <div class="loading-spinner text-center py-4">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Cargando documentos...</span>
                        </div>
                        <p class="mt-2 text-muted">Cargando documentos...</p>
                    </div>
                `;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/documents`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                documentsData = data.documents || [];
                filteredDocuments = [...documentsData];
                window.lastDocumentLoad = Date.now();
                
                debugLog('📄 Documentos cargados:', {
                    total: documentsData.length,
                    documents: documentsData.map(d => ({
                        id: d.id,
                        title: d.title,
                        category: d.category,
                        priority: d.priority
                    }))
                });
                
                renderDocuments();
                
            } catch (error) {
                debugLog('❌ Error cargando documentos:', error);
                const documentsContainer = document.getElementById('documentsContainer');
                if (documentsContainer) {
                    documentsContainer.innerHTML = 
                        '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>Error cargando documentos. Inténtalo de nuevo.</div>';
                }
            } finally {
                isLoadingDocuments = false;
            }
        }

        // Render documents grid
        function renderDocuments() {
            const container = document.getElementById('documentsGrid');
            const filtersContainer = document.getElementById('documentFilters');
            const documentsContainer = document.getElementById('documentsContainer');
            
            if (!documentsData || documentsData.length === 0) {
                if (documentsContainer) {
                    documentsContainer.innerHTML = 
                        '<div class="empty-state text-center py-5"><i class="fas fa-folder-open fa-3x text-muted mb-3"></i><h5 class="text-muted">No tienes documentos asignados</h5><p class="text-muted">Tu coach aún no te ha enviado documentos.</p></div>';
                }
                if (filtersContainer) {
                    filtersContainer.style.display = 'none';
                }
                return;
            }
            
            // Ocultar el contenedor de loading y mostrar el grid
            if (documentsContainer) {
                documentsContainer.innerHTML = '';
            }
            
            // Mostrar filtros si hay documentos
            if (filtersContainer) {
                filtersContainer.style.display = 'block';
            }
            
            let html = '';
            
            filteredDocuments.forEach(doc => {
                const formatDate = (dateString) => {
                    if (!dateString) return 'Sin fecha';
                    return new Date(dateString).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                };
                
                const getPriorityBadge = (priority) => {
                    const badges = {
                        'urgente': 'bg-danger',
                        'alta': 'bg-warning text-dark',
                        'normal': 'bg-secondary'
                    };
                    return badges[priority] || 'bg-secondary';
                };
                
                const getCategoryIcon = (category) => {
                    const icons = {
                        'ejercicios': 'fas fa-dumbbell',
                        'teoria': 'fas fa-book',
                        'evaluacion': 'fas fa-clipboard-check',
                        'recursos': 'fas fa-tools',
                        'tarea': 'fas fa-tasks',
                        'referencias': 'fas fa-bookmark'
                    };
                    return icons[category] || 'fas fa-file';
                };
                
                const getFileTypeIcon = (filename) => {
                    if (!filename) return 'fas fa-file';
                    const ext = filename.split('.').pop().toLowerCase();
                    const icons = {
                        'pdf': 'fas fa-file-pdf text-danger',
                        'doc': 'fas fa-file-word text-primary',
                        'docx': 'fas fa-file-word text-primary',
                        'jpg': 'fas fa-image text-success',
                        'jpeg': 'fas fa-image text-success',
                        'png': 'fas fa-image text-success',
                        'gif': 'fas fa-image text-success',
                        'mp4': 'fas fa-file-video text-warning',
                        'mp3': 'fas fa-file-audio text-info',
                        'xlsx': 'fas fa-file-excel text-success',
                        'pptx': 'fas fa-file-powerpoint text-warning'
                    };
                    return icons[ext] || 'fas fa-file';
                };
                
                html += `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card document-card h-100 shadow-sm">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="d-flex align-items-center flex-grow-1 me-2">
                                        <i class="${getCategoryIcon(doc.category)} me-2 text-primary flex-shrink-0"></i>
                                        <span class="fw-bold text-truncate" title="${escapeHtml(doc.title)}">${escapeHtml(doc.title)}</span>
                                    </div>
                                    <span class="badge ${getPriorityBadge(doc.priority)} flex-shrink-0">${doc.priority}</span>
                                </div>
                            </div>
                            <div class="card-body d-flex flex-column">
                                ${doc.description ? `<p class="card-text text-muted small mb-3">${escapeHtml(doc.description)}</p>` : ''}
                                
                                <div class="document-files mb-3 flex-grow-1">
                                    ${doc.files && doc.files.length > 0 ? doc.files.map(file => `
                                        <div class="d-flex align-items-center justify-content-between p-2 border rounded mb-2 bg-light">
                                            <div class="d-flex align-items-center flex-grow-1 me-2 min-width-0">
                                                <i class="${getFileTypeIcon(file.filename)} me-2 flex-shrink-0"></i>
                                                <span class="text-truncate small" title="${escapeHtml(file.filename)}">${escapeHtml(file.filename)}</span>
                                            </div>
                                            <div class="btn-group btn-group-sm flex-shrink-0">
                                                <button class="btn btn-outline-primary btn-sm" 
                                                        onclick="previewDocument('${doc.id}', '${file.id}', '${escapeHtml(file.filename)}')"
                                                        title="Vista previa">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-outline-success btn-sm" 
                                                        onclick="downloadDocument('${doc.id}', '${file.id}', '${escapeHtml(file.filename)}')"
                                                        title="Descargar">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                            </div>
                                        </div>
                                    `).join('') : '<p class="text-muted small text-center py-3"><i class="fas fa-folder-open me-1"></i>No hay archivos adjuntos</p>'}
                                </div>
                                
                                <div class="mt-auto">
                                    <div class="d-flex justify-content-between align-items-center text-muted small">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-calendar me-1"></i>
                                            <span>${formatDate(doc.uploaded_at)}</span>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-user me-1"></i>
                                            <span class="text-truncate" title="${escapeHtml(doc.uploaded_by || 'Coach')}">${escapeHtml(doc.uploaded_by || 'Coach')}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (container) {
                container.innerHTML = html;
            }
        }

        // Preview document
        function previewDocument(documentId, fileId, filename) {
            debugLog('🔍 Vista previa de documento:', {documentId, fileId, filename});
            
            const fileExtension = filename.split('.').pop().toLowerCase();
            const previewUrl = `${API_BASE_URL}/api/coachee/documents/${documentId}/files/${fileId}/preview`;
            
            let modalContent = '';
            
            if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) {
                // Preview para imágenes
                modalContent = `
                    <div class="text-center">
                        <img src="${previewUrl}" class="img-fluid" alt="${escapeHtml(filename)}" 
                             style="max-height: 70vh; object-fit: contain;">
                    </div>
                `;
            } else if (fileExtension === 'pdf') {
                // Preview para PDFs
                modalContent = `
                    <div style="height: 70vh;">
                        <iframe src="${previewUrl}" width="100%" height="100%" frameborder="0">
                            <p>No se puede mostrar el PDF. <a href="${previewUrl}" target="_blank">Abrir en nueva ventana</a></p>
                        </iframe>
                    </div>
                `;
            } else {
                // Preview genérico para otros tipos de archivo
                modalContent = `
                    <div class="text-center p-4">
                        <i class="fas fa-file fa-5x text-muted mb-3"></i>
                        <h5>${escapeHtml(filename)}</h5>
                        <p class="text-muted">Vista previa no disponible para este tipo de archivo</p>
                        <button class="btn btn-primary" onclick="downloadDocument('${documentId}', '${fileId}', '${filename}')">
                            <i class="fas fa-download me-2"></i>Descargar archivo
                        </button>
                    </div>
                `;
            }
            
            const modalHtml = `
                <div class="modal fade" id="documentPreviewModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-eye me-2"></i>
                                    Vista previa: ${escapeHtml(filename)}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ${modalContent}
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-success" onclick="downloadDocument('${documentId}', '${fileId}', '${filename}')">
                                    <i class="fas fa-download me-2"></i>Descargar
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Eliminar modal anterior si existe
            const existingModal = document.getElementById('documentPreviewModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('documentPreviewModal'));
            modal.show();
            
            // Limpiar cuando se cierre
            document.getElementById('documentPreviewModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // Download document
        function downloadDocument(documentId, fileId, filename) {
            debugLog('⬇️ Descargando documento:', {documentId, fileId, filename});
            
            const downloadUrl = `${API_BASE_URL}/api/coachee/documents/${documentId}/files/${fileId}/download`;
            
            // Crear elemento de descarga temporal
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = filename;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Filter documents
        function filterDocuments() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const searchTerm = document.getElementById('searchDocuments').value.toLowerCase();
            
            filteredDocuments = documentsData.filter(doc => {
                const matchesCategory = !categoryFilter || doc.category === categoryFilter;
                const matchesPriority = !priorityFilter || doc.priority === priorityFilter;
                const matchesSearch = !searchTerm || 
                    doc.title.toLowerCase().includes(searchTerm) ||
                    (doc.description && doc.description.toLowerCase().includes(searchTerm));
                
                return matchesCategory && matchesPriority && matchesSearch;
            });
            
            renderDocuments();
        }

        // Setup document filters
        function setupDocumentFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const searchInput = document.getElementById('searchDocuments');
            
            if (categoryFilter) {
                categoryFilter.addEventListener('change', filterDocuments);
            }
            
            if (priorityFilter) {
                priorityFilter.addEventListener('change', filterDocuments);
            }
            
            if (searchInput) {
                searchInput.addEventListener('input', filterDocuments);
            }
        }

        // Initialize application
        async function initializeApp() {
            debugLog('🚀 Inicializando dashboard de coachee...');
            
            // TEST BÁSICO DE CHART.JS ELIMINADO POR PETICIÓN DEL USUARIO
            // debugLog('🔵 Ejecutando test básico de Chart.js...');
            // setTimeout(createBasicTestChart, 100); // ELIMINADO
            
            try {
                // Create animated particles
                createParticles();
                
                // Setup event listeners
                setupEventListeners();
                
                // Setup content tab listeners
                setupContentTabListeners();
                
                // Inicializar sincronización de avatar
                setupAvatarSync();
                debugLog('🔄 Sistema de sincronización de avatar inicializado');
                
                // Load initial data
                debugLog('📊 Cargando perfil de usuario...');
                await loadUserProfile();
                
                debugLog('📊 Cargando resumen del dashboard...');
                await loadDashboardSummary();
                
                // Load data for active tab
                debugLog('📊 Cargando evaluaciones...');
                await loadEvaluations();
                
                debugLog('📊 Cargando tareas...');
                await loadTasks();
                
                debugLog('📊 Cargando historial de evaluaciones...');
                await loadEvaluationHistory();
                
                // GRÁFICO DE PRUEBA ELIMINADO POR PETICIÓN DEL USUARIO
                // debugLog('🔥 Creando gráfico de prueba...');
                // setTimeout(() => {
                //     renderTestProgressChart();
                // }, 1000); // Esperar 1 segundo para asegurar que todo esté cargado
                
                // Forzar actualización final del mensaje de bienvenida
                updateWelcomeMessage();
                
                debugLog('✅ Dashboard inicializado correctamente');
            } catch (error) {
                debugLog('❌ Error durante la inicialización del dashboard', error);
                console.error('Error en initializeApp:', error);
            }
        }
        
        // FUNCIÓN DE DEBUG TEMPORAL - Para ejecutar desde consola
        window.debugWelcomeMessage = function() {
            console.log('🔍 DEBUG Document ready state:', document.readyState);
            console.log('🔍 DEBUG All elements with id="welcomeMessage":', document.querySelectorAll('#welcomeMessage'));
            console.log('🔍 DEBUG All spans:', document.querySelectorAll('span').length);
            
            const welcomeEl = document.getElementById('welcomeMessage');
            console.log('🔍 DEBUG Element welcomeMessage:', welcomeEl);
            console.log('🔍 DEBUG Current text:', welcomeEl?.textContent);
            console.log('🔍 DEBUG Current user:', currentUser);
            
            // Buscar elementos similares
            const allSpans = document.querySelectorAll('span');
            console.log('🔍 DEBUG All spans content:');
            allSpans.forEach((span, i) => {
                if (span.textContent?.includes('Welcome')) {
                    console.log(`  Span ${i}:`, span.id, span.textContent, span);
                }
            });
            
            // Forzar actualización
            if (welcomeEl && currentUser?.full_name) {
                welcomeEl.textContent = currentUser.full_name;
                console.log('🔄 FORCED update to:', currentUser.full_name);
            } else {
                console.log('❌ Cannot update: element or user missing');
            }
        };

        // FUNCIÓN PARA FORZAR ACTUALIZACIÓN MANUAL DEL NOMBRE
        window.forceUpdateUserName = async function() {
            console.log('🔧 FORZANDO actualización del nombre de usuario...');
            
            try {
                // Intentar dashboard summary primero
                const response = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Data received:', data);
                    
                    if (data.success && data.summary?.coachee?.name) {
                        const userName = data.summary.coachee.name;
                        const welcomeText = userName;
                        const count = updateAllWelcomeMessages(welcomeText);
                        console.log(`✅ Actualizado ${count} elementos con: ${welcomeText}`);
                        return true;
                    }
                }
                
                console.log('❌ No se pudo obtener el nombre del usuario');
                return false;
                
            } catch (error) {
                console.error('❌ Error:', error);
                return false;
            }
        };

        // FUNCIÓN DE EMERGENCIA: Limpiar duplicados y actualizar
        window.fixWelcomeMessage = function() {
            // Obtener todos los elementos con id="welcomeMessage"
            const allElements = document.querySelectorAll('#welcomeMessage');
            console.log('🔍 Found', allElements.length, 'elements with id="welcomeMessage"');
            
            if (allElements.length > 1) {
                console.log('⚠️ Removing duplicates, keeping only the first one');
                // Mantener solo el primer elemento, eliminar el resto
                for (let i = 1; i < allElements.length; i++) {
                    allElements[i].remove();
                    console.log('🗑️ Removed duplicate element', i + 1);
                }
            }
            
            // Actualizar el elemento restante
            const finalElement = document.getElementById('welcomeMessage');
            if (finalElement) {
                finalElement.textContent = 'Welcome, test15!';
                console.log('✅ Updated final element:', finalElement.textContent);
                return true;
            }
            
            return false;
        };

        // FUNCIÓN PARA ACTUALIZAR TODOS LOS ELEMENTOS WELCOMEMESSAGE
        window.updateAllWelcomeMessages = function(message) {
            // Usar querySelectorAll para obtener TODOS los elementos
            const allWelcomeElements = document.querySelectorAll('#welcomeMessage');
            console.log('🔍 Found', allWelcomeElements.length, 'elements with id="welcomeMessage"');
            
            allWelcomeElements.forEach((element, index) => {
                element.textContent = message;
                console.log(`🔄 Updated element ${index + 1}:`, element);
            });
            
            return allWelcomeElements.length;
        };

        // FUNCIÓN PARA FORZAR ACTUALIZACIÓN CON DELAY
        window.forceUpdateWelcome = function() {
            setTimeout(() => {
                // Método 1: Por ID
                let welcomeEl = document.getElementById('welcomeMessage');
                
                // Método 2: Por selector CSS si no funciona ID
                if (!welcomeEl) {
                    welcomeEl = document.querySelector('#welcomeMessage');
                }
                
                // Método 3: Buscar en todos los spans que contengan "Welcome"
                if (!welcomeEl) {
                    const spans = document.querySelectorAll('span');
                    for (let span of spans) {
                        if (span.textContent && span.textContent.includes('Welcome')) {
                            welcomeEl = span;
                            console.log('🔍 Found welcome element via content search');
                            break;
                        }
                    }
                }
                
                if (welcomeEl) {
                    welcomeEl.textContent = 'Welcome, test15!';
                    console.log('🔄 FORCED update with delay successful');
                    console.log('🔄 Updated element:', welcomeEl);
                } else {
                    console.log('❌ Element still not found after delay and multiple methods');
                    
                    // Método 4: Crear el elemento si no existe
                    const h3 = document.querySelector('h3');
                    if (h3) {
                        h3.innerHTML = '<i class="fas fa-home me-2"></i><span id="welcomeMessage">Welcome, test15!</span>';
                        console.log('🔧 Created welcome element manually');
                    }
                }
            }, 2000); // Aumentar delay a 2 segundos
        };

        // Función para actualizar el mensaje de bienvenida
        function updateWelcomeMessage() {
            if (currentUser && currentUser.full_name) {
                const welcomeText = currentUser.full_name;
                const updatedCount = updateAllWelcomeMessages(welcomeText);
                console.log('🔄 Actualizados', updatedCount, 'elementos con mensaje forzado:', welcomeText);
            }
        }
        
        // Función para actualizar el avatar del header
        function updateHeaderAvatar(forceRefresh = false) {
            if (currentUser && currentUser.full_name) {
                const avatarElement = document.getElementById('headerAvatarDashboard');
                if (avatarElement) {
                    // Si hay avatar_url, mostrar imagen
                    if (currentUser.avatar_url) {
                        avatarElement.innerHTML = `<img src="${currentUser.avatar_url}" alt="${currentUser.full_name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                        console.log('✅ Avatar actualizado con imagen:', currentUser.avatar_url);
                    } else {
                        // Obtener iniciales del nombre
                        const nameParts = currentUser.full_name.trim().split(' ');
                        let initials = '';
                        if (nameParts.length >= 2) {
                            initials = nameParts[0].charAt(0) + nameParts[1].charAt(0);
                        } else {
                            initials = nameParts[0].charAt(0);
                        }
                        avatarElement.innerHTML = initials.toUpperCase();
                        console.log('✅ Avatar actualizado con iniciales:', initials);
                    }
                }
            }
        }
        
        // Sistema de sincronización de avatar entre pestañas
        function setupAvatarSync() {
            // Escuchar cambios en localStorage (cuando se actualiza en otra pestaña)
            window.addEventListener('storage', function(e) {
                if (e.key === 'avatarUpdated') {
                    console.log('🔄 Avatar actualizado en otra pestaña, recargando perfil...');
                    // Recargar perfil del usuario
                    fetch(`${API_BASE_URL}/api/coachee/profile`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success && data.profile) {
                                // Actualizar currentUser con el nuevo avatar
                                currentUser = data.profile;
                                updateHeaderAvatar(true);
                            }
                        })
                        .catch(error => console.error('Error recargando perfil:', error));
                }
            });
            
            // Verificar cambios cada 5 segundos (para misma pestaña después de volver del perfil)
            setInterval(function() {
                const lastUpdate = localStorage.getItem('avatarUpdated');
                const lastCheck = sessionStorage.getItem('lastAvatarCheck') || '0';
                
                if (lastUpdate && lastUpdate > lastCheck) {
                    console.log('🔄 Avatar actualizado detectado, recargando perfil...');
                    sessionStorage.setItem('lastAvatarCheck', Date.now().toString());
                    
                    // Recargar perfil del usuario
                    fetch(`${API_BASE_URL}/api/coachee/profile`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success && data.profile) {
                                // Actualizar currentUser con el nuevo avatar
                                currentUser = data.profile;
                                updateHeaderAvatar(true);
                            }
                        })
                        .catch(error => console.error('Error recargando perfil:', error));
                }
            }, 5000);
        }

        // Función de emergencia para desbloquear el dashboard
        function forceUnlockDashboard() {
            console.log('🚨 EMERGENCIA: Desbloqueando dashboard forzadamente');
            
            // Reset all assessment states
            isAssessmentActive = false;
            
            // Hide assessment tab
            const assessmentTab = document.getElementById('assessment-tab-item');
            if (assessmentTab) {
                assessmentTab.style.display = 'none';
            }
            
            // Show assessment container
            const assessmentContainer = document.getElementById('assessmentContainer');
            if (assessmentContainer) {
                assessmentContainer.style.display = 'block';
            }
            
            // Force close all modals
            const allModals = document.querySelectorAll('.modal');
            allModals.forEach(modal => {
                const modalInstance = bootstrap.Modal.getInstance(modal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            });
            
            // Remove all modal backdrops
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(backdrop => {
                backdrop.remove();
            });
            
            // Remove modal-open class from body
            document.body.classList.remove('modal-open');
            
            // Reset body styles
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
            document.body.style.position = '';
            
            // Reset any stuck pointer-events
            document.body.style.pointerEvents = '';
            
            // Clear cached data
            window.lastEvaluationId = null;
            window.lastAssessmentData = null;
            
            // Switch to evaluations tab
            showTab('evaluations');
            
            // Force refresh
            refreshDashboard();
            
            showToast('Dashboard desbloqueado forzadamente', 'success');
            console.log('✅ Dashboard completamente desbloqueado');
        }

        // Make it globally accessible for debugging
        window.forceUnlockDashboard = forceUnlockDashboard;

        // Validar visibilidad de evaluaciones
        async function validateEvaluationVisibility(assessmentId = null) {
            try {
                showToast('Validando visibilidad de evaluaciones...', 'info');
                
                const url = assessmentId 
                    ? `/api/coachee/validate-visibility?assessment_id=${assessmentId}`
                    : '/api/coachee/validate-visibility';
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin'
                });
                
                const data = await response.json();
                
                if (data.valid) {
                    showValidationResults(data, true);
                } else {
                    showValidationResults(data, false);
                }
                
            } catch (error) {
                console.error('Error validando visibilidad:', error);
                showToast('Error al validar visibilidad de evaluaciones', 'error');
            }
        }

        // Mostrar resultados de validación en modal
        function showValidationResults(data, isValid) {
            const modalHtml = `
                <div class="modal fade" id="validationModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header ${isValid ? 'bg-success' : 'bg-warning'} text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-${isValid ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
                                    Validación de Visibilidad de Evaluaciones
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ${generateValidationReport(data, isValid)}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                ${isValid ? '<button type="button" class="btn btn-primary" onclick="refreshDashboard()" data-bs-dismiss="modal">Actualizar Dashboard</button>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal existente si existe
            const existingModal = document.getElementById('validationModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('validationModal'));
            modal.show();
            
            // Mostrar toast con resultado
            if (isValid) {
                showToast(`Validación exitosa: ${data.available_assessments_count || 0} evaluaciones visibles`, 'success');
            } else {
                showToast(`Problema detectado: ${data.error}`, 'warning');
            }
        }

        // Generar reporte de validación
        function generateValidationReport(data, isValid) {
            let html = '';
            
            if (isValid && data.coachee) {
                html += `
                    <div class="alert alert-success">
                        <h6><i class="fas fa-user me-2"></i>Información del Coachee</h6>
                        <strong>Nombre:</strong> ${data.coachee.full_name}<br>
                        <strong>Usuario:</strong> ${data.coachee.username}<br>
                        <strong>Coach:</strong> ${data.coachee.coach_name || 'No asignado'}
                    </div>
                `;
                
                if (data.summary) {
                    html += `
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="card text-center ${data.summary.can_see_evaluations ? 'border-success' : 'border-warning'}">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.available_assessments_count || 0}</h5>
                                        <p class="card-text">Evaluaciones Disponibles</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center border-info">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.completed_assessments_count || 0}</h5>
                                        <p class="card-text">Evaluaciones Completadas</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center border-primary">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.total_assessments_checked || 0}</h5>
                                        <p class="card-text">Total Evaluaciones</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                if (data.assessments && data.assessments.length > 0) {
                    html += `
                        <h6><i class="fas fa-list me-2"></i>Detalle de Evaluaciones</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Evaluación</th>
                                        <th>Estado</th>
                                        <th>Preguntas</th>
                                        <th>Visible</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    data.assessments.forEach(assessment => {
                        const statusBadge = assessment.is_completed ? 'badge bg-success' : 
                                          assessment.visible ? 'badge bg-primary' : 'badge bg-secondary';
                        const statusText = assessment.is_completed ? 'Completada' : 
                                         assessment.visible ? 'Disponible' : 'No disponible';
                        const visibleIcon = assessment.visible ? 'fas fa-eye text-success' : 'fas fa-eye-slash text-muted';
                        
                        html += `
                            <tr>
                                <td><strong>${assessment.title}</strong></td>
                                <td><span class="${statusBadge}">${statusText}</span></td>
                                <td>${assessment.active_questions_count}</td>
                                <td><i class="${visibleIcon}"></i></td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            } else {
                html += `
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Problema Detectado</h6>
                        <strong>Error:</strong> ${data.error}<br>
                        ${data.details ? `<strong>Detalles:</strong> ${JSON.stringify(data.details, null, 2)}` : ''}
                    </div>
                `;
                
                if (data.error.includes('coach asignado')) {
                    html += `
                        <div class="alert alert-info">
                            <h6><i class="fas fa-info-circle me-2"></i>Solución Recomendada</h6>
                            <p>Para ver evaluaciones necesitas tener un coach asignado. Contacta al administrador del sistema para:</p>
                            <ul>
                                <li>Asignarte un coach</li>
                                <li>Verificar tu cuenta</li>
                                <li>Obtener acceso a evaluaciones</li>
                            </ul>
                        </div>
                    `;
                }
            }
            
            return html;
        }

        // Verificar Chart.js availability inmediatamente
        function testChartJSAvailability() {
            console.log('🔍 TESTING Chart.js availability...');
            
            if (typeof Chart === 'undefined') {
                console.error('❌ Chart.js NOT LOADED!');
                document.body.insertAdjacentHTML('beforeend', 
                    '<div style="position: fixed; top: 10px; right: 10px; background: red; color: white; padding: 20px; z-index: 9999; border-radius: 5px;">' +
                    'ERROR: Chart.js no está disponible' +
                    '</div>'
                );
                return false;
            } else {
                console.log('✅ Chart.js is available, version:', Chart.version);
                // DIV VERDE DE "Chart.js loaded" ELIMINADO POR PETICIÓN DEL USUARIO
                // document.body.insertAdjacentHTML('beforeend', 
                //     '<div style="position: fixed; top: 10px; right: 10px; background: green; color: white; padding: 20px; z-index: 9999; border-radius: 5px;">' +
                //     'Chart.js loaded: ' + Chart.version +
                //     '</div>'
                // );
                return true;
            }
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', function() {
                testChartJSAvailability();
                initializeApp();
                // Inicializar tooltips de Bootstrap
                const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
                const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
            });
        } else {
            testChartJSAvailability();
            initializeApp();
            // Inicializar tooltips de Bootstrap
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
        }
        
        // DEBUG: Global functions for browser console debugging
        window.debugDashboard = {
            currentUser,
            dashboardData,
            evaluationsData,
            tasksData,
            contentData,
            API_BASE_URL,
            loadEvaluations,
            loadDashboardSummary,
            loadTasks,
            loadContent,
            openContent,
            markContentAsViewed,
            initializeApp,
            testConnection: async function() {
                try {
                    debugLog('🧪 Testing connection...');
                    const response = await fetch(`${API_BASE_URL}/api/coachee/evaluations`);
                    debugLog(`📡 Test response: ${response.status} ${response.statusText}`);
                    if (response.ok) {
                        const data = await response.json();
                        debugLog('📦 Test data:', data);
                        return data;
                    } else {
                        debugLog('❌ Test failed:', response);
                        return null;
                    }
                } catch (error) {
                    debugLog('❌ Test error:', error);
                    return null;
                }
            }
        };
        
        debugLog('🔧 Global debugging functions available via window.debugDashboard');

        // ========== FORZAR TEXTO BLANCO CON JAVASCRIPT ========== 
        function forceWhiteTextOnButtons() {
            const buttons = document.querySelectorAll('#scheduleCoachTabs .nav-link');
            
            buttons.forEach(button => {
                // Agregar clase para CSS
                button.classList.add('force-white-text');
                
                // Event listeners para forzar estilos
                button.addEventListener('mousedown', function() {
                    if (this.classList.contains('active')) {
                        this.style.setProperty('color', '#ffffff', 'important');
                        this.style.setProperty('background-color', '#007bff', 'important');
                        this.style.setProperty('border-color', '#007bff', 'important');
                        this.style.setProperty('transform', 'none', 'important');
                        this.style.setProperty('opacity', '1', 'important');
                        this.style.setProperty('filter', 'none', 'important');
                    }
                });
                
                button.addEventListener('mouseup', function() {
                    if (this.classList.contains('active')) {
                        this.style.setProperty('color', '#ffffff', 'important');
                        this.style.setProperty('background-color', '#007bff', 'important');
                        this.style.setProperty('border-color', '#007bff', 'important');
                    }
                });
                
                button.addEventListener('click', function() {
                    setTimeout(() => {
                        if (this.classList.contains('active')) {
                            this.style.setProperty('color', '#ffffff', 'important');
                            this.style.setProperty('background-color', '#007bff', 'important');
                            this.style.setProperty('border-color', '#007bff', 'important');
                        }
                    }, 10);
                });
                
                // Verificación continua para botones activos
                setInterval(() => {
                    if (this.classList.contains('active')) {
                        this.style.setProperty('color', '#ffffff', 'important');
                        this.style.setProperty('background-color', '#007bff', 'important');
                        this.style.setProperty('border-color', '#007bff', 'important');
                    }
                }, 100);
            });
        }
        
        // Ejecutar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(forceWhiteTextOnButtons, 500);
        });

        // ================================
        // COACHEE CALENDAR FUNCIONES
        // ================================

        // FullCalendar JS
        const calendarScript = document.createElement('script');
        calendarScript.src = 'https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js';
        calendarScript.onload = function() {
            console.log('✅ FullCalendar cargado para coachee');
            initializeCoacheeScheduling();
        };
        document.head.appendChild(calendarScript);

        function initializeCoacheeScheduling() {
            console.log('🗓️ Inicializando sistema de agendamiento para coachee');
            loadCoachAvailability();
            loadMySessions();
            setupSessionRequestForm();
        }

        function loadCoachAvailability() {
            fetch('/api/coachee/coach-availability')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayCoachAvailability(data.availability, data.occupied_slots, data.coach_name);
                    } else {
                        document.getElementById('coachAvailabilityInfo').innerHTML = 
                            '<p class="text-muted">No se pudo cargar la disponibilidad del coach</p>';
                    }
                })
                .catch(error => {
                    console.error('Error cargando disponibilidad del coach:', error);
                    document.getElementById('coachAvailabilityInfo').innerHTML = 
                        '<p class="text-danger">Error cargando disponibilidad</p>';
                });
        }

        function displayCoachAvailability(availability, occupiedSlots, coachName) {
            const container = document.getElementById('coachAvailabilityInfo');
            if (!container) return;
            
            if (availability.length === 0) {
                container.innerHTML = '<p class="text-muted">El coach no ha configurado su disponibilidad</p>';
                return;
            }
            
            const dayNames = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
            
            let html = `<div class="mb-2"><strong>${coachName}</strong></div>`;
            html += '<div class="mb-3"><small class="text-muted">Horarios disponibles esta semana:</small></div>';
            
            // Calcular disponibilidad real para los próximos 7 días
            const realAvailability = calculateRealAvailability(availability, occupiedSlots);
            
            if (realAvailability.length === 0) {
                html += '<div class="alert alert-info py-2"><small>No hay horarios disponibles en los próximos 7 días.</small></div>';
            } else {
                realAvailability.forEach(slot => {
                    const date = new Date(slot.date + 'T12:00:00');
                    const dayName = dayNames[date.getDay()];
                    const dateStr = date.toLocaleDateString('es-ES', { 
                        day: '2-digit', 
                        month: '2-digit' 
                    });
                    
                    html += `
                        <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-success bg-opacity-10 border border-success border-opacity-25 rounded">
                            <div>
                                <span class="fw-medium">${dayName}</span>
                                <small class="text-muted ms-1">${dateStr}</small>
                            </div>
                            <span class="text-success fw-medium">${slot.start_time} - ${slot.end_time}</span>
                        </div>
                    `;
                });
            }
            
            // Mostrar próximas sesiones ocupadas como referencia
            if (occupiedSlots.length > 0) {
                html += '<div class="mt-3 mb-2"><small class="text-muted">Próximas sesiones ocupadas:</small></div>';
                occupiedSlots.slice(0, 3).forEach(slot => {
                    const date = new Date(slot.date + 'T12:00:00');
                    const dateStr = date.toLocaleDateString('es-ES', { 
                        day: '2-digit', 
                        month: '2-digit' 
                    });
                    html += `
                        <div class="d-flex justify-content-between align-items-center mb-1 p-1 bg-warning bg-opacity-10 rounded">
                            <span class="small">${dateStr}</span>
                            <span class="small text-warning">${slot.start_time} - ${slot.end_time}</span>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        function calculateRealAvailability(generalAvailability, occupiedSlots) {
            const realSlots = [];
            const today = new Date();
            
            // Analizar los próximos 7 días
            for (let i = 1; i <= 7; i++) {
                const targetDate = new Date(today);
                targetDate.setDate(today.getDate() + i);
                const dayOfWeek = targetDate.getDay();
                const dateStr = targetDate.toISOString().split('T')[0];
                
                // Buscar disponibilidad general para este día de la semana
                const dayAvailability = generalAvailability.filter(slot => slot.day_of_week === dayOfWeek);
                
                dayAvailability.forEach(generalSlot => {
                    // Buscar sesiones ocupadas en esta fecha específica
                    const dayOccupied = occupiedSlots.filter(occupied => occupied.date === dateStr);
                    
                    // Calcular horarios libres
                    const freeSlots = calculateFreeTimeSlots(
                        generalSlot.start_time,
                        generalSlot.end_time,
                        dayOccupied
                    );
                    
                    // Agregar slots libres que sean de al menos 1 hora
                    freeSlots.forEach(freeSlot => {
                        if (getMinutesDifference(freeSlot.start, freeSlot.end) >= 60) {
                            realSlots.push({
                                date: dateStr,
                                start_time: freeSlot.start,
                                end_time: freeSlot.end,
                                day_of_week: dayOfWeek
                            });
                        }
                    });
                });
            }
            
            return realSlots;
        }

        function calculateFreeTimeSlots(startTime, endTime, occupiedSlots) {
            if (occupiedSlots.length === 0) {
                return [{ start: startTime, end: endTime }];
            }
            
            const freeSlots = [];
            let currentStart = startTime;
            
            // Ordenar slots ocupados por hora de inicio
            const sortedOccupied = occupiedSlots.sort((a, b) => 
                a.start_time.localeCompare(b.start_time)
            );
            
            sortedOccupied.forEach(occupied => {
                // Si hay espacio antes de esta sesión ocupada
                if (currentStart < occupied.start_time) {
                    freeSlots.push({
                        start: currentStart,
                        end: occupied.start_time
                    });
                }
                
                // Actualizar el siguiente inicio disponible
                currentStart = occupied.end_time > currentStart ? occupied.end_time : currentStart;
            });
            
            // Si queda tiempo después de la última sesión ocupada
            if (currentStart < endTime) {
                freeSlots.push({
                    start: currentStart,
                    end: endTime
                });
            }
            
            return freeSlots;
        }

        function getMinutesDifference(startTime, endTime) {
            const [startHour, startMin] = startTime.split(':').map(Number);
            const [endHour, endMin] = endTime.split(':').map(Number);
            
            const startMinutes = startHour * 60 + startMin;
            const endMinutes = endHour * 60 + endMin;
            
            return endMinutes - startMinutes;
        }

        // Variable global para controlar que el formulario solo se configure una vez
        let sessionFormConfigured = false;

        function setupSessionRequestForm() {
            console.log('🔧 Configurando formulario de solicitud de sesión con dropdowns...');
            
            const form = document.getElementById('sessionRequestForm');
            if (!form) {
                console.warn('⚠️ Formulario sessionRequestForm no encontrado');
                return;
            }
            
            // ⚠️ IMPORTANTE: Solo configurar una vez para evitar event listeners duplicados
            if (sessionFormConfigured) {
                console.log('ℹ️ Formulario ya configurado, omitiendo configuración duplicada');
                return;
            }
            
            // Verificar que todos los elementos existan
            const sessionDate = document.getElementById('sessionDate');
            const sessionStartTime = document.getElementById('sessionStartTime');
            const sessionEndTime = document.getElementById('sessionEndTime');
            
            if (!sessionDate || !sessionStartTime || !sessionEndTime) {
                console.warn('⚠️ Algunos campos del formulario no fueron encontrados');
                return;
            }
            
            console.log('✅ Todos los campos del formulario encontrados');
            
            // Configurar fecha mínima (mañana en zona horaria de Santiago)
            sessionDate.min = getSantiagoTomorrow();
            console.log('📅 Fecha mínima configurada (Santiago):', getSantiagoTomorrow());
            
            // Configurar dropdowns de tiempo para auto-completar
            function setupTimeDropdowns() {
                console.log('🕐 Configurando dropdowns de tiempo...');
                
                // Auto-completar hora de fin cuando se selecciona hora de inicio
                sessionStartTime.addEventListener('change', function() {
                    const startTime = this.value;
                    console.log('🕐 Hora de inicio seleccionada:', startTime);
                    
                    if (startTime) {
                        const [hours, minutes] = startTime.split(':').map(Number);
                        let endHours = hours + 1;
                        
                        // Asegurar que no exceda las 20:30
                        if (endHours > 20 || (endHours === 20 && minutes > 0)) {
                            endHours = 20;
                            sessionEndTime.value = '20:30';
                        } else {
                            const endTime = `${String(endHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                            sessionEndTime.value = endTime;
                        }
                        
                        console.log('🕐 Hora de fin auto-completada:', sessionEndTime.value);
                    }
                });
                
                // Validar que la hora de fin sea posterior a la de inicio
                sessionEndTime.addEventListener('change', function() {
                    const startTime = sessionStartTime.value;
                    const endTime = this.value;
                    
                    if (startTime && endTime) {
                        const [startHours, startMinutes] = startTime.split(':').map(Number);
                        const [endHours, endMinutes] = endTime.split(':').map(Number);
                        
                        const startTotalMinutes = startHours * 60 + startMinutes;
                        const endTotalMinutes = endHours * 60 + endMinutes;
                        
                        if (endTotalMinutes <= startTotalMinutes) {
                            showNotification('La hora de fin debe ser posterior a la hora de inicio', 'error');
                            // Resetear a una hora válida
                            const validEndHours = startHours + 1;
                            if (validEndHours <= 20) {
                                this.value = `${String(validEndHours).padStart(2, '0')}:${String(startMinutes).padStart(2, '0')}`;
                            } else {
                                this.value = '20:30';
                            }
                        }
                    }
                });
                
                console.log('✅ Dropdowns de tiempo configurados');
            }
            
            // Configurar dropdowns
            setupTimeDropdowns();
            
            // Agregar event listener al formulario (UNA SOLA VEZ)
            form.addEventListener('submit', function(e) {
                console.log('📝 Formulario enviado - procesando solicitud');
                e.preventDefault();
                
                // Validar que todos los campos estén completos
                const startTime = sessionStartTime.value;
                const endTime = sessionEndTime.value;
                const date = sessionDate.value;
                const title = document.getElementById('sessionTitle').value;
                
                if (!date || !startTime || !endTime || !title.trim()) {
                    showNotification('Por favor, complete todos los campos obligatorios', 'error');
                    return;
                }
                
                // Validar fecha (no en el pasado)
                const selectedDate = new Date(date + 'T00:00:00');
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (selectedDate < today) {
                    showNotification('No se puede solicitar una sesión en una fecha pasada', 'error');
                    return;
                }
                
                // Los dropdowns ya garantizan horarios válidos, proceder con la solicitud
                submitSessionRequest();
            });
            
            // Marcar como configurado para evitar configuraciones duplicadas
            sessionFormConfigured = true;
            console.log('✅ Formulario de solicitud con dropdowns configurado correctamente');
        }

        function submitSessionRequest() {
            const formData = {
                session_date: document.getElementById('sessionDate').value,
                start_time: document.getElementById('sessionStartTime').value,
                end_time: document.getElementById('sessionEndTime').value,
                title: document.getElementById('sessionTitle').value,
                description: document.getElementById('sessionDescription').value,
                location: document.getElementById('sessionLocation').value
            };
            
            if (!formData.session_date || !formData.start_time || !formData.end_time) {
                showNotification('Completa todos los campos requeridos', 'error');
                return;
            }
            
            // Validación básica: los dropdowns ya garantizan formato y rango válidos
            // Solo validar que la hora de fin sea posterior a la de inicio
            const startTime = new Date(`2000-01-01T${formData.start_time}:00`);
            const endTime = new Date(`2000-01-01T${formData.end_time}:00`);
            
            if (endTime <= startTime) {
                showNotification('La hora de fin debe ser posterior a la de inicio', 'error');
                return;
            }
            
            // Validar duración mínima (30 minutos) y máxima (3 horas)
            const durationMs = endTime - startTime;
            const durationMinutes = durationMs / (1000 * 60);
            
            if (durationMinutes < 30) {
                showNotification('La sesión debe durar al menos 30 minutos', 'error');
                return;
            }
            
            if (durationMinutes > 180) {
                showNotification('La sesión no puede durar más de 3 horas', 'error');
                return;
            }
            
            const submitBtn = document.querySelector('#sessionRequestForm button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Enviando...';
            submitBtn.disabled = true;
            
            fetch('/api/coachee/request-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Solicitud enviada correctamente. Tu coach te responderá pronto.', 'success');
                    resetSessionForm();
                    loadMySessions(); // Refrescar las sesiones
                } else {
                    showNotification(data.error || 'Error enviando solicitud', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error enviando solicitud', 'error');
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        }

        function resetSessionForm() {
            document.getElementById('sessionRequestForm').reset();
            document.getElementById('sessionTitle').value = 'Sesión de Coaching';
            document.getElementById('sessionLocation').value = 'Virtual - Zoom';
        }

        function loadMySessions() {
            fetch('/api/coachee/my-sessions')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayMySessions(data.sessions);
                        updateMySessionsCount(data.sessions.length);
                    }
                })
                .catch(error => {
                    console.error('Error cargando mis sesiones:', error);
                    document.getElementById('mySessionsList').innerHTML = 
                        '<p class="text-danger">Error cargando sesiones</p>';
                });
        }

        function displayMySessions(sessions) {
            const container = document.getElementById('mySessionsList');
            if (!container) return;
            
            if (sessions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No tienes sesiones programadas</p>
                        <button class="btn btn-primary" onclick="showTab('schedule-coach'); document.getElementById('schedule-request-tab').click();">
                            <i class="fas fa-plus me-2"></i>Solicitar Primera Sesión
                        </button>
                    </div>
                `;
                return;
            }
            
            // Ordenar sesiones por fecha descendente (más reciente primero)
            sessions.sort((a, b) => new Date(b.session_date + 'T12:00:00') - new Date(a.session_date + 'T12:00:00'));
            
            const html = sessions.map(session => {
                const statusColors = {
                    'pending': 'warning',
                    'confirmed': 'success',
                    'proposed': 'info',
                    'cancelled': 'danger',
                    'completed': 'secondary'
                };
                
                const statusTexts = {
                    'pending': 'Pendiente de confirmación',
                    'confirmed': 'Confirmada',
                    'proposed': 'Propuesta pendiente',
                    'cancelled': 'Cancelada',
                    'completed': 'Completada'
                };
                
                const sessionDate = new Date(session.session_date + 'T12:00:00');
                const isProposal = session.status === 'proposed' && session.original_session_id;
                
                return `
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h6 class="mb-1">${session.title}</h6>
                                    <p class="mb-1">
                                        <i class="fas fa-user me-1"></i>
                                        Coach: ${session.coach_name}
                                    </p>
                                    <p class="mb-1">
                                        <i class="fas fa-calendar me-1"></i>
                                        ${sessionDate.toLocaleDateString('es-ES', { 
                                            weekday: 'long', 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        })} a las ${session.start_time}
                                    </p>
                                    <p class="mb-1">
                                        <i class="fas fa-map-marker-alt me-1"></i>
                                        ${session.location || 'Por definir'}
                                    </p>
                                    ${session.description ? `<p class="mb-1 text-muted small">${session.description}</p>` : ''}
                                    ${isProposal && session.proposal_message ? 
                                        `<div class="alert alert-info alert-sm mt-2 mb-0">
                                            <i class="fas fa-info-circle me-1"></i>
                                            <strong>Mensaje del coach:</strong> ${session.proposal_message}
                                        </div>` : ''
                                    }
                                </div>
                                <div class="col-md-4 text-end">
                                    <span class="badge bg-${statusColors[session.status]} mb-2 d-block">
                                        ${statusTexts[session.status]}
                                    </span>
                                    ${isProposal ? `
                                        <div class="d-flex gap-1 justify-content-end">
                                            <button class="btn btn-success btn-sm" onclick="respondToProposal(${session.id}, 'accept_proposal')">
                                                <i class="fas fa-check me-1"></i>Aceptar
                                            </button>
                                            <button class="btn btn-danger btn-sm" onclick="respondToProposal(${session.id}, 'reject_proposal')">
                                                <i class="fas fa-times me-1"></i>Rechazar
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function updateMySessionsCount(count) {
            const badge = document.getElementById('mySessionsCount');
            if (badge) {
                if (count > 0) {
                    badge.textContent = count;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function respondToProposal(sessionId, action) {
            const actionText = action === 'accept_proposal' ? 'aceptar' : 'rechazar';
            
            if (!confirm(`¿Estás seguro de que quieres ${actionText} esta propuesta?`)) {
                return;
            }
            
            fetch(`/api/coachee/session/${sessionId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ action: action })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message, 'success');
                    loadMySessions();
                } else {
                    showNotification(data.error || 'Error procesando respuesta', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error procesando respuesta', 'error');
            });
        }

        function refreshMySessions() {
            loadMySessions();
            showNotification('Sesiones actualizadas', 'info');
        }

        function activateRequestTab() {
            console.log('🔄 Activando pestaña de solicitud de sesión manualmente');
            
            const requestTab = document.getElementById('schedule-request-tab');
            const requestPane = document.getElementById('schedule-request-pane');
            const mySessionsTab = document.getElementById('my-sessions-tab');
            const mySessionsPane = document.getElementById('my-sessions-pane');
            
            if (requestTab && requestPane && mySessionsTab && mySessionsPane) {
                // Desactivar pestaña de sesiones
                mySessionsTab.classList.remove('active');
                mySessionsTab.setAttribute('aria-selected', 'false');
                mySessionsPane.classList.remove('show', 'active');
                
                // Activar pestaña de solicitud
                requestTab.classList.add('active');
                requestTab.setAttribute('aria-selected', 'true');
                requestPane.classList.add('show', 'active');
                
                // Configurar formulario
                setTimeout(() => {
                    setupSessionRequestForm();
                    console.log('✅ Pestaña de solicitud activada y formulario configurado');
                }, 200);
            } else {
                console.error('❌ No se pudieron encontrar las pestañas para activar');
            }
        }

        function activateMySessionsTab() {
            console.log('🔄 Activando pestaña de mis sesiones manualmente');
            
            const requestTab = document.getElementById('schedule-request-tab');
            const requestPane = document.getElementById('schedule-request-pane');
            const mySessionsTab = document.getElementById('my-sessions-tab');
            const mySessionsPane = document.getElementById('my-sessions-pane');
            
            if (requestTab && requestPane && mySessionsTab && mySessionsPane) {
                // Desactivar pestaña de solicitud
                requestTab.classList.remove('active');
                requestTab.setAttribute('aria-selected', 'false');
                requestPane.classList.remove('show', 'active');
                
                // Activar pestaña de sesiones
                mySessionsTab.classList.add('active');
                mySessionsTab.setAttribute('aria-selected', 'true');
                mySessionsPane.classList.add('show', 'active');
                
                // Cargar sesiones
                setTimeout(() => {
                    loadMySessions();
                    console.log('✅ Pestaña de mis sesiones activada y datos cargados');
                }, 200);
            } else {
                console.error('❌ No se pudieron encontrar las pestañas para activar');
            }
        }

        function switchToRequestTab() {
            console.log('🔄 Cambiando a pestaña de solicitud de sesión');
            activateRequestTab();
            showNotification('Completa el formulario para solicitar una nueva sesión', 'info');
        }

        function showNotification(message, type = 'info') {
            // Crear notificación temporal
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 15000; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-1"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Modificar showTab para incluir inicialización de agendamiento
        const originalShowTab = window.showTab;
        window.showTab = function(tabId) {
            originalShowTab(tabId);
            
            if (tabId === 'schedule-coach') {
                setTimeout(initializeCoacheeScheduling, 100); // Pequeño delay para asegurar que el DOM esté listo
            }
        };

        // Agregar event listeners para las sub-pestañas del calendario
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Inicializando sistema de pestañas del calendario');
            
            // Event listener para cuando se activa la pestaña "Solicitar Sesión"
            const scheduleRequestTab = document.getElementById('schedule-request-tab');
            if (scheduleRequestTab) {
                console.log('✅ Pestaña "Solicitar Sesión" encontrada');
                
                // Event listener para Bootstrap tab
                scheduleRequestTab.addEventListener('shown.bs.tab', function (e) {
                    console.log('🎯 Pestaña "Solicitar Sesión" activada - Reinicializando formulario');
                    setTimeout(setupSessionRequestForm, 100);
                });
                
                // Event listener manual para click
                scheduleRequestTab.addEventListener('click', function (e) {
                    console.log('👆 Click en pestaña "Solicitar Sesión"');
                    e.preventDefault();
                    activateRequestTab();
                });
            } else {
                console.error('❌ Pestaña "Solicitar Sesión" no encontrada');
            }

            // Event listener para cuando se activa la pestaña "Mis Sesiones"
            const mySessionsTab = document.getElementById('my-sessions-tab');
            if (mySessionsTab) {
                console.log('✅ Pestaña "Mis Sesiones" encontrada');
                
                mySessionsTab.addEventListener('shown.bs.tab', function (e) {
                    console.log('🎯 Pestaña "Mis Sesiones" activada - Refrescando sesiones');
                    setTimeout(loadMySessions, 100);
                });
                
                // Event listener manual para click
                mySessionsTab.addEventListener('click', function (e) {
                    console.log('👆 Click en pestaña "Mis Sesiones"');
                    e.preventDefault();
                    activateMySessionsTab();
                });
            } else {
                console.error('❌ Pestaña "Mis Sesiones" no encontrada');
            }
        });

        // Función para obtener fecha/hora en zona horaria de Santiago
        function getSantiagoDateTime() {
            const now = new Date();
            // Santiago de Chile: GMT-3 (horario de verano) o GMT-4 (horario estándar)
            // Usar Intl.DateTimeFormat para obtener la hora local correcta
            const santiagoTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Santiago"}));
            return santiagoTime;
        }

        function getSantiagoDate() {
            const santiagoTime = getSantiagoDateTime();
            return santiagoTime.toISOString().split('T')[0];
        }

        function getSantiagoTomorrow() {
            const santiagoTime = getSantiagoDateTime();
            santiagoTime.setDate(santiagoTime.getDate() + 1);
            return santiagoTime.toISOString().split('T')[0];
        }

        // Función para solicitar plan de desarrollo al coach
        async function requestDevelopmentPlan() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/request-development-plan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        evaluation_id: window.currentEvaluationId,
                        message: 'Solicito un plan de desarrollo personalizado basado en los resultados de mi evaluación.'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showToast('Solicitud enviada exitosamente. Tu coach te contactará pronto.', 'success');
                    
                    // Deshabilitar el botón temporalmente
                    const btn = document.getElementById('requestPlanBtn');
                    btn.disabled = true;
                    btn.innerHTML = '<i class="fas fa-check me-2"></i>Solicitud Enviada';
                    btn.classList.remove('btn-success');
                    btn.classList.add('btn-outline-success');
                } else {
                    throw new Error(data.error || 'Error enviando solicitud');
                }
            } catch (error) {
                console.error('Error requesting development plan:', error);
                showToast('Error enviando solicitud: ' + error.message, 'error');
            }
        }

        // Función para contactar coach para sesión gratuita
        async function contactCoachForSession() {
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/contact-coach-session`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        evaluation_id: window.currentEvaluationId,
                        session_type: 'free_consultation',
                        message: 'Solicito una sesión gratuita de 30 minutos para desarrollar mis habilidades de asertividad.'
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showToast('¡Solicitud enviada! Un coach se contactará contigo pronto para coordinar tu sesión gratuita.', 'success');
                    
                    // Actualizar el botón para mostrar que la solicitud fue enviada
                    const button = event.target.closest('button');
                    if (button) {
                        button.disabled = true;
                        button.innerHTML = '<i class="fas fa-check me-2"></i>Solicitud Enviada';
                        button.classList.add('btn-outline-light');
                        button.style.color = '#28a745';
                    }
                } else {
                    throw new Error(data.error || 'Error enviando solicitud');
                }
            } catch (error) {
                console.error('Error contacting coach for session:', error);
                showToast('Error enviando solicitud: ' + error.message, 'error');
            }
        }

        // Generar resumen específico para evaluación de Asertividad
        function generateAssertivenessSummary(score, dimensionalScores) {
            let summary = '';
            let generalRecommendation = '';
            
            if (score >= 80) {
                summary = 'Excelente nivel de asertividad. Mantienes un equilibrio perfecto entre expresar tus necesidades y respetar a otros.';
                generalRecommendation = 'Continúa desarrollando tus habilidades de liderazgo y considera ser mentor de otros en el desarrollo de asertividad.';
            } else if (score >= 60) {
                summary = 'Buen nivel de asertividad. Tienes habilidades sólidas con algunas áreas de mejora específicas.';
                generalRecommendation = 'Enfócate en fortalecer las dimensiones con puntuaciones más bajas. Practica técnicas de comunicación asertiva en situaciones desafiantes.';
            } else if (score >= 40) {
                summary = 'Nivel moderado de asertividad. Hay oportunidades significativas de desarrollo en varias áreas.';
                generalRecommendation = 'Considera tomar un curso de comunicación asertiva y practica técnicas de autoconfianza. Trabaja en expresar tus opiniones de manera clara y respetuosa.';
            } else {
                summary = 'Nivel bajo de asertividad. Es prioritario desarrollar estas habilidades fundamentales.';
                generalRecommendation = 'Recomendamos trabajar con un coach o tomar capacitación especializada en asertividad. Comienza con ejercicios de autoconfianza y expresión de necesidades básicas.';
            }
            
            return { summary, generalRecommendation };
        }

        // Generar sección HTML de fortalezas y debilidades para Asertividad
        function generateAssertivenessSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluación de Asertividad
            if (isDiscAssessment || isEmotionalIntelligenceAssessment || isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension) {
                            case 'comunicacion':
                                fortalezaMsg = 'Te comunicas de manera clara y directa, expresando tus ideas con confianza.';
                                break;
                            case 'derechos':
                                fortalezaMsg = 'Sabes defender tus derechos personales de manera equilibrada y respetuosa.';
                                break;
                            case 'opiniones':
                                fortalezaMsg = 'Expresas tus opiniones con seguridad y autenticidad.';
                                break;
                            case 'conflictos':
                                fortalezaMsg = 'Manejas los conflictos de manera constructiva y efectiva.';
                                break;
                            case 'autoconfianza':
                                fortalezaMsg = 'Tienes una sólida confianza en ti mismo/a y en tus capacidades.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension) {
                            case 'comunicacion':
                                debilidadMsg = 'Puedes mejorar la claridad y efectividad en tu comunicación.';
                                break;
                            case 'derechos':
                                debilidadMsg = 'Te resulta difícil defender tus derechos o establecer límites claros.';
                                break;
                            case 'opiniones':
                                debilidadMsg = 'Necesitas más confianza para expresar tus opiniones en diferentes situaciones.';
                                break;
                            case 'conflictos':
                                debilidadMsg = 'Los conflictos te generan incomodidad y podrías manejarlos de manera más efectiva.';
                                break;
                            case 'autoconfianza':
                                debilidadMsg = 'Tu autoconfianza necesita fortalecerse para actuar con mayor seguridad.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las áreas tienen potencial de mejora significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¡Excelente! Todas las áreas muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-line me-2"></i>Análisis de tu Perfil de Asertividad</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-thumbs-up me-2"></i>Tus Fortalezas
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-target me-2"></i>Áreas de Oportunidad
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateDiscSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluación DISC
            if (!isDiscAssessment || isEmotionalIntelligenceAssessment || isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales DISC
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'dominance':
                            case 'dominancia':
                                fortalezaMsg = 'Tienes una personalidad decidida y orientada a resultados, excelente para liderar y tomar decisiones difíciles.';
                                break;
                            case 'influence':
                            case 'influencia':
                                fortalezaMsg = 'Posees habilidades naturales para comunicar, motivar e influir positivamente en otros.';
                                break;
                            case 'steadiness':
                            case 'estabilidad':
                                fortalezaMsg = 'Eres una persona confiable, paciente y colaborativa, creando un ambiente de trabajo estable.';
                                break;
                            case 'conscientiousness':
                            case 'cumplimiento':
                                fortalezaMsg = 'Te destacas por tu atención al detalle, calidad en el trabajo y cumplimiento de estándares.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'dominance':
                            case 'dominancia':
                                debilidadMsg = 'Puedes desarrollar mayor asertividad y capacidad de liderazgo en situaciones desafiantes.';
                                break;
                            case 'influence':
                            case 'influencia':
                                debilidadMsg = 'Podrías fortalecer tus habilidades de comunicación e influencia interpersonal.';
                                break;
                            case 'steadiness':
                            case 'estabilidad':
                                debilidadMsg = 'Desarrollar mayor paciencia y habilidades de colaboración te beneficiaría en el trabajo en equipo.';
                                break;
                            case 'conscientiousness':
                            case 'cumplimiento':
                                debilidadMsg = 'Mejorar la atención al detalle y sistematización te ayudará a alcanzar mayor calidad en tu trabajo.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las dimensiones tienen potencial de desarrollo significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¡Excelente! Todas las dimensiones muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas (DISC) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-user-circle me-2"></i>Análisis de tu Perfil DISC de Personalidad</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-star me-2"></i>Tus Fortalezas Naturales
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-chart-line me-2"></i>Áreas de Desarrollo
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateEmotionalIntelligenceSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluación de Inteligencia Emocional
            if (isDiscAssessment || !isEmotionalIntelligenceAssessment || isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales de IE
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'autoconciencia':
                            case 'self_awareness':
                                fortalezaMsg = 'Tienes un excelente conocimiento de tus emociones y cómo estas afectan tu comportamiento.';
                                break;
                            case 'autoregulacion':
                            case 'self_regulation':
                                fortalezaMsg = 'Posees gran habilidad para manejar y controlar tus emociones de manera constructiva.';
                                break;
                            case 'motivacion':
                            case 'motivation':
                                fortalezaMsg = 'Demuestras una fuerte motivación interna y capacidad para mantener el enfoque en tus objetivos.';
                                break;
                            case 'empatia':
                            case 'empathy':
                                fortalezaMsg = 'Tienes una capacidad natural para entender y conectar con las emociones de otros.';
                                break;
                            case 'habilidades_sociales':
                            case 'social_skills':
                                fortalezaMsg = 'Destacas en el manejo de relaciones interpersonales y comunicación emocional efectiva.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'autoconciencia':
                            case 'self_awareness':
                                debilidadMsg = 'Desarrollar mayor autoconciencia emocional te ayudará a entender mejor tus reacciones.';
                                break;
                            case 'autoregulacion':
                            case 'self_regulation':
                                debilidadMsg = 'Fortalecer la autoregulación te permitirá manejar mejor situaciones emocionales desafiantes.';
                                break;
                            case 'motivacion':
                            case 'motivation':
                                debilidadMsg = 'Trabajar en tu motivación interna te dará mayor resistencia ante los obstáculos.';
                                break;
                            case 'empatia':
                            case 'empathy':
                                debilidadMsg = 'Desarrollar mayor empatía mejorará significativamente tus relaciones interpersonales.';
                                break;
                            case 'habilidades_sociales':
                            case 'social_skills':
                                debilidadMsg = 'Mejorar tus habilidades sociales te permitirá comunicarte más efectivamente con otros.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las competencias emocionales tienen potencial de desarrollo significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¡Excelente! Todas las competencias muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas (IE) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-brain me-2"></i>Análisis de tu Inteligencia Emocional</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-heart me-2"></i>Tus Competencias Desarrolladas
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-seedling me-2"></i>Competencias en Desarrollo
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateTeamworkSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluación de Trabajo en Equipo
            if (isDiscAssessment || isEmotionalIntelligenceAssessment || !isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales de Trabajo en Equipo
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'comunicacion':
                            case 'communication':
                                fortalezaMsg = 'Excelentes habilidades de comunicación en equipo, facilitando la colaboración efectiva.';
                                break;
                            case 'colaboracion':
                            case 'collaboration':
                                fortalezaMsg = 'Demuestras una gran capacidad para trabajar de manera colaborativa y constructiva con otros.';
                                break;
                            case 'liderazgo':
                            case 'leadership':
                                fortalezaMsg = 'Posees habilidades naturales de liderazgo que inspiran y guían al equipo hacia el éxito.';
                                break;
                            case 'resolucion_conflictos':
                            case 'conflict_resolution':
                                fortalezaMsg = 'Tienes una excelente capacidad para resolver conflictos y mantener la armonía del equipo.';
                                break;
                            case 'adaptabilidad':
                            case 'adaptability':
                                fortalezaMsg = 'Tu flexibilidad y adaptabilidad son fortalezas clave para el trabajo en equipos dinámicos.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'comunicacion':
                            case 'communication':
                                debilidadMsg = 'Mejorar tu comunicación en equipo facilitará una colaboración más efectiva.';
                                break;
                            case 'colaboracion':
                            case 'collaboration':
                                debilidadMsg = 'Desarrollar mejores habilidades colaborativas te ayudará a contribuir más al equipo.';
                                break;
                            case 'liderazgo':
                            case 'leadership':
                                debilidadMsg = 'Fortalecer tus habilidades de liderazgo te permitirá guiar mejor a tu equipo.';
                                break;
                            case 'resolucion_conflictos':
                            case 'conflict_resolution':
                                debilidadMsg = 'Mejorar en resolución de conflictos creará un ambiente de trabajo más armonioso.';
                                break;
                            case 'adaptabilidad':
                            case 'adaptability':
                                debilidadMsg = 'Desarrollar mayor adaptabilidad te ayudará a responder mejor a los cambios del equipo.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las competencias de equipo tienen potencial de desarrollo significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¡Excelente! Todas las competencias muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas (Trabajo en Equipo) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-users me-2"></i>Análisis de tus Competencias de Trabajo en Equipo</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-trophy me-2"></i>Tus Fortalezas Colaborativas
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-hand-holding-up me-2"></i>Competencias en Desarrollo
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        console.log('🔄 Coachee Calendar System: 2025-10-18-16:44 - Sistema de agendamiento con zona horaria Santiago');
        console.log('🇨🇱 Hora actual Santiago:', getSantiagoDateTime().toLocaleString('es-CL'));
        
        // ========== INSTAGRAM STYLE FEEDS FUNCTIONALITY ==========
        
        // Extender showTab para cargar feeds cuando se active la pestaña
        const existingShowTab = window.showTab;
        window.showTab = function(tabId) {
            existingShowTab(tabId);
            
            if (tabId === 'feeds') {
                console.log('📺 Feeds tab activated - loading Instagram style feeds');
                setTimeout(loadInstagramFeeds, 100);
            }
        };
        
        // Función para cargar feeds desde la API
        async function loadInstagramFeeds() {
            console.log('🎬 Loading Instagram style feeds...');
            
            const container = document.getElementById('feedsContainer');
            if (!container) {
                console.log('❌ Feeds container not found');
                return;
            }
            
            try {
                const response = await fetch('/api/coachee/content');
                const data = await response.json();
                
                console.log('📊 API Response for feeds:', data);
                
                if (data.success && data.content && data.content.length > 0) {
                    displayInstagramFeeds(data.content);
                } else {
                    displayNoFeeds();
                }
            } catch (error) {
                console.error('❌ Error loading feeds:', error);
                displayFeedsError();
            }
        }
        
        // Función para mostrar feeds en formato Instagram
        function displayInstagramFeeds(content) {
            const container = document.getElementById('feedsContainer');
            if (!container) return;
            
            let feedsHTML = '';
            
            content.forEach((item, index) => {
                const videoId = extractYouTubeVideoId(item.content_url);
                const isYouTubeVideo = videoId && item.content_type === 'video';
                const isDocument = item.content_type === 'document';
                
                console.log('🔍 Processing content item:', {
                    id: item.id,
                    type: item.content_type,
                    title: item.title,
                    url: item.content_url,
                    isDocument: isDocument,
                    isYouTubeVideo: isYouTubeVideo
                });
                
                // Determinar el thumbnail/preview
                let thumbnail;
                if (isYouTubeVideo) {
                    thumbnail = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
                } else if (isDocument) {
                    // Para documentos, generaremos un preview
                    thumbnail = null; // Se generará dinámicamente
                } else {
                    // Fallback para otros tipos de video
                    thumbnail = 'data:image/svg+xml;base64,' + btoa(`
                        <svg width="600" height="400" xmlns="http://www.w3.org/2000/svg">
                            <rect width="600" height="400" fill="#f8f9fa"/>
                            <circle cx="300" cy="200" r="60" fill="#6c757d"/>
                            <polygon points="270,170 270,230 330,200" fill="white"/>
                        </svg>
                    `);
                }
                
                // Calcular tiempo relativo
                const timeAgo = getRelativeTime(item.assigned_at);
                
                feedsHTML += `
                    <div class="instagram-post">
                        <!-- Header del post -->
                        <div class="post-header">
                            <div class="post-author">
                                <div class="author-avatar">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="author-info">
                                    <h6>${item.coach_name}</h6>
                                    <small>${timeAgo}</small>
                                </div>
                            </div>
                            <button class="post-options">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>
                        
                        <!-- Media del post -->
                        <div class="post-media">
                            ${isYouTubeVideo ? `
                                <div class="ratio ratio-4x3">
                                    <iframe id="youtube-feed-${item.id}" 
                                        src="https://www.youtube.com/embed/${videoId}?enablejsapi=1" 
                                        title="${item.title}" 
                                        frameborder="0" 
                                        allowfullscreen
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        style="border-radius: 8px;">
                                    </iframe>
                                </div>
                            ` : isDocument ? `
                                <div class="document-preview-container" style="position: relative; height: 280px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer;"
                                     onclick="openDocumentFeed('${item.content_url}', '${item.title}')">
                                    <div style="width: 100%; height: 280px; overflow-y: auto;">
                                        <canvas id="doc-preview-${item.id}"
                                                width="1200"
                                                height="1000"
                                                style="width: 100%; height: auto; border-radius: 8px; pointer-events: none; display: block;">
                                        </canvas>
                                    </div>
                                    <div class="document-overlay" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; pointer-events: none;">
                                        <i class="fas fa-file-alt" style="color: white; font-size: 16px;"></i>
                                    </div>
                                </div>
                            ` : `
                                <div onclick="openVideoFeed('${item.content_url}')">
                                    <img src="${thumbnail}" 
                                         alt="${item.title}" 
                                         class="post-image"
                                         onerror="this.src='data:image/svg+xml;base64,${btoa(`
                                             <svg width="600" height="400" xmlns="http://www.w3.org/2000/svg">
                                                 <rect width="600" height="400" fill="#f8f9fa"/>
                                                 <circle cx="300" cy="200" r="60" fill="#6c757d"/>
                                                 <polygon points="270,170 270,230 330,200" fill="white"/>
                                                 <text x="300" y="280" font-family="Arial" font-size="18" text-anchor="middle" fill="#6c757d">Video</text>
                                             </svg>
                                         `)}'">
                                    <div class="video-overlay">
                                        <i class="fas fa-play"></i>
                                    </div>
                                </div>
                            `}
                        </div>
                        
                        <!-- Acciones del post -->
                        <div class="post-actions">
                            <div class="action-buttons">
                                <button class="action-btn" onclick="toggleLikeFeed(${item.id}, this)" title="Me gusta">
                                    <i class="far fa-heart"></i>
                                </button>
                                ${isYouTubeVideo ? `
                                    <button class="action-btn" disabled style="color: #28a745; opacity: 0.7;" title="Video embebido">
                                        <i class="fas fa-play-circle"></i>
                                    </button>
                                ` : isDocument ? `
                                    <button class="action-btn" onclick="openDocumentFeed('${item.content_url}', '${item.title}')" title="Abrir documento">
                                        <i class="far fa-file-alt"></i>
                                    </button>
                                ` : `
                                    <button class="action-btn" onclick="openVideoFeed('${item.content_url}')" title="Reproducir video">
                                        <i class="far fa-play-circle"></i>
                                    </button>
                                `}
                                <button class="action-btn" onclick="shareFeed(${item.id})" title="Compartir">
                                    <i class="far fa-paper-plane"></i>
                                </button>
                            </div>
                            <button class="action-btn" title="Guardar">
                                <i class="far fa-bookmark"></i>
                            </button>
                        </div>
                        
                        <!-- Información del post -->
                        <div class="post-info">
                            <div class="post-likes">
                                <strong>${Math.floor(Math.random() * 50) + 10} me gusta</strong>
                            </div>
                            <div class="post-caption">
                                <span class="username">${item.coach_name}</span>
                                ${item.title}
                                ${item.description ? '<br><small class="text-muted">' + item.description + '</small>' : ''}
                            </div>
                            <div class="post-time">
                                ${timeAgo}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = feedsHTML;
            console.log(`✅ Displayed ${content.length} Instagram-style feeds`);
            
            // Generar previews de documentos después de insertar el HTML
            content.forEach(item => {
                console.log(`🔍 Processing item ${item.id}: type=${item.content_type}, url=${item.content_url}`);
                if (item.content_type === 'document') {
                    const canvasId = `doc-preview-${item.id}`;
                    console.log(`📄 [DOCUMENT PREVIEW] Generating preview for document ${item.id}, canvas: ${canvasId}`);
                    console.log(`📄 [DOCUMENT PREVIEW] URL: ${item.content_url}`);
                    // Delay para asegurar que el canvas esté en el DOM
                    setTimeout(() => {
                        const canvas = document.getElementById(canvasId);
                        console.log(`📄 [DOCUMENT PREVIEW] Canvas found:`, canvas);
                        if (canvas) {
                            generateDocumentPreview(item.content_url, canvasId);
                        } else {
                            console.error(`❌ [DOCUMENT PREVIEW] Canvas not found: ${canvasId}`);
                        }
                    }, 500);
                }
            });
        }
        
        // Función para calcular tiempo relativo
        function getRelativeTime(dateString) {
            if (!dateString) return 'Hace un momento';
            
            const now = new Date();
            const date = new Date(dateString);
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays > 0) {
                return `Hace ${diffDays} día${diffDays > 1 ? 's' : ''}`;
            } else if (diffHours > 0) {
                return `Hace ${diffHours} hora${diffHours > 1 ? 's' : ''}`;
            } else {
                return 'Hace un momento';
            }
        }
        
        // Función para extraer ID de YouTube
        function extractYouTubeVideoId(url) {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
        
        // Función para abrir video en nueva pestaña
        function openVideoFeed(url) {
            console.log('🚀 Opening video from feed:', url);
            window.open(url, '_blank');
        }
        
        // Función para toggle like
        function toggleLikeFeed(contentId, button) {
            const icon = button.querySelector('i');
            if (icon.classList.contains('far')) {
                icon.classList.remove('far');
                icon.classList.add('fas');
                button.classList.add('liked');
            } else {
                icon.classList.remove('fas');
                icon.classList.add('far');
                button.classList.remove('liked');
            }
            console.log('❤️ Toggled like for content:', contentId);
        }
        
        // Función para compartir
        function shareFeed(contentId) {
            console.log('🔗 Sharing content:', contentId);
            showToast('¡Funcionalidad de compartir próximamente!', 'info');
        }
        
        // Función para abrir documento
        function openDocumentFeed(url, title) {
            console.log('📄 Opening document from feed:', url);
            // Crear enlace temporal para descarga
            const link = document.createElement('a');
            link.href = url;
            link.download = title || 'documento.pdf';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Funciones de PDF.js para preview de documentos
    async function generatePDFPreview(url, canvasId, maxWidth = 1200, maxHeight = 1000) {
            console.log('📄 [PDF PREVIEW] Starting PDF preview generation for:', url);
            console.log('📄 [PDF PREVIEW] PDF.js available:', typeof pdfjsLib !== 'undefined');
            
            if (typeof pdfjsLib === 'undefined') {
                console.error('❌ [PDF PREVIEW] PDF.js not loaded');
                return;
            }
            
            try {
                const canvas = document.getElementById(canvasId);
                if (!canvas) {
                    console.error('❌ [PDF PREVIEW] Canvas element not found:', canvasId);
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                
                // Configurar canvas con fondo blanco
                canvas.width = maxWidth;
                canvas.height = maxHeight;
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, maxWidth, maxHeight);
                
                console.log('📄 [PDF PREVIEW] Loading PDF document...');
                
                // Cargar PDF con configuración para CORS
                const loadingTask = pdfjsLib.getDocument({
                    url: url,
                    disableWorker: false,
                    disableAutoFetch: false,
                    disableStream: false
                });
                
                const pdf = await loadingTask.promise;
                console.log('📄 [PDF PREVIEW] PDF loaded successfully, pages:', pdf.numPages);
                
                // Obtener primera página
                const page = await pdf.getPage(1);
                const viewport = page.getViewport({ scale: 1 });
                
                // Calcular escala para ajustar al canvas manteniendo aspect ratio
                const scaleX = maxWidth / viewport.width;
                const scaleY = maxHeight / viewport.height;
                const scale = Math.min(scaleX, scaleY);
                
                const scaledViewport = page.getViewport({ scale });
                
                // Centrar la página en el canvas
                const offsetX = (maxWidth - scaledViewport.width) / 2;
                const offsetY = (maxHeight - scaledViewport.height) / 2;
                
                // Crear canvas temporal para renderizar la página
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = scaledViewport.width;
                tempCanvas.height = scaledViewport.height;
                
                // Renderizar página en canvas temporal
                const renderContext = {
                    canvasContext: tempCtx,
                    viewport: scaledViewport
                };
                
                await page.render(renderContext).promise;
                
                // Limpiar canvas principal con fondo blanco
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, maxWidth, maxHeight);
                
                // Dibujar página centrada en canvas principal
                ctx.drawImage(tempCanvas, offsetX, offsetY);
                
                console.log('✅ PDF preview generated successfully for:', url);
                
            } catch (error) {
                console.error('❌ Error generating PDF preview:', error);
                // Mostrar icono de error en el canvas
                const canvas = document.getElementById(canvasId);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    canvas.width = maxWidth;
                    canvas.height = maxHeight;
                    
                    // Fondo gris claro
                    ctx.fillStyle = '#f8f9fa';
                    ctx.fillRect(0, 0, maxWidth, maxHeight);
                    
                    // Dibujar texto de error
                    ctx.fillStyle = '#6c757d';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Vista previa no disponible', maxWidth/2, maxHeight/2 - 10);
                    ctx.fillText('📄 Documento PDF', maxWidth/2, maxHeight/2 + 10);
                }
            }
        }
        
        // Función para generar preview de documento (unified)
        async function generateDocumentPreview(url, canvasId) {
            console.log('📄 [DOC PREVIEW] Starting preview generation for:', url);
            console.log('📄 [DOC PREVIEW] Canvas ID:', canvasId);
            
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('❌ [DOC PREVIEW] Canvas not found:', canvasId);
                return;
            }

            const ctx = canvas.getContext('2d');
            canvas.width = 1200;
            canvas.height = 1000;
            
            // Mostrar indicador de carga inicial
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, 1200, 1000);
            ctx.fillStyle = '#6c757d';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Cargando documento...', 600, 500);
            
            // Verificar si es PDF
            if (url.toLowerCase().includes('.pdf') || url.includes('content_type=document') || url.includes('/download')) {
                console.log('📄 [DOC PREVIEW] Detected as PDF, generating PDF preview');
                try {
                    await generatePDFPreview(url, canvasId, 1200, 1000);
                } catch (error) {
                    console.error('❌ [DOC PREVIEW] PDF preview failed:', error);
                    // Mostrar icono de error
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, 1200, 1000);
                    ctx.fillStyle = '#dc3545';
                    ctx.font = '32px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Error al cargar PDF', 600, 400);
                    ctx.fillStyle = '#6c757d';
                    ctx.font = '96px Arial';
                    ctx.fillText('📄', 600, 700);
                }
            } else {
                console.log('📄 [DOC PREVIEW] Non-PDF document, showing generic icon');
                // Para otros tipos de documento, mostrar icono genérico
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, 1200, 1000);
                // Dibujar icono de documento
                ctx.fillStyle = '#495057';
                ctx.font = '96px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('📄', 600, 500);
                // Texto descriptivo
                ctx.fillStyle = '#6c757d';
                ctx.font = '32px Arial';
                ctx.fillText('Documento', 600, 700);
            }
        }
        
        // Función para refrescar feeds
        function refreshFeeds() {
            console.log('🔄 Refreshing Instagram feeds...');
            const container = document.getElementById('feedsContainer');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Actualizando feeds...</span>
                        </div>
                        <p class="text-muted">Actualizando contenido...</p>
                    </div>
                `;
            }
            setTimeout(loadInstagramFeeds, 1000);
        }
        
        // Función para mostrar cuando no hay feeds
        function displayNoFeeds() {
            const container = document.getElementById('feedsContainer');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-stream fa-4x text-muted mb-3"></i>
                        <h5 class="text-muted">No hay feeds disponibles</h5>
                        <p class="text-muted">Tu coach aún no ha compartido contenido contigo.</p>
                        <button class="btn btn-outline-primary" onclick="refreshFeeds()">
                            <i class="fas fa-sync-alt me-1"></i>Verificar nuevamente
                        </button>
                    </div>
                `;
            }
        }
        
        // Función para mostrar error
        function displayFeedsError() {
            const container = document.getElementById('feedsContainer');
            if (container) {
                container.innerHTML = `
                    <div class="alert alert-warning text-center">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Error al cargar los feeds. 
                        <button class="btn btn-sm btn-outline-warning ms-2" onclick="refreshFeeds()">
                            Reintentar
                        </button>
                    </div>
                `;
            }
        }
        
        // ✨ AUTO-START ASSESSMENT: Detectar si viene de invitación
        // AUTO-START ASSESSMENT: This block requires server-side template rendering.
        // If using Jinja, ensure this file is processed by Flask or Django.
        // If not using a template engine, remove or replace this block with valid JavaScript.
    </script>
    
    <!-- Script común para presentación de recomendaciones -->
    <script src="{{ url_for('static', filename='js/recommendations.js') }}"></script>

    <!-- Bottom Navigation - Estilo LinkedIn -->
    <nav class="bottom-navigation">
        <a href="/coachee-feed" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        
        <a href="/coachee-dashboard" class="nav-item active">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
        </a>
        
        <button class="nav-item" onclick="confirmLogoutFromDashboard()">
            <i class="fas fa-sign-out-alt"></i>
            <span>Salir</span>
        </button>
    </nav>

    <script>
        // Función para confirmar logout desde dashboard
        function confirmLogoutFromDashboard() {
            if (confirm('¿Estás seguro que deseas salir?')) {
                window.location.href = '/participant-access';
            }
        }
    </script>

</body>
</html>
