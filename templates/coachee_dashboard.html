<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coach/Dashboard</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts - Lobster Two -->
    <link href="https://fonts.googleapis.com/css2?family=Lobster+Two:wght@400;700&display=swap" rel="stylesheet">
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <!-- PDF.js para previsualización de documentos -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        // Configurar PDF.js worker
        if (typeof pdfjsLib !== 'undefined') {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        }
    </script>
    <script src="/static/js/recommendations.js?v={{ get_file_version('js/recommendations.js') }}"></script>
    <link rel="stylesheet" href="/static/css/unified-dashboard.css?v={{ get_file_version('css/unified-dashboard.css') }}">
    <!-- FullCalendar CSS -->
    <link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.css' rel='stylesheet' />
    
    <!-- Estilos para Alpine.js x-cloak -->
    <style>
        [x-cloak] { display: none !important; }
    </style>
    
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <style>
        /* Variables CSS para recomendaciones unificadas - IGUAL QUE COACH */
        :root {
            --calm-primary: #1E3A8A;        /* Deep Blue */
            --calm-secondary: #3B82F6;      /* Bright Blue */
            --calm-accent: #06B6D4;         /* Cyan */
            --calm-light: #EFF6FF;          /* Very Light Blue */
            --calm-dark: #1E293B;           /* Dark Slate */
            --calm-white: #FFFFFF;
            --calm-gray-50: #F8FAFC;
            --calm-gray-100: #F1F5F9;
        
        /* COLORES DE PRIORIDADES Y CATEGORÍAS - COPIADOS DEL COACH DASHBOARD */
        .priority-high {
            border-top-color: #ef4444;
        }
        
        .priority-medium {
            border-top-color: #f59e0b;
        }
        
        .priority-low {
            border-top-color: #06b6d4;
        }
        
        .priority-growth {
            border-top-color: #10b981;
        }
        
        /* Estilos para dropdowns de tiempo en formato 24 horas */
        .time-select-24h {
            font-family: 'Courier New', monospace !important;
            font-weight: bold !important;
            font-size: 1.1em !important;
            text-align: center !important;
            color: #1E3A8A !important;
            background-color: #f8f9fa !important;
            border: 2px solid #e9ecef !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='m1 6 7 7 7-7'/%3e%3c/svg%3e") !important;
        }
        
        .time-select-24h:focus {
            border-color: #1E3A8A !important;
            box-shadow: 0 0 0 0.2rem rgba(30, 58, 138, 0.25) !important;
            background-color: white !important;
        }
        
        .time-select-24h option {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            color: #1E3A8A;
            background-color: white;
            padding: 8px;
        }
        
        .time-select-24h option:hover {
            background-color: #f8f9fa !important;
        }
        
        .time-select-24h option:checked,
        .time-select-24h option:selected {
            background-color: #1E3A8A !important;
            color: white !important;
        }
        
        .time-input-24h {
            font-family: 'Courier New', monospace !important;
            font-weight: bold !important;
            font-size: 1.1em !important;
            letter-spacing: 1px !important;
            text-align: center !important;
            color: #1E3A8A !important;
            background-color: #f8f9fa !important;
            border: 2px solid #e9ecef !important;
        }
        
        .time-input-24h:focus {
            border-color: #1E3A8A !important;
            box-shadow: 0 0 0 0.2rem rgba(30, 58, 138, 0.25) !important;
            background-color: white !important;
        }
        
        .time-input-24h.is-valid {
            border-color: #28a745 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8' viewBox='0 0 8 8'%3e%3cpath fill='%2328a745' d='m2.3 6.73 1.42 1.42 3.47-3.47'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right calc(0.375em + 0.1875rem) center !important;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem) !important;
        }
        
        .time-input-24h.is-invalid {
            border-color: #dc3545 !important;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='none' stroke='%23dc3545' viewBox='0 0 12 12'%3e%3ccircle cx='6' cy='6' r='4.5'/%3e%3cpath d='m5.8 4.2.4-.4.4.4-.4.4.4.4-.4.4-.4-.4-.4.4-.4-.4.4-.4-.4-.4.4-.4Z'/%3e%3c/svg%3e") !important;
            background-repeat: no-repeat !important;
            background-position: right calc(0.375em + 0.1875rem) center !important;
            background-size: calc(0.75em + 0.375rem) calc(0.75em + 0.375rem) !important;
        }
        
        input[type="time"][data-format="24h"] {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 1.1em;
            letter-spacing: 1px;
        }
        
        input[type="time"][data-format="24h"]::-webkit-calendar-picker-indicator {
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="%23666" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm5 11h-6V7h2v4h4v2z"/></svg>') no-repeat;
        }
        
        /* Asegurar que el formato sea siempre 24h */
        input[type="time"][data-format="24h"]::-webkit-datetime-edit-hour-field {
            color: #1E3A8A;
            font-weight: bold;
        }
        
        input[type="time"][data-format="24h"]::-webkit-datetime-edit-minute-field {
            color: #1E3A8A;
            font-weight: bold;
        }
        
        /* ESTILOS PARA SIDEBAR PANEL DE CONTROL - MODERNO (IGUAL QUE COACH) */
        .sidebar {
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            border: 1px solid #f3f4f6;
            overflow: hidden;
            transition: box-shadow 0.3s ease;
            position: sticky;
            top: 0;
            max-height: calc(100vh - 4rem);
            overflow-y: auto;
            margin-top: -1rem; /* Reducido a un tercio: de -1.5rem a -1rem */
        }
        
        .sidebar:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }
        
        .sidebar .card-header {
            background: #ffffff;
            border: none;
            border-bottom: 1px solid #f3f4f6;
            padding: 2rem 1.75rem;
            position: relative;
        }
        
        .sidebar .card-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 1.75rem;
            right: 1.75rem;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0,0,0,0.05), transparent);
        }
        
        .sidebar .card-header h5 {
            color: #111827;
            font-weight: 600;
            font-size: 1.125rem;
            margin: 0;
            display: flex;
            align-items: center;
            letter-spacing: 0.3px;
        }
        
        .sidebar .card-header h5 i {
            margin-right: 0.75rem;
            font-size: 1.25rem;
            opacity: 0.95;
            color: #111827;
        }
        
        .sidebar .card-header p {
            margin: 0.5rem 0 0 0;
            font-size: 0.8125rem;
            opacity: 0.85;
            color: #111827;
        }
        
        .sidebar .card-body {
            padding: 0.75rem 0.5rem;
        }
        
        .list-group-item {
            background: transparent;
            color: #4b5563;
            border: none;
            border-left: 2px solid transparent;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            font-size: 0.9375rem;
            padding: 0.875rem 1.5rem;
            margin: 0.125rem 0.5rem;
            border-radius: 10px;
            cursor: pointer;
            position: relative;
        }
        
        .list-group-item:hover {
            background: #f9fafb;
            color: #667eea;
            border-left-color: #667eea;
            transform: translateX(2px);
        }
        
        .list-group-item.active,
        .list-group-item-action.active {
            background: transparent !important;
            color: #4b5563 !important;
            font-weight: 600;
            border-left-color: #667eea !important;
        }
        
        .list-group-item.active span,
        .list-group-item-action.active span {
            color: #4b5563 !important;
        }
        
        .list-group-item.active i,
        .list-group-item-action.active i {
            color: #667eea !important;
        }
        
        .list-group-item i {
            width: 18px;
            margin-right: 0.875rem;
            font-size: 0.9375rem;
            text-align: center;
            opacity: 0.8;
            transition: opacity 0.2s ease;
        }
        
        .list-group-item:hover i,
        .list-group-item.active i {
            opacity: 1;
        }
        
        /* CATEGORÍAS DE RECOMENDACIONES */
        .general-recommendations {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
        }
        
        .general-recommendations .category-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white;
            border-bottom-color: var(--calm-primary);
        }
        
        .general-recommendations .category-title {
            color: white;
        }
        
        .strengths-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .strengths-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .strengths-category .category-title {
            color: white;
        }
        
        .strengths-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .strengths-category .recommendation-item:before {
            background: #10b981;
            content: "★";
        }
        
        .final-message {
            border: 2px solid #8b5cf6;
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
        }
        
        .final-message .category-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-bottom-color: #8b5cf6;
        }
        
        .final-message .category-title {
            color: white;
        }
        
        .final-message .recommendation-item {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-left-color: #8b5cf6;
        }
        
        /* ESTILOS DE BODY Y FONDO - UNIFICADO CON COACH */
        body {
            background: #f8fafc !important;
            color: #1e293b !important;
            transition: all 0.3s ease;
        }
        
        /* Container principal con z-index para aparecer sobre partículas */
        .container-fluid {
            position: relative;
            z-index: 2;
        }
        
        /* Animated background particles - IGUAL QUE COACH */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }
        
        .particle {
            position: absolute;
            background: rgba(90, 103, 216, 0.08);
            border-radius: 50%;
            animation: float 25s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* Cards y contenedores - Con z-index para aparecer sobre partículas */
        /* Excluir tarjetas de estadísticas del estilo global */
        .card:not(.stats-card-mobile .card),
        .glass-card,
        .modal-content,
        .dashboard-card {
            background: white !important;
            border: 1px solid #e2e8f0 !important;
            color: #1e293b !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1) !important;
            border-radius: 0.5rem !important;
            transition: all 0.3s ease;
            position: relative;
            z-index: 2;
        }
        
        /* Estilos globales para modales */
        .modal {
            z-index: 1060 !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            overflow-x: hidden !important;
            overflow-y: auto !important;
        }

        .modal-backdrop {
            display: none !important;
            opacity: 0 !important;
            visibility: hidden !important;
        }

        .modal.show {
            display: block !important;
            background: rgba(0, 0, 0, 0.5) !important;
        }

        .modal-dialog {
            position: relative;
            z-index: 1060 !important;
            margin: 1.75rem auto !important;
        }

        .modal-content {
            position: relative;
            z-index: 1060 !important;
            pointer-events: auto !important;
        }

        /* Asegurar que todo el contenido del modal sea clickeable */
        .modal-body,
        .modal-body * {
            pointer-events: auto !important;
        }
        
        .card.bg-dark:not(.stats-card-mobile .card) {
            background: white !important;
            border: 1px solid #e2e8f0 !important;
        }
        
        .card.bg-dark .card-body:not(.stats-card-mobile .card-body) {
            background: white !important;
        }
    
        /* Textos */
        .text-white,
        .text-muted,
        .card.bg-dark .text-white,
        .card.bg-dark .text-muted {
            color: #1e293b !important;
        }
        
        .text-primary {
            color: var(--calm-secondary) !important;
        }
        
        .text-muted {
            color: #64748b !important;
        }
        
        /* Botones con hover - Reemplazo de eventos inline */
        .btn-hover-primary {
            background: white;
            border: 1px solid #e5e7eb;
            color: #667eea;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-hover-primary:hover {
            background: #667eea !important;
            color: white !important;
        }
        
        .btn-hover-warning {
            background: white;
            border: 1px solid #e5e7eb;
            color: #f59e0b;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-hover-warning:hover {
            background: #f59e0b !important;
            color: white !important;
        }
        
        .btn-hover-success {
            background: white;
            border: 1px solid #e5e7eb;
            color: #10b981;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-hover-success:hover {
            background: #10b981 !important;
            color: white !important;
        }
        
        .btn-hover-danger {
            background: white;
            border: 1px solid #e5e7eb;
            color: #ef4444;
            padding: 0.5rem 0.75rem;
            border-radius: 8px;
            font-size: 0.8125rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        .btn-hover-danger:hover {
            background: #ef4444 !important;
            color: white !important;
        }
        
        /* Statistics Cards - Efectos Hover Modernos */
        .stats-card-clickable:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15) !important;
        }
        
        .stats-card-clickable {
            cursor: pointer;
        }
        
        /* Responsive Stats Cards */
        @media (max-width: 768px) {
            .stats-card-mobile .card-body {
                padding: 1rem !important;
            }
        }
        
        /* Botones */
        .btn-outline-light {
            border-color: #e2e8f0 !important;
            color: #1e293b !important;
            background: white !important;
        }
        
        .btn-outline-light:hover {
            background: #f1f5f9 !important;
            border-color: #e2e8f0 !important;
            color: #1e293b !important;
        }
    
        .btn-primary {
            background: var(--calm-secondary) !important;
            border-color: var(--calm-secondary) !important;
            color: white !important;
        }
        
        .btn-success {
            background: #28a745 !important;
            border-color: #28a745 !important;
            color: white !important;
        }
        
        .btn-info {
            background: #17a2b8 !important;
            border-color: #17a2b8 !important;
            color: white !important;
        }
        
        /* ESTILOS GENERALES PARA DASHBOARD HEADER - ESTILO FEED */
        /* Header - UNIFICADO CON FEED */
        .feed-header {
            background: white;
            border-bottom: 1px solid #dbdbdb;
            padding: 12px 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .feed-header h3 {
            font-family: 'Lobster Two', cursive !important;
            font-size: 32px !important;
            font-weight: 400 !important;
            margin: 0 !important;
            color: #262626 !important;
            letter-spacing: 0.5px !important;
            line-height: 1.2 !important;
        }
        
        /* Responsive font sizes for InstaCoach title */
        @media (max-width: 768px) {
            .feed-header h3 {
                font-size: 40px !important;
            }
        }
        
        @media (max-width: 576px) {
            .feed-header h3 {
                font-size: 36px !important;
            }
        }
        
        /* Extra specificity for h3 to override any Bootstrap or default styles */
        .feed-header > div > h3,
        #instacoach-title {
            font-family: 'Lobster Two', cursive !important;
            font-size: 32px !important;
        }
        
        @media (max-width: 768px) {
            .feed-header > div > h3,
            #instacoach-title {
                font-size: 40px !important;
            }
        }
        
        @media (max-width: 576px) {
            .feed-header > div > h3,
            #instacoach-title {
                font-size: 36px !important;
            }
        }
        
        .feed-header .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .feed-header .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            font-weight: 600;
            overflow: hidden;
            border: 2px solid #ffffff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .feed-header .user-avatar:hover {
            transform: scale(1.08);
        }
        
        .feed-header .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .feed-header .dropdown .btn-link {
            font-size: 20px;
            text-decoration: none;
            opacity: 0.9;
            transition: opacity 0.2s;
            color: #262626 !important;
        }
        
        .feed-header .dropdown .btn-link:hover {
            opacity: 1;
            color: #000000 !important;
        }
        
        .feed-header .dropdown-menu {
            min-width: 200px;
        }
        
        /* STATISTICS CARDS MEJORADAS - DISEÑO MODERNO Y ATRACTIVO */
        /* .stats-card-mobile { margin-bottom removido } */
        
        /* Eliminar borde de los contenedores de iconos */
        .stats-card-mobile .card-body > div {
            border: none !important;
        }
        
        /* Estilos removidos - ahora se usan estilos inline en las tarjetas para mantener gradientes coloridos */
        
        /* TARJETA CLICKEABLE DE ESTADÍSTICAS */
        .stats-card-clickable {
            transition: all 0.3s ease;
            user-select: none !important;
        }
        
        .stats-card-clickable:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 10px 25px rgba(0,0,0,0.15) !important;
        }
        
        .stats-card-clickable:hover .fa-clipboard-check {
            color: #28a745 !important;
            transform: scale(1.1) !important;
        }
        
        .stats-card-clickable:hover .fa-tasks {
            color: #ffc107 !important;
            transform: scale(1.1) !important;
        }
        
        .stats-card-clickable:hover .fa-exclamation-triangle {
            color: #dc3545 !important;
            transform: scale(1.1) !important;
        }
        
        .stats-card-clickable:active {
            transform: translateY(-1px) !important;
            box-shadow: 0 6px 15px rgba(0,0,0,0.12) !important;
        }
        
        /* Borde superior removido */
        
        .stats-card-mobile .card-body {
            display: flex !important;
            flex-direction: column !important;
            justify-content: center !important;
            align-items: center !important;
            text-align: center !important;
            padding: 1.5rem 1rem !important;
            height: 100% !important;
            position: relative !important;
        }
        
        .stats-card-mobile .fa-2x {
            font-size: 2.25rem !important;
            margin-bottom: 0.75rem !important;
            opacity: 0.8 !important;
            transition: transform 0.2s ease !important;
        }
        
        .stats-card-mobile .card:hover .fa-2x {
            transform: scale(1.1) !important;
        }
        
        .stats-card-mobile h4 {
            font-size: 2rem !important;
            font-weight: 700 !important;
            margin-bottom: 0.25rem !important;
            line-height: 1.2 !important;
            color: #2c3e50 !important;
        }
        
        .stats-card-mobile .text-muted {
            font-size: 0.8rem !important;
            font-weight: 500 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.5px !important;
            color: #6c757d !important;
        }
        
        /* RESPONSIVE PARA ESTADÍSTICAS - Removido para usar estilos inline */
        @media (max-width: 768px) {
            .stats-card-mobile {
                margin-bottom: 1rem;
            }
            
            /* SIDEBAR OPTIMIZADO PARA MÓVIL */
            .sidebar {
                margin-bottom: 1.5rem !important;
            }
            
            .sidebar .card-header {
                padding: 1.25rem 1rem !important;
            }
            
            .sidebar .card-header h5 {
                font-size: 1rem !important;
            }
            
            .sidebar .card-header h5 i {
                font-size: 1.1rem !important;
                margin-right: 0.5rem !important;
            }
            
            .sidebar .card-header p {
                font-size: 0.75rem !important;
            }
            
            .sidebar .card-body {
                padding: 0.5rem 0.25rem !important;
            }
            
            .list-group-item {
                font-size: 0.875rem !important;
                padding: 0.75rem 1rem !important;
                margin: 0.125rem 0.25rem !important;
            }
            
            .list-group-item i {
                font-size: 0.875rem !important;
                margin-right: 0.625rem !important;
            }
            
            /* Estilos de card removidos - se usan inline para mantener gradientes */
        }
            
            .stats-card-mobile:nth-child(4) .card::before {
                background: linear-gradient(90deg, #a8edea 0%, #fed6e3 100%) !important;
            }
            
            /* NAVEGACIÓN OPTIMIZADA PARA MÓVIL */
            .nav-tabs {
                border-bottom: 1px solid #e9ecef !important;
                margin-bottom: 1rem !important;
                flex-wrap: wrap !important;
                gap: 0.25rem !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1rem !important;
                font-size: 0.9rem !important;
                font-weight: 500 !important;
                color: #6c757d !important;
                background: #f8f9fa !important;
                border: 1px solid #dee2e6 !important;
                border-radius: 0.5rem !important;
                margin-bottom: 0.25rem !important;
                transition: all 0.2s ease !important;
                white-space: nowrap !important;
                text-align: center !important;
                min-height: 44px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.5rem !important;
            }
            
            .nav-tabs .nav-link:hover {
                background: #e9ecef !important;
                color: #495057 !important;
                transform: translateY(-1px) !important;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            }
            
            .nav-tabs .nav-link.active {
                background: #007bff !important;
                color: #ffffff !important;
                border-color: #007bff !important;
                font-weight: 600 !important;
                box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            }
            
            /* Asegurar texto blanco en botones activos */
            .nav-tabs .nav-link.active,
            .nav-tabs .nav-link.active:hover,
            .nav-tabs .nav-link.active:focus,
            .nav-tabs .nav-link.active:active {
                color: #ffffff !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1rem !important;
                flex-shrink: 0 !important;
            }
            
            /* HEADERS DE CONTENIDO OPTIMIZADOS PARA MÓVIL */
            .card-header:not(.stats-card-mobile .card-header) {
                padding: 1rem 1rem !important;
            }
            
            .card-header h3,
            .card-header h4,
            .card-header h5 {
                font-size: 1rem !important;
                margin-bottom: 0.25rem !important;
            }
            
            .card-header p,
            .card-header small {
                font-size: 0.75rem !important;
            }
            
            /* Tab content optimizado para móvil */
            .tab-content {
                padding: 1rem 0 !important;
            }
            
            .tab-pane {
                animation: fadeIn 0.3s ease-in-out !important;
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            
            /* SECCIONES DE TAREAS Y EVALUACIONES OPTIMIZADAS */
            .task-item,
            .evaluation-item {
                padding: 0.875rem !important;
                margin-bottom: 0.75rem !important;
                border-radius: 0.5rem !important;
            }
            
            .task-header,
            .evaluation-header {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 0.5rem !important;
            }
            
            .task-title,
            .evaluation-title {
                font-size: 0.9375rem !important;
                line-height: 1.3 !important;
            }
            
            .task-description,
            .evaluation-description {
                font-size: 0.8125rem !important;
                line-height: 1.4 !important;
                margin-top: 0.5rem !important;
            }
            
            .task-meta,
            .evaluation-meta {
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
                margin-top: 0.5rem !important;
            }
            
            .task-badge,
            .evaluation-badge {
                font-size: 0.7rem !important;
                padding: 0.25rem 0.5rem !important;
            }
            
            .task-progress {
                margin-top: 0.75rem !important;
            }
            
            .progress {
                height: 8px !important;
                border-radius: 4px !important;
            }
            
            .evaluation-score {
                font-size: 1.25rem !important;
                padding: 0.5rem !important;
            }
            
            .evaluation-level {
                font-size: 0.8125rem !important;
                padding: 0.375rem 0.625rem !important;
            }
            
            /* RECOMENDACIONES OPTIMIZADAS */
            .recommendation-item {
                padding: 0.75rem !important;
                margin-bottom: 0.625rem !important;
                font-size: 0.875rem !important;
                line-height: 1.5 !important;
            }
            
            .category-header {
                padding: 0.875rem 1rem !important;
            }
            
            .category-title {
                font-size: 0.9375rem !important;
            }
            
            .general-recommendations,
            .strengths-category,
            .final-message {
                margin-bottom: 1rem !important;
                border-radius: 0.75rem !important;
            }
            
            /* GRÁFICOS Y VISUALIZACIONES OPTIMIZADOS */
            .chart-container,
            .radar-chart-container {
                padding: 0.75rem !important;
                height: auto !important;
                min-height: 250px !important;
                max-height: 300px !important;
            }
            
            canvas {
                max-height: 250px !important;
                width: 100% !important;
                height: auto !important;
            }
            
            /* GRUPOS DE BOTONES OPTIMIZADOS */
            .btn-group {
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
                width: 100% !important;
            }
            
            .btn-group .btn {
                flex: 1 1 auto !important;
                min-width: 100px !important;
                white-space: nowrap !important;
            }
            
            /* Botones con texto oculto en móvil */
            .btn .d-none.d-sm-inline {
                display: none !important;
            }
            
            @media (min-width: 576px) {
                .btn .d-none.d-sm-inline {
                    display: inline !important;
                }
            }
            
            /* SECCIÓN "MIS ACCIONES Y METAS" OPTIMIZADA */
            #tasks .card-header {
                padding: 1rem 1.25rem !important;
            }
            
            #tasks .card-body {
                padding: 0.75rem !important;
            }
            
            /* PLANES DE DESARROLLO OPTIMIZADOS */
            #development-plan .card-header {
                padding: 1rem 1.25rem !important;
            }
            
            #development-plan .card-body {
                padding: 0.75rem !important;
            }
            
            #development-plan .task-item {
                padding: 0.75rem !important;
            }
            
            /* MODALES OPTIMIZADOS PARA MÓVIL */
            .modal-dialog {
                margin: 6rem 1rem 1rem 1rem !important;
                max-width: calc(100vw - 2rem) !important;
                height: auto !important;
                max-height: calc(100vh - 7rem) !important;
                display: flex !important;
                align-items: flex-start !important;
            }
            
            .modal-content {
                max-height: calc(100vh - 2rem) !important;
                border-radius: 16px !important;
                border: none !important;
                box-shadow: 0 20px 60px rgba(0,0,0,0.15), 0 0 0 1px rgba(0,0,0,0.05) !important;
                display: flex !important;
                flex-direction: column !important;
                overflow: hidden !important;
            }
            
            .modal-header {
                background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%) !important;
                color: white !important;
                border-bottom: none !important;
                padding: 1.5rem !important;
                flex-shrink: 0 !important;
                position: relative !important;
            }
            
            .modal-header::after {
                content: '' !important;
                position: absolute !important;
                bottom: 0 !important;
                left: 0 !important;
                right: 0 !important;
                height: 3px !important;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent) !important;
            }
            
            .modal-title {
                color: white !important;
                font-weight: 600 !important;
                font-size: 1.15rem !important;
                letter-spacing: 0.3px !important;
                display: flex !important;
                align-items: center !important;
                gap: 0.75rem !important;
            }
            
            .modal-title i {
                font-size: 1.25rem !important;
                opacity: 0.95 !important;
            }
            
            .modal-header .btn-close {
                background: rgba(255, 255, 255, 0.2) !important;
                opacity: 1 !important;
                border-radius: 0.5rem !important;
                padding: 0.5rem !important;
                margin: 0 !important;
            }
            
            /* Animación mejorada para móvil - DESACTIVADA TEMPORALMENTE */
            /* .modal.fade .modal-dialog {
                transform: translateY(100%) !important;
                transition: transform 0.3s ease-out !important;
            }
            
            .modal.show .modal-dialog {
                transform: translateY(0) !important;
            } */
            
            /* BOTONES Y FORMULARIOS OPTIMIZADOS PARA MÓVIL */
            .btn {
                min-height: 44px !important;
                padding: 0.75rem 1rem !important;
                font-size: 0.875rem !important;
            }
            
            .btn-sm {
                min-height: 40px !important;
                padding: 0.5rem 0.75rem !important;
                font-size: 0.8125rem !important;
            }
            
            /* Grupos de botones optimizados */
            .btn-group {
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
            }
            
            .btn-group .btn {
                flex: 1 1 auto !important;
                min-width: 120px !important;
            }
            
            /* Botones de texto oculto en móvil - solo iconos */
            .btn .d-none.d-sm-inline {
                display: none !important;
            }
            
            @media (min-width: 576px) {
                .btn .d-none.d-sm-inline {
                    display: inline !important;
                }
            }
            
            /* FORMULARIOS OPTIMIZADOS PARA MÓVIL */
            .form-control, .form-select {
                min-height: 44px !important;
                padding: 0.75rem 1rem !important;
                font-size: 0.95rem !important;
                border: 2px solid #e9ecef !important;
                border-radius: 0.5rem !important;
                background: #ffffff !important;
                transition: all 0.2s ease !important;
            }
            
            .form-control:focus, .form-select:focus {
                border-color: #007bff !important;
                box-shadow: 0 0 0 0.2rem rgba(0,123,255,0.15) !important;
                outline: none !important;
                transform: scale(1.02) !important;
            }
            
            .form-label {
                font-weight: 600 !important;
                color: #495057 !important;
                margin-bottom: 0.5rem !important;
                font-size: 0.9rem !important;
            }
            
            .input-group {
                gap: 0.5rem !important;
            }
            
            .input-group-text {
                min-height: 44px !important;
                padding: 0.75rem 1rem !important;
                background: #f8f9fa !important;
                border: 2px solid #e9ecef !important;
                border-radius: 0.5rem !important;
                font-weight: 500 !important;
            }
            
            /* BADGES Y PILLS OPTIMIZADOS */
            .badge {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.75rem !important;
                font-weight: 600 !important;
                border-radius: 0.375rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
            }
            
            .badge-pill {
                border-radius: 10rem !important;
                padding: 0.375rem 0.75rem !important;
            }
            
            /* TIPOGRAFÍA Y ESPACIADO OPTIMIZADO PARA MÓVIL - IGUALADO CON FEED */
            /* Se eliminó font-size de body para usar defaults del navegador como Feed */
            
            /* Espaciado de secciones optimizado */
            .container-fluid {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
            }
            
            .row {
                margin-left: -0.5rem !important;
                margin-right: -0.5rem !important;
            }
            
            .col, [class*="col-"] {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
                margin-bottom: 1rem !important;
            }
            
            .mb-1 { margin-bottom: 0.5rem !important; }
            .mb-2 { margin-bottom: 0.75rem !important; }
            .mb-3 { margin-bottom: 1rem !important; }
            .mb-4 { margin-bottom: 1.5rem !important; }
            .mb-5 { margin-bottom: 2rem !important; }
            
            .mt-1 { margin-top: 0.5rem !important; }
            .mt-2 { margin-top: 0.75rem !important; }
            .mt-3 { margin-top: 1rem !important; }
            .mt-4 { margin-top: 1.5rem !important; }
            .mt-5 { margin-top: 2rem !important; }
            
            .py-1 { padding-top: 0.5rem !important; padding-bottom: 0.5rem !important; }
            .py-2 { padding-top: 0.75rem !important; padding-bottom: 0.75rem !important; }
            .py-3 { padding-top: 1rem !important; padding-bottom: 1rem !important; }
            .py-4 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
            .py-5 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
            
            /* Texto optimizado para legibilidad */
            .text-small { font-size: 0.8rem !important; }
            .text-large { font-size: 1.1rem !important; }
            .text-xs { font-size: 0.7rem !important; }
            
            .fw-light { font-weight: 300 !important; }
            .fw-normal { font-weight: 400 !important; }
            .fw-medium { font-weight: 500 !important; }
            .fw-semibold { font-weight: 600 !important; }
            .fw-bold { font-weight: 700 !important; }
            
            /* Lista y contenido mejorado */
            ul, ol {
                padding-left: 1.5rem !important;
                margin-bottom: 1rem !important;
            }
            
            li {
                margin-bottom: 0.25rem !important;
                line-height: 1.5 !important;
            }
            
            .list-unstyled {
                padding-left: 0 !important;
            }
            
            .list-unstyled li {
                margin-bottom: 0.5rem !important;
            }
        }

        /* SECCIONES DE TAREAS Y EVALUACIONES OPTIMIZADAS MÓVIL */
        @media (max-width: 768px) {
            .task-item,
            .evaluation-item {
                padding: 0.875rem !important;
                margin-bottom: 0.75rem !important;
            }
            
            .task-header,
            .evaluation-header {
                flex-direction: column !important;
                align-items: flex-start !important;
                gap: 0.5rem !important;
            }
            
            .task-title,
            .evaluation-title {
                font-size: 0.9375rem !important;
            }
            
            .task-description,
            .evaluation-description {
                font-size: 0.8125rem !important;
                line-height: 1.4 !important;
            }
            
            .task-meta,
            .evaluation-meta {
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
            }
            
            .task-badge,
            .evaluation-badge {
                font-size: 0.7rem !important;
                padding: 0.25rem 0.5rem !important;
            }
            
            /* Barra de progreso en tareas */
            .task-progress {
                margin-top: 0.75rem !important;
            }
            
            .progress {
                height: 8px !important;
            }
            
            /* SECCIÓN DE RECOMENDACIONES OPTIMIZADA */
            .recommendation-item {
                padding: 0.75rem !important;
                margin-bottom: 0.625rem !important;
                font-size: 0.875rem !important;
            }
            
            .category-header {
                padding: 0.875rem 1rem !important;
            }
            
            .category-title {
                font-size: 0.9375rem !important;
            }
            
            /* GRÁFICOS Y VISUALIZACIONES OPTIMIZADOS */
            .chart-container,
            .radar-chart-container {
                padding: 0.75rem !important;
                height: auto !important;
                min-height: 250px !important;
            }
            
            canvas {
                max-height: 250px !important;
            }
        }
        
        /* OPTIMIZACIÓN ESPECÍFICA PARA TABLET (768px - 1024px) */
        @media (min-width: 768px) and (max-width: 1024px) {
            .container-fluid {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
            
            /* Cards de estadísticas - estilos inline */
            .stats-card-mobile {
                margin-bottom: 1.5rem;
            }
            
            .stats-card-mobile h4 {
                font-size: 2.5rem !important;
                margin-bottom: 0.5rem !important;
            }
            
            .stats-card-mobile .text-muted {
                font-size: 0.9rem !important;
            }
            
            /* Gráficos más grandes en tablet */
            .chart-container {
                min-height: 350px !important;
                padding: 1.5rem !important;
            }
            
            .radar-chart-container {
                min-height: 400px !important;
            }
            
            /* Grid más eficiente para contenido principal */
            .row > .col-lg-6 {
                margin-bottom: 2rem !important;
            }
            
            .row > .col-lg-12 {
                margin-bottom: 2rem !important;
            }
            
            /* Cards de evaluaciones optimizadas para tablet */
            .evaluation-item {
                padding: 1.75rem !important;
                margin-bottom: 1.5rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.08) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .evaluation-item::before {
                height: 5px !important;
                border-radius: 0 0 5px 5px !important;
            }
            
            .evaluation-item:hover {
                transform: translateY(-4px) !important;
                box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
            }
            
            .evaluation-score {
                font-size: 2.75rem !important;
                font-weight: 800 !important;
                margin-bottom: 0.75rem !important;
                text-align: center !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                -webkit-background-clip: text !important;
                -webkit-text-fill-color: transparent !important;
                background-clip: text !important;
            }
            
            .evaluation-level {
                font-size: 1.2rem !important;
                font-weight: 700 !important;
                text-align: center !important;
                margin-bottom: 1.25rem !important;
                color: #2c3e50 !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
            }
            
            .evaluation-description {
                padding: 1.5rem !important;
                font-size: 1rem !important;
                line-height: 1.6 !important;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
                border-radius: 0.75rem !important;
                border-left: 5px solid var(--calm-primary) !important;
                color: #495057 !important;
            }
            
            .evaluation-date {
                font-size: 0.9rem !important;
                color: #6c757d !important;
                font-weight: 500 !important;
                text-align: center !important;
                margin-top: 1.25rem !important;
                padding: 0.75rem !important;
                background: rgba(108, 117, 125, 0.1) !important;
                border-radius: 0.5rem !important;
            }
            
            /* Cards de tareas optimizadas para tablet */
            .task-item {
                padding: 1.75rem !important;
                margin-bottom: 1.5rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.08) !important;
                transition: all 0.3s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .task-item::before {
                width: 5px !important;
                background: linear-gradient(180deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                border-radius: 0 5px 5px 0 !important;
            }
            
            .task-item:hover {
                transform: translateY(-4px) !important;
                box-shadow: 0 10px 30px rgba(0,0,0,0.15) !important;
            }
            
            .task-header {
                display: flex !important;
                justify-content: space-between !important;
                align-items: flex-start !important;
                margin-bottom: 1.25rem !important;
                gap: 1rem !important;
            }
            
            .task-title {
                font-size: 1.2rem !important;
                font-weight: 700 !important;
                color: #2c3e50 !important;
                line-height: 1.4 !important;
                flex: 1 !important;
            }
            
            .task-description {
                font-size: 1rem !important;
                color: #495057 !important;
                margin-bottom: 1.25rem !important;
                line-height: 1.6 !important;
                background: rgba(248, 249, 250, 0.8) !important;
                padding: 1rem !important;
                border-radius: 0.5rem !important;
                border-left: 4px solid var(--calm-accent) !important;
            }
            
            .task-meta {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 0.75rem !important;
                margin-bottom: 1.25rem !important;
                align-items: center !important;
            }
            
            .task-badge {
                padding: 0.5rem 1rem !important;
                font-size: 0.8rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
                min-height: 32px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .task-progress {
                margin-top: 1.25rem !important;
                padding: 1rem !important;
                background: rgba(233, 236, 239, 0.5) !important;
                border-radius: 0.5rem !important;
            }
            
            /* Modales optimizados para tablet */
            .modal-dialog {
                max-width: 900px !important;
                margin: 2rem auto !important;
            }
            
            .modal-xl {
                max-width: 1100px !important;
            }
            
            .modal-content {
                border-radius: 1rem !important;
                border: none !important;
                box-shadow: 0 15px 50px rgba(0,0,0,0.15) !important;
                overflow: hidden !important;
            }
            
            .modal-header {
                background: linear-gradient(135deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                color: white !important;
                border-bottom: none !important;
                padding: 1.5rem !important;
            }
            
            .modal-title {
                color: white !important;
                font-weight: 600 !important;
                font-size: 1.25rem !important;
            }
            
            .modal-header .btn-close {
                background: rgba(255, 255, 255, 0.2) !important;
                opacity: 1 !important;
                border-radius: 0.5rem !important;
                padding: 0.75rem !important;
                margin: 0 !important;
            }
            
            .modal-body {
                padding: 2rem !important;
                max-height: 70vh !important;
                overflow-y: auto !important;
            }
            
            .modal-footer {
                background: #f8f9fa !important;
                border-top: 1px solid #e9ecef !important;
                padding: 1.25rem 2rem !important;
                gap: 1rem !important;
            }
            
            .modal-footer .btn {
                min-height: 44px !important;
                padding: 0.75rem 2rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
            }
            
            /* Navegación de pestañas mejorada para tablet */
            .nav-tabs {
                border-bottom: 2px solid #e9ecef !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1.5rem !important;
                font-size: 1rem !important;
                font-weight: 500 !important;
                color: #6c757d !important;
                border-radius: 0.5rem 0.5rem 0 0 !important;
                margin-right: 0.25rem !important;
                background: #f8f9fa !important;
                border: 1px solid #dee2e6 !important;
                border-bottom: none !important;
                transition: all 0.2s ease !important;
            }
            
            .nav-tabs .nav-link:hover {
                background: #e9ecef !important;
                color: #495057 !important;
                transform: translateY(-1px) !important;
            }
            
            .nav-tabs .nav-link.active {
                background: #007bff !important;
                color: #ffffff !important;
                border-color: #007bff !important;
                font-weight: 600 !important;
                box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            }
            
            /* ========== ANULAR BOOTSTRAP EN TABLET TAMBIÉN ========== */
            
            /* MÁXIMA ESPECIFICIDAD - Tablet nav-link effects */
            ul.nav.nav-tabs li.nav-item button.nav-link:active,
            ul.nav.nav-tabs li.nav-item button.nav-link.active:active,
            .nav-tabs .nav-item .nav-link:active,
            .nav-tabs .nav-item .nav-link.active:active,
            button.nav-link:active,
            button.nav-link.active:active {
                transform: none !important;
                box-shadow: inherit !important;
                opacity: 1 !important;
                filter: none !important;
                background: #007bff !important;
                color: #ffffff !important;
                transition: none !important;
                border-color: #007bff !important;
            }
            
            /* Asegurar texto blanco en botones activos - tablet */
            .nav-tabs .nav-link.active,
            .nav-tabs .nav-link.active:hover,
            .nav-tabs .nav-link.active:focus,
            .nav-tabs .nav-link.active:active {
                color: #ffffff !important;
                background: #007bff !important;
                transform: none !important;
                opacity: 1 !important;
                filter: none !important;
                border-color: #007bff !important;
                box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1.1rem !important;
                margin-right: 0.5rem !important;
            }
            
            /* Espaciado mejorado entre secciones */
            .dashboard-card {
                margin-bottom: 2rem !important;
            }
            
            .tab-content {
                padding: 1.5rem !important;
            }
            
            /* Botones y formularios optimizados para tablet */
            .btn {
                min-height: 44px !important;
                padding: 0.75rem 1.5rem !important;
                font-size: 0.95rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                border: none !important;
                transition: all 0.2s ease !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.5rem !important;
                touch-action: manipulation !important;
            }
            
            .btn:hover, .btn:focus {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 16px rgba(0,0,0,0.15) !important;
            }
            
            .btn-lg {
                min-height: 52px !important;
                padding: 1rem 2.5rem !important;
                font-size: 1.1rem !important;
                font-weight: 700 !important;
            }
            
            .btn-sm {
                min-height: 40px;
                padding: 0.5rem 0.75rem;
            }
            
            /* Formularios optimizados para tablet */
            .form-control, .form-select {
                min-height: 44px !important;
                padding: 0.75rem 1.25rem !important;
                font-size: 1rem !important;
                border: 2px solid #e9ecef !important;
                border-radius: 0.5rem !important;
                transition: all 0.2s ease !important;
            }
            
            .form-control:focus, .form-select:focus {
                border-color: #007bff !important;
                box-shadow: 0 0 0 0.25rem rgba(0,123,255,0.15) !important;
                transform: scale(1.01) !important;
            }
            
            .form-label {
                font-weight: 600 !important;
                font-size: 0.95rem !important;
                margin-bottom: 0.75rem !important;
            }
            
            .input-group-text {
                min-height: 44px !important;
                padding: 0.75rem 1.25rem !important;
                font-size: 0.95rem !important;
            }
            
            .badge {
                padding: 0.5rem 1rem !important;
                font-size: 0.8rem !important;
                font-weight: 600 !important;
            }
            
            /* TIPOGRAFÍA Y ESPACIADO OPTIMIZADO PARA TABLET - IGUALADO CON FEED */
            /* Se eliminó font-size de body para usar defaults del navegador como Feed */
            
            /* Espaciado de secciones optimizado para tablet */
            .container-fluid {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
            
            .row {
                margin-left: -1rem !important;
                margin-right: -1rem !important;
            }
            
            .col, [class*="col-"] {
                padding-left: 1rem !important;
                padding-right: 1rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            /* Margens y padding más generosos */
            .mb-1 { margin-bottom: 0.75rem !important; }
            .mb-2 { margin-bottom: 1rem !important; }
            .mb-3 { margin-bottom: 1.5rem !important; }
            .mb-4 { margin-bottom: 2rem !important; }
            .mb-5 { margin-bottom: 2.5rem !important; }
            
            .py-1 { padding-top: 0.75rem !important; padding-bottom: 0.75rem !important; }
            .py-2 { padding-top: 1rem !important; padding-bottom: 1rem !important; }
            .py-3 { padding-top: 1.5rem !important; padding-bottom: 1.5rem !important; }
            .py-4 { padding-top: 2rem !important; padding-bottom: 2rem !important; }
            .py-5 { padding-top: 2.5rem !important; padding-bottom: 2.5rem !important; }
            
            /* Lista optimizada para tablet */
            ul, ol {
                padding-left: 2rem !important;
                margin-bottom: 1.5rem !important;
            }
            
            li {
                margin-bottom: 0.5rem !important;
                line-height: 1.6 !important;
            }
        }

        /* ANIMACIONES Y TRANSICIONES SUAVES - EXPERIENCIA MEJORADA */
        
        /* Transiciones globales para elementos interactivos (excluye stats cards) */
        .card:not(.stats-card-mobile .card), .btn, .progress-bar, .form-control, .form-select, .modal-content, 
        .nav-link, .dropdown-menu, .alert, .badge, .task-item, .evaluation-item {
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1) !important;
        }
        
        /* Animaciones de hover mejoradas (excluye stats cards) */
        .card:not(.stats-card-mobile .card):hover, .btn:hover, .nav-link:hover, .task-item:hover, 
        .evaluation-item:hover {
            transition: all 0.2s ease-out !important;
        }
        
        /* Animación de click/active para botones */
        .btn:active {
            transform: scale(0.98) !important;
            transition: transform 0.1s ease !important;
        }
        
        /* Eliminar TODOS los efectos en nav-links para evitar oscurecimiento */
        .nav-link:active,
        .nav-tabs .nav-link:active,
        .nav-tabs .nav-link.active:active {
            transform: none !important;
            box-shadow: inherit !important;
            opacity: 1 !important;
            filter: none !important;
            background: inherit !important;
            color: inherit !important;
            transition: none !important;
        }
        
        /* Forzar color blanco en botones activos específicamente */
        .nav-tabs .nav-link.active:active {
            color: #ffffff !important;
            background: #007bff !important;
        }
        
        /* ============ ANULAR BOOTSTRAP 5.3.3 COMPLETAMENTE ============ */
        
        /* MÁXIMA ESPECIFICIDAD - Anular Bootstrap nav-link effects */
        ul.nav.nav-tabs li.nav-item button.nav-link:active,
        ul.nav.nav-tabs li.nav-item button.nav-link.active:active,
        .nav-tabs .nav-item .nav-link:active,
        .nav-tabs .nav-item .nav-link.active:active,
        button.nav-link:active,
        button.nav-link.active:active {
            transform: none !important;
            box-shadow: inherit !important;
            opacity: 1 !important;
            filter: none !important;
            background: #007bff !important;
            color: #ffffff !important;
            transition: none !important;
            border-color: #007bff !important;
            text-decoration: none !important;
        }
        
        /* Anular TODOS los efectos de Bootstrap en nav-links */
        .nav-link:active,
        .nav-link:focus,
        .nav-link:hover:active,
        .nav-tabs .nav-link:active,
        .nav-tabs .nav-link:focus,
        .nav-tabs .nav-link:hover:active {
            background-color: inherit !important;
            border-color: inherit !important;
            color: inherit !important;
            transform: none !important;
            box-shadow: none !important;
            opacity: 1 !important;
            filter: none !important;
        }
        
        /* FORZAR estilos en botones activos específicamente */
        .nav-tabs .nav-link.active:active,
        .nav-tabs .nav-link.active:focus,
        .nav-tabs .nav-link.active:hover:active {
            background-color: #007bff !important;
            border-color: #007bff !important;
            color: #ffffff !important;
            transform: none !important;
            box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            opacity: 1 !important;
            filter: none !important;
        }
        
        /* Eliminar highlight táctil en dispositivos móviles */
        .nav-link {
            -webkit-tap-highlight-color: transparent !important;
            -webkit-touch-callout: none !important;
            -webkit-user-select: none !important;
            -khtml-user-select: none !important;
            -moz-user-select: none !important;
            -ms-user-select: none !important;
            user-select: none !important;
            outline: none !important;
        }
        
        .nav-link:focus {
            outline: none !important;
            box-shadow: none !important;
        }
        
        /* ========== FUERZA BRUTA: TEXTO BLANCO SIEMPRE ========== */
        
        /* NIVEL 1: Especificidad máxima con IDs */
        #scheduleCoachTabs.nav.nav-tabs .nav-item .nav-link:active,
        #scheduleCoachTabs.nav.nav-tabs .nav-item .nav-link.active:active,
        #scheduleCoachTabs .nav-link:active,
        #scheduleCoachTabs .nav-link.active:active {
            background-color: #007bff !important;
            border-color: #007bff !important;
            color: #ffffff !important;
            transform: none !important;
            box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            opacity: 1 !important;
            filter: none !important;
            transition: none !important;
            outline: none !important;
        }
        
        /* NIVEL 2: Fuerza bruta - TODOS los selectores posibles */
        #scheduleCoachTabs button:active,
        #scheduleCoachTabs button.active:active,
        #scheduleCoachTabs .nav-link:active,
        #scheduleCoachTabs .nav-link.active:active,
        #scheduleCoachTabs .nav-tabs .nav-link:active,
        #scheduleCoachTabs .nav-tabs .nav-link.active:active,
        ul#scheduleCoachTabs.nav.nav-tabs li.nav-item button.nav-link:active,
        ul#scheduleCoachTabs.nav.nav-tabs li.nav-item button.nav-link.active:active {
            color: #ffffff !important;
            background-color: #007bff !important;
            border-color: #007bff !important;
        }
        
        /* NIVEL 3: Fuerza bruta - Selectores de atributo */
        button[id="schedule-request-tab"]:active,
        button[id="my-sessions-tab"]:active,
        button[id="schedule-request-tab"].active:active,
        button[id="my-sessions-tab"].active:active {
            color: #ffffff !important;
            background-color: #007bff !important;
            border-color: #007bff !important;
        }
        
        /* NIVEL 4: JavaScript override backup */
        .force-white-text:active,
        .force-white-text.active:active {
            color: #ffffff !important;
            background-color: #007bff !important;
        }
        
        /* NIVEL 5: NUCLEAR OPTION - Aplicar DESPUÉS de Bootstrap */
        @media screen {
            #schedule-request-tab,
            #my-sessions-tab {
                transition: none !important;
            }
            
            #schedule-request-tab.active,
            #my-sessions-tab.active {
                color: #ffffff !important;
                background-color: #007bff !important;
                border-color: #007bff !important;
            }
            
            #schedule-request-tab:active,
            #schedule-request-tab.active:active,
            #my-sessions-tab:active,
            #my-sessions-tab.active:active {
                color: #ffffff !important;
                background-color: #007bff !important;
                border-color: #007bff !important;
                transform: none !important;
                opacity: 1 !important;
                filter: none !important;
                box-shadow: 0 2px 6px rgba(0,123,255,0.3) !important;
            }
        }
        
        /* Animación de entrada para cards */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes slideInLeft {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        
        @keyframes shimmer {
            0% {
                background-position: -200px 0;
            }
            100% {
                background-position: calc(200px + 100%) 0;
            }
        }
        
        /* Animaciones removidas para stats cards - mantener estilos inline */
        
        .task-item {
            animation: slideInLeft 0.5s ease-out forwards;
        }
        
        .evaluation-item {
            animation: fadeInUp 0.5s ease-out forwards;
        }
        
        /* Loading state para botones */
        .btn:disabled {
            position: relative;
            overflow: hidden;
        }
        
        .btn:disabled::before {
            content: '';
            position: absolute;
            top: 0;
            left: -200px;
            width: 200px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: shimmer 1.5s infinite;
        }
        
        /* Animación de progreso para barras */
        .progress-bar {
            transition: width 0.8s ease-out !important;
        }
        
        /* Mejoras para modales - DESACTIVADA TEMPORALMENTE */
        /* .modal.fade .modal-dialog {
            transform: translateY(-50px);
            transition: transform 0.3s ease-out;
        }
        
        .modal.show .modal-dialog {
            transform: translateY(0);
        } */
        
        /* Hover effects especiales */
        .nav-tabs .nav-link {
            position: relative;
            overflow: hidden;
        }
        
        .nav-tabs .nav-link::before {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--calm-primary), var(--calm-secondary));
            transition: width 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover::before,
        .nav-tabs .nav-link.active::before {
            width: 100%;
        }
        
        /* Smooth scroll para navegación */
        html {
            scroll-behavior: smooth;
        }
        
        /* TAMAÑO BASE DE REM EN MÓVIL - IGUALADO CON COACH DASHBOARD (sin reducción) */
        @media (max-width: 768px) {
            html {
                font-size: 16px; /* Mantener 16px igual que coach dashboard */
            }
        }
        
        @media (max-width: 576px) {
            html {
                font-size: 16px; /* Mantener 16px igual que coach dashboard */
            }
        }
        
        /* Micro-interacciones para badges */
        .task-badge, .badge {
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
        }
        
        .task-badge:hover, .badge:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15) !important;
        }
        
        /* Animación de focus para formularios */
        .form-control:focus, .form-select:focus {
            transform: scale(1.02);
            box-shadow: 0 0 0 0.2rem rgba(var(--calm-primary-rgb), 0.25) !important;
        }
        
        /* Stagger animation para listas */
        .task-item:nth-child(1) { animation-delay: 0.1s; }
        .task-item:nth-child(2) { animation-delay: 0.2s; }
        .task-item:nth-child(3) { animation-delay: 0.3s; }
        .task-item:nth-child(4) { animation-delay: 0.4s; }
        .task-item:nth-child(5) { animation-delay: 0.5s; }
        
        .evaluation-item:nth-child(1) { animation-delay: 0.1s; }
        .evaluation-item:nth-child(2) { animation-delay: 0.2s; }
        .evaluation-item:nth-child(3) { animation-delay: 0.3s; }
        .evaluation-item:nth-child(4) { animation-delay: 0.4s; }
        
        /* Reducir animaciones si el usuario prefiere menos movimiento */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: rgba(90, 103, 216, 0.08); /* Calm's signature blue with very low opacity */
            border-radius: 50%;
            animation: float 25s infinite linear; /* Slower, more peaceful animation */
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% {
                transform: translateY(-100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Custom header */
        .custom-header {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--calm-border);
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 20px rgba(90, 103, 216, 0.06); /* Softer shadow with new blue */
        }

        .custom-header .navbar-brand {
            color: var(--calm-text-primary) !important;
            font-weight: 600;
            font-size: 1.5rem;
        }

        .user-display {
            color: var(--calm-text-primary);
            font-weight: 500;
            background: var(--calm-surface-elevated);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            border: 1px solid var(--calm-border);
        }

        /* Logout button styles */
        .logout-btn {
            background: var(--calm-surface-elevated);
            border: 1px solid var(--calm-border);
            color: var(--calm-text-primary);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            margin-left: 1rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .logout-btn:hover {
            background: var(--calm-primary);
            border-color: var(--calm-primary);
            color: white;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(90, 103, 216, 0.25); /* Updated with new primary color */
        }

        .logout-btn:active {
            transform: translateY(0);
        }

        /* Responsive styles for logout button */
        @media (max-width: 768px) {
            .logout-btn {
                margin-left: 0.5rem;
                padding: 0.4rem 0.8rem;
                font-size: 0.8rem;
            }
            
            .logout-btn .fa-sign-out-alt {
                margin-right: 0.3rem;
            }
            
            .user-display {
                padding: 0.4rem 0.8rem;
                font-size: 0.9rem;
            }
        }

        @media (max-width: 576px) {
            .logout-btn {
                padding: 0.3rem 0.6rem;
                font-size: 0.75rem;
            }
            
            .logout-btn span {
                display: none; /* Hide text on very small screens */
            }
            
            .logout-btn {
                margin-left: 0.3rem;
            }
        }

        /* Main container */
        .main-container {
            position: relative;
            z-index: 2;
            min-height: calc(100vh - 80px);
            padding: 2rem 1rem;
        }

        /* Dashboard cards - OPTIMIZADO PARA MÓVIL Y TABLET */
        .dashboard-card {
            background: linear-gradient(135deg, #FFFFFF 0%, #EFF6FF 100%) !important;
            border-radius: 16px !important;
            box-shadow: 0 8px 32px rgba(30, 58, 138, 0.15) !important;
            overflow: hidden !important;
            margin-bottom: 2rem !important;
            border: 2px solid var(--calm-primary) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
        }

        .dashboard-card:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 12px 40px rgba(30, 58, 138, 0.25) !important;
        }

        /* CARDS MÓVIL OPTIMIZADAS */
        @media (max-width: 768px) {
            .dashboard-card {
                margin-bottom: 1.5rem !important;
                border-radius: 12px !important;
                box-shadow: 0 4px 16px rgba(30, 58, 138, 0.12) !important;
                border: 1px solid var(--calm-primary) !important;
            }
            
            .dashboard-card:hover {
                transform: translateY(-1px) !important;
                box-shadow: 0 6px 20px rgba(30, 58, 138, 0.18) !important;
            }
            
            /* Layout en columna para móvil */
            .row .col-lg-6 {
                margin-bottom: 1rem !important;
            }
            
            .row .col-lg-6:last-child {
                margin-bottom: 0 !important;
            }
        }

        /* CARDS TABLET OPTIMIZADAS */
        @media (min-width: 768px) and (max-width: 1024px) {
            .dashboard-card {
                margin-bottom: 1.75rem !important;
                border-radius: 14px !important;
                box-shadow: 0 6px 24px rgba(30, 58, 138, 0.14) !important;
            }
            
            .dashboard-card:hover {
                transform: translateY(-1px) !important;
                box-shadow: 0 8px 28px rgba(30, 58, 138, 0.22) !important;
            }
        }

        /* GRID RESPONSIVO MEJORADO */
        @media (max-width: 992px) {
            .row {
                margin-left: 0 !important;
                margin-right: 0 !important;
            }
            
            .row > [class*="col-"] {
                padding-left: 0.75rem !important;
                padding-right: 0.75rem !important;
            }
        }

        @media (max-width: 768px) {
            .row > [class*="col-"] {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
                margin-bottom: 1rem !important;
            }
        }

        .card-header:not(#development-plan .card *):not(#tasks .card *) {
            background: #ffffff !important;
            padding: 1.5rem !important;
            border-bottom: 1px solid #f3f4f6 !important;
            color: #111827 !important;
            border-radius: 16px 16px 0 0 !important;
        }

        .card-header h3 {
            margin: 0 !important;
            color: #111827 !important;
            font-weight: 600 !important;
            font-size: 1.25rem !important;
            line-height: 1.4 !important;
        }

        .card-header * {
            color: #111827 !important;
        }
        
        /* Override removido - Los colores inline tienen prioridad */
        /* Las reglas inline en cada sección controlan el color correctamente */

        /* CARD HEADERS MÓVIL OPTIMIZADOS */
        @media (max-width: 768px) {
            .card-header:not(#development-plan .card *):not(#tasks .card *) {
                padding: 1rem 1.25rem !important;
                border-radius: 12px 12px 0 0 !important;
            }
            
            .card-header:not(#development-plan .card *):not(#tasks .card *) h3 {
                font-size: 1.1rem !important;
                font-weight: 700 !important;
                line-height: 1.3 !important;
            }
            
            .card-header:not(#development-plan .card *):not(#tasks .card *) i {
                font-size: 1rem !important;
                margin-right: 0.5rem !important;
            }
        }

        /* CARD HEADERS TABLET OPTIMIZADOS */
        @media (min-width: 768px) and (max-width: 1024px) {
            .card-header:not(#development-plan .card *):not(#tasks .card *) {
                padding: 1.25rem 1.5rem !important;
                border-radius: 14px 14px 0 0 !important;
            }
            
            .card-header:not(#development-plan .card *):not(#tasks .card *) h3 {
                font-size: 1.2rem !important;
                font-weight: 650 !important;
            }
            
            .card-header:not(#development-plan .card *):not(#tasks .card *) i {
                font-size: 1.1rem !important;
                margin-right: 0.6rem !important;
            }
        }

        /* CARD BODY RESPONSIVO */
        .card-body:not(#development-plan .card *):not(#tasks .card *) {
            padding: 1.5rem !important;
        }

        @media (max-width: 768px) {
            .card-body:not(#development-plan .card *):not(#tasks .card *) {
                padding: 1rem 1.25rem !important;
            }
        }

        @media (min-width: 768px) and (max-width: 1024px) {
            .card-body:not(#development-plan .card *):not(#tasks .card *) {
                padding: 1.25rem 1.5rem !important;
            }
        }

        /* TAB CONTENT RESPONSIVO */
        .tab-content {
            padding: 0 !important;
            margin-top: -1.5rem !important; /* Alineado con separación de stats cards */
        }

        .tab-pane {
            min-height: 400px !important;
        }

        /* CONTENIDO DE PESTAÑAS MÓVIL */
        @media (max-width: 768px) {
            .tab-content {
                padding: 0 !important;
            }
            
            .tab-pane {
                min-height: 300px !important;
            }
            
            /* Layout stack en móvil */
            .tab-pane .row .col-lg-6 {
                width: 100% !important;
                margin-bottom: 1.5rem !important;
            }
            
            .tab-pane .row .col-lg-6:last-child {
                margin-bottom: 1rem !important;
            }
        }

        /* CONTENIDO DE PESTAÑAS TABLET */
        @media (min-width: 768px) and (max-width: 1024px) {
            .tab-content {
                padding: 0.875rem 0 !important;
            }
            
            .tab-pane {
                min-height: 350px !important;
            }
            
            .tab-pane .row .col-lg-6 {
                margin-bottom: 1.25rem !important;
            }
        }

        /* LOADING STATES MEJORADOS */
        .loading-spinner {
            display: flex !important;
            justify-content: center !important;
            align-items: center !important;
            min-height: 200px !important;
            flex-direction: column !important;
        }

        .spinner-border-custom {
            color: var(--calm-primary) !important;
            width: 2.5rem !important;
            height: 2.5rem !important;
        }

        @media (max-width: 768px) {
            .loading-spinner {
                min-height: 150px !important;
            }
            
            .spinner-border-custom {
                width: 2rem !important;
                height: 2rem !important;
            }
        }

        /* Sobrescribir clases de Bootstrap dentro de headers azules */
        .card-header .text-muted,
        .card-header .text-secondary,
        .card-header small,
        .card-header span {
            color: #FFFFFF !important; /* FORZAR BLANCO PARA TEXTO EN HEADERS AZULES */
        }

        /* Sobrescribir texto en pestañas con fondo azul */
        .nav-tabs .nav-link .text-muted,
        .nav-tabs .nav-link .text-secondary,
        .nav-tabs .nav-link small,
        .nav-tabs .nav-link span {
            color: #FFFFFF !important; /* FORZAR BLANCO PARA TEXTO EN PESTAÑAS AZULES */
        }

        .card-body {
            padding: 1.5rem;
        }

        /* ESTILOS PARA SECCIÓN MI CONTENIDO - TARJETAS DE VIDEO */
        .content-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            padding: 1rem;
        }

        .content-card:hover {
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }

        .content-card.viewed {
            opacity: 0.85;
        }

        .content-preview {
            width: 100%;
            border-radius: 8px;
            overflow: hidden;
            background: #f5f5f5;
        }

        .content-preview .ratio {
            background: #000;
        }

        .content-preview iframe {
            width: 100%;
            height: 100%;
        }

        .content-title {
            color: #1e293b;
            font-size: 1rem;
        }

        .content-info {
            flex: 1;
        }

        .content-description {
            color: #64748b;
        }

        .content-meta {
            color: #94a3b8;
            font-size: 0.875rem;
        }

        .content-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Responsive para tarjetas de contenido */
        @media (max-width: 768px) {
            .content-card {
                padding: 0.75rem;
            }

            .content-title {
                font-size: 0.9rem;
            }

            .content-actions {
                flex-direction: column;
            }

            .content-actions .btn {
                width: 100%;
            }
        }

        /* Navigation tabs - MEJORADO PARA MÓVIL Y TABLET */
        .nav-tabs {
            border-bottom: 2px solid var(--calm-primary) !important;
            margin-bottom: 2rem !important;
            background: linear-gradient(135deg, #F8FAFC 0%, #EFF6FF 100%) !important;
            border-radius: 12px 12px 0 0 !important;
            padding: 0.75rem !important;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.1) !important;
            overflow-x: auto !important;
            overflow-y: hidden !important;
            white-space: nowrap !important;
            -webkit-overflow-scrolling: touch !important;
        }

        .nav-tabs .nav-link {
            border: none !important;
            border-radius: 8px !important;
            color: white !important;
            font-weight: 600 !important;
            padding: 1rem 1.5rem !important;
            transition: all 0.3s ease !important;
            margin: 0 0.25rem !important;
            position: relative !important;
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            box-shadow: 0 4px 15px rgba(30, 58, 138, 0.3) !important;
            min-height: 48px !important;
            display: inline-flex !important;
            align-items: center !important;
            justify-content: center !important;
            text-decoration: none !important;
            flex-shrink: 0 !important;
        }

        .nav-tabs .nav-link:hover {
            color: white !important;
            background: linear-gradient(135deg, #1D4ED8 0%, #1E3A8A 100%) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.5) !important;
        }

        .nav-tabs .nav-link.active {
            color: white !important;
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            border-bottom: none !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6) !important;
        }

        /* ESTILOS PARA SECCIÓN MI CONTENIDO */
        #contentTabs .nav-link {
            padding: 0.625rem 1.25rem !important;
            font-size: 0.875rem !important;
            font-weight: 600 !important;
            border: 2px solid #e5e7eb !important;
            border-radius: 8px !important;
            background: #ffffff !important;
            color: #374151 !important;
            transition: all 0.2s ease !important;
        }
        
        #contentTabs .nav-link i {
            transition: color 0.2s ease !important;
        }
        
        #contentTabs .nav-link:hover {
            color: #1e40af !important;
            background: #eff6ff !important;
            border-color: #93c5fd !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 2px 4px rgba(59, 130, 246, 0.15) !important;
        }
        
        #contentTabs .nav-link.active,
        #contentTabs .nav-link:active {
            color: #ffffff !important;
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
            border-color: #3b82f6 !important;
            font-weight: 700 !important;
            transform: none !important;
            box-shadow: 0 4px 8px rgba(59, 130, 246, 0.3) !important;
        }
        
        #contentTabs .nav-link.active i,
        #contentTabs .nav-link:active i {
            color: #ffffff !important;
        }
        
        /* Asegurar que los botones NO activos mantengan el texto oscuro */
        #contentTabs .nav-link:not(.active) {
            color: #374151 !important;
        }
        
        #contentTabs .nav-link:not(.active) span {
            color: #374151 !important;
        }
        
        #contentTabs {
            border-bottom: 2px solid #e5e7eb !important;
            gap: 0.75rem !important;
            background: #f9fafb !important;
            padding: 0.5rem !important;
            border-radius: 10px !important;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) !important;
        }
        
        /* Estilos para cards de documentos */
        .document-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.2s ease;
            cursor: pointer;
            height: 100%;
        }
        
        .document-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
            transform: translateY(-2px);
        }
        
        .document-icon {
            width: 48px;
            height: 48px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }
        
        .document-title {
            font-size: 0.9375rem;
            font-weight: 600;
            color: #111827;
            margin-bottom: 0.375rem;
            line-height: 1.3;
        }
        
        /* ESTILOS OPTIMIZADOS PARA MODAL DE PROGRESO DE TAREAS */
        #taskProgressModal .modal-dialog {
            max-width: 600px !important;
            margin: 5rem auto 1.75rem auto !important;
        }
        
        #taskProgressModal .modal-content {
            border-radius: 16px !important;
            border: none !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
            overflow: hidden !important;
        }
        
        #taskProgressModal .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            padding: 1.25rem 1.75rem !important;
            border-bottom: none !important;
        }
        
        #taskProgressModal .modal-title {
            font-size: 1.125rem !important;
            font-weight: 600 !important;
            color: white !important;
        }
        
        #taskProgressModal .modal-title i {
            opacity: 0.9 !important;
        }
        
        #taskProgressModal .btn-close {
            filter: brightness(0) invert(1) !important;
            opacity: 0.8 !important;
        }
        
        #taskProgressModal .btn-close:hover {
            opacity: 1 !important;
        }
        
        #taskProgressModal .modal-body {
            padding: 1rem 1.75rem !important;
            background: #fafafa !important;
        }
        
        #taskProgressModal .form-label {
            font-weight: 600 !important;
            color: #374151 !important;
            margin-bottom: 0.2rem !important;
            display: flex !important;
            align-items: center !important;
            font-size: 0.875rem !important;
        }
        
        #taskProgressModal .form-label i {
            margin-right: 0.5rem !important;
            color: #667eea !important;
        }
        
        #taskProgressModal .form-select,
        #taskProgressModal .form-control {
            border: 2px solid #e5e7eb !important;
            border-radius: 8px !important;
            padding: 0.625rem !important;
            font-size: 0.9375rem !important;
            transition: all 0.2s ease !important;
        }
        
        #taskProgressModal .form-select:focus,
        #taskProgressModal .form-control:focus {
            border-color: #667eea !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
            outline: none !important;
        }
        
        #taskProgressModal .form-range {
            height: 8px !important;
            border-radius: 4px !important;
            background: linear-gradient(to right, #10b981 0%, #10b981 var(--value), #e5e7eb var(--value), #e5e7eb 100%) !important;
        }
        
        #taskProgressModal .form-range::-webkit-slider-thumb {
            width: 20px !important;
            height: 20px !important;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            border: 3px solid white !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
        }
        
        #taskProgressModal .form-range::-moz-range-thumb {
            width: 20px !important;
            height: 20px !important;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            border: 3px solid white !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
        }
        
        #taskProgressModal #progressValue {
            font-weight: 700 !important;
            color: #10b981 !important;
            font-size: 1.125rem !important;
        }
        
        #taskProgressModal .modal-footer {
            padding: 0.75rem 1.75rem !important;
            background: white !important;
            border-top: 1px solid #e5e7eb !important;
            gap: 0.75rem !important;
        }
        
        #taskProgressModal .modal-footer .btn {
            padding: 0.625rem 1.25rem !important;
            font-weight: 600 !important;
            border-radius: 8px !important;
            font-size: 0.875rem !important;
            min-width: 100px !important;
            transition: all 0.2s ease !important;
        }
        
        #taskProgressModal .btn-secondary {
            background: #f3f4f6 !important;
            color: #374151 !important;
            border: 1px solid #e5e7eb !important;
        }
        
        #taskProgressModal .btn-secondary:hover {
            background: #e5e7eb !important;
            transform: translateY(-1px) !important;
        }
        
        #taskProgressModal .btn-task {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            border: none !important;
        }
        
        #taskProgressModal .btn-task:hover {
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4) !important;
        }
        
        /* RESPONSIVE PARA MÓVIL */
        @media (max-width: 768px) {
            #taskProgressModal .modal-dialog {
                margin: 1rem 0.5rem 0.5rem 0.5rem !important;
                max-width: calc(100vw - 1rem) !important;
            }
            
            #taskProgressModal .modal-content {
                max-height: calc(100vh - 1rem) !important;
                display: flex !important;
                flex-direction: column !important;
            }
            
            #taskProgressModal .modal-header {
                padding: 1.25rem 1.5rem !important;
                flex-shrink: 0 !important;
            }
            
            #taskProgressModal .modal-title {
                font-size: 1.125rem !important;
            }
            
            #taskProgressModal .modal-body {
                padding: 1.25rem 1.5rem !important;
                overflow-y: auto !important;
                flex: 1 1 auto !important;
                -webkit-overflow-scrolling: touch !important;
            }
            
            #taskProgressModal .form-label {
                font-size: 0.875rem !important;
            }
            
            #taskProgressModal .form-select,
            #taskProgressModal .form-control {
                font-size: 0.9375rem !important;
                padding: 0.625rem !important;
            }
            
            #taskProgressModal .modal-footer {
                padding: 1rem 1.5rem !important;
                flex-shrink: 0 !important;
                flex-wrap: wrap !important;
            }
            
            #taskProgressModal .modal-footer .btn {
                flex: 1 1 auto !important;
                min-width: 100px !important;
                padding: 0.625rem 1rem !important;
            }
        }
        
        /* RESPONSIVE PARA TABLET */
        @media (min-width: 769px) and (max-width: 1024px) {
            #taskProgressModal .modal-dialog {
                max-width: 540px !important;
                margin: 1.5rem auto !important;
            }
            
            #taskProgressModal .modal-body {
                padding: 1.75rem !important;
            }
            
            #taskProgressModal .modal-footer {
                padding: 1.25rem 1.75rem !important;
            }
            #taskProgressModal .modal-body {
                display: -webkit-box;
                -webkit-line-clamp: 2;
                line-clamp: 2;
                -webkit-box-orient: vertical;
                overflow: hidden;
            }
        }
        
        .document-meta {
            font-size: 0.75rem;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .document-badge {
            display: inline-block;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.6875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .priority-urgente {
            background: #fef2f2;
            color: #dc2626;
            border: 1px solid #fecaca;
        }
        
        .priority-alta {
            background: #fff7ed;
            color: #ea580c;
            border: 1px solid #fed7aa;
        }
        
        .priority-normal {
            background: #f0fdf4;
            color: #16a34a;
            border: 1px solid #bbf7d0;
        }

        /* NAVEGACIÓN MÓVIL OPTIMIZADA */
        @media (max-width: 768px) {
            .nav-tabs {
                padding: 0.5rem !important;
                margin-bottom: 1.5rem !important;
                border-radius: 8px 8px 0 0 !important;
                scrollbar-width: none !important;
                -ms-overflow-style: none !important;
            }
            
            .nav-tabs::-webkit-scrollbar {
                display: none !important;
            }
            
            .nav-tabs .nav-item {
                display: inline-block !important;
                flex-shrink: 0 !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.75rem 1rem !important;
                margin: 0 0.25rem !important;
                font-size: 0.9rem !important;
                min-width: auto !important;
                white-space: nowrap !important;
                min-height: 44px !important;
                border-radius: 6px !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1rem !important;
                margin-right: 0.5rem !important;
            }
            
            /* Scroll suave para pestañas */
            .nav-tabs {
                scroll-behavior: smooth !important;
            }
        }

        /* NAVEGACIÓN TABLET OPTIMIZADA */
        @media (min-width: 768px) and (max-width: 1024px) {
            .nav-tabs {
                padding: 0.75rem !important;
                margin-bottom: 2rem !important;
            }
            
            .nav-tabs .nav-link {
                padding: 0.875rem 1.25rem !important;
                font-size: 0.95rem !important;
                margin: 0 0.25rem !important;
                min-height: 46px !important;
            }
            
            .nav-tabs .nav-link i {
                font-size: 1.1rem !important;
                margin-right: 0.6rem !important;
            }
        }

        /* Móvil muy pequeño - iconos solo */
        @media (max-width: 480px) {
            .nav-tabs .nav-link {
                padding: 0.625rem 0.75rem !important;
                font-size: 0.85rem !important;
            }
            
            .nav-tabs .nav-link span {
                display: none !important;
            }
            
            .nav-tabs .nav-link i {
                margin-right: 0 !important;
            }
        }

        /* Evaluaciones Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#evaluations-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#evaluations-tab:hover,
        .nav-tabs .nav-link#evaluations-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
            color: white !important;
        }

        /* Assessment Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#assessment-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#assessment-tab:hover,
        .nav-tabs .nav-link#assessment-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
            color: white !important;
        }

        /* Tareas Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#tasks-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#tasks-tab:hover,
        .nav-tabs .nav-link#tasks-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            color: white !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
        }

        /* Progreso Tab - Azul Oscuro Consistente */
        .nav-tabs .nav-link#progress-tab {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%) !important;
            color: white !important;
        }

        .nav-tabs .nav-link#progress-tab:hover,
        .nav-tabs .nav-link#progress-tab.active {
            background: linear-gradient(135deg, #1E3A8A 0%, #1E40AF 100%) !important;
            color: white !important;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.6);
        }

        /* Iconos con animación */
        .nav-tabs .nav-link i {
            transition: transform 0.3s ease;
        }

        .nav-tabs .nav-link:hover i,
        .nav-tabs .nav-link.active i {
            transform: scale(1.1);
        }

        /* Buttons */
        .btn-primary-custom {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.2); /* Updated with new primary color */
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(90, 103, 216, 0.4); /* Updated with new primary color */
            color: white;
        }

        .btn-success-custom {
            background: var(--success-gradient);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-success-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(104, 211, 145, 0.4); /* Updated with new secondary/success color */
            color: white;
        }

        .btn-warning-custom {
            background: var(--warning-gradient);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }

        .btn-warning-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(237, 137, 54, 0.4); /* Updated with new accent/warning color */
            color: white;
        }

        /* Botones específicos para evaluaciones */
        .btn-evaluation {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-evaluation:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
            color: white;
        }

        /* Botones específicos para tareas */
        .btn-task {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-task:hover {
            background: linear-gradient(135deg, #d97706 0%, #b45309 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.4);
            color: white;
        }

        /* Botones específicos para progreso */
        .btn-progress {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .btn-progress:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
            color: white;
        }

        /* Botones de outline para acciones secundarias */
        .btn-outline-evaluation {
            background: transparent;
            border: 2px solid #3b82f6;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #3b82f6;
            transition: all 0.3s ease;
        }

        .btn-outline-evaluation:hover {
            background: #3b82f6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }

        .btn-outline-task {
            background: transparent;
            border: 2px solid #f59e0b;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #f59e0b;
            transition: all 0.3s ease;
        }

        .btn-outline-task:hover {
            background: #f59e0b;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        .btn-outline-progress {
            background: transparent;
            border: 2px solid #8b5cf6;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            font-weight: 600;
            color: #8b5cf6;
            transition: all 0.3s ease;
        }

        .btn-outline-progress:hover {
            background: #8b5cf6;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        /* ESTILOS DE RECOMENDACIONES - COPIADOS DEL COACH DASHBOARD */
        .category-content {
            padding: 1.25rem;
        }
        
        .recommendation-item {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--calm-accent);
            position: relative;
            transition: all 0.3s ease;
            transform: translateY(0);
        }
        
        .recommendation-item:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-left-color: var(--calm-primary);
            transform: translateX(5px) translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--bs-primary) !important;
        }
        
        .recommendation-item:before {
            content: "✓";
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--calm-accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .recommendation-text {
            margin-left: 1.5rem;
            line-height: 1.6;
            color: #334155;
            font-weight: 500;
        }
        
        /* Estilos especiales para subcategorías de dimensiones */
        .dimension-subcategory {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            margin-bottom: 2rem;
        }
        
        .subcategory-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white;
            padding: 1.25rem;
            border-bottom: 3px solid var(--calm-accent);
        }
        
        .subcategory-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .subcategory-info {
            flex: 1;
        }
        
        .subcategory-title {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }

        /* ANIMACIONES - COPIADAS DEL COACH DASHBOARD */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .action-list li {
            position: relative;
            padding-left: 0.5rem;
        }
        
        .action-list li:before {
            content: "→";
            position: absolute;
            left: -0.5rem;
            color: var(--bs-primary);
            font-weight: bold;
        }
        
        .item-number {
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* Summary cards */
        .summary-card {
            background: var(--calm-surface);
            border-radius: 16px;
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--calm-border);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            box-shadow: 0 4px 20px rgba(90, 103, 216, 0.05); /* Updated with new primary color */
        }

        .summary-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(90, 103, 216, 0.1); /* Updated with new primary color */
        }

        .summary-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: white;
        }

        .summary-icon.primary {
            background: var(--primary-gradient);
        }

        .summary-icon.success {
            background: var(--success-gradient);
        }

        .summary-icon.warning {
            background: var(--warning-gradient);
        }

        .summary-icon.danger {
            background: var(--danger-gradient);
        }

        .summary-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .summary-label {
            color: var(--calm-text-muted); /* Usando color muted mejorado para mejor contraste */
            font-weight: 500;
        }

        /* EVALUATION CARDS MODERNIZADAS - DISEÑO COLORIDO Y ATRACTIVO */
        .evaluation-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
            border: none !important;
            border-radius: 1rem !important;
            padding: 1.5rem !important;
            margin-bottom: 1.25rem !important;
            color: #333 !important;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .evaluation-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
        }
        
        /* Headers coloridos para diferentes tipos de evaluación */
        .evaluation-item[data-type="disc"]::before {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%) !important;
        }
        
        .evaluation-item[data-type="emotional"]::before {
            background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%) !important;
        }
        
        .evaluation-item[data-type="leadership"]::before {
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%) !important;
        }
        
        .evaluation-item[data-type="teamwork"]::before {
            background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%) !important;
        }
        
        .evaluation-item[data-type="assertiveness"]::before {
            background: linear-gradient(90deg, #fa709a 0%, #fee140 100%) !important;
        }

        .evaluation-item:hover {
            transform: translateY(-3px) !important;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15) !important;
        }

        .evaluation-score {
            font-size: 2.25rem !important;
            font-weight: 700 !important;
            margin-bottom: 0.5rem !important;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            -webkit-background-clip: text !important;
            -webkit-text-fill-color: transparent !important;
            background-clip: text !important;
        }

        .evaluation-level {
            font-weight: 600 !important;
            margin-bottom: 1rem !important;
            color: #2c3e50 !important;
            font-size: 1.1rem !important;
        }

        .evaluation-description {
            line-height: 1.5 !important;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
            padding: 1rem !important;
            border-radius: 0.75rem !important;
            border-left: 4px solid var(--calm-primary) !important;
            color: #6c757d !important;
            font-size: 0.95rem !important;
        }

        .evaluation-date {
            color: #6c757d !important;
            font-size: 0.85rem !important;
            font-weight: 500 !important;
            margin-top: 1rem !important;
        }
        
        /* EVALUATION CARDS RESPONSIVE - MÓVIL MEJORADO */
        @media (max-width: 768px) {
            .evaluation-item {
                padding: 1.5rem 1.25rem !important;
                margin-bottom: 1.25rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                transition: all 0.2s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .evaluation-item::before {
                height: 4px !important;
                border-radius: 0 0 4px 4px !important;
            }
            
            .evaluation-score {
                font-size: 2.5rem !important;
                font-weight: 800 !important;
                margin-bottom: 0.75rem !important;
                text-align: center !important;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
                -webkit-background-clip: text !important;
                -webkit-text-fill-color: transparent !important;
                background-clip: text !important;
                line-height: 1.1 !important;
            }
            
            .evaluation-level {
                font-size: 1.1rem !important;
                font-weight: 700 !important;
                text-align: center !important;
                color: #2c3e50 !important;
                margin-bottom: 1rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.5px !important;
            }
            
            .evaluation-description {
                padding: 1.25rem !important;
                font-size: 0.95rem !important;
                line-height: 1.6 !important;
                background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
                border-radius: 0.75rem !important;
                border-left: 4px solid var(--calm-primary) !important;
                color: #495057 !important;
                margin-bottom: 1rem !important;
            }
            
            .evaluation-date {
                font-size: 0.85rem !important;
                color: #6c757d !important;
                font-weight: 500 !important;
                text-align: center !important;
                padding: 0.5rem !important;
                background: rgba(108, 117, 125, 0.1) !important;
                border-radius: 0.5rem !important;
                margin-top: 1rem !important;
            }
            
            .evaluation-item:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.12) !important;
            }
            
            /* Estilos específicos por tipo de evaluación en móvil */
            .evaluation-item[data-type="disc"] {
                background: linear-gradient(135deg, #ffffff 0%, #f3f2ff 100%) !important;
            }
            
            .evaluation-item[data-type="emotional"] {
                background: linear-gradient(135deg, #ffffff 0%, #fff0f5 100%) !important;
            }
            
            .evaluation-item[data-type="leadership"] {
                background: linear-gradient(135deg, #ffffff 0%, #f0f8ff 100%) !important;
            }
            
            .evaluation-item[data-type="teamwork"] {
                background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%) !important;
            }
            
            .evaluation-item[data-type="assertiveness"] {
                background: linear-gradient(135deg, #ffffff 0%, #fffaf0 100%) !important;
            }
        }
        
        /* OVERRIDE GLOBAL PARA FORZAR ESTILOS LIMPIOS */
        .glass-card,
        .card,
        .modal-content,
        [style*="background"],
        [class*="glass"] {
            background: white !important;
            backdrop-filter: none !important;
            border: 1px solid #dee2e6 !important;
            color: #333 !important;
        }
        
        .text-white,
        .text-white-50,
        .text-gradient {
            color: #333 !important;
        }
        
        /* ANULAR REGLA PROBLEMÁTICA ESPECÍFICAMENTE PARA GENERAL-RECOMMENDATIONS */
        .general-recommendations .text-white,
        .general-recommendations .text-white-50,
        .general-recommendations .text-gradient {
            color: white !important;
        }
        
        .text-muted {
            color: #666 !important;
        }

        /* TASK CARDS MODERNIZADAS - DISEÑO ATRACTIVO Y FUNCIONAL */
        .task-item {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
            border: none !important;
            border-radius: 1rem !important;
            padding: 1.5rem !important;
            margin-bottom: 1.25rem !important;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08) !important;
            transition: transform 0.2s ease, box-shadow 0.2s ease !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .task-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: linear-gradient(180deg, var(--calm-primary) 0%, var(--calm-secondary) 100%);
        }
        
        .task-item:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 20px rgba(0,0,0,0.12) !important;
        }

        .task-header {
            display: flex !important;
            justify-content: space-between !important;
            align-items: flex-start !important;
            margin-bottom: 1rem !important;
        }

        .task-title {
            font-weight: 600 !important;
            color: #2c3e50 !important;
            margin-bottom: 0.5rem !important;
            font-size: 1.1rem !important;
            line-height: 1.4 !important;
        }

        .task-description {
            color: #6c757d !important;
            margin-bottom: 1rem !important;
            line-height: 1.5 !important;
            font-size: 0.95rem !important;
        }

        .task-meta {
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 0.75rem !important;
            margin-bottom: 1rem !important;
            align-items: center !important;
        }

        .task-badge {
            padding: 0.35rem 0.85rem !important;
            border-radius: 1rem !important;
            font-size: 0.75rem !important;
            font-weight: 600 !important;
            text-transform: uppercase !important;
            letter-spacing: 0.3px !important;
            border: none !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: 0.25rem !important;
        }

        .task-badge.priority-high {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(238, 90, 36, 0.3) !important;
        }

        .task-badge.priority-medium {
            background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(254, 202, 87, 0.3) !important;
        }

        .task-badge.priority-low {
            background: linear-gradient(135deg, #48cae4 0%, #0077b6 100%) !important;
            color: white !important;
            box-shadow: 0 2px 4px rgba(72, 202, 228, 0.3) !important;
        }

        .task-badge.status-pending {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%) !important;
            color: white !important;
        }

        .task-badge.status-in_progress {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%) !important;
            color: white !important;
        }

        .task-badge.status-completed {
            background: linear-gradient(135deg, #55efc4 0%, #00b894 100%) !important;
            color: white !important;
        }

        /* TASK CARDS RESPONSIVE - MÓVIL MEJORADO */
        @media (max-width: 768px) {
            .task-item {
                padding: 1.5rem 1.25rem !important;
                margin-bottom: 1.25rem !important;
                border-radius: 1rem !important;
                background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%) !important;
                border: 1px solid rgba(0,0,0,0.05) !important;
                box-shadow: 0 4px 15px rgba(0,0,0,0.08) !important;
                transition: all 0.2s ease !important;
                position: relative !important;
                overflow: hidden !important;
            }
            
            .task-item::before {
                width: 4px !important;
                background: linear-gradient(180deg, var(--calm-primary) 0%, var(--calm-secondary) 100%) !important;
                border-radius: 0 4px 4px 0 !important;
            }
            
            .task-header {
                display: flex !important;
                flex-direction: column !important;
                gap: 0.75rem !important;
                margin-bottom: 1rem !important;
            }
            
            .task-title {
                font-size: 1.1rem !important;
                font-weight: 700 !important;
                color: #2c3e50 !important;
                margin-bottom: 0 !important;
                line-height: 1.4 !important;
            }
            
            .task-description {
                font-size: 0.95rem !important;
                color: #495057 !important;
                margin-bottom: 1rem !important;
                line-height: 1.5 !important;
                background: rgba(248, 249, 250, 0.8) !important;
                padding: 0.75rem !important;
                border-radius: 0.5rem !important;
                border-left: 3px solid var(--calm-accent) !important;
            }
            
            .task-meta {
                display: flex !important;
                flex-wrap: wrap !important;
                gap: 0.5rem !important;
                margin-bottom: 1rem !important;
                align-items: center !important;
            }
            
            .task-badge {
                padding: 0.4rem 0.8rem !important;
                font-size: 0.75rem !important;
                font-weight: 600 !important;
                border-radius: 0.5rem !important;
                text-transform: uppercase !important;
                letter-spacing: 0.3px !important;
                min-height: 28px !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
            }
            
            .task-progress {
                margin-top: 1rem !important;
                padding: 0.75rem !important;
                background: rgba(233, 236, 239, 0.5) !important;
                border-radius: 0.5rem !important;
            }
            
            .task-item:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(0,0,0,0.12) !important;
            }
            
            /* Colores específicos para diferentes estados de tareas */
            .task-item[data-status="pending"]::before {
                background: linear-gradient(180deg, #f39c12 0%, #e67e22 100%) !important;
            }
            
            .task-item[data-status="in-progress"]::before {
                background: linear-gradient(180deg, #3498db 0%, #2980b9 100%) !important;
            }
            
            .task-item[data-status="completed"]::before {
                background: linear-gradient(180deg, #2ecc71 0%, #27ae60 100%) !important;
            }
            
            .task-item[data-priority="high"] {
                background: linear-gradient(135deg, #ffffff 0%, #fff5f5 100%) !important;
                border-color: rgba(239, 68, 68, 0.1) !important;
            }
            
            .task-item[data-priority="medium"] {
                background: linear-gradient(135deg, #ffffff 0%, #fffbf0 100%) !important;
                border-color: rgba(245, 158, 11, 0.1) !important;
            }
            
            .task-item[data-priority="low"] {
                background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%) !important;
                border-color: rgba(34, 197, 94, 0.1) !important;
            }
        }

        /* CONTENT CARDS STYLES */
        .content-card {
            background: #ffffff;
            border: 1px solid rgba(226, 232, 240, 0.8);
            border-radius: 12px;
            height: 100%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 12px;
        }

        .content-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
            z-index: 1;
        }

        .content-card:hover {
            transform: translateY(-6px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }

        .content-card:hover::before {
            transform: scaleX(1);
        }

        .content-card.viewed {
            border-color: rgba(34, 197, 94, 0.4);
        }

        .content-card.viewed::before {
            background: linear-gradient(90deg, #22c55e 0%, #16a34a 100%);
        }

        /* Preview styles */
        .content-preview {
            position: relative;
            cursor: pointer;
        }

        .content-preview.has-embedded-video {
            cursor: default;
            /* pointer-events removido - bloqueaba clics en iframes */
        }

        .content-preview.has-embedded-video iframe {
            cursor: default;
        }

        .content-preview .ratio iframe {
            border-radius: 8px;
        }

        .duration-badge {
            position: relative;
            margin-top: 8px;
            display: inline-block;
        }

        .content-header {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .content-type-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .content-card.viewed .content-type-icon {
            background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        }

        .content-info {
            flex: 1;
            min-width: 0;
        }

        .content-title {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
            color: #1e293b;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .content-description {
            margin: 0.75rem 0;
            padding: 0.75rem;
            background: rgba(248, 250, 252, 0.8);
            border-radius: 8px;
        }

        .content-description p {
            margin: 0;
            font-size: 0.9rem;
            color: #64748b;
            line-height: 1.5;
        }

        .content-meta {
            margin: 0.75rem 0;
            font-size: 0.85rem;
            color: #64748b;
        }

        .content-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .content-actions .btn {
            border-radius: 8px;
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .content-actions .btn:hover {
            transform: translateY(-1px);
        }

        /* Content responsive */
        @media (max-width: 768px) {
            .content-card {
                padding: 1rem;
            }
            
            .content-header {
                gap: 0.5rem;
            }
            
            .content-type-icon {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .content-title {
                font-size: 0.95rem;
            }
            
            .content-actions {
                gap: 0.25rem;
            }
            
            .content-actions .btn {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }

        /* Progress bars */
        .progress-container {
            margin: 1rem 0;
        }

        .progress-bar-custom {
            height: 8px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
        }

        .progress-fill.low {
            background: var(--danger-gradient);
        }

        .progress-fill.medium {
            background: var(--warning-gradient);
        }

        .progress-fill.high {
            background: var(--success-gradient);
        }

        /* Chart container */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            min-height: 350px;
            max-height: 500px;
            position: relative;
            overflow: visible;
        }
        
        /* Progress chart specific container */
        .progress-chart-wrapper {
            margin-bottom: 2rem;
        }
        
        .progress-chart-wrapper .chart-container {
            height: 350px;
            margin-bottom: 1rem;
        }
        
        /* Progress info card */
        .progress-info-card {
            margin-top: 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .progress-info-card:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        /* Progress tab specific styles */
        #progress .dashboard-card {
            margin-bottom: 2rem;
        }
        
        #progress .row {
            margin-bottom: 1.5rem;
        }
        
        #progress .row:last-child {
            margin-bottom: 0;
        }
        
        /* Responsive adjustments for progress section */
        @media (max-width: 991.98px) {
            .progress-chart-wrapper .chart-container {
                height: 300px;
            }
            
            #progress .col-lg-8,
            #progress .col-lg-4 {
                margin-bottom: 1.5rem;
            }
        }
        
        @media (max-width: 767.98px) {
            .progress-chart-wrapper .chart-container {
                height: 250px;
                padding: 1rem;
            }
            
            .progress-info-card {
                font-size: 0.9rem;
            }
            
            .progress-info-card .h4 {
                font-size: 1.25rem;
            }
            
            .progress-info-card .h5 {
                font-size: 1.1rem;
            }
        }

        /* Responsive Radar Chart Container */
        .radar-chart-container {
            position: relative;
            width: 100%;
            height: 350px; /* Base height */
            max-width: 100%;
            margin: 0 auto;
        }

        .radar-chart-container canvas {
            max-width: 100% !important;
            height: auto !important;
        }

        /* Mobile optimizations for radar chart */
        @media (max-width: 576px) {
            .radar-chart-container {
                height: 280px; /* Smaller on mobile but still prominent */
                padding: 0 0.5rem;
            }
        }

        @media (min-width: 577px) and (max-width: 768px) {
            .radar-chart-container {
                height: 320px; /* Medium size for tablets */
            }
        }

        @media (min-width: 769px) and (max-width: 991px) {
            .radar-chart-container {
                height: 350px; /* Standard size for larger tablets */
            }
        }

        @media (min-width: 992px) {
            .radar-chart-container {
                height: 380px; /* Largest size for desktop */
            }
        }

        /* Loading states */
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }

        .spinner-border-custom {
            width: 3rem;
            height: 3rem;
            border: 0.3em solid rgba(102, 126, 234, 0.25);
            border-top-color: #667eea;
        }

        /* Empty states */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: var(--calm-text-muted); /* Mejorado para mejor contraste */
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* Assessment specific styles */
        .question-card {
            background: var(--surface-elevated);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 1rem;
        }

        .question-title {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 1.1rem;
        }

        .question-text {
            color: var(--text-primary);
            font-size: 1.1rem;
            line-height: 1.6;
        }

        .option-item {
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid var(--border-color) !important;
        }

        .option-item:hover {
            border-color: #667eea !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .option-item.bg-primary {
            border-color: #667eea !important;
            background: var(--primary-gradient) !important;
        }

        .option-item .form-check-input {
            margin-top: 0.125rem;
        }
        
        /* Auto-advance enhancements for assessment */
        .auto-advance-option {
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid var(--calm-border-light) !important;
        }
        
        .auto-advance-option:hover {
            border-color: var(--calm-primary) !important;
            background-color: var(--calm-primary-ultra-light) !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(98, 130, 227, 0.15);
        }
        
        .auto-advance-option.selected {
            border-color: var(--calm-primary) !important;
            background-color: var(--calm-primary) !important;
            color: white !important;
            transform: scale(1);
            box-shadow: 0 6px 16px rgba(98, 130, 227, 0.3);
        }
        
        .auto-advance-option.selected .form-check-label {
            color: white !important;
            font-weight: 600;
        }
        
        .auto-advance-option .form-check-input {
            display: none; /* Hide radio buttons for cleaner look */
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Loading state for buttons */
        .btn-primary-custom:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        /* ========================================
           MODAL DE DETALLES DE EVALUACIÓN - CONSOLIDADO
           ÚNICA FUENTE DE VERDAD PARA #evaluationDetailsModal
           ======================================== */
        
        /* Modal container - Z-index y pointer events */
        #evaluationDetailsModal {
            z-index: 9999 !important; /* Mayor que cualquier elemento de la página, incluyendo bottom navigation */
            pointer-events: auto !important; /* Asegurar interactividad */
        }
        
        /* Modal dialog - Tamaño y espaciado */
        #evaluationDetailsModal .modal-dialog {
            max-width: 900px;
            margin: 5rem auto 2rem auto !important; /* Margen superior 5rem para aparecer bajo cabecera, inferior 2rem */
            /* Sin z-index ni position para evitar crear nuevo stacking context */
        }
        
        @media (max-width: 992px) {
            #evaluationDetailsModal .modal-dialog {
                max-width: 720px;
                margin: 4rem auto 2rem auto !important; /* Margen superior 4rem en tablet, inferior 2rem */
            }
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .modal-dialog {
                max-width: calc(100% - 2rem);
                margin: 5rem auto 2rem auto !important; /* Margen superior 5rem en móvil, inferior 2rem */
            }
        }
        
        /* Mejoras para modales en móvil - IGUAL QUE COACH DASHBOARD */
        @media (max-width: 575.98px) {
            .modal-dialog {
                margin: 0.5rem;
            }
            
            .modal-content {
                border-radius: 12px;
            }
            
            .modal-header {
                padding: 1rem;
            }
            
            .modal-title {
                font-size: 1.1rem;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            .modal-footer {
                padding: 1rem;
                gap: 0.5rem;
            }
        }
        
        /* ========================================
           MODAL DE EVALUACIÓN - DISEÑO MODERNO Y COMPACTO
           ======================================== */
        
        /* Header del modal - Diseño limpio con gradiente sutil */
        #evaluationDetailsModal .modal-header.modal-header-dark {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%) !important;
            border-bottom: none !important;
            color: #ffffff !important;
            padding: 1rem 1.5rem !important;
            position: relative !important;
            border-radius: 12px 12px 0 0 !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark .modal-title {
            color: #ffffff !important;
            font-size: 1.125rem !important;
            font-weight: 600 !important;
            display: flex !important;
            align-items: center !important;
            gap: 0.625rem !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark .modal-title i {
            color: #ffffff !important;
            font-size: 1.25rem !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark .btn-close {
            filter: brightness(0) invert(1) !important;
            opacity: 0.8 !important;
            padding: 0.5rem !important;
            transition: all 0.2s ease !important;
        }
        
        #evaluationDetailsModal .modal-header.modal-header-dark .btn-close:hover {
            opacity: 1 !important;
            transform: rotate(90deg) !important;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .modal-header.modal-header-dark {
                padding: 0.875rem 1.25rem !important;
            }
            
            #evaluationDetailsModal .modal-header.modal-header-dark .modal-title {
                font-size: 1rem !important;
            }
        }
        
        /* Body del modal - Fondo limpio con scroll mejorado */
        #evaluationDetailsModal .modal-body {
            background: #f8fafc;
            color: #1e293b;
            padding: 1.5rem;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        #evaluationDetailsModal .modal-body::-webkit-scrollbar {
            width: 6px;
        }
        
        #evaluationDetailsModal .modal-body::-webkit-scrollbar-track {
            background: #e2e8f0;
            border-radius: 3px;
        }
        
        #evaluationDetailsModal .modal-body::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 3px;
        }
        
        #evaluationDetailsModal .modal-body::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #2563eb 0%, #1e40af 100%);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .modal-body {
                padding: 1.25rem;
                max-height: calc(100vh - 220px);
            }
        }
        
        @media (max-width: 576px) {
            #evaluationDetailsModal .modal-body {
                padding: 1rem;
            }
        }
        
        /* Cards dentro del modal - Diseño compacto con bordes sutiles */
        #evaluationDetailsModal .card:not([style*="background"]) {
            background: #ffffff;
            border: 1px solid #e2e8f0;
            color: #1e293b;
            border-radius: 10px;
            margin-bottom: 1rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        
        #evaluationDetailsModal .card:not([style*="background"]):hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .card {
                margin-bottom: 0.875rem;
                border-radius: 8px;
            }
        }
        
        /* Headers de cards - Diseño limpio y compacto */
        #evaluationDetailsModal .card-header {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-bottom: 1px solid #e2e8f0;
            padding: 0.75rem 1rem;
            border-radius: 10px 10px 0 0;
        }
        
        #evaluationDetailsModal .card-header h5,
        #evaluationDetailsModal .card-header h6 {
            margin: 0;
            font-size: 0.9375rem;
            font-weight: 600;
            color: #1e293b !important;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        #evaluationDetailsModal .card-header i {
            color: #3b82f6 !important;
            font-size: 1rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .card-header {
                padding: 0.625rem 0.875rem;
            }
            
            #evaluationDetailsModal .card-header h5,
            #evaluationDetailsModal .card-header h6 {
                font-size: 0.875rem;
            }
        }
        
        #evaluationDetailsModal .card-body {
            padding: 1rem;
            background: #ffffff;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .card-body {
                padding: 0.875rem;
            }
        }
        
        /* Resultados DISC - Grid compacto y responsive */
        #evaluationDetailsModal .dimension-results {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .dimension-results {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.625rem;
            }
        }
        
        /* Tarjetas de dimensiones DISC - Diseño limpio y compacto */
        #evaluationDetailsModal .dimension-card {
            background: #ffffff;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.75rem;
            text-align: center;
            transition: all 0.2s ease;
        }
        
        #evaluationDetailsModal .dimension-card:hover {
            border-color: #3b82f6;
            box-shadow: 0 2px 8px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .dimension-card {
                padding: 0.625rem;
            }
        }
        
        #evaluationDetailsModal .dimension-label {
            font-size: 0.8125rem;
            font-weight: 600;
            color: #64748b;
            margin-bottom: 0.375rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .dimension-label {
                font-size: 0.75rem;
            }
        }
        
        #evaluationDetailsModal .dimension-value {
            font-size: 1.875rem;
            font-weight: 700;
            color: #1e40af;
            line-height: 1;
            margin-bottom: 0.25rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .dimension-value {
                font-size: 1.5rem;
            }
        }
        
        #evaluationDetailsModal .dimension-percentage {
            font-size: 0.75rem;
            font-weight: 500;
            color: #94a3b8;
        }
        
        /* Recomendaciones - Lista limpia y legible */
        #evaluationDetailsModal .recommendation-item {
            background: #ffffff;
            border-left: 3px solid #3b82f6;
            padding: 0.75rem 0.75rem 0.75rem 1rem;
            margin-bottom: 0.625rem;
            font-size: 0.875rem;
            line-height: 1.6;
            color: #334155;
            display: flex;
            align-items: flex-start;
            gap: 0.625rem;
            border-radius: 0 6px 6px 0;
            transition: all 0.2s ease;
        }
        
        #evaluationDetailsModal .recommendation-item:hover {
            background: #f8fafc;
            border-left-color: #2563eb;
            transform: translateX(3px);
        }
        
        #evaluationDetailsModal .recommendation-item::before {
            content: "✓";
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            font-size: 0.6875rem;
            font-weight: 700;
            flex-shrink: 0;
            margin-top: 0.125rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .recommendation-item {
                font-size: 0.8125rem;
                padding: 0.625rem 0.625rem 0.625rem 0.875rem;
                margin-bottom: 0.5rem;
            }
            
            #evaluationDetailsModal .recommendation-item::before {
                width: 18px;
                height: 18px;
                font-size: 0.625rem;
            }
        }
        
        /* Categorías de recomendaciones - Headers coloridos y compactos */
        #evaluationDetailsModal .category-header {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 0.625rem 1rem;
            border-radius: 8px;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        #evaluationDetailsModal .category-header i {
            font-size: 1rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .category-header {
                padding: 0.5rem 0.875rem;
                font-size: 0.8125rem;
            }
        }
        
        #evaluationDetailsModal .strengths-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        #evaluationDetailsModal .opportunities-category .category-header {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }
        
        #evaluationDetailsModal .final-message .category-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        /* Override para mantener el título de categoría blanco */
        #evaluationDetailsModal .general-recommendations h6.category-title,
        #evaluationDetailsModal .category-header h6 {
            color: white !important;
            margin: 0;
        }
        
        /* Detalles adicionales - Filas limpias y compactas */
        #evaluationDetailsModal .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.625rem 0.875rem;
            background: #ffffff;
            border-left: 2px solid #e2e8f0;
            margin-bottom: 0.375rem;
            font-size: 0.875rem;
            transition: all 0.2s ease;
            border-radius: 0 6px 6px 0;
        }
        
        #evaluationDetailsModal .detail-row:hover {
            background: #f8fafc;
            border-left-color: #3b82f6;
            transform: translateX(2px);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .detail-row {
                font-size: 0.8125rem;
                padding: 0.5rem 0.75rem;
            }
        }
        
        @media (max-width: 576px) {
            #evaluationDetailsModal .detail-row {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }
        }
        
        #evaluationDetailsModal .detail-label {
            font-weight: 600;
            color: #64748b;
            display: flex;
            align-items: center;
            gap: 0.375rem;
        }
        
        #evaluationDetailsModal .detail-label i {
            color: #3b82f6;
            font-size: 0.875rem;
        }
        
        #evaluationDetailsModal .detail-value {
            font-weight: 700;
            color: #1e40af;
        }
        
        /* Loading spinner - Estado de carga limpio */
        #evaluationDetailsModal .loading-spinner {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 250px;
            gap: 1rem;
            padding: 2rem;
        }
        
        #evaluationDetailsModal .spinner-border-custom {
            width: 2.5rem;
            height: 2.5rem;
            border-width: 0.25rem;
            color: #3b82f6;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .loading-spinner {
                min-height: 200px;
                padding: 1.5rem;
            }
            
            #evaluationDetailsModal .spinner-border-custom {
                width: 2rem;
                height: 2rem;
            }
        }
        
        /* Secciones colapsables - Interacción mejorada */
        #evaluationDetailsModal .collapse-toggle {
            cursor: pointer;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.625rem 0.875rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
            color: #334155;
            font-weight: 500;
        }
        
        #evaluationDetailsModal .collapse-toggle:hover {
            background: #f1f5f9;
            border-color: #cbd5e1;
        }
        
        #evaluationDetailsModal .collapse-toggle i {
            transition: transform 0.2s ease;
            color: #3b82f6;
        }
        
        #evaluationDetailsModal .collapse-toggle.collapsed i {
            transform: rotate(-90deg);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .collapse-toggle {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
        }
        
        /* Footer del modal - Botones compactos y modernos */
        #evaluationDetailsModal .modal-footer {
            background: #ffffff;
            border-top: 1px solid #e5e7eb;
            padding: 1rem 1.5rem;
            border-radius: 0 0 12px 12px;
            gap: 0.625rem;
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .modal-footer {
                padding: 0.875rem 1.25rem;
                gap: 0.5rem;
            }
        }
        
        #evaluationDetailsModal .btn-modal-action {
            font-size: 0.875rem;
            font-weight: 600;
            padding: 0.625rem 1rem;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            border: 2px solid transparent;
        }
        
        #evaluationDetailsModal .btn-modal-action:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        @media (max-width: 768px) {
            #evaluationDetailsModal .btn-modal-action {
                font-size: 0.8125rem;
                padding: 0.5rem 0.875rem;
            }
        }
        
        @media (max-width: 576px) {
            #evaluationDetailsModal .btn-modal-action {
                flex: 1;
                justify-content: center;
                font-size: 0.8125rem;
            }
            
            #evaluationDetailsModal .btn-modal-action .btn-text-full {
                display: none !important;
            }
            
            #evaluationDetailsModal .btn-modal-action .btn-text-short {
                display: inline !important;
            }
            
            #evaluationDetailsModal .btn-modal-action:first-child {
                flex: 0 0 auto;
            }
        }
        
        #evaluationDetailsModal .btn-modal-action i {
            font-size: 1rem;
        }
        
        #evaluationDetailsModal .btn-modal-action:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        
        #evaluationDetailsModal .btn-modal-action:active {
            transform: translateY(0);
        }
        
        #evaluationDetailsModal .btn-outline-secondary {
            color: #64748b;
            border-color: #cbd5e1;
            background: #ffffff;
        }
        
        #evaluationDetailsModal .btn-outline-secondary:hover {
            color: #ffffff;
            background: #64748b;
            border-color: #64748b;
        }
        
        #evaluationDetailsModal .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            color: #ffffff;
        }
        
        #evaluationDetailsModal .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }
        
        /* ========================================
           CONTRASTE Y LEGIBILIDAD DEL TEXTO
           ======================================== */
        
        /* Títulos y textos principales */
        #evaluationDetailsModal h4,
        #evaluationDetailsModal h5,
        #evaluationDetailsModal h6 {
            color: #1e293b !important;
            font-weight: 600;
        }
        
        /* Texto del cuerpo */
        #evaluationDetailsModal p,
        #evaluationDetailsModal .text-muted,
        #evaluationDetailsModal .recommendation-text {
            color: #334155 !important;
            line-height: 1.6;
        }
        
        /* Texto en cards con fondo blanco */
        #evaluationDetailsModal .card {
            color: #1e293b;
        }
        
        #evaluationDetailsModal .card p {
            color: #334155 !important;
        }
        
        /* Texto en badges y etiquetas */
        #evaluationDetailsModal .badge {
            font-weight: 600;
            padding: 0.375rem 0.625rem;
            border-radius: 6px;
        }
        
        /* Lista de elementos */
        #evaluationDetailsModal ul li,
        #evaluationDetailsModal ol li {
            color: #334155;
            line-height: 1.6;
        }
        
        /* Strong y bold text */
        #evaluationDetailsModal strong,
        #evaluationDetailsModal b {
            color: #1e293b;
            font-weight: 600;
        }
        
        /* Links dentro del modal */
        #evaluationDetailsModal a {
            color: #2563eb;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.2s ease;
        }
        
        #evaluationDetailsModal a:hover {
            color: #1e40af;
            text-decoration: underline;
        }
        
        /* Secciones con fondo gris - asegurar contraste */
        #evaluationDetailsModal .bg-light,
        #evaluationDetailsModal [class*="bg-gray"] {
            color: #1e293b !important;
        }
        
        #evaluationDetailsModal .bg-light p,
        #evaluationDetailsModal [class*="bg-gray"] p {
            color: #334155 !important;
        }
        
        /* ========================================
           FIN MODAL DE EVALUACIÓN
           ======================================== */
        
        #evaluationDetailsModal .btn-success:hover {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
            box-shadow: 0 6px 20px rgba(16, 185, 129, 0.4);
        }
        
        #evaluationDetailsModal .btn-info {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #3b82f6;
            color: #ffffff;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        #evaluationDetailsModal .btn-info:hover {
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
            color: #ffffff;
        }
        
        /* Botón close mejorado en el header */
        #evaluationDetailsModal .btn-close-white {
            filter: brightness(0) invert(1);
            opacity: 0.9;
            width: 1.5rem;
            height: 1.5rem;
            background-size: 1rem;
            transition: all 0.2s ease;
            position: relative;
            z-index: 1;
        }
        
        #evaluationDetailsModal .btn-close-white:hover {
            opacity: 1;
            transform: scale(1.1) rotate(90deg);
        }
        
        @media (max-width: 576px) {
            #evaluationDetailsModal .btn-close-white {
                width: 1.25rem;
                height: 1.25rem;
                background-size: 0.875rem;
            }
        }
        
        /* ESTILOS PARA EL MODAL DE CONTACTAR COACH */
        .modal-header-coach {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%) !important;
            border-bottom: none !important;
            color: #ffffff !important;
            padding: 1.5rem 1.75rem !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .modal-header-coach::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.1) 0%, transparent 70%) !important;
            pointer-events: none !important;
        }
        
        .modal-header-coach::after {
            content: '' !important;
            position: absolute !important;
            bottom: 0 !important;
            left: 1.5rem !important;
            right: 1.5rem !important;
            height: 3px !important;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent) !important;
        }
        
        .modal-header-coach .modal-title {
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 1.35rem !important;
            letter-spacing: 0.3px !important;
            display: flex !important;
            align-items: center !important;
            gap: 1rem !important;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1) !important;
            position: relative !important;
            z-index: 1 !important;
        }
        
        .modal-header-coach .modal-title i {
            font-size: 1.5rem !important;
            opacity: 1 !important;
            animation: pulse-gentle 2s ease-in-out infinite !important;
        }
        
        @keyframes pulse-gentle {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }
        
        .modal-header-coach .modal-title span {
            position: relative !important;
        }
        
        /* ESTILOS PARA EL MODAL DE SOLICITAR PLAN DE DESARROLLO */
        .modal-header-development {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
            border-bottom: none !important;
            color: #ffffff !important;
            padding: 1.5rem 1.75rem !important;
            position: relative !important;
            overflow: hidden !important;
        }
        
        .modal-header-development::before {
            content: '' !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            background: radial-gradient(circle at top left, rgba(255,255,255,0.15) 0%, transparent 60%) !important;
            pointer-events: none !important;
        }
        
        .modal-header-development::after {
            content: '' !important;
            position: absolute !important;
            bottom: 0 !important;
            left: 1.5rem !important;
            right: 1.5rem !important;
            height: 3px !important;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.5), transparent) !important;
        }
        
        .modal-header-development .modal-title {
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 1.35rem !important;
            letter-spacing: 0.3px !important;
            display: flex !important;
            align-items: center !important;
            gap: 1rem !important;
            text-shadow: 0 2px 4px rgba(0,0,0,0.15) !important;
            position: relative !important;
            z-index: 1 !important;
        }
        
        .modal-header-development .modal-title i {
            font-size: 1.5rem !important;
            opacity: 1 !important;
            animation: pulse-gentle 2s ease-in-out infinite !important;
        }
        
        .modal-header-development .modal-title span {
            position: relative !important;
        }
        
        /* ESTILOS PARA EL MODAL DE RESULTADOS DE EVALUACIÓN - MISMOS QUE EVALUATIONDETAILSMODAL */
        #assessmentResultsModal .modal-header.modal-header-dark,
        #assessmentResultsModal .modal-header,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header {
            background: var(--calm-primary) !important;
            background-color: var(--calm-primary) !important;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2) !important;
            padding: 1.25rem 1.5rem !important;
            color: #ffffff !important;
        }
        
        #assessmentResultsModal .modal-header .modal-title,
        #assessmentResultsModal .modal-header h5,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header .modal-title {
            color: #ffffff !important;
            font-weight: 700 !important;
            font-size: 1.3rem !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
            letter-spacing: 0.5px !important;
        }
        
        #assessmentResultsModal .modal-header .modal-title i,
        #assessmentResultsModal .modal-header i,
        #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header i {
            color: #ffffff !important;
            opacity: 1 !important;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3) !important;
        }
        
        /* Forzar color blanco en TODOS los elementos del header con máxima especificidad */
        #assessmentResultsModal .modal-header,
        #assessmentResultsModal .modal-header h1,
        #assessmentResultsModal .modal-header h2,
        #assessmentResultsModal .modal-header h3,
        #assessmentResultsModal .modal-header h4,
        #assessmentResultsModal .modal-header h5,
        #assessmentResultsModal .modal-header h6,
        #assessmentResultsModal .modal-header span,
        #assessmentResultsModal .modal-header div:not(.d-flex):not(.gap-2) {
            color: #ffffff !important;
            background: transparent !important;
        }
        
        /* Asegurar que el contenedor de botones sea clickeable */
        #assessmentResultsModal .modal-header .d-flex,
        #assessmentResultsModal .modal-header .gap-2 {
            pointer-events: auto !important;
            z-index: 1000 !important;
        }
        
        /* Botones de la cabecera del modal de resultados */
        #assessmentResultsModal .modal-header .btn,
        #assessmentResultsModal .modal-header .btn-close,
        #assessmentResultsModal .modal-header .btn-secondary,
        #assessmentResultsModal .modal-header .btn-danger,
        #assessmentResultsModal .modal-header button {
            background-color: #6c757d !important;
            border: 1px solid #5a6268 !important;
            color: white !important;
            border-radius: 6px !important;
            padding: 8px 16px !important;
            transition: all 0.3s ease !important;
            font-weight: 600 !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            margin-left: 8px !important;
            pointer-events: auto !important;
            cursor: pointer !important;
            z-index: 999 !important;
            position: relative !important;
        }
        
        #assessmentResultsModal .modal-header .btn:hover,
        #assessmentResultsModal .modal-header .btn-close:hover,
        #assessmentResultsModal .modal-header .btn-secondary:hover,
        #assessmentResultsModal .modal-header .btn-danger:hover,
        #assessmentResultsModal .modal-header button:hover {
            background-color: #5a6268 !important;
            border-color: #4e555b !important;
            color: white !important;
            transform: translateY(-1px) !important;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3) !important;
            pointer-events: auto !important;
            cursor: pointer !important;
        }
        
        /* Especificidad ultra-alta para el background del modal de resultados */
        body #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header.modal-header-dark,
        body #assessmentResultsModal.modal .modal-dialog .modal-content .modal-header {
            background: #1E3A8A !important;
            background-color: #1E3A8A !important;
            color: #ffffff !important;
        }

        /* Estilos específicos para el modal de video */
        #videoModal .modal-header {
            background: #1E3A8A !important;
            color: white !important;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1) !important;
        }

        #videoModal .modal-header .modal-title {
            color: white !important;
            font-weight: 600 !important;
            flex-grow: 1 !important;
            margin-right: 1rem !important;
        }

        #videoModal .modal-header .btn-close {
            background: rgba(0, 0, 0, 0.6) !important;
            opacity: 1 !important;
            border-radius: 0.375rem !important;
            padding: 0.375rem !important;
            margin: 0 !important;
            margin-left: auto !important;
            border: none !important;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2) !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }

        #videoModal .modal-header .btn-close:hover {
            background: rgba(0, 0, 0, 0.8) !important;
            transform: scale(1.05) !important;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.3) !important;
        }

        #videoModal .modal-header .btn-close span {
            color: white !important;
            font-size: 1.2rem !important;
            font-weight: bold !important;
            line-height: 1 !important;
        }
        
        /* Estilos específicos para la sección de completado */
        #assessmentResultsModal .assessment-completion-section {
            background: linear-gradient(135deg, var(--calm-primary), var(--calm-secondary)) !important;
            color: white !important;
            padding: 2rem !important;
            border-radius: 12px !important;
            margin-bottom: 2rem !important;
            box-shadow: 0 4px 20px rgba(30, 58, 138, 0.3) !important;
        }
        
        #assessmentResultsModal .assessment-score-display {
            font-size: 3.5rem !important;
            font-weight: 800 !important;
            color: #ffffff !important;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3) !important;
        }
        
        #assessmentResultsModal .assessment-level-display {
            font-size: 1.5rem !important;
            font-weight: 600 !important;
            color: #ffffff !important;
            margin-top: 0.5rem !important;
            text-shadow: 0 1px 4px rgba(0, 0, 0, 0.2) !important;
        }

        /* Estilos profesionales para recomendaciones categorizadas */
        .recommendations-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 16px;
            border: 2px solid var(--calm-accent);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }
        
        .recommendations-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white !important;
            padding: 1.5rem;
            border-bottom: 3px solid var(--calm-accent);
            position: relative;
        }
        
        .recommendations-header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--calm-accent) 0%, #0ea5e9 50%, var(--calm-accent) 100%);
        }
        
        .recommendation-category {
            background: white;
            border-radius: 12px;
            margin-bottom: 1.5rem;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .recommendation-category:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
            border-color: var(--calm-accent);
        }
        
        .category-header {
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            border-bottom: 2px solid #e2e8f0;
            padding: 1rem 1.25rem;
            position: relative;
        }
        
        .category-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--calm-accent) 0%, #0ea5e9 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            margin-right: 0.75rem;
        }
        
        .score-badge {
            background: linear-gradient(135deg, var(--calm-secondary) 0%, var(--calm-accent) 100%);
            color: white;
            padding: 0.35rem 0.75rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        }
        
        .priority-indicator {
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-top: 15px solid;
        }
        
        .priority-high {
            border-top-color: #ef4444;
        }
        
        .priority-medium {
            border-top-color: #f59e0b;
        }
        
        .priority-low {
            border-top-color: #06b6d4;
        }
        
        .priority-growth {
            border-top-color: #10b981;
        }
        
        .category-content {
            padding: 1.25rem;
        }
        
        .recommendation-item {
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.75rem;
            border-left: 4px solid var(--calm-accent);
            position: relative;
            transition: all 0.2s ease;
        }
        
        .recommendation-item:hover {
            background: linear-gradient(135deg, #e2e8f0 0%, #cbd5e1 100%);
            border-left-color: var(--calm-primary);
            transform: translateX(5px);
        }
        
        .recommendation-item:before {
            content: "✓";
            position: absolute;
            left: -2px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            background: var(--calm-accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .recommendation-text {
            margin-left: 1.5rem;
            line-height: 1.6;
            color: #334155;
            font-weight: 500;
        }
        

        
        .strengths-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .strengths-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .strengths-category .category-title {
            color: white;
        }
        
        .strengths-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .strengths-category .recommendation-item:before {
            background: #10b981;
            content: "★";
        }
        
        .final-message {
            border: 2px solid #8b5cf6;
            background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%);
        }
        
        .final-message .category-header {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            border-bottom-color: #8b5cf6;
        }
        
        .final-message .category-title {
            color: white;
        }
        
        .final-message .recommendation-item {
            background: linear-gradient(135deg, #f5f3ff 0%, #ede9fe 100%);
            border-left-color: #8b5cf6;
        }
        
        /* Estilos especiales para subcategorías de dimensiones */
        .dimension-subcategory {
            border: 2px solid var(--calm-primary);
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            margin-bottom: 2rem;
        }
        
        .subcategory-header {
            background: linear-gradient(135deg, var(--calm-primary) 0%, #1D4ED8 100%);
            color: white;
            padding: 1.25rem;
            border-bottom: 3px solid var(--calm-accent);
        }
        
        .subcategory-title-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .subcategory-info {
            flex: 1;
        }
        
        .subcategory-title {
            margin: 0;
            font-size: 1.2rem;
            font-weight: 700;
            color: white;
        }
        
        .subcategory-subtitle {
            font-size: 0.9rem;
            opacity: 0.9;
            font-weight: 500;
        }
        
        .dimension-icon {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.1) 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
        }
        
        .score-container {
            text-align: center;
        }
        
        .score-badge-large {
            display: block;
            font-size: 1.5rem;
            font-weight: 800;
            padding: 0.75rem 1.25rem;
            border-radius: 25px;
            margin-bottom: 0.25rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.8);
        }
        
        .score-critical {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .score-needs-improvement {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        
        .score-good {
            background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
            color: white;
        }
        
        .score-excellent {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .score-level {
            font-size: 0.8rem;
            font-weight: 600;
            opacity: 0.9;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .subcategory-content {
            padding: 1.5rem;
            background: white;
        }
        
        .dimension-item {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-left: 4px solid var(--calm-primary);
        }
        
        .dimension-item:hover {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-left-color: #1D4ED8;
        }
        
        .dimension-item:before {
            background: var(--calm-primary);
            content: "→";
        }
        
        .congratulations-category {
            border: 2px solid #10b981;
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
        }
        
        .congratulations-category .category-header {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border-bottom-color: #10b981;
        }
        
        .congratulations-category .category-title {
            color: white;
        }
        
        .congratulations-category .recommendation-item {
            background: linear-gradient(135deg, #ecfdf5 0%, #d1fae5 100%);
            border-left-color: #10b981;
        }
        
        .congratulations-category .recommendation-item:before {
            background: #10b981;
            content: "🎉";
        }
        
        .dimension-category {
            border: 2px solid var(--calm-primary);
        }
        
        .dimension-category .priority-indicator {
            display: none; /* Hide priority indicator for dimension subcategories */
        }
        
        /* Responsive adjustments for subcategories */
        @media (max-width: 768px) {
            .subcategory-title-container {
                flex-direction: column;
                text-align: center;
            }
            
            .score-badge-large {
                font-size: 1.25rem;
                padding: 0.5rem 1rem;
            }
        }

        .progress-bar-custom {
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .progress-fill.high {
            background: var(--success-gradient);
        }

        .progress-fill.medium {
            background: var(--warning-gradient);
        }

        .progress-fill.low {
            background: var(--danger-gradient);
        }

        .dimension-score-card {
            transition: transform 0.2s ease;
        }

        .dimension-score-card:hover {
            transform: translateY(-2px);
        }

        .evaluation-section {
            border-left: 4px solid var(--primary-gradient);
            padding-left: 1rem;
            margin-bottom: 1.5rem;
        }

        .response-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
        }

        /* Improved Assessment Results Styles */
        .assessment-result-card {
            background: var(--calm-surface);
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(90, 103, 216, 0.08);
            overflow: hidden;
            margin-bottom: 2rem;
            border: 1px solid var(--calm-border);
            transition: all 0.3s ease;
        }

        .assessment-result-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(90, 103, 216, 0.12);
        }

        .assessment-result-header {
            background: var(--primary-gradient);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .assessment-result-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="60" cy="10" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="30" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="30" cy="70" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="70" cy="60" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="90" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
            pointer-events: none;
        }

        .assessment-score-display {
            font-size: 4rem;
            font-weight: 800;
            margin: 0.5rem 0;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 2;
        }

        .assessment-level-display {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            opacity: 0.95;
            position: relative;
            z-index: 2;
        }

        .assessment-completion-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: 50px;
            font-size: 0.9rem;
            font-weight: 500;
            margin-top: 1rem;
            position: relative;
            z-index: 2;
        }

        .assessment-result-body {
            padding: 2rem;
        }

        .assessment-interpretation {
            background: var(--calm-surface-elevated);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid var(--calm-primary);
        }

        .assessment-interpretation h5 {
            color: var(--calm-primary);
            font-weight: 600;
            margin-bottom: 1rem;
        }

        .assessment-interpretation p {
            color: var(--calm-text-secondary);
            line-height: 1.6;
            margin-bottom: 0;
        }

        .dimensions-overview {
            background: var(--calm-surface);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--calm-border);
        }

        .dimensions-overview h6 {
            color: var(--calm-text-primary);
            font-weight: 600;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
        }

        .dimension-item {
            background: var(--calm-surface-elevated);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--calm-border);
            transition: all 0.2s ease;
        }

        .dimension-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(90, 103, 216, 0.08);
        }

        .dimension-item:last-child {
            margin-bottom: 0;
        }

        .dimension-label {
            font-weight: 600;
            color: var(--calm-text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .dimension-score {
            font-weight: 700;
            color: var(--calm-primary);
        }

        .dimension-progress {
            background: var(--calm-border);
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .dimension-progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.8s ease-in-out;
            background: var(--primary-gradient);
            position: relative;
        }

        .dimension-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .assessment-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 2rem;
        }

        .assessment-action-btn {
            background: var(--calm-surface-elevated);
            border: 2px solid var(--calm-border);
            color: var(--calm-text-primary);
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .assessment-action-btn:hover {
            background: var(--calm-primary);
            border-color: var(--calm-primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(90, 103, 216, 0.25);
        }

        .assessment-action-btn.primary {
            background: var(--primary-gradient);
            border-color: var(--calm-primary);
            color: white;
        }

        .assessment-action-btn.primary:hover {
            background: var(--calm-primary-dark);
            border-color: var(--calm-primary-dark);
            color: white;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .assessment-score-display {
                font-size: 3rem;
            }
            
            .assessment-level-display {
                font-size: 1.2rem;
            }
            
            .assessment-result-header {
                padding: 1.5rem;
            }
            
            .assessment-result-body {
                padding: 1.5rem;
            }
            
            .assessment-actions {
                flex-direction: column;
            }
            
            .assessment-action-btn {
                width: 100%;
                justify-content: center;
            }
        }

        /* Utilities */
        .hidden { display: none !important; }
        .visible { display: block !important; }
        /* ========== FORZAR CONTRASTE GLOBAL - ANULAR BOOTSTRAP ========== */
        
        /* Anular todas las clases de texto claras de Bootstrap */
        .text-muted {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris claro */
        }
        
        .text-secondary {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris */
        }
        
        .text-light {
            color: var(--calm-text-primary) !important; /* Negro en lugar de gris claro */
        }
        
        /* Forzar contraste en summary cards */
        .summary-card {
            background: #FFFFFF !important; /* Fondo blanco puro */
            border: 2px solid var(--calm-primary) !important; /* Borde azul visible */
            box-shadow: 0 4px 20px rgba(30, 58, 138, 0.15) !important;
        }
        
        .summary-card .summary-number {
            color: var(--calm-primary) !important; /* Azul para números */
            font-weight: 800 !important;
        }
        
        .summary-card .summary-label {
            color: var(--calm-text-primary) !important; /* Negro para etiquetas */
            font-weight: 600 !important;
        }
        
        /* Forzar contraste en evaluation cards */
        .evaluation-item {
            background: #FFFFFF !important;
            border: 2px solid var(--calm-border) !important;
        }
        
        .evaluation-item .text-muted,
        .evaluation-item .small {
            color: var(--calm-text-muted) !important;
        }
        
        /* Task cards con mejor contraste */
        .task-item {
            background: #FFFFFF !important;
            border: 2px solid var(--calm-border) !important;
        }
        
        .task-item .text-muted {
            color: var(--calm-text-muted) !important;
        }
        
        /* Botones con contraste mejorado */
        .btn-outline-evaluation,
        .btn-outline-task,
        .btn-outline-progress {
            background: #FFFFFF !important;
            border-width: 2px !important;
            font-weight: 700 !important;
        }
        
        /* Asegurar que los iconos sean visibles */
        .summary-icon {
            border: 2px solid currentColor !important;
            background: rgba(255, 255, 255, 0.9) !important;
        }
        
        .summary-icon.primary {
            color: var(--calm-primary) !important;
            background: rgba(30, 58, 138, 0.1) !important;
        }
        
        .summary-icon.success {
            color: var(--calm-mint-green) !important;
            background: rgba(16, 185, 129, 0.1) !important;
        }
        
        .summary-icon.warning {
            color: #F59E0B !important;
            background: rgba(245, 158, 11, 0.1) !important;
        }
        
        .summary-icon.danger {
            color: #EF4444 !important;
            background: rgba(239, 68, 68, 0.1) !important;
        }
        
        /* Headers de cards más legibles */
        .card-header p {
            color: #111827 !important;
        }
        
        /* ========== FIN FORZAR CONTRASTE ========== */

        /* === SISTEMA DE TEMAS PARA COACHEE DASHBOARD === */
        /* Tema Día (por defecto) */
        :root {
            --theme-bg-primary: var(--calm-gradient-primary);
            --theme-bg-secondary: var(--calm-light);
            --theme-text-primary: var(--calm-white);
            --theme-text-secondary: var(--calm-gray-600);
            --theme-text-muted: rgba(255, 255, 255, 0.7);
            --theme-card-bg: rgba(255, 255, 255, 0.1);
            --theme-card-border: rgba(255, 255, 255, 0.2);
            --theme-shadow: var(--calm-shadow-soft);
            --theme-glass-bg: rgba(30, 58, 138, 0.08);
            --theme-glass-border: rgba(59, 130, 246, 0.12);
        }

        /* Tema Noche - COPIADO DEL COACH DASHBOARD */
        [data-theme="dark"] {
            /* Tema oscuro con tonos azulados del landing page */
            --theme-bg-primary: #3B82F6;        /* Bright Blue principal */
            --theme-bg-secondary: #3B82F6;      /* Bright Blue secundario */
            --theme-bg-card: rgba(51, 65, 85, 0.9);  /* Cards con tono azulado */
            --theme-text-primary: #F8FAFC;
            --theme-text-secondary: #CBD5E1;
            --theme-text-muted: #94A3B8;
            --theme-border-primary: rgba(148, 163, 184, 0.2);
            --theme-border-secondary: rgba(148, 163, 184, 0.3);
            --theme-shadow: rgba(30, 58, 138, 0.2);  /* Sombras con tinte azul */
            --theme-accent: #3B82F6;             /* Azul del landing page */
            --theme-accent-hover: #60A5FA;       /* Azul más claro al hover */
        }

        /* Aplicar variables a elementos base */
        [data-theme="dark"] body {
            background: var(--theme-bg-primary) !important;
            color: var(--theme-text-primary) !important;
            transition: background-color 0.3s ease, color 0.3s ease !important;
        }

        /* === ESTILOS PARA TEMA NOCTURNO MEJORADOS === */
        [data-theme="dark"] .glass-card {
            background: rgba(59, 130, 246, 0.85) !important;  /* Azul principal #3B82F6 con transparencia */
            border-color: rgba(59, 130, 246, 0.3) !important;  /* Borde azul */
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.15) !important;  /* Sombra azul */
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .glass-card:hover {
            background: rgba(59, 130, 246, 0.95) !important;  /* Azul más sólido en hover */
            border-color: rgba(59, 130, 246, 0.4) !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 12px 30px rgba(59, 130, 246, 0.25) !important;
        }

        [data-theme="dark"] .glass-card h3,
        [data-theme="dark"] .glass-card h4,
        [data-theme="dark"] .glass-card h5,
        [data-theme="dark"] .glass-card h6 {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .glass-card .text-muted {
            color: var(--theme-text-muted) !important;
        }

        [data-theme="dark"] .text-white-50 {
            color: var(--theme-text-secondary) !important;
        }

        [data-theme="dark"] .btn-outline-light {
            border-color: #06B6D4 !important;
            color: #06B6D4 !important;
            background: rgba(6, 182, 212, 0.1) !important;
        }

        [data-theme="dark"] .btn-outline-light:hover {
            background-color: rgba(6, 182, 212, 0.2) !important;
            border-color: #0284C7 !important;
            color: #0284C7 !important;
        }

        [data-theme="dark"] .btn-outline-light i {
            color: #06B6D4 !important;
        }

        [data-theme="dark"] .btn-outline-light:hover i {
            color: #0284C7 !important;
        }

        [data-theme="dark"] .btn-primary {
            background: linear-gradient(135deg, #3B82F6, #3B82F6) !important;  /* Bright Blue uniforme */
            border-color: #3B82F6 !important;
            color: #FFFFFF !important;
        }

        [data-theme="dark"] .btn-primary:hover {
            background: linear-gradient(135deg, #3B82F6, #2563EB) !important;  /* Hover con variación sutil */
            border-color: #3B82F6 !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        [data-theme="dark"] .btn-outline-primary {
            color: #3B82F6 !important;
            border-color: #3B82F6 !important;
            background: transparent !important;
        }

        [data-theme="dark"] .btn-outline-primary:hover {
            background: #3B82F6 !important;
            border-color: #3B82F6 !important;
            color: white !important;
        }

        [data-theme="dark"] .modal-content {
            background: rgba(51, 65, 85, 0.95) !important;  /* Azul grisáceo */
            border-color: rgba(59, 130, 246, 0.2) !important;  /* Borde azul suave */
            box-shadow: 0 20px 40px rgba(30, 58, 138, 0.25) !important;  /* Sombra azulada */
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .modal-header {
            border-color: rgba(59, 130, 246, 0.2) !important;
            background: rgba(51, 65, 85, 0.95) !important;
        }

        [data-theme="dark"] .modal-footer {
            border-color: rgba(59, 130, 246, 0.2) !important;
            background: rgba(51, 65, 85, 0.95) !important;
        }

        [data-theme="dark"] .modal-title {
            color: var(--theme-text-primary) !important;
        }

        /* Estilos específicos para asegurar que todos los textos sean visibles en modo noche */
        [data-theme="dark"] .card-header h3,
        [data-theme="dark"] .card-header h4,
        [data-theme="dark"] .card-header h5,
        [data-theme="dark"] .card-header h6 {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .evaluation-item h6 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Estilo para títulos de evaluaciones disponibles (h5) */
        [data-theme="dark"] .evaluation-item h5 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Override específico para evaluaciones disponibles dentro del card-body */
        [data-theme="dark"] #availableEvaluations .evaluation-item h5,
        [data-theme="dark"] .card-body .evaluation-item h5 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Estilos para evaluaciones completadas - mantener colores originales */
        [data-theme="dark"] .evaluation-score.text-success,
        [data-theme="dark"] .evaluation-level.text-success {
            color: #10B981 !important; /* Verde más brillante para modo noche */
            font-weight: bold !important;
        }

        [data-theme="dark"] .evaluation-score.text-warning,
        [data-theme="dark"] .evaluation-level.text-warning {
            color: #F59E0B !important; /* Amarillo más brillante para modo noche */
            font-weight: bold !important;
        }

        [data-theme="dark"] .evaluation-score.text-danger,
        [data-theme="dark"] .evaluation-level.text-danger {
            color: #EF4444 !important; /* Rojo más brillante para modo noche */
            font-weight: bold !important;
        }

        /* Override más específico para evaluaciones completadas */
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-success,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-success {
            color: #10B981 !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-warning,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-warning {
            color: #F59E0B !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-score.text-danger,
        [data-theme="dark"] #completedEvaluations .evaluation-item .evaluation-level.text-danger {
            color: #EF4444 !important;
            font-weight: bold !important;
        }

        /* Estilos para tareas asignadas en modo noche */
        [data-theme="dark"] .task-item .task-title {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] .task-item .task-description {
            color: #2d3748 !important;
        }

        [data-theme="dark"] .task-item .text-muted,
        [data-theme="dark"] .task-item small {
            color: #4a5568 !important;
        }

        [data-theme="dark"] .task-badge {
            color: #1a1a1a !important;
            background: rgba(255, 255, 255, 0.9) !important;
            border: 1px solid #4a5568 !important;
        }

        /* Estilos específicos para badges de prioridad en modo noche */
        [data-theme="dark"] .task-badge.priority-high {
            background: #FED7D7 !important;
            color: #C53030 !important;
        }

        [data-theme="dark"] .task-badge.priority-medium {
            background: #FEEBC8 !important;
            color: #DD6B20 !important;
        }

        [data-theme="dark"] .task-badge.priority-low {
            background: #C6F6D5 !important;
            color: #38A169 !important;
        }

        /* Estilos para badges de estado en modo noche */
        [data-theme="dark"] .task-badge.status-pending {
            background: #BEE3F8 !important;
            color: #2B6CB0 !important;
        }

        [data-theme="dark"] .task-badge.status-in_progress {
            background: #FEEBC8 !important;
            color: #DD6B20 !important;
        }

        [data-theme="dark"] .task-badge.status-completed {
            background: #C6F6D5 !important;
            color: #38A169 !important;
        }

        /* Override específico para contenedor de tareas */
        [data-theme="dark"] #tasksContainer .task-item h5,
        [data-theme="dark"] #tasksContainer .task-item .task-title {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        [data-theme="dark"] #tasksContainer .task-item p,
        [data-theme="dark"] #tasksContainer .task-item .task-description {
            color: #2d3748 !important;
        }

        [data-theme="dark"] .dashboard-card h3 {
            color: var(--theme-text-primary) !important;
        }

        /* Corregir el problema específico del card-header que fuerza texto blanco */
        [data-theme="dark"] .card-header,
        [data-theme="dark"] .card-header *,
        [data-theme="dark"] .card-header .text-muted,
        [data-theme="dark"] .card-header .text-secondary,
        [data-theme="dark"] .card-header small,
        [data-theme="dark"] .card-header span {
            color: #000000 !important;
        }

        /* Aplicar color negro oscuro y bold para h3 en card-header - MÁS ESPECÍFICO */
        [data-theme="dark"] .dashboard-card .card-header h3,
        [data-theme="dark"] .card-header h3.mb-0 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Override final super específico para el texto "Evaluación de Asertividad" */
        [data-theme="dark"] #assessment .dashboard-card .card-header h3,
        [data-theme="dark"] .tab-pane .dashboard-card .card-header h3 {
            color: #1a1a1a !important;
            font-weight: bold !important;
        }

        /* Excepciones para elementos que deben mantener su color */
        [data-theme="dark"] .btn,
        [data-theme="dark"] .badge,
        [data-theme="dark"] .progress-bar,
        [data-theme="dark"] .evaluation-score {
            color: inherit !important;
        }

        /* Formularios en tema nocturno */
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .form-select {
            background: rgba(51, 65, 85, 0.8) !important;
            border-color: rgba(59, 130, 246, 0.3) !important;
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .form-control:focus,
        [data-theme="dark"] .form-select:focus {
            background: rgba(51, 65, 85, 0.9) !important;
            border-color: #3B82F6 !important;
            color: var(--theme-text-primary) !important;
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25) !important;
        }

        [data-theme="dark"] .form-control::placeholder {
            color: var(--theme-text-muted) !important;
        }

        /* Badges en tema nocturno */
        [data-theme="dark"] .badge.bg-primary {
            background-color: #3B82F6 !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .badge.bg-success {
            background-color: #10B981 !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .badge.bg-warning {
            background-color: #F59E0B !important;
            color: #0F172A !important;
        }

        [data-theme="dark"] .badge.bg-danger {
            background-color: #EF4444 !important;
            color: #F8FAFC !important;
        }

        /* Progress bars en tema nocturno */
        [data-theme="dark"] .progress {
            background-color: rgba(30, 41, 59, 0.5) !important;
        }

        /* Tablas en tema nocturno */
        [data-theme="dark"] .table {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .table-striped > tbody > tr:nth-of-type(odd) > td {
            background-color: rgba(30, 41, 59, 0.3) !important;
        }

        /* Canvas/gráficos en tema nocturno */
        [data-theme="dark"] canvas {
            filter: brightness(0.9) contrast(1.1);
        }

        /* Transiciones suaves */
        body,
        .glass-card,
        .card,
        .btn,
        .form-control,
        .form-select,
        .modal-content {
            transition: all 0.3s ease;
        }

        /* === MEJORAS COMPREHENSIVAS PARA MODO NOCHE === */
        
        /* Mejoras para títulos y encabezados en modo noche */
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6 {
            color: #F8FAFC !important;
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        /* Mejoras para texto general en modo noche */
        [data-theme="dark"] p,
        [data-theme="dark"] span,
        [data-theme="dark"] div,
        [data-theme="dark"] label {
            color: #E2E8F0 !important;
            text-shadow: none !important;
        }

        /* Mejoras para enlaces en modo noche */
        [data-theme="dark"] a {
            color: #60A5FA !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] a:hover {
            color: #93C5FD !important;
            text-decoration: underline !important;
        }

        /* Mejoras para botones en modo noche */
        [data-theme="dark"] .btn {
            background: rgba(59, 130, 246, 0.9) !important;
            border: 1px solid rgba(59, 130, 246, 0.6) !important;
            color: #FFFFFF !important;
            text-shadow: none !important;
            backdrop-filter: none !important;
        }

        [data-theme="dark"] .btn:hover {
            background: rgba(59, 130, 246, 1) !important;
            border-color: rgba(59, 130, 246, 0.8) !important;
            color: #FFFFFF !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4) !important;
        }

        /* Mejoras para botones secundarios en modo noche */
        [data-theme="dark"] .btn-secondary {
            background: rgba(148, 163, 184, 0.6) !important;
            border-color: rgba(148, 163, 184, 0.4) !important;
            color: #FFFFFF !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] .btn-secondary:hover {
            background: rgba(148, 163, 184, 0.8) !important;
            color: #FFFFFF !important;
        }

        /* Estilos adicionales para cards y elementos específicos */
        [data-theme="dark"] .card {
            background: var(--theme-bg-card) !important;
            border-color: rgba(59, 130, 246, 0.2) !important;
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .card-header {
            background: var(--theme-bg-card) !important;
            border-bottom-color: rgba(59, 130, 246, 0.2) !important;
        }

        [data-theme="dark"] .card-body {
            background: var(--theme-bg-card) !important;
        }

        [data-theme="dark"] .navbar {
            background: var(--theme-bg-primary) !important;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2) !important;
        }

        [data-theme="dark"] .navbar-brand {
            color: var(--theme-text-primary) !important;
        }

        /* Estilos finales globales */
        [data-theme="dark"] h1, [data-theme="dark"] h2, [data-theme="dark"] h3, 
        [data-theme="dark"] h4, [data-theme="dark"] h5, [data-theme="dark"] h6,
        [data-theme="dark"] p, [data-theme="dark"] span, [data-theme="dark"] div {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .text-dark {
            color: var(--theme-text-primary) !important;
        }

        [data-theme="dark"] .bg-light, [data-theme="dark"] .bg-white {
            background: var(--theme-bg-card) !important;
        }

        [data-theme="dark"] .form-control:focus,
        [data-theme="dark"] .form-select:focus {
            background: rgba(30, 41, 59, 0.95) !important;
            border-color: #3B82F6 !important;
            box-shadow: 0 0 0 0.25rem rgba(59, 130, 246, 0.4) !important;
            color: #FFFFFF !important;
        }

        /* Mejoras para tablas en modo noche */
        [data-theme="dark"] .table {
            background: rgba(30, 41, 59, 0.6) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .table th {
            background: rgba(59, 130, 246, 0.2) !important;
            color: #F8FAFC !important;
            border-color: rgba(148, 163, 184, 0.3) !important;
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        [data-theme="dark"] .table td {
            border-color: rgba(148, 163, 184, 0.2) !important;
            color: #E2E8F0 !important;
        }

        /* Mejoras para badges en modo noche */
        [data-theme="dark"] .badge {
            text-shadow: none !important;
            font-weight: 600 !important;
        }

        /* Mejoras para alerts en modo noche */
        [data-theme="dark"] .alert {
            background: rgba(30, 41, 59, 0.9) !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            color: #F8FAFC !important;
            backdrop-filter: none !important;
        }

        [data-theme="dark"] .alert-info {
            background: rgba(59, 130, 246, 0.2) !important;
            border-color: rgba(59, 130, 246, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-success {
            background: rgba(16, 185, 129, 0.2) !important;
            border-color: rgba(16, 185, 129, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-warning {
            background: rgba(245, 158, 11, 0.2) !important;
            border-color: rgba(245, 158, 11, 0.4) !important;
            color: #F8FAFC !important;
        }

        [data-theme="dark"] .alert-danger {
            background: rgba(239, 68, 68, 0.2) !important;
            border-color: rgba(239, 68, 68, 0.4) !important;
            color: #F8FAFC !important;
        }

        /* Mejoras para dropdowns en modo noche */
        [data-theme="dark"] .dropdown-menu {
            background: rgba(30, 41, 59, 0.98) !important;
            border: 1px solid rgba(148, 163, 184, 0.3) !important;
            backdrop-filter: none !important;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6) !important;
        }

        [data-theme="dark"] .dropdown-item {
            color: #E2E8F0 !important;
            text-shadow: none !important;
        }

        [data-theme="dark"] .dropdown-item:hover {
            background: rgba(59, 130, 246, 0.3) !important;
            color: #F8FAFC !important;
        }

        /* Mejoras para scrollbars en modo noche */
        [data-theme="dark"] ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.6);
            border-radius: 4px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.6);
            border-radius: 4px;
        }

        [data-theme="dark"] ::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.8);
        }

        /* === ELIMINACIÓN TOTAL DE EFECTOS BLUR EN MODO NOCHE === */
        
        /* Override general para eliminar todos los backdrop-filter y filter blur en modo noche */
        [data-theme="dark"] *,
        [data-theme="dark"] *::before,
        [data-theme="dark"] *::after {
            backdrop-filter: none !important;
        }
        
        /* Específicamente para elementos que pueden tener blur */
        [data-theme="dark"] .glass-card,
        [data-theme="dark"] .card,
        [data-theme="dark"] .modal-content,
        [data-theme="dark"] .navbar,
        [data-theme="dark"] .btn,
        [data-theme="dark"] .alert,
        [data-theme="dark"] .dropdown-menu,
        [data-theme="dark"] .form-control,
        [data-theme="dark"] .badge {
            backdrop-filter: none !important;
            filter: none !important;
        }
        
        /* Asegurar que el texto sea completamente nítido */
        [data-theme="dark"] h1,
        [data-theme="dark"] h2,
        [data-theme="dark"] h3,
        [data-theme="dark"] h4,
        [data-theme="dark"] h5,
        [data-theme="dark"] h6,
        [data-theme="dark"] p,
        [data-theme="dark"] span,
        [data-theme="dark"] div,
        [data-theme="dark"] label,
        [data-theme="dark"] a,
        [data-theme="dark"] button {
            text-rendering: optimizeLegibility !important;
            -webkit-font-smoothing: antialiased !important;
            -moz-osx-font-smoothing: grayscale !important;
        }

        /* Estilos para presentación compacta de recomendaciones */
        .compact-recommendations .card {
            transition: all 0.2s ease;
        }
        
        .compact-recommendations .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15) !important;
        }
        
        .compact-recommendations .card-header {
            border-bottom: 2px solid #007bff;
        }
        
        .compact-recommendations .fw-bold {
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .compact-recommendations small {
            font-size: 0.8rem;
            line-height: 1.3;
        }
        
        .compact-recommendations .text-primary {
            color: #007bff !important;
            border-bottom: 1px solid rgba(0, 123, 255, 0.2);
            padding-bottom: 2px;
            margin-bottom: 8px !important;
        }
        
        .compact-recommendations .ms-3 {
            padding-left: 1rem;
            border-left: 2px solid #e9ecef;
            margin-left: 0.5rem;
        }
        
        .compact-recommendations .badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.5rem;
        }
        
        /* ========== OPTIMIZACIÓN MÓVIL PARA MODAL DE EVALUACIÓN ========== */
        
        /* NOTA: Estilos del modal #evaluationDetailsModal ya definidos arriba en línea 4295 */
        
        #evaluationDetailsModal .modal-content {
            border-radius: 12px;
            border: none;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            overflow: hidden;
        }
        
        @media (max-width: 768px) {
            /* Modal de evaluación debajo del header en móvil */
            #evaluationDetailsModal {
                position: fixed !important;
                top: 100px !important; /* Margen superior optimizado */
                left: 0 !important;
                width: 100vw !important;
                height: calc(100vh - 100px) !important; /* Ajustado al nuevo top */
                margin: 0 !important;
                padding: 0 !important;
                z-index: 1060 !important;
                overflow-y: auto !important;
            }
            
            #evaluationDetailsModal .modal-dialog {
                width: 100% !important;
                max-width: 100% !important;
                margin: 0 auto 65px auto !important;
                height: 100% !important;
                max-height: 100% !important;
            }
            
            #evaluationDetailsModal .modal-content {
                height: 100% !important;
                max-height: 100% !important;
                border-radius: 0 !important;
                border: none;
                display: flex;
                flex-direction: column;
            }
            
            #evaluationDetailsModal .modal-header {
                padding: 15px;
                border-bottom: 1px solid #dee2e6;
                flex-shrink: 0;
                position: relative;
                z-index: 1;
            }
            
            #evaluationDetailsModal .modal-body {
                padding: 15px;
                overflow-y: auto;
                flex: 1;
                -webkit-overflow-scrolling: touch;
            }
            
            #evaluationDetailsModal .modal-footer {
                padding: 15px 15px 60px 15px; /* Padding inferior aumentado para ver botones */
                border-top: 1px solid #dee2e6;
                flex-shrink: 0;
                margin-bottom: 20px; /* Margen adicional en el footer */
            }
            
            /* Ajustar elementos internos del modal para móvil */
            #evaluationDetailsModal .modal-title {
                font-size: 1.1rem;
                line-height: 1.3;
            }
            
            #evaluationDetailsModal .btn {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            #evaluationDetailsModal .table-responsive {
                font-size: 13px;
            }
            
            #evaluationDetailsModal .chart-container {
                height: 250px !important;
            }
        }
        
        /* Para pantallas muy pequeñas (móviles en horizontal o muy pequeños) */
        @media (max-width: 576px) {
            #evaluationDetailsModal .modal-header {
                padding: 10px;
            }
            
            #evaluationDetailsModal .modal-body {
                padding: 10px;
            }
            
            #evaluationDetailsModal .modal-footer {
                padding: 10px;
            }
            
            #evaluationDetailsModal .modal-title {
                font-size: 1rem;
            }
            
            #evaluationDetailsModal .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
        }

        /* ========== MEJORAS RESPONSIVAS PARA SCHEDULE COACH MODULE ========== */
        @media (max-width: 768px) {
            /* Schedule Coach - Pestañas responsivas */
            #scheduleCoachTabs {
                flex-wrap: nowrap !important;
                overflow-x: auto !important;
                border-bottom: 1px solid #dee2e6 !important;
                scrollbar-width: none !important; /* Firefox */
                -ms-overflow-style: none !important; /* IE/Edge */
            }
            
            #scheduleCoachTabs::-webkit-scrollbar {
                display: none !important; /* Chrome/Safari */
            }
            
            #scheduleCoachTabs .nav-item {
                flex-shrink: 0 !important;
            }
            
            #scheduleCoachTabs .nav-link {
                white-space: nowrap !important;
                padding: 8px 12px !important;
                font-size: 0.85rem !important;
            }
            
            /* Schedule Coach - Layout responsivo */
            #schedule-coach .col-lg-8,
            #schedule-coach .col-lg-4 {
                margin-bottom: 1rem !important;
            }
            
            /* Formulario de solicitud - Stack vertical en mobile */
            #sessionRequestForm .row.g-3 .col-md-6 {
                margin-bottom: 1rem !important;
            }
            
            #sessionRequestForm .form-label {
                font-size: 0.9rem !important;
                margin-bottom: 0.25rem !important;
            }
            
            #sessionRequestForm .form-control,
            #sessionRequestForm .form-select {
                font-size: 0.9rem !important;
                padding: 0.5rem !important;
            }
            
            #sessionRequestForm .form-text {
                font-size: 0.75rem !important;
            }
            
            /* Información del coach más compacta */
            #coachAvailabilityInfo {
                padding: 0.75rem !important;
            }
            
            #coachAvailabilityInfo .list-group-item {
                padding: 0.5rem 0.75rem !important;
                font-size: 0.85rem !important;
            }
            
            /* Tips para agendar más compactos */
            #schedule-coach .card .list-unstyled li {
                margin-bottom: 0.75rem !important;
                font-size: 0.85rem !important;
            }
            
            /* Lista de sesiones responsiva */
            #mySessionsList .card {
                margin-bottom: 0.75rem !important;
            }
            
            #mySessionsList .card-body {
                padding: 0.75rem !important;
            }
            
            #mySessionsList .card-title {
                font-size: 1rem !important;
            }
            
            #mySessionsList .card-text {
                font-size: 0.85rem !important;
            }
            
            /* Botones de sesión más compactos */
            #mySessionsList .btn-group {
                flex-direction: column !important;
                width: 100% !important;
            }
            
            #mySessionsList .btn-group .btn {
                border-radius: 0.375rem !important;
                margin-bottom: 0.25rem !important;
                font-size: 0.8rem !important;
                padding: 0.375rem 0.75rem !important;
            }
        }

        @media (max-width: 576px) {
            /* Mobile específico para schedule coach */
            #scheduleCoachTabs .nav-link {
                padding: 6px 8px !important;
                font-size: 0.8rem !important;
            }
            
            #scheduleCoachTabs .nav-link i {
                margin-right: 4px !important;
            }
            
            /* Ocultar texto en iconos en pantallas muy pequeñas */
            #scheduleCoachTabs .nav-link .d-none {
                display: none !important;
            }
            
            /* Formulario más compacto */
            #sessionRequestForm .card-body {
                padding: 0.75rem !important;
            }
            
            #sessionRequestForm .btn {
                width: 100% !important;
                padding: 0.75rem !important;
                font-size: 0.9rem !important;
            }
            
            /* Cards de información más pequeñas */
            #schedule-coach .card-header h6 {
                font-size: 0.9rem !important;
            }
            
            #schedule-coach .card-body {
                padding: 0.75rem !important;
            }
            
            /* Lista de sesiones en mobile */
            #mySessionsList .card-body {
                padding: 0.5rem !important;
            }
            
            #mySessionsList .badge {
                font-size: 0.7rem !important;
            }
            
            /* Botones de acción stack vertical */
            #my-sessions-pane .d-flex {
                flex-direction: column !important;
                gap: 0.5rem !important;
            }
            
            #my-sessions-pane .d-flex .btn {
                width: 100% !important;
            }
        }

        /* Tablet específico para schedule coach */
        @media (min-width: 769px) and (max-width: 1024px) {
            #schedule-coach .col-lg-4 {
                margin-top: 1rem !important;
            }
            
            #scheduleCoachTabs .nav-link {
                padding: 10px 16px !important;
            }
            
            /* Formulario en 2 columnas en tablet */
            #sessionRequestForm .row.g-3 {
                margin: 0 -0.5rem !important;
            }
            
            #sessionRequestForm .col-md-6 {
                padding: 0 0.5rem !important;
            }
            
            /* Cards de información lado a lado en tablet */
            #schedule-coach .col-lg-4 .card {
                margin-bottom: 1rem !important;
            }
        }

        /* Mejoras adicionales para mejor UX en todos los dispositivos */
        #schedule-coach .nav-tabs .nav-link.active {
            background-color: var(--theme-card-bg, #fff) !important;
            border-color: var(--theme-border, #dee2e6) !important;
            color: var(--theme-text, #495057) !important;
        }
        
        #schedule-coach .tab-content {
            border: 1px solid var(--theme-border, #dee2e6) !important;
            border-top: none !important;
            border-radius: 0 0 0.375rem 0.375rem !important;
            background-color: var(--theme-card-bg, #fff) !important;
            padding: 1rem !important;
        }
        
        @media (max-width: 768px) {
            #schedule-coach .tab-content {
                padding: 0.75rem !important;
            }
        }
        /* Document card styles */
        .document-card {
            transition: all 0.3s ease;
            border: 1px solid #dee2e6;
            height: 100%;
        }
        
        .document-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15) !important;
            border-color: #007bff;
        }
        
        .document-card .card-header {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 1px solid #dee2e6;
            padding: 0.75rem;
            min-height: 60px;
            display: flex;
            align-items: center;
        }
        
        .document-card .card-body {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px);
        }
        
        .document-files .border {
            transition: all 0.2s ease;
            background-color: #f8f9fa;
        }
        
        .document-files .border:hover {
            background-color: #e3f2fd;
            border-color: #007bff !important;
        }
        
        /* Utility classes for better text handling */
        .min-width-0 {
            min-width: 0;
        }
        
        .flex-shrink-0 {
            flex-shrink: 0;
        }
        
        .text-truncate {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
        }
        
        /* Document filters */
        #documentFilters {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid #dee2e6;
        }
        
        /* Content tabs styling */
        #contentTabs .nav-link {
            color: #6c757d;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }
        
        #contentTabs .nav-link:hover {
            color: #007bff;
            border-bottom-color: #007bff;
        }
        
        #contentTabs .nav-link.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background: none;
            font-weight: 600;
        }
        
        /* Dark theme support for document cards */
        [data-theme="dark"] .document-card {
            background: #2d3748;
            border-color: #4a5568;
        }
        
        [data-theme="dark"] .document-card:hover {
            border-color: #63b3ed;
            box-shadow: 0 4px 12px rgba(99, 179, 237, 0.15) !important;
        }
        
        [data-theme="dark"] .document-card .card-header {
            background: linear-gradient(135deg, #374151 0%, #4b5563 100%);
            border-bottom-color: #4a5568;
        }
        
        [data-theme="dark"] .document-files .border {
            background-color: #374151;
            border-color: #4a5568;
        }
        
        [data-theme="dark"] .document-files .border:hover {
            background-color: #1e3a8a;
            border-color: #63b3ed !important;
        }
        
        [data-theme="dark"] .document-card .card-header {
            background: linear-gradient(135deg, #2d3748 0%, #4a5568 100%);
            border-bottom-color: #4a5568;
            color: #e2e8f0;
        }
        
        [data-theme="dark"] #documentFilters {
            background: #2d3748;
            border-color: #4a5568;
        }
        
        [data-theme="dark"] .document-files .border:hover {
            background-color: #4a5568;
            border-color: #63b3ed !important;
        }
        
        [data-theme="dark"] #contentTabs .nav-link {
            color: #a0aec0;
        }
        
        [data-theme="dark"] #contentTabs .nav-link:hover {
            color: #63b3ed;
            border-bottom-color: #63b3ed;
        }
        
        [data-theme="dark"] #contentTabs .nav-link.active {
            color: #63b3ed;
            border-bottom-color: #63b3ed;
        }
        
        /* Empty state styling for documents */
        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }
        
        [data-theme="dark"] .empty-state {
            color: #a0aec0;
        }
        
        /* ========== INSTAGRAM STYLE FEEDS ========== */
        .feeds-container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .instagram-post {
            background: white;
            border: 1px solid #dbdbdb;
            border-radius: 8px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .post-header {
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .post-author {
            display: flex;
            align-items: center;
        }
        
        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #405de6, #5851db, #833ab4, #c13584, #e1306c, #fd1d1d);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
            margin-right: 12px;
        }
        
        .author-info h6 {
            margin: 0;
            font-weight: 600;
            font-size: 14px;
        }
        
        .author-info small {
            font-size: 12px;
            color: #8e8e8e;
        }
        
        .post-options {
            background: none;
            border: none;
            color: #8e8e8e;
            font-size: 16px;
            cursor: pointer;
        }
        
        .post-media {
            position: relative;
            width: 100%;
            background: #000;
        }

        .post-media .ratio {
            background: #000;
            border-radius: 0;
            max-height: 280px; /* Limitar altura máxima para que se vean los iconos */
        }

        .post-media .ratio-4x3 {
            max-height: 280px;
            overflow: hidden;
        }

        .post-media .ratio iframe {
            border-radius: 0;
            height: 280px;
            width: 100%;
            object-fit: cover;
        }
        
        .post-image {
            width: 100%;
            height: 280px; /* Misma altura que los videos */
            object-fit: cover;
            display: block;
        }
        
        .video-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .video-overlay:hover {
            background: rgba(0,0,0,0.9);
            transform: translate(-50%, -50%) scale(1.1);
        }
        
        .video-overlay i {
            color: white;
            font-size: 24px;
            margin-left: 3px;
        }
        
        .post-actions {
            padding: 8px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .action-buttons {
            display: flex;
            gap: 16px;
        }
        
        .action-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #262626;
            transition: color 0.2s ease;
            padding: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 40px;
            min-height: 40px;
        }

        .action-btn i {
            font-size: 24px !important;
            line-height: 1;
            font-family: "Font Awesome 6 Free" !important;
            font-weight: 400 !important;
            display: inline-block;
        }

        .action-btn i.fas {
            font-weight: 900 !important;
        }

        .action-btn small {
            margin-left: 4px;
            font-size: 10px;
            white-space: nowrap;
        }

        /* Asegurar que los iconos FontAwesome se vean */
        .post-actions .action-btn i:before {
            font-family: "Font Awesome 6 Free" !important;
        }
        
        .action-btn:hover {
            color: #8e8e8e;
        }
        
        .action-btn.liked {
            color: #ed4956;
        }
        
        .post-info {
            padding: 0 16px 16px;
        }
        
        .post-likes {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .post-caption {
            font-size: 14px;
            line-height: 1.4;
        }
        
        .post-caption .username {
            font-weight: 600;
            margin-right: 8px;
        }
        
        .post-time {
            color: #8e8e8e;
            font-size: 12px;
            margin-top: 8px;
        }
        
        /* Dark theme for Instagram posts */
        [data-theme="dark"] .instagram-post {
            background: #1a1a1a;
            border-color: #333;
        }
        
        [data-theme="dark"] .author-info h6,
        [data-theme="dark"] .action-btn,
        [data-theme="dark"] .post-likes,
        [data-theme="dark"] .post-caption {
            color: #ffffff;
        }
        
        [data-theme="dark"] .author-info small,
        [data-theme="dark"] .post-time {
            color: #8e8e8e;
        }
        
        [data-theme="dark"] .action-btn:hover {
            color: #dbdbdb;
        }
        
        /* Bottom Navigation - Estilo LinkedIn */
        .bottom-navigation {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            border-top: 1px solid #dbdbdb;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 1000;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            cursor: pointer;
            padding: 8px;
            transition: color 0.2s;
            color: #8e8e8e;
            text-decoration: none;
        }
        
        .nav-item i {
            font-size: 24px;
            margin-bottom: 4px;
        }
        
        .nav-item span {
            font-size: 11px;
            font-weight: 500;
        }
        
        .nav-item:hover,
        .nav-item.active {
            color: #0a66c2;
        }
        
        .nav-item.active {
            color: #262626;
        }
        
        /* Espacio inferior para evitar que el contenido quede debajo del nav */
        body {
            padding-bottom: 70px;
        }
        
        /* Tema oscuro para bottom navigation */
        [data-theme="dark"] .bottom-navigation {
            background: #1a1a1a;
            border-top-color: #2a2a2a;
        }
        
        [data-theme="dark"] .nav-item {
            color: #8e8e8e;
        }
        
        [data-theme="dark"] .nav-item:hover,
        [data-theme="dark"] .nav-item.active {
            color: #0a66c2;
        }
    </style>
</head>
<body x-data="coacheeDashboardApp()" x-init="init()">
    <!-- Animated background particles -->
    <div class="particles">
        <!-- Particles will be generated by JavaScript -->
    </div>

    <!-- Header - UNIFICADO CON FEED -->
    <div class="feed-header">
        <div>
            <h3 id="instacoach-title">InstaCoach</h3>
            <p class="mb-0" style="font-size: 14px; margin-top: 4px; color: #8e8e8e;">Welcome <span x-text="coacheeName.split(' ')[0] || 'Usuario'"></span></p>
        </div>
        <div class="user-info">
            <div class="user-avatar" id="headerAvatarDashboard" x-html="coacheeAvatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="dropdown">
                <button class="btn btn-link p-0 ms-2" type="button" id="userMenuDropdownDashboard" data-bs-toggle="dropdown" aria-expanded="false" style="color: #262626;">
                    <i class="fas fa-ellipsis-v"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuDropdownDashboard">
                    <li><a class="dropdown-item" href="/coachee-profile"><i class="fas fa-user-circle me-2"></i>Mi Perfil</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="#" @click.prevent="openChangePasswordModalCoachee()"><i class="fas fa-key me-2"></i>Cambiar Contraseña</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item" href="/participant-access"><i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión</a></li>
                </ul>
            </div>
        </div>
    </div>

<div class="container-fluid py-4">
        
        <!-- Statistics Cards - UNIFICADO CON COACH -->
        <div class="row mb-4 g-2 g-md-3">
            <div class="col-6 col-md-3 stats-card-mobile">
                <div class="card border-0 text-center h-100 stats-card-clickable" 
                     @click="navigateToCompletedEvaluations()" 
                     style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); border-radius: 10px; box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;" 
                     data-bs-toggle="tooltip" 
                     data-bs-placement="top" 
                     title="Click para ver evaluaciones completadas">
                    <div class="card-body p-2 p-md-3">
                        <div style="width: clamp(36px, 8vw, 48px); height: clamp(36px, 8vw, 48px); background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            <i class="fas fa-clipboard-check" style="font-size: clamp(18px, 4vw, 24px); color: #10b981;"></i>
                        </div>
                        <h3 class="text-white mb-1" x-text="stats.completedEvaluations" style="font-weight: 700; font-size: clamp(24px, 6vw, 32px); line-height: 1.2;">0</h3>
                        <p class="text-white mb-0" style="font-size: clamp(12px, 3vw, 14px); opacity: 0.95; font-weight: 500;">Evaluaciones Completadas</p>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-3 stats-card-mobile">
                <div class="card border-0 text-center h-100" style="background: linear-gradient(135deg, #3B82F6 0%, #2563EB 100%); border-radius: 10px; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3); transition: transform 0.2s, box-shadow 0.2s;">
                    <div class="card-body p-2 p-md-3">
                        <div style="width: clamp(36px, 8vw, 48px); height: clamp(36px, 8vw, 48px); background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            <i class="fas fa-chart-line" style="font-size: clamp(18px, 4vw, 24px); color: #3B82F6;"></i>
                        </div>
                        <h3 class="text-white mb-1" x-text="stats.latestScore || '0'" style="font-weight: 700; font-size: clamp(24px, 6vw, 32px); line-height: 1.2;">0</h3>
                        <p class="text-white mb-0" style="font-size: clamp(12px, 3vw, 14px); opacity: 0.95; font-weight: 500;">Última Puntuación</p>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-3 stats-card-mobile">
                <div class="card border-0 text-center h-100 stats-card-clickable" 
                     @click="navigateToTasks()" 
                     style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); border-radius: 10px; box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;" 
                     data-bs-toggle="tooltip" 
                     data-bs-placement="top" 
                     title="Click para ver tareas pendientes">
                    <div class="card-body p-2 p-md-3">
                        <div style="width: clamp(36px, 8vw, 48px); height: clamp(36px, 8vw, 48px); background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            <i class="fas fa-tasks" style="font-size: clamp(18px, 4vw, 24px); color: #f59e0b;"></i>
                        </div>
                        <h3 class="text-white mb-1" x-text="stats.activeTasks" style="font-weight: 700; font-size: clamp(24px, 6vw, 32px); line-height: 1.2;">0</h3>
                        <p class="text-white mb-0" style="font-size: clamp(12px, 3vw, 14px); opacity: 0.95; font-weight: 500;">Tareas Pendientes</p>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-3 stats-card-mobile">
                <div class="card border-0 text-center h-100 stats-card-clickable" 
                     @click="navigateToOverdueTasks()" 
                     style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); border-radius: 10px; box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3); transition: transform 0.2s, box-shadow 0.2s; cursor: pointer;" 
                     data-bs-toggle="tooltip" 
                     data-bs-placement="top" 
                     title="Click para ver tareas vencidas">
                    <div class="card-body p-2 p-md-3">
                        <div style="width: clamp(36px, 8vw, 48px); height: clamp(36px, 8vw, 48px); background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; margin: 0 auto;">
                            <i class="fas fa-exclamation-triangle" style="font-size: clamp(18px, 4vw, 24px); color: #ef4444;"></i>
                        </div>
                        <h3 class="text-white mb-1" x-text="stats.overdueTasks" style="font-weight: 700; font-size: clamp(24px, 6vw, 32px); line-height: 1.2;">0</h3>
                        <p class="text-white mb-0" style="font-size: clamp(12px, 3vw, 14px); opacity: 0.95; font-weight: 500;">Tareas Vencidas</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row" style="align-items: flex-start;">
            <!-- Sidebar Navigation - Panel de Control -->
            <div class="col-md-3">
                <div class="card sidebar" style="margin-bottom: 0;">
                    <div class="card-header">
                        <h5>
                            <i class="fas fa-tachometer-alt"></i>
                            Panel de Control
                        </h5>
                        <p class="mb-0 mt-2" style="color: #111827; font-size: 0.875rem;">
                            Navega por tus secciones
                        </p>
                    </div>
                    <div class="card-body">
                        <div class="list-group list-group-flush">
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action" 
                               :class="{ 'active': activeTab === 'evaluations' }"
                               @click.prevent="showTab('evaluations')" data-tab="evaluations">
                                <i class="fas fa-clipboard-list"></i>
                                <span>Mis Evaluaciones Disponibles</span>
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action" 
                               :class="{ 'active': activeTab === 'completed-evaluations' }"
                               @click.prevent="showTab('completed-evaluations')" data-tab="completed-evaluations">
                                <i class="fas fa-check-circle"></i>
                                <span>Mis Evaluaciones Completadas</span>
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action" 
                               :class="{ 'active': activeTab === 'pending-evaluations' }"
                               @click.prevent="showTab('pending-evaluations')" data-tab="pending-evaluations">
                                <i class="fas fa-clock"></i>
                                <span>Mis Evaluaciones Pendientes</span>
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action" 
                               :class="{ 'active': activeTab === 'assessment' }"
                               id="assessment-sidebar-item" 
                               x-show="isAssessmentActive"
                               @click.prevent="showTab('assessment')" data-tab="assessment">
                                <i class="fas fa-play-circle"></i>
                                <span>Evaluación Activa</span>
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action" 
                               :class="{ 'active': activeTab === 'tasks' }"
                               @click.prevent="showTab('tasks')" data-tab="tasks">
                                <i class="fas fa-tasks"></i>
                                <span>Mis Acciones y Metas</span>
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action" 
                               :class="{ 'active': activeTab === 'content' }"
                               @click.prevent="showTab('content')" data-tab="content">
                                <i class="fas fa-folder-open"></i>
                                <span>Mi Contenido</span>
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action" 
                               :class="{ 'active': activeTab === 'progress' }"
                               @click.prevent="showTab('progress')" data-tab="progress">
                                <i class="fas fa-chart-line"></i>
                                <span>Mi Progreso</span>
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action" 
                               :class="{ 'active': activeTab === 'development-plan' }"
                               @click.prevent="showTab('development-plan')" data-tab="development-plan">
                                <i class="fas fa-rocket"></i>
                                <span>Mi Plan de Desarrollo</span>
                            </a>
                            <a href="javascript:void(0)" class="list-group-item list-group-item-action" 
                               :class="{ 'active': activeTab === 'schedule-coach' }"
                               @click.prevent="showTab('schedule-coach')" data-tab="schedule-coach">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Agendar Coach</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="col-md-9" style="padding-left: 0.75rem; padding-right: 0.75rem;">
                <!-- Tab Content -->
                <div class="tab-content" id="mainTabContent" style="margin-top: 0;">
                <!-- Evaluations Tab -->
                <div class="tab-pane fade show active" id="evaluations" role="tabpanel">
                    <div class="row" style="margin-top: 0;">
                        <!-- Available Evaluations -->
                        <div class="col-12">
                            <div class="card" style="background: #ffffff; margin-bottom: 2rem; margin-top: 0; border-radius: 16px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); border: none;">
                                <!-- Header -->
                                <div style="padding: 2rem 2.5rem 1.5rem; border-bottom: 1px solid #f3f4f6;">
                                    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                                        <div>
                                            <h5 class="mb-1 d-flex align-items-center gap-2" style="color: #111827; font-weight: 600; font-size: 1.375rem; letter-spacing: -0.3px;">
                                                <i class="fas fa-clipboard-list"></i>
                                                Mis Evaluaciones Disponibles
                                            </h5>
                                            <p class="mb-0" style="color: #9ca3af; font-size: 0.875rem; font-weight: 400;">
                                                Comienza las evaluaciones asignadas por tu coach
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div style="padding: 1.5rem 2.5rem 2.5rem;">
                                    <!-- Filtros y acciones -->
                                    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-sm" onclick="expandAllCategories('availableEvaluations')" 
                                                style="background: #f9fafb; border: 1px solid #e5e7eb; color: #6b7280; border-radius: 8px; font-weight: 500; padding: 0.5rem 1rem;">
                                                <i class="fas fa-chevron-down me-1"></i>
                                                <span class="d-none d-sm-inline">Expandir todo</span>
                                            </button>
                                            <button class="btn btn-sm" onclick="collapseAllCategories('availableEvaluations')" 
                                                style="background: #f9fafb; border: 1px solid #e5e7eb; color: #6b7280; border-radius: 8px; font-weight: 500; padding: 0.5rem 1rem;">
                                                <i class="fas fa-chevron-up me-1"></i>
                                                <span class="d-none d-sm-inline">Contraer todo</span>
                                            </button>
                                        </div>
                                        <button class="btn btn-sm" onclick="location.reload()" title="Actualizar evaluaciones" 
                                            style="background: #f9fafb; border: 1px solid #e5e7eb; color: #6b7280; border-radius: 8px; font-weight: 500; padding: 0.5rem 1rem;">
                                            <i class="fas fa-sync-alt me-1"></i>
                                            <span class="d-none d-sm-inline">Actualizar</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Loading state -->
                                    <div id="availableEvaluations">
                                        <div class="text-center py-5">
                                            <div class="spinner-border text-primary mb-3" role="status" style="width: 2rem; height: 2rem;">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="text-muted" style="font-size: 0.875rem;">Cargando evaluaciones disponibles...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Completed Evaluations Tab -->
                <div class="tab-pane fade" id="completed-evaluations" role="tabpanel">
                    <div class="row" style="margin-top: 0;">
                        <div class="col-12">
                            <div class="card" style="background: #ffffff; margin-bottom: 2rem; margin-top: 0; border-radius: 16px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); border: none; overflow: visible;">
                                <!-- Header -->
                                <div style="padding: 2rem 2.5rem 1.5rem; border-bottom: 1px solid #f3f4f6;">
                                    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                                        <div>
                                            <h5 class="mb-1 d-flex align-items-center gap-2" style="color: #111827; font-weight: 600; font-size: 1.375rem; letter-spacing: -0.3px;">
                                                <i class="fas fa-check-circle"></i>
                                                Mis Evaluaciones Completadas
                                            </h5>
                                            <p class="mb-0" style="color: #9ca3af; font-size: 0.875rem; font-weight: 400;">
                                                Historial de evaluaciones finalizadas
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div style="padding: 1.5rem 2.5rem 2.5rem;">
                                    <!-- Filtros y acciones -->
                                    <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
                                        <div class="d-flex gap-2">
                                            <button class="btn btn-sm" onclick="expandAllCategories('completedEvaluationsSection')" 
                                                style="background: #f9fafb; border: 1px solid #e5e7eb; color: #6b7280; border-radius: 8px; font-weight: 500; padding: 0.5rem 1rem;">
                                                <i class="fas fa-chevron-down me-1"></i>
                                                <span class="d-none d-sm-inline">Expandir todo</span>
                                            </button>
                                            <button class="btn btn-sm" onclick="collapseAllCategories('completedEvaluationsSection')" 
                                                style="background: #f9fafb; border: 1px solid #e5e7eb; color: #6b7280; border-radius: 8px; font-weight: 500; padding: 0.5rem 1rem;">
                                                <i class="fas fa-chevron-up me-1"></i>
                                                <span class="d-none d-sm-inline">Contraer todo</span>
                                            </button>
                                        </div>
                                        <button class="btn btn-sm" onclick="location.reload()" title="Actualizar evaluaciones" 
                                            style="background: #f9fafb; border: 1px solid #e5e7eb; color: #6b7280; border-radius: 8px; font-weight: 500; padding: 0.5rem 1rem;">
                                            <i class="fas fa-sync-alt me-1"></i>
                                            <span class="d-none d-sm-inline">Actualizar</span>
                                        </button>
                                    </div>
                                    
                                    <!-- Loading state -->
                                    <div id="completedEvaluationsSection">
                                        <div class="text-center py-5">
                                            <div class="spinner-border text-primary mb-3" role="status" style="width: 2rem; height: 2rem;">
                                                <span class="visually-hidden">Cargando...</span>
                                            </div>
                                            <p class="text-muted" style="font-size: 0.875rem;">Cargando evaluaciones completadas...</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pending Evaluations Tab -->
                <div class="tab-pane fade" id="pending-evaluations" role="tabpanel">
                    <div class="row" style="margin-top: 0;">
                        <div class="col-12">
                            <div class="card" style="background: #ffffff; margin-bottom: 2rem; margin-top: 0; border-radius: 16px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); border: none; overflow: visible;">
                                <!-- Header -->
                                <div style="padding: 2rem 2.5rem 1.5rem; border-bottom: 1px solid #f3f4f6;">
                                    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                                        <div>
                                            <h5 class="mb-1 d-flex align-items-center gap-2" style="color: #111827; font-weight: 600; font-size: 1.375rem; letter-spacing: -0.3px;">
                                                <i class="fas fa-clock"></i>
                                                Mis Evaluaciones Pendientes
                                            </h5>
                                            <p class="mb-0" style="color: #9ca3af; font-size: 0.875rem; font-weight: 400;">
                                                Evaluaciones asignadas que aún no has completado
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div style="padding: 1.5rem 2.5rem 2.5rem;">
                                    <div id="pendingEvaluationsSection" class="text-center py-5">
                                        <i class="fas fa-check-circle text-success mb-3" style="font-size: 3rem;"></i>
                                        <h5 class="text-muted mb-2">Sin Novedades Por Acá</h5>
                                        <p class="text-muted small">No tienes evaluaciones pendientes en este momento</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Assessment Tab (Hidden by default) -->
                <div class="tab-pane fade" id="assessment" role="tabpanel">
                    <div class="dashboard-card">
                        <div class="card-header">
                            <h3>
                                <i class="fas fa-clipboard-check me-2"></i>
                                Evaluación de Asertividad
                            </h3>
                            <div class="progress mt-3">
                                <div class="progress-bar" role="progressbar" id="assessmentProgress" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="card-body" id="assessmentContainer">
                            <div id="questionContainer">
                                <!-- Questions will be loaded dynamically -->
                            </div>
                        </div>
                    </div>

                    <!-- Assessment Results Modal -->
                    <div class="modal fade" id="assessmentResultsModal" tabindex="-1" aria-labelledby="assessmentResultsModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-xl">
                            <div class="modal-content">
                                <div class="modal-header modal-header-dark">
                                    <h5 class="modal-title" id="assessmentResultsModalLabel">
                                        <i class="fas fa-check-circle me-2"></i>
                                        ¡Evaluación Completada!
                                    </h5>
                                    <div class="d-flex align-items-center justify-content-end gap-2">
                                        <button type="button" class="btn btn-outline-light btn-sm" onclick="printEvaluationReport()" title="Imprimir Reporte">
                                            <i class="fas fa-print me-1"></i>
                                            Imprimir
                                        </button>
                                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                </div>
                                <div class="modal-body" id="assessmentResultsContent">
                                    <div class="assessment-completion-section text-center mb-4">
                                        <div class="assessment-score-display" id="assessmentScore">0%</div>
                                        <h3 class="assessment-level-display" id="assessmentLevel">Nivel de Asertividad</h3>
                                    </div>
                                    <div id="assessmentInterpretation">
                                        <!-- Results interpretation will be loaded here -->
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" onclick="finishAssessment()">
                                        <i class="fas fa-check me-2"></i>
                                        Finalizar y Volver
                                    </button>
                                    <button type="button" class="btn btn-primary-custom" onclick="viewDetailedResults()">
                                        <i class="fas fa-chart-radar me-2"></i>
                                        Ver Análisis Completo
                                    </button>
                                    <button type="button" class="btn btn-progress" onclick="printEvaluationReport()">
                                        <i class="fas fa-print me-2"></i>
                                        Imprimir Reporte
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tasks Tab -->
                <div class="tab-pane fade" id="tasks" role="tabpanel">
                    <div class="card" style="background: #ffffff; margin-bottom: 1rem; margin-top: 0; border-radius: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); border: none; overflow: hidden;">
                        <!-- Header Compacto Mejorado -->
                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 1rem 1.25rem; border-bottom: none;">
                            <div class="d-flex align-items-center justify-content-between gap-2">
                                <div class="d-flex align-items-center gap-2">
                                    <i class="fas fa-bullseye" style="font-size: 1.25rem; color: #000000;"></i>
                                    <div>
                                        <h5 class="mb-0" style="color: #000000; font-weight: 600; font-size: 1.1rem; letter-spacing: -0.2px;">
                                            Mis Acciones y Metas
                                        </h5>
                                        <p class="mb-0" style="color: #000000; font-size: 0.75rem; font-weight: 400; opacity: 0.8;">
                                            Asignadas por tu coach
                                        </p>
                                    </div>
                                </div>
                                <!-- Contador de tareas -->
                                <div id="tasksCounter" style="background: rgba(255,255,255,0.2); padding: 0.4rem 0.75rem; border-radius: 20px; display: none;">
                                    <span style="color: #000000; font-size: 0.85rem; font-weight: 600;">
                                        <i class="fas fa-check-circle" style="font-size: 0.8rem;"></i>
                                        <span id="completedTasks">0</span>/<span id="totalTasks">0</span>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Body Compacto -->
                        <div style="padding: 0.75rem;">
                            <div id="tasksContainer">
                                <div class="text-center py-4">
                                    <div class="spinner-border spinner-border-sm text-primary" role="status">
                                        <span class="visually-hidden">Cargando...</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Tab -->
                <div class="tab-pane fade" id="content" role="tabpanel">
                    <div class="card" style="background: #ffffff; margin-bottom: 2rem; margin-top: 0; border-radius: 16px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); border: none; overflow: visible;">
                        <!-- Header Compacto -->
                        <div style="padding: 1.25rem 1.75rem; border-bottom: 1px solid #e5e7eb; background: #ffffff;">
                            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                                <div>
                                    <h5 class="mb-0 d-flex align-items-center gap-2" style="color: #111827; font-weight: 700; font-size: 1.25rem; letter-spacing: -0.3px;">
                                        <i class="fas fa-folder-open" style="opacity: 1; color: #3b82f6;"></i>
                                        Mi Contenido
                                    </h5>
                                    <p class="mb-0 mt-1" style="color: #6b7280; font-size: 0.875rem; font-weight: 500;">
                                        Videos, documentos y recursos compartidos
                                    </p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Body Compacto -->
                        <div style="padding: 1.25rem 1.75rem 1.75rem; background: #ffffff;">
                            <!-- Pestañas Modernas Compactas -->
                            <ul class="nav nav-tabs mb-3" id="contentTabs" role="tablist" style="border-bottom: 2px solid #e5e7eb; gap: 0.75rem; background: #f9fafb; padding: 0.5rem; border-radius: 10px;">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" 
                                        :class="{ 'active': contentTab === 'videos' }"
                                        @click="switchContentTab('videos')"
                                        id="videos-tab" type="button" role="tab"
                                        style="padding: 0.625rem 1.25rem; font-size: 0.875rem; font-weight: 600; border: 2px solid #e5e7eb; border-radius: 8px; background: #ffffff; color: #374151; transition: all 0.2s ease;">
                                        <i class="fas fa-play-circle me-1" style="color: #ef4444;"></i>
                                        <span class="d-none d-sm-inline">Videos</span>
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" 
                                        :class="{ 'active': contentTab === 'documents' }"
                                        @click="switchContentTab('documents')"
                                        id="documents-tab" type="button" role="tab"
                                        style="padding: 0.625rem 1.25rem; font-size: 0.875rem; font-weight: 600; border: 2px solid #e5e7eb; border-radius: 8px; background: #ffffff; color: #374151; transition: all 0.2s ease;">
                                        <i class="fas fa-file-alt me-1" style="color: #3b82f6;"></i>
                                        <span class="d-none d-sm-inline">Documentos</span>
                                    </button>
                                </li>
                            </ul>

                            <!-- Contenido de las pestañas -->
                            <div class="tab-content" id="contentTabContent">
                                <!-- Pestaña: Videos -->
                                <div class="tab-pane fade" 
                                    :class="{ 'show active': contentTab === 'videos' }"
                                    id="videos-pane" role="tabpanel">
                                    <div id="contentContainer">
                                        <div class="loading-spinner" x-show="isLoadingVideos">
                                            <div class="spinner-border" style="width: 2rem; height: 2rem; color: #667eea;" role="status">
                                                <span class="visually-hidden">Cargando videos...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Pestaña: Documentos -->
                                <div class="tab-pane fade" 
                                    :class="{ 'show active': contentTab === 'documents' }"
                                    id="documents-pane" role="tabpanel">
                                    <!-- Filtros Compactos -->
                                    <div class="row g-2 mb-3" 
                                        x-show="!isLoadingDocuments && documentsData.length > 0"
                                        id="documentFilters">
                                        <div class="col-lg-4 col-md-6">
                                            <select class="form-select form-select-sm" 
                                                x-model="documentFilters.category"
                                                @change="filterDocuments()"
                                                id="categoryFilter"
                                                style="border-radius: 8px; border: 2px solid #d1d5db; font-size: 0.8125rem; padding: 0.5rem 0.75rem; background: #ffffff; font-weight: 500; color: #374151;">
                                                <option value="">📁 Todas las categorías</option>
                                                <option value="ejercicios">💪 Ejercicios y Actividades</option>
                                                <option value="teoria">📚 Material Teórico</option>
                                                <option value="evaluacion">📊 Evaluaciones</option>
                                                <option value="recurso">🔧 Recursos de Apoyo</option>
                                                <option value="tarea">✍️ Tareas</option>
                                                <option value="referencias">📖 Referencias</option>
                                            </select>
                                        </div>
                                        <div class="col-lg-3 col-md-6">
                                            <select class="form-select form-select-sm" 
                                                x-model="documentFilters.priority"
                                                @change="filterDocuments()"
                                                id="priorityFilter"
                                                style="border-radius: 8px; border: 2px solid #d1d5db; font-size: 0.8125rem; padding: 0.5rem 0.75rem; background: #ffffff; font-weight: 500; color: #374151;">
                                                <option value="">🎯 Todas las prioridades</option>
                                                <option value="urgente">🔴 Urgente</option>
                                                <option value="alta">🟠 Alta</option>
                                                <option value="normal">🟢 Normal</option>
                                            </select>
                                        </div>
                                        <div class="col-lg-5 col-md-12">
                                            <div class="input-group input-group-sm">
                                                <span class="input-group-text" style="background: #ffffff; border: 2px solid #d1d5db; border-right: none; border-radius: 8px 0 0 8px;">
                                                    <i class="fas fa-search" style="color: #3b82f6; font-size: 0.875rem;"></i>
                                                </span>
                                                <input type="text" class="form-control" 
                                                    x-model="documentFilters.search"
                                                    @input="filterDocuments()"
                                                    id="searchDocuments" 
                                                    placeholder="Buscar documentos..."
                                                    style="border: 2px solid #d1d5db; border-left: none; border-radius: 0 8px 8px 0; font-size: 0.8125rem; padding: 0.5rem 0.75rem; background: #ffffff; font-weight: 500; color: #374151;">
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div id="documentsContainer">
                                        <div class="loading-spinner" x-show="isLoadingDocuments" style="text-align: center; padding: 2rem 0;">
                                            <div class="spinner-border" style="width: 2rem; height: 2rem; color: #667eea;" role="status">
                                                <span class="visually-hidden">Cargando documentos...</span>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Grid de documentos Compacto -->
                                    <div id="documentsGrid" class="row g-3">
                                        <!-- Los documentos se cargarán aquí dinámicamente -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Progress Tab -->
                <div class="tab-pane fade" id="progress" role="tabpanel">
                    
                    <!-- ========================================= -->
                    <!-- 🆕 NUEVA SECCIÓN: Mi Progreso (Alpine.js) -->
                    <!-- ========================================= -->
                    <div class="row mb-4" style="margin-top: 0;">
                        <div class="col-12">
                            <div class="card" style="background: #ffffff; margin-bottom: 2rem; margin-top: 0; border-radius: 16px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); border: none; overflow: visible;">
                                <!-- Header -->
                                <div style="padding: 2rem 2.5rem 1.5rem; border-bottom: 1px solid #f3f4f6;">
                                    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                                        <div>
                                            <h5 class="mb-1 d-flex align-items-center gap-2" style="color: #111827; font-weight: 600; font-size: 1.375rem; letter-spacing: -0.3px;">
                                                <i class="fas fa-chart-line"></i>
                                                Mi Progreso en Evaluaciones
                                            </h5>
                                            <p class="mb-0" style="color: #9ca3af; font-size: 0.875rem; font-weight: 400;">
                                                Evolución de tu desempeño a lo largo del tiempo
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div style="padding: 1.5rem 2.5rem 2.5rem;">
                                    <!-- Alpine Loading Spinner -->
                                    <div class="text-center py-5" x-show="isLoadingProgress" x-cloak>
                                        <div class="spinner-border text-primary" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                        <p class="text-muted small mt-3 mb-0">Cargando datos de progreso...</p>
                                    </div>
                                    
                                    <!-- Alpine Empty State -->
                                    <div class="text-center py-5" 
                                        x-show="!isLoadingProgress && (!allAssessmentHistory || Object.keys(allAssessmentHistory || {}).length === 0)"
                                        x-cloak>
                                        <i class="fas fa-chart-line text-muted mb-3" style="font-size: 3rem;"></i>
                                        <h5 class="text-muted">Sin evaluaciones registradas</h5>
                                        <p class="text-muted small">Completa evaluaciones para ver tu progreso aquí</p>
                                    </div>
                                    
                                    <!-- Alpine Chart Container -->
                                    <div x-show="!isLoadingProgress && allAssessmentHistory && Object.keys(allAssessmentHistory || {}).length > 0"
                                        x-cloak
                                        style="position: relative; height: 450px;">
                                        <canvas id="alpineProgressChart"></canvas>
                                    </div>
                                    
                                    <!-- Alpine Statistics -->
                                    <div class="row mt-4 g-3" 
                                        x-show="!isLoadingProgress && allAssessmentHistory && Object.keys(allAssessmentHistory || {}).length > 0"
                                        x-cloak>
                                        <div class="col-md-4">
                                            <div class="text-center p-4 rounded-3" style="background: linear-gradient(135deg, #667eea22 0%, #764ba222 100%); border: 1px solid #667eea44;">
                                                <i class="fas fa-chart-bar text-primary mb-2" style="font-size: 1.5rem;"></i>
                                                <div class="text-muted small mb-2 fw-semibold">Total Evaluaciones</div>
                                                <div class="fs-3 fw-bold text-primary" x-text="progressStatistics.totalEvaluations || 0"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center p-4 rounded-3" style="background: linear-gradient(135deg, #10b98122 0%, #059b6922 100%); border: 1px solid #10b98144;">
                                                <i class="fas fa-chart-line text-success mb-2" style="font-size: 1.5rem;"></i>
                                                <div class="text-muted small mb-2 fw-semibold">Promedio General</div>
                                                <div class="fs-3 fw-bold text-success" x-text="`${(progressStatistics.averageScore || 0).toFixed(1)}%`"></div>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="text-center p-4 rounded-3" style="background: linear-gradient(135deg, #f59e0b22 0%, #d9730022 100%); border: 1px solid #f59e0b44;">
                                                <i class="fas fa-trophy text-warning mb-2" style="font-size: 1.5rem;"></i>
                                                <div class="text-muted small mb-2 fw-semibold">Mejor Score</div>
                                                <div class="fs-3 fw-bold text-warning" x-text="`${(progressStatistics.bestScore || 0).toFixed(1)}%`"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <!-- Development Plan Tab -->
                <div class="tab-pane fade" id="development-plan" role="tabpanel">
                    <div class="row" style="margin-top: 0;">
                        <div class="col-12">
                            <div class="card" style="background: #ffffff; margin-bottom: 1rem; margin-top: 0; border-radius: 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); border: none; overflow: visible;">
                                <!-- Header Compacto -->
                                <div style="padding: 1rem 1.25rem 0.75rem; border-bottom: 1px solid #f3f4f6;">
                                    <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                                        <div>
                                            <h5 class="mb-0 d-flex align-items-center gap-2" style="color: #111827; font-weight: 600; font-size: 1.05rem; letter-spacing: -0.3px;">
                                                <i class="fas fa-rocket" style="font-size: 0.95rem; color: #000000;"></i>
                                                <span class="d-none d-md-inline">Mi Plan de Desarrollo</span>
                                                <span class="d-inline d-md-none">Desarrollo</span>
                                            </h5>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Body Compacto -->
                                <div style="padding: 0.75rem 1rem;">
                                    <!-- Loading -->
                                    <div id="devPlanLoading" 
                                        x-show="isLoadingPlans"
                                        class="text-center py-3">
                                        <div class="spinner-border spinner-border-sm text-primary" role="status">
                                            <span class="visually-hidden">Cargando...</span>
                                        </div>
                                    </div>
                                    
                                    <!-- No Plan Message -->
                                    <div id="devPlanEmpty" 
                                        x-show="!isLoadingPlans && developmentPlans.length === 0">
                                        <div class="text-center py-3">
                                            <i class="fas fa-rocket" style="font-size: 2rem; color: #e2e8f0; margin-bottom: 0.75rem;"></i>
                                            <h6 style="color: #64748b; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.95rem;">Aún no tienes un Plan de Desarrollo</h6>
                                            <p style="color: #94a3b8; margin: 0; font-size: 0.8rem;">Tu coach creará un plan personalizado para ti.</p>
                                        </div>
                                    </div>
                                    
                                    <!-- Development Plans Grid -->
                                    <div id="devPlanContent" 
                                        x-show="!isLoadingPlans && developmentPlans.length > 0">
                                        <!-- Plans will be rendered here in grid format -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Schedule Coach Tab -->
                <div class="tab-pane fade" id="schedule-coach" role="tabpanel">
                    <div class="row" style="margin-top: 0;">
                        <div class="col-12">
                            <div class="card" style="background: #ffffff; margin-bottom: 2rem; margin-top: 0; border-radius: 16px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); border: none; overflow: visible;">
                                <!-- Header -->
                                <div style="padding: 2rem 2.5rem 1.5rem; border-bottom: 1px solid #f3f4f6;">
                                    <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                                        <div>
                                            <h5 class="mb-1 d-flex align-items-center gap-2" style="color: #111827; font-weight: 600; font-size: 1.375rem; letter-spacing: -0.3px;">
                                                <i class="fas fa-calendar-alt"></i>
                                                Agendar Coach
                                            </h5>
                                            <p class="mb-0" style="color: #9ca3af; font-size: 0.875rem; font-weight: 400;">
                                                Agenda una sesión con tu coach
                                            </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Body -->
                                <div style="padding: 1.5rem 2.5rem 2.5rem;">
                                    <!-- Pestañas para organizar el contenido -->
                                    <ul class="nav nav-tabs mb-4" id="scheduleCoachTabs" role="tablist">
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link force-white-text" 
                                                :class="{ 'active': scheduleTab === 'request' }"
                                                @click="switchScheduleTab('request')"
                                                id="schedule-request-tab" type="button" role="tab"
                                                style="color: #ffffff !important; background-color: #007bff !important; border-color: #007bff !important;">
                                                <i class="fas fa-plus me-1"></i>Solicitar Sesión
                                            </button>
                                        </li>
                                        <li class="nav-item" role="presentation">
                                            <button class="nav-link position-relative force-white-text" 
                                                :class="{ 'active': scheduleTab === 'sessions' }"
                                                @click="switchScheduleTab('sessions')"
                                                id="my-sessions-tab" type="button" role="tab">
                                                <i class="fas fa-calendar me-1"></i>Mis Sesiones
                                                <span class="badge bg-info rounded-pill ms-1" 
                                                    x-show="mySessions.length > 0"
                                                    x-text="mySessions.length"
                                                    id="mySessionsCount"></span>
                                            </button>
                                        </li>
                                    </ul>

                                    <!-- Contenido de las pestañas -->
                                    <div class="tab-content" id="scheduleCoachTabContent">
                                        
                                        <!-- Pestaña: Solicitar Sesión -->
                                        <div class="tab-pane fade" 
                                            :class="{ 'show active': scheduleTab === 'request' }"
                                            id="schedule-request-pane" role="tabpanel" 
                                            aria-labelledby="schedule-request-tab" tabindex="0">
                                            <div class="row">
                                                <div class="col-lg-8">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h6 class="mb-0">
                                                                <i class="fas fa-calendar-plus me-2"></i>
                                                                Nueva Solicitud de Sesión
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <form id="sessionRequestForm">
                                                                <div class="row g-3">
                                                                    <div class="col-12">
                                                                        <label for="sessionDate" class="form-label">Fecha Preferida</label>
                                                                        <input type="date" class="form-control" id="sessionDate" required>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <label for="sessionStartTime" class="form-label">Hora de Inicio</label>
                                                                        <select class="form-select time-select-24h" id="sessionStartTime" required>
                                                                            <option value="">Seleccionar hora</option>
                                                                            <option value="08:00">08:00</option>
                                                                            <option value="08:30">08:30</option>
                                                                            <option value="09:00">09:00</option>
                                                                            <option value="09:30">09:30</option>
                                                                            <option value="10:00" selected>10:00</option>
                                                                            <option value="10:30">10:30</option>
                                                                            <option value="11:00">11:00</option>
                                                                            <option value="11:30">11:30</option>
                                                                            <option value="12:00">12:00</option>
                                                                            <option value="12:30">12:30</option>
                                                                            <option value="13:00">13:00</option>
                                                                            <option value="13:30">13:30</option>
                                                                            <option value="14:00">14:00</option>
                                                                            <option value="14:30">14:30</option>
                                                                            <option value="15:00">15:00</option>
                                                                            <option value="15:30">15:30</option>
                                                                            <option value="16:00">16:00</option>
                                                                            <option value="16:30">16:30</option>
                                                                            <option value="17:00">17:00</option>
                                                                            <option value="17:30">17:30</option>
                                                                            <option value="18:00">18:00</option>
                                                                            <option value="18:30">18:30</option>
                                                                            <option value="19:00">19:00</option>
                                                                            <option value="19:30">19:30</option>
                                                                            <option value="20:00">20:00</option>
                                                                        </select>
                                                                        <div class="form-text">Horario disponible: 08:00 - 20:00</div>
                                                                    </div>
                                                                    <div class="col-md-6">
                                                                        <label for="sessionEndTime" class="form-label">Hora de Fin</label>
                                                                        <select class="form-select time-select-24h" id="sessionEndTime" required>
                                                                            <option value="">Seleccionar hora</option>
                                                                            <option value="08:30">08:30</option>
                                                                            <option value="09:00">09:00</option>
                                                                            <option value="09:30">09:30</option>
                                                                            <option value="10:00">10:00</option>
                                                                            <option value="10:30">10:30</option>
                                                                            <option value="11:00" selected>11:00</option>
                                                                            <option value="11:30">11:30</option>
                                                                            <option value="12:00">12:00</option>
                                                                            <option value="12:30">12:30</option>
                                                                            <option value="13:00">13:00</option>
                                                                            <option value="13:30">13:30</option>
                                                                            <option value="14:00">14:00</option>
                                                                            <option value="14:30">14:30</option>
                                                                            <option value="15:00">15:00</option>
                                                                            <option value="15:30">15:30</option>
                                                                            <option value="16:00">16:00</option>
                                                                            <option value="16:30">16:30</option>
                                                                            <option value="17:00">17:00</option>
                                                                            <option value="17:30">17:30</option>
                                                                            <option value="18:00">18:00</option>
                                                                            <option value="18:30">18:30</option>
                                                                            <option value="19:00">19:00</option>
                                                                            <option value="19:30">19:30</option>
                                                                            <option value="20:00">20:00</option>
                                                                            <option value="20:30">20:30</option>
                                                                        </select>
                                                                        <div class="form-text">Horario disponible: 08:30 - 20:30</div>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <label for="sessionTitle" class="form-label">Título de la Sesión</label>
                                                                        <input type="text" class="form-control" id="sessionTitle" 
                                                                            placeholder="Ej: Sesión de desarrollo personal" value="Sesión de Coaching">
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <label for="sessionDescription" class="form-label">Descripción (opcional)</label>
                                                                        <textarea class="form-control" id="sessionDescription" rows="3" 
                                                                            placeholder="Describe brevemente el tema que te gustaría trabajar..."></textarea>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <label for="sessionLocation" class="form-label">Modalidad Preferida</label>
                                                                        <select class="form-select" id="sessionLocation">
                                                                            <option value="Virtual - Zoom">Virtual - Zoom</option>
                                                                            <option value="Virtual - Teams">Virtual - Teams</option>
                                                                            <option value="Virtual - Meet">Virtual - Google Meet</option>
                                                                            <option value="Presencial">Presencial</option>
                                                                            <option value="Por definir">Por definir</option>
                                                                        </select>
                                                                    </div>
                                                                    <div class="col-12">
                                                                        <button type="submit" class="btn btn-primary">
                                                                            <i class="fas fa-paper-plane me-2"></i>Enviar Solicitud
                                                                        </button>
                                                                        <button type="button" class="btn btn-outline-secondary ms-2" onclick="resetSessionForm()">
                                                                            <i class="fas fa-undo me-2"></i>Limpiar
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="col-lg-4">
                                                    <div class="card">
                                                        <div class="card-header">
                                                            <h6 class="mb-0">
                                                                <i class="fas fa-info-circle me-2"></i>
                                                                Disponibilidad del Coach
                                                            </h6>
                                                        </div>
                                                        <div class="card-body" id="coachAvailabilityInfo">
                                                            <div class="text-center py-3">
                                                                <div class="spinner-border spinner-border-sm" role="status">
                                                                    <span class="visually-hidden">Cargando disponibilidad...</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div class="card mt-3">
                                                        <div class="card-header">
                                                            <h6 class="mb-0">
                                                                <i class="fas fa-lightbulb me-2"></i>
                                                                Tips para Agendar
                                                            </h6>
                                                        </div>
                                                        <div class="card-body">
                                                            <ul class="list-unstyled mb-0">
                                                                <li class="mb-2">
                                                                    <i class="fas fa-check text-success me-2"></i>
                                                                    Planifica con al menos 24 horas de anticipación
                                                                </li>
                                                                <li class="mb-2">
                                                                    <i class="fas fa-check text-success me-2"></i>
                                                                    Describe el tema que quieres trabajar
                                                                </li>
                                                                <li class="mb-2">
                                                                    <i class="fas fa-check text-success me-2"></i>
                                                                    Verifica tu disponibilidad antes de solicitar
                                                                </li>
                                                                <li class="mb-0">
                                                                    <i class="fas fa-check text-success me-2"></i>
                                                                    Tu coach responderá en máximo 24 horas
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Pestaña: Mis Sesiones -->
                                        <div class="tab-pane fade" 
                                            :class="{ 'show active': scheduleTab === 'sessions' }"
                                            id="my-sessions-pane" role="tabpanel" 
                                            aria-labelledby="my-sessions-tab" tabindex="0">
                                            <div class="row">
                                                <div class="col-12">
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <h6 class="mb-0">
                                                            <i class="fas fa-calendar me-2"></i>
                                                            Mis Sesiones Programadas
                                                        </h6>
                                                        <div>
                                                            <button class="btn btn-primary btn-sm me-2" 
                                                                @click="switchScheduleTab('request')">
                                                                <i class="fas fa-plus me-1"></i>Solicitar Sesión
                                                            </button>
                                                            <button class="btn btn-outline-primary btn-sm" 
                                                                @click="loadMySessions(true)"
                                                                :disabled="isLoadingSessions">
                                                                <i class="fas fa-sync-alt me-1"></i>Actualizar
                                                            </button>
                                                        </div>
                                                    </div>
                                                    
                                                    <div id="mySessionsList">
                                                        <div class="text-center py-4" x-show="isLoadingSessions">
                                                            <div class="spinner-border text-primary" role="status">
                                                                <span class="visually-hidden">Cargando sesiones...</span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed top-0 end-0 p-3" style="z-index: 1060;">
        <div id="toastNotification" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <i class="fas fa-info-circle text-primary me-2"></i>
                <strong class="me-auto">Notificación</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body">
                <!-- Toast message will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Task Progress Modal -->
    <div class="modal fade" id="taskProgressModal" tabindex="-1" aria-labelledby="taskProgressModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="taskProgressModalLabel">
                        <i class="fas fa-tasks me-2"></i>
                        Actualizar Progreso de Tarea
                    </h5>
                </div>
                <div class="modal-body">
                    <form id="taskProgressForm">
                        <input type="hidden" id="taskId" />
                        
                        <div class="mb-2">
                            <label for="taskStatus" class="form-label">
                                <i class="fas fa-list-check"></i>
                                Estado de la Tarea
                            </label>
                            <select class="form-select" id="taskStatus" required>
                                <option value="pending">⏸️ Pendiente</option>
                                <option value="in_progress">▶️ En Progreso</option>
                                <option value="completed">✅ Completada</option>
                            </select>
                        </div>
                        
                        <div class="mb-2">
                            <label for="taskProgress" class="form-label">
                                <i class="fas fa-percent"></i>
                                Progreso
                            </label>
                            <input type="range" class="form-range" id="taskProgress" min="0" max="100" value="0">
                            <div class="d-flex justify-content-between align-items-center mt-1">
                                <span class="text-muted small">0%</span>
                                <span id="progressValue" class="badge bg-gradient" style="font-size: 0.9375rem; padding: 0.375rem 0.875rem;">0%</span>
                                <span class="text-muted small">100%</span>
                            </div>
                        </div>
                        
                        <div class="mb-0">
                            <label for="taskNotes" class="form-label">
                                <i class="fas fa-sticky-note"></i>
                                Notas (Opcional)
                            </label>
                            <textarea class="form-control" id="taskNotes" rows="1" placeholder="Añade comentarios sobre tu progreso..." style="resize: vertical; min-height: 38px;"></textarea>
                            <small class="text-muted d-block mt-1" style="font-size: 0.75rem;">
                                <i class="fas fa-info-circle me-1"></i>
                                Tu coach verá estos comentarios
                            </small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-task" onclick="saveTaskProgress()">
                        <i class="fas fa-save me-2"></i>
                        Guardar Progreso
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Evaluation Details Modal -->
    <div class="modal" id="evaluationDetailsModal" tabindex="-1" aria-labelledby="evaluationDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header modal-header-dark">
                    <h5 class="modal-title" id="evaluationDetailsModalLabel">
                        <i class="fas fa-chart-radar"></i>
                        <span>Detalles de Evaluación</span>
                    </h5>
                </div>
                <div class="modal-body" id="evaluationDetailsContent">
                    <div class="loading-spinner">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Cargando detalles...</span>
                        </div>
                        <p class="text-muted mt-3 mb-0" style="font-size: 0.875rem;">Cargando información de tu evaluación...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Solicitar Plan de Desarrollo -->
    <div class="modal fade" id="requestDevelopmentPlanModal" tabindex="-1" aria-labelledby="requestDevelopmentPlanModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header modal-header-development">
                    <h5 class="modal-title" id="requestDevelopmentPlanModalLabel">
                        <i class="fas fa-road"></i>
                        <span>Solicitar Plan de Desarrollo</span>
                    </h5>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info mb-4">
                        <i class="fas fa-lightbulb me-2"></i>
                        <strong>Plan de Desarrollo Personalizado</strong><br>
                        <small>Tu coach creará un plan específico basado en los resultados de tu evaluación DISC, enfocándose en tus áreas de oportunidad y fortalezas.</small>
                    </div>
                    
                    <form id="requestDevelopmentPlanForm">
                        <input type="hidden" id="planEvaluationId" />
                        
                        <div class="mb-3">
                            <label for="planName" class="form-label">
                                <i class="fas fa-user me-1"></i>Nombre Completo <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="planName" required readonly>
                        </div>
                        
                        <div class="mb-3">
                            <label for="planEmail" class="form-label">
                                <i class="fas fa-envelope me-1"></i>Email <span class="text-danger">*</span>
                            </label>
                            <input type="email" class="form-control" id="planEmail" required readonly>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">
                                <i class="fas fa-chart-radar me-1"></i>Áreas de Enfoque <span class="text-danger">*</span>
                            </label>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="focusCommunication" value="communication">
                                <label class="form-check-label" for="focusCommunication">
                                    <i class="fas fa-comments me-1 text-primary"></i>Comunicación Efectiva
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="focusLeadership" value="leadership">
                                <label class="form-check-label" for="focusLeadership">
                                    <i class="fas fa-users me-1 text-success"></i>Liderazgo de Equipos
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="focusDecision" value="decision">
                                <label class="form-check-label" for="focusDecision">
                                    <i class="fas fa-sitemap me-1 text-warning"></i>Toma de Decisiones
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="focusConflict" value="conflict">
                                <label class="form-check-label" for="focusConflict">
                                    <i class="fas fa-handshake me-1 text-info"></i>Resolución de Conflictos
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="focusEmotional" value="emotional">
                                <label class="form-check-label" for="focusEmotional">
                                    <i class="fas fa-heart me-1 text-danger"></i>Inteligencia Emocional
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="focusProductivity" value="productivity">
                                <label class="form-check-label" for="focusProductivity">
                                    <i class="fas fa-tasks me-1 text-secondary"></i>Productividad Personal
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="planPriority" class="form-label">
                                <i class="fas fa-flag me-1"></i>Prioridad <span class="text-danger">*</span>
                            </label>
                            <select class="form-select" id="planPriority" required>
                                <option value="">Selecciona una prioridad</option>
                                <option value="low">Baja - Desarrollo a largo plazo</option>
                                <option value="medium" selected>Media - Desarrollo gradual</option>
                                <option value="high">Alta - Necesito apoyo urgente</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="planGoals" class="form-label">
                                <i class="fas fa-bullseye me-1"></i>Objetivos Específicos (opcional)
                            </label>
                            <textarea class="form-control" id="planGoals" rows="3" placeholder="Ej: Mejorar mi capacidad de delegar tareas, fortalecer mi comunicación asertiva, desarrollar habilidades de coaching..."></textarea>
                            <small class="form-text text-muted">Comparte qué te gustaría lograr con este plan</small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="planMessage" class="form-label">
                                <i class="fas fa-message me-1"></i>Mensaje Adicional (opcional)
                            </label>
                            <textarea class="form-control" id="planMessage" rows="3" placeholder="Comparte cualquier contexto adicional que pueda ayudar a tu coach..."></textarea>
                        </div>
                        
                        <div class="alert alert-light border">
                            <small class="text-muted">
                                <i class="fas fa-info-circle me-1"></i>
                                Tu coach revisará tu solicitud y los resultados de tu evaluación para crear un plan personalizado. 
                                Recibirás una notificación cuando esté listo.
                            </small>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-success" onclick="submitDevelopmentPlanRequest()">
                        <i class="fas fa-paper-plane me-1"></i>Enviar Solicitud
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Ver Detalles del Plan de Desarrollo -->
    <div class="modal fade" id="viewDevelopmentPlanModal" tabindex="-1" aria-labelledby="viewDevelopmentPlanModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content" style="border-radius: 16px; border: none; box-shadow: 0 20px 60px rgba(0,0,0,0.15);">
                <!-- Header -->
                <div style="background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); padding: 1.5rem; border-radius: 16px 16px 0 0; position: relative;">
                    <h5 style="margin: 0; color: white; font-weight: 600; font-size: 1.15rem; display: flex; align-items: center; gap: 0.75rem;">
                        <i class="fas fa-rocket" style="font-size: 1.25rem;"></i>
                        <span>Mi Plan de Desarrollo Personal</span>
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close" style="position: absolute; right: 1.5rem; top: 1.5rem;"></button>
                </div>
                
                <!-- Body -->
                <div class="modal-body" style="padding: 1.5rem; background: #fafafa; max-height: 70vh; overflow-y: auto;">
                    <!-- Plan Header Info -->
                    <div id="modalPlanHeader" style="background: white; border-radius: 12px; padding: 1.25rem; margin-bottom: 1.25rem; border: 1px solid #e5e7eb;">
                        <div class="d-flex justify-content-between align-items-start flex-wrap gap-2">
                            <div>
                                <h6 style="font-size: 0.95rem; font-weight: 600; color: #111827; margin-bottom: 0.5rem;">
                                    <i class="fas fa-calendar-alt me-2" style="color: #667eea;"></i>
                                    Plan creado el <span id="modalPlanDate"></span>
                                </h6>
                                <p style="font-size: 0.8rem; color: #6b7280; margin: 0;">
                                    <i class="fas fa-user-tie me-2"></i>
                                    Por: <strong id="modalCoachName"></strong>
                                </p>
                            </div>
                            <span id="modalPlanStatus" class="badge" style="font-size: 0.75rem; padding: 0.4rem 0.75rem;"></span>
                        </div>
                    </div>
                    
                    <!-- Objetivo Principal -->
                    <div id="modalPlanObjective" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem; border-left: 4px solid #3b82f6;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #1e40af; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-bullseye"></i>
                            <span>Objetivo Principal</span>
                        </h6>
                        <p id="modalObjectiveText" style="font-size: 0.875rem; color: #1e3a8a; margin: 0; line-height: 1.6;"></p>
                    </div>
                    
                    <!-- Situación Actual -->
                    <div id="modalPlanSituation" style="background: white; border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem; border: 1px solid #e5e7eb;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #111827; margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-compass" style="color: #f59e0b;"></i>
                            <span>Situación Actual</span>
                        </h6>
                        <p id="modalSituationText" style="font-size: 0.875rem; color: #4b5563; margin: 0; line-height: 1.6;"></p>
                    </div>
                    
                    <!-- Áreas de Desarrollo -->
                    <div id="modalPlanAreas" style="background: white; border-radius: 10px; padding: 1.25rem; margin-bottom: 1.25rem; border: 1px solid #e5e7eb;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #111827; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-chart-line" style="color: #10b981;"></i>
                            <span>Áreas de Desarrollo</span>
                        </h6>
                        <div id="modalAreasList" style="display: flex; flex-wrap: wrap; gap: 0.5rem;"></div>
                    </div>
                    
                    <!-- Acciones -->
                    <div id="modalPlanActions" style="background: white; border-radius: 10px; padding: 1.25rem; border: 1px solid #e5e7eb;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #111827; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-tasks" style="color: #8b5cf6;"></i>
                            <span>Plan de Acción</span>
                        </h6>
                        <div id="modalActionsList"></div>
                    </div>
                    
                    <!-- Indicadores de Éxito -->
                    <div id="modalPlanIndicators" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius: 10px; padding: 1.25rem; margin-top: 1.25rem; border-left: 4px solid #10b981;">
                        <h6 style="font-size: 0.9rem; font-weight: 600; color: #065f46; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-star"></i>
                            <span>Indicadores de Éxito</span>
                        </h6>
                        <ul id="modalIndicatorsList" style="margin: 0; padding-left: 1.5rem; color: #047857; font-size: 0.875rem; line-height: 1.8;"></ul>
                    </div>
                </div>
                
                <!-- Footer -->
                <div class="modal-footer" style="background: white; border-top: 1px solid rgba(0,0,0,0.08); padding: 1rem 1.5rem; border-radius: 0 0 16px 16px; gap: 0.75rem;">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" style="font-size: 0.875rem; padding: 0.75rem 1.25rem; border-radius: 8px; font-weight: 600;">
                        <i class="fas fa-times me-1"></i>Cerrar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="printDevelopmentPlan()" style="font-size: 0.875rem; padding: 0.75rem 1.25rem; border-radius: 8px; font-weight: 600; background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); border: none;">
                        <i class="fas fa-print me-1"></i>Imprimir Plan
                    </button>
                </div>
            </div>
        </div>
    </div>

</div> <!-- Close container-fluid -->

    <script>
        // @ts-nocheck
        // ============================================
        // ALPINE.JS COACHEE DASHBOARD APP - V2 REACTIVE
        // ============================================
        
        console.log('🔧 Script principal cargando...');
        
        // Detectar cuando Alpine.js está listo
        document.addEventListener('alpine:init', () => {
            console.log('✅ Alpine.js INITIALIZED');
        });
        
        // API configuration
        const API_BASE_URL = window.location.origin;
        console.log('🌐 API_BASE_URL:', API_BASE_URL);
        
        // DEBUG: Add debugging function
        function debugLog(message, data = null) {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`🐛 [${timestamp}] ${message}`, data || '');
        }
        
        // ============================================
        // ALPINE.JS COMPONENT
        // ============================================
        function coacheeDashboardApp() {
            console.log('🎯 coacheeDashboardApp() function CALLED - Creating Alpine component');
            return {
                // Estado Global
                activeTab: 'evaluations',
                coacheeName: '',
                coacheeEmail: '',
                coacheeId: null,
                coacheeAvatar: '<i class="fas fa-user"></i>',
                
                // Datos
                evaluationsData: null,
                evaluationsLastLoaded: null,
                evaluationCategories: {},
                evaluationHistory: null,
                progressData: null,
                pendingEvaluations: [],
                pendingEvaluationsLoaded: false,
                tasksData: [],
                tasksLastLoaded: null,
                isLoadingTasks: false,
                TASKS_CACHE_DURATION: 30000, // 30 segundos
                documentsData: [],
                videosData: [],
                developmentPlans: [],
                isAssessmentActive: false,
                
                // Estadísticas
                stats: {
                    completedEvaluations: 0,
                    pendingEvaluations: 0,
                    activeTasks: 0,
                    overdueTasks: 0
                },
                
                // Estados de UI
                loading: {
                    evaluations: false,
                    tasks: false,
                    documents: false,
                    stats: false
                },
                
                // Constantes
                EVALUATIONS_CACHE_DURATION: 30000, // 30 segundos
                
                // Fecha/Hora actual
                currentDate: '',
                currentTime: '',
                
                // Inicialización
                async init() {
                    try {
                        console.log('🚀 Inicializando Coachee Dashboard Alpine.js V2');
                        this.createParticles();
                        this.updateDateTime();
                        setInterval(() => this.updateDateTime(), 1000);
                        
                        // IMPORTANTE: Inicializar funciones legacy PRIMERO para exponer window.evaluationCategories
                        this.initializeLegacyFunctions();
                        
                        // Cargar datos iniciales
                        console.log('📞 Cargando perfil de usuario...');
                        await this.loadUserProfile();
                        console.log('✅ Perfil cargado');
                        
                        // Cargar evaluaciones disponibles
                        console.log('📞 Cargando evaluaciones...');
                        await this.loadEvaluations();
                        console.log('✅ Evaluaciones cargadas');
                    } catch (error) {
                        console.error('❌ ERROR en init():', error);
                        console.error('Stack:', error.stack);
                    }
                },
                
                // Crear partículas animadas
                createParticles() {
                    const particlesContainer = document.querySelector('.particles');
                    if (!particlesContainer) return;
                    
                    for (let i = 0; i < 30; i++) {
                        const particle = document.createElement('div');
                        particle.className = 'particle';
                        particle.style.left = Math.random() * 100 + '%';
                        particle.style.animationDelay = Math.random() * 20 + 's';
                        particle.style.width = particle.style.height = (Math.random() * 4 + 2) + 'px';
                        particle.style.animationDuration = (Math.random() * 10 + 20) + 's';
                        particlesContainer.appendChild(particle);
                    }
                },
                
                // Actualizar fecha y hora
                updateDateTime() {
                    const now = new Date();
                    const options = { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    };
                    this.currentDate = now.toLocaleDateString('es-ES', options);
                    this.currentTime = now.toLocaleTimeString('es-ES', { 
                        hour: '2-digit', 
                        minute: '2-digit',
                        second: '2-digit'
                    });
                },
                
                // Cargar perfil de usuario
                async loadUserProfile() {
                    try {
                        console.log('👤 Cargando perfil de usuario...');
                        
                        // Obtener del endpoint correcto
                        const response = await fetch('/api/coachee/profile');
                        
                        if (response.ok) {
                            const data = await response.json();
                            console.log('✅ Perfil cargado desde /api/coachee/profile:', data);
                            
                            // El endpoint devuelve {success: true, profile: {...}}
                            const profile = data.profile || data;
                            
                            this.coacheeName = profile.full_name || profile.username || 'Usuario';
                            this.coacheeEmail = profile.email || '';
                            this.coacheeId = profile.id || null;
                            
                            // Actualizar welcome message
                            const welcomeEl = document.getElementById('welcomeMessage');
                            if (welcomeEl) {
                                welcomeEl.textContent = this.coacheeName.split(' ')[0];
                            }
                            
                            // Generar avatar
                            this.generateAvatar();
                            
                        } else {
                            console.warn('⚠️ No se pudo cargar perfil, usando valores por defecto');
                            this.coacheeName = 'Usuario';
                        }
                        
                    } catch (error) {
                        console.error('❌ Error al cargar perfil:', error);
                        this.coacheeName = 'Usuario';
                    }
                },
                
                // Generar avatar con iniciales
                generateAvatar() {
                    const names = this.coacheeName.split(' ');
                    let initials = '';
                    
                    if (names.length >= 2) {
                        initials = names[0][0] + names[1][0];
                    } else if (names.length === 1) {
                        initials = names[0].substring(0, 2);
                    } else {
                        initials = 'U';
                    }
                    
                    const colors = [
                        { bg: '#667eea', text: '#ffffff' },
                        { bg: '#764ba2', text: '#ffffff' },
                        { bg: '#f093fb', text: '#ffffff' },
                        { bg: '#4facfe', text: '#ffffff' },
                        { bg: '#43e97b', text: '#ffffff' }
                    ];
                    
                    const colorIndex = this.coacheeName.charCodeAt(0) % colors.length;
                    const color = colors[colorIndex];
                    
                    this.coacheeAvatar = `
                        <div style="
                            width: 100%;
                            height: 100%;
                            background: ${color.bg};
                            color: ${color.text};
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: 700;
                            font-size: 1rem;
                            border-radius: 50%;
                        ">
                            ${initials.toUpperCase()}
                        </div>
                    `;
                    
                    // Actualizar avatares en el DOM
                    const avatarElements = document.querySelectorAll('#headerAvatarDashboard, .user-avatar');
                    avatarElements.forEach(el => {
                        if (el) el.innerHTML = this.coacheeAvatar;
                    });
                },
                
                // Mantener funciones legacy para compatibilidad
                initializeLegacyFunctions() {
                    // Inicializar categorías de evaluaciones
                    this.evaluationCategories = {
                        'Personalidad': {
                            color: '#6f42c1',
                            icon: 'fa-user-circle',
                            keywords: ['personalidad', 'disc', 'temperamento', 'carácter']
                        },
                        'Liderazgo': {
                            color: '#fd7e14',
                            icon: 'fa-crown',
                            keywords: ['liderazgo', 'líder', 'gestión', 'dirección']
                        },
                        'Inteligencia Emocional': {
                            color: '#e83e8c',
                            icon: 'fa-heart',
                            keywords: ['emocional', 'emoción', 'sentimiento', 'asertividad']
                        },
                        'Trabajo en Equipo': {
                            color: '#20c997',
                            icon: 'fa-users',
                            keywords: ['equipo', 'colaboración', 'grupo', 'cooperación']
                        },
                        'Crecimiento Empresarial': {
                            color: '#17a2b8',
                            icon: 'fa-chart-line',
                            keywords: ['empresarial', 'negocio', 'crecer', 'crecimiento', '2026']
                        },
                        'Otros': {
                            color: '#6c757d',
                            icon: 'fa-clipboard-list',
                            keywords: []
                        }
                    };
                    
                    // Exponer categorías y datos globalmente para legacy code
                    window.evaluationCategories = this.evaluationCategories;
                    window.evaluationsData = this.evaluationsData;
                    
                    // Las funciones globales existentes se mantendrán por ahora
                    // Se migrarán progresivamente en los siguientes pasos
                    console.log('✅ Funciones legacy inicializadas');
                },
                
                // ============================================
                // MÉTODOS DE NAVEGACIÓN (Alpine)
                // ============================================
                
                navigateToCompletedEvaluations() {
                    console.log('📊 Navegando a evaluaciones completadas');
                    this.activeTab = 'completed-evaluations';
                    showTab('completed-evaluations');
                },
                
                navigateToTasks() {
                    console.log('📋 Navegando a tareas');
                    this.activeTab = 'tasks';
                    showTab('tasks');
                },
                
                navigateToOverdueTasks() {
                    console.log('⚠️ Navegando a tareas vencidas');
                    this.activeTab = 'tasks';
                    showTab('tasks');
                    // Después del cambio de tab, filtrar tareas vencidas
                    setTimeout(() => {
                        const overdueSection = document.querySelector('[data-section="overdue-tasks"]');
                        if (overdueSection) {
                            overdueSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }
                    }, 300);
                },
                
                openChangePasswordModalCoachee() {
                    // Llamar a la función legacy por ahora
                    if (typeof window.openChangePasswordModalCoachee === 'function') {
                        window.openChangePasswordModalCoachee();
                    }
                },
                
                // ============================================
                // SISTEMA DE NAVEGACIÓN (Alpine)
                // ============================================
                
                showTab(tabId) {
                    console.log('🔄 ALPINE showTab called with:', tabId);
                    
                    // Colapsar categorías de evaluaciones disponibles ANTES de cambiar de pestaña
                    const currentActiveTab = document.querySelector('.tab-pane.show.active');
                    if (currentActiveTab && currentActiveTab.id === 'evaluations' && tabId !== 'evaluations') {
                        // Estamos saliendo de la pestaña de evaluaciones
                        const allCategories = document.querySelectorAll('#availableEvaluations .assessments-grid[data-expanded="true"]');
                        allCategories.forEach(categoryGrid => {
                            const categoryId = categoryGrid.id;
                            const icon = document.getElementById(`icon-${categoryId}`);
                            
                            categoryGrid.style.maxHeight = '0px';
                            categoryGrid.style.opacity = '0';
                            categoryGrid.style.marginBottom = '0px';
                            if (icon) {
                                icon.style.transform = 'rotate(-90deg)';
                            }
                            categoryGrid.setAttribute('data-expanded', 'false');
                        });
                    }
                    
                    // Ocultar todos los tab-panes
                    const allTabPanes = document.querySelectorAll('.tab-pane');
                    allTabPanes.forEach(pane => {
                        pane.classList.remove('show', 'active');
                    });
                    
                    // Mostrar el tab-pane seleccionado
                    const targetPane = document.getElementById(tabId);
                    if (targetPane) {
                        targetPane.classList.add('show', 'active');
                    }
                    
                    // Actualizar estado reactivo
                    this.activeTab = tabId;
                    
                    // 📱 MOBILE: Scroll automático hacia la sección
                    if (window.innerWidth <= 768) {
                        setTimeout(() => {
                            const contentArea = document.querySelector('.col-md-9');
                            if (contentArea) {
                                contentArea.scrollIntoView({ 
                                    behavior: 'smooth', 
                                    block: 'start'
                                });
                                console.log('📱 Mobile: Scrolling to content area');
                            }
                        }, 100);
                    }
                    
                    // Cargar contenido específico según la pestaña
                    if (tabId === 'evaluations') {
                        // 🔥 ALPINE: Cargar evaluaciones disponibles
                        this.loadEvaluations();
                    } else if (tabId === 'tasks') {
                        // 🔥 ALPINE: Cargar tareas (con cache automático)
                        this.loadTasks();
                    } else if (tabId === 'content') {
                        // 🔥 ALPINE: Cargar contenido (videos por defecto)
                        setTimeout(() => {
                            this.switchContentTab('videos');
                        }, 100);
                    } else if (tabId === 'progress') {
                        // 🔥 ALPINE: Cargar historial de evaluaciones
                        this.loadEvaluationHistory();
                    } else if (tabId === 'completed-evaluations') {
                        // 🔥 ALPINE: Renderizar evaluaciones completadas
                        this.renderCompletedEvaluationsSection();
                    } else if (tabId === 'pending-evaluations') {
                        // 🔥 ALPINE: Cargar evaluaciones pendientes
                        this.loadPendingEvaluations();
                    } else if (tabId === 'development-plan') {
                        // 🔥 ALPINE: Cargar planes de desarrollo
                        this.loadDevelopmentPlans();
                    } else if (tabId === 'schedule-coach') {
                        // 🔥 ALPINE: Cargar disponibilidad del coach y sesiones
                        setTimeout(() => {
                            this.switchScheduleTab('request');
                        }, 100);
                    }
                    
                    console.log('✅ ALPINE Tab changed to:', tabId);
                },
                
                // ============================================
                // EVALUACIONES DISPONIBLES (Alpine)
                // ============================================
                
                async loadEvaluations(forceRefresh = false) {
                    // OPTIMIZACIÓN: Evitar carga duplicada
                    if (this.loading.evaluations) {
                        console.log('⏳ Evaluations already loading, skipping duplicate request');
                        return;
                    }
                    
                    // OPTIMIZACIÓN: Usar cache si los datos son recientes
                    if (!forceRefresh && this.evaluationsData && this.evaluationsLastLoaded) {
                        const age = Date.now() - this.evaluationsLastLoaded;
                        if (age < this.EVALUATIONS_CACHE_DURATION) {
                            console.log(`📦 Using cached evaluations data (age: ${Math.round(age/1000)}s)`);
                            this.renderAvailableEvaluations();
                            return;
                        }
                    }
                    
                    this.loading.evaluations = true;
                    
                    try {
                        debugLog('🔍 ALPINE: Iniciando carga de evaluaciones...');
                        const response = await fetch(`${API_BASE_URL}/api/coachee/evaluations`);
                        
                        debugLog(`📡 Response status: ${response.status} ${response.statusText}`);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        debugLog('📦 Datos de evaluaciones recibidos:', data);
                        
                        if (data && typeof data === 'object') {
                            this.evaluationsData = data; // {available: {}, completed: []}
                            this.evaluationsLastLoaded = Date.now();
                            
                            // Actualizar stats
                            if (data.completed && Array.isArray(data.completed)) {
                                this.stats.completedEvaluations = data.completed.length;
                                if (data.completed.length > 0) {
                                    this.stats.latestScore = data.completed[0].score + '%' || '0%';
                                }
                            }
                            
                            // Exponer globalmente para legacy code
                            window.evaluationsData = this.evaluationsData;
                            
                            debugLog('✅ Renderizando evaluaciones disponibles...');
                            this.renderAvailableEvaluations();
                        } else {
                            console.error('Formato de datos inesperado:', data);
                            throw new Error('Formato de datos inesperado del servidor');
                        }
                    } catch (error) {
                        debugLog('❌ Error cargando evaluaciones', error);
                        console.error('Error cargando evaluaciones:', error);
                        if (typeof showToast === 'function') {
                            showToast('Error cargando evaluaciones: ' + error.message, 'error');
                        }
                        
                        // Inicializar con datos vacíos
                        this.evaluationsData = { available: {}, completed: [] };
                        
                        // Show error in container
                        const container = document.getElementById('availableEvaluations');
                        if (container) {
                            container.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando mis evaluaciones disponibles</p></div>';
                        }
                    } finally {
                        this.loading.evaluations = false;
                    }
                },
                
                renderAvailableEvaluations() {
                    console.log('🔥 ALPINE: renderAvailableEvaluations CALLED');
                    
                    const container = document.getElementById('availableEvaluations');
                    if (!container) {
                        console.error('❌ Container availableEvaluations NO ENCONTRADO');
                        return;
                    }
                    
                    console.log('✅ Container encontrado:', container);
                    console.log('🔍 this.evaluationsData:', this.evaluationsData);
                    
                    // Exponer globalmente para legacy code
                    window.evaluationsData = this.evaluationsData;
                    
                    // Verificar mensaje específico
                    if (this.evaluationsData && this.evaluationsData.message) {
                        console.log('⚠️ Mostrando mensaje específico:', this.evaluationsData.message);
                        container.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="empty-state-title">Información</div>
                                <div class="empty-state-description">${this.evaluationsData.message}</div>
                            </div>
                        `;
                        return;
                    }
                    
                    if (!this.evaluationsData || !this.evaluationsData.available || Object.keys(this.evaluationsData.available).length === 0) {
                        console.log('⚠️ No hay evaluaciones disponibles. Data:', {
                            exists: !!this.evaluationsData,
                            hasAvailable: !!this.evaluationsData?.available,
                            availableKeys: this.evaluationsData?.available ? Object.keys(this.evaluationsData.available) : []
                        });
                        container.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-state-icon">
                                    <i class="fas fa-inbox"></i>
                                </div>
                                <div class="empty-state-title">Sin evaluaciones disponibles</div>
                                <div class="empty-state-description">No tienes evaluaciones disponibles en este momento</div>
                            </div>
                        `;
                        return;
                    }
                    
                    // Llamar a función legacy de renderizado
                    console.log('🚀 Llamando a renderAvailableEvaluationsLegacy...');
                    console.log('🔍 typeof renderAvailableEvaluationsLegacy:', typeof renderAvailableEvaluationsLegacy);
                    
                    if (typeof renderAvailableEvaluationsLegacy === 'function') {
                        console.log('✅ Función legacy encontrada, ejecutando...');
                        renderAvailableEvaluationsLegacy();
                    } else {
                        console.error('❌ renderAvailableEvaluationsLegacy NO está disponible');
                    }
                },
                
                // ============================================
                // EVALUACIONES COMPLETADAS (Alpine)
                // ============================================
                
                renderCompletedEvaluationsSection() {
                    console.log('🔍 ALPINE: renderCompletedEvaluationsSection called');
                    console.log('🔍 evaluationsData:', this.evaluationsData);
                    
                    // Exponer globalmente para legacy code
                    window.evaluationsData = this.evaluationsData;
                    
                    // Llamar a función legacy para renderizar
                    if (typeof renderCompletedEvaluationsLegacy === 'function') {
                        renderCompletedEvaluationsLegacy();
                    } else {
                        console.error('❌ renderCompletedEvaluationsLegacy no está disponible');
                    }
                },
                
                async loadEvaluationHistory() {
                    console.log('🔍 ALPINE: Loading evaluation history...');
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-history`);
                        const data = await response.json();
                        
                        console.log('🔍 ALPINE: evaluation-history response:', data);
                        
                        if (response.ok) {
                            this.evaluationHistory = data.history || [];
                            this.progressData = data.progress_data || null;
                            
                            console.log('🔍 DEBUG: progress_data:', data.progress_data);
                            console.log('🔍 DEBUG: history length:', data.history?.length);
                            
                            // 🔥 ALPINE: Cargar gráfico de progreso completo
                            await this.loadAllAssessmentHistory();
                            
                        } else {
                            throw new Error(data.error);
                        }
                    } catch (error) {
                        console.error('❌ Error cargando historial:', error);
                        if (typeof showToast === 'function') {
                            showToast('Error cargando historial de evaluaciones', 'error');
                        }
                    }
                },
                
                // ============================================
                // EVALUACIONES PENDIENTES (Alpine)
                // ============================================
                
                async loadPendingEvaluations() {
                    console.log('📊 ALPINE: Cargando evaluaciones pendientes...');
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/pending-evaluations`);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        console.log('📦 ALPINE: Evaluaciones pendientes recibidas:', data);
                        
                        if (data.success) {
                            this.pendingEvaluations = data.pending_evaluations || [];
                            this.pendingEvaluationsLoaded = true;
                            
                            // Exponer globalmente para legacy code
                            window.pendingEvaluations = this.pendingEvaluations;
                            
                            this.displayPendingEvaluations();
                        } else {
                            throw new Error(data.error || 'Error desconocido');
                        }
                    } catch (error) {
                        console.error('❌ ALPINE: Error cargando evaluaciones pendientes:', error);
                        const container = document.getElementById('pendingEvaluationsSection');
                        if (container) {
                            container.innerHTML = `
                                <div class="text-center py-5">
                                    <i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 3rem;"></i>
                                    <h5 class="text-muted mb-2">Error al cargar</h5>
                                    <p class="text-muted small">No se pudieron cargar las evaluaciones pendientes</p>
                                </div>
                            `;
                        }
                    }
                },
                
                displayPendingEvaluations() {
                    console.log('🔍 ALPINE: displayPendingEvaluations called');
                    
                    // Exponer globalmente
                    window.pendingEvaluations = this.pendingEvaluations;
                    
                    // Llamar función legacy
                    if (typeof displayPendingEvaluationsLegacy === 'function') {
                        displayPendingEvaluationsLegacy();
                    } else {
                        console.error('❌ displayPendingEvaluationsLegacy no disponible');
                    }
                },
                
                // ============================================
                // TASKS (Alpine)
                // ============================================
                
                async loadTasks(forceRefresh = false) {
                    console.log('📋 ALPINE: Loading tasks...');
                    
                    // Evitar carga duplicada
                    if (this.isLoadingTasks) {
                        console.log('⏳ Tasks already loading, skipping duplicate request');
                        return;
                    }
                    
                    // Usar cache si los datos son recientes
                    if (!forceRefresh && this.tasksData && this.tasksData.length > 0 && this.tasksLastLoaded) {
                        const age = Date.now() - this.tasksLastLoaded;
                        if (age < this.TASKS_CACHE_DURATION) {
                            console.log(`📦 Using cached tasks data (age: ${Math.round(age/1000)}s)`);
                            this.renderTasks();
                            return;
                        }
                    }
                    
                    this.isLoadingTasks = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/tasks`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                        
                        const data = await response.json();
                        
                        if (Array.isArray(data)) {
                            this.tasksData = data;
                            this.tasksLastLoaded = Date.now();
                            
                            // Exponer globalmente para legacy code
                            window.tasksData = this.tasksData;
                            
                            console.log(`✅ ALPINE: Tasks loaded successfully (${data.length} tasks)`);
                            this.renderTasks();
                        } else {
                            console.error('Formato de datos inesperado para tareas:', data);
                            throw new Error('Formato de datos inesperado del servidor');
                        }
                    } catch (error) {
                        console.error('❌ ALPINE: Error cargando tareas:', error);
                        if (typeof showToast === 'function') {
                            showToast('Error cargando tareas: ' + error.message, 'error');
                        }
                        
                        this.tasksData = [];
                        
                        const container = document.getElementById('tasksContainer');
                        if (container) {
                            container.innerHTML = '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando tareas</p></div>';
                        }
                    } finally {
                        this.isLoadingTasks = false;
                    }
                },
                
                renderTasks() {
                    console.log('🔍 ALPINE: renderTasks called');
                    
                    // Exponer globalmente
                    window.tasksData = this.tasksData;
                    
                    // Llamar función legacy
                    if (typeof renderTasksLegacy === 'function') {
                        renderTasksLegacy();
                    } else {
                        console.error('❌ renderTasksLegacy no disponible');
                    }
                },
                
                // ============================================
                // CONTENIDO (Alpine) - PASO 7
                // ============================================
                
                contentTab: 'videos', // 'videos' o 'documents'
                documentsLastLoaded: null,
                videosLastLoaded: null,
                isLoadingDocuments: false,
                isLoadingVideos: false,
                filteredDocuments: [],
                documentFilters: {
                    category: '',
                    priority: '',
                    search: ''
                },
                CONTENT_CACHE_DURATION: 300000, // 5 minutos
                
                // Cambiar tab de contenido
                switchContentTab(tab) {
                    console.log(`🔄 ALPINE: Switching content tab to ${tab}`);
                    this.contentTab = tab;
                    
                    if (tab === 'documents') {
                        this.loadDocuments();
                    } else if (tab === 'videos') {
                        this.loadVideos();
                    }
                },
                
                // Cargar documentos
                async loadDocuments(forceRefresh = false) {
                    console.log('📄 ALPINE: Loading documents...');
                    
                    // Evitar carga duplicada
                    if (this.isLoadingDocuments) {
                        console.log('⏳ Documents already loading');
                        return;
                    }
                    
                    // Usar cache si los datos son recientes
                    if (!forceRefresh && this.documentsData && this.documentsData.length > 0 && this.documentsLastLoaded) {
                        const age = Date.now() - this.documentsLastLoaded;
                        if (age < this.CONTENT_CACHE_DURATION) {
                            console.log(`📦 Using cached documents (age: ${Math.round(age/1000)}s)`);
                            this.renderDocuments();
                            return;
                        }
                    }
                    
                    this.isLoadingDocuments = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/documents`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        this.documentsData = data.documents || [];
                        this.filteredDocuments = [...this.documentsData];
                        this.documentsLastLoaded = Date.now();
                        
                        // Exponer globalmente
                        window.documentsData = this.documentsData;
                        window.lastDocumentLoad = this.documentsLastLoaded;
                        
                        console.log(`✅ ALPINE: ${this.documentsData.length} documents loaded`);
                        this.renderDocuments();
                    } catch (error) {
                        console.error('❌ ALPINE: Error loading documents:', error);
                        this.documentsData = [];
                        this.filteredDocuments = [];
                    } finally {
                        this.isLoadingDocuments = false;
                    }
                },
                
                // Renderizar documentos (llamar función legacy)
                renderDocuments() {
                    console.log('🔍 ALPINE: renderDocuments called');
                    
                    // Exponer globalmente
                    window.documentsData = this.documentsData;
                    window.filteredDocuments = this.filteredDocuments;
                    
                    // Llamar función legacy
                    if (typeof renderDocumentsLegacy === 'function') {
                        renderDocumentsLegacy();
                    } else {
                        console.error('❌ renderDocumentsLegacy no disponible');
                    }
                },
                
                // Filtrar documentos
                filterDocuments() {
                    console.log('🔍 ALPINE: Filtering documents', this.documentFilters);
                    
                    this.filteredDocuments = this.documentsData.filter(doc => {
                        // Filtrar por categoría
                        if (this.documentFilters.category && doc.category !== this.documentFilters.category) {
                            return false;
                        }
                        
                        // Filtrar por prioridad
                        if (this.documentFilters.priority && doc.priority !== this.documentFilters.priority) {
                            return false;
                        }
                        
                        // Filtrar por búsqueda
                        if (this.documentFilters.search) {
                            const search = this.documentFilters.search.toLowerCase();
                            const title = (doc.title || '').toLowerCase();
                            const description = (doc.description || '').toLowerCase();
                            return title.includes(search) || description.includes(search);
                        }
                        
                        return true;
                    });
                    
                    window.filteredDocuments = this.filteredDocuments;
                    this.renderDocuments();
                },
                
                // Cargar videos
                async loadVideos(forceRefresh = false) {
                    console.log('🎥 ALPINE: Loading videos...');
                    
                    // Evitar carga duplicada
                    if (this.isLoadingVideos) {
                        console.log('⏳ Videos already loading');
                        return;
                    }
                    
                    // Usar cache
                    if (!forceRefresh && this.videosData && this.videosData.length > 0 && this.videosLastLoaded) {
                        const age = Date.now() - this.videosLastLoaded;
                        if (age < this.CONTENT_CACHE_DURATION) {
                            console.log(`📦 Using cached videos (age: ${Math.round(age/1000)}s)`);
                            this.renderVideos();
                            return;
                        }
                    }
                    
                    this.isLoadingVideos = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/content`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        this.videosData = data.content || [];
                        this.videosLastLoaded = Date.now();
                        
                        // Exponer globalmente
                        window.contentData = this.videosData;
                        
                        console.log(`✅ ALPINE: ${this.videosData.length} videos loaded`);
                        this.renderVideos();
                    } catch (error) {
                        console.error('❌ ALPINE: Error loading videos:', error);
                        this.videosData = [];
                    } finally {
                        this.isLoadingVideos = false;
                    }
                },
                
                // Renderizar videos (llamar función legacy)
                renderVideos() {
                    console.log('🔍 ALPINE: renderVideos called');
                    
                    // Exponer globalmente
                    window.contentData = this.videosData;
                    
                    // Llamar función legacy
                    if (typeof renderContent === 'function') {
                        renderContent();
                    } else {
                        console.error('❌ renderContent no disponible');
                    }
                },
                
                // ============================================
                // PROGRESS (Alpine) - PASO 8
                // ============================================
                
                allAssessmentHistory: null,
                isLoadingProgress: false,
                progressChart: null,
                progressStatistics: {
                    totalEvaluations: 0,
                    averageScore: 0,
                    bestScore: 0
                },
                
                // Cargar historial completo de todas las evaluaciones
                async loadAllAssessmentHistory(forceRefresh = false) {
                    console.log('📈 ALPINE: Loading all assessment history...');
                    
                    if (this.isLoadingProgress) {
                        console.log('⏳ Progress already loading');
                        return;
                    }
                    
                    this.isLoadingProgress = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/all-assessment-history`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        console.log('📊 ALPINE: All assessment history received:', data);
                        console.log('📊 ALPINE: data.history:', data.history);
                        console.log('📊 ALPINE: Object.keys length:', data.history ? Object.keys(data.history).length : 0);
                        
                        if (data.success && data.history && Object.keys(data.history).length > 0) {
                            this.allAssessmentHistory = data.history;
                            
                            // Convertir estadísticas de snake_case a camelCase
                            if (data.statistics) {
                                this.progressStatistics = {
                                    totalEvaluations: data.statistics.total_evaluations || 0,
                                    averageScore: data.statistics.average_score || 0,
                                    bestScore: data.statistics.best_score || 0,
                                    worstScore: data.statistics.worst_score || 0
                                };
                            }
                            
                            console.log('📊 ALPINE: Statistics updated:', this.progressStatistics);
                            console.log('📊 ALPINE: allAssessmentHistory set:', this.allAssessmentHistory);
                            console.log('📊 ALPINE: isLoadingProgress:', this.isLoadingProgress);
                            
                            // Exponer globalmente
                            window.allAssessmentHistory = this.allAssessmentHistory;
                            
                            // Renderizar gráfico
                            this.renderProgressChart();
                        } else {
                            // No hay datos
                            console.log('⚠️ ALPINE: No history data or empty history');
                            this.showEmptyProgressState();
                        }
                    } catch (error) {
                        console.error('❌ ALPINE: Error loading progress:', error);
                        this.showEmptyProgressState();
                        this.isLoadingProgress = false;
                    }
                },
                
                // Renderizar gráfico de progreso
                renderProgressChart() {
                    console.log('📊 ALPINE: renderProgressChart called');
                    console.log('📊 ALPINE: allAssessmentHistory:', this.allAssessmentHistory);
                    
                    // Exponer globalmente
                    window.allAssessmentHistory = this.allAssessmentHistory;
                    
                    // Forzar la creación inmediata del gráfico
                    // Alpine ya debería haber actualizado el DOM en este punto
                    this.createProgressChart();
                },
                
                // Crear el gráfico de progreso con Chart.js (NUEVA VERSIÓN CON FECHAS)
                createProgressChart() {
                    console.log('📊 ALPINE: createProgressChart called (NEW VERSION)');
                    try {
                        const canvas = document.getElementById('alpineProgressChart');
                        
                        if (!canvas) {
                            console.error('❌ Canvas alpineProgressChart no encontrado');
                            this.isLoadingProgress = false;
                            return;
                        }
                        
                        const ctx = canvas.getContext('2d');
                        
                        // Destruir gráfico anterior si existe
                        if (this.progressChart) {
                            console.log('📊 ALPINE: Destroying previous chart...');
                            this.progressChart.destroy();
                        }
                        
                        console.log('📊 ALPINE: Building datasets with dates...');
                        
                        // Colores para diferentes evaluaciones
                        const colors = [
                            { border: '#10b981', bg: 'rgba(16, 185, 129, 0.1)' },    // Verde
                            { border: '#3b82f6', bg: 'rgba(59, 130, 246, 0.1)' },    // Azul
                            { border: '#f59e0b', bg: 'rgba(245, 158, 11, 0.1)' },    // Naranja
                            { border: '#ef4444', bg: 'rgba(239, 68, 68, 0.1)' },     // Rojo
                            { border: '#8b5cf6', bg: 'rgba(139, 92, 246, 0.1)' },    // Púrpura
                            { border: '#ec4899', bg: 'rgba(236, 72, 153, 0.1)' }     // Rosa
                        ];
                        
                        // Crear datasets para cada tipo de evaluación
                        const datasets = [];
                        let colorIndex = 0;
                        
                        Object.entries(this.allAssessmentHistory).forEach(([assessmentId, assessmentData]) => {
                            const color = colors[colorIndex % colors.length];
                            colorIndex++;
                            
                            console.log(`📈 ALPINE: Creating dataset for: ${assessmentData.title}`, {
                                dataPoints: assessmentData.data.length
                            });
                            
                            datasets.push({
                                label: assessmentData.title,
                                data: assessmentData.data.map(item => ({
                                    x: new Date(item.completed_at),  // Usar fecha/hora real
                                    y: item.percentage
                                })),
                                borderColor: color.border,
                                backgroundColor: color.bg,
                                borderWidth: 3,
                                pointRadius: 6,
                                pointHoverRadius: 8,
                                pointBackgroundColor: color.border,
                                pointBorderColor: '#ffffff',
                                pointBorderWidth: 2,
                                pointHoverBackgroundColor: color.border,
                                pointHoverBorderColor: '#ffffff',
                                tension: 0.4,
                                fill: false,
                                showLine: true,
                                spanGaps: true,
                                metadata: assessmentData.data
                            });
                        });
                        
                        console.log('📊 ALPINE: Creating chart with', datasets.length, 'datasets');
                        
                        // Crear el gráfico con eje X de tiempo
                        this.progressChart = new Chart(ctx, {
                            type: 'line',
                            data: { datasets },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                interaction: {
                                    mode: 'nearest',
                                    intersect: false,
                                    axis: 'x'
                                },
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'top',
                                        labels: {
                                            usePointStyle: true,
                                            padding: 15,
                                            font: {
                                                size: 12,
                                                family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif",
                                                weight: '500'
                                            },
                                            boxWidth: 10,
                                            boxHeight: 10
                                        }
                                    },
                                    tooltip: {
                                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                        titleColor: '#fff',
                                        bodyColor: '#fff',
                                        borderColor: 'rgba(255, 255, 255, 0.3)',
                                        borderWidth: 1,
                                        padding: 12,
                                        displayColors: true,
                                        callbacks: {
                                            title: function(context) {
                                                const date = new Date(context[0].parsed.x);
                                                const dateStr = date.toLocaleDateString('es-ES', { 
                                                    weekday: 'short',
                                                    day: '2-digit', 
                                                    month: 'short',
                                                    year: 'numeric'
                                                });
                                                const timeStr = date.toLocaleTimeString('es-ES', {
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                });
                                                return `${dateStr} - ${timeStr}`;
                                            },
                                            label: function(context) {
                                                return `${context.dataset.label}: ${context.parsed.y.toFixed(1)}%`;
                                            },
                                            afterLabel: function(context) {
                                                const datasetData = context.dataset.metadata;
                                                if (datasetData && datasetData.length > 1) {
                                                    return `Intento ${context.dataIndex + 1} de ${datasetData.length}`;
                                                }
                                                return '';
                                            }
                                        }
                                    }
                                },
                                scales: {
                                    x: {
                                        type: 'time',
                                        time: {
                                            unit: 'hour',
                                            displayFormats: {
                                                hour: 'dd MMM HH:mm',
                                                day: 'dd MMM',
                                                minute: 'dd MMM HH:mm'
                                            },
                                            tooltipFormat: 'dd/MM/yyyy HH:mm'
                                        },
                                        title: {
                                            display: true,
                                            text: 'Fecha y Hora de Evaluación',
                                            font: { size: 12, weight: 'bold' }
                                        },
                                        ticks: {
                                            maxRotation: 45,
                                            minRotation: 45,
                                            autoSkip: false,
                                            source: 'data',
                                            font: { size: 10, weight: '500' },
                                            callback: function(value, index, ticks) {
                                                const date = new Date(value);
                                                const dateStr = date.toLocaleDateString('es-ES', { 
                                                    day: '2-digit', 
                                                    month: 'short'
                                                });
                                                const timeStr = date.toLocaleTimeString('es-ES', {
                                                    hour: '2-digit',
                                                    minute: '2-digit',
                                                    hour12: false
                                                });
                                                return [`${dateStr}`, `${timeStr}`];
                                            }
                                        },
                                        grid: { 
                                            display: true,
                                            color: 'rgba(0, 0, 0, 0.05)' 
                                        }
                                    },
                                    y: {
                                        beginAtZero: true,
                                        max: 100,
                                        title: {
                                            display: true,
                                            text: 'Porcentaje (%)',
                                            font: { size: 12, weight: 'bold' }
                                        },
                                        ticks: {
                                            callback: function(value) {
                                                return value + '%';
                                            },
                                            font: { size: 11 }
                                        },
                                        grid: {
                                            color: 'rgba(0, 0, 0, 0.05)',
                                            drawBorder: false
                                        }
                                    }
                                }
                            }
                        });
                        
                        console.log('✅ ALPINE: Progress chart created successfully with time axis');
                    } catch (error) {
                        console.error('❌ ALPINE: Error creating progress chart:', error);
                    } finally {
                        this.isLoadingProgress = false;
                    }
                },
                
                // Mostrar estado vacío si no hay datos
                showEmptyProgressState() {
                    console.log('📊 ALPINE: No progress data available');
                    // Alpine maneja la visibilidad con x-show, no necesitamos manipular el DOM
                },
                
                // ============================================
                // DEVELOPMENT PLAN (Alpine) - PASO 9
                // ============================================
                
                developmentPlans: [],
                isLoadingPlans: false,
                selectedPlan: null,
                
                // Cargar planes de desarrollo
                async loadDevelopmentPlans(forceRefresh = false) {
                    console.log('📋 ALPINE: Loading development plans...');
                    
                    if (this.isLoadingPlans) {
                        console.log('⏳ Plans already loading');
                        return;
                    }
                    
                    this.isLoadingPlans = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/development-plans`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        console.log('📋 ALPINE: Development plans received:', data);
                        
                        if (data.success && data.plans && data.plans.length > 0) {
                            this.developmentPlans = data.plans;
                            this.selectedPlan = data.plans[0]; // Seleccionar el más reciente
                            
                            // Exponer globalmente
                            window.developmentPlans = this.developmentPlans;
                            
                            console.log(`✅ ALPINE: ${this.developmentPlans.length} plans loaded`);
                            this.renderDevelopmentPlans();
                        } else {
                            // No hay planes
                            this.developmentPlans = [];
                            this.selectedPlan = null;
                            this.showEmptyPlansState();
                        }
                    } catch (error) {
                        console.error('❌ ALPINE: Error loading plans:', error);
                        this.developmentPlans = [];
                        this.selectedPlan = null;
                        this.showEmptyPlansState();
                        
                        if (typeof showToast === 'function') {
                            showToast('Error al cargar el plan de desarrollo', 'error');
                        }
                    } finally {
                        this.isLoadingPlans = false;
                    }
                },
                
                // Renderizar planes (llamar función legacy)
                renderDevelopmentPlans() {
                    console.log('🔍 ALPINE: renderDevelopmentPlans called');
                    
                    // Exponer globalmente
                    window.developmentPlans = this.developmentPlans;
                    
                    // Llamar función legacy
                    if (typeof renderDevelopmentPlans === 'function') {
                        renderDevelopmentPlans(this.developmentPlans);
                    } else {
                        console.error('❌ renderDevelopmentPlans no disponible');
                    }
                },
                
                // Mostrar estado vacío si no hay planes
                showEmptyPlansState() {
                    const loadingEl = document.getElementById('devPlanLoading');
                    const emptyEl = document.getElementById('devPlanEmpty');
                    const contentEl = document.getElementById('devPlanContent');
                    
                    if (loadingEl) loadingEl.style.display = 'none';
                    if (emptyEl) emptyEl.style.display = 'block';
                    if (contentEl) contentEl.style.display = 'none';
                },
                
                // ============================================
                // CALENDAR/SCHEDULE (Alpine) - PASO 10
                // ============================================
                
                coachAvailability: [],
                occupiedSlots: [],
                mySessions: [],
                isLoadingAvailability: false,
                isLoadingSessions: false,
                coachName: '',
                scheduleTab: 'request', // 'request' o 'sessions'
                
                // Cambiar tab de schedule
                switchScheduleTab(tab) {
                    console.log(`🗓️ ALPINE: Switching schedule tab to ${tab}`);
                    this.scheduleTab = tab;
                    
                    if (tab === 'sessions') {
                        this.loadMySessions();
                    } else if (tab === 'request') {
                        this.loadCoachAvailability();
                    }
                },
                
                // Cargar disponibilidad del coach
                async loadCoachAvailability(forceRefresh = false) {
                    console.log('🗓️ ALPINE: Loading coach availability...');
                    
                    if (this.isLoadingAvailability) {
                        console.log('⏳ Availability already loading');
                        return;
                    }
                    
                    this.isLoadingAvailability = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/coach-availability`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        console.log('🗓️ ALPINE: Availability received:', data);
                        
                        if (data.success) {
                            this.coachAvailability = data.availability || [];
                            this.occupiedSlots = data.occupied_slots || [];
                            this.coachName = data.coach_name || '';
                            
                            // Exponer globalmente
                            window.coachAvailability = this.coachAvailability;
                            window.occupiedSlots = this.occupiedSlots;
                            
                            console.log(`✅ ALPINE: Loaded ${this.coachAvailability.length} availability slots`);
                            
                            // Llamar función legacy para renderizar
                            if (typeof displayCoachAvailability === 'function') {
                                displayCoachAvailability(this.coachAvailability, this.occupiedSlots, this.coachName);
                            }
                        } else {
                            this.showEmptyAvailabilityState();
                        }
                    } catch (error) {
                        console.error('❌ ALPINE: Error loading availability:', error);
                        this.showEmptyAvailabilityState();
                    } finally {
                        this.isLoadingAvailability = false;
                    }
                },
                
                // Cargar mis sesiones
                async loadMySessions(forceRefresh = false) {
                    console.log('📅 ALPINE: Loading my sessions...');
                    
                    if (this.isLoadingSessions) {
                        console.log('⏳ Sessions already loading');
                        return;
                    }
                    
                    this.isLoadingSessions = true;
                    
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/coachee/my-sessions`, {
                            credentials: 'include'
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP ${response.status}`);
                        }
                        
                        const data = await response.json();
                        console.log('📅 ALPINE: Sessions received:', data);
                        
                        if (data.success) {
                            this.mySessions = data.sessions || [];
                            
                            // Exponer globalmente
                            window.mySessions = this.mySessions;
                            
                            console.log(`✅ ALPINE: Loaded ${this.mySessions.length} sessions`);
                            
                            // Llamar función legacy para renderizar
                            if (typeof displayMySessions === 'function') {
                                displayMySessions(this.mySessions);
                            }
                            
                            // Actualizar contador
                            if (typeof updateMySessionsCount === 'function') {
                                updateMySessionsCount(this.mySessions.length);
                            }
                        }
                    } catch (error) {
                        console.error('❌ ALPINE: Error loading sessions:', error);
                        this.mySessions = [];
                    } finally {
                        this.isLoadingSessions = false;
                    }
                },
                
                // Mostrar estado vacío de disponibilidad
                showEmptyAvailabilityState() {
                    const container = document.getElementById('coachAvailabilityInfo');
                    if (container) {
                        container.innerHTML = '<p class="text-muted">No se pudo cargar la disponibilidad del coach</p>';
                    }
                },
                
                // ============================================
                // MODALS (Alpine) - PASO 11
                // ============================================
                
                modals: {
                    changePassword: false,
                    taskProgress: false,
                    evaluationDetails: false,
                    contactCoach: false,
                    assessmentResults: false
                },
                
                selectedTask: null,
                selectedEvaluation: null,
                
                // Abrir modal
                openModal(modalName) {
                    console.log(`🔓 ALPINE: Opening modal ${modalName}`);
                    this.modals[modalName] = true;
                    
                    // También activar el modal Bootstrap para compatibilidad
                    const modalId = this.getModalId(modalName);
                    if (modalId) {
                        const modalElement = document.getElementById(modalId);
                        if (modalElement) {
                            const modal = new bootstrap.Modal(modalElement);
                            modal.show();
                        }
                    }
                },
                
                // Cerrar modal
                closeModal(modalName) {
                    console.log(`🔒 ALPINE: Closing modal ${modalName}`);
                    this.modals[modalName] = false;
                    
                    // También cerrar el modal Bootstrap
                    const modalId = this.getModalId(modalName);
                    if (modalId) {
                        const modalElement = document.getElementById(modalId);
                        if (modalElement) {
                            const modal = bootstrap.Modal.getInstance(modalElement);
                            if (modal) modal.hide();
                        }
                    }
                },
                
                // Obtener ID del modal
                getModalId(modalName) {
                    const modalMap = {
                        changePassword: 'changePasswordModalCoachee',
                        taskProgress: 'taskProgressModal',
                        evaluationDetails: 'evaluationDetailsModal',
                        contactCoach: 'contactCoachModal',
                        assessmentResults: 'assessmentResultsModal'
                    };
                    return modalMap[modalName];
                },
                
                // Ver detalles de evaluación
                viewEvaluationDetails(evaluationId) {
                    console.log(`📊 ALPINE: Viewing evaluation ${evaluationId}`);
                    this.selectedEvaluation = evaluationId;
                    
                    // Llamar función legacy
                    if (typeof viewEvaluationDetails === 'function') {
                        viewEvaluationDetails(evaluationId);
                    }
                },
                
                // Ver progreso de tarea
                viewTaskProgress(taskId) {
                    console.log(`📋 ALPINE: Viewing task progress ${taskId}`);
                    this.selectedTask = taskId;
                    
                    // Llamar función legacy
                    if (typeof showTaskProgress === 'function') {
                        showTaskProgress(taskId);
                    }
                }
            };
        }
        
        // ============================================
        // FUNCIONES LEGACY (Se migrarán progresivamente)
        // ============================================
        
        // Helper function to escape HTML entities
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Helper function to clean video titles from problematic prefixes
        function cleanVideoTitle(title) {
            if (!title) return title;
            
            // Si el título empieza con "(Video de", limpiar esa parte
            if (title.startsWith('(Video de')) {
                const closeParenIndex = title.indexOf(')');
                if (closeParenIndex !== -1) {
                    const cleanedTitle = title.substring(closeParenIndex + 1).trim();
                    return cleanedTitle || 'Video educativo';
                }
            }
            
            return title;
        }
        
        // Helper function to clean video descriptions from problematic prefixes
        function cleanVideoDescription(description) {
            if (!description) return description;
            
            // Si la descripción empieza con "Video de", limpiar esa parte
            if (description.startsWith('Video de ')) {
                return description.substring(9).trim() || 'Contenido educativo asignado por el coach';
            }
            
            return description;
        }
        
        // Verificar si la sesión expiró y redirigir automáticamente
        function checkSessionExpired(data) {
            if (data && data.session_expired && data.redirect_url) {
                console.log('🔒 Sesión expirada, redirigiendo a login...');
                window.location.href = data.redirect_url;
                return true;
            }
            return false;
        }
        
        // DEBUG: Override fetch to log all requests
        const originalFetch = window.fetch;
        window.fetch = function(...args) {
            debugLog(`🌐 FETCH REQUEST: ${args[0]}`, args[1]);
            return originalFetch.apply(this, args)
                .then(async response => {
                    debugLog(`📥 FETCH RESPONSE: ${args[0]} - Status: ${response.status}`);
                    
                    // Intentar verificar si hay sesión expirada en la respuesta
                    if (response.ok && response.headers.get('content-type')?.includes('application/json')) {
                        // Clonar la respuesta para poder leerla sin consumirla
                        const clonedResponse = response.clone();
                        try {
                            const data = await clonedResponse.json();
                            // Verificar si la sesión expiró
                            if (checkSessionExpired(data)) {
                                // Sesión expirada, se redirigirá automáticamente
                                return new Promise(() => {}); // Never resolves, ya que se redirige
                            }
                        } catch (e) {
                            // Si falla el parsing, continuar con la respuesta original
                            debugLog(`⚠️ No se pudo verificar sesión en respuesta: ${e.message}`);
                        }
                    }
                    
                    return response;
                })
                .catch(error => {
                    debugLog(`❌ FETCH ERROR: ${args[0]}`, error);
                    throw error;
                });
        };
        
        debugLog("🚀 Coachee Dashboard JavaScript loaded");
        
        // Application state
        let currentUser = null;
        let dashboardData = null;
        let evaluationsData = null;
        let tasksData = null;
        let contentData = null;
        // let progressChart = null; // ELIMINADO
        // let testProgressChart = null; // ELIMINADO

        // Assessment state
        let questions = [];
        let currentQuestionIndex = 0;
        let answers = {};
        let isAssessmentActive = false;
        let currentAssessmentId = null;
        
        // CACHE BUSTER: Verificar que JavaScript se cargó correctamente
        console.log('🔄 COACHEE DASHBOARD LOADED - TIMESTAMP: 2025-10-12-17:35:00');
        console.log('✅ Funciones de Preparación para crecer 2026 disponibles');

        // Logout function
        async function logout() {
            try {
                // Show loading state
                const logoutBtn = document.querySelector('.logout-btn');
                const originalContent = logoutBtn.innerHTML;
                logoutBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Cerrando...';
                logoutBtn.disabled = true;

                // Call logout API específico para coachee
                const response = await fetch(`${API_BASE_URL}/api/coachee/logout`, {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                // Always redirect to participant access page regardless of API response
                window.location.href = '/participant-access';
                
            } catch (error) {
                console.error('Error during logout:', error);
                // Even if there's an error, redirect to participant access page
                window.location.href = '/participant-access';
            }
        }

        // Initialize particles animation
        function createParticles() {
            const particlesContainer = document.querySelector('.particles');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.width = particle.style.height = (Math.random() * 4 + 2) + 'px';
                particle.style.animationDuration = (Math.random() * 10 + 20) + 's';
                particlesContainer.appendChild(particle);
            }
        }

        // ============================================
        // WRAPPER FUNCTIONS PARA COMPATIBILIDAD LEGACY
        // ============================================
        
        // showTab global wrapper - llama al método Alpine
        function showTab(tabId) {
            // Obtener la instancia de Alpine y llamar al método
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.showTab === 'function') {
                alpineData.showTab(tabId);
            } else {
                console.warn('⚠️ Alpine not ready, fallback to direct manipulation');
                // Fallback por si Alpine no está listo
                const allTabPanes = document.querySelectorAll('.tab-pane');
                allTabPanes.forEach(pane => pane.classList.remove('show', 'active'));
                
                const targetPane = document.getElementById(tabId);
                if (targetPane) targetPane.classList.add('show', 'active');
            }
        }
        
        // loadEvaluations wrapper - llama al método Alpine
        async function loadEvaluations(forceRefresh = false) {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadEvaluations === 'function') {
                await alpineData.loadEvaluations(forceRefresh);
            } else {
                console.warn('⚠️ Alpine not ready for loadEvaluations');
            }
        }
        
        // ============================================
        // WRAPPERS GLOBALES PARA COMPATIBILIDAD (Legacy)
        // ============================================
        
        // Wrapper para showTab
        function showTab(tabId) {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.showTab === 'function') {
                alpineData.showTab(tabId);
            } else {
                console.error('❌ Alpine component not ready');
            }
        }
        
        // Wrapper para loadEvaluations
        async function loadEvaluations(forceRefresh = false) {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadEvaluations === 'function') {
                await alpineData.loadEvaluations(forceRefresh);
            } else {
                console.error('❌ Alpine component not ready');
            }
        }
        
        // 🔥 PASO 4: Wrapper para renderCompletedEvaluationsSection
        function renderCompletedEvaluationsSection() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.renderCompletedEvaluationsSection === 'function') {
                alpineData.renderCompletedEvaluationsSection();
            } else {
                console.error('❌ Alpine component not ready');
            }
        }
        
        // 🔥 PASO 4: Wrapper para loadEvaluationHistory
        async function loadEvaluationHistory() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadEvaluationHistory === 'function') {
                await alpineData.loadEvaluationHistory();
            } else {
                console.error('❌ Alpine component not ready');
            }
        }

        // 🔥 PASO 5: Wrapper para loadPendingEvaluations
        async function loadPendingEvaluations() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadPendingEvaluations === 'function') {
                await alpineData.loadPendingEvaluations();
            } else {
                console.error('❌ Alpine component not ready');
            }
        }
        
        // 🔥 PASO 5: Wrapper para displayPendingEvaluations
        function displayPendingEvaluations() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.displayPendingEvaluations === 'function') {
                alpineData.displayPendingEvaluations();
            } else {
                console.error('❌ Alpine component not ready');
            }
        }
        
        // 🔥 PASO 6: Wrapper para loadTasks
        async function loadTasks(forceRefresh = false) {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.loadTasks === 'function') {
                await alpineData.loadTasks(forceRefresh);
            } else {
                console.error('❌ Alpine component not ready');
            }
        }
        
        // 🔥 PASO 6: Wrapper para renderTasks  
        function renderTasks() {
            const alpineData = Alpine.$data(document.body);
            if (alpineData && typeof alpineData.renderTasks === 'function') {
                alpineData.renderTasks();
            } else {
                console.error('❌ Alpine component not ready');
            }
        }

        // Función para navegar a evaluaciones completadas
        function navigateToCompletedEvaluations() {
            // Primero activar la pestaña de evaluaciones con el nuevo sistema
            showTab('evaluations');
            
            // Hacer scroll hacia la sección de evaluaciones completadas
            setTimeout(() => {
                const completedSection = document.getElementById('completedEvaluations');
                if (completedSection) {
                    completedSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                    // Destacar brevemente la sección
                    completedSection.style.border = '2px solid #28a745';
                    completedSection.style.borderRadius = '0.5rem';
                    setTimeout(() => {
                        completedSection.style.border = '';
                        completedSection.style.borderRadius = '';
                    }, 2000);
                }
            }, 100);
        }

        // Función para navegar a la sección de tareas
        function navigateToTasks() {
            // Primero activar la pestaña de tareas con el nuevo sistema
            showTab('tasks');
            
            // Hacer scroll hacia la sección de tareas
            setTimeout(() => {
                const tasksSection = document.getElementById('tasks');
                if (tasksSection) {
                    tasksSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                    // Destacar brevemente la sección
                    tasksSection.style.border = '2px solid #ffc107';
                    tasksSection.style.borderRadius = '0.5rem';
                    setTimeout(() => {
                        tasksSection.style.border = '';
                        tasksSection.style.borderRadius = '';
                    }, 2000);
                }
            }, 100);
        }

        // Función para navegar a las tareas vencidas
        function navigateToOverdueTasks() {
            // Primero activar la pestaña de tareas con el nuevo sistema
            showTab('tasks');
            
            // Hacer scroll hacia la sección de tareas
            setTimeout(() => {
                const tasksSection = document.getElementById('tasks');
                if (tasksSection) {
                    tasksSection.scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'start' 
                    });
                    
                    // Destacar brevemente la sección con color rojo (danger)
                    tasksSection.style.border = '2px solid #dc3545';
                    tasksSection.style.borderRadius = '0.5rem';
                    setTimeout(() => {
                        tasksSection.style.border = '';
                        tasksSection.style.borderRadius = '';
                    }, 2000);
                    
                    // Destacar visualmente las tareas vencidas dentro del contenedor
                    setTimeout(() => {
                        const tasksContainer = document.getElementById('tasksContainer');
                        if (tasksContainer) {
                            // Buscar todas las tareas vencidas y destacarlas
                            const overdueTasks = tasksContainer.querySelectorAll('.task-item[data-status="overdue"], .task-item.overdue, .task-item .text-danger');
                            overdueTasks.forEach(task => {
                                task.style.background = 'rgba(220, 53, 69, 0.1)';
                                task.style.border = '2px solid rgba(220, 53, 69, 0.3)';
                                task.style.borderRadius = '0.5rem';
                                
                                // Quitar el destacado después de 3 segundos
                                setTimeout(() => {
                                    task.style.background = '';
                                    task.style.border = '';
                                    task.style.borderRadius = '';
                                }, 3000);
                            });
                        }
                    }, 500);
                }
            }, 100);
        }

        // ============================================
        // 📋 DESARROLLO DE PLANES - Funciones
        // ============================================
        
        async function loadDevelopmentPlans() {
            console.log('📋 COACHEE: Cargando planes de desarrollo...');
            
            const loadingEl = document.getElementById('devPlanLoading');
            const emptyEl = document.getElementById('devPlanEmpty');
            const contentEl = document.getElementById('devPlanContent');
            
            // Mostrar loading
            loadingEl.style.display = 'block';
            emptyEl.style.display = 'none';
            contentEl.style.display = 'none';
            
            try {
                const response = await fetch('/api/coachee/development-plans');
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('📋 COACHEE: Datos recibidos:', data);
                
                loadingEl.style.display = 'none';
                
                if (data.success && data.plans && data.plans.length > 0) {
                    console.log(`📋 COACHEE: Se encontraron ${data.plans.length} planes`);
                    renderDevelopmentPlans(data.plans);
                    contentEl.style.display = 'block';
                } else {
                    console.log('📋 COACHEE: No hay planes disponibles');
                    emptyEl.style.display = 'block';
                }
                
            } catch (error) {
                console.error('❌ Error al cargar planes:', error);
                loadingEl.style.display = 'none';
                emptyEl.style.display = 'block';
                showToast('Error al cargar el plan de desarrollo', 'error');
            }
        }
        
        function renderDevelopmentPlans(plans) {
            const container = document.getElementById('devPlanContent');
            container.innerHTML = '';
            
            // Crear grid para múltiples planes
            const plansHTML = plans.map((plan, index) => `
                <div class="dev-plan-card" style="
                    background: white;
                    border: 1.5px solid #e5e7eb;
                    border-radius: 10px;
                    padding: 0.875rem;
                    margin-bottom: 0.75rem;
                    transition: all 0.2s ease;
                    cursor: pointer;
                    position: relative;
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.08)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                    
                    <!-- Header con info del plan -->
                    <div style="display: flex; justify-content: space-between; align-items: start; gap: 0.5rem; margin-bottom: 0.75rem;">
                        <div style="flex: 1; min-width: 0;">
                            <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 0.25rem 0.65rem; border-radius: 12px; font-size: 0.7rem; font-weight: 600; display: inline-block;">
                                <i class="fas fa-check-circle" style="font-size: 0.65rem;"></i> Plan ${index + 1}
                            </span>
                            <div style="color: #64748b; font-size: 0.7rem; margin-top: 0.35rem;">
                                <i class="fas fa-calendar-check" style="font-size: 0.65rem;"></i> ${new Date(plan.published_at).toLocaleDateString('es-ES', { day: 'numeric', month: 'short', year: 'numeric' })}
                            </div>
                        </div>
                        <button onclick="togglePlanDetails(${plan.id})" style="
                            background: #f3f4f6;
                            border: none;
                            border-radius: 6px;
                            padding: 0.35rem 0.5rem;
                            color: #667eea;
                            font-size: 0.7rem;
                            cursor: pointer;
                            transition: all 0.2s;
                        " onmouseover="this.style.background='#667eea'; this.style.color='white'" onmouseout="this.style.background='#f3f4f6'; this.style.color='#667eea'">
                            <i class="fas fa-chevron-down" id="plan-icon-${plan.id}"></i>
                        </button>
                    </div>
                    
                    <!-- Objetivo Principal (siempre visible) -->
                    <div style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.06) 0%, rgba(118, 75, 162, 0.06) 100%); border-left: 2px solid #667eea; border-radius: 5px; padding: 0.65rem 0.75rem; margin-bottom: 0.5rem;">
                        <div style="color: #667eea; font-weight: 700; margin-bottom: 0.35rem; display: flex; align-items: center; font-size: 0.8rem;">
                            <i class="fas fa-bullseye" style="font-size: 0.75rem; margin-right: 0.4rem;"></i>Objetivo
                        </div>
                        <p style="color: #334155; font-size: 0.8rem; margin: 0; line-height: 1.4;">${plan.objetivo || 'No especificado'}</p>
                    </div>
                    
                    <!-- Áreas de Desarrollo (compactas) -->
                    <div style="margin-bottom: 0.5rem;">
                        <div style="color: #475569; font-weight: 600; margin-bottom: 0.4rem; display: flex; align-items: center; font-size: 0.75rem;">
                            <i class="fas fa-th-large" style="color: #667eea; font-size: 0.7rem; margin-right: 0.4rem;"></i>Áreas
                        </div>
                        <div style="display: flex; gap: 0.35rem; flex-wrap: wrap;">
                            ${renderAreasCompact(plan.areas_desarrollo)}
                        </div>
                    </div>
                    
                    <!-- Detalles expandibles -->
                    <div id="plan-details-${plan.id}" style="display: none; margin-top: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #e5e7eb;">
                        
                        ${plan.situacion_actual ? `
                        <div style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 5px; padding: 0.65rem 0.75rem; margin-bottom: 0.5rem;">
                            <div style="color: #475569; font-weight: 600; margin-bottom: 0.35rem; display: flex; align-items: center; font-size: 0.75rem;">
                                <i class="fas fa-compass" style="font-size: 0.7rem; margin-right: 0.4rem;"></i>Situación Actual
                            </div>
                            <p style="color: #64748b; margin: 0; line-height: 1.4; font-size: 0.75rem;">${plan.situacion_actual}</p>
                        </div>
                        ` : ''}
                        
                        <div style="margin-bottom: 0.5rem;">
                            <div style="color: #475569; font-weight: 600; margin-bottom: 0.4rem; display: flex; align-items: center; font-size: 0.75rem;">
                                <i class="fas fa-tasks" style="color: #667eea; font-size: 0.7rem; margin-right: 0.4rem;"></i>Acciones (${plan.acciones?.length || 0})
                            </div>
                            ${renderAccionesCompact(plan.acciones)}
                        </div>
                        
                        <div style="background: #f0fdf4; border: 1.5px solid #86efac; border-radius: 5px; padding: 0.65rem 0.75rem;">
                            <div style="color: #16a34a; font-weight: 600; margin-bottom: 0.35rem; display: flex; align-items: center; font-size: 0.75rem;">
                                <i class="fas fa-chart-line" style="font-size: 0.7rem; margin-right: 0.4rem;"></i>Indicadores
                            </div>
                            <p style="color: #166534; margin: 0; line-height: 1.4; white-space: pre-wrap; font-size: 0.75rem;">${plan.indicadores || 'No especificados'}</p>
                        </div>
                    </div>
                    
                </div>
            `).join('');
            
            container.innerHTML = plansHTML;
        }
        
        // Toggle plan details
        function togglePlanDetails(planId) {
            const details = document.getElementById(`plan-details-${planId}`);
            const icon = document.getElementById(`plan-icon-${planId}`);
            
            if (details.style.display === 'none') {
                details.style.display = 'block';
                icon.className = 'fas fa-chevron-up';
            } else {
                details.style.display = 'none';
                icon.className = 'fas fa-chevron-down';
            }
        }
        
        function renderAreas(areas) {
            if (!areas || !Array.isArray(areas) || areas.length === 0) {
                return '<span style="color: #94a3b8; font-style: italic; font-size: 0.85rem;">No especificadas</span>';
            }
            
            const colors = [
                { bg: '#eff6ff', border: '#3b82f6', text: '#1e40af' },
                { bg: '#f0fdf4', border: '#22c55e', text: '#166534' },
                { bg: '#fef3c7', border: '#f59e0b', text: '#92400e' }
            ];
            
            return areas.map((area, index) => {
                const color = colors[index % colors.length];
                return `
                    <span style="
                        background: ${color.bg}; 
                        border: 1.5px solid ${color.border}; 
                        color: ${color.text}; 
                        padding: 0.4rem 0.75rem; 
                        border-radius: 16px; 
                        font-weight: 600; 
                        font-size: 0.8rem;
                        display: inline-block;
                        line-height: 1.2;
                    ">
                        ${area}
                    </span>
                `;
            }).join('');
        }
        
        function renderAreasCompact(areas) {
            if (!areas || !Array.isArray(areas) || areas.length === 0) {
                return '<span style="color: #94a3b8; font-style: italic; font-size: 0.7rem;">Ninguna</span>';
            }
            
            const colors = [
                { bg: '#dbeafe', border: '#3b82f6', text: '#1e40af' },
                { bg: '#d1fae5', border: '#22c55e', text: '#166534' },
                { bg: '#fef3c7', border: '#f59e0b', text: '#92400e' }
            ];
            
            return areas.map((area, index) => {
                const color = colors[index % colors.length];
                return `
                    <span style="
                        background: ${color.bg}; 
                        border: 1px solid ${color.border}; 
                        color: ${color.text}; 
                        padding: 0.25rem 0.5rem; 
                        border-radius: 10px; 
                        font-weight: 600; 
                        font-size: 0.7rem;
                        display: inline-block;
                        line-height: 1.2;
                    ">
                        ${area}
                    </span>
                `;
            }).join('');
        }
        
        function renderAcciones(acciones) {
            if (!acciones || !Array.isArray(acciones) || acciones.length === 0) {
                return '<p style="color: #94a3b8; font-style: italic; font-size: 0.85rem;">No hay acciones definidas</p>';
            }
            
            return acciones.map((accion, index) => `
                <div style="background: white; border: 1.5px solid #e2e8f0; border-radius: 6px; padding: 0.875rem; margin-bottom: 0.75rem;">
                    <div style="display: flex; align-items: start; gap: 0.75rem;">
                        <div style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            width: 26px;
                            height: 26px;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: 700;
                            flex-shrink: 0;
                            font-size: 0.85rem;
                        ">
                            ${index + 1}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <p style="color: #334155; font-weight: 600; margin-bottom: 0.5rem; font-size: 0.9rem; line-height: 1.4;">${accion.descripcion}</p>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                <span style="color: #64748b; font-size: 0.8rem;">
                                    <i class="fas fa-sync-alt me-1" style="color: #667eea; font-size: 0.75rem;"></i>
                                    <strong>Frecuencia:</strong> ${accion.frecuencia || 'No especificada'}
                                </span>
                                ${accion.fecha_objetivo ? `
                                <span style="color: #64748b; font-size: 0.8rem;">
                                    <i class="fas fa-calendar-day me-1" style="color: #667eea; font-size: 0.75rem;"></i>
                                    <strong>Fecha:</strong> ${new Date(accion.fecha_objetivo).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}
                                </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function renderAccionesCompact(acciones) {
            if (!acciones || !Array.isArray(acciones) || acciones.length === 0) {
                return '<p style="color: #94a3b8; font-style: italic; font-size: 0.7rem; margin: 0;">No definidas</p>';
            }
            
            return acciones.map((accion, index) => `
                <div style="background: #fafafa; border: 1px solid #e5e7eb; border-radius: 5px; padding: 0.5rem 0.65rem; margin-bottom: 0.4rem;">
                    <div style="display: flex; align-items: start; gap: 0.5rem;">
                        <div style="
                            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                            color: white;
                            width: 18px;
                            height: 18px;
                            border-radius: 50%;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            font-weight: 700;
                            flex-shrink: 0;
                            font-size: 0.65rem;
                        ">
                            ${index + 1}
                        </div>
                        <div style="flex: 1; min-width: 0;">
                            <p style="color: #334155; font-weight: 500; margin-bottom: 0.25rem; font-size: 0.75rem; line-height: 1.3;">${accion.descripcion}</p>
                            <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                <span style="color: #64748b; font-size: 0.65rem;">
                                    <i class="fas fa-sync-alt" style="color: #667eea; font-size: 0.6rem; margin-right: 0.2rem;"></i>
                                    ${accion.frecuencia || 'N/A'}
                                </span>
                                ${accion.fecha_objetivo ? `
                                <span style="color: #64748b; font-size: 0.65rem;">
                                    <i class="fas fa-calendar-day" style="color: #667eea; font-size: 0.6rem; margin-right: 0.2rem;"></i>
                                    ${new Date(accion.fecha_objetivo).toLocaleDateString('es-ES', { day: 'numeric', month: 'short' })}
                                </span>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Toast notification system
        function showToast(message, type = 'info') {
            const toastElement = document.getElementById('toastNotification');
            const toastBody = toastElement.querySelector('.toast-body');
            const toastHeader = toastElement.querySelector('.toast-header');
            
            // Update icon
            const icon = toastHeader.querySelector('i');
            switch (type) {
                case 'success':
                    icon.className = 'fas fa-check-circle text-success me-2';
                    break;
                case 'error':
                    icon.className = 'fas fa-exclamation-circle text-danger me-2';
                    break;
                case 'warning':
                    icon.className = 'fas fa-exclamation-triangle text-warning me-2';
                    break;
                default:
                    icon.className = 'fas fa-info-circle text-primary me-2';
            }
            
            toastBody.textContent = message;
            
            const toast = new bootstrap.Toast(toastElement, {
                autohide: true,
                delay: 5000
            });
            toast.show();
        }

        // Load user profile
        async function loadUserProfile() {
            try {
                console.log('🔍 Cargando perfil de usuario...');
                
                // Esperar a que el DOM esté completamente cargado
                if (document.readyState === 'loading') {
                    await new Promise(resolve => document.addEventListener('DOMContentLoaded', resolve));
                }
                
                // SOLUCIÓN: Obtener nombre real del usuario automáticamente
                console.log('🔧 MODO AUTOMÁTICO: Obteniendo nombre del usuario...');
                
                // PRIORIDAD 1: Usar endpoint específico de coachee (más confiable)
                console.log('🎯 PRIORIDAD 1: Intentando dashboard-summary (específico de coachee)...');
                try {
                    const summaryResponse = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                    console.log('🌐 Dashboard summary response status:', summaryResponse.status);
                    
                    if (summaryResponse.ok) {
                        const summaryData = await summaryResponse.json();
                        console.log('📊 Dashboard summary FULL data:', JSON.stringify(summaryData, null, 2));
                        
                        if (summaryData.success && summaryData.summary?.coachee?.name) {
                            const userName = summaryData.summary.coachee.name;
                            console.log('👤 Nombre del COACHEE (dashboard-summary):', userName);
                            console.log('📧 Email del COACHEE (dashboard-summary):', summaryData.summary.coachee.email);
                            console.log('🖼️ Avatar del COACHEE (dashboard-summary):', summaryData.summary.coachee.avatar_url);
                            
                            // Mostrar también info del coach para comparar
                            if (summaryData.summary?.coach) {
                                console.log('👔 Nombre del COACH:', summaryData.summary.coach.name);
                                console.log('📧 Email del COACH:', summaryData.summary.coach.email);
                            }
                            
                            // Crear objeto currentUser con los datos del coachee
                            currentUser = {
                                full_name: userName,
                                email: summaryData.summary.coachee.email,
                                avatar_url: summaryData.summary.coachee.avatar_url
                            };
                            
                            const welcomeText = userName;
                            updateAllWelcomeMessages(welcomeText);
                            updateHeaderAvatar();
                            console.log('✅ Actualizado con nombre y avatar del dashboard summary:', welcomeText);
                            return;
                        } else {
                            console.log('❌ Dashboard summary no tiene nombre de usuario');
                        }
                    } else {
                        console.log('❌ Dashboard summary response not ok:', summaryResponse.status);
                    }
                } catch (summaryError) {
                    console.log('⚠️ Dashboard summary error:', summaryError.message);
                }
                
                // PRIORIDAD 2: Fallback a /api/coachee/profile (específico para coachees con avatar)
                console.log('🔄 PRIORIDAD 2: Fallback a coachee/profile (con avatar)...');
                try {
                    const response = await fetch(`${API_BASE_URL}/api/coachee/profile`);
                    console.log('🌐 coachee/profile response status:', response.status);
                    
                    if (response.ok) {
                        const data = await response.json();
                        console.log('📥 API /api/coachee/profile response:', JSON.stringify(data, null, 2));
                        
                        if (data.success && data.profile?.full_name) {
                            const realName = data.profile.full_name;
                            console.log('👤 Nombre obtenido (coachee/profile):', realName);
                            console.log('📧 Email (coachee/profile):', data.profile.email);
                            console.log('🎭 Role (coachee/profile):', data.profile.role);
                            console.log('🖼️ Avatar (coachee/profile):', data.profile.avatar_url);
                            
                            const realWelcomeText = realName;
                            updateAllWelcomeMessages(realWelcomeText);
                            console.log('✅ Actualizado con coachee/profile:', realWelcomeText);
                            currentUser = data.profile;
                            updateHeaderAvatar();
                            return;
                        }
                    }
                } catch (apiError) {
                    console.log('⚠️ coachee/profile API error:', apiError.message);
                }
                
                // Último fallback: mantener mensaje genérico
                console.log('🔄 Manteniendo mensaje genérico - todos los endpoints fallaron');
                
            } catch (error) {
                console.error('❌ Error cargando perfil:', error);
                
                // Fallback: mantener mensaje genérico si hay error total
                console.log('🔄 Error total - manteniendo mensaje genérico de bienvenida');
            }
        }

        // Load dashboard summary
        async function loadDashboardSummary() {
            try {
                console.log('Fetching dashboard summary from:', `${API_BASE_URL}/api/coachee/dashboard-summary`);
                const response = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                
                console.log('Response status:', response.status);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                console.log('Raw API response data:', data);
                
                if (data && data.summary) {
                    dashboardData = data.summary;
                    console.log('Dashboard data set to:', dashboardData);
                    updateSummaryCards();
                    updateUserInfo();
                } else {
                    console.error('Formato de datos inesperado:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                console.error('Error cargando resumen:', error);
                showToast('Error cargando resumen del dashboard: ' + error.message, 'error');
                
                // Inicializar con datos vacíos para evitar errores
                dashboardData = {
                    evaluation_summary: { total_completed: 0 },
                    latest_evaluation: null,
                    tasks_summary: { pending: 0, overdue: 0 },
                    coachee: {}
                };
                updateSummaryCards();
                updateUserInfo();
            }
        }

        // Update summary cards
        function updateSummaryCards() {
            if (!dashboardData) return;
            
            // Actualizar elementos del DOM de manera segura
            const totalEvaluationsElement = document.getElementById('totalEvaluations');
            const latestScoreElement = document.getElementById('latestScore');
            const pendingTasksElement = document.getElementById('pendingTasks');
            const overdueTasksElement = document.getElementById('overdueTasks');
            
            if (totalEvaluationsElement) {
                totalEvaluationsElement.textContent = 
                    (dashboardData.evaluation_summary && dashboardData.evaluation_summary.total_completed) || '0';
            }
            
            if (latestScoreElement) {
                latestScoreElement.textContent = 
                    (dashboardData.latest_evaluation && dashboardData.latest_evaluation.total_score) ? 
                    `${Math.round(dashboardData.latest_evaluation.total_score)}%` : '-';
            }
            
            if (pendingTasksElement) {
                pendingTasksElement.textContent = 
                    (dashboardData.tasks_summary && dashboardData.tasks_summary.pending) || '0';
            }
            
            if (overdueTasksElement) {
                overdueTasksElement.textContent = 
                    (dashboardData.tasks_summary && dashboardData.tasks_summary.overdue) || '0';
            }
        }

        // Update user info
        function updateUserInfo() {
            if (!dashboardData) return;
            
            const userInfoElement = document.getElementById('userInfo');
            if (!userInfoElement) return;
            
            const coacheeData = dashboardData.coachee;
            
            if (coacheeData && coacheeData.joined_at) {
                const joinedDate = new Date(coacheeData.joined_at).toLocaleDateString('es-ES');
                userInfoElement.textContent = `Miembro desde: ${joinedDate}`;
            } else if (coacheeData && coacheeData.email) {
                userInfoElement.textContent = coacheeData.email;
            } else {
                userInfoElement.textContent = 'Información no disponible';
            }
        }

        // Load evaluations data
        // Control de carga duplicada para evaluaciones
        let isLoadingEvaluations = false;
        let evaluationsLastLoaded = null;
        const EVALUATIONS_CACHE_DURATION = 30000; // 30 segundos
        
        async function loadEvaluations(forceRefresh = false) {
            // OPTIMIZACIÓN: Evitar carga duplicada
            if (isLoadingEvaluations) {
                console.log('⏳ Evaluations already loading, skipping duplicate request');
                return;
            }
            
            // OPTIMIZACIÓN: Usar cache si los datos son recientes
            if (!forceRefresh && evaluationsData && evaluationsLastLoaded) {
                const age = Date.now() - evaluationsLastLoaded;
                if (age < EVALUATIONS_CACHE_DURATION) {
                    console.log(`📦 Using cached evaluations data (age: ${Math.round(age/1000)}s)`);
                    renderAvailableEvaluationsLegacy();
                    return;
                }
            }
            
            isLoadingEvaluations = true;
            
            try {
                debugLog('🔍 Iniciando carga de evaluaciones...');
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluations`);
                
                debugLog(`📡 Response status: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                debugLog('📦 Datos de evaluaciones recibidos:', data);
                
                if (data && typeof data === 'object') {
                    evaluationsData = data; // Ahora contiene {available: {}, completed: []}
                    evaluationsLastLoaded = Date.now();
                    debugLog('✅ Renderizando evaluaciones disponibles...');
                    renderAvailableEvaluationsLegacy();
                } else {
                    console.error('Formato de datos inesperado:', data);
                    throw new Error('Formato de datos inesperado del servidor');
                }
            } catch (error) {
                debugLog('❌ Error cargando evaluaciones', error);
                console.error('Error cargando evaluaciones:', error);
                showToast('Error cargando evaluaciones: ' + error.message, 'error');
                
                // Inicializar con datos vacíos
                evaluationsData = { available: {}, completed: [] };
                
                // Show error in container
                document.getElementById('availableEvaluations').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando mis evaluaciones disponibles</p></div>';
            } finally {
                isLoadingEvaluations = false;
            }
        }

        // LEGACY: Función para cargar evaluaciones pendientes (ahora manejada por Alpine)
        // Esta función ya no se usa directamente, el wrapper global llama al método Alpine
        
        // Función para mostrar evaluaciones pendientes
        // LEGACY: Función original de display de evaluaciones pendientes
        function displayPendingEvaluationsLegacy() {
            const pendingEvaluations = window.pendingEvaluations || [];
            const container = document.getElementById('pendingEvaluationsSection');
            
            if (!container) {
                console.warn('Contenedor pendingEvaluationsSection no encontrado');
                return;
            }
            
            if (pendingEvaluations.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-check-circle text-success mb-3" style="font-size: 3rem;"></i>
                        <h5 class="text-muted mb-2">Sin Novedades Por Acá</h5>
                        <p class="text-muted small">No tienes evaluaciones pendientes en este momento</p>
                    </div>
                `;
                return;
            }
            
            console.log(`✅ Mostrando ${pendingEvaluations.length} evaluaciones pendientes`);
            
            let html = '<div class="row g-3">';
            
            pendingEvaluations.forEach(evaluation => {
                const assignedDate = new Date(evaluation.assigned_date).toLocaleDateString('es-ES');
                
                html += `
                    <div class="col-12">
                        <div class="card border-warning" style="border-width: 2px;">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start mb-3">
                                    <div class="flex-grow-1">
                                        <h5 class="card-title mb-1" style="color: #262626; font-weight: 600;">
                                            <i class="fas fa-clipboard-list text-warning me-2"></i>
                                            ${evaluation.assessment_title}
                                        </h5>
                                        <p class="card-text text-muted small mb-2">${evaluation.assessment_description || 'Evaluación asignada por tu coach'}</p>
                                        <div class="d-flex gap-3 flex-wrap">
                                            <span class="badge bg-light text-dark border">
                                                <i class="fas fa-question-circle me-1"></i>
                                                ${evaluation.total_questions} preguntas
                                            </span>
                                            <span class="badge bg-light text-dark border">
                                                <i class="fas fa-calendar me-1"></i>
                                                Asignada: ${assignedDate}
                                            </span>
                                            <span class="badge bg-light text-dark border">
                                                <i class="fas fa-user-tie me-1"></i>
                                                ${evaluation.coach_name}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-warning w-100" onclick="startPendingEvaluation(${evaluation.assessment_id})" style="font-weight: 600;">
                                    <i class="fas fa-play me-2"></i>Completar Evaluación
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // Función para iniciar una evaluación pendiente
        async function startPendingEvaluation(assessmentId) {
            try {
                console.log(`🚀 Iniciando evaluación pendiente: ${assessmentId}`);
                
                // Usar la función existente startEvaluation que ya maneja todo el flujo
                await startEvaluation(assessmentId);
                
                console.log(`✅ Evaluación ${assessmentId} iniciada correctamente`);
            } catch (error) {
                console.error('❌ Error iniciando evaluación:', error);
                showToast('Error al iniciar la evaluación: ' + error.message, 'error');
            }
        }

        // Helper function to get assertativeness level
        function getAssertativenessLevel(score) {
            if (score >= 80) return 'Muy Asertivo';
            if (score >= 65) return 'Asertivo';
            if (score >= 50) return 'Moderadamente Asertivo';
            if (score >= 35) return 'Poco Asertivo';
            return 'Muy Poco Asertivo';
        }

        // NOTA: evaluationCategories ahora se define en Alpine y se expone como window.evaluationCategories
        // La constante local ha sido eliminada para evitar conflictos

        // Function to classify evaluation by category
        function classifyEvaluation(evaluation) {
            const title = evaluation.title.toLowerCase();
            const description = (evaluation.description || '').toLowerCase();
            const searchText = `${title} ${description}`;
            
            const categories = window.evaluationCategories || {};
            
            for (const [category, data] of Object.entries(categories)) {
                if (category === 'Otros') continue;
                
                for (const keyword of data.keywords) {
                    if (searchText.includes(keyword)) {
                        return category;
                    }
                }
            }
            
            return 'Otros';
        }

        // Toggle category function
        function toggleCategory(categoryId, headerElement) {
            const categoryGrid = document.getElementById(categoryId);
            const icon = document.getElementById(`icon-${categoryId}`);
            const isExpanded = categoryGrid.getAttribute('data-expanded') === 'true';
            
            if (isExpanded) {
                // Colapsar: primero opacity, luego display none
                categoryGrid.style.opacity = '0';
                categoryGrid.style.maxHeight = '0px';
                setTimeout(() => {
                    categoryGrid.style.display = 'none';
                }, 300); // Esperar a que termine la transición
                categoryGrid.style.marginBottom = '0px';
                icon.style.transform = 'rotate(-90deg)';
                categoryGrid.setAttribute('data-expanded', 'false');
            } else {
                // Expandir: primero display, luego opacity
                categoryGrid.style.display = 'grid';
                setTimeout(() => {
                    categoryGrid.style.maxHeight = '5000px';
                    categoryGrid.style.opacity = '1';
                }, 10); // Pequeño delay para que la transición funcione
                categoryGrid.style.marginBottom = '30px';
                icon.style.transform = 'rotate(0deg)';
                categoryGrid.setAttribute('data-expanded', 'true');
            }
        }

        // Expand all categories
        function expandAllCategories(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const allCategories = container.querySelectorAll('.assessments-grid[data-expanded="false"]');
            allCategories.forEach(grid => {
                const categoryId = grid.id;
                const icon = document.getElementById(`icon-${categoryId}`);
                
                grid.style.display = 'grid';
                setTimeout(() => {
                    grid.style.maxHeight = '5000px';
                    grid.style.opacity = '1';
                }, 10);
                grid.style.marginBottom = '30px';
                if (icon) icon.style.transform = 'rotate(0deg)';
                grid.setAttribute('data-expanded', 'true');
            });
        }

        // Collapse all categories
        function collapseAllCategories(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;
            
            const allCategories = container.querySelectorAll('.assessments-grid[data-expanded="true"]');
            allCategories.forEach(grid => {
                const categoryId = grid.id;
                const icon = document.getElementById(`icon-${categoryId}`);
                
                grid.style.opacity = '0';
                grid.style.maxHeight = '0px';
                setTimeout(() => {
                    grid.style.display = 'none';
                }, 300);
                grid.style.marginBottom = '0px';
                if (icon) icon.style.transform = 'rotate(-90deg)';
                grid.setAttribute('data-expanded', 'false');
            });
        }

        // Render available evaluations
        // Función optimizada para renderizar evaluaciones disponibles con diseño moderno y compacto
        function renderAvailableEvaluationsLegacy() {
            console.log('🔥 renderAvailableEvaluationsLegacy INICIANDO...');
            
            const evaluationsData = window.evaluationsData;
            const container = document.getElementById('availableEvaluations');
            
            console.log('🔍 Container:', container);
            console.log('🔍 window.evaluationsData:', evaluationsData);
            
            if (!container) {
                console.error('❌ Container availableEvaluations no encontrado');
                return;
            }
            
            // Verificar si hay un mensaje específico (sin coach o sin invitación)
            if (evaluationsData && evaluationsData.message) {
                container.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 3rem 1rem;">
                        <div style="font-size: 3rem; color: #9ca3af; margin-bottom: 1rem;">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <div style="color: #000000; font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">Información</div>
                        <div style="color: #000000; font-size: 0.875rem;">${evaluationsData.message}</div>
                    </div>
                `;
                return;
            }
            
            if (!evaluationsData || !evaluationsData.available || Object.keys(evaluationsData.available).length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="text-align: center; padding: 3rem 1rem;">
                        <div style="font-size: 3rem; color: #9ca3af; margin-bottom: 1rem;">
                            <i class="fas fa-inbox"></i>
                        </div>
                        <div style="color: #000000; font-size: 1.125rem; font-weight: 600; margin-bottom: 0.5rem;">Sin evaluaciones disponibles</div>
                        <div style="color: #000000; font-size: 0.875rem;">No tienes evaluaciones disponibles en este momento</div>
                    </div>
                `;
                return;
            }
            
            // Categorize evaluations
            const categorizedEvaluations = {};
            Object.values(evaluationsData.available).forEach(evaluation => {
                const category = classifyEvaluation(evaluation);
                if (!categorizedEvaluations[category]) {
                    categorizedEvaluations[category] = [];
                }
                categorizedEvaluations[category].push(evaluation);
            });
            
            // Clear container
            container.innerHTML = '';
            
            console.log('🔍 Categorized evaluations:', categorizedEvaluations);
            console.log('🔍 window.evaluationCategories:', window.evaluationCategories);
            
            // Render each category
            Object.entries(categorizedEvaluations).forEach(([categoryName, evaluations]) => {
                const category = window.evaluationCategories ? window.evaluationCategories[categoryName] : null;
                
                if (!category) {
                    console.error(`❌ Categoría ${categoryName} no encontrada`);
                    return;
                }
                
                const categorySection = document.createElement('div');
                categorySection.className = 'assessment-category';
                categorySection.style.marginBottom = '1.5rem';
                const categoryId = `category-${categoryName.replace(/\s+/g, '-')}`;
                
                categorySection.innerHTML = `
                    <div class="section-header-eval" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); padding: 1rem 1.25rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 2px solid ${category.color};" onclick="toggleCategory('${categoryId}', this)">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 0.75rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; flex: 1; min-width: 0;">
                                <div style="width: 3rem; height: 3rem; background: linear-gradient(135deg, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.3) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 2px 8px ${category.color}40; border: 2px solid ${category.color};">
                                    <i class="fas ${category.icon}" style="color: ${category.color}; font-size: 1.25rem;"></i>
                                </div>
                                <div style="flex: 1; min-width: 0;">
                                    <h4 style="color: #000000; font-size: 1.0625rem; font-weight: 700; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                        ${categoryName}
                                    </h4>
                                    <p style="color: #000000; font-size: 0.8125rem; margin: 0; font-weight: 500;">
                                        ${evaluations.length} ${evaluations.length === 1 ? 'evaluación disponible' : 'evaluaciones disponibles'}
                                    </p>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0;">
                                <span style="background: ${category.color}; color: white; padding: 0.375rem 0.875rem; border-radius: 20px; font-size: 0.8125rem; font-weight: 700; box-shadow: 0 2px 4px ${category.color}50;">${evaluations.length}</span>
                                <i class="fas fa-chevron-down" id="icon-${categoryId}" style="color: ${category.color}; font-size: 1.125rem; transition: transform 0.3s ease; transform: rotate(-90deg); filter: drop-shadow(0 1px 2px rgba(0,0,0,0.15));"></i>
                            </div>
                        </div>
                    </div>
                    <div class="assessments-grid" id="${categoryId}" data-expanded="false" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 0; overflow: hidden; max-height: 0; opacity: 0; transition: max-height 0.5s ease, opacity 0.3s ease;">
                    </div>
                `;
                
                container.appendChild(categorySection);
                
                const grid = document.getElementById(categoryId);
                
                evaluations.forEach(evaluation => {
                    const card = document.createElement('div');
                    card.className = 'assessment-card';
                    card.style.cssText = `
                        background: white;
                        border-radius: 12px;
                        overflow: hidden;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        border: 1px solid #e5e7eb;
                        cursor: pointer;
                        height: 100%;
                        display: flex;
                        flex-direction: column;
                    `;
                    
                    card.innerHTML = `
                        <div style="position: relative; width: 100%; padding-top: 45%; background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%); overflow: hidden; box-shadow: inset 0 -1px 0 rgba(0,0,0,0.1);">
                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.02) 100%);">
                                <i class="fas ${category.icon}" style="font-size: 2.75rem; color: ${category.color};"></i>
                            </div>
                            <div style="position: absolute; top: 0.75rem; right: 0.75rem; background: rgba(255,255,255,0.95); backdrop-filter: blur(8px); padding: 0.375rem 0.75rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); border: 2px solid ${category.color};">
                                <span style="color: ${category.color}; font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; gap: 0.375rem;">
                                    <i class="fas fa-question-circle"></i>
                                    ${evaluation.total_questions} preguntas
                                </span>
                            </div>
                        </div>
                        <div style="padding: 1.125rem; flex: 1; display: flex; flex-direction: column; background: #ffffff;">
                            <h5 style="font-size: 1rem; font-weight: 700; color: #000000; margin: 0 0 0.625rem 0; line-height: 1.35; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                ${evaluation.title}
                            </h5>
                            <p style="font-size: 0.8125rem; color: #000000; margin: 0 0 1rem 0; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; flex: 1;">
                                ${evaluation.description || 'Evaluación diseñada para medir tus competencias profesionales'}
                            </p>
                            <div style="display: flex; align-items: center; justify-content: space-between; gap: 0.625rem; padding-top: 0.875rem; border-top: 2px solid #f3f4f6;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.8125rem; color: #000000; font-weight: 500; flex: 1; min-width: 0;">
                                    <div style="width: 1.75rem; height: 1.75rem; background: linear-gradient(135deg, ${category.color}20 0%, ${category.color}10 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <i class="fas fa-user" style="color: ${category.color}; font-size: 0.75rem;"></i>
                                    </div>
                                    <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${evaluation.coach_name || 'Coach'}</span>
                                </div>
                                <button onclick="startEvaluation('${evaluation.id}')" style="background: linear-gradient(135deg, ${category.color} 0%, ${category.color}dd 100%); border: none; padding: 0.625rem 1.125rem; border-radius: 8px; color: white; font-weight: 700; font-size: 0.8125rem; transition: all 0.2s ease; white-space: nowrap; box-shadow: 0 2px 6px ${category.color}40; flex-shrink: 0;">
                                    <i class="fas fa-play" style="font-size: 0.75rem; margin-right: 0.5rem;"></i>
                                    Comenzar
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // Hover effects
                    card.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-6px)';
                        this.style.boxShadow = `0 12px 32px ${category.color}35`;
                        this.style.borderColor = category.color;
                    });
                    
                    card.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.08)';
                        this.style.borderColor = '#e5e7eb';
                    });
                    
                    // Button hover
                    const button = card.querySelector('button');
                    button.addEventListener('mouseenter', function() {
                        this.style.transform = 'scale(1.05)';
                        this.style.boxShadow = `0 6px 16px ${category.color}50`;
                        this.style.filter = 'brightness(1.1)';
                    });
                    
                    button.addEventListener('mouseleave', function() {
                        this.style.transform = 'scale(1)';
                        this.style.boxShadow = `0 2px 6px ${category.color}40`;
                        this.style.filter = 'brightness(1)';
                    });
                    
                    grid.appendChild(card);
                });
            });
        }

        // Render completed evaluations
        function renderCompletedEvaluations() {
            const container = document.getElementById('completedEvaluations');
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                container.innerHTML = '<div class="unified-empty-state"><i class="fas fa-clipboard-list"></i><p>Aún no has completado ninguna evaluación</p></div>';
                return;
            }
            
            let html = '<div class="results-list">';
            evaluationsData.completed.forEach(evaluation => {
                const score = evaluation.score || 0;
                
                // Usar el título real del assessment o un título por defecto
                const assessmentTitle = evaluation.assessment_title || 'Evaluación completada';
                
                // Función para obtener el nivel basado en el tipo de evaluación
                function getEvaluationLevel(score, title) {
                    if (title && title.includes('DISC')) {
                        // Para evaluaciones DISC, mostrar información de personalidad
                        if (score >= 80) return 'Perfil Dominante';
                        if (score >= 60) return 'Perfil Influyente';
                        if (score >= 40) return 'Perfil Estable';
                        return 'Perfil Concienzudo';
                    } else if (title && title.includes('Preparación para crecer 2026')) {
                        // Para evaluaciones de Preparación para crecer 2026
                        if (score >= 85) return 'Preparado';      // Verde
                        if (score >= 60) return 'En progreso';    // Amarillo
                        return 'Alta dependencia';                // Rojo
                    } else {
                        // Para evaluaciones de Asertividad, usar la función existente
                        return getAssertativenessLevel(score);
                    }
                }
                
                html += `
                    <div class="unified-card">
                        <div class="unified-card-header">
                            <h5 class="unified-card-title">${assessmentTitle}</h5>
                            <div class="score-display">
                                <span class="score-value">${Math.round(score)}%</span>
                            </div>
                        </div>
                        <div class="unified-card-body">
                            <div class="evaluation-level">${getEvaluationLevel(score, assessmentTitle)}</div>
                            <div class="evaluation-description">${evaluation.result_text || 'Evaluación completada con éxito'}</div>
                            <div class="evaluation-meta">
                                <span class="meta-date">
                                    <i class="fas fa-calendar-alt"></i>
                                    ${formatDate(evaluation.completed_at)}
                                </span>
                            </div>
                        </div>
                        <div class="unified-card-footer">
                            <button class="unified-btn unified-btn-primary" onclick="viewEvaluationDetails(${evaluation.id})">
                                <i class="fas fa-eye"></i>
                                Ver Detalles
                            </button>
                        </div>
                    </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }

        // LEGACY: Función original de renderizado - Renombrada para compatibilidad
        function renderCompletedEvaluationsLegacy() {
            const container = document.getElementById('completedEvaluationsSection');
            
            if (!evaluationsData || !evaluationsData.completed || evaluationsData.completed.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 3rem 1.25rem;">
                        <div style="font-size: 4rem; color: #9ca3af; margin-bottom: 1rem;">
                            <i class="fas fa-clipboard-check"></i>
                        </div>
                        <h3 style="color: #000000; font-size: 1.125rem; margin-bottom: 0.5rem; font-weight: 700;">
                            Sin evaluaciones completadas
                        </h3>
                        <p style="color: #000000; font-size: 0.875rem;">
                            Aún no has completado ninguna evaluación
                        </p>
                    </div>
                `;
                return;
            }
            
            // Categorize completed evaluations
            const categorizedEvaluations = {};
            evaluationsData.completed.forEach(evaluation => {
                const title = evaluation.assessment_title || 'Evaluación completada';
                let category = 'Otros';
                
                if (title.toLowerCase().includes('disc') || title.toLowerCase().includes('personalidad')) {
                    category = 'Personalidad';
                } else if (title.toLowerCase().includes('liderazgo') || title.toLowerCase().includes('líder')) {
                    category = 'Liderazgo';
                } else if (title.toLowerCase().includes('emocional') || title.toLowerCase().includes('asertividad')) {
                    category = 'Inteligencia Emocional';
                } else if (title.toLowerCase().includes('equipo') || title.toLowerCase().includes('colaboración')) {
                    category = 'Trabajo en Equipo';
                } else if (title.toLowerCase().includes('empresarial') || title.toLowerCase().includes('crecer') || title.toLowerCase().includes('2026')) {
                    category = 'Crecimiento Empresarial';
                }
                
                if (!categorizedEvaluations[category]) {
                    categorizedEvaluations[category] = [];
                }
                categorizedEvaluations[category].push(evaluation);
            });
            
            // Clear container
            container.innerHTML = '';
            
            // Render each category
            Object.entries(categorizedEvaluations).forEach(([categoryName, evaluations]) => {
                const category = window.evaluationCategories ? window.evaluationCategories[categoryName] : null;
                
                if (!category) {
                    console.error(`❌ Categoría ${categoryName} no encontrada en renderCompletedEvaluationsLegacy`);
                    return;
                }
                
                const categorySection = document.createElement('div');
                categorySection.className = 'assessment-category';
                categorySection.style.marginBottom = '1.5rem';
                const categoryId = `completed-category-${categoryName.replace(/\s+/g, '-')}`;
                
                categorySection.innerHTML = `
                    <div class="section-header-eval" style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); padding: 1rem 1.25rem; border-radius: 12px; margin-bottom: 1rem; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(0,0,0,0.1); border: 2px solid ${category.color};" onclick="toggleCategory('${categoryId}', this)">
                        <div style="display: flex; justify-content: space-between; align-items: center; gap: 0.75rem;">
                            <div style="display: flex; align-items: center; gap: 1rem; flex: 1; min-width: 0;">
                                <div style="width: 3rem; height: 3rem; background: linear-gradient(135deg, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.3) 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 2px 8px ${category.color}40; border: 2px solid ${category.color};">
                                    <i class="fas ${category.icon}" style="color: ${category.color}; font-size: 1.25rem;"></i>
                                </div>
                                <div style="flex: 1; min-width: 0;">
                                    <h4 style="color: #000000; font-size: 1.0625rem; font-weight: 700; margin: 0; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                        ${categoryName}
                                    </h4>
                                    <p style="color: #000000; font-size: 0.8125rem; margin: 0; font-weight: 500;">
                                        ${evaluations.length} ${evaluations.length === 1 ? 'evaluación completada' : 'evaluaciones completadas'}
                                    </p>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 0.75rem; flex-shrink: 0;">
                                <span style="background: ${category.color}; color: white; padding: 0.375rem 0.875rem; border-radius: 20px; font-size: 0.8125rem; font-weight: 700; box-shadow: 0 2px 4px ${category.color}50;">${evaluations.length}</span>
                                <i class="fas fa-chevron-down" id="icon-${categoryId}" style="color: ${category.color}; font-size: 1.125rem; transition: transform 0.3s ease; transform: rotate(-90deg); filter: drop-shadow(0 1px 2px rgba(0,0,0,0.15));"></i>
                            </div>
                        </div>
                    </div>
                    <div class="assessments-grid" id="${categoryId}" data-expanded="false" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem; margin-bottom: 0; overflow: hidden; max-height: 0; opacity: 0; transition: max-height 0.5s ease, opacity 0.3s ease;">
                    </div>
                `;
                
                container.appendChild(categorySection);
                
                const grid = document.getElementById(categoryId);
                
                evaluations.forEach(evaluation => {
                    const score = evaluation.score || 0;
                    const assessmentTitle = evaluation.assessment_title || 'Evaluación completada';
                    
                    const card = document.createElement('div');
                    card.className = 'assessment-card';
                    card.style.cssText = `
                        background: white;
                        border-radius: 12px;
                        overflow: hidden;
                        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
                        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                        border: 1px solid #e5e7eb;
                        cursor: pointer;
                        height: 100%;
                        display: flex;
                        flex-direction: column;
                    `;
                    
                    card.innerHTML = `
                        <div style="position: relative; width: 100%; padding-top: 45%; background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%); overflow: hidden; box-shadow: inset 0 -1px 0 rgba(0,0,0,0.1);">
                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle at center, transparent 0%, rgba(0,0,0,0.02) 100%);">
                                <i class="fas fa-check-circle" style="font-size: 2.75rem; color: ${category.color};"></i>
                            </div>
                            <div style="position: absolute; top: 0.75rem; right: 0.75rem; background: rgba(255,255,255,0.95); backdrop-filter: blur(8px); padding: 0.375rem 0.75rem; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); border: 2px solid ${category.color};">
                                <span style="color: ${category.color}; font-size: 0.75rem; font-weight: 700; display: flex; align-items: center; gap: 0.375rem;">
                                    <i class="fas fa-chart-bar"></i>
                                    ${Math.round(score)}%
                                </span>
                            </div>
                        </div>
                        <div style="padding: 1.125rem; flex: 1; display: flex; flex-direction: column; background: #ffffff;">
                            <h5 style="font-size: 1rem; font-weight: 700; color: #000000; margin: 0 0 0.625rem 0; line-height: 1.35; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">
                                ${assessmentTitle}
                            </h5>
                            <p style="font-size: 0.8125rem; color: #000000; margin: 0 0 1rem 0; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; flex: 1;">
                                ${evaluation.result_text || 'Evaluación completada con éxito'}
                            </p>
                            <div style="display: flex; align-items: center; justify-content: space-between; gap: 0.625rem; padding-top: 0.875rem; border-top: 2px solid #f3f4f6;">
                                <div style="display: flex; align-items: center; gap: 0.5rem; font-size: 0.8125rem; color: #000000; font-weight: 500; flex: 1; min-width: 0;">
                                    <div style="width: 1.75rem; height: 1.75rem; background: linear-gradient(135deg, ${category.color}20 0%, ${category.color}10 100%); border-radius: 6px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <i class="fas fa-calendar" style="color: ${category.color}; font-size: 0.75rem;"></i>
                                    </div>
                                    <span style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">${formatDate(evaluation.completed_at)}</span>
                                </div>
                                <button onclick="viewEvaluationDetails(${evaluation.id})" style="background: linear-gradient(135deg, ${category.color} 0%, ${category.color}dd 100%); border: none; padding: 0.625rem 1.125rem; border-radius: 8px; color: white; font-weight: 700; font-size: 0.8125rem; transition: all 0.2s ease; white-space: nowrap; box-shadow: 0 2px 6px ${category.color}40; flex-shrink: 0;">
                                    <i class="fas fa-eye" style="font-size: 0.75rem; margin-right: 0.5rem;"></i>
                                    Ver Detalles
                                </button>
                            </div>
                        </div>
                    `;
                    
                    // Hover effects
                    card.addEventListener('mouseenter', function() {
                        this.style.transform = 'translateY(-6px)';
                        this.style.boxShadow = `0 12px 32px ${category.color}35`;
                        this.style.borderColor = category.color;
                    });
                    
                    card.addEventListener('mouseleave', function() {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = '0 1px 3px rgba(0, 0, 0, 0.08)';
                        this.style.borderColor = '#e5e7eb';
                    });
                    
                    grid.appendChild(card);
                });
            });
        }

        // LEGACY: Variables de control de tasks (ahora en Alpine state)
        // Mantenidas por compatibilidad pero ya no se usan
        let isLoadingTasks = false;
        let tasksLastLoaded = null;
        const TASKS_CACHE_DURATION = 30000;
        
        // LEGACY: Función de carga de tasks (ahora manejada por Alpine)
        // Esta función ya no se usa directamente, el wrapper global llama al método Alpine
        
        // LEGACY: Función original de renderizado de tasks
        function renderTasksLegacy() {
            const tasksData = window.tasksData || [];
            const container = document.getElementById('tasksContainer');
            
            if (!tasksData || tasksData.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5" style="color: #94a3b8;">
                        <i class="fas fa-clipboard-list" style="font-size: 3rem; opacity: 0.3; margin-bottom: 1rem;"></i>
                        <p class="mb-0" style="font-size: 0.95rem; font-weight: 500;">No hay acciones asignadas</p>
                        <small style="font-size: 0.8rem; color: #cbd5e1;">Tu coach aún no ha creado tareas para ti</small>
                    </div>
                `;
                return;
            }
            
            // Definir colores para prioridades
            const priorityColors = {
                high: { bg: '#fef2f2', color: '#dc2626', icon: 'fa-exclamation-circle' },
                medium: { bg: '#fffbeb', color: '#f59e0b', icon: 'fa-clock' },
                low: { bg: '#f0f9ff', color: '#0284c7', icon: 'fa-info-circle' }
            };
            
            // Definir colores para estados
            const statusColors = {
                pending: { bg: '#f8fafc', color: '#64748b', label: 'Pendiente' },
                in_progress: { bg: '#eff6ff', color: '#3b82f6', label: 'En progreso' },
                completed: { bg: '#f0fdf4', color: '#10b981', label: 'Completada' },
                blocked: { bg: '#fef2f2', color: '#ef4444', label: 'Bloqueada' }
            };
            
            // Definir iconos para categorías
            const categoryIcons = {
                desarrollo_personal: 'fa-user-plus',
                proyecto: 'fa-project-diagram',
                aprendizaje: 'fa-graduation-cap',
                comunicacion: 'fa-comments',
                liderazgo: 'fa-crown',
                default: 'fa-tasks'
            };
            
            // Actualizar contador de tareas
            const completedCount = tasksData.filter(t => t.status === 'completed').length;
            const totalCount = tasksData.length;
            
            document.getElementById('completedTasks').textContent = completedCount;
            document.getElementById('totalTasks').textContent = totalCount;
            document.getElementById('tasksCounter').style.display = 'block';
            
            let html = '<div style="display: grid; gap: 1rem;">';
            
            tasksData.forEach(task => {
                const priority = priorityColors[task.priority] || priorityColors.low;
                const status = statusColors[task.status] || statusColors.pending;
                const categoryIcon = categoryIcons[task.category] || categoryIcons.default;
                const progress = Math.round(task.progress_percentage || 0);
                
                // Calcular días restantes
                let daysInfo = '';
                if (task.due_date) {
                    const today = new Date();
                    const dueDate = new Date(task.due_date);
                    const diffTime = dueDate - today;
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    
                    if (diffDays < 0) {
                        daysInfo = `<span style="color: #dc2626; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-exclamation-triangle"></i> Vencida</span>`;
                    } else if (diffDays === 0) {
                        daysInfo = `<span style="color: #f59e0b; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-clock"></i> Vence hoy</span>`;
                    } else if (diffDays <= 3) {
                        daysInfo = `<span style="color: #f59e0b; font-size: 0.75rem; font-weight: 600;"><i class="fas fa-hourglass-half"></i> ${diffDays} días</span>`;
                    } else {
                        daysInfo = `<span style="color: #64748b; font-size: 0.75rem;"><i class="fas fa-calendar"></i> ${diffDays} días</span>`;
                    }
                }
                
                html += `
                    <div style="background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border: 1px solid #e2e8f0; border-left: 4px solid ${priority.color}; border-radius: 12px; padding: 1.25rem; box-shadow: 0 2px 6px rgba(0,0,0,0.05); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);" 
                         onmouseover="this.style.boxShadow='0 8px 20px rgba(102, 126, 234, 0.15)'; this.style.transform='translateY(-4px)'; this.style.borderLeftWidth='5px';" 
                         onmouseout="this.style.boxShadow='0 2px 6px rgba(0,0,0,0.05)'; this.style.transform='translateY(0)'; this.style.borderLeftWidth='4px';">
                        
                        <!-- Header: Título y Badges -->
                        <div style="display: flex; align-items: start; justify-content: space-between; gap: 1rem; margin-bottom: 0.75rem;">
                            <div style="flex: 1; min-width: 0;">
                                <div style="display: flex; align-items: center; gap: 0.625rem; margin-bottom: 0.375rem;">
                                    <div style="width: 32px; height: 32px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                        <i class="fas ${categoryIcon}" style="font-size: 0.875rem; color: #fbbf24;"></i>
                                    </div>
                                    <h6 style="margin: 0; font-size: 1rem; font-weight: 700; color: #0f172a; line-height: 1.3; letter-spacing: -0.01em;">
                                        ${task.title}
                                    </h6>
                                </div>
                            </div>
                            <div style="display: flex; gap: 0.5rem; flex-shrink: 0;">
                                <span style="background: ${priority.bg}; color: ${priority.color}; padding: 0.3rem 0.625rem; border-radius: 6px; font-size: 0.7rem; font-weight: 700; white-space: nowrap; letter-spacing: 0.02em; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                                    <i class="fas ${priority.icon}" style="font-size: 0.65rem;"></i>
                                    ${task.priority.charAt(0).toUpperCase() + task.priority.slice(1)}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Descripción -->
                        ${task.description ? `
                        <p style="margin: 0 0 1rem 0; padding-left: 2.5rem; font-size: 0.875rem; color: #475569; line-height: 1.6; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
                            ${task.description}
                        </p>
                        ` : ''}
                        
                        <!-- Progreso Simple con Verde -->
                        <div style="margin-bottom: 1rem; padding: 0.875rem; background: white; border-radius: 8px; border: 1px solid #e5e7eb;">
                            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span style="font-size: 0.8125rem; color: #6b7280; font-weight: 600;">
                                    Progreso
                                </span>
                                <span style="font-size: 0.875rem; font-weight: 700; color: #10b981;">
                                    ${progress}%
                                </span>
                            </div>
                            <!-- Barra de progreso verde simple -->
                            <div style="height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden;">
                                <div style="width: ${progress}%; height: 100%; background: #10b981 !important; border-radius: 4px; transition: width 0.6s ease;"></div>
                            </div>
                        </div>
                            <!-- Indicadores de milestone -->
                            <div style="display: flex; justify-content: space-between; margin-top: 0.375rem; padding: 0 2px;">
                                <span style="font-size: 0.65rem; color: ${progress >= 25 ? '#10b981' : '#94a3b8'}; font-weight: 600;">
                                    ${progress >= 25 ? '✓' : '○'} 25%
                                </span>
                                <span style="font-size: 0.65rem; color: ${progress >= 50 ? '#10b981' : '#94a3b8'}; font-weight: 600;">
                                    ${progress >= 50 ? '✓' : '○'} 50%
                                </span>
                                <span style="font-size: 0.65rem; color: ${progress >= 75 ? '#10b981' : '#94a3b8'}; font-weight: 600;">
                                    ${progress >= 75 ? '✓' : '○'} 75%
                                </span>
                                <span style="font-size: 0.65rem; color: ${progress === 100 ? '#10b981' : '#94a3b8'}; font-weight: 600;">
                                    ${progress === 100 ? '✓' : '○'} 100%
                                </span>
                            </div>
                        </div>
                        
                        <!-- Footer: Metadata y Acción -->
                        <div style="display: flex; align-items: center; justify-content: space-between; gap: 0.75rem; padding-top: 0.75rem; border-top: 1px solid #e2e8f0;">
                            <div style="display: flex; align-items: center; gap: 0.75rem; flex-wrap: wrap; font-size: 0.75rem; color: #64748b;">
                                <span style="background: ${status.bg}; color: ${status.color}; padding: 0.3rem 0.5rem; border-radius: 5px; font-weight: 700; display: flex; align-items: center; gap: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.4rem;"></i>
                                    ${status.label}
                                </span>
                                ${daysInfo}
                                ${task.coach?.name ? `<span style="display: flex; align-items: center; gap: 0.375rem;"><i class="fas fa-user-tie" style="font-size: 0.7rem; color: #667eea;"></i> ${task.coach.name.split(' ')[0]}</span>` : ''}
                            </div>
                            <button type="button" class="btn btn-sm" 
                                    style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 0.5rem 1rem; font-size: 0.8rem; font-weight: 700; border-radius: 8px; transition: all 0.3s; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); letter-spacing: 0.01em;"
                                    onmouseover="this.style.background='linear-gradient(135deg, #5568d3 0%, #6a3e9a 100%)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(102, 126, 234, 0.4)';"
                                    onmouseout="this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(102, 126, 234, 0.3)';"
                                    onclick="event.stopPropagation(); openTaskProgressModal(${task.id});">
                                <i class="fas fa-pen" style="font-size: 0.75rem; margin-right: 0.375rem;"></i>
                                Actualizar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            container.innerHTML = html;
        }

        // LEGACY: Load evaluation history - Renombrada para compatibilidad (ahora manejada por Alpine)
        // Esta función ya no se usa directamente, el wrapper global llama al método Alpine
        // Se mantiene por compatibilidad con código legacy que pueda referenciarla

        // FUNCIÓN renderProgressChart ELIMINADA POR PETICIÓN DEL USUARIO
        

        // FUNCIÓN createBasicTestChart ELIMINADA POR PETICIÓN DEL USUARIO

        // TEST CHART FUNCTION - Para probar visualización
        // FUNCIÓN renderTestProgressChart ELIMINADA POR PETICIÓN DEL USUARIO
        // FUNCIÓN createSecondChart ELIMINADA - Canvas no existe en el DOM

        // NUEVO: Crear gráfico de tendencia de progreso
        let progressTrendChart = null;
        
        async function createProgressTrendChart() {
            console.log('📈 PROGRESS-TREND: Creating progress trend chart...');
            
            try {
                // Obtener el canvas
                const canvas = document.getElementById('progressTrendChart');
                if (!canvas) {
                    console.error('❌ Canvas progressTrendChart no encontrado');
                    return;
                }
                
                // Verificar Chart.js
                if (typeof Chart === 'undefined') {
                    console.error('❌ Chart.js no está disponible');
                    return;
                }
                
                // Obtener datos del historial de evaluaciones
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-history`);
                const data = await response.json();
                
                console.log('📊 PROGRESS-TREND: API Response:', {
                    ok: response.ok,
                    success: data.success,
                    historyLength: data.history?.length,
                    totalEvaluations: data.total,
                    data: data
                });
                
                if (!response.ok || !data.success || !data.history || data.history.length === 0) {
                    console.log('⚠️ No hay datos de historial disponibles:', data);
                    canvas.parentElement.innerHTML = `
                        <div class="empty-state text-center py-5">
                            <i class="fas fa-chart-line text-muted mb-3" style="font-size: 3rem;"></i>
                            <h5 class="text-muted">Sin datos suficientes</h5>
                            <p class="text-muted small">Completa más evaluaciones para ver tu tendencia de progreso</p>
                        </div>
                    `;
                    return;
                }
                
                // Preparar datos para el gráfico - ordenar cronológicamente
                const history = data.history.slice().sort((a, b) => 
                    new Date(a.completed_at) - new Date(b.completed_at)
                );
                
                console.log('📊 PROGRESS-TREND: History data received:', history);
                
                // Crear puntos de datos con fechas y porcentajes
                const dataPoints = history.map(item => {
                    const date = new Date(item.completed_at);
                    // Calcular porcentaje: (score / total_questions) * 100
                    const percentage = item.total_questions > 0 
                        ? (item.score / item.total_questions) * 100 
                        : 0;
                    
                    return {
                        x: date,
                        y: percentage,
                        label: item.assessment?.title || 'Sin título',
                        score: item.score,
                        totalQuestions: item.total_questions
                    };
                });
                
                console.log('📊 PROGRESS-TREND: Data points created:', dataPoints);
                
                // Crear un solo dataset con todas las evaluaciones conectadas cronológicamente
                const datasets = [{
                    label: 'Progreso General',
                    data: dataPoints,
                    backgroundColor: 'rgba(102, 126, 234, 0.7)',
                    borderColor: '#667eea',
                    borderWidth: 2,
                    borderRadius: 8,
                    barThickness: 'flex',
                    maxBarThickness: 60
                }];
                
                console.log('📊 PROGRESS-TREND: Dataset created with', dataPoints.length, 'points');
                
                const ctx = canvas.getContext('2d');
                
                // Destruir gráfico anterior si existe
                if (progressTrendChart) {
                    progressTrendChart.destroy();
                }
                
                // Crear nuevo gráfico
                progressTrendChart = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: {
                            mode: 'nearest',
                            axis: 'x',
                            intersect: false
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    usePointStyle: true,
                                    padding: 15,
                                    font: {
                                        size: 12,
                                        family: "'Segoe UI', Tahoma, Geneva, Verdana, sans-serif"
                                    }
                                }
                            },
                            tooltip: {
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: '#667eea',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false,
                                callbacks: {
                                    title: function(context) {
                                        const dataPoint = context[0].raw;
                                        return dataPoint.label || 'Evaluación';
                                    },
                                    label: function(context) {
                                        const dataPoint = context.raw;
                                        return [
                                            `Porcentaje: ${context.parsed.y.toFixed(1)}%`,
                                            `Puntaje: ${dataPoint.score}/${dataPoint.totalQuestions}`
                                        ];
                                    },
                                    afterLabel: function(context) {
                                        const date = new Date(context.parsed.x);
                                        return `Fecha: ${date.toLocaleDateString('es-ES', { 
                                            day: 'numeric', 
                                            month: 'short', 
                                            year: 'numeric' 
                                        })}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                type: 'time',
                                time: {
                                    unit: 'day',
                                    displayFormats: {
                                        day: 'dd/MM'
                                    },
                                    tooltipFormat: 'dd/MM/yyyy'
                                },
                                title: {
                                    display: true,
                                    text: 'Fecha de Evaluación',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    maxRotation: 45,
                                    minRotation: 0,
                                    autoSkip: true,
                                    maxTicksLimit: 10
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            },
                            y: {
                                beginAtZero: true,
                                max: 100,
                                title: {
                                    display: true,
                                    text: 'Porcentaje de Respuestas Correctas',
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                },
                                ticks: {
                                    callback: function(value) {
                                        return value.toFixed(0) + '%';
                                    }
                                },
                                grid: {
                                    display: true,
                                    color: 'rgba(0, 0, 0, 0.05)'
                                }
                            }
                        }
                    }
                });
                
                console.log('✅ PROGRESS-TREND: Gráfico creado exitosamente con', datasets.length, 'series de datos');
                
            } catch (error) {
                console.error('❌ PROGRESS-TREND ERROR:', error);
                const canvas = document.getElementById('progressTrendChart');
                if (canvas && canvas.parentElement) {
                    canvas.parentElement.innerHTML = `
                        <div class="empty-state text-center py-5">
                            <i class="fas fa-exclamation-triangle text-danger mb-3" style="font-size: 3rem;"></i>
                            <h5 class="text-muted">Error al cargar el gráfico</h5>
                            <p class="text-muted small">${error.message}</p>
                        </div>
                    `;
                }
            }
        }

        // Load content assigned to coachee
        // Variables globales para debugging
        let renderContentCallCount = 0;
        let isLoadingContent = false;
        async function loadContent() {
            // Evitar llamadas concurrentes
            if (isLoadingContent) {
                debugLog('⏳ LoadContent ya en progreso, omitiendo llamada duplicada');
                return;
            }
            
            isLoadingContent = true;
            debugLog('🎥 LOAD-CONTENT: Iniciando carga de contenido...');
            
            try {
                debugLog('🎥 Cargando contenido asignado...');
                
                const response = await fetch('/api/coachee/content', {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                debugLog('✅ Contenido cargado:', data);
                
                if (data.success) {
                    contentData = data.content || [];
                    
                    // FILTRAR DUPLICADOS POR ID
                    const uniqueContent = [];
                    const seenIds = new Set();
                    
                    contentData.forEach(item => {
                        if (!seenIds.has(item.id)) {
                            seenIds.add(item.id);
                            uniqueContent.push(item);
                        } else {
                            debugLog('⚠️ DUPLICADO DETECTADO Y REMOVIDO:', item);
                        }
                    });
                    
                    contentData = uniqueContent;
                    
                    debugLog('🎥 LOAD-CONTENT: Datos procesados', {
                        originalCount: (data.content || []).length,
                        uniqueCount: contentData.length,
                        titles: contentData.map(c => c.title),
                        ids: contentData.map(c => c.id)
                    });
                    renderContent();
                } else {
                    throw new Error(data.error || 'Error desconocido cargando contenido');
                }
                
            } catch (error) {
                console.error('Error cargando contenido:', error);
                showToast('Error cargando contenido: ' + error.message, 'error');
                
                // Inicializar con datos vacíos
                contentData = [];
                
                document.getElementById('contentContainer').innerHTML = 
                    '<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><p>Error cargando contenido</p></div>';
            } finally {
                isLoadingContent = false;
            }
        }

        // Render content
        function renderContent() {
            renderContentCallCount++;
            const container = document.getElementById('contentContainer');
            
            // Usar window.contentData si está disponible (Alpine.js), sino usar contentData local
            const dataSource = window.contentData || contentData;
            
            debugLog(`🎥 RENDER-CONTENT: Iniciando renderizado #${renderContentCallCount}`, {
                contentData: dataSource,
                itemCount: dataSource?.length || 0,
                containerExists: !!container,
                containerCurrentHTML: container?.innerHTML?.substring(0, 100) + '...',
                usingWindowData: !!window.contentData
            });
            
            if (!dataSource || dataSource.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-video"></i><p>No tienes contenido asignado</p></div>';
                return;
            }

            // LIMPIAR COMPLETAMENTE EL CONTENEDOR ANTES DE RENDERIZAR
            container.innerHTML = '';
            debugLog('🧹 RENDER-CONTENT: Contenedor limpiado');

            let html = '<div class="row">';
            
            debugLog('🎥 RENDER-CONTENT: Procesando items', {
                count: dataSource.length,
                items: dataSource.map(c => ({id: c.id, title: c.title, description: c.description}))
            });
            
            dataSource.forEach((content, index) => {
                debugLog(`🎥 RENDER-ITEM ${index}:`, {
                    id: content.id,
                    title: content.title,
                    description: content.description,
                    cleanTitle: cleanVideoTitle(content.title),
                    cleanDescription: cleanVideoDescription(content.description)
                });
                const formattedDate = content.assigned_at ? 
                    new Date(content.assigned_at).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    }) : 'Sin fecha';
                
                const duration = content.duration ? 
                    Math.ceil(content.duration / 60) + ' min' : '';
                
                const viewedBadge = content.is_viewed ? 
                    '<span class="badge bg-success ms-2"><i class="fas fa-check"></i> Visto</span>' : 
                    '<span class="badge bg-secondary ms-2"><i class="fas fa-eye"></i> Pendiente</span>';
                
                // Extraer video ID para embebido (LÓGICA IDÉNTICA AL FEED)
                const isVideo = content.content_type === 'video';
                const isDocument = content.content_type === 'document';
                
                // Detectar YouTube video ID
                let youtubeVideoId = null;
                if (content.content_url) {
                    if (content.content_url.includes('youtube.com/watch?v=')) {
                        youtubeVideoId = content.content_url.split('v=')[1]?.split('&')[0];
                    } else if (content.content_url.includes('youtu.be/')) {
                        youtubeVideoId = content.content_url.split('youtu.be/')[1]?.split('?')[0];
                    }
                }
                
                // Detectar Instagram video ID (Reels)
                let instagramVideoId = null;
                if (content.content_url) {
                    const instagramPatterns = [
                        /instagram\.com\/(?:p|reel|tv)\/([A-Za-z0-9_-]+)/,
                        /instagram\.com\/(?:p|reel|tv)\/([A-Za-z0-9_-]+)\//
                    ];
                    
                    for (const pattern of instagramPatterns) {
                        const match = content.content_url.match(pattern);
                        if (match && match[1]) {
                            instagramVideoId = match[1];
                            break;
                        }
                    }
                }
                
                const isYouTubeVideo = youtubeVideoId !== null;
                const isInstagramVideo = instagramVideoId !== null;
                
                console.log(`🎬 RENDER: Processing content ${content.id}:`, {
                    type: content.content_type,
                    url: content.content_url,
                    youtubeVideoId: youtubeVideoId,
                    instagramVideoId: instagramVideoId,
                    isYouTubeVideo: isYouTubeVideo,
                    isInstagramVideo: isInstagramVideo
                });
                
                // Generar preview HTML (EXACTAMENTE COMO EN EL FEED)
                let embedContent = '';
                let hasEmbeddedPlayer = false;
                
                if (isYouTubeVideo) {
                    // VIDEO DE YOUTUBE - IFRAME EMBEBIDO
                    hasEmbeddedPlayer = true;
                    embedContent = `
                        <div style="position: relative; width: 100%; padding-bottom: 56.25%; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); overflow: hidden; border-radius: 8px;">
                            <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%;">
                                <iframe id="youtube-${content.id}" 
                                    src="https://www.youtube.com/embed/${youtubeVideoId}?enablejsapi=1" 
                                    title="${escapeHtml(cleanVideoTitle(content.title))}" 
                                    frameborder="0" 
                                    allowfullscreen
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    style="width: 100%; height: 100%; border: none;">
                                </iframe>
                            </div>
                        </div>
                    `;
                    console.log(`✅ RENDER: YouTube iframe created for content ${content.id}`);
                } else if (isInstagramVideo) {
                    // VIDEO DE INSTAGRAM (REEL) - IFRAME EMBEBIDO
                    hasEmbeddedPlayer = true;
                    embedContent = `
                        <div style="position: relative; width: 100%; background: linear-gradient(135deg, #f09433 0%,#e6683c 25%,#dc2743 50%,#cc2366 75%,#bc1888 100%); overflow: hidden; border-radius: 8px;">
                            <iframe 
                                src="https://www.instagram.com/p/${instagramVideoId}/embed/" 
                                style="width: 100%; min-height: 600px; border: none;"
                                frameborder="0" 
                                scrolling="no" 
                                allowtransparency="true" 
                                allow="encrypted-media">
                            </iframe>
                        </div>
                    `;
                    console.log(`✅ RENDER: Instagram iframe created for content ${content.id}`);
                } else if (isVideo && content.content_url) {
                    // VIDEO NO-YOUTUBE - HTML5 PLAYER
                    embedContent = `
                        <div class="ratio ratio-16x9">
                            <video controls style="width: 100%; height: 100%; border-radius: 8px; background: #000;">
                                <source src="${content.content_url}" type="video/mp4">
                                Tu navegador no soporta la reproducción de video.
                            </video>
                        </div>
                    `;
                } else {
                    // FALLBACK - THUMBNAIL CON BOTÓN
                    const thumbnailUrl = content.thumbnail_url || 'https://via.placeholder.com/320x180/e9ecef/6c757d?text=Video';
                    embedContent = `
                        <div onclick="openContent(${content.id}, '${content.content_url}', '${escapeHtml(content.title)}')" style="position: relative; cursor: pointer;">
                            <img src="${thumbnailUrl}" 
                                 alt="${escapeHtml(content.title)}" 
                                 style="width: 100%; height: auto; border-radius: 8px;">
                            <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.7); color: white; padding: 15px 20px; border-radius: 8px; text-align: center;">
                                <i class="fas fa-${isVideo ? 'play' : 'file-alt'}" style="font-size: 2rem; margin-bottom: 8px;"></i>
                                <div style="font-weight: 600;">${isVideo ? 'Ver Video' : 'Abrir Documento'}</div>
                            </div>
                        </div>
                    `;
                }
                
                html += `
                    <div class="col-lg-6 col-xl-4 mb-3">
                        <div class="content-card ${content.is_viewed ? 'viewed' : ''}">
                            <!-- Vista previa del contenido (estilo coach dashboard) -->
                            <div class="content-preview mb-3 ${hasEmbeddedPlayer ? 'has-embedded-video' : ''}">
                                ${embedContent}
                            </div>
                            
                            <div class="content-header" style="padding: 0;">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="content-info flex-grow-1">
                                        <h6 class="content-title mb-1" style="font-weight: 600; line-height: 1.3;">${escapeHtml(cleanVideoTitle(content.title))}</h6>
                                        <small class="text-muted">Por ${escapeHtml(content.coach_name)}</small>
                                        ${duration ? `<div class="mt-1"><span class="badge bg-light text-dark"><i class="fas fa-clock me-1"></i>${duration}</span></div>` : ''}
                                    </div>
                                    ${viewedBadge}
                                </div>
                            </div>
                            
                            ${content.description ? `
                                <div class="content-description" style="padding: 0; margin-top: 8px;">
                                    <p class="text-muted small mb-2" style="line-height: 1.4;">${escapeHtml(cleanVideoDescription(content.description))}</p>
                                </div>
                            ` : ''}
                            
                            <div class="content-meta" style="padding: 0; margin-top: 8px;">
                                <small class="text-muted">
                                    <i class="fas fa-calendar me-1"></i>
                                    Asignado: ${formattedDate}
                                </small>
                            </div>
                            
                            <div class="content-actions" style="padding: 0; margin-top: 12px; border-top: 1px solid #e9ecef; padding-top: 12px;">
                                ${hasEmbeddedPlayer ? `
                                    <div class="d-flex justify-content-between align-items-center">
                                        <small class="text-success">
                                            <i class="fas fa-play-circle me-1"></i>
                                            Video listo para reproducir
                                        </small>
                                        <small class="text-muted">
                                            <i class="fas fa-eye me-1"></i>
                                            ${content.view_count || 0} vistas
                                        </small>
                                    </div>
                                ` : `
                                    <button class="btn btn-primary btn-sm" onclick="openContent(${content.id}, '${content.content_url}', '${content.title}')">
                                        <i class="fas fa-play me-1"></i>
                                        ${content.content_type === 'video' ? 'Ver Video' : 'Abrir Contenido'}
                                    </button>
                                    ${!content.is_viewed ? `
                                        <button class="btn btn-outline-success btn-sm ms-2" onclick="markContentAsViewed(${content.id})">
                                            <i class="fas fa-check me-1"></i>
                                            Marcar como Visto
                                        </button>
                                    ` : ''}
                                `}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            debugLog('🎥 RENDER-CONTENT: HTML generado', {
                htmlLength: html.length,
                finalHTML: html.substring(0, 200) + '...',
                aboutToSetInnerHTML: true
            });
            
            // Verificar estado antes de setear innerHTML
            debugLog('🔍 PRE-SET: Container state', {
                currentHTML: container.innerHTML.substring(0, 100) + '...',
                currentHTMLLength: container.innerHTML.length
            });
            
            container.innerHTML = html;
            
            // Verificar estado después de setear innerHTML  
            debugLog('✅ POST-SET: Container updated', {
                newHTML: container.innerHTML.substring(0, 100) + '...',
                newHTMLLength: container.innerHTML.length,
                childCount: container.children.length
            });
        }

        // Open content (video or document)
        function openContent(contentId, contentUrl, title) {
            console.log(`🎬 OPEN-CONTENT: Called for contentId=${contentId}, contentUrl=${contentUrl}`);
            
            // Verificar si este contenido tiene un video embebido activo
            const embeddedVideoIframe = document.getElementById(`youtube-${contentId}`);
            console.log(`🔍 OPEN-CONTENT: Looking for iframe with ID youtube-${contentId}`, {
                found: !!embeddedVideoIframe,
                iframe: embeddedVideoIframe
            });
            
            if (embeddedVideoIframe) {
                console.log(`🚫 OPEN-CONTENT: Ignorando openContent para video embebido ${contentId} - iframe existe`);
                return; // No hacer nada si hay un iframe embebido
            }
            
            // Verificar también si el contenedor padre tiene la clase has-embedded-video
            const embeddedContainer = document.querySelector(`#youtube-${contentId}`);
            if (embeddedContainer || document.querySelector(`.content-preview.has-embedded-video iframe[id="youtube-${contentId}"]`)) {
                console.log(`🚫 OPEN-CONTENT: Ignorando openContent para video embebido ${contentId} - contenedor embebido detectado`);
                return;
            }
            
            console.log(`✅ OPEN-CONTENT: Procediendo con apertura normal para ${contentId}`);
            
            // Si es un video de YouTube, usar modal con iframe
            if (contentUrl.includes('youtube.com') || contentUrl.includes('youtu.be')) {
                console.log(`🎥 OPEN-CONTENT: Abriendo modal para video ${contentId}`);
                openVideoModal(contentUrl, title);
            } else {
                console.log(`📄 OPEN-CONTENT: Abriendo en nueva pestaña para ${contentId}`);
                // Para otros tipos de contenido, abrir en nueva pestaña
                window.open(contentUrl, '_blank');
            }
            
            // Marcar como visto automáticamente al abrir
            markContentAsViewed(contentId);
        }

        // Open video in modal
        function openVideoModal(videoUrl, title) {
            // Convertir URL de YouTube a embed
            let embedUrl = videoUrl;
            if (videoUrl.includes('youtube.com/watch?v=')) {
                const videoId = videoUrl.split('v=')[1].split('&')[0];
                embedUrl = `https://www.youtube.com/embed/${videoId}`;
            } else if (videoUrl.includes('youtu.be/')) {
                const videoId = videoUrl.split('youtu.be/')[1].split('?')[0];
                embedUrl = `https://www.youtube.com/embed/${videoId}`;
            }
            
            const modalHtml = `
                <div class="modal fade" id="videoModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">${escapeHtml(cleanVideoTitle(title))}</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal">
                                    <span style="color: white; font-size: 1.2rem; font-weight: bold;">×</span>
                                </button>
                            </div>
                            <div class="modal-body p-0">
                                <div class="ratio ratio-16x9">
                                    <iframe src="${embedUrl}" allowfullscreen></iframe>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Eliminar modal anterior si existe
            const existingModal = document.getElementById('videoModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('videoModal'));
            modal.show();
            
            // Limpiar cuando se cierre
            document.getElementById('videoModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // Mark content as viewed
        async function markContentAsViewed(contentId) {
            try {
                const response = await fetch(`/api/coachee/content/${contentId}/mark-viewed`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Actualizar solo el contenido específico en lugar de recargar todo
                    const contentItem = contentData.find(c => c.id === contentId);
                    if (contentItem) {
                        contentItem.is_viewed = true;
                        contentItem.viewed_at = new Date().toISOString();
                        renderContent(); // Re-renderizar con datos actualizados
                    }
                } else {
                    throw new Error(data.error || 'Error marcando contenido como visto');
                }
                
            } catch (error) {
                console.error('Error marcando contenido como visto:', error);
                showToast('Error marcando contenido como visto: ' + error.message, 'error');
            }
        }

        // Setup video tracking for embedded YouTube videos
        function setupVideoTracking(contentId) {
            console.log(`🎯 SETUP-VIDEO-TRACKING: Called for contentId=${contentId}`);
            
            const iframe = document.getElementById(`youtube-${contentId}`);
            if (!iframe) {
                console.log(`❌ SETUP-VIDEO-TRACKING: No iframe found for youtube-${contentId}`);
                return;
            }
            
            console.log(`✅ SETUP-VIDEO-TRACKING: Iframe found for youtube-${contentId}`, iframe);
            
            // Mark as viewed when iframe loads (auto-mark since video is now immediately accessible)
            setTimeout(() => {
                const contentItem = contentData.find(c => c.id === contentId);
                if (contentItem && !contentItem.is_viewed) {
                    console.log(`📺 SETUP-VIDEO-TRACKING: Auto-marking video ${contentId} as viewed (embedded and accessible)`);
                    markContentAsViewed(contentId);
                } else {
                    console.log(`ℹ️ SETUP-VIDEO-TRACKING: Video ${contentId} already viewed or not found in contentData`);
                }
            }, 1000);
        }

        // Render statistics
        function renderStatistics(statistics) {
            const container = document.getElementById('statisticsContainer');
            
            if (!statistics) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-calculator"></i><p>No hay estadísticas disponibles</p></div>';
                return;
            }
            
            let statisticsHtml = `
                <div class="mb-4">
                    <h6 class="mb-2">Total de Evaluaciones</h6>
                    <div class="h4 text-primary">${statistics.total_evaluations || 0}</div>
                </div>
                
                <div class="mb-4">
                    <h6 class="mb-2">Puntuación Promedio General</h6>
                    <div class="h4 text-success">${statistics.average_score ? Math.round(statistics.average_score) : '-'}${statistics.average_score ? '%' : ''}</div>
                </div>
            `;
            
            // Mostrar estadísticas por tipo de evaluación si están disponibles
            if (statistics.by_assessment_type && Object.keys(statistics.by_assessment_type).length > 0) {
                statisticsHtml += `
                    <div class="mb-4">
                        <h6 class="mb-3"><i class="fas fa-chart-bar me-2"></i>Por Tipo de Evaluación</h6>
                        <div class="row">
                `;
                
                // Definir colores para cada tipo de evaluación (iguales a los del gráfico)
                const typeColors = {
                    'Asertividad': '#6282E3',
                    'DISC': '#A0D8CC',
                    'Inteligencia Emocional': '#F4A460',
                    'Liderazgo': '#FFB6C1',
                    'Trabajo en equipo': '#DDA0DD'
                };
                
                Object.entries(statistics.by_assessment_type).forEach(([type, stats]) => {
                    const color = typeColors[type] || '#6B8DA6';
                    
                    let trendIcon = '';
                    let trendColor = '';
                    let trendText = '';
                    
                    if (stats.improvement_trend === 'improving') {
                        trendIcon = 'fas fa-arrow-up';
                        trendColor = 'text-success';
                        trendText = 'Mejorando';
                    } else if (stats.improvement_trend === 'declining') {
                        trendIcon = 'fas fa-arrow-down';
                        trendColor = 'text-danger';
                        trendText = 'Descendiendo';
                    } else if (stats.improvement_trend === 'stable') {
                        trendIcon = 'fas fa-minus';
                        trendColor = 'text-warning';
                        trendText = 'Estable';
                    } else {
                        trendIcon = 'fas fa-question';
                        trendColor = 'text-muted';
                        trendText = 'Sin datos';
                    }
                    
                    statisticsHtml += `
                        <div class="col-12 mb-3">
                            <div class="p-3 rounded" style="background-color: rgba(255,255,255,0.5); border-left: 4px solid ${color};">
                                <div class="d-flex justify-content-between align-items-center mb-2">
                                    <h6 class="mb-0" style="color: ${color};">${type}</h6>
                                    <small class="text-muted">${stats.total_evaluations} evaluacion${stats.total_evaluations !== 1 ? 'es' : ''}</small>
                                </div>
                                <div class="row">
                                    <div class="col-6">
                                        <small class="text-muted">Promedio</small>
                                        <div class="h6 mb-0">${stats.average_score ? Math.round(stats.average_score) : '-'}${stats.average_score ? '%' : ''}</div>
                                    </div>
                                    <div class="col-6">
                                        <small class="text-muted">Última</small>
                                        <div class="h6 mb-0">${stats.latest_score ? Math.round(stats.latest_score) : '-'}${stats.latest_score ? '%' : ''}</div>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <small class="${trendColor}">
                                        <i class="${trendIcon} me-1"></i>
                                        ${trendText}
                                    </small>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                statisticsHtml += `
                        </div>
                    </div>
                `;
            } else {
                // Si no hay estadísticas por tipo, mostrar estadísticas generales
                let trendIcon = '';
                let trendColor = '';
                let trendText = '';
                
                if (statistics.improvement_trend === 'improving') {
                    trendIcon = 'fas fa-arrow-up';
                    trendColor = 'text-success';
                    trendText = 'Mejorando';
                } else if (statistics.improvement_trend === 'declining') {
                    trendIcon = 'fas fa-arrow-down';
                    trendColor = 'text-danger';
                    trendText = 'Descendiendo';
                } else if (statistics.improvement_trend === 'stable') {
                    trendIcon = 'fas fa-minus';
                    trendColor = 'text-warning';
                    trendText = 'Estable';
                } else {
                    trendIcon = 'fas fa-question';
                    trendColor = 'text-muted';
                    trendText = 'Sin datos';
                }
                
                statisticsHtml += `
                    <div class="mb-4">
                        <h6 class="mb-2">Última Puntuación</h6>
                        <div class="h4 text-info">${statistics.latest_score ? Math.round(statistics.latest_score) : '-'}${statistics.latest_score ? '%' : ''}</div>
                    </div>
                    
                    <div class="mb-4">
                        <h6 class="mb-2">Tendencia</h6>
                        <div class="h5 ${trendColor}">
                            <i class="${trendIcon} me-2"></i>
                            ${trendText}
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = statisticsHtml;
        }

        // Render latest evaluation details
        function renderLatestEvaluationDetails(history) {
            const container = document.getElementById('latestEvaluationContainer');
            
            if (!history || history.length === 0) {
                container.innerHTML = '<div class="empty-state"><i class="fas fa-bullseye"></i><p>No tienes evaluaciones completadas</p></div>';
                return;
            }
            
            const latest = history[history.length - 1];
            const dimensions = latest.dimensional_scores;
            
            container.innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-4">Puntuación General</h5>
                        <div class="text-center mb-4">
                            <div class="h1 text-primary">${Math.round(latest.total_score)}%</div>
                            <div class="h6 text-muted">${latest.assertiveness_level}</div>
                            <div class="small text-secondary mb-2">${latest.result_description || ''}</div>
                            <small class="text-muted">Completado el ${formatDate(latest.completed_at)}</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <h5 class="mb-4">Análisis por Dimensiones</h5>
                        ${Object.entries(dimensions).map(([key, value]) => {
                            const progressClass = value >= 75 ? 'high' : value >= 25 ? 'medium' : 'low';
                            const dimensionLabel = getDimensionLabel(key);
                            
                            return `
                                <div class="mb-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <small>${dimensionLabel}</small>
                                        <small>${Math.round(value)}%</small>
                                    </div>
                                    <div class="progress-bar-custom">
                                        <div class="progress-fill ${progressClass}" style="width: ${value}%"></div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        // Open task progress modal
        function openTaskProgressModal(taskId) {
            const task = (window.tasksData || []).find(t => t.id === taskId);
            if (!task) {
                console.error('Task not found:', taskId, 'Available tasks:', window.tasksData);
                showToast('Error: Tarea no encontrada', 'error');
                return;
            }
            
            // Actualizar título del modal con información de la tarea
            const modalTitle = document.getElementById('taskProgressModalLabel');
            if (modalTitle) {
                modalTitle.innerHTML = `
                    <i class="fas fa-tasks me-2"></i>
                    Actualizar Progreso
                `;
            }
            
            // Mostrar información de la tarea en el modal
            const modalBody = document.querySelector('#taskProgressModal .modal-body');
            const formHtml = `
                <!-- Información de la tarea -->
                <div style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 1rem; border-radius: 8px; margin-bottom: 1.25rem; border-left: 3px solid #667eea;">
                    <h6 style="margin: 0 0 0.5rem 0; font-size: 0.95rem; font-weight: 600; color: #1e293b;">
                        <i class="fas fa-clipboard-list" style="color: #667eea; margin-right: 0.5rem;"></i>
                        ${task.title}
                    </h6>
                    ${task.description ? `<p style="margin: 0; font-size: 0.8rem; color: #64748b; line-height: 1.4;">${task.description}</p>` : ''}
                </div>
                
                <form id="taskProgressForm">
                    <input type="hidden" id="taskId" value="${taskId}" />
                    
                    <div class="mb-3">
                        <label for="taskStatus" class="form-label" style="font-weight: 600; color: #334155; font-size: 0.9rem;">
                            <i class="fas fa-flag" style="margin-right: 0.5rem; color: #667eea;"></i>
                            Estado de la Tarea
                        </label>
                        <select class="form-select" id="taskStatus" required style="font-size: 0.9rem;">
                            <option value="pending" ${task.status === 'pending' ? 'selected' : ''}>⏳ Pendiente</option>
                            <option value="in_progress" ${task.status === 'in_progress' ? 'selected' : ''}>🔄 En Progreso</option>
                            <option value="completed" ${task.status === 'completed' ? 'selected' : ''}>✅ Completada</option>
                            <option value="blocked" ${task.status === 'blocked' ? 'selected' : ''}>🚫 Bloqueada</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="taskProgress" class="form-label" style="font-weight: 600; color: #334155; font-size: 0.9rem;">
                            <i class="fas fa-chart-line" style="margin-right: 0.5rem; color: #667eea;"></i>
                            Progreso
                        </label>
                        <input type="range" class="form-range" id="taskProgress" min="0" max="100" value="${task.progress_percentage || 0}" 
                               style="height: 8px; cursor: pointer;">
                        <div class="d-flex justify-content-between" style="font-size: 0.8rem; color: #64748b; margin-top: 0.5rem;">
                            <span>0%</span>
                            <span id="progressValue" style="font-weight: 600; font-size: 1rem; color: #667eea;">${Math.round(task.progress_percentage || 0)}%</span>
                            <span>100%</span>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="taskNotes" class="form-label" style="font-weight: 600; color: #334155; font-size: 0.9rem;">
                            <i class="fas fa-sticky-note" style="margin-right: 0.5rem; color: #667eea;"></i>
                            Notas sobre tu progreso
                        </label>
                        <textarea class="form-control" id="taskNotes" rows="3" 
                                  placeholder="Comparte tus avances, desafíos o comentarios..."
                                  style="font-size: 0.9rem; resize: none;"></textarea>
                        <small style="color: #94a3b8; font-size: 0.75rem; display: block; margin-top: 0.25rem;">
                            💡 Tu coach podrá ver estos comentarios
                        </small>
                    </div>
                </form>
            `;
            
            modalBody.innerHTML = formHtml;
            
            // Update progress display when slider changes
            const progressSlider = document.getElementById('taskProgress');
            progressSlider.oninput = function() {
                const value = this.value;
                document.getElementById('progressValue').textContent = value + '%';
                
                // Actualizar estilo del track de la barra de progreso con gradiente verde
                this.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${value}%, #e5e7eb ${value}%, #e5e7eb 100%)`;
                
                // Cambiar color del badge según progreso
                const progressValueEl = document.getElementById('progressValue');
                if (value >= 75) {
                    progressValueEl.style.color = '#059669';
                    progressValueEl.style.backgroundColor = '#d1fae5';
                } else if (value >= 50) {
                    progressValueEl.style.color = '#10b981';
                    progressValueEl.style.backgroundColor = '#ecfdf5';
                } else if (value >= 25) {
                    progressValueEl.style.color = '#f59e0b';
                    progressValueEl.style.backgroundColor = '#fef3c7';
                } else {
                    progressValueEl.style.color = '#6b7280';
                    progressValueEl.style.backgroundColor = '#f3f4f6';
                }
            };
            
            const modal = new bootstrap.Modal(document.getElementById('taskProgressModal'));
            modal.show();
            
            // Inicializar color de la barra al abrir el modal
            const currentProgress = progressSlider.value;
            progressSlider.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${currentProgress}%, #e5e7eb ${currentProgress}%, #e5e7eb 100%)`;
            
            // Inicializar color del badge
            const progressValueEl = document.getElementById('progressValue');
            if (currentProgress >= 75) {
                progressValueEl.style.color = '#059669';
                progressValueEl.style.backgroundColor = '#d1fae5';
            } else if (currentProgress >= 50) {
                progressValueEl.style.color = '#10b981';
                progressValueEl.style.backgroundColor = '#ecfdf5';
            } else if (currentProgress >= 25) {
                progressValueEl.style.color = '#f59e0b';
                progressValueEl.style.backgroundColor = '#fef3c7';
            } else {
                progressValueEl.style.color = '#6b7280';
                progressValueEl.style.backgroundColor = '#f3f4f6';
            }
        }

        // Save task progress
        async function saveTaskProgress() {
            const taskId = document.getElementById('taskId').value;
            const status = document.getElementById('taskStatus').value;
            const progress = parseInt(document.getElementById('taskProgress').value);
            const notes = document.getElementById('taskNotes').value;
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/tasks/${taskId}/progress`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        status: status,
                        progress_percentage: progress,
                        notes: notes
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    // Close modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('taskProgressModal'));
                    modal.hide();
                    
                    // Refresh tasks (forzar recarga porque hubo cambios)
                    await loadTasks(true);
                    await loadDashboardSummary();
                } else {
                    throw new Error(data.error);
                }
            } catch (error) {
                console.error('Error actualizando progreso:', error);
                showToast('Error actualizando progreso: ' + error.message, 'error');
            }
        }

        // Start evaluation
        async function startEvaluation(evaluationType) {
            try {
                
                // Reset assessment state
                questions = [];
                currentQuestionIndex = 0;
                answers = {};
                isAssessmentActive = true;
                
                // Store current assessment ID for later use
                currentAssessmentId = evaluationType;
                
                // Show assessment tab
                document.getElementById('assessment-sidebar-item').style.display = 'block';
                
                // Switch to assessment tab
                showTab('assessment');
                
                // Load questions
                await loadAssessmentQuestions();
                
            } catch (error) {
                console.error('Error starting assessment:', error);
                showToast('Error iniciando evaluación: ' + error.message, 'error');
            }
        }

        // Load assessment questions
        async function loadAssessmentQuestions() {
            try {
                const url = `${API_BASE_URL}/api/questions?assessment_id=${currentAssessmentId}`;
                const response = await fetch(url, {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!response.ok) {
                    if (response.status === 401) {
                        window.location.href = '/login?role=coachee';
                        return;
                    }
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success && data.questions && data.questions.length > 0) {
                    questions = data.questions;
                    
                    // MEJORADO: Validación completa del correlativo al cargar
                    console.log('🔍 DEBUG PREGUNTAS CARGADAS:', {
                        total: questions.length,
                        first5: questions.slice(0, 5).map(q => ({
                            id: q.id,
                            order: q.order,
                            text: q.text.substring(0, 30) + '...'
                        }))
                    });
                    
                    // Validar integridad del correlativo
                    validateQuestionSequence();
                    
                    // Actualizar el título dinámicamente en el header de la evaluación
                    const assessmentHeaderTitle = document.querySelector('#assessment .card-header h3');
                    if (assessmentHeaderTitle && data.assessment_title) {
                        assessmentHeaderTitle.innerHTML = `
                            <i class="fas fa-clipboard-check me-2"></i>
                            ${data.assessment_title}
                        `;
                        console.log('🎯 FRONTEND: Título actualizado a:', data.assessment_title);
                    }
                    
                    // Guardar el título para uso posterior en resultados
                    window.currentAssessmentTitle = data.assessment_title;
                    
                    showAssessmentQuestion();
                } else {
                    throw new Error('No se encontraron preguntas válidas');
                }
            } catch (error) {
                console.error('Error loading questions:', error);
                showToast('Error cargando preguntas: ' + error.message, 'error');
            }
        }

        // NUEVA: Validar secuencia completa del correlativo
        function validateQuestionSequence() {
            console.log('🔍 VALIDANDO SECUENCIA DE PREGUNTAS...');
            
            const totalQuestions = questions.length;
            const expectedForIE = 12;
            const orders = questions.map(q => q.order).sort((a, b) => a - b);
            const ids = questions.map(q => q.id).sort((a, b) => a - b);
            
            // Verificar cantidad esperada
            const isCorrectCount = totalQuestions === expectedForIE;
            
            // Verificar secuencia consecutiva 1-12
            const expectedOrders = Array.from({length: expectedForIE}, (_, i) => i + 1);
            const isConsecutiveSequence = JSON.stringify(orders) === JSON.stringify(expectedOrders);
            
            // Verificar que cada índice del array corresponda al correlativo
            const arrayToOrderMatch = questions.every((q, index) => q.order === (index + 1));
            
            const validationResult = {
                totalQuestions: totalQuestions,
                expectedCount: expectedForIE,
                isCorrectCount: isCorrectCount,
                orders: orders,
                expectedOrders: expectedOrders,
                isConsecutiveSequence: isConsecutiveSequence,
                arrayToOrderMatch: arrayToOrderMatch,
                questionDetails: questions.map((q, index) => ({
                    arrayIndex: index,
                    questionId: q.id,
                    order: q.order,
                    orderMatchesIndex: q.order === (index + 1)
                }))
            };
            
            console.log('📊 RESULTADO VALIDACIÓN CORRELATIVO:', validationResult);
            
            if (!isCorrectCount) {
                console.error('❌ ERROR: Cantidad incorrecta de preguntas', {
                    expected: expectedForIE,
                    received: totalQuestions
                });
            }
            
            if (!isConsecutiveSequence) {
                console.error('❌ ERROR: Correlativo no consecutivo', {
                    expected: expectedOrders,
                    received: orders
                });
            }
            
            if (!arrayToOrderMatch) {
                console.error('❌ ERROR: Índices del array no coinciden con correlativo', validationResult.questionDetails);
                showToast('Error: La secuencia de preguntas no está ordenada correctamente', 'error');
            }
            
            if (isCorrectCount && isConsecutiveSequence && arrayToOrderMatch) {
                console.log('✅ VALIDACIÓN EXITOSA: Correlativo perfecto 1-12 consecutivo');
            }
            
            return validationResult;
        }

        // Show current assessment question
        function showAssessmentQuestion() {
            if (currentQuestionIndex >= questions.length) {
                completeAssessment();
                return;
            }
            
            const question = questions[currentQuestionIndex];
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            
            // MEJORADO: Validación del correlativo
            const expectedCorrelativo = currentQuestionIndex + 1;
            if (question.order !== expectedCorrelativo) {
                console.warn('⚠️ ADVERTENCIA: Correlativo inconsistente', {
                    questionId: question.id,
                    currentIndex: currentQuestionIndex,
                    questionOrder: question.order,
                    expectedOrder: expectedCorrelativo,
                    difference: question.order - expectedCorrelativo
                });
            }
            
            // Update progress bar
            document.getElementById('assessmentProgress').style.width = progress + '%';
            
            // Determinar opciones según el tipo de evaluación
            let likertOptions;
            
            // DEBUG: Verificar qué assessment ID se está usando
            console.log('🔍 DEBUG OPCIONES:', {
                currentAssessmentId: currentAssessmentId,
                assessmentIdType: typeof currentAssessmentId,
                isEvaluacion6: currentAssessmentId === 6,
                questionDimension: questions[currentQuestionIndex]?.dimension,
                questionText: questions[currentQuestionIndex]?.text
            });
            
            if (currentAssessmentId === 6 || currentAssessmentId === "6") {  // Preparación para crecer 2026
                console.log('✅ Usando opciones específicas para Preparación para crecer 2026');
                likertOptions = getGrowthPreparationOptions(questions[currentQuestionIndex]);
            } else {
                console.log('➡️ Usando opciones estándar de Likert');
                // Opciones estándar para escala Likert de 5 puntos (otras evaluaciones)
                likertOptions = [
                    'Totalmente en desacuerdo',
                    'En desacuerdo',
                    'Neutral',
                    'De acuerdo',
                    'Totalmente de acuerdo'
                ];
            }
            
            // DEBUG: Log question details mejorado
            console.log('🔍 DEBUG PREGUNTA MOSTRADA:', {
                currentQuestionIndex: currentQuestionIndex,
                displayNumber: question.order, // USAR ORDEN DE LA PREGUNTA, NO ÍNDICE
                questionId: question.id,
                questionOrder: question.order,
                expectedCorrelativo: expectedCorrelativo,
                correlatioMatch: question.order === expectedCorrelativo,
                totalQuestions: questions.length,
                questionText: question.text.substring(0, 50) + '...',
                progressPercentage: Math.round(progress),
                hasStoredAnswer: answers[question.id] !== undefined
            });
            
            // Create question HTML
            document.getElementById('questionContainer').innerHTML = `
                <div class="question-card">
                    <div class="question-title mb-3">
                        <i class="fas fa-question-circle me-2"></i>
                        Pregunta ${question.order} de ${questions.length}
                    </div>
                    <div class="question-text mb-4">${question.text}</div>
                    <div class="options-container mb-4">
                        ${likertOptions.map((option, index) => `
                            <div class="form-check mb-3 p-3 border rounded option-item auto-advance-option" onclick="selectAssessmentOption(${index + 1})">
                                <input class="form-check-input" type="radio" name="question${currentQuestionIndex}" value="${index + 1}" id="option${index}">
                                <label class="form-check-label w-100" for="option${index}">
                                    ${option}
                                </label>
                            </div>
                        `).join('')}
                    </div>
                    <div class="text-center">
                        <button class="btn btn-primary-custom btn-lg manual-next-btn" onclick="nextAssessmentQuestion()" style="display: none;">
                            <i class="fas fa-${currentQuestionIndex === questions.length - 1 ? 'flag-checkered' : 'arrow-right'} me-2"></i>
                            ${currentQuestionIndex === questions.length - 1 ? 'Finalizar Evaluación' : 'Siguiente Pregunta'}
                        </button>
                    </div>
                </div>
            `;
            
            // Add fade-in animation to new question
            const questionCard = document.querySelector('.question-card');
            if (questionCard) {
                questionCard.style.opacity = '0';
                questionCard.style.transition = 'opacity 0.4s ease-in';
                setTimeout(() => {
                    questionCard.style.opacity = '1';
                }, 50);
            }
        }

        // Select assessment option
        function selectAssessmentOption(value) {
            // Remove previous selections
            document.querySelectorAll('.option-item').forEach(item => {
                item.classList.remove('bg-primary', 'text-white', 'selected');
                item.classList.add('bg-light');
            });
            
            // Mark selected option
            const selectedOption = document.querySelector(`input[value="${value}"]`);
            if (selectedOption) {
                selectedOption.checked = true;
                const optionItem = selectedOption.closest('.option-item');
                optionItem.classList.remove('bg-light');
                optionItem.classList.add('bg-primary', 'text-white', 'selected');
                
                // Add visual feedback with animation
                optionItem.style.transform = 'scale(1.02)';
                setTimeout(() => {
                    optionItem.style.transform = 'scale(1)';
                }, 150);
                
                // Show brief loading state
                const nextButton = document.querySelector('.btn-primary-custom');
                if (nextButton) {
                    nextButton.disabled = true;
                    nextButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Procesando...';
                }
                
                // Store the answer immediately using question ID as key
                const currentQuestion = questions[currentQuestionIndex];
                if (currentQuestion && currentQuestion.id) {
                    answers[currentQuestion.id] = parseInt(value);
                    console.log('🔍 DEBUG RESPUESTA GUARDADA:', {
                        questionIndex: currentQuestionIndex,
                        questionId: currentQuestion.id,
                        questionOrder: currentQuestion.order,
                        selectedValue: parseInt(value),
                        totalAnswers: Object.keys(answers).length
                    });
                }
                
                // Auto-advance to next question after a brief delay
                setTimeout(() => {
                    autoAdvanceQuestion();
                }, 300); // 300ms delay for better UX
            }
        }
        
        // Auto-advance to next question
        function autoAdvanceQuestion() {
            // Add fade-out animation to current question
            const questionCard = document.querySelector('.question-card');
            if (questionCard) {
                questionCard.style.transition = 'opacity 0.3s ease-out';
                questionCard.style.opacity = '0';
                
                setTimeout(() => {
                    console.log('🔍 DEBUG ANTES DEL AVANCE:', {
                        currentIndex: currentQuestionIndex,
                        currentQuestionId: questions[currentQuestionIndex]?.id,
                        currentQuestionOrder: questions[currentQuestionIndex]?.order,
                        totalQuestionsLoaded: questions.length,
                        answersSoFar: Object.keys(answers).length,
                        answeredQuestionIds: Object.keys(answers).map(id => parseInt(id)).sort()
                    });
                    
                    // MEJORADO: Validar que no nos saltemos ninguna pregunta
                    const currentQuestion = questions[currentQuestionIndex];
                    if (currentQuestion && !answers[currentQuestion.id]) {
                        console.warn('⚠️ ADVERTENCIA: Pregunta sin respuesta detectada', {
                            questionId: currentQuestion.id,
                            questionOrder: currentQuestion.order,
                            index: currentQuestionIndex
                        });
                        // No avanzar si no hay respuesta
                        questionCard.style.opacity = '1';
                        return;
                    }
                    
                    currentQuestionIndex++;
                    
                    console.log('🔍 DEBUG DESPUÉS DEL AVANCE:', {
                        newIndex: currentQuestionIndex,
                        totalQuestions: questions.length,
                        nextQuestionId: questions[currentQuestionIndex]?.id,
                        nextQuestionOrder: questions[currentQuestionIndex]?.order,
                        willComplete: currentQuestionIndex >= questions.length
                    });
                    
                    // MEJORADO: Validación adicional del correlativo
                    if (currentQuestionIndex < questions.length) {
                        const nextQuestion = questions[currentQuestionIndex];
                        console.log('🎯 NAVEGANDO A PREGUNTA:', {
                            arrayIndex: currentQuestionIndex,
                            questionId: nextQuestion.id,
                            correlativo: nextQuestion.order,
                            expectedCorrelativo: currentQuestionIndex + 1,
                            isCorrectSequence: nextQuestion.order === (currentQuestionIndex + 1)
                        });
                        showAssessmentQuestion();
                    } else {
                        // Complete assessment - MEJORADO: Verificación final dinámica
                        const totalQuestionsExpected = questions.length; // Usar el número real de preguntas cargadas
                        const totalAnswered = Object.keys(answers).length;
                        
                        console.log('🎯 COMPLETANDO EVALUACIÓN - Resumen final:', {
                            assessmentType: currentAssessmentId === 2 ? 'DISC' : (currentAssessmentId === 3 ? 'IE' : 'OTRA'),
                            totalQuestionsExpected: totalQuestionsExpected,
                            totalAnswersCollected: totalAnswered,
                            questionIds: questions.map(q => q.id).sort(),
                            answeredIds: Object.keys(answers).map(id => parseInt(id)).sort(),
                            missingIds: questions.map(q => q.id).filter(id => !answers[id]),
                            isComplete: totalAnswered === totalQuestionsExpected,
                            currentAssessmentId: currentAssessmentId
                        });
                        
                        // Validar que tengamos todas las respuestas antes de completar
                        if (totalAnswered < totalQuestionsExpected) {
                            console.error('❌ ERROR: Faltan respuestas, no se puede completar', {
                                expected: totalQuestionsExpected,
                                received: totalAnswered,
                                missing: questions.map(q => q.id).filter(id => !answers[id])
                            });
                            showToast('Error: Faltan respuestas. Reiniciando evaluación...', 'error');
                            // Reiniciar desde la primera pregunta no respondida
                            const firstMissing = questions.findIndex(q => !answers[q.id]);
                            if (firstMissing >= 0) {
                                currentQuestionIndex = firstMissing;
                                showAssessmentQuestion();
                                return;
                            }
                        }
                        
                        completeAssessment();
                    }
                }, 300); // Wait for fade-out animation
            }
        }

        // Move to next assessment question (manual fallback)
        function nextAssessmentQuestion() {
            const selected = document.querySelector(`input[name="question${currentQuestionIndex}"]:checked`);
            
            if (!selected) {
                showToast('Por favor selecciona una respuesta', 'warning');
                return;
            }
            
            // Store answer using question ID - ALWAYS store it
            const currentQuestion = questions[currentQuestionIndex];
            if (currentQuestion && currentQuestion.id) {
                answers[currentQuestion.id] = parseInt(selected.value);
                console.log('🔍 DEBUG RESPUESTA MANUAL:', {
                    questionIndex: currentQuestionIndex,
                    questionId: currentQuestion.id,
                    selectedValue: parseInt(selected.value),
                    totalAnswersNow: Object.keys(answers).length
                });
            }
            
            // Use the same auto-advance logic
            autoAdvanceQuestion();
        }

        // Complete assessment
        async function completeAssessment() {
            try {
                console.log('Answers object:', answers);
                console.log('Questions array:', questions);
                
                if (Object.keys(answers).length === 0) {
                    throw new Error('No hay respuestas guardadas');
                }
                
                // MEJORADO: Validación final completa antes de enviar
                const totalAnswers = Object.keys(answers).length;
                const expectedAnswers = questions.length;
                
                console.log('🔍 VALIDACIÓN FINAL ANTES DEL ENVÍO:', {
                    assessmentType: currentAssessmentId === 2 ? 'DISC' : (currentAssessmentId === 3 ? 'IE' : 'OTRA'),
                    currentAssessmentId: currentAssessmentId,
                    totalAnswersProvided: totalAnswers,
                    expectedAnswersFromQuestions: expectedAnswers,
                    answeredQuestionIds: Object.keys(answers).map(id => parseInt(id)).sort(),
                    expectedQuestionIds: questions.map(q => q.id).sort(),
                    allQuestionsAnswered: questions.every(q => answers[q.id] !== undefined),
                    missingQuestions: questions.filter(q => answers[q.id] === undefined).map(q => ({id: q.id, order: q.order}))
                });
                
                // Verificar que todas las preguntas estén respondidas
                if (totalAnswers !== expectedAnswers) {
                    const missingQuestions = questions.filter(q => answers[q.id] === undefined);
                    console.error('❌ ERROR VALIDACIÓN FINAL: Faltan respuestas', {
                        expected: expectedAnswers,
                        received: totalAnswers,
                        missing: missingQuestions.map(q => ({id: q.id, order: q.order, text: q.text.substring(0, 30)}))
                    });
                    
                    showToast(`Error: Faltan ${expectedAnswers - totalAnswers} respuestas. Evaluación incompleta.`, 'error');
                    
                    // Ir a la primera pregunta sin responder
                    if (missingQuestions.length > 0) {
                        const firstMissingIndex = questions.findIndex(q => q.id === missingQuestions[0].id);
                        if (firstMissingIndex >= 0) {
                            currentQuestionIndex = firstMissingIndex;
                            showAssessmentQuestion();
                            return;
                        }
                    }
                    
                    throw new Error(`Evaluación incompleta: ${totalAnswers}/${expectedAnswers} respuestas`);
                }
                
                // Convert answers to the format expected by the API
                const responses = [];
                for (const [questionId, answer] of Object.entries(answers)) {
                    // questionId is now the actual question ID, not an index
                    responses.push({
                        question_id: parseInt(questionId),
                        selected_option: answer
                    });
                }
                
                console.log('🔍 DEBUG ENVÍO:', {
                    totalAnswers: Object.keys(answers).length,
                    questionIds: Object.keys(answers).map(id => parseInt(id)),
                    responses: responses,
                    validationPassed: true
                });
                
                console.log('Converted responses:', responses);
                
                if (responses.length === 0) {
                    throw new Error('No se pudieron procesar las respuestas');
                }
                
                // Create user data for assessment
                const userData = {
                    age: 25, // Default age
                    gender: 'no_especificado'
                };
                
                const requestBody = {
                    age: userData.age,
                    gender: userData.gender,
                    responses: responses,
                    assessment_id: currentAssessmentId
                };
                
                console.log('Request body:', requestBody);
                
                // Send assessment data
                const response = await fetch(`${API_BASE_URL}/api/save_assessment`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                console.log('API response:', data);
                
                if (response.ok && data.success) {
                    showAssessmentResults(data);
                } else if (response.status === 409) {
                    // Evaluación ya completada previamente
                    showToast(data.error || 'Ya has completado esta evaluación previamente', 'warning');
                } else {
                    throw new Error(data.error || 'Error guardando evaluación');
                }
                
            } catch (error) {
                console.error('Assessment completion error:', error);
                showToast('Error completando evaluación: ' + error.message, 'error');
            }
        }

        // Show assessment results
        function showAssessmentResults(data) {
            console.log('showAssessmentResults received:', data);
            
            // Extract result data from the correct location
            const result = data.result || data;
            const evaluationId = result.id;
            const score = Math.round(result.score);
            const resultText = result.result_text || '';
            
            // Store the result_id and data for detailed view
            window.lastEvaluationId = evaluationId;
            window.lastAssessmentData = result; // Store complete result data
            
            console.log('Stored evaluation ID:', evaluationId);
            console.log('Stored assessment data:', result);
            
            if (!evaluationId) {
                console.error('No evaluation ID found in response:', data);
                showToast('Error: No se encontró el ID de la evaluación', 'error');
                return;
            }
            
            // Hide question container and reset assessment state
            document.getElementById('assessmentContainer').style.display = 'none';
            isAssessmentActive = false; // Reset assessment state
            
            // Hide assessment tab automatically when evaluation is completed
            document.getElementById('assessment-sidebar-item').style.display = 'none';
            
            // Switch back to evaluations tab
            showTab('evaluations');
            
            // Mostrar directamente el modal de detalles de evaluación con los datos recién completados
            setTimeout(() => {
                viewEvaluationDetails(evaluationId);
            }, 1000); // Aumentar el tiempo para asegurar que los datos se guardan completamente
        }

        // Helper function to format dimension names
        function formatDimensionName(dimension) {
            const dimensionNames = {
                'comunicacion': 'Comunicación',
                'derechos': 'Defensa de Derechos',
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza',
                'opiniones': 'Expresión de Opiniones'
            };
            return dimensionNames[dimension] || dimension.charAt(0).toUpperCase() + dimension.slice(1);
        }

        // View detailed results immediately after completing assessment
        async function viewDetailedResults() {
            console.log('viewDetailedResults called');
            console.log('lastEvaluationId:', window.lastEvaluationId);
            console.log('lastAssessmentData:', window.lastAssessmentData);
            
            if (window.lastEvaluationId) {
                try {
                    // If we have the assessment data in memory, use it immediately
                    if (window.lastAssessmentData && window.lastAssessmentData.dimensional_scores) {
                        console.log('Using cached assessment data');
                        await viewEvaluationDetails(window.lastEvaluationId);
                    } else {
                        console.log('Fetching fresh evaluation details from server');
                        await viewEvaluationDetails(window.lastEvaluationId);
                    }
                } catch (error) {
                    console.error('Error in viewDetailedResults:', error);
                    showToast('Error al cargar los detalles de la evaluación', 'error');
                }
            } else {
                console.error('No evaluation ID available');
                showToast('Error: No se encontró el ID de la evaluación. Intenta refrescar la página.', 'error');
            }
        }

        // Finish assessment and return to dashboard
        function finishAssessment() {
            // Reset assessment state
            isAssessmentActive = false;
            
            // Hide assessment tab
            document.getElementById('assessment-sidebar-item').style.display = 'none';
            
            // Cerrar el modal de detalles de evaluación si está abierto
            const evaluationDetailsModal = bootstrap.Modal.getInstance(document.getElementById('evaluationDetailsModal'));
            if (evaluationDetailsModal) {
                evaluationDetailsModal.hide();
            }
            
            // Show assessment container
            document.getElementById('assessmentContainer').style.display = 'block';
            
            // Switch back to evaluations tab
            showTab('evaluations');
            
            // Refresh data
            refreshDashboard();
            
            showToast('Evaluación finalizada. Los datos se han actualizado.', 'success');
        }
        
        // View evaluation details
        async function viewEvaluationDetails(evaluationId) {
            try {
                console.log('Loading evaluation details for ID:', evaluationId);
                
                // Mostrar el modal
                const modal = new bootstrap.Modal(document.getElementById('evaluationDetailsModal'));
                modal.show();
                
                // Cargar detalles de la evaluación
                const response = await fetch(`${API_BASE_URL}/api/coachee/evaluation-details/${evaluationId}`);
                const data = await response.json();
                
                console.log('API response:', data);
                
                if (response.ok) {
                    // La API devuelve {success: true, evaluation: {...}}
                    if (data.success && data.evaluation) {
                        renderEvaluationDetails(data.evaluation);
                    } else {
                        throw new Error('Estructura de datos inesperada');
                    }
                } else {
                    throw new Error(data.error || 'Error desconocido');
                }
            } catch (error) {
                console.error('Error cargando detalles de evaluación:', error);
                document.getElementById('evaluationDetailsContent').innerHTML = 
                    '<div class="text-center text-danger"><i class="fas fa-exclamation-triangle"></i><p>Error cargando detalles de la evaluación</p></div>';
                showToast('Error cargando detalles de la evaluación: ' + error.message, 'error');
            }
        }

        function renderEvaluationDetails(evaluation) {
            console.log('renderEvaluationDetails called with:', evaluation);
            console.log('Current cached data:', window.lastAssessmentData);
            console.log('Last evaluation ID:', window.lastEvaluationId);
            
            // Guardar el ID de la evaluación actual para uso en solicitudes
            window.currentEvaluationId = evaluation.id;
            
            const container = document.getElementById('evaluationDetailsContent');
            
            // Si tenemos datos de la evaluación más reciente (cuando se acaba de completar)
            const currentData = window.lastAssessmentData;
            const useCurrent = currentData && window.lastEvaluationId && 
                             window.lastEvaluationId === evaluation.id;
            
            console.log('Using current cached data:', useCurrent);
            
            const data = useCurrent ? currentData : evaluation;
            const dimensionalScores = useCurrent ? currentData.dimensional_scores : evaluation.dimensional_scores;
            const recommendations = evaluation.recommendations || []; // SIEMPRE usar datos del servidor para recomendaciones
            const detailedAnalysis = useCurrent ? currentData.detailed_analysis : evaluation.detailed_analysis;
            
            // Determinar el tipo de evaluación y configurar títulos apropiados
            const assessmentTitle = evaluation.assessment_title || data.assessment_title || 'Evaluación';
            const isDiscAssessment = assessmentTitle.includes('DISC');
            const isEmotionalIntelligenceAssessment = assessmentTitle.includes('Inteligencia Emocional');
            const isLeadershipAssessment = assessmentTitle.includes('Liderazgo');
            const isTeamworkAssessment = assessmentTitle.includes('Trabajo en Equipo');
            const isGrowthPreparationAssessment = assessmentTitle.includes('Preparación para crecer 2026');
            
            let analysisTitle, chartTitle;
            if (isDiscAssessment) {
                analysisTitle = 'Análisis Completo DISC de Personalidad';
                chartTitle = 'Radar de Dimensiones DISC';
            } else if (isEmotionalIntelligenceAssessment) {
                analysisTitle = 'Análisis Completo de Inteligencia Emocional';
                chartTitle = 'Radar de Competencias Emocionales';
            } else if (isLeadershipAssessment) {
                analysisTitle = 'Análisis Completo de Habilidades de Liderazgo';
                chartTitle = 'Radar de Competencias de Liderazgo';
            } else if (isTeamworkAssessment) {
                analysisTitle = 'Análisis Completo de Trabajo en Equipo';
                chartTitle = 'Radar de Competencias de Colaboración';
            } else if (isGrowthPreparationAssessment) {
                analysisTitle = 'Análisis de Preparación para Crecer 2026';
                chartTitle = 'Radar de Dimensiones Empresariales';
            } else {
                analysisTitle = 'Análisis Completo de Asertividad';
                chartTitle = 'Radar de Competencias';
            }
            
            console.log('Assessment type detected:', { assessmentTitle, isDiscAssessment, isLeadershipAssessment, analysisTitle });
            console.log('Final data to use:', data);
            console.log('Dimensional scores:', dimensionalScores);
            console.log('Recommendations from server:', recommendations);
            console.log('Recommendations count:', recommendations ? recommendations.length : 0);
            
            // Layout completamente diferente para "Preparación para crecer 2026"
            if (isGrowthPreparationAssessment) {
                const html = generateGrowthPreparationLayout(data, evaluation, dimensionalScores);
                container.innerHTML = html;
                
                // FORZAR SCROLL AL INICIO DEL MODAL (especialmente importante en móvil)
                const modalBody = document.querySelector('#evaluationDetailsModal .modal-body');
                if (modalBody) {
                    modalBody.scrollTop = 0;
                }
                
                // Crear el gráfico radar específico para crecimiento
                setTimeout(() => {
                    createGrowthRadarChart(dimensionalScores);
                    
                    // ASEGURAR SCROLL AL INICIO después de crear gráfico también
                    if (modalBody) {
                        modalBody.scrollTop = 0;
                    }
                }, 100);
                
                return;
            }
            
            // Calcular porcentaje correcto según el tipo de evaluación
            let displayPercentage;
            const rawScore = data.score || evaluation.score || 0;
            
            if (isLeadershipAssessment) {
                // Liderazgo: score es suma (10-50), convertir a porcentaje
                displayPercentage = Math.round((rawScore / 50) * 100);
            } else if (isTeamworkAssessment) {
                // Trabajo en Equipo: score es suma (12-60), convertir a porcentaje
                displayPercentage = Math.round((rawScore / 60) * 100);
            } else if (isDiscAssessment) {
                // DISC: score es suma (16-80), convertir a porcentaje
                displayPercentage = Math.round((rawScore / 80) * 100);
            } else if (isEmotionalIntelligenceAssessment) {
                // IE: score es suma (12-60), convertir a porcentaje
                displayPercentage = Math.round((rawScore / 60) * 100);
            } else {
                // Asertividad y otras: score ya es porcentaje
                displayPercentage = Math.round(rawScore);
            }
            
            const html = `
                <!-- Resumen General -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-body text-center">
                                <h4 class="mb-3" style="color: #333;">${analysisTitle}</h4>
                                <div class="row">
                                    <div class="col-md-3">
                                        <div class="h2" style="color: #007bff;">${displayPercentage}%</div>
                                        <div style="color: #666;">Puntuación Total</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h4" style="color: #28a745;">${isDiscAssessment ? getDiscLevelFromScore(rawScore) : (isEmotionalIntelligenceAssessment ? getEmotionalIntelligenceLevelFromScore(rawScore) : (isLeadershipAssessment ? getLeadershipLevelFromScore(rawScore) : (isTeamworkAssessment ? getTeamworkLevelFromScore(rawScore) : (isGrowthPreparationAssessment ? getGrowthPreparationLevelFromScore(rawScore) : getAssertiveLevelFromScore(rawScore)))))}</div>
                                        <div style="color: #666;">${isDiscAssessment ? 'Perfil DISC Dominante' : (isEmotionalIntelligenceAssessment ? 'Nivel de Inteligencia Emocional' : (isLeadershipAssessment ? 'Nivel de Liderazgo' : (isTeamworkAssessment ? 'Nivel de Trabajo en Equipo' : (isGrowthPreparationAssessment ? 'Nivel de Preparación' : 'Nivel de Asertividad'))))}</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h6" style="color: #333;">${formatDate(data.completed_at || evaluation.completed_at)}</div>
                                        <div style="color: #666;">Fecha de Completado</div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="h6" style="color: #333;">${data.total_questions || evaluation.total_questions || (evaluation.responses ? evaluation.responses.length : 'N/A')}</div>
                                        <div style="color: #666;">Preguntas Respondidas</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                ${generateAssertivenessSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}
                ${generateDiscSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}
                ${generateEmotionalIntelligenceSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}
                ${generateTeamworkSummarySection(data.score || evaluation.score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment)}

                ${(isDiscAssessment || isEmotionalIntelligenceAssessment || isTeamworkAssessment || (!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && !isGrowthPreparationAssessment)) ? `
                <!-- Sección de Contacto con Coach -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); border: 1px solid #dee2e6;">
                            <div class="card-body text-white text-center">
                                <div class="row align-items-center">
                                    <div class="col-lg-8">
                                        <h4 class="mb-3"><i class="fas fa-user-graduate me-2"></i>¡Desarrolla tu Potencial!</h4>
                                        <p class="mb-3" style="font-size: 1.1em; line-height: 1.6;">
                                            ${isDiscAssessment ? 
                                                'Descubre cómo potenciar tu perfil de personalidad DISC con el apoyo de un coach especializado en desarrollo personal y profesional.' :
                                                isEmotionalIntelligenceAssessment ?
                                                'Potencia tu inteligencia emocional con el acompañamiento de un coach especializado en competencias emocionales y liderazgo.' :
                                                isLeadershipAssessment ?
                                                'Desarrolla tus habilidades de liderazgo con el acompañamiento de un coach especializado en desarrollo de líderes y gestión de equipos.' :
                                                isTeamworkAssessment ?
                                                'Fortalece tus habilidades de trabajo en equipo con el apoyo de un coach especializado en colaboración y liderazgo de equipos.' :
                                                'Puedes desarrollar y fortalecer tus habilidades de asertividad con el apoyo personalizado de un coach profesional.'
                                            }
                                            Nuestros expertos te ayudarán a crear un plan de desarrollo específico para tus necesidades.
                                        </p>
                                        <p class="mb-0" style="font-size: 1em;">
                                            <i class="fas fa-gift me-2"></i><strong>¡Sesión gratuita de 30 minutos disponible!</strong>
                                        </p>
                                    </div>
                                    <div class="col-lg-4">
                                        <button class="btn btn-light btn-lg" onclick="contactCoachForSession(event)" style="color: #28a745; font-weight: bold;">
                                            <i class="fas fa-calendar-plus me-2"></i>
                                            Contactar Coach
                                        </button>
                                        <div class="mt-2">
                                            <small style="opacity: 0.9;">
                                                <i class="fas fa-clock me-1"></i>30 min • <i class="fas fa-gift me-1"></i>Gratis
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Gráfico Radar y Análisis Dimensional -->
                <div class="row mb-4">
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-radar me-2"></i>${chartTitle}</h5>
                            </div>
                            <div class="card-body">
                                <div class="radar-chart-container" style="position: relative; height: 300px;">
                                    <canvas id="radarChart" width="300" height="300"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-bar me-2"></i>Puntuaciones por Dimensión</h5>
                            </div>
                            <div class="card-body">
                                <div id="dimensionalScoresContainer">
                                    ${generateDimensionalScoresHTML(dimensionalScores)}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                ${(!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && !isLeadershipAssessment && isGrowthPreparationAssessment) ? 
                    generateDetailedAnalysisHTML(detailedAnalysis || generateAnalysisFromScores(dimensionalScores)) : ''}
                
                ${(!isDiscAssessment && !isEmotionalIntelligenceAssessment && !isTeamworkAssessment && !isLeadershipAssessment && isGrowthPreparationAssessment) ? `
                <!-- Respuestas Detalladas -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-list me-2"></i>Respuestas Detalladas</h5>
                            </div>
                            <div class="card-body">
                                ${generateResponsesHTML(evaluation.responses || [], evaluation.assessment_id || data.assessment_id)}
                            </div>
                        </div>
                    </div>
                </div>
                ` : ''}

                <!-- Botones de Acción -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="d-flex justify-content-end gap-3">
                            <button type="button" class="btn btn-outline-secondary btn-modal-action" data-bs-dismiss="modal">
                                <i class="fas fa-times"></i>
                                <span>Cerrar</span>
                            </button>
                            <button type="button" class="btn btn-success btn-modal-action" onclick="requestDevelopmentPlan()" id="requestPlanBtn">
                                <i class="fas fa-user-tie"></i>
                                <span class="btn-text-full">Solicitar Plan</span>
                                <span class="btn-text-short d-none">Plan</span>
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            container.innerHTML = html;
            
            // FORZAR SCROLL AL INICIO DEL MODAL (especialmente importante en móvil)
            // Hacer scroll al tope del modal-body inmediatamente
            const modalBody = document.querySelector('#evaluationDetailsModal .modal-body');
            if (modalBody) {
                modalBody.scrollTop = 0;
            }
            
            // Crear el gráfico radar después de insertar el HTML
            setTimeout(() => {
                console.log('🎯 CALLING RADAR: About to call createRadarChart with:', {
                    dimensionalScores,
                    isDiscAssessment,
                    isEmotionalIntelligenceAssessment,
                    isLeadershipAssessment,
                    isTeamworkAssessment,
                    assessmentTitle
                });
                createRadarChart(dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isLeadershipAssessment, isTeamworkAssessment);
                
                // ASEGURAR SCROLL AL INICIO después de crear gráfico también
                if (modalBody) {
                    modalBody.scrollTop = 0;
                }
            }, 100);
        }

        function generateDimensionalScoresHTML(dimensionalScores) {
            if (!dimensionalScores) return '<p style="color: #666;">No hay datos dimensionales disponibles.</p>';
            
            let html = '';
            for (const [dimension, score] of Object.entries(dimensionalScores)) {
                const dimensionName = formatDimensionName(dimension);
                const percentage = Math.round(score);
                let colorClass = 'danger';
                if (percentage >= 70) colorClass = 'success';
                else if (percentage >= 50) colorClass = 'warning';
                
                html += `
                    <div class="mb-3">
                        <div class="d-flex justify-content-between align-items-center mb-1">
                            <strong style="color: #333;">${dimensionName}</strong>
                            <span class="badge bg-${colorClass}">${percentage}%</span>
                        </div>
                        <div class="progress" style="height: 10px; background: #e9ecef;">
                            <div class="progress-bar bg-${colorClass}" style="width: ${percentage}%"></div>
                        </div>
                        <small style="color: #666;">${getDimensionDescription(dimension, percentage)}</small>
                    </div>
                `;
            }
            return html;
        }

        function generateAnalysisFromScores(dimensionalScores) {
            if (!dimensionalScores) return null;
            
            const strengths = [];
            const improvementAreas = [];
            
            // Analizar cada dimensión
            for (const [dimension, score] of Object.entries(dimensionalScores)) {
                const percentage = Math.round(score);
                const dimensionName = formatDimensionName(dimension);
                
                if (percentage >= 70) {
                    // Es una fortaleza
                    strengths.push({
                        name: dimensionName,
                        score: percentage,
                        description: getDimensionDescription(dimension, percentage)
                    });
                } else if (percentage < 60) {
                    // Es un área de mejora
                    const priority = percentage < 40 ? 'high' : 'medium';
                    improvementAreas.push({
                        name: dimensionName,
                        score: percentage,
                        description: getDimensionDescription(dimension, percentage),
                        priority: priority
                    });
                }
            }
            
            return {
                strengths: strengths,
                improvement_areas: improvementAreas
            };
        }

        function generateDetailedAnalysisHTML(analysis) {
            let html = '<div class="row mb-4">';
            
            // Fortalezas
            if (analysis.strengths && analysis.strengths.length > 0) {
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #28a745 !important;">
                            <div class="card-header" style="background: #d4edda; color: #155724;">
                                <h6 class="mb-0"><i class="fas fa-star me-2"></i>Fortalezas Identificadas</h6>
                            </div>
                            <div class="card-body">
                `;
                
                analysis.strengths.forEach(strength => {
                    html += `
                        <div class="d-flex align-items-start mb-3">
                            <div class="flex-shrink-0">
                                <span class="badge bg-success rounded-pill">${Math.round(strength.score)}%</span>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                <strong style="color: #333;">${strength.name}</strong>
                                <p class="mb-0 small" style="color: #666;">${strength.description}</p>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Áreas de mejora
            if (analysis.improvement_areas && analysis.improvement_areas.length > 0) {
                html += `
                    <div class="col-lg-6 mb-4">
                        <div class="card border-0 h-100" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #ffc107 !important;">
                            <div class="card-header" style="background: #fff3cd; color: #856404;">
                                <h6 class="mb-0"><i class="fas fa-target me-2"></i>Áreas de Mejora</h6>
                            </div>
                            <div class="card-body">
                `;
                
                analysis.improvement_areas.forEach(area => {
                    const priorityClass = area.priority === 'high' ? 'danger' : 'warning';
                    html += `
                        <div class="d-flex align-items-start mb-3">
                            <div class="flex-shrink-0">
                                <span class="badge bg-${priorityClass} rounded-pill">${Math.round(area.score)}%</span>
                            </div>
                            <div class="flex-grow-1 ms-2">
                                <strong style="color: #333;">${area.name}</strong> 
                                <span class="badge bg-${priorityClass} ms-1">${area.priority}</span>
                                <p class="mb-0 small" style="color: #666;">${area.description}</p>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                    </div>
                `;
            }
            
            html += '</div>';
            return html;
        }

        // Función compacta para mostrar recomendaciones de forma simplificada
        function generateCompactRecommendationsHTML(recommendations) {
            if (!recommendations || recommendations.length === 0) return '';
            
            let html = `
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6; border-left: 4px solid #007bff !important;">
                            <div class="card-header d-flex align-items-center justify-content-between" style="background: #cce7ff; color: #004085;">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-lightbulb me-2"></i>
                                    <h6 class="mb-0">Plan de Desarrollo</h6>
                                </div>
                                <span class="badge bg-primary">${recommendations.length} items</span>
                            </div>
                            <div class="card-body">
            `;
            
            recommendations.forEach((rec, index) => {
                const recText = typeof rec === 'string' ? rec : rec.text || rec.description || '';
                if (recText.trim()) {
                    // Detectar si es un encabezado (contiene **)
                    if (recText.includes('**')) {
                        const cleanText = recText.replace(/\*\*/g, '');
                        if (cleanText.includes('🎯') || cleanText.includes('🚀')) {
                            html += `<div class="fw-bold text-primary mb-2 mt-3">${cleanText}</div>`;
                        } else {
                            html += `<div class="fw-bold text-dark mb-2">${cleanText}</div>`;
                        }
                    }
                    // Detectar si es una acción (empieza con ✓ o •)
                    else if (recText.startsWith('✓') || recText.startsWith('•')) {
                        html += `<div class="ms-3 mb-2"><span class="text-success fw-bold">${recText}</span></div>`;
                    }
                    // Texto normal no vacío
                    else if (recText.trim() !== '') {
                        html += `<div class="mb-1"><small>${recText}</small></div>`;
                    }
                }
            });
            
            html += `
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            return html;
        }
















        // Generar HTML de respuestas
        function generateResponsesHTML(responses, assessmentId = null) {
            if (!responses || responses.length === 0) {
                return '<p class="text-muted">No hay respuestas detalladas disponibles.</p>';
            }
            
            // Usar función específica para evaluación "Preparación para crecer 2026"
            if (assessmentId === 6) {
                return generateGrowthPreparationResponsesHTML(responses);
            }
            
            // Lógica original para otras evaluaciones (sin modificar)
            let optionLabels, maxScore;
            
            // Etiquetas estándar para escala Likert de 5 puntos (evaluaciones originales)
            optionLabels = {
                1: 'Totalmente en desacuerdo',
                2: 'En desacuerdo', 
                3: 'Neutral',
                4: 'De acuerdo',
                5: 'Totalmente de acuerdo'
            };
            maxScore = 5;
            
            let html = '';
            responses.forEach((response, index) => {
                const selectedOption = response.selected_option || response.points || 0;
                const scoreClass = selectedOption >= 4 ? 'success' : 
                                  selectedOption === 3 ? 'warning' : 'danger';
                
                html += `
                    <div class="border-start border-3 border-primary ps-3 mb-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <strong>Pregunta ${index + 1}:</strong>
                                <p class="mb-1">${response.question_text}</p>
                                <small class="text-${scoreClass}">
                                    <i class="fas fa-check-circle me-1"></i>
                                    ${optionLabels[selectedOption] || response.answer_text || 'N/A'}
                                </small>
                            </div>
                            <span class="badge bg-${scoreClass} ms-2">${selectedOption}/${maxScore}</span>
                        </div>
                    </div>
                `;
            });
            return html;
        }
        
        function getCategoryType(title) {
            if (title.includes('Fortaleza') || title.includes('Excelente')) return 'strength';
            if (title.includes('General') || title.includes('Recomendación')) return 'general';
            if (title.includes('Recuerda') || title.includes('Final')) return 'final';
            return 'dimension';
        }
        
        function getCategoryIcon(title) {
            if (title.includes('Comunicación')) return 'fas fa-comments';
            if (title.includes('Derechos')) return 'fas fa-shield-alt';
            if (title.includes('Opiniones')) return 'fas fa-bullhorn';
            if (title.includes('Conflictos')) return 'fas fa-handshake';
            if (title.includes('Autoconfianza')) return 'fas fa-user-check';
            if (title.includes('Fortaleza')) return 'fas fa-star';
            if (title.includes('General')) return 'fas fa-clipboard-list';
            if (title.includes('Recuerda')) return 'fas fa-heart';
            return 'fas fa-lightbulb';
        }
        
        function getDimensionIcon(dimension) {
            const iconMap = {
                'comunicacion': 'fas fa-comments',
                'derechos': 'fas fa-shield-alt',
                'opiniones': 'fas fa-bullhorn',
                'conflictos': 'fas fa-handshake',
                'autoconfianza': 'fas fa-user-check',
                'general': 'fas fa-clipboard-list'
            };
            return iconMap[dimension] || 'fas fa-lightbulb';
        }
        
        function getCategoryClass(type, title) {
            if (title.includes('Fortaleza') || type === 'strength') return 'strengths-category';
            if (title.includes('General') || type === 'general') return 'general-recommendations';
            if (title.includes('Recuerda') || type === 'final') return 'final-message';
            return '';
        }
        
        function getPriorityIndicator(priority) {
            const priorityClass = `priority-${priority}`;
            return `<div class="priority-indicator ${priorityClass}"></div>`;
        }
        
        function extractScoreFromTitle(title) {
            const scoreMatch = title.match(/(\d+(?:\.\d+)?)%/);
            return scoreMatch ? parseFloat(scoreMatch[1]) : null;
        }

        // ========== FUNCIONES ESPECÍFICAS PARA EVALUACIÓN "PREPARACIÓN PARA CRECER 2026" ==========
        // CACHE BUSTER: 2025-10-12-17:35:00
        
        function getGrowthPreparationOptions(question) {
            console.log('🎯 === INICIO getGrowthPreparationOptions ===');
            console.log('🎯 Full question object:', JSON.stringify(question, null, 2));
            console.log('🔍 Question dimension EXACT:', `"${question?.dimension}"`);
            console.log('🔍 Question dimension length:', question?.dimension?.length);
            console.log('🔍 Question dimension type:', typeof question?.dimension);
            
            // Opciones específicas por dimensión para la evaluación de crecimiento
            const growthOptionsByDimension = {
                'Delegación': ['Todo depende de mí', 'Delego algo, pero sigo resolviendo mucho', 'Mi equipo opera sin mí'],
                'Estructura organizacional': ['Todo es improvisado', 'Algunas áreas tienen estructura', 'Todo está formalizado'],
                'Gestión del tiempo del dueño': ['> 8 h', '4–7 h', '< 4 h (más foco en estrategia)'],
                'Finanzas': ['No confío / errores frecuentes', 'Parcialmente actualizada', 'Confiable y oportuna'],
                'Crecimiento estratégico': ['Miedo de perder control', 'Quiero crecer pero no sé cómo', 'Preparado con estrategia'],
                'Bienestar personal': ['Agotado', 'Cansado pero motivado', 'Con energía y foco'],
                'Visión a futuro': ['Frustrado', 'Inquieto pero optimista', 'Orgulloso']
            };
            
            console.log('🔍 Available dimensions in code:', Object.keys(growthOptionsByDimension));
            console.log('🔍 Exact match test:', growthOptionsByDimension.hasOwnProperty(question?.dimension));
            
            // Probar también con trim por si hay espacios
            const cleanDimension = question?.dimension?.trim();
            console.log('🔍 Clean dimension:', `"${cleanDimension}"`);
            console.log('🔍 Clean match test:', growthOptionsByDimension.hasOwnProperty(cleanDimension));
            
            const options = growthOptionsByDimension[question?.dimension] || growthOptionsByDimension[cleanDimension] || ['Opción 1', 'Opción 2', 'Opción 3'];
            console.log('🎯 Final options returned:', options);
            console.log('🎯 === FIN getGrowthPreparationOptions ===');
            return options;
        }
        
        function generateGrowthPreparationResponsesHTML(responses) {
            console.log('🔍 generateGrowthPreparationResponsesHTML - responses count:', responses ? responses.length : 0);
            
            if (!responses || responses.length === 0) {
                console.log('⚠️ No responses available');
                return '<div class="alert alert-warning">No hay respuestas detalladas disponibles.</div>';
            }

            // Mapeo de question_id a dimensión para "Preparación para crecer 2026"
            const questionIdToDimension = {
                71: "Delegación",
                72: "Estructura organizacional", 
                73: "Gestión del tiempo del dueño",
                74: "Finanzas",
                75: "Crecimiento estratégico",
                76: "Bienestar personal",
                77: "Visión a futuro"
            };
            
            // Opciones específicas por dimensión
            const growthLabelsByDimension = {
                'Delegación': {1: 'Todo depende de mí', 2: 'Delego algo, pero sigo resolviendo mucho', 3: 'Mi equipo opera sin mí'},
                'Estructura organizacional': {1: 'Todo es improvisado', 2: 'Algunas áreas tienen estructura', 3: 'Todo está formalizado'},
                'Gestión del tiempo del dueño': {1: '> 8 h', 2: '4–7 h', 3: '< 4 h (más foco en estrategia)'},
                'Finanzas': {1: 'No confío / errores frecuentes', 2: 'Parcialmente actualizada', 3: 'Confiable y oportuna'},
                'Crecimiento estratégico': {1: 'Miedo de perder control', 2: 'Quiero crecer pero no sé cómo', 3: 'Preparado con estrategia'},
                'Bienestar personal': {1: 'Agotado', 2: 'Cansado pero motivado', 3: 'Con energía y foco'},
                'Visión a futuro': {1: 'Frustrado', 2: 'Inquieto pero optimista', 3: 'Orgulloso'}
            };
            
            let html = '';
            responses.forEach((response, index) => {
                // Obtener la dimensión desde el mapeo usando question_id
                const dimension = questionIdToDimension[response.question_id] || response.dimension || 'Dimensión desconocida';
                const dimensionLabels = growthLabelsByDimension[dimension] || {1: 'Opción 1', 2: 'Opción 2', 3: 'Opción 3'};
                const selectedOption = response.selected_option || response.points || 1;
                const optionText = dimensionLabels[selectedOption] || 'N/A';
                
                const scoreClass = selectedOption === 3 ? 'success' : 
                                  selectedOption === 2 ? 'warning' : 'danger';
                
                html += `
                    <div class="border-start border-3 border-primary ps-3 mb-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <strong>${dimension}:</strong>
                                <p class="mb-1">${response.question_text}</p>
                                <small class="text-${scoreClass}">
                                    <i class="fas fa-check-circle me-1"></i>
                                    ${optionText}
                                </small>
                            </div>
                            <span class="badge bg-${scoreClass} ms-2">${selectedOption}/3</span>
                        </div>
                    </div>
                `;
            });
            
            console.log('✅ Generated responses HTML for', responses.length, 'items');
            return html;
        }
        
        function getGrowthPreparationLevelFromScore(score) {
            // Sistema de semáforo basado en porcentajes específicos
            if (score <= 30) {
                return "Alta dependencia (Rojo)";
            } else if (score <= 70) {
                return "En progreso (Amarillo)";
            } else {
                return "Preparado (Verde)";
            }
        }
        
        function generateGrowthPreparationLayout(data, evaluation, dimensionalScores) {
            const score = Math.round(data.score || evaluation.score);
            const resultText = data.result_text || evaluation.result_text || '';
            
            // Determinar el resultado basado en el puntaje
            let resultLevel, resultColor, resultIcon, respuestasC;
            if (score <= 30) {
                resultLevel = "Alta dependencia (Rojo)";
                resultColor = "#dc3545";
                resultIcon = "fas fa-exclamation-triangle";
                respuestasC = "0-2";
            } else if (score <= 70) {
                resultLevel = "En progreso (Amarillo)";
                resultColor = "#ffc107";
                resultIcon = "fas fa-clock";
                respuestasC = "3-4";
            } else {
                resultLevel = "Preparado (Verde)";
                resultColor = "#28a745";
                resultIcon = "fas fa-check-circle";
                respuestasC = "5-7";
            }
            
            return `
                <!-- Tu resultado destacado -->
                <div class="tu-resultado mb-4 p-4" style="background: ${resultColor} !important; color: white !important; border-radius: 15px; text-align: center; box-shadow: 0 6px 12px rgba(0,0,0,0.1);">
                    <h4 style="color: white !important; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.5) !important;">
                        <i class="${resultIcon} me-2" style="color: white !important;"></i>
                        <span style="color: white !important; text-shadow: 2px 2px 4px rgba(0,0,0,0.5) !important;">${resultLevel}</span>
                    </h4>
                    <p style="margin: 0; font-size: 1.2em; line-height: 1.5; font-weight: 500; color: white !important;">
                        ${resultText.split(':')[1] ? resultText.split(':')[1].trim().split('\\n\\n')[0] : resultText.split('\\n\\n')[0]}
                    </p>
                </div>

                <!-- CTA Momento Clave -->
                <div class="cta-final mb-4">
                    <div class="card" style="background: #f8f9fa; border: none; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div class="card-body text-center" style="padding: 30px;">
                            <h4 style="color: #333; margin-bottom: 20px;">
                                <i class="fas fa-gift me-2" style="color: #4facfe;"></i>
                                Momento Clave para Tu Crecimiento
                            </h4>
                            <p style="color: #333; font-size: 1.1em; line-height: 1.6; margin-bottom: 25px; font-weight: 500;">
                                ✨ "Tu resultado muestra que este es el momento clave para ti. Por eso quiero regalarte una sesión gratuita de 30 min, donde veremos cómo preparar tu negocio en este último trimestre y que el 2026 sea el año en que veas realizados tus sueños de crecimiento."
                            </p>
                            
                            <!-- Dropdown para opciones de contacto -->
                            <div class="dropdown">
                                <button class="btn btn-light btn-lg dropdown-toggle" type="button" id="contactDropdown" data-bs-toggle="dropdown" aria-expanded="false" style="padding: 12px 30px; border-radius: 25px; font-weight: bold; color: #333;">
                                    <i class="fas fa-calendar-plus me-2"></i>
                                    Agendar Sesión Gratuita
                                </button>
                                <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="contactDropdown" style="border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.15); min-width: 280px;">
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center py-3" href="https://wa.me/56994896670?text=Hola%2C%20me%20gustar%C3%ADa%20agendar%20una%20sesi%C3%B3n%20gratuita%20de%2030%20min%20para%20preparar%20mi%20negocio%20para%20el%202026" target="_blank" style="border-radius: 10px; margin: 5px;">
                                            <i class="fab fa-whatsapp me-3" style="color: #25D366; font-size: 1.2em;"></i>
                                            <div>
                                                <strong>WhatsApp</strong>
                                                <br><small class="text-muted">+56 9 9489 6670</small>
                                            </div>
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center py-3" href="mailto:coach@assessment.com?subject=Sesión%20Gratuita%20-%20Preparación%202026&body=Hola%2C%0A%0AMe%20gustar%C3%ADa%20agendar%20una%20sesi%C3%B3n%20gratuita%20de%2030%20minutos%20para%20preparar%20mi%20negocio%20para%20el%202026.%0A%0AGracias." style="border-radius: 10px; margin: 5px;">
                                            <i class="fas fa-envelope me-3" style="color: #0ea5e9; font-size: 1.2em;"></i>
                                            <div>
                                                <strong>Email</strong>
                                                <br><small class="text-muted">Enviar correo al coach</small>
                                            </div>
                                        </a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item d-flex align-items-center py-3" href="tel:+56994896670" style="border-radius: 10px; margin: 5px;">
                                            <i class="fas fa-phone me-3" style="color: #10b981; font-size: 1.2em;"></i>
                                            <div>
                                                <strong>Llamada</strong>
                                                <br><small class="text-muted">+56 9 9489 6670</small>
                                            </div>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Análisis por Dimensiones -->
                <div class="row mb-4">
                    <div class="col-lg-6">
                        <div class="card h-100" style="border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div class="card-header" style="background: #667eea; color: white;">
                                <h5 style="margin: 0; color: white;">
                                    <i class="fas fa-chart-radar me-2"></i>
                                    Radar de Dimensiones Empresariales
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="radar-chart-container" style="position: relative; height: 300px;">
                                    <canvas id="growthRadarChart" style="max-width: 100%; height: auto;"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="card h-100" style="border: none; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                            <div class="card-header" style="background: #764ba2; color: white;">
                                <h5 style="margin: 0; color: white;">
                                    <i class="fas fa-tasks me-2"></i>
                                    Puntuación por Dimensión
                                </h5>
                            </div>
                            <div class="card-body">
                                ${generateGrowthDimensionalScores(dimensionalScores)}
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function generateGrowthDimensionalScores(dimensionalScores) {
            if (!dimensionalScores) return '<p class="text-muted">No hay puntuaciones dimensionales disponibles.</p>';
            
            let html = '';
            Object.entries(dimensionalScores).forEach(([dimension, score]) => {
                // Calcular porcentaje correcto: (score - 1) / (3 - 1) * 100 = (score - 1) / 2 * 100
                const percentage = Math.round(((score - 1) / 2) * 100);
                let scoreColor, scoreIcon, scoreBadge;
                
                if (score >= 2.5) {
                    scoreColor = '#28a745';
                    scoreIcon = 'fas fa-check-circle';
                    scoreBadge = 'Verde';
                } else if (score >= 1.5) {
                    scoreColor = '#ffc107';
                    scoreIcon = 'fas fa-clock';
                    scoreBadge = 'Amarillo';
                } else {
                    scoreColor = '#dc3545';
                    scoreIcon = 'fas fa-exclamation-triangle';
                    scoreBadge = 'Rojo';
                }
                
                html += `
                    <div class="dimension-score mb-4" style="padding: 15px; border-left: 4px solid ${scoreColor}; background: #f8f9fa; border-radius: 0 8px 8px 0;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <strong style="color: #333; font-size: 1.05em;">${dimension}</strong>
                            <div class="d-flex align-items-center">
                                <span class="badge me-2" style="background: ${scoreColor}; color: white; padding: 4px 8px; border-radius: 12px;">
                                    ${scoreBadge}
                                </span>
                                <span style="color: ${scoreColor}; font-weight: bold;">
                                    <i class="${scoreIcon} me-1"></i>
                                    ${score}/3
                                </span>
                            </div>
                        </div>
                        <div class="d-flex align-items-center">
                            <div class="progress flex-grow-1 me-3" style="height: 15px; background: #e9ecef; border-radius: 8px; overflow: hidden; box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);">
                                <div class="progress-bar" style="background: linear-gradient(90deg, ${scoreColor}, ${scoreColor}cc) !important; width: ${percentage}%; border-radius: 8px; transition: width 0.8s ease;">
                                </div>
                            </div>
                            <small style="color: #666; font-weight: 600; min-width: 40px; font-size: 0.9em;">${percentage}%</small>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }
        
        function createGrowthRadarChart(dimensionalScores) {
            if (!dimensionalScores) return;
            
            const canvas = document.getElementById('growthRadarChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Obtener dimensiones de la pantalla para optimizar visualización
            const isMobile = window.innerWidth <= 768;
            const isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
            
            // Mapear nombres largos a versiones más cortas para móviles
            const dimensionLabels = Object.keys(dimensionalScores).map(key => {
                const shortLabels = {
                    'Delegación': isMobile ? 'Delegación' : 'Delegación',
                    'Estructura organizacional': isMobile ? 'Estructura' : isTablet ? 'Estructura Org.' : 'Estructura organizacional',
                    'Gestión del tiempo del dueño': isMobile ? 'Tiempo' : isTablet ? 'Gestión Tiempo' : 'Gestión del tiempo del dueño',
                    'Finanzas': 'Finanzas',
                    'Crecimiento estratégico': isMobile ? 'Estrategia' : isTablet ? 'Crecimiento' : 'Crecimiento estratégico',
                    'Bienestar personal': isMobile ? 'Bienestar' : 'Bienestar personal',
                    'Visión a futuro': isMobile ? 'Visión' : 'Visión a futuro'
                };
                return shortLabels[key] || key;
            });
            
            const values = Object.values(dimensionalScores);
            
            if (window.growthRadarChartInstance) {
                window.growthRadarChartInstance.destroy();
            }
            
            window.growthRadarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: dimensionLabels,
                    datasets: [{
                        label: 'Preparación para Crecer',
                        data: values,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    layout: {
                        padding: {
                            top: isMobile ? 20 : 10,
                            bottom: isMobile ? 20 : 10,
                            left: isMobile ? 10 : 5,
                            right: isMobile ? 10 : 5
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 3,
                            min: 0,
                            ticks: {
                                stepSize: 1,
                                color: '#666',
                                font: {
                                    size: isMobile ? 10 : 12
                                }
                            },
                            grid: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            angleLines: {
                                color: 'rgba(0,0,0,0.1)'
                            },
                            pointLabels: {
                                font: {
                                    size: isMobile ? 11 : isTablet ? 12 : 14,
                                    weight: 'bold'
                                },
                                color: '#333',
                                padding: isMobile ? 15 : 10
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                title: function(tooltipItems) {
                                    // Mostrar el nombre completo en el tooltip
                                    const index = tooltipItems[0].dataIndex;
                                    const fullNames = Object.keys(dimensionalScores);
                                    return fullNames[index];
                                }
                            }
                        }
                    }
                }
            });
            
            // Agregar estilos CSS básicos para barras de progreso y radar responsive
            if (!document.getElementById('growth-progress-styles')) {
                const style = document.createElement('style');
                style.id = 'growth-progress-styles';
                style.innerHTML = `
                    .dimension-score .progress-bar {
                        border-radius: 8px;
                    }
                    
                    /* Estilos responsive para el radar de crecimiento */
                    .radar-chart-container {
                        overflow: hidden;
                    }
                    
                    @media (max-width: 768px) {
                        .radar-chart-container {
                            height: 280px !important;
                            padding: 10px;
                        }
                        
                        #growthRadarChart {
                            max-height: 260px;
                        }
                    }
                    
                    @media (max-width: 480px) {
                        .radar-chart-container {
                            height: 250px !important;
                            padding: 5px;
                        }
                        
                        #growthRadarChart {
                            max-height: 230px;
                        }
                    }
                `;
                document.head.appendChild(style);
            }
            
            // Agregar listener para redimensionamiento de pantalla
            if (!window.growthRadarResizeListener) {
                window.growthRadarResizeListener = function() {
                    if (window.growthRadarChartInstance && dimensionalScores) {
                        // Recrear el gráfico con las nuevas dimensiones
                        setTimeout(() => {
                            createGrowthRadarChart(dimensionalScores);
                        }, 100);
                    }
                };
                window.addEventListener('resize', window.growthRadarResizeListener);
            }
        }
        
        // ========== FIN FUNCIONES ESPECÍFICAS PREPARACIÓN PARA CRECER 2026 ==========

        function getAssertiveLevelFromScore(score) {
            if (score >= 85) return 'Muy Asertivo';
            if (score >= 70) return 'Asertivo';
            if (score >= 50) return 'Moderadamente Asertivo';
            return 'Poco Asertivo';
        }

        function getDiscLevelFromScore(score) {
            // Para DISC, el perfil se basa en las dimensiones dominantes
            // Aquí usamos un enfoque simplificado basado en el score general
            if (score >= 80) return 'Perfil Altamente Definido';
            if (score >= 60) return 'Perfil Moderadamente Definido';
            if (score >= 40) return 'Perfil Equilibrado';
            return 'Perfil en Desarrollo';
        }

        function getEmotionalIntelligenceLevelFromScore(score) {
            if (score >= 85) return 'Muy Alta';
            if (score >= 70) return 'Alta';
            if (score >= 55) return 'Moderada';
            if (score >= 40) return 'Baja';
            return 'Muy Baja';
        }

        function getTeamworkLevelFromScore(score) {
            if (score >= 85) return 'Colaborador Excepcional';
            if (score >= 70) return 'Colaborador Efectivo';
            if (score >= 55) return 'Colaborador Competente';
            if (score >= 40) return 'Colaborador en Desarrollo';
            return 'Necesita Desarrollar Habilidades';
        }

        function getLeadershipLevelFromScore(score) {
            if (score >= 40) return 'Liderazgo consolidado';
            if (score >= 30) return 'Liderazgo competente';
            if (score >= 20) return 'Liderazgo en desarrollo';
            return 'Liderazgo inicial';
        }

        function getDimensionDescription(dimension, score) {
            const descriptions = {
                'comunicacion': score >= 70 ? 'Excelente comunicación interpersonal' : 'Oportunidad de mejorar la comunicación',
                'derechos': score >= 70 ? 'Sabe defender sus derechos apropiadamente' : 'Necesita fortalecer la defensa de derechos',
                'opiniones': score >= 70 ? 'Expresa opiniones con confianza' : 'Puede mejorar la expresión de opiniones',
                'conflictos': score >= 70 ? 'Maneja conflictos efectivamente' : 'Requiere desarrollo en manejo de conflictos',
                'autoconfianza': score >= 70 ? 'Alta confianza en sí mismo/a' : 'Oportunidad de fortalecer autoconfianza'
            };
            return descriptions[dimension] || 'Área de desarrollo personal';
        }

        function formatDate(dateString) {
            try {
                // Crear fecha asumiendo que viene en UTC desde el backend
                const date = new Date(dateString + (dateString.includes('Z') ? '' : 'Z'));
                
                // Convertir a zona horaria de Santiago de Chile con formato 24 horas
                return date.toLocaleDateString('es-CL', {
                    timeZone: 'America/Santiago',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: false
                });
            } catch (e) {
                return dateString;
            }
        }

        // Refresh dashboard
        async function refreshDashboard() {
            try {
                await Promise.all([
                    loadDashboardSummary(),
                    loadEvaluations(),
                    loadTasks(),
                    loadPendingEvaluations()
                    // Nota: loadContent() se carga solo cuando se activa la pestaña de contenido
                ]);
                
            } catch (error) {
                console.error('Error actualizando dashboard:', error);
                showToast('Error actualizando dashboard', 'error');
            }
        }

        // Variable global para almacenar el gráfico radar
        let radarChart = null;

        function createRadarChart(dimensionalScores, isDiscAssessment = false, isEmotionalIntelligenceAssessment = false, isLeadershipAssessment = false, isTeamworkAssessment = false) {
            console.log('🎯 RADAR DEBUG: Function called with params:', {
                isDiscAssessment,
                isEmotionalIntelligenceAssessment,
                isLeadershipAssessment,
                isTeamworkAssessment,
                dimensionalScores,
                hasCanvas: !!document.getElementById('radarChart')
            });

            const ctx = document.getElementById('radarChart');
            if (!ctx) {
                console.error('❌ RADAR ERROR: Canvas element with id "radarChart" not found');
                return;
            }
            
            if (!dimensionalScores) {
                console.error('❌ RADAR ERROR: dimensionalScores is null or undefined');
                return;
            }

            console.log('✅ RADAR DEBUG: Canvas found, creating chart with scores:', dimensionalScores);

            // Destruir gráfico existente si existe
            if (radarChart) {
                radarChart.destroy();
            }

            // Configurar dimensiones y datos según el tipo de evaluación
            let labels, dataValues, chartLabel;
            
            if (isDiscAssessment) {
                console.log('📊 RADAR DEBUG: Using DISC configuration');
                // Dimensiones DISC
                labels = [
                    'Dominante',
                    'Influyente', 
                    'Estable',
                    'Concienzudo'
                ];
                
                dataValues = [
                    dimensionalScores.Dominante || dimensionalScores.dominante || 0,
                    dimensionalScores.Influyente || dimensionalScores.influyente || 0,
                    dimensionalScores.Estable || dimensionalScores.estable || 0,
                    dimensionalScores.Concienzudo || dimensionalScores.concienzudo || 0
                ];
                
                chartLabel = 'Perfil DISC';
            } else if (isEmotionalIntelligenceAssessment) {
                console.log('🧠 RADAR DEBUG: Using Emotional Intelligence configuration');
                // Dimensiones Inteligencia Emocional
                labels = [
                    'Autoconciencia',
                    'Autorregulación',
                    'Automotivación',
                    'Empatía',
                    'Habilidades Sociales'
                ];

                dataValues = [
                    dimensionalScores.Autoconciencia || dimensionalScores.autoconciencia || 0,
                    dimensionalScores.Autorregulación || dimensionalScores.autorregulacion || 0,
                    dimensionalScores.Automotivación || dimensionalScores.automotivacion || 0,
                    dimensionalScores.Empatía || dimensionalScores.empatia || 0,
                    dimensionalScores['Habilidades Sociales'] || dimensionalScores.habilidades_sociales || 0
                ];
                
                chartLabel = 'Perfil de Inteligencia Emocional';
                console.log('🧠 RADAR DEBUG: IE data values:', dataValues);
            } else if (isLeadershipAssessment) {
                console.log('👔 RADAR DEBUG: Using Leadership configuration');
                // Usar las dimensiones originales de Liderazgo (sin traducir)
                labels = Object.keys(dimensionalScores);
                dataValues = Object.values(dimensionalScores);
                chartLabel = 'Perfil de Liderazgo';
                console.log('👔 RADAR DEBUG: Leadership data:', { labels, dataValues });
            } else if (isTeamworkAssessment) {
                console.log('🤝 RADAR DEBUG: Using Teamwork configuration');
                // Usar las dimensiones originales de Trabajo en Equipo (sin traducir)
                labels = Object.keys(dimensionalScores);
                dataValues = Object.values(dimensionalScores);
                chartLabel = 'Perfil de Trabajo en Equipo';
                console.log('🤝 RADAR DEBUG: Teamwork data:', { labels, dataValues });
            } else {
                console.log('💬 RADAR DEBUG: Using Assertiveness configuration');
                // Dimensiones Asertividad (configuración original)
                labels = [
                    'Comunicación',
                    'Derechos',
                    'Opiniones',
                    'Conflictos',
                    'Autoconfianza'
                ];

                dataValues = [
                    dimensionalScores.comunicacion || 0,
                    dimensionalScores.derechos || 0,
                    dimensionalScores.opiniones || 0,
                    dimensionalScores.conflictos || 0,
                    dimensionalScores.autoconfianza || 0
                ];
                
                chartLabel = 'Nivel de Asertividad';
            }

            console.log('📊 RADAR DEBUG: Final chart config:', {
                labels,
                dataValues,
                chartLabel
            });

            radarChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: chartLabel,
                        data: dataValues,
                        backgroundColor: 'rgba(98, 130, 227, 0.2)',
                        borderColor: 'rgba(98, 130, 227, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(98, 130, 227, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${Math.round(context.raw)}%`;
                                }
                            }
                        }
                    },
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            min: 0,
                            ticks: {
                                stepSize: 20,
                                callback: function(value) {
                                    return value + '%';
                                },
                                color: '#6B8DA6',
                                font: {
                                    size: 10
                                }
                            },
                            grid: {
                                color: 'rgba(107, 141, 166, 0.2)'
                            },
                            angleLines: {
                                color: 'rgba(107, 141, 166, 0.2)'
                            },
                            pointLabels: {
                                color: '#243447',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    elements: {
                        line: {
                            tension: 0.2
                        }
                    }
                }
            });
            
            console.log('✅ RADAR DEBUG: Chart created successfully!');
        }

        function getStatusLabel(status) {
            const labels = {
                'pending': 'Pendiente',
                'in_progress': 'En Progreso',
                'completed': 'Completada',
                'cancelled': 'Cancelada'
            };
            return labels[status] || status;
        }

        function getDimensionLabel(key) {
            const labels = {
                'comunicacion': 'Comunicación Directa',
                'derechos': 'Defensa de Derechos',
                'opiniones': 'Expresión de Opiniones',
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza'
            };
            return labels[key] || key;
        }

        // Setup event listeners
        function setupEventListeners() {
            // NOTA: Los elementos del sidebar ya tienen onclick="showTab()" en el HTML
            // NO agregamos event listeners adicionales para evitar duplicación
            // El código anterior causaba que loadTasks() se llamara DOS VECES
            
            // Sidebar click events - REMOVIDO para evitar duplicación
            // Ya no es necesario porque tenemos onclick en el HTML

            // Modal close event listener
            const evaluationDetailsModal = document.getElementById('evaluationDetailsModal');
            if (evaluationDetailsModal) {
                evaluationDetailsModal.addEventListener('hidden.bs.modal', function () {
                    console.log('Modal cerrado - restableciendo estado del dashboard');
                    
                    // Reset assessment state completely
                    isAssessmentActive = false;
                    
                    // Ensure assessment tab is hidden
                    const assessmentTab = document.getElementById('assessment-tab-item');
                    if (assessmentTab) {
                        assessmentTab.style.display = 'none';
                    }
                    
                    // Ensure assessment container is visible
                    const assessmentContainer = document.getElementById('assessmentContainer');
                    if (assessmentContainer) {
                        assessmentContainer.style.display = 'block';
                    }
                    
                    // Switch to evaluations tab to ensure proper state
                    showTab('evaluations');
                    
                    // Clear cached data
                    window.lastEvaluationId = null;
                    window.lastAssessmentData = null;
                    
                    // Force remove any modal backdrop that might be stuck
                    setTimeout(() => {
                        const backdrops = document.querySelectorAll('.modal-backdrop');
                        backdrops.forEach(backdrop => {
                            console.log('Removing stuck backdrop:', backdrop);
                            backdrop.remove();
                        });
                        
                        // Remove modal-open class from body that might block interactions
                        document.body.classList.remove('modal-open');
                        
                        // Reset body styles that might affect scrolling/interaction
                        document.body.style.overflow = '';
                        document.body.style.paddingRight = '';
                        
                        // Force refresh dashboard to ensure all elements are clickable
                        refreshDashboard();
                        
                        console.log('Dashboard completamente desbloqueado');
                    }, 100);
                    
                    console.log('Estado del dashboard restablecido completamente');
                });
            }

            // Setup content tab listeners
            setupContentTabListeners();
            
            // Setup document filters
            setupDocumentFilters();
        }

        // Setup content tab event listeners
        function setupContentTabListeners() {
            // Event listeners para las pestañas internas de contenido
            const documentsTab = document.getElementById('documents-tab');
            if (documentsTab) {
                documentsTab.addEventListener('shown.bs.tab', function() {
                    debugLog('📄 Pestaña de documentos activada');
                    // Cargar documentos si no están cargados recientemente
                    if (!documentsData || documentsData.length === 0 || 
                        !window.lastDocumentLoad || (Date.now() - window.lastDocumentLoad > 300000)) {
                        loadDocuments();
                    } else {
                        // Si ya están cargados, solo renderizar de nuevo
                        renderDocuments();
                    }
                });
                
                // También cargar en click para compatibilidad
                documentsTab.addEventListener('click', function() {
                    setTimeout(() => {
                        if (!documentsData || documentsData.length === 0 || 
                            !window.lastDocumentLoad || (Date.now() - window.lastDocumentLoad > 300000)) {
                            loadDocuments();
                        }
                    }, 100);
                });
            }
        }

        // ===== DOCUMENT MANAGEMENT FUNCTIONS =====
        
        let documentsData = [];
        let isLoadingDocuments = false;
        let filteredDocuments = [];

        // Load documents from server
        async function loadDocuments() {
            if (isLoadingDocuments) {
                debugLog('⏳ LoadDocuments ya en progreso, omitiendo llamada duplicada');
                return;
            }
            
            isLoadingDocuments = true;
            debugLog('📄 Cargando documentos...');
            
            // Mostrar spinner de carga
            const documentsContainer = document.getElementById('documentsContainer');
            if (documentsContainer) {
                documentsContainer.innerHTML = `
                    <div class="loading-spinner text-center py-4">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Cargando documentos...</span>
                        </div>
                        <p class="mt-2 text-muted">Cargando documentos...</p>
                    </div>
                `;
            }
            
            try {
                const response = await fetch(`${API_BASE_URL}/api/coachee/documents`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`Error ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                documentsData = data.documents || [];
                filteredDocuments = [...documentsData];
                window.lastDocumentLoad = Date.now();
                
                debugLog('📄 Documentos cargados:', {
                    total: documentsData.length,
                    documents: documentsData.map(d => ({
                        id: d.id,
                        title: d.title,
                        category: d.category,
                        priority: d.priority
                    }))
                });
                
                renderDocuments();
                
            } catch (error) {
                debugLog('❌ Error cargando documentos:', error);
                const documentsContainer = document.getElementById('documentsContainer');
                if (documentsContainer) {
                    documentsContainer.innerHTML = 
                        '<div class="alert alert-danger"><i class="fas fa-exclamation-triangle me-2"></i>Error cargando documentos. Inténtalo de nuevo.</div>';
                }
            } finally {
                isLoadingDocuments = false;
            }
        }

        // Render documents grid
        function renderDocuments() {
            const container = document.getElementById('documentsGrid');
            const filtersContainer = document.getElementById('documentFilters');
            const documentsContainer = document.getElementById('documentsContainer');
            
            if (!documentsData || documentsData.length === 0) {
                if (documentsContainer) {
                    documentsContainer.innerHTML = 
                        '<div class="empty-state text-center py-5"><i class="fas fa-folder-open fa-3x text-muted mb-3"></i><h5 class="text-muted">No tienes documentos asignados</h5><p class="text-muted">Tu coach aún no te ha enviado documentos.</p></div>';
                }
                if (filtersContainer) {
                    filtersContainer.style.display = 'none';
                }
                return;
            }
            
            // Ocultar el contenedor de loading y mostrar el grid
            if (documentsContainer) {
                documentsContainer.innerHTML = '';
            }
            
            // Mostrar filtros si hay documentos
            if (filtersContainer) {
                filtersContainer.style.display = 'block';
            }
            
            let html = '';
            
            filteredDocuments.forEach(doc => {
                const formatDate = (dateString) => {
                    if (!dateString) return 'Sin fecha';
                    return new Date(dateString).toLocaleDateString('es-ES', {
                        year: 'numeric',
                        month: 'short',
                        day: 'numeric'
                    });
                };
                
                const getPriorityBadge = (priority) => {
                    const badges = {
                        'urgente': 'bg-danger',
                        'alta': 'bg-warning text-dark',
                        'normal': 'bg-secondary'
                    };
                    return badges[priority] || 'bg-secondary';
                };
                
                const getCategoryIcon = (category) => {
                    const icons = {
                        'ejercicios': 'fas fa-dumbbell',
                        'teoria': 'fas fa-book',
                        'evaluacion': 'fas fa-clipboard-check',
                        'recursos': 'fas fa-tools',
                        'tarea': 'fas fa-tasks',
                        'referencias': 'fas fa-bookmark'
                    };
                    return icons[category] || 'fas fa-file';
                };
                
                const getFileTypeIcon = (filename) => {
                    if (!filename) return 'fas fa-file';
                    const ext = filename.split('.').pop().toLowerCase();
                    const icons = {
                        'pdf': 'fas fa-file-pdf text-danger',
                        'doc': 'fas fa-file-word text-primary',
                        'docx': 'fas fa-file-word text-primary',
                        'jpg': 'fas fa-image text-success',
                        'jpeg': 'fas fa-image text-success',
                        'png': 'fas fa-image text-success',
                        'gif': 'fas fa-image text-success',
                        'mp4': 'fas fa-file-video text-warning',
                        'mp3': 'fas fa-file-audio text-info',
                        'xlsx': 'fas fa-file-excel text-success',
                        'pptx': 'fas fa-file-powerpoint text-warning'
                    };
                    return icons[ext] || 'fas fa-file';
                };
                
                html += `
                    <div class="col-md-6 col-lg-4 mb-4">
                        <div class="card document-card h-100 shadow-sm">
                            <div class="card-header">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="d-flex align-items-center flex-grow-1 me-2">
                                        <i class="${getCategoryIcon(doc.category)} me-2 text-primary flex-shrink-0"></i>
                                        <span class="fw-bold text-truncate" title="${escapeHtml(doc.title)}">${escapeHtml(doc.title)}</span>
                                    </div>
                                    <span class="badge ${getPriorityBadge(doc.priority)} flex-shrink-0">${doc.priority}</span>
                                </div>
                            </div>
                            <div class="card-body d-flex flex-column">
                                ${doc.description ? `<p class="card-text text-muted small mb-3">${escapeHtml(doc.description)}</p>` : ''}
                                
                                <div class="document-files mb-3 flex-grow-1">
                                    ${doc.files && doc.files.length > 0 ? doc.files.map(file => `
                                        <div class="d-flex align-items-center justify-content-between p-2 border rounded mb-2 bg-light">
                                            <div class="d-flex align-items-center flex-grow-1 me-2 min-width-0">
                                                <i class="${getFileTypeIcon(file.filename)} me-2 flex-shrink-0"></i>
                                                <span class="text-truncate small" title="${escapeHtml(file.filename)}">${escapeHtml(file.filename)}</span>
                                            </div>
                                            <div class="btn-group btn-group-sm flex-shrink-0">
                                                <button class="btn btn-outline-primary btn-sm" 
                                                        onclick="previewDocument('${doc.id}', '${file.id}', '${escapeHtml(file.filename)}')"
                                                        title="Vista previa">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                                <button class="btn btn-outline-success btn-sm" 
                                                        onclick="downloadDocument('${doc.id}', '${file.id}', '${escapeHtml(file.filename)}')"
                                                        title="Descargar">
                                                    <i class="fas fa-download"></i>
                                                </button>
                                            </div>
                                        </div>
                                    `).join('') : '<p class="text-muted small text-center py-3"><i class="fas fa-folder-open me-1"></i>No hay archivos adjuntos</p>'}
                                </div>
                                
                                <div class="mt-auto">
                                    <div class="d-flex justify-content-between align-items-center text-muted small">
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-calendar me-1"></i>
                                            <span>${formatDate(doc.uploaded_at)}</span>
                                        </div>
                                        <div class="d-flex align-items-center">
                                            <i class="fas fa-user me-1"></i>
                                            <span class="text-truncate" title="${escapeHtml(doc.uploaded_by || 'Coach')}">${escapeHtml(doc.uploaded_by || 'Coach')}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (container) {
                container.innerHTML = html;
            }
        }

        // Preview document
        function previewDocument(documentId, fileId, filename) {
            debugLog('🔍 Vista previa de documento:', {documentId, fileId, filename});
            
            const fileExtension = filename.split('.').pop().toLowerCase();
            const previewUrl = `${API_BASE_URL}/api/coachee/documents/${documentId}/files/${fileId}/preview`;
            
            let modalContent = '';
            
            if (['jpg', 'jpeg', 'png', 'gif'].includes(fileExtension)) {
                // Preview para imágenes
                modalContent = `
                    <div class="text-center">
                        <img src="${previewUrl}" class="img-fluid" alt="${escapeHtml(filename)}" 
                             style="max-height: 70vh; object-fit: contain;">
                    </div>
                `;
            } else if (fileExtension === 'pdf') {
                // Preview para PDFs
                modalContent = `
                    <div style="height: 70vh;">
                        <iframe src="${previewUrl}" width="100%" height="100%" frameborder="0">
                            <p>No se puede mostrar el PDF. <a href="${previewUrl}" target="_blank">Abrir en nueva ventana</a></p>
                        </iframe>
                    </div>
                `;
            } else {
                // Preview genérico para otros tipos de archivo
                modalContent = `
                    <div class="text-center p-4">
                        <i class="fas fa-file fa-5x text-muted mb-3"></i>
                        <h5>${escapeHtml(filename)}</h5>
                        <p class="text-muted">Vista previa no disponible para este tipo de archivo</p>
                        <button class="btn btn-primary" onclick="downloadDocument('${documentId}', '${fileId}', '${filename}')">
                            <i class="fas fa-download me-2"></i>Descargar archivo
                        </button>
                    </div>
                `;
            }
            
            const modalHtml = `
                <div class="modal fade" id="documentPreviewModal" tabindex="-1">
                    <div class="modal-dialog modal-xl">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">
                                    <i class="fas fa-eye me-2"></i>
                                    Vista previa: ${escapeHtml(filename)}
                                </h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ${modalContent}
                            </div>
                            <div class="modal-footer">
                                <button class="btn btn-success" onclick="downloadDocument('${documentId}', '${fileId}', '${filename}')">
                                    <i class="fas fa-download me-2"></i>Descargar
                                </button>
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Eliminar modal anterior si existe
            const existingModal = document.getElementById('documentPreviewModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('documentPreviewModal'));
            modal.show();
            
            // Limpiar cuando se cierre
            document.getElementById('documentPreviewModal').addEventListener('hidden.bs.modal', function () {
                this.remove();
            });
        }

        // Download document
        function downloadDocument(documentId, fileId, filename) {
            debugLog('⬇️ Descargando documento:', {documentId, fileId, filename});
            
            const downloadUrl = `${API_BASE_URL}/api/coachee/documents/${documentId}/files/${fileId}/download`;
            
            // Crear elemento de descarga temporal
            const link = document.createElement('a');
            link.href = downloadUrl;
            link.download = filename;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Filter documents
        function filterDocuments() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const priorityFilter = document.getElementById('priorityFilter').value;
            const searchTerm = document.getElementById('searchDocuments').value.toLowerCase();
            
            filteredDocuments = documentsData.filter(doc => {
                const matchesCategory = !categoryFilter || doc.category === categoryFilter;
                const matchesPriority = !priorityFilter || doc.priority === priorityFilter;
                const matchesSearch = !searchTerm || 
                    doc.title.toLowerCase().includes(searchTerm) ||
                    (doc.description && doc.description.toLowerCase().includes(searchTerm));
                
                return matchesCategory && matchesPriority && matchesSearch;
            });
            
            renderDocuments();
        }

        // Setup document filters
        function setupDocumentFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            const priorityFilter = document.getElementById('priorityFilter');
            const searchInput = document.getElementById('searchDocuments');
            
            if (categoryFilter) {
                categoryFilter.addEventListener('change', filterDocuments);
            }
            
            if (priorityFilter) {
                priorityFilter.addEventListener('change', filterDocuments);
            }
            
            if (searchInput) {
                searchInput.addEventListener('input', filterDocuments);
            }
        }

        // Initialize application
        async function initializeApp() {
            debugLog('🚀 Inicializando dashboard de coachee...');
            
            // TEST BÁSICO DE CHART.JS ELIMINADO POR PETICIÓN DEL USUARIO
            // debugLog('🔵 Ejecutando test básico de Chart.js...');
            // setTimeout(createBasicTestChart, 100); // ELIMINADO
            
            try {
                // Create animated particles
                createParticles();
                
                // Setup event listeners
                setupEventListeners();
                
                // Setup content tab listeners
                setupContentTabListeners();
                
                // Inicializar sincronización de avatar
                setupAvatarSync();
                debugLog('🔄 Sistema de sincronización de avatar inicializado');
                
                // Load initial data
                debugLog('📊 Cargando perfil de usuario...');
                await loadUserProfile();
                
                debugLog('📊 Cargando resumen del dashboard...');
                await loadDashboardSummary();
                
                // Load data for active tab
                debugLog('📊 Cargando evaluaciones...');
                await loadEvaluations();
                
                debugLog('📊 Cargando tareas...');
                await loadTasks();
                
                debugLog('📊 Cargando historial de evaluaciones...');
                await loadEvaluationHistory();
                
                // GRÁFICO DE PRUEBA ELIMINADO POR PETICIÓN DEL USUARIO
                // debugLog('🔥 Creando gráfico de prueba...');
                // setTimeout(() => {
                //     renderTestProgressChart();
                // }, 1000); // Esperar 1 segundo para asegurar que todo esté cargado
                
                // Forzar actualización final del mensaje de bienvenida
                updateWelcomeMessage();
                
                debugLog('✅ Dashboard inicializado correctamente');
            } catch (error) {
                debugLog('❌ Error durante la inicialización del dashboard', error);
                console.error('Error en initializeApp:', error);
            }
        }
        
        // FUNCIÓN DE DEBUG TEMPORAL - Para ejecutar desde consola
        window.debugWelcomeMessage = function() {
            console.log('🔍 DEBUG Document ready state:', document.readyState);
            console.log('🔍 DEBUG All elements with id="welcomeMessage":', document.querySelectorAll('#welcomeMessage'));
            console.log('🔍 DEBUG All spans:', document.querySelectorAll('span').length);
            
            const welcomeEl = document.getElementById('welcomeMessage');
            console.log('🔍 DEBUG Element welcomeMessage:', welcomeEl);
            console.log('🔍 DEBUG Current text:', welcomeEl?.textContent);
            console.log('🔍 DEBUG Current user:', currentUser);
            
            // Buscar elementos similares
            const allSpans = document.querySelectorAll('span');
            console.log('🔍 DEBUG All spans content:');
            allSpans.forEach((span, i) => {
                if (span.textContent?.includes('Welcome')) {
                    console.log(`  Span ${i}:`, span.id, span.textContent, span);
                }
            });
            
            // Forzar actualización
            if (welcomeEl && currentUser?.full_name) {
                welcomeEl.textContent = currentUser.full_name;
                console.log('🔄 FORCED update to:', currentUser.full_name);
            } else {
                console.log('❌ Cannot update: element or user missing');
            }
        };

        // FUNCIÓN PARA FORZAR ACTUALIZACIÓN MANUAL DEL NOMBRE
        window.forceUpdateUserName = async function() {
            console.log('🔧 FORZANDO actualización del nombre de usuario...');
            
            try {
                // Intentar dashboard summary primero
                const response = await fetch(`${API_BASE_URL}/api/coachee/dashboard-summary`);
                console.log('Response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Data received:', data);
                    
                    if (data.success && data.summary?.coachee?.name) {
                        const userName = data.summary.coachee.name;
                        const welcomeText = userName;
                        const count = updateAllWelcomeMessages(welcomeText);
                        console.log(`✅ Actualizado ${count} elementos con: ${welcomeText}`);
                        return true;
                    }
                }
                
                console.log('❌ No se pudo obtener el nombre del usuario');
                return false;
                
            } catch (error) {
                console.error('❌ Error:', error);
                return false;
            }
        };

        // FUNCIÓN DE EMERGENCIA: Limpiar duplicados y actualizar
        window.fixWelcomeMessage = function() {
            // Obtener todos los elementos con id="welcomeMessage"
            const allElements = document.querySelectorAll('#welcomeMessage');
            console.log('🔍 Found', allElements.length, 'elements with id="welcomeMessage"');
            
            if (allElements.length > 1) {
                console.log('⚠️ Removing duplicates, keeping only the first one');
                // Mantener solo el primer elemento, eliminar el resto
                for (let i = 1; i < allElements.length; i++) {
                    allElements[i].remove();
                    console.log('🗑️ Removed duplicate element', i + 1);
                }
            }
            
            // Actualizar el elemento restante
            const finalElement = document.getElementById('welcomeMessage');
            if (finalElement) {
                finalElement.textContent = 'Welcome, test15!';
                console.log('✅ Updated final element:', finalElement.textContent);
                return true;
            }
            
            return false;
        };

        // FUNCIÓN PARA ACTUALIZAR TODOS LOS ELEMENTOS WELCOMEMESSAGE
        window.updateAllWelcomeMessages = function(message) {
            // Usar querySelectorAll para obtener TODOS los elementos
            const allWelcomeElements = document.querySelectorAll('#welcomeMessage');
            console.log('🔍 Found', allWelcomeElements.length, 'elements with id="welcomeMessage"');
            
            allWelcomeElements.forEach((element, index) => {
                element.textContent = message;
                console.log(`🔄 Updated element ${index + 1}:`, element);
            });
            
            return allWelcomeElements.length;
        };

        // FUNCIÓN PARA FORZAR ACTUALIZACIÓN CON DELAY
        window.forceUpdateWelcome = function() {
            setTimeout(() => {
                // Método 1: Por ID
                let welcomeEl = document.getElementById('welcomeMessage');
                
                // Método 2: Por selector CSS si no funciona ID
                if (!welcomeEl) {
                    welcomeEl = document.querySelector('#welcomeMessage');
                }
                
                // Método 3: Buscar en todos los spans que contengan "Welcome"
                if (!welcomeEl) {
                    const spans = document.querySelectorAll('span');
                    for (let span of spans) {
                        if (span.textContent && span.textContent.includes('Welcome')) {
                            welcomeEl = span;
                            console.log('🔍 Found welcome element via content search');
                            break;
                        }
                    }
                }
                
                if (welcomeEl) {
                    welcomeEl.textContent = 'Welcome, test15!';
                    console.log('🔄 FORCED update with delay successful');
                    console.log('🔄 Updated element:', welcomeEl);
                } else {
                    console.log('❌ Element still not found after delay and multiple methods');
                    
                    // Método 4: Crear el elemento si no existe
                    const h3 = document.querySelector('h3');
                    if (h3) {
                        h3.innerHTML = '<i class="fas fa-home me-2"></i><span id="welcomeMessage">Welcome, test15!</span>';
                        console.log('🔧 Created welcome element manually');
                    }
                }
            }, 2000); // Aumentar delay a 2 segundos
        };

        // Función para actualizar el mensaje de bienvenida
        function updateWelcomeMessage() {
            if (currentUser && currentUser.full_name) {
                const welcomeText = currentUser.full_name;
                const updatedCount = updateAllWelcomeMessages(welcomeText);
                console.log('🔄 Actualizados', updatedCount, 'elementos con mensaje forzado:', welcomeText);
            }
        }
        
        // Función para actualizar el avatar del header
        function updateHeaderAvatar(forceRefresh = false) {
            if (currentUser && currentUser.full_name) {
                const avatarElement = document.getElementById('headerAvatarDashboard');
                if (avatarElement) {
                    // Si hay avatar_url, mostrar imagen
                    if (currentUser.avatar_url) {
                        avatarElement.innerHTML = `<img src="${currentUser.avatar_url}" alt="${currentUser.full_name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 50%;">`;
                        console.log('✅ Avatar actualizado con imagen:', currentUser.avatar_url);
                    } else {
                        // Obtener iniciales del nombre
                        const nameParts = currentUser.full_name.trim().split(' ');
                        let initials = '';
                        if (nameParts.length >= 2) {
                            initials = nameParts[0].charAt(0) + nameParts[1].charAt(0);
                        } else {
                            initials = nameParts[0].charAt(0);
                        }
                        avatarElement.innerHTML = initials.toUpperCase();
                        console.log('✅ Avatar actualizado con iniciales:', initials);
                    }
                }
            }
        }
        
        // Sistema de sincronización de avatar entre pestañas
        function setupAvatarSync() {
            // Escuchar cambios en localStorage (cuando se actualiza en otra pestaña)
            window.addEventListener('storage', function(e) {
                if (e.key === 'avatarUpdated') {
                    console.log('🔄 Avatar actualizado en otra pestaña, recargando perfil...');
                    // Recargar perfil del usuario
                    fetch(`${API_BASE_URL}/api/coachee/profile`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success && data.profile) {
                                // Actualizar currentUser con el nuevo avatar
                                currentUser = data.profile;
                                updateHeaderAvatar(true);
                            }
                        })
                        .catch(error => console.error('Error recargando perfil:', error));
                }
            });
            
            // Verificar cambios cada 5 segundos (para misma pestaña después de volver del perfil)
            setInterval(function() {
                const lastUpdate = localStorage.getItem('avatarUpdated');
                const lastCheck = sessionStorage.getItem('lastAvatarCheck') || '0';
                
                if (lastUpdate && lastUpdate > lastCheck) {
                    console.log('🔄 Avatar actualizado detectado, recargando perfil...');
                    sessionStorage.setItem('lastAvatarCheck', Date.now().toString());
                    
                    // Recargar perfil del usuario
                    fetch(`${API_BASE_URL}/api/coachee/profile`)
                        .then(response => response.json())
                        .then(data => {
                            if (data.success && data.profile) {
                                // Actualizar currentUser con el nuevo avatar
                                currentUser = data.profile;
                                updateHeaderAvatar(true);
                            }
                        })
                        .catch(error => console.error('Error recargando perfil:', error));
                }
            }, 5000);
        }

        // Función de emergencia para desbloquear el dashboard
        function forceUnlockDashboard() {
            console.log('🚨 EMERGENCIA: Desbloqueando dashboard forzadamente');
            
            // Reset all assessment states
            isAssessmentActive = false;
            
            // Hide assessment tab
            const assessmentTab = document.getElementById('assessment-tab-item');
            if (assessmentTab) {
                assessmentTab.style.display = 'none';
            }
            
            // Show assessment container
            const assessmentContainer = document.getElementById('assessmentContainer');
            if (assessmentContainer) {
                assessmentContainer.style.display = 'block';
            }
            
            // Force close all modals
            const allModals = document.querySelectorAll('.modal');
            allModals.forEach(modal => {
                const modalInstance = bootstrap.Modal.getInstance(modal);
                if (modalInstance) {
                    modalInstance.hide();
                }
            });
            
            // Remove all modal backdrops
            const backdrops = document.querySelectorAll('.modal-backdrop');
            backdrops.forEach(backdrop => {
                backdrop.remove();
            });
            
            // Remove modal-open class from body
            document.body.classList.remove('modal-open');
            
            // Reset body styles
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';
            document.body.style.position = '';
            
            // Reset any stuck pointer-events
            document.body.style.pointerEvents = '';
            
            // Clear cached data
            window.lastEvaluationId = null;
            window.lastAssessmentData = null;
            
            // Switch to evaluations tab
            showTab('evaluations');
            
            // Force refresh
            refreshDashboard();
            
            showToast('Dashboard desbloqueado forzadamente', 'success');
            console.log('✅ Dashboard completamente desbloqueado');
        }

        // Make it globally accessible for debugging
        window.forceUnlockDashboard = forceUnlockDashboard;

        // Validar visibilidad de evaluaciones
        async function validateEvaluationVisibility(assessmentId = null) {
            try {
                showToast('Validando visibilidad de evaluaciones...', 'info');
                
                const url = assessmentId 
                    ? `/api/coachee/validate-visibility?assessment_id=${assessmentId}`
                    : '/api/coachee/validate-visibility';
                
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'same-origin'
                });
                
                const data = await response.json();
                
                if (data.valid) {
                    showValidationResults(data, true);
                } else {
                    showValidationResults(data, false);
                }
                
            } catch (error) {
                console.error('Error validando visibilidad:', error);
                showToast('Error al validar visibilidad de evaluaciones', 'error');
            }
        }

        // Mostrar resultados de validación en modal
        function showValidationResults(data, isValid) {
            const modalHtml = `
                <div class="modal fade" id="validationModal" tabindex="-1">
                    <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                            <div class="modal-header ${isValid ? 'bg-success' : 'bg-warning'} text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-${isValid ? 'check-circle' : 'exclamation-triangle'} me-2"></i>
                                    Validación de Visibilidad de Evaluaciones
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                ${generateValidationReport(data, isValid)}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                                ${isValid ? '<button type="button" class="btn btn-primary" onclick="refreshDashboard()" data-bs-dismiss="modal">Actualizar Dashboard</button>' : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal existente si existe
            const existingModal = document.getElementById('validationModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // Agregar nuevo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('validationModal'));
            modal.show();
            
            // Mostrar toast con resultado
            if (isValid) {
                showToast(`Validación exitosa: ${data.available_assessments_count || 0} evaluaciones visibles`, 'success');
            } else {
                showToast(`Problema detectado: ${data.error}`, 'warning');
            }
        }

        // Generar reporte de validación
        function generateValidationReport(data, isValid) {
            let html = '';
            
            if (isValid && data.coachee) {
                html += `
                    <div class="alert alert-success">
                        <h6><i class="fas fa-user me-2"></i>Información del Coachee</h6>
                        <strong>Nombre:</strong> ${data.coachee.full_name}<br>
                        <strong>Usuario:</strong> ${data.coachee.username}<br>
                        <strong>Coach:</strong> ${data.coachee.coach_name || 'No asignado'}
                    </div>
                `;
                
                if (data.summary) {
                    html += `
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <div class="card text-center ${data.summary.can_see_evaluations ? 'border-success' : 'border-warning'}">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.available_assessments_count || 0}</h5>
                                        <p class="card-text">Evaluaciones Disponibles</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center border-info">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.completed_assessments_count || 0}</h5>
                                        <p class="card-text">Evaluaciones Completadas</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center border-primary">
                                    <div class="card-body">
                                        <h5 class="card-title">${data.total_assessments_checked || 0}</h5>
                                        <p class="card-text">Total Evaluaciones</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                if (data.assessments && data.assessments.length > 0) {
                    html += `
                        <h6><i class="fas fa-list me-2"></i>Detalle de Evaluaciones</h6>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Evaluación</th>
                                        <th>Estado</th>
                                        <th>Preguntas</th>
                                        <th>Visible</th>
                                    </tr>
                                </thead>
                                <tbody>
                    `;
                    
                    data.assessments.forEach(assessment => {
                        const statusBadge = assessment.is_completed ? 'badge bg-success' : 
                                          assessment.visible ? 'badge bg-primary' : 'badge bg-secondary';
                        const statusText = assessment.is_completed ? 'Completada' : 
                                         assessment.visible ? 'Disponible' : 'No disponible';
                        const visibleIcon = assessment.visible ? 'fas fa-eye text-success' : 'fas fa-eye-slash text-muted';
                        
                        html += `
                            <tr>
                                <td><strong>${assessment.title}</strong></td>
                                <td><span class="${statusBadge}">${statusText}</span></td>
                                <td>${assessment.active_questions_count}</td>
                                <td><i class="${visibleIcon}"></i></td>
                            </tr>
                        `;
                    });
                    
                    html += `
                                </tbody>
                            </table>
                        </div>
                    `;
                }
            } else {
                html += `
                    <div class="alert alert-warning">
                        <h6><i class="fas fa-exclamation-triangle me-2"></i>Problema Detectado</h6>
                        <strong>Error:</strong> ${data.error}<br>
                        ${data.details ? `<strong>Detalles:</strong> ${JSON.stringify(data.details, null, 2)}` : ''}
                    </div>
                `;
                
                if (data.error.includes('coach asignado')) {
                    html += `
                        <div class="alert alert-info">
                            <h6><i class="fas fa-info-circle me-2"></i>Solución Recomendada</h6>
                            <p>Para ver evaluaciones necesitas tener un coach asignado. Contacta al administrador del sistema para:</p>
                            <ul>
                                <li>Asignarte un coach</li>
                                <li>Verificar tu cuenta</li>
                                <li>Obtener acceso a evaluaciones</li>
                            </ul>
                        </div>
                    `;
                }
            }
            
            return html;
        }

        // Verificar Chart.js availability inmediatamente
        function testChartJSAvailability() {
            console.log('🔍 TESTING Chart.js availability...');
            
            if (typeof Chart === 'undefined') {
                console.error('❌ Chart.js NOT LOADED!');
                document.body.insertAdjacentHTML('beforeend', 
                    '<div style="position: fixed; top: 10px; right: 10px; background: red; color: white; padding: 20px; z-index: 9999; border-radius: 5px;">' +
                    'ERROR: Chart.js no está disponible' +
                    '</div>'
                );
                return false;
            } else {
                console.log('✅ Chart.js is available, version:', Chart.version);
                // DIV VERDE DE "Chart.js loaded" ELIMINADO POR PETICIÓN DEL USUARIO
                // document.body.insertAdjacentHTML('beforeend', 
                //     '<div style="position: fixed; top: 10px; right: 10px; background: green; color: white; padding: 20px; z-index: 9999; border-radius: 5px;">' +
                //     'Chart.js loaded: ' + Chart.version +
                //     '</div>'
                // );
                return true;
            }
        }

        // OPTIMIZACIÓN: Flag global para prevenir inicialización múltiple
        let isAppInitialized = false;
        
        async function safeInitializeApp() {
            if (isAppInitialized) {
                console.log('⚠️ App already initialized, skipping duplicate initialization');
                return;
            }
            isAppInitialized = true;
            console.log('🚀 Starting app initialization...');
            
            testChartJSAvailability();
            await initializeApp();
            
            // Inicializar tooltips de Bootstrap
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
            
            console.log('✅ App initialization complete');
        }
        
        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', safeInitializeApp);
        } else {
            safeInitializeApp();
        }
        
        // DEBUG: Global functions for browser console debugging
        window.debugDashboard = {
            currentUser,
            dashboardData,
            evaluationsData,
            tasksData,
            contentData,
            API_BASE_URL,
            loadEvaluations,
            loadDashboardSummary,
            loadTasks,
            loadContent,
            openContent,
            markContentAsViewed,
            initializeApp,
            testConnection: async function() {
                try {
                    debugLog('🧪 Testing connection...');
                    const response = await fetch(`${API_BASE_URL}/api/coachee/evaluations`);
                    debugLog(`📡 Test response: ${response.status} ${response.statusText}`);
                    if (response.ok) {
                        const data = await response.json();
                        debugLog('📦 Test data:', data);
                        return data;
                    } else {
                        debugLog('❌ Test failed:', response);
                        return null;
                    }
                } catch (error) {
                    debugLog('❌ Test error:', error);
                    return null;
                }
            }
        };
        
        debugLog('🔧 Global debugging functions available via window.debugDashboard');

        // ========== FORZAR TEXTO BLANCO CON JAVASCRIPT ========== 
        function forceWhiteTextOnButtons() {
            const buttons = document.querySelectorAll('#scheduleCoachTabs .nav-link');
            
            buttons.forEach(button => {
                // Agregar clase para CSS
                button.classList.add('force-white-text');
                
                // Event listeners para forzar estilos
                button.addEventListener('mousedown', function() {
                    if (this.classList.contains('active')) {
                        this.style.setProperty('color', '#ffffff', 'important');
                        this.style.setProperty('background-color', '#007bff', 'important');
                        this.style.setProperty('border-color', '#007bff', 'important');
                        this.style.setProperty('transform', 'none', 'important');
                        this.style.setProperty('opacity', '1', 'important');
                        this.style.setProperty('filter', 'none', 'important');
                    }
                });
                
                button.addEventListener('mouseup', function() {
                    if (this.classList.contains('active')) {
                        this.style.setProperty('color', '#ffffff', 'important');
                        this.style.setProperty('background-color', '#007bff', 'important');
                        this.style.setProperty('border-color', '#007bff', 'important');
                    }
                });
                
                button.addEventListener('click', function() {
                    setTimeout(() => {
                        if (this.classList.contains('active')) {
                            this.style.setProperty('color', '#ffffff', 'important');
                            this.style.setProperty('background-color', '#007bff', 'important');
                            this.style.setProperty('border-color', '#007bff', 'important');
                        }
                    }, 10);
                });
                
                // Verificación continua para botones activos (capturando referencia del botón)
                const currentButton = button;
                setInterval(() => {
                    if (currentButton.classList.contains('active')) {
                        currentButton.style.setProperty('color', '#ffffff', 'important');
                        currentButton.style.setProperty('background-color', '#007bff', 'important');
                        currentButton.style.setProperty('border-color', '#007bff', 'important');
                    }
                }, 100);
            });
        }
        
        // Ejecutar cuando el DOM esté listo
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(forceWhiteTextOnButtons, 500);
        });

        // ================================
        // COACHEE CALENDAR FUNCIONES
        // ================================

        // FullCalendar JS
        const calendarScript = document.createElement('script');
        calendarScript.src = 'https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/index.global.min.js';
        calendarScript.onload = function() {
            console.log('✅ FullCalendar cargado para coachee');
            initializeCoacheeScheduling();
        };
        document.head.appendChild(calendarScript);

        function initializeCoacheeScheduling() {
            console.log('🗓️ Inicializando sistema de agendamiento para coachee');
            loadCoachAvailability();
            loadMySessions();
            setupSessionRequestForm();
        }

        function loadCoachAvailability() {
            fetch('/api/coachee/coach-availability')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayCoachAvailability(data.availability, data.occupied_slots, data.coach_name);
                    } else {
                        document.getElementById('coachAvailabilityInfo').innerHTML = 
                            '<p class="text-muted">No se pudo cargar la disponibilidad del coach</p>';
                    }
                })
                .catch(error => {
                    console.error('Error cargando disponibilidad del coach:', error);
                    document.getElementById('coachAvailabilityInfo').innerHTML = 
                        '<p class="text-danger">Error cargando disponibilidad</p>';
                });
        }

        function displayCoachAvailability(availability, occupiedSlots, coachName) {
            const container = document.getElementById('coachAvailabilityInfo');
            if (!container) return;
            
            if (availability.length === 0) {
                container.innerHTML = '<p class="text-muted">El coach no ha configurado su disponibilidad</p>';
                return;
            }
            
            const dayNames = ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'];
            
            let html = `<div class="mb-2"><strong>${coachName}</strong></div>`;
            html += '<div class="mb-3"><small class="text-muted">Horarios disponibles esta semana:</small></div>';
            
            // Calcular disponibilidad real para los próximos 7 días
            const realAvailability = calculateRealAvailability(availability, occupiedSlots);
            
            if (realAvailability.length === 0) {
                html += '<div class="alert alert-info py-2"><small>No hay horarios disponibles en los próximos 7 días.</small></div>';
            } else {
                realAvailability.forEach(slot => {
                    const date = new Date(slot.date + 'T12:00:00');
                    const dayName = dayNames[date.getDay()];
                    const dateStr = date.toLocaleDateString('es-ES', { 
                        day: '2-digit', 
                        month: '2-digit' 
                    });
                    
                    html += `
                        <div class="d-flex justify-content-between align-items-center mb-2 p-2 bg-success bg-opacity-10 border border-success border-opacity-25 rounded">
                            <div>
                                <span class="fw-medium">${dayName}</span>
                                <small class="text-muted ms-1">${dateStr}</small>
                            </div>
                            <span class="text-success fw-medium">${slot.start_time} - ${slot.end_time}</span>
                        </div>
                    `;
                });
            }
            
            // Mostrar próximas sesiones ocupadas como referencia
            if (occupiedSlots.length > 0) {
                html += '<div class="mt-3 mb-2"><small class="text-muted">Próximas sesiones ocupadas:</small></div>';
                occupiedSlots.slice(0, 3).forEach(slot => {
                    const date = new Date(slot.date + 'T12:00:00');
                    const dateStr = date.toLocaleDateString('es-ES', { 
                        day: '2-digit', 
                        month: '2-digit' 
                    });
                    html += `
                        <div class="d-flex justify-content-between align-items-center mb-1 p-1 bg-warning bg-opacity-10 rounded">
                            <span class="small">${dateStr}</span>
                            <span class="small text-warning">${slot.start_time} - ${slot.end_time}</span>
                        </div>
                    `;
                });
            }
            
            container.innerHTML = html;
        }

        function calculateRealAvailability(generalAvailability, occupiedSlots) {
            const realSlots = [];
            const today = new Date();
            
            // Analizar los próximos 7 días
            for (let i = 1; i <= 7; i++) {
                const targetDate = new Date(today);
                targetDate.setDate(today.getDate() + i);
                const dayOfWeek = targetDate.getDay();
                const dateStr = targetDate.toISOString().split('T')[0];
                
                // Buscar disponibilidad general para este día de la semana
                const dayAvailability = generalAvailability.filter(slot => slot.day_of_week === dayOfWeek);
                
                dayAvailability.forEach(generalSlot => {
                    // Buscar sesiones ocupadas en esta fecha específica
                    const dayOccupied = occupiedSlots.filter(occupied => occupied.date === dateStr);
                    
                    // Calcular horarios libres
                    const freeSlots = calculateFreeTimeSlots(
                        generalSlot.start_time,
                        generalSlot.end_time,
                        dayOccupied
                    );
                    
                    // Agregar slots libres que sean de al menos 1 hora
                    freeSlots.forEach(freeSlot => {
                        if (getMinutesDifference(freeSlot.start, freeSlot.end) >= 60) {
                            realSlots.push({
                                date: dateStr,
                                start_time: freeSlot.start,
                                end_time: freeSlot.end,
                                day_of_week: dayOfWeek
                            });
                        }
                    });
                });
            }
            
            return realSlots;
        }

        function calculateFreeTimeSlots(startTime, endTime, occupiedSlots) {
            if (occupiedSlots.length === 0) {
                return [{ start: startTime, end: endTime }];
            }
            
            const freeSlots = [];
            let currentStart = startTime;
            
            // Ordenar slots ocupados por hora de inicio
            const sortedOccupied = occupiedSlots.sort((a, b) => 
                a.start_time.localeCompare(b.start_time)
            );
            
            sortedOccupied.forEach(occupied => {
                // Si hay espacio antes de esta sesión ocupada
                if (currentStart < occupied.start_time) {
                    freeSlots.push({
                        start: currentStart,
                        end: occupied.start_time
                    });
                }
                
                // Actualizar el siguiente inicio disponible
                currentStart = occupied.end_time > currentStart ? occupied.end_time : currentStart;
            });
            
            // Si queda tiempo después de la última sesión ocupada
            if (currentStart < endTime) {
                freeSlots.push({
                    start: currentStart,
                    end: endTime
                });
            }
            
            return freeSlots;
        }

        function getMinutesDifference(startTime, endTime) {
            const [startHour, startMin] = startTime.split(':').map(Number);
            const [endHour, endMin] = endTime.split(':').map(Number);
            
            const startMinutes = startHour * 60 + startMin;
            const endMinutes = endHour * 60 + endMin;
            
            return endMinutes - startMinutes;
        }

        // Variable global para controlar que el formulario solo se configure una vez
        let sessionFormConfigured = false;

        function setupSessionRequestForm() {
            console.log('🔧 Configurando formulario de solicitud de sesión con dropdowns...');
            
            const form = document.getElementById('sessionRequestForm');
            if (!form) {
                console.warn('⚠️ Formulario sessionRequestForm no encontrado');
                return;
            }
            
            // ⚠️ IMPORTANTE: Solo configurar una vez para evitar event listeners duplicados
            if (sessionFormConfigured) {
                console.log('ℹ️ Formulario ya configurado, omitiendo configuración duplicada');
                return;
            }
            
            // Verificar que todos los elementos existan
            const sessionDate = document.getElementById('sessionDate');
            const sessionStartTime = document.getElementById('sessionStartTime');
            const sessionEndTime = document.getElementById('sessionEndTime');
            
            if (!sessionDate || !sessionStartTime || !sessionEndTime) {
                console.warn('⚠️ Algunos campos del formulario no fueron encontrados');
                return;
            }
            
            console.log('✅ Todos los campos del formulario encontrados');
            
            // Configurar fecha mínima (mañana en zona horaria de Santiago)
            sessionDate.min = getSantiagoTomorrow();
            console.log('📅 Fecha mínima configurada (Santiago):', getSantiagoTomorrow());
            
            // Configurar dropdowns de tiempo para auto-completar
            function setupTimeDropdowns() {
                console.log('🕐 Configurando dropdowns de tiempo...');
                
                // Auto-completar hora de fin cuando se selecciona hora de inicio
                sessionStartTime.addEventListener('change', function() {
                    const startTime = this.value;
                    console.log('🕐 Hora de inicio seleccionada:', startTime);
                    
                    if (startTime) {
                        const [hours, minutes] = startTime.split(':').map(Number);
                        let endHours = hours + 1;
                        
                        // Asegurar que no exceda las 20:30
                        if (endHours > 20 || (endHours === 20 && minutes > 0)) {
                            endHours = 20;
                            sessionEndTime.value = '20:30';
                        } else {
                            const endTime = `${String(endHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
                            sessionEndTime.value = endTime;
                        }
                        
                        console.log('🕐 Hora de fin auto-completada:', sessionEndTime.value);
                    }
                });
                
                // Validar que la hora de fin sea posterior a la de inicio
                sessionEndTime.addEventListener('change', function() {
                    const startTime = sessionStartTime.value;
                    const endTime = this.value;
                    
                    if (startTime && endTime) {
                        const [startHours, startMinutes] = startTime.split(':').map(Number);
                        const [endHours, endMinutes] = endTime.split(':').map(Number);
                        
                        const startTotalMinutes = startHours * 60 + startMinutes;
                        const endTotalMinutes = endHours * 60 + endMinutes;
                        
                        if (endTotalMinutes <= startTotalMinutes) {
                            showNotification('La hora de fin debe ser posterior a la hora de inicio', 'error');
                            // Resetear a una hora válida
                            const validEndHours = startHours + 1;
                            if (validEndHours <= 20) {
                                this.value = `${String(validEndHours).padStart(2, '0')}:${String(startMinutes).padStart(2, '0')}`;
                            } else {
                                this.value = '20:30';
                            }
                        }
                    }
                });
                
                console.log('✅ Dropdowns de tiempo configurados');
            }
            
            // Configurar dropdowns
            setupTimeDropdowns();
            
            // Agregar event listener al formulario (UNA SOLA VEZ)
            form.addEventListener('submit', function(e) {
                console.log('📝 Formulario enviado - procesando solicitud');
                e.preventDefault();
                
                // Validar que todos los campos estén completos
                const startTime = sessionStartTime.value;
                const endTime = sessionEndTime.value;
                const date = sessionDate.value;
                const title = document.getElementById('sessionTitle').value;
                
                if (!date || !startTime || !endTime || !title.trim()) {
                    showNotification('Por favor, complete todos los campos obligatorios', 'error');
                    return;
                }
                
                // Validar fecha (no en el pasado)
                const selectedDate = new Date(date + 'T00:00:00');
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                
                if (selectedDate < today) {
                    showNotification('No se puede solicitar una sesión en una fecha pasada', 'error');
                    return;
                }
                
                // Los dropdowns ya garantizan horarios válidos, proceder con la solicitud
                submitSessionRequest();
            });
            
            // Marcar como configurado para evitar configuraciones duplicadas
            sessionFormConfigured = true;
            console.log('✅ Formulario de solicitud con dropdowns configurado correctamente');
        }

        function submitSessionRequest() {
            const formData = {
                session_date: document.getElementById('sessionDate').value,
                start_time: document.getElementById('sessionStartTime').value,
                end_time: document.getElementById('sessionEndTime').value,
                title: document.getElementById('sessionTitle').value,
                description: document.getElementById('sessionDescription').value,
                location: document.getElementById('sessionLocation').value
            };
            
            if (!formData.session_date || !formData.start_time || !formData.end_time) {
                showNotification('Completa todos los campos requeridos', 'error');
                return;
            }
            
            // Validación básica: los dropdowns ya garantizan formato y rango válidos
            // Solo validar que la hora de fin sea posterior a la de inicio
            const startTime = new Date(`2000-01-01T${formData.start_time}:00`);
            const endTime = new Date(`2000-01-01T${formData.end_time}:00`);
            
            if (endTime <= startTime) {
                showNotification('La hora de fin debe ser posterior a la de inicio', 'error');
                return;
            }
            
            // Validar duración mínima (30 minutos) y máxima (3 horas)
            const durationMs = endTime - startTime;
            const durationMinutes = durationMs / (1000 * 60);
            
            if (durationMinutes < 30) {
                showNotification('La sesión debe durar al menos 30 minutos', 'error');
                return;
            }
            
            if (durationMinutes > 180) {
                showNotification('La sesión no puede durar más de 3 horas', 'error');
                return;
            }
            
            const submitBtn = document.querySelector('#sessionRequestForm button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Enviando...';
            submitBtn.disabled = true;
            
            fetch('/api/coachee/request-session', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Solicitud enviada correctamente. Tu coach te responderá pronto.', 'success');
                    resetSessionForm();
                    loadMySessions(); // Refrescar las sesiones
                } else {
                    showNotification(data.error || 'Error enviando solicitud', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error enviando solicitud', 'error');
            })
            .finally(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            });
        }

        function resetSessionForm() {
            document.getElementById('sessionRequestForm').reset();
            document.getElementById('sessionTitle').value = 'Sesión de Coaching';
            document.getElementById('sessionLocation').value = 'Virtual - Zoom';
        }

        function loadMySessions() {
            fetch('/api/coachee/my-sessions')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        displayMySessions(data.sessions);
                        updateMySessionsCount(data.sessions.length);
                    }
                })
                .catch(error => {
                    console.error('Error cargando mis sesiones:', error);
                    document.getElementById('mySessionsList').innerHTML = 
                        '<p class="text-danger">Error cargando sesiones</p>';
                });
        }

        function displayMySessions(sessions) {
            const container = document.getElementById('mySessionsList');
            if (!container) return;
            
            if (sessions.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-4">
                        <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No tienes sesiones programadas</p>
                        <button class="btn btn-primary" onclick="showTab('schedule-coach'); document.getElementById('schedule-request-tab').click();">
                            <i class="fas fa-plus me-2"></i>Solicitar Primera Sesión
                        </button>
                    </div>
                `;
                return;
            }
            
            // Ordenar sesiones por fecha descendente (más reciente primero)
            sessions.sort((a, b) => new Date(b.session_date + 'T12:00:00') - new Date(a.session_date + 'T12:00:00'));
            
            const html = sessions.map(session => {
                const statusColors = {
                    'pending': 'warning',
                    'confirmed': 'success',
                    'proposed': 'info',
                    'cancelled': 'danger',
                    'completed': 'secondary'
                };
                
                const statusTexts = {
                    'pending': 'Pendiente de confirmación',
                    'confirmed': 'Confirmada',
                    'proposed': 'Propuesta pendiente',
                    'cancelled': 'Cancelada',
                    'completed': 'Completada'
                };
                
                const sessionDate = new Date(session.session_date + 'T12:00:00');
                const isProposal = session.status === 'proposed' && session.original_session_id;
                
                return `
                    <div class="card mb-3">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h6 class="mb-1">${session.title}</h6>
                                    <p class="mb-1">
                                        <i class="fas fa-user me-1"></i>
                                        Coach: ${session.coach_name}
                                    </p>
                                    <p class="mb-1">
                                        <i class="fas fa-calendar me-1"></i>
                                        ${sessionDate.toLocaleDateString('es-ES', { 
                                            weekday: 'long', 
                                            year: 'numeric', 
                                            month: 'long', 
                                            day: 'numeric' 
                                        })} a las ${session.start_time}
                                    </p>
                                    <p class="mb-1">
                                        <i class="fas fa-map-marker-alt me-1"></i>
                                        ${session.location || 'Por definir'}
                                    </p>
                                    ${session.description ? `<p class="mb-1 text-muted small">${session.description}</p>` : ''}
                                    ${isProposal && session.proposal_message ? 
                                        `<div class="alert alert-info alert-sm mt-2 mb-0">
                                            <i class="fas fa-info-circle me-1"></i>
                                            <strong>Mensaje del coach:</strong> ${session.proposal_message}
                                        </div>` : ''
                                    }
                                </div>
                                <div class="col-md-4 text-end">
                                    <span class="badge bg-${statusColors[session.status]} mb-2 d-block">
                                        ${statusTexts[session.status]}
                                    </span>
                                    ${isProposal ? `
                                        <div class="d-flex gap-1 justify-content-end">
                                            <button class="btn btn-success btn-sm" onclick="respondToProposal(${session.id}, 'accept_proposal')">
                                                <i class="fas fa-check me-1"></i>Aceptar
                                            </button>
                                            <button class="btn btn-danger btn-sm" onclick="respondToProposal(${session.id}, 'reject_proposal')">
                                                <i class="fas fa-times me-1"></i>Rechazar
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            container.innerHTML = html;
        }

        function updateMySessionsCount(count) {
            const badge = document.getElementById('mySessionsCount');
            if (badge) {
                if (count > 0) {
                    badge.textContent = count;
                    badge.style.display = 'inline-block';
                } else {
                    badge.style.display = 'none';
                }
            }
        }

        function respondToProposal(sessionId, action) {
            const actionText = action === 'accept_proposal' ? 'aceptar' : 'rechazar';
            
            if (!confirm(`¿Estás seguro de que quieres ${actionText} esta propuesta?`)) {
                return;
            }
            
            fetch(`/api/coachee/session/${sessionId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ action: action })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.message, 'success');
                    loadMySessions();
                } else {
                    showNotification(data.error || 'Error procesando respuesta', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Error procesando respuesta', 'error');
            });
        }

        function refreshMySessions() {
            loadMySessions();
            showNotification('Sesiones actualizadas', 'info');
        }

        function activateRequestTab() {
            console.log('🔄 Activando pestaña de solicitud de sesión manualmente');
            
            const requestTab = document.getElementById('schedule-request-tab');
            const requestPane = document.getElementById('schedule-request-pane');
            const mySessionsTab = document.getElementById('my-sessions-tab');
            const mySessionsPane = document.getElementById('my-sessions-pane');
            
            if (requestTab && requestPane && mySessionsTab && mySessionsPane) {
                // Desactivar pestaña de sesiones
                mySessionsTab.classList.remove('active');
                mySessionsTab.setAttribute('aria-selected', 'false');
                mySessionsPane.classList.remove('show', 'active');
                
                // Activar pestaña de solicitud
                requestTab.classList.add('active');
                requestTab.setAttribute('aria-selected', 'true');
                requestPane.classList.add('show', 'active');
                
                // Configurar formulario
                setTimeout(() => {
                    setupSessionRequestForm();
                    console.log('✅ Pestaña de solicitud activada y formulario configurado');
                }, 200);
            } else {
                console.error('❌ No se pudieron encontrar las pestañas para activar');
            }
        }

        function activateMySessionsTab() {
            console.log('🔄 Activando pestaña de mis sesiones manualmente');
            
            const requestTab = document.getElementById('schedule-request-tab');
            const requestPane = document.getElementById('schedule-request-pane');
            const mySessionsTab = document.getElementById('my-sessions-tab');
            const mySessionsPane = document.getElementById('my-sessions-pane');
            
            if (requestTab && requestPane && mySessionsTab && mySessionsPane) {
                // Desactivar pestaña de solicitud
                requestTab.classList.remove('active');
                requestTab.setAttribute('aria-selected', 'false');
                requestPane.classList.remove('show', 'active');
                
                // Activar pestaña de sesiones
                mySessionsTab.classList.add('active');
                mySessionsTab.setAttribute('aria-selected', 'true');
                mySessionsPane.classList.add('show', 'active');
                
                // Cargar sesiones
                setTimeout(() => {
                    loadMySessions();
                    console.log('✅ Pestaña de mis sesiones activada y datos cargados');
                }, 200);
            } else {
                console.error('❌ No se pudieron encontrar las pestañas para activar');
            }
        }

        function switchToRequestTab() {
            console.log('🔄 Cambiando a pestaña de solicitud de sesión');
            activateRequestTab();
            showNotification('Completa el formulario para solicitar una nueva sesión', 'info');
        }

        function showNotification(message, type = 'info') {
            // Crear notificación temporal
            const notification = document.createElement('div');
            notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 15000; min-width: 300px;';
            notification.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-1"></i>
                ${message}
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Modificar showTab para incluir inicialización de agendamiento
        const originalShowTab = window.showTab;
        window.showTab = function(tabId) {
            originalShowTab(tabId);
            
            if (tabId === 'schedule-coach') {
                setTimeout(initializeCoacheeScheduling, 100); // Pequeño delay para asegurar que el DOM esté listo
            }
        };

        // Agregar event listeners para las sub-pestañas del calendario
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Inicializando sistema de pestañas del calendario');
            
            // Event listener para cuando se activa la pestaña "Solicitar Sesión"
            const scheduleRequestTab = document.getElementById('schedule-request-tab');
            if (scheduleRequestTab) {
                console.log('✅ Pestaña "Solicitar Sesión" encontrada');
                
                // Event listener para Bootstrap tab
                scheduleRequestTab.addEventListener('shown.bs.tab', function (e) {
                    console.log('🎯 Pestaña "Solicitar Sesión" activada - Reinicializando formulario');
                    setTimeout(setupSessionRequestForm, 100);
                });
                
                // Event listener manual para click
                scheduleRequestTab.addEventListener('click', function (e) {
                    console.log('👆 Click en pestaña "Solicitar Sesión"');
                    e.preventDefault();
                    activateRequestTab();
                });
            } else {
                console.error('❌ Pestaña "Solicitar Sesión" no encontrada');
            }

            // Event listener para cuando se activa la pestaña "Mis Sesiones"
            const mySessionsTab = document.getElementById('my-sessions-tab');
            if (mySessionsTab) {
                console.log('✅ Pestaña "Mis Sesiones" encontrada');
                
                mySessionsTab.addEventListener('shown.bs.tab', function (e) {
                    console.log('🎯 Pestaña "Mis Sesiones" activada - Refrescando sesiones');
                    setTimeout(loadMySessions, 100);
                });
                
                // Event listener manual para click
                mySessionsTab.addEventListener('click', function (e) {
                    console.log('👆 Click en pestaña "Mis Sesiones"');
                    e.preventDefault();
                    activateMySessionsTab();
                });
            } else {
                console.error('❌ Pestaña "Mis Sesiones" no encontrada');
            }
        });

        // Función para obtener fecha/hora en zona horaria de Santiago
        function getSantiagoDateTime() {
            const now = new Date();
            // Santiago de Chile: GMT-3 (horario de verano) o GMT-4 (horario estándar)
            // Usar Intl.DateTimeFormat para obtener la hora local correcta
            const santiagoTime = new Date(now.toLocaleString("en-US", {timeZone: "America/Santiago"}));
            return santiagoTime;
        }

        function getSantiagoDate() {
            const santiagoTime = getSantiagoDateTime();
            return santiagoTime.toISOString().split('T')[0];
        }

        function getSantiagoTomorrow() {
            const santiagoTime = getSantiagoDateTime();
            santiagoTime.setDate(santiagoTime.getDate() + 1);
            return santiagoTime.toISOString().split('T')[0];
        }

        // Función para solicitar plan de desarrollo al coach
        async function requestDevelopmentPlan() {
            try {
                // Prellenar datos del usuario actual
                if (currentUser) {
                    document.getElementById('planName').value = currentUser.full_name || '';
                    document.getElementById('planEmail').value = currentUser.email || '';
                }
                
                // Guardar el ID de evaluación actual
                document.getElementById('planEvaluationId').value = window.currentEvaluationId;
                
                // Cerrar el modal de detalles de evaluación
                const detailsModal = bootstrap.Modal.getInstance(document.getElementById('evaluationDetailsModal'));
                if (detailsModal) {
                    detailsModal.hide();
                }
                
                // Abrir el nuevo modal de solicitud de plan
                setTimeout(() => {
                    const planModal = new bootstrap.Modal(document.getElementById('requestDevelopmentPlanModal'));
                    planModal.show();
                }, 300);
                
            } catch (error) {
                console.error('Error opening development plan modal:', error);
                showToast('Error abriendo formulario de solicitud', 'error');
            }
        }
        
        // Función para enviar la solicitud de plan de desarrollo
        async function submitDevelopmentPlanRequest() {
            try {
                // Obtener datos del formulario
                const evaluationId = document.getElementById('planEvaluationId').value;
                const name = document.getElementById('planName').value.trim();
                const email = document.getElementById('planEmail').value.trim();
                const priority = document.getElementById('planPriority').value;
                const goals = document.getElementById('planGoals').value.trim();
                const message = document.getElementById('planMessage').value.trim();
                
                // Obtener áreas de enfoque seleccionadas
                const focusAreas = [];
                if (document.getElementById('focusCommunication').checked) focusAreas.push('Comunicación Efectiva');
                if (document.getElementById('focusLeadership').checked) focusAreas.push('Liderazgo de Equipos');
                if (document.getElementById('focusDecision').checked) focusAreas.push('Toma de Decisiones');
                if (document.getElementById('focusConflict').checked) focusAreas.push('Resolución de Conflictos');
                if (document.getElementById('focusEmotional').checked) focusAreas.push('Inteligencia Emocional');
                if (document.getElementById('focusProductivity').checked) focusAreas.push('Productividad Personal');
                
                // Validar campos requeridos
                if (!priority) {
                    showToast('Por favor selecciona una prioridad', 'error');
                    return;
                }
                
                if (focusAreas.length === 0) {
                    showToast('Por favor selecciona al menos un área de enfoque', 'error');
                    return;
                }
                
                // Preparar mensaje completo
                let fullMessage = `Solicitud de Plan de Desarrollo\n\n`;
                fullMessage += `Áreas de enfoque seleccionadas:\n${focusAreas.map(a => `- ${a}`).join('\n')}\n\n`;
                if (goals) fullMessage += `Objetivos específicos:\n${goals}\n\n`;
                if (message) fullMessage += `Mensaje adicional:\n${message}`;
                
                // Enviar solicitud al servidor
                const response = await fetch(`${API_BASE_URL}/api/coachee/request-development-plan`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        evaluation_id: evaluationId,
                        priority: priority,
                        focus_areas: focusAreas,
                        goals: goals,
                        message: fullMessage
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    showToast('¡Solicitud enviada exitosamente! Tu coach te contactará pronto.', 'success');
                    
                    // Cerrar el modal
                    const planModal = bootstrap.Modal.getInstance(document.getElementById('requestDevelopmentPlanModal'));
                    if (planModal) {
                        planModal.hide();
                    }
                    
                    // Limpiar formulario
                    document.getElementById('requestDevelopmentPlanForm').reset();
                    
                    // Deshabilitar el botón en el modal de detalles si está visible
                    const btn = document.getElementById('requestPlanBtn');
                    if (btn) {
                        btn.disabled = true;
                        btn.innerHTML = '<i class="fas fa-check me-1"></i>Solicitud Enviada';
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-outline-success');
                    }
                } else {
                    throw new Error(data.error || 'Error enviando solicitud');
                }
            } catch (error) {
                console.error('Error submitting development plan request:', error);
                showToast('Error enviando solicitud: ' + error.message, 'error');
            }
        }

        // Función para abrir modal de contacto con coach
        async function contactCoachForSession(event) {
            try {
                // Prellenar datos del usuario actual si están disponibles
                if (currentUser) {
                    document.getElementById('contactName').value = currentUser.full_name || '';
                    document.getElementById('contactEmail').value = currentUser.email || '';
                }
                
                // Mostrar el modal
                const modal = new bootstrap.Modal(document.getElementById('contactCoachModal'));
                modal.show();
                
            } catch (error) {
                console.error('Error opening contact coach modal:', error);
                showToast('Error abriendo formulario de contacto', 'error');
            }
        }
        
        // Función para enviar el formulario de contacto al coach
        async function submitContactCoachForm() {
            try {
                // Obtener datos del formulario
                const name = document.getElementById('contactName').value.trim();
                const email = document.getElementById('contactEmail').value.trim();
                const phone = document.getElementById('contactPhone').value.trim();
                const whatsapp = document.getElementById('contactWhatsApp').value.trim();
                const contactMethod = document.querySelector('input[name="contactMethod"]:checked').value;
                const availability = document.getElementById('contactAvailability').value.trim();
                const message = document.getElementById('contactMessage').value.trim();
                
                // Validar campos requeridos
                if (!name || !email || !phone) {
                    showToast('Por favor completa todos los campos requeridos', 'error');
                    return;
                }
                
                // Enviar solicitud al backend
                const response = await fetch(`${API_BASE_URL}/api/coachee/contact-coach-session`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        evaluation_id: window.currentEvaluationId,
                        session_type: 'free_consultation',
                        contact_data: {
                            name: name,
                            email: email,
                            phone: phone,
                            whatsapp: whatsapp || phone,
                            preferred_method: contactMethod,
                            availability: availability,
                            message: message || 'Solicito una sesión gratuita de 30 minutos para desarrollar mis habilidades.'
                        }
                    })
                });

                const data = await response.json();
                
                if (response.ok) {
                    // Cerrar el modal
                    const modal = bootstrap.Modal.getInstance(document.getElementById('contactCoachModal'));
                    if (modal) modal.hide();
                    
                    // Mostrar mensaje de éxito
                    showToast('¡Solicitud enviada! Un coach se contactará contigo pronto para coordinar tu sesión gratuita.', 'success');
                    
                    // Limpiar el formulario
                    document.getElementById('contactCoachForm').reset();
                    
                    // Opcional: Deshabilitar el botón "Contactar Coach" en los resultados
                    const buttons = document.querySelectorAll('button[onclick*="contactCoachForSession"]');
                    buttons.forEach(button => {
                        button.disabled = true;
                        button.innerHTML = '<i class="fas fa-check me-2"></i>Solicitud Enviada';
                        button.classList.remove('btn-light');
                        button.classList.add('btn-outline-success');
                    });
                } else {
                    throw new Error(data.error || 'Error enviando solicitud');
                }
            } catch (error) {
                console.error('Error submitting contact coach form:', error);
                showToast('Error enviando solicitud: ' + error.message, 'error');
            }
        }

        // Generar resumen específico para evaluación de Asertividad
        function generateAssertivenessSummary(score, dimensionalScores) {
            let summary = '';
            let generalRecommendation = '';
            
            if (score >= 80) {
                summary = 'Excelente nivel de asertividad. Mantienes un equilibrio perfecto entre expresar tus necesidades y respetar a otros.';
                generalRecommendation = 'Continúa desarrollando tus habilidades de liderazgo y considera ser mentor de otros en el desarrollo de asertividad.';
            } else if (score >= 60) {
                summary = 'Buen nivel de asertividad. Tienes habilidades sólidas con algunas áreas de mejora específicas.';
                generalRecommendation = 'Enfócate en fortalecer las dimensiones con puntuaciones más bajas. Practica técnicas de comunicación asertiva en situaciones desafiantes.';
            } else if (score >= 40) {
                summary = 'Nivel moderado de asertividad. Hay oportunidades significativas de desarrollo en varias áreas.';
                generalRecommendation = 'Considera tomar un curso de comunicación asertiva y practica técnicas de autoconfianza. Trabaja en expresar tus opiniones de manera clara y respetuosa.';
            } else {
                summary = 'Nivel bajo de asertividad. Es prioritario desarrollar estas habilidades fundamentales.';
                generalRecommendation = 'Recomendamos trabajar con un coach o tomar capacitación especializada en asertividad. Comienza con ejercicios de autoconfianza y expresión de necesidades básicas.';
            }
            
            return { summary, generalRecommendation };
        }

        // Generar sección HTML de fortalezas y debilidades para Asertividad
        function generateAssertivenessSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluación de Asertividad
            if (isDiscAssessment || isEmotionalIntelligenceAssessment || isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension) {
                            case 'comunicacion':
                                fortalezaMsg = 'Te comunicas de manera clara y directa, expresando tus ideas con confianza.';
                                break;
                            case 'derechos':
                                fortalezaMsg = 'Sabes defender tus derechos personales de manera equilibrada y respetuosa.';
                                break;
                            case 'opiniones':
                                fortalezaMsg = 'Expresas tus opiniones con seguridad y autenticidad.';
                                break;
                            case 'conflictos':
                                fortalezaMsg = 'Manejas los conflictos de manera constructiva y efectiva.';
                                break;
                            case 'autoconfianza':
                                fortalezaMsg = 'Tienes una sólida confianza en ti mismo/a y en tus capacidades.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension) {
                            case 'comunicacion':
                                debilidadMsg = 'Puedes mejorar la claridad y efectividad en tu comunicación.';
                                break;
                            case 'derechos':
                                debilidadMsg = 'Te resulta difícil defender tus derechos o establecer límites claros.';
                                break;
                            case 'opiniones':
                                debilidadMsg = 'Necesitas más confianza para expresar tus opiniones en diferentes situaciones.';
                                break;
                            case 'conflictos':
                                debilidadMsg = 'Los conflictos te generan incomodidad y podrías manejarlos de manera más efectiva.';
                                break;
                            case 'autoconfianza':
                                debilidadMsg = 'Tu autoconfianza necesita fortalecerse para actuar con mayor seguridad.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las áreas tienen potencial de mejora significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¡Excelente! Todas las áreas muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-chart-line me-2"></i>Análisis de tu Perfil de Asertividad</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-thumbs-up me-2"></i>Tus Fortalezas
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-target me-2"></i>Áreas de Oportunidad
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateDiscSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluación DISC
            if (!isDiscAssessment || isEmotionalIntelligenceAssessment || isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales DISC
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'dominance':
                            case 'dominancia':
                                fortalezaMsg = 'Tienes una personalidad decidida y orientada a resultados, excelente para liderar y tomar decisiones difíciles.';
                                break;
                            case 'influence':
                            case 'influencia':
                                fortalezaMsg = 'Posees habilidades naturales para comunicar, motivar e influir positivamente en otros.';
                                break;
                            case 'steadiness':
                            case 'estabilidad':
                                fortalezaMsg = 'Eres una persona confiable, paciente y colaborativa, creando un ambiente de trabajo estable.';
                                break;
                            case 'conscientiousness':
                            case 'cumplimiento':
                                fortalezaMsg = 'Te destacas por tu atención al detalle, calidad en el trabajo y cumplimiento de estándares.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'dominance':
                            case 'dominancia':
                                debilidadMsg = 'Puedes desarrollar mayor asertividad y capacidad de liderazgo en situaciones desafiantes.';
                                break;
                            case 'influence':
                            case 'influencia':
                                debilidadMsg = 'Podrías fortalecer tus habilidades de comunicación e influencia interpersonal.';
                                break;
                            case 'steadiness':
                            case 'estabilidad':
                                debilidadMsg = 'Desarrollar mayor paciencia y habilidades de colaboración te beneficiaría en el trabajo en equipo.';
                                break;
                            case 'conscientiousness':
                            case 'cumplimiento':
                                debilidadMsg = 'Mejorar la atención al detalle y sistematización te ayudará a alcanzar mayor calidad en tu trabajo.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las dimensiones tienen potencial de desarrollo significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¡Excelente! Todas las dimensiones muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas (DISC) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-user-circle me-2"></i>Análisis de tu Perfil DISC de Personalidad</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-star me-2"></i>Tus Fortalezas Naturales
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-chart-line me-2"></i>Áreas de Desarrollo
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateEmotionalIntelligenceSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluación de Inteligencia Emocional
            if (isDiscAssessment || !isEmotionalIntelligenceAssessment || isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales de IE
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'autoconciencia':
                            case 'self_awareness':
                                fortalezaMsg = 'Tienes un excelente conocimiento de tus emociones y cómo estas afectan tu comportamiento.';
                                break;
                            case 'autoregulacion':
                            case 'self_regulation':
                                fortalezaMsg = 'Posees gran habilidad para manejar y controlar tus emociones de manera constructiva.';
                                break;
                            case 'motivacion':
                            case 'motivation':
                                fortalezaMsg = 'Demuestras una fuerte motivación interna y capacidad para mantener el enfoque en tus objetivos.';
                                break;
                            case 'empatia':
                            case 'empathy':
                                fortalezaMsg = 'Tienes una capacidad natural para entender y conectar con las emociones de otros.';
                                break;
                            case 'habilidades_sociales':
                            case 'social_skills':
                                fortalezaMsg = 'Destacas en el manejo de relaciones interpersonales y comunicación emocional efectiva.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'autoconciencia':
                            case 'self_awareness':
                                debilidadMsg = 'Desarrollar mayor autoconciencia emocional te ayudará a entender mejor tus reacciones.';
                                break;
                            case 'autoregulacion':
                            case 'self_regulation':
                                debilidadMsg = 'Fortalecer la autoregulación te permitirá manejar mejor situaciones emocionales desafiantes.';
                                break;
                            case 'motivacion':
                            case 'motivation':
                                debilidadMsg = 'Trabajar en tu motivación interna te dará mayor resistencia ante los obstáculos.';
                                break;
                            case 'empatia':
                            case 'empathy':
                                debilidadMsg = 'Desarrollar mayor empatía mejorará significativamente tus relaciones interpersonales.';
                                break;
                            case 'habilidades_sociales':
                            case 'social_skills':
                                debilidadMsg = 'Mejorar tus habilidades sociales te permitirá comunicarte más efectivamente con otros.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las competencias emocionales tienen potencial de desarrollo significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¡Excelente! Todas las competencias muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas (IE) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-brain me-2"></i>Análisis de tu Inteligencia Emocional</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-heart me-2"></i>Tus Competencias Desarrolladas
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-seedling me-2"></i>Competencias en Desarrollo
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function generateTeamworkSummarySection(score, dimensionalScores, isDiscAssessment, isEmotionalIntelligenceAssessment, isTeamworkAssessment, isGrowthPreparationAssessment) {
            // Solo mostrar para evaluación de Trabajo en Equipo
            if (isDiscAssessment || isEmotionalIntelligenceAssessment || !isTeamworkAssessment || isGrowthPreparationAssessment) {
                return '';
            }
            
            // Analizar fortalezas y debilidades basado en puntuaciones dimensionales de Trabajo en Equipo
            let fortalezas = [];
            let debilidades = [];
            
            if (dimensionalScores) {
                for (const [dimension, dimensionScore] of Object.entries(dimensionalScores)) {
                    const dimensionName = formatDimensionName(dimension);
                    
                    if (dimensionScore >= 70) {
                        let fortalezaMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'comunicacion':
                            case 'communication':
                                fortalezaMsg = 'Excelentes habilidades de comunicación en equipo, facilitando la colaboración efectiva.';
                                break;
                            case 'colaboracion':
                            case 'collaboration':
                                fortalezaMsg = 'Demuestras una gran capacidad para trabajar de manera colaborativa y constructiva con otros.';
                                break;
                            case 'liderazgo':
                            case 'leadership':
                                fortalezaMsg = 'Posees habilidades naturales de liderazgo que inspiran y guían al equipo hacia el éxito.';
                                break;
                            case 'resolucion_conflictos':
                            case 'conflict_resolution':
                                fortalezaMsg = 'Tienes una excelente capacidad para resolver conflictos y mantener la armonía del equipo.';
                                break;
                            case 'adaptabilidad':
                            case 'adaptability':
                                fortalezaMsg = 'Tu flexibilidad y adaptabilidad son fortalezas clave para el trabajo en equipos dinámicos.';
                                break;
                        }
                        fortalezas.push({ dimension: dimensionName, mensaje: fortalezaMsg, score: Math.round(dimensionScore) });
                    } else if (dimensionScore < 60) {
                        let debilidadMsg = '';
                        switch(dimension.toLowerCase()) {
                            case 'comunicacion':
                            case 'communication':
                                debilidadMsg = 'Mejorar tu comunicación en equipo facilitará una colaboración más efectiva.';
                                break;
                            case 'colaboracion':
                            case 'collaboration':
                                debilidadMsg = 'Desarrollar mejores habilidades colaborativas te ayudará a contribuir más al equipo.';
                                break;
                            case 'liderazgo':
                            case 'leadership':
                                debilidadMsg = 'Fortalecer tus habilidades de liderazgo te permitirá guiar mejor a tu equipo.';
                                break;
                            case 'resolucion_conflictos':
                            case 'conflict_resolution':
                                debilidadMsg = 'Mejorar en resolución de conflictos creará un ambiente de trabajo más armonioso.';
                                break;
                            case 'adaptabilidad':
                            case 'adaptability':
                                debilidadMsg = 'Desarrollar mayor adaptabilidad te ayudará a responder mejor a los cambios del equipo.';
                                break;
                        }
                        debilidades.push({ dimension: dimensionName, mensaje: debilidadMsg, score: Math.round(dimensionScore) });
                    }
                }
            }
            
            // Generar HTML para fortalezas
            let fortalezasHTML = '';
            if (fortalezas.length > 0) {
                fortalezasHTML = fortalezas.map(f => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-success rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-check" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #28a745;">${f.dimension} (${f.score}%)</strong><br>
                            <span style="color: #333;">${f.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                fortalezasHTML = '<p style="color: #666; font-style: italic;">Todas las competencias de equipo tienen potencial de desarrollo significativo.</p>';
            }
            
            // Generar HTML para debilidades
            let debilidadesHTML = '';
            if (debilidades.length > 0) {
                debilidadesHTML = debilidades.map(d => `
                    <div class="d-flex align-items-start mb-3">
                        <div class="me-3">
                            <div class="badge bg-warning rounded-circle" style="width: 24px; height: 24px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-arrow-up" style="font-size: 12px;"></i>
                            </div>
                        </div>
                        <div>
                            <strong style="color: #f39c12;">${d.dimension} (${d.score}%)</strong><br>
                            <span style="color: #333;">${d.mensaje}</span>
                        </div>
                    </div>
                `).join('');
            } else {
                debilidadesHTML = '<p style="color: #666; font-style: italic;">¡Excelente! Todas las competencias muestran un buen desarrollo.</p>';
            }
            
            return `
                <!-- Fortalezas y Debilidades Detectadas (Trabajo en Equipo) -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card border-0" style="background: #f8f9fa; border: 1px solid #dee2e6;">
                            <div class="card-header" style="background: #e9ecef; border-bottom: 1px solid #dee2e6;">
                                <h5 style="color: #333;"><i class="fas fa-users me-2"></i>Análisis de tus Competencias de Trabajo en Equipo</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #28a745;">
                                            <i class="fas fa-trophy me-2"></i>Tus Fortalezas Colaborativas
                                        </h6>
                                        ${fortalezasHTML}
                                    </div>
                                    <div class="col-lg-6">
                                        <h6 class="mb-3" style="color: #f39c12;">
                                            <i class="fas fa-hand-holding-up me-2"></i>Competencias en Desarrollo
                                        </h6>
                                        ${debilidadesHTML}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        console.log('🔄 Coachee Calendar System: 2025-10-18-16:44 - Sistema de agendamiento con zona horaria Santiago');
        console.log('🇨🇱 Hora actual Santiago:', getSantiagoDateTime().toLocaleString('es-CL'));
        
        // ========== INSTAGRAM STYLE FEEDS FUNCTIONALITY ==========
        
        // Extender showTab para cargar feeds cuando se active la pestaña
        const existingShowTab = window.showTab;
        window.showTab = function(tabId) {
            existingShowTab(tabId);
            
            if (tabId === 'feeds') {
                console.log('📺 Feeds tab activated - loading Instagram style feeds');
                setTimeout(loadInstagramFeeds, 100);
            }
        };
        
        // Función para cargar feeds desde la API
        async function loadInstagramFeeds() {
            console.log('🎬 Loading Instagram style feeds...');
            
            const container = document.getElementById('feedsContainer');
            if (!container) {
                console.log('❌ Feeds container not found');
                return;
            }
            
            try {
                const response = await fetch('/api/coachee/content');
                const data = await response.json();
                
                console.log('📊 API Response for feeds:', data);
                
                if (data.success && data.content && data.content.length > 0) {
                    displayInstagramFeeds(data.content);
                } else {
                    displayNoFeeds();
                }
            } catch (error) {
                console.error('❌ Error loading feeds:', error);
                displayFeedsError();
            }
        }
        
        // Función para mostrar feeds en formato Instagram
        function displayInstagramFeeds(content) {
            const container = document.getElementById('feedsContainer');
            if (!container) return;
            
            let feedsHTML = '';
            
            content.forEach((item, index) => {
                const videoId = extractYouTubeVideoId(item.content_url);
                const isYouTubeVideo = videoId && item.content_type === 'video';
                const isDocument = item.content_type === 'document';
                
                console.log('🔍 Processing content item:', {
                    id: item.id,
                    type: item.content_type,
                    title: item.title,
                    url: item.content_url,
                    isDocument: isDocument,
                    isYouTubeVideo: isYouTubeVideo
                });
                
                // Determinar el thumbnail/preview
                let thumbnail;
                if (isYouTubeVideo) {
                    thumbnail = `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`;
                } else if (isDocument) {
                    // Para documentos, generaremos un preview
                    thumbnail = null; // Se generará dinámicamente
                } else {
                    // Fallback para otros tipos de video
                    thumbnail = 'data:image/svg+xml;base64,' + btoa(`
                        <svg width="600" height="400" xmlns="http://www.w3.org/2000/svg">
                            <rect width="600" height="400" fill="#f8f9fa"/>
                            <circle cx="300" cy="200" r="60" fill="#6c757d"/>
                            <polygon points="270,170 270,230 330,200" fill="white"/>
                        </svg>
                    `);
                }
                
                // Calcular tiempo relativo
                const timeAgo = getRelativeTime(item.assigned_at);
                
                feedsHTML += `
                    <div class="instagram-post">
                        <!-- Header del post -->
                        <div class="post-header">
                            <div class="post-author">
                                <div class="author-avatar">
                                    <i class="fas fa-user-tie"></i>
                                </div>
                                <div class="author-info">
                                    <h6>${item.coach_name}</h6>
                                    <small>${timeAgo}</small>
                                </div>
                            </div>
                            <button class="post-options">
                                <i class="fas fa-ellipsis-h"></i>
                            </button>
                        </div>
                        
                        <!-- Media del post -->
                        <div class="post-media">
                            ${isYouTubeVideo ? `
                                <div class="ratio ratio-4x3">
                                    <iframe id="youtube-feed-${item.id}" 
                                        src="https://www.youtube.com/embed/${videoId}?enablejsapi=1" 
                                        title="${item.title}" 
                                        frameborder="0" 
                                        allowfullscreen
                                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                        style="border-radius: 8px;">
                                    </iframe>
                                </div>
                            ` : isDocument ? `
                                <div class="document-preview-container" style="position: relative; height: 280px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; cursor: pointer;"
                                     onclick="openDocumentFeed('${item.content_url}', '${item.title}')">
                                    <div style="width: 100%; height: 280px; overflow-y: auto;">
                                        <canvas id="doc-preview-${item.id}"
                                                width="1200"
                                                height="1000"
                                                style="width: 100%; height: auto; border-radius: 8px; pointer-events: none; display: block;">
                                        </canvas>
                                    </div>
                                    <div class="document-overlay" style="position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.7); border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; pointer-events: none;">
                                        <i class="fas fa-file-alt" style="color: white; font-size: 16px;"></i>
                                    </div>
                                </div>
                            ` : `
                                <div onclick="openVideoFeed('${item.content_url}')">
                                    <img src="${thumbnail}" 
                                         alt="${item.title}" 
                                         class="post-image"
                                         onerror="this.src='data:image/svg+xml;base64,${btoa(`
                                             <svg width="600" height="400" xmlns="http://www.w3.org/2000/svg">
                                                 <rect width="600" height="400" fill="#f8f9fa"/>
                                                 <circle cx="300" cy="200" r="60" fill="#6c757d"/>
                                                 <polygon points="270,170 270,230 330,200" fill="white"/>
                                                 <text x="300" y="280" font-family="Arial" font-size="18" text-anchor="middle" fill="#6c757d">Video</text>
                                             </svg>
                                         `)}'">
                                    <div class="video-overlay">
                                        <i class="fas fa-play"></i>
                                    </div>
                                </div>
                            `}
                        </div>
                        
                        <!-- Acciones del post -->
                        <div class="post-actions">
                            <div class="action-buttons">
                                <button class="action-btn" onclick="toggleLikeFeed(${item.id}, this)" title="Me gusta">
                                    <i class="far fa-heart"></i>
                                </button>
                                ${isYouTubeVideo ? `
                                    <button class="action-btn" disabled style="color: #28a745; opacity: 0.7;" title="Video embebido">
                                        <i class="fas fa-play-circle"></i>
                                    </button>
                                ` : isDocument ? `
                                    <button class="action-btn" onclick="openDocumentFeed('${item.content_url}', '${item.title}')" title="Abrir documento">
                                        <i class="far fa-file-alt"></i>
                                    </button>
                                ` : `
                                    <button class="action-btn" onclick="openVideoFeed('${item.content_url}')" title="Reproducir video">
                                        <i class="far fa-play-circle"></i>
                                    </button>
                                `}
                                <button class="action-btn" onclick="shareFeed(${item.id})" title="Compartir">
                                    <i class="far fa-paper-plane"></i>
                                </button>
                            </div>
                            <button class="action-btn" title="Guardar">
                                <i class="far fa-bookmark"></i>
                            </button>
                        </div>
                        
                        <!-- Información del post -->
                        <div class="post-info">
                            <div class="post-likes">
                                <strong>${Math.floor(Math.random() * 50) + 10} me gusta</strong>
                            </div>
                            <div class="post-caption">
                                <span class="username">${item.coach_name}</span>
                                ${item.title}
                                ${item.description ? '<br><small class="text-muted">' + item.description + '</small>' : ''}
                            </div>
                            <div class="post-time">
                                ${timeAgo}
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = feedsHTML;
            console.log(`✅ Displayed ${content.length} Instagram-style feeds`);
            
            // Generar previews de documentos después de insertar el HTML
            content.forEach(item => {
                console.log(`🔍 Processing item ${item.id}: type=${item.content_type}, url=${item.content_url}`);
                if (item.content_type === 'document') {
                    const canvasId = `doc-preview-${item.id}`;
                    console.log(`📄 [DOCUMENT PREVIEW] Generating preview for document ${item.id}, canvas: ${canvasId}`);
                    console.log(`📄 [DOCUMENT PREVIEW] URL: ${item.content_url}`);
                    // Delay para asegurar que el canvas esté en el DOM
                    setTimeout(() => {
                        const canvas = document.getElementById(canvasId);
                        console.log(`📄 [DOCUMENT PREVIEW] Canvas found:`, canvas);
                        if (canvas) {
                            generateDocumentPreview(item.content_url, canvasId);
                        } else {
                            console.error(`❌ [DOCUMENT PREVIEW] Canvas not found: ${canvasId}`);
                        }
                    }, 500);
                }
            });
        }
        
        // Función para calcular tiempo relativo
        function getRelativeTime(dateString) {
            if (!dateString) return 'Hace un momento';
            
            const now = new Date();
            const date = new Date(dateString);
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays > 0) {
                return `Hace ${diffDays} día${diffDays > 1 ? 's' : ''}`;
            } else if (diffHours > 0) {
                return `Hace ${diffHours} hora${diffHours > 1 ? 's' : ''}`;
            } else {
                return 'Hace un momento';
            }
        }
        
        // Función para extraer ID de YouTube
        function extractYouTubeVideoId(url) {
            if (!url) return null;
            const regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[2].length === 11) ? match[2] : null;
        }
        
        // Función para abrir video en nueva pestaña
        function openVideoFeed(url) {
            console.log('🚀 Opening video from feed:', url);
            window.open(url, '_blank');
        }
        
        // Función para toggle like
        function toggleLikeFeed(contentId, button) {
            const icon = button.querySelector('i');
            if (icon.classList.contains('far')) {
                icon.classList.remove('far');
                icon.classList.add('fas');
                button.classList.add('liked');
            } else {
                icon.classList.remove('fas');
                icon.classList.add('far');
                button.classList.remove('liked');
            }
            console.log('❤️ Toggled like for content:', contentId);
        }
        
        // Función para compartir
        function shareFeed(contentId) {
            console.log('🔗 Sharing content:', contentId);
            showToast('¡Funcionalidad de compartir próximamente!', 'info');
        }
        
        // Función para abrir documento
        function openDocumentFeed(url, title) {
            console.log('📄 Opening document from feed:', url);
            // Crear enlace temporal para descarga
            const link = document.createElement('a');
            link.href = url;
            link.download = title || 'documento.pdf';
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Funciones de PDF.js para preview de documentos
    async function generatePDFPreview(url, canvasId, maxWidth = 1200, maxHeight = 1000) {
            console.log('📄 [PDF PREVIEW] Starting PDF preview generation for:', url);
            console.log('📄 [PDF PREVIEW] PDF.js available:', typeof pdfjsLib !== 'undefined');
            
            if (typeof pdfjsLib === 'undefined') {
                console.error('❌ [PDF PREVIEW] PDF.js not loaded');
                return;
            }
            
            try {
                const canvas = document.getElementById(canvasId);
                if (!canvas) {
                    console.error('❌ [PDF PREVIEW] Canvas element not found:', canvasId);
                    return;
                }
                
                const ctx = canvas.getContext('2d');
                
                // Configurar canvas con fondo blanco
                canvas.width = maxWidth;
                canvas.height = maxHeight;
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, maxWidth, maxHeight);
                
                console.log('📄 [PDF PREVIEW] Loading PDF document...');
                
                // Cargar PDF con configuración para CORS
                const loadingTask = pdfjsLib.getDocument({
                    url: url,
                    disableWorker: false,
                    disableAutoFetch: false,
                    disableStream: false
                });
                
                const pdf = await loadingTask.promise;
                console.log('📄 [PDF PREVIEW] PDF loaded successfully, pages:', pdf.numPages);
                
                // Obtener primera página
                const page = await pdf.getPage(1);
                const viewport = page.getViewport({ scale: 1 });
                
                // Calcular escala para ajustar al canvas manteniendo aspect ratio
                const scaleX = maxWidth / viewport.width;
                const scaleY = maxHeight / viewport.height;
                const scale = Math.min(scaleX, scaleY);
                
                const scaledViewport = page.getViewport({ scale });
                
                // Centrar la página en el canvas
                const offsetX = (maxWidth - scaledViewport.width) / 2;
                const offsetY = (maxHeight - scaledViewport.height) / 2;
                
                // Crear canvas temporal para renderizar la página
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                tempCanvas.width = scaledViewport.width;
                tempCanvas.height = scaledViewport.height;
                
                // Renderizar página en canvas temporal
                const renderContext = {
                    canvasContext: tempCtx,
                    viewport: scaledViewport
                };
                
                await page.render(renderContext).promise;
                
                // Limpiar canvas principal con fondo blanco
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, maxWidth, maxHeight);
                
                // Dibujar página centrada en canvas principal
                ctx.drawImage(tempCanvas, offsetX, offsetY);
                
                console.log('✅ PDF preview generated successfully for:', url);
                
            } catch (error) {
                console.error('❌ Error generating PDF preview:', error);
                // Mostrar icono de error en el canvas
                const canvas = document.getElementById(canvasId);
                if (canvas) {
                    const ctx = canvas.getContext('2d');
                    canvas.width = maxWidth;
                    canvas.height = maxHeight;
                    
                    // Fondo gris claro
                    ctx.fillStyle = '#f8f9fa';
                    ctx.fillRect(0, 0, maxWidth, maxHeight);
                    
                    // Dibujar texto de error
                    ctx.fillStyle = '#6c757d';
                    ctx.font = '14px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Vista previa no disponible', maxWidth/2, maxHeight/2 - 10);
                    ctx.fillText('📄 Documento PDF', maxWidth/2, maxHeight/2 + 10);
                }
            }
        }
        
        // Función para generar preview de documento (unified)
        async function generateDocumentPreview(url, canvasId) {
            console.log('📄 [DOC PREVIEW] Starting preview generation for:', url);
            console.log('📄 [DOC PREVIEW] Canvas ID:', canvasId);
            
            const canvas = document.getElementById(canvasId);
            if (!canvas) {
                console.error('❌ [DOC PREVIEW] Canvas not found:', canvasId);
                return;
            }

            const ctx = canvas.getContext('2d');
            canvas.width = 1200;
            canvas.height = 1000;
            
            // Mostrar indicador de carga inicial
            ctx.fillStyle = '#f8f9fa';
            ctx.fillRect(0, 0, 1200, 1000);
            ctx.fillStyle = '#6c757d';
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('Cargando documento...', 600, 500);
            
            // Verificar si es PDF
            if (url.toLowerCase().includes('.pdf') || url.includes('content_type=document') || url.includes('/download')) {
                console.log('📄 [DOC PREVIEW] Detected as PDF, generating PDF preview');
                try {
                    await generatePDFPreview(url, canvasId, 1200, 1000);
                } catch (error) {
                    console.error('❌ [DOC PREVIEW] PDF preview failed:', error);
                    // Mostrar icono de error
                    ctx.fillStyle = '#ffffff';
                    ctx.fillRect(0, 0, 1200, 1000);
                    ctx.fillStyle = '#dc3545';
                    ctx.font = '32px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('Error al cargar PDF', 600, 400);
                    ctx.fillStyle = '#6c757d';
                    ctx.font = '96px Arial';
                    ctx.fillText('📄', 600, 700);
                }
            } else {
                console.log('📄 [DOC PREVIEW] Non-PDF document, showing generic icon');
                // Para otros tipos de documento, mostrar icono genérico
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, 1200, 1000);
                // Dibujar icono de documento
                ctx.fillStyle = '#495057';
                ctx.font = '96px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('📄', 600, 500);
                // Texto descriptivo
                ctx.fillStyle = '#6c757d';
                ctx.font = '32px Arial';
                ctx.fillText('Documento', 600, 700);
            }
        }
        
        // Función para refrescar feeds
        function refreshFeeds() {
            console.log('🔄 Refreshing Instagram feeds...');
            const container = document.getElementById('feedsContainer');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <div class="spinner-border text-primary mb-3" role="status">
                            <span class="visually-hidden">Actualizando feeds...</span>
                        </div>
                        <p class="text-muted">Actualizando contenido...</p>
                    </div>
                `;
            }
            setTimeout(loadInstagramFeeds, 1000);
        }
        
        // Función para mostrar cuando no hay feeds
        function displayNoFeeds() {
            const container = document.getElementById('feedsContainer');
            if (container) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-stream fa-4x text-muted mb-3"></i>
                        <h5 class="text-muted">No hay feeds disponibles</h5>
                        <p class="text-muted">Tu coach aún no ha compartido contenido contigo.</p>
                        <button class="btn btn-outline-primary" onclick="refreshFeeds()">
                            <i class="fas fa-sync-alt me-1"></i>Verificar nuevamente
                        </button>
                    </div>
                `;
            }
        }
        
        // Función para mostrar error
        function displayFeedsError() {
            const container = document.getElementById('feedsContainer');
            if (container) {
                container.innerHTML = `
                    <div class="alert alert-warning text-center">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Error al cargar los feeds. 
                        <button class="btn btn-sm btn-outline-warning ms-2" onclick="refreshFeeds()">
                            Reintentar
                        </button>
                    </div>
                `;
            }
        }
        
        // ✨ AUTO-START ASSESSMENT: Detectar si viene de invitación
        // AUTO-START ASSESSMENT: This block requires server-side template rendering.
        // If using Jinja, ensure this file is processed by Flask or Django.
        // If not using a template engine, remove or replace this block with valid JavaScript.
        
        console.log('✅ Script principal completamente cargado - coacheeDashboardApp() definido');
    </script>
    
    <!-- Alpine.js - CARGAR DESPUÉS de que coacheeDashboardApp() esté definido -->
    <script src="{{ url_for('static', filename='js/alpine.min.js') }}"></script>
    
    <!-- Script común para presentación de recomendaciones -->
    <script src="{{ url_for('static', filename='js/recommendations.js') }}"></script>

    <!-- Bottom Navigation - Estilo LinkedIn -->
    <nav class="bottom-navigation">
        <a href="/coachee-feed" class="nav-item">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </a>
        
        <a href="/coachee-dashboard" class="nav-item active">
            <i class="fas fa-chart-line"></i>
            <span>Dashboard</span>
        </a>
        
        <button class="nav-item" onclick="confirmLogoutFromDashboard()">
            <i class="fas fa-sign-out-alt"></i>
            <span>Salir</span>
        </button>
    </nav>

    <script>
        // Función para confirmar logout desde dashboard
        function confirmLogoutFromDashboard() {
            if (confirm('¿Estás seguro que deseas salir?')) {
                window.location.href = '/participant-access';
            }
        }
        
        // ============================================================================
        // FUNCIONES DE CAMBIO DE CONTRASEÑA COACHEE
        // ============================================================================
        
        function openChangePasswordModalCoachee() {
            const modal = new bootstrap.Modal(document.getElementById('changePasswordModalCoachee'));
            modal.show();
            
            // Inicializar listeners de validación en tiempo real
            setTimeout(() => {
                const newPasswordInput = document.getElementById('coacheeNewPassword');
                const confirmPasswordInput = document.getElementById('coacheeConfirmPassword');
                
                if (newPasswordInput) {
                    newPasswordInput.addEventListener('input', validatePasswordPolicyCoachee);
                }
                
                if (confirmPasswordInput) {
                    confirmPasswordInput.addEventListener('input', validatePasswordMatchCoachee);
                }
            }, 100);
        }
        
        // Validar política de contraseña en tiempo real
        function validatePasswordPolicyCoachee() {
            const password = document.getElementById('coacheeNewPassword').value;
            
            // Requisitos
            const requirements = {
                length: password.length >= 8,
                uppercase: /[A-Z]/.test(password),
                lowercase: /[a-z]/.test(password),
                number: /[0-9]/.test(password),
                special: /[!@#$%^&*(),.?":{}|<>]/.test(password)
            };
            
            // Actualizar indicadores visuales
            updateRequirementIndicatorCoachee('req-length-coachee', requirements.length);
            updateRequirementIndicatorCoachee('req-uppercase-coachee', requirements.uppercase);
            updateRequirementIndicatorCoachee('req-lowercase-coachee', requirements.lowercase);
            updateRequirementIndicatorCoachee('req-number-coachee', requirements.number);
            updateRequirementIndicatorCoachee('req-special-coachee', requirements.special);
            
            return Object.values(requirements).every(r => r);
        }
        
        // Actualizar indicador de requisito
        function updateRequirementIndicatorCoachee(elementId, isValid) {
            const element = document.getElementById(elementId);
            if (!element) return;
            
            const icon = element.querySelector('i');
            
            if (isValid) {
                element.style.color = '#28a745';
                icon.className = 'fas fa-check-circle';
                icon.style.fontSize = '0.875rem';
            } else {
                element.style.color = '#6c757d';
                icon.className = 'fas fa-circle';
                icon.style.fontSize = '0.5rem';
            }
        }
        
        // Validar coincidencia de contraseñas
        function validatePasswordMatchCoachee() {
            const newPassword = document.getElementById('coacheeNewPassword').value;
            const confirmPassword = document.getElementById('coacheeConfirmPassword').value;
            const indicator = document.getElementById('passwordMatchIndicatorCoachee');
            
            if (!indicator || !confirmPassword) return;
            
            if (newPassword === confirmPassword) {
                indicator.innerHTML = '<i class="fas fa-check-circle" style="color: #28a745; margin-right: 0.5rem;"></i>Las contraseñas coinciden';
                indicator.style.color = '#28a745';
            } else {
                indicator.innerHTML = '<i class="fas fa-times-circle" style="color: #dc3545; margin-right: 0.5rem;"></i>Las contraseñas no coinciden';
                indicator.style.color = '#dc3545';
            }
        }

        async function submitPasswordChangeCoachee() {
            const currentPassword = document.getElementById('coacheeCurrentPassword').value.trim();
            const newPassword = document.getElementById('coacheeNewPassword').value.trim();
            const confirmPassword = document.getElementById('coacheeConfirmPassword').value.trim();
            
            // Validar campos
            if (!currentPassword || !newPassword || !confirmPassword) {
                alert('❌ Todos los campos son requeridos');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('❌ Las contraseñas nuevas no coinciden');
                return;
            }
            
            // Validar política completa
            const requirements = {
                length: newPassword.length >= 8,
                uppercase: /[A-Z]/.test(newPassword),
                lowercase: /[a-z]/.test(newPassword),
                number: /[0-9]/.test(newPassword),
                special: /[!@#$%^&*(),.?":{}|<>]/.test(newPassword)
            };
            
            const failedRequirements = [];
            if (!requirements.length) failedRequirements.push('mínimo 8 caracteres');
            if (!requirements.uppercase) failedRequirements.push('al menos 1 letra mayúscula');
            if (!requirements.lowercase) failedRequirements.push('al menos 1 letra minúscula');
            if (!requirements.number) failedRequirements.push('al menos 1 número');
            if (!requirements.special) failedRequirements.push('al menos 1 símbolo especial');
            
            if (failedRequirements.length > 0) {
                alert('❌ La contraseña debe cumplir: ' + failedRequirements.join(', '));
                return;
            }
            
            try {
                const response = await fetch('/api/coachee/change-password', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        current_password: currentPassword,
                        new_password: newPassword,
                        confirm_password: confirmPassword
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('✅ Contraseña actualizada correctamente');
                    bootstrap.Modal.getInstance(document.getElementById('changePasswordModalCoachee')).hide();
                    // Limpiar campos
                    document.getElementById('coacheeCurrentPassword').value = '';
                    document.getElementById('coacheeNewPassword').value = '';
                    document.getElementById('coacheeConfirmPassword').value = '';
                    // Limpiar indicadores
                    document.getElementById('passwordMatchIndicatorCoachee').innerHTML = '';
                    ['req-length-coachee', 'req-uppercase-coachee', 'req-lowercase-coachee', 'req-number-coachee', 'req-special-coachee'].forEach(id => {
                        updateRequirementIndicatorCoachee(id, false);
                    });
                } else {
                    alert('❌ Error: ' + (data.error || 'No se pudo cambiar la contraseña'));
                }
            } catch (error) {
                alert('❌ Error al cambiar la contraseña: ' + error.message);
            }
        }
    </script>

    <!-- Modal de Cambio de Contraseña para Coachee -->
    <div class="modal fade" id="changePasswordModalCoachee" tabindex="-1" aria-labelledby="changePasswordModalCoacheeLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="changePasswordModalCoacheeLabel">
                        <i class="fas fa-key me-2"></i>Cambiar Contraseña
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordFormCoachee" onsubmit="event.preventDefault(); submitPasswordChangeCoachee();">
                        <div class="mb-3">
                            <label for="coacheeCurrentPassword" class="form-label">
                                <i class="fas fa-lock me-1"></i>Contraseña Actual
                            </label>
                            <input type="password" class="form-control" id="coacheeCurrentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="coacheeNewPassword" class="form-label">
                                <i class="fas fa-key me-1"></i>Nueva Contraseña
                            </label>
                            <input type="password" class="form-control" id="coacheeNewPassword" required minlength="8">
                            
                            <!-- Indicadores de política de contraseña -->
                            <div id="passwordRequirementsCoachee" class="mt-2" style="font-size: 0.875rem;">
                                <div class="password-requirement" id="req-length-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    Mínimo 8 caracteres
                                </div>
                                <div class="password-requirement" id="req-uppercase-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    Al menos 1 letra mayúscula
                                </div>
                                <div class="password-requirement" id="req-lowercase-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    Al menos 1 letra minúscula
                                </div>
                                <div class="password-requirement" id="req-number-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    Al menos 1 número
                                </div>
                                <div class="password-requirement" id="req-special-coachee" style="color: #6c757d; margin-bottom: 0.25rem;">
                                    <i class="fas fa-circle" style="font-size: 0.5rem; margin-right: 0.5rem;"></i>
                                    Al menos 1 símbolo especial (!@#$%^&*)
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="coacheeConfirmPassword" class="form-label">
                                <i class="fas fa-check-circle me-1"></i>Confirmar Nueva Contraseña
                            </label>
                            <input type="password" class="form-control" id="coacheeConfirmPassword" required minlength="8">
                            <div id="passwordMatchIndicatorCoachee" style="font-size: 0.875rem; margin-top: 0.5rem;"></div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" onclick="submitPasswordChangeCoachee()">
                        <i class="fas fa-save me-1"></i>Cambiar Contraseña
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal: Contactar Coach para Sesión -->
    <div class="modal fade" id="contactCoachModal" tabindex="-1" aria-labelledby="contactCoachModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header modal-header-coach">
                    <h5 class="modal-title" id="contactCoachModalLabel">
                        <i class="fas fa-user-tie"></i>
                        <span>Solicitar Sesión con Coach</span>
                    </h5>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info mb-4">
                        <i class="fas fa-gift me-2"></i>
                        <strong>¡Sesión gratuita de 30 minutos!</strong><br>
                        <small>Completa tus datos y un coach te contactará pronto para coordinar tu sesión.</small>
                    </div>
                    
                    <form id="contactCoachForm">
                        <div class="mb-3">
                            <label for="contactName" class="form-label">
                                <i class="fas fa-user me-1"></i>Nombre Completo <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="contactName" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contactEmail" class="form-label">
                                <i class="fas fa-envelope me-1"></i>Email <span class="text-danger">*</span>
                            </label>
                            <input type="email" class="form-control" id="contactEmail" required>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contactPhone" class="form-label">
                                <i class="fas fa-phone me-1"></i>Teléfono <span class="text-danger">*</span>
                            </label>
                            <input type="tel" class="form-control" id="contactPhone" placeholder="+56 9 1234 5678" required>
                            <small class="form-text text-muted">Incluye código de país</small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contactWhatsApp" class="form-label">
                                <i class="fab fa-whatsapp me-1"></i>WhatsApp (opcional)
                            </label>
                            <input type="tel" class="form-control" id="contactWhatsApp" placeholder="+56 9 1234 5678">
                            <small class="form-text text-muted">Si es diferente al teléfono principal</small>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">
                                <i class="fas fa-comments me-1"></i>Método de Contacto Preferido <span class="text-danger">*</span>
                            </label>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="contactMethod" id="methodEmail" value="email" checked>
                                <label class="form-check-label" for="methodEmail">
                                    <i class="fas fa-envelope me-1"></i>Email
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="contactMethod" id="methodPhone" value="phone">
                                <label class="form-check-label" for="methodPhone">
                                    <i class="fas fa-phone me-1"></i>Teléfono
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="contactMethod" id="methodWhatsApp" value="whatsapp">
                                <label class="form-check-label" for="methodWhatsApp">
                                    <i class="fab fa-whatsapp me-1"></i>WhatsApp
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contactAvailability" class="form-label">
                                <i class="fas fa-clock me-1"></i>Horario de Disponibilidad (opcional)
                            </label>
                            <textarea class="form-control" id="contactAvailability" rows="2" placeholder="Ej: Lunes a Viernes de 9:00 a 18:00"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="contactMessage" class="form-label">
                                <i class="fas fa-message me-1"></i>Mensaje Adicional (opcional)
                            </label>
                            <textarea class="form-control" id="contactMessage" rows="3" placeholder="Comparte cualquier información adicional que consideres relevante..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i>Cancelar
                    </button>
                    <button type="button" class="btn btn-success" onclick="submitContactCoachForm()">
                        <i class="fas fa-paper-plane me-1"></i>Enviar Solicitud
                    </button>
                </div>
            </div>
        </div>
    </div>

</body>
</html>
