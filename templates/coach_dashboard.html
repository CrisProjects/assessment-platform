<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Coach - Plataforma de Asertividad</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome para íconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <!-- Chart.js para gráficos -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <!-- Bootstrap 5 JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        :root {
            /* Calm.com authentic color palette for coach interface */
            --primary-gradient: linear-gradient(135deg, #5A67D8 0%, #4C51BF 100%);
            --success-gradient: linear-gradient(135deg, #68D391 0%, #48BB78 100%);
            --warning-gradient: linear-gradient(135deg, #ED8936 0%, #DD6B20 100%);
            --danger-gradient: linear-gradient(135deg, #F56565 0%, #E53E3E 100%);
            --info-gradient: linear-gradient(135deg, #5A67D8 0%, #4C51BF 100%);
            
            /* Calm surfaces and text */
            --surface: #FFFFFF;
            --surface-hover: #F7FAFC;
            --text-primary: #2D3748;
            --text-secondary: #4A5568;
            --border-color: #E2E8F0;
            --border-hover: #CBD5E1;
            
            /* Additional Calm colors */
            --calm-background: #F7FAFC;
            --calm-primary: #5A67D8;
            --calm-secondary: #68D391;
            --calm-accent: #ED8936;
        }

        body {
            background: linear-gradient(135deg, var(--calm-background) 0%, #EDF2F7 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header personalizado */
        .custom-header {
            background: var(--primary-gradient);
            box-shadow: 0 4px 20px rgba(90, 103, 216, 0.15); /* Updated with new primary color */
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 1030;
        }

        .custom-header .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: white !important;
        }

        .custom-header .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .custom-header .nav-link:hover {
            color: white !important;
            transform: translateY(-1px);
        }

        .btn-outline-light {
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
            transition: all 0.3s ease;
        }

        .btn-outline-light:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: white;
            color: white;
            transform: translateY(-1px);
        }

        /* Cards modernos */
        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(90, 103, 216, 0.15); /* Updated with new primary color */
            border-color: var(--border-hover);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-size: 0.875rem;
        }

        /* Panel moderno */
        .modern-panel {
            background: var(--surface);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }

        .modern-panel:hover {
            box-shadow: 0 8px 40px rgba(0, 0, 0, 0.1);
        }

        .panel-header {
            background: linear-gradient(135deg, var(--surface) 0%, #f8fafc 100%);
            border-bottom: 1px solid var(--border-color);
            border-radius: 20px 20px 0 0;
        }

        .panel-title {
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
            font-size: 1.25rem;
        }

        /* Coachee Cards - Simple & Professional Design */
        .coachee-card {
            background: #ffffff;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
            cursor: pointer;
            overflow: hidden;
        }

        .coachee-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        }

        .coachee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            border-color: #d1d5db;
        }

        .coachee-name {
            font-weight: 600;
            color: #1f2937;
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
            line-height: 1.4;
        }

        .coachee-email {
            color: #6b7280;
            font-weight: 400;
            font-size: 0.875rem;
            margin-bottom: 1.25rem;
        }

        /* Stats Section - Clean Grid Layout */
        .coachee-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.25rem;
        }

        .coachee-stat {
            text-align: center;
            padding: 1rem 0.75rem;
            background: #f9fafb;
            border-radius: 8px;
            border: 1px solid #f3f4f6;
            transition: all 0.2s ease;
        }

        .coachee-stat:hover {
            background: #f3f4f6;
            border-color: #e5e7eb;
        }

        .coachee-stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.25rem;
            line-height: 1;
        }

        .coachee-stat-label {
            color: #6b7280;
            font-weight: 500;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Assessment Section - Simple & Clear */
        .last-assessment {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 1rem;
            margin-top: 0.5rem;
        }

        .assessment-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }

        .assessment-title {
            font-weight: 600;
            color: #374151;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .assessment-icon {
            width: 20px;
            height: 20px;
            background: #667eea;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.6rem;
        }

        .assessment-score {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .assessment-date {
            font-size: 0.75rem;
            color: #6b7280;
            font-weight: 400;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        /* Score Badges - Clean & Professional */
        .score-badge {
            border-radius: 6px;
            padding: 0.25rem 0.5rem;
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .score-excellent {
            background: #10b981;
            color: white;
        }

        .score-good {
            background: #3b82f6;
            color: white;
        }

        .score-average {
            background: #f59e0b;
            color: white;
        }

        .score-poor {
            background: #ef4444;
            color: white;
        }

        /* Status Badge - Simple Design */
        .status-badge {
            border-radius: 4px;
            padding: 0.2rem 0.4rem;
            font-weight: 600;
            font-size: 0.625rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-active {
            background: #10b981;
            color: white;
        }

        .status-pending {
            background: #f59e0b;
            color: white;
        }

        .status-inactive {
            background: #6b7280;
            color: white;
        }

        /* Empty State - Simple & Professional */
        .empty-state {
            text-align: center;
            padding: 3rem 2rem;
            background: #f9fafb;
            border-radius: 12px;
            border: 1px solid #e5e7eb;
        }

        .empty-state-icon {
            width: 64px;
            height: 64px;
            background: #e5e7eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            font-size: 1.5rem;
            color: #6b7280;
        }

        .empty-state h4 {
            color: var(--text-primary);
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .empty-state p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        /* Botones modernos */
        .btn-gradient {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(102, 126, 234, 0.3);
        }

        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
        }

        .btn-success-gradient {
            background: var(--success-gradient);
            border: none;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
        }

        .btn-success-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
        }

        /* Chart container */
        .chart-container {
            position: relative;
            height: 300px;
            padding: 1rem;
        }

        /* Responsive Radar Chart Container */
        .radar-chart-container {
            position: relative;
            width: 100%;
            height: 350px; /* Base height */
            max-width: 100%;
            margin: 0 auto;
        }

        .radar-chart-container canvas {
            max-width: 100% !important;
            height: auto !important;
        }

        /* Mobile optimizations for radar chart */
        @media (max-width: 576px) {
            .radar-chart-container {
                height: 280px; /* Smaller on mobile but still prominent */
                padding: 0 0.5rem;
            }
        }

        @media (min-width: 577px) and (max-width: 768px) {
            .radar-chart-container {
                height: 320px; /* Medium size for tablets */
            }
        }

        @media (min-width: 769px) and (max-width: 991px) {
            .radar-chart-container {
                height: 350px; /* Standard size for larger tablets */
            }
        }

        @media (min-width: 992px) {
            .radar-chart-container {
                height: 380px; /* Largest size for desktop */
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .stat-number {
                font-size: 2rem;
            }
            
            .chart-container {
                height: 250px;
            }
            
            .coachee-card {
                margin-bottom: 1.5rem;
                border-radius: 20px;
            }

            .coachee-name {
                font-size: 1.2rem;
            }

            .coachee-stats {
                gap: 1rem;
            }

            .coachee-stat {
                padding: 0.75rem;
            }

            .coachee-stat-number {
                font-size: 1.5rem;
            }

            .last-assessment {
                padding: 1rem;
            }

            .assessment-score {
                font-size: 1rem;
            }
        }

        @media (max-width: 576px) {
            .navbar-brand {
                font-size: 1.2rem !important;
            }
            
            .stat-number {
                font-size: 1.8rem;
            }
            
            .chart-container {
                height: 200px;
            }

            .coachee-card {
                border-radius: 12px;
                margin-bottom: 1rem;
            }

            .coachee-name {
                font-size: 1.125rem;
                line-height: 1.3;
            }

            .coachee-email {
                font-size: 0.875rem;
                margin-bottom: 1rem;
            }

            .coachee-stats {
                grid-template-columns: 1fr;
                gap: 0.75rem;
                margin-bottom: 1rem;
            }

            .coachee-stat {
                padding: 0.75rem;
                border-radius: 8px;
            }

            .coachee-stat-number {
                font-size: 1.25rem;
            }

            .coachee-stat-label {
                font-size: 0.75rem;
            }

            .last-assessment {
                padding: 0.75rem;
                border-radius: 8px;
            }

            .assessment-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .assessment-score {
                font-size: 0.875rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }

            .score-badge {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }

            .empty-state {
                padding: 2rem 1rem;
                border-radius: 12px;
            }

            .empty-state-icon {
                width: 48px;
                height: 48px;
                font-size: 1.25rem;
                margin-bottom: 1rem;
            }
        }

        /* Loading states */
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast {
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
        }

        .toast-success {
            background: var(--success-gradient);
            color: white;
        }

        .toast-error {
            background: var(--danger-gradient);
            color: white;
        }

        .toast-warning {
            background: var(--warning-gradient);
            color: white;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-gradient);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #667eea 100%);
        }

        /* CSS para modal de invitación */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .invitation-container {
            animation: slideUp 0.4s ease;
            margin: auto;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
        }
        
        .invitation-input:focus {
            border-color: #667eea !important;
            outline: none !important;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1) !important;
        }
        
        .invitation-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .invitation-btn:active {
            transform: translateY(0);
        }
        
        /* Mejoras específicas para scroll en móviles */
        @media (max-width: 640px) {
            #invitationModal {
                align-items: flex-start !important;
                padding: 10px !important;
            }
            .invitation-container {
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                max-height: calc(100vh - 20px) !important;
                border-radius: 16px !important;
            }
        }

        /* Stat cards */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            cursor: default;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            line-height: 1;
            word-break: break-word;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            margin-top: 0.5rem;
            font-weight: 500;
            text-align: center;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }

        .panel-header {
            background: #f7fafc;
            padding: 1.5rem;
            border-bottom: 1px solid #e2e8f0;
        }

        .panel-header h2 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #2d3748;
        }

        .panel-content {
            padding: 1.5rem;
        }

        .coachees-section {
            grid-column: 1 / -1;
        }

        .coachee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1rem;
        }

        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn:hover {
            background: #5a67d8;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: #718096;
        }

        .btn-secondary:hover {
            background: #4a5568;
        }

        .loading {
            text-align: center;
            padding: 2rem;
            color: #718096;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #718096;
        }

        .empty-state h3 {
            margin-bottom: 1rem;
            color: #4a5568;
        }

        .error-state {
            text-align: center;
            padding: 3rem;
            color: #e53e3e;
            background: #fed7d7;
            border: 1px solid #fc8181;
            border-radius: 8px;
            margin: 1rem 0;
        }

        .error-state h3 {
            margin-bottom: 1rem;
            color: #c53030;
        }

        .error-state button:hover {
            background: #0056b3 !important;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 1rem;
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .refresh-btn {
            background: #48bb78;
            border: none;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .refresh-btn:hover {
            background: #38a169;
        }

        /* Responsive Design Improvements */
        
        /* Tablet Portrait (768px - 1024px) */
        @media (max-width: 1024px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
                text-align: center;
            }
            
            .header h1 {
                font-size: 1.6rem;
            }
            
            .container {
                padding: 1.5rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
                gap: 1rem;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }
        }

        /* Mobile Landscape (481px - 768px) */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .header-content {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }
            
            .header h1 {
                font-size: 1.4rem;
            }
            
            .user-info {
                flex-direction: column;
                gap: 0.5rem;
                font-size: 0.9rem;
            }
            
            .logout-btn {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
            }
            
            .container {
                padding: 1rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr 1fr;
                gap: 0.8rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-number {
                font-size: 2rem;
            }
            
            .stat-label {
                font-size: 0.8rem;
            }
            
            .main-content {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .panel-header {
                padding: 1rem;
            }
            
            .panel-header h2 {
                font-size: 1.1rem;
            }
            
            .panel-content {
                padding: 1rem;
            }
            
            .coachee-grid {
                grid-template-columns: 1fr;
                gap: 0.8rem;
            }
            
            .coachee-card {
                padding: 1.5rem 1rem;
            }
            
            .chart-container {
                height: 250px;
            }
        }

        /* Mobile Portrait (320px - 480px) */
        @media (max-width: 480px) {
            .header {
                padding: 0.8rem;
            }
            
            .header-content {
                flex-direction: column;
                gap: 0.8rem;
                text-align: center;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .user-info {
                flex-direction: column;
                gap: 0.5rem;
                font-size: 0.85rem;
                width: 100%;
            }
            
            .logout-btn {
                padding: 0.5rem 1rem;
                font-size: 0.8rem;
                width: auto;
                min-width: 120px;
            }
            
            .container {
                padding: 0.8rem;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 0.8rem;
                margin-bottom: 1.5rem;
            }
            
            .stat-card {
                padding: 1.2rem 1rem;
                text-align: center;
            }
            
            .stat-number {
                font-size: 2.2rem;
                margin-bottom: 0.3rem;
            }
            
            .stat-label {
                font-size: 0.85rem;
                font-weight: 500;
            }
            
            .main-content {
                gap: 1rem;
            }
            
            .panel {
                border-radius: 8px;
            }
            
            .panel-header {
                padding: 1rem 0.8rem;
            }
            
            .panel-header h2 {
                font-size: 1rem;
            }
            
            .panel-content {
                padding: 0.8rem;
            }
            
            .coachee-card {
                padding: 1.2rem 0.8rem;
                border-radius: 12px;
            }
            
            .coachee-name {
                font-size: 1rem;
            }
            
            .coachee-email {
                font-size: 0.8rem;
            }
            
            .chart-container {
                height: 200px;
                margin-top: 0.8rem;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 0.5rem;
                margin-top: 0.8rem;
            }
            
            .refresh-btn {
                padding: 0.6rem 1rem;
                font-size: 0.85rem;
                width: 100%;
                text-align: center;
            }
        }

        /* Extra Small Mobile (max-width: 360px) */
        @media (max-width: 360px) {
            .header {
                padding: 0.6rem;
            }
            
            .header h1 {
                font-size: 1.1rem;
            }
            
            .container {
                padding: 0.6rem;
            }
            
            .stat-card {
                padding: 1rem 0.8rem;
            }
            
            .stat-number {
                font-size: 1.8rem;
            }
            
            .panel-header, .panel-content {
                padding: 0.8rem 0.6rem;
            }
            
            .coachee-card {
                padding: 1rem 0.6rem;
            }
            
            .chart-container {
                height: 180px;
            }
        }

        /* Touch-friendly improvements */
        @media (hover: none) and (pointer: coarse) {
            .logout-btn {
                min-height: 44px;
                min-width: 44px;
            }
            
            .refresh-btn {
                min-height: 44px;
                padding: 0.6rem 1.2rem;
            }
            
            .coachee-card {
                min-height: 44px;
                cursor: pointer;
            }
            
            .stat-card {
                transition: transform 0.2s ease;
            }
            
            .stat-card:active {
                transform: scale(0.98);
            }
        }

        /* Mobile Menu Hamburger */
        .mobile-menu-toggle {
            display: none;
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        .mobile-menu-toggle:hover {
            background: rgba(255,255,255,0.1);
        }

        .mobile-nav {
            display: none;
            position: fixed;
            top: 0;
            right: -100%;
            width: 280px;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 2rem 1.5rem;
        }

        .mobile-nav.active {
            right: 0;
        }

        .mobile-nav-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .mobile-nav-title {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .mobile-nav-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.3s ease;
        }

        .mobile-nav-close:hover {
            background: rgba(255,255,255,0.1);
        }

        .mobile-nav-content {
            color: white;
        }

        .mobile-nav-user {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .mobile-nav-user strong {
            display: block;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }

        .mobile-nav-actions {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .mobile-nav-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.8rem 1.2rem;
            border-radius: 8px;
            text-decoration: none;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 1rem;
        }

        .mobile-nav-btn:hover {
            background: rgba(255,255,255,0.3);
            color: white;
            text-decoration: none;
        }

        .mobile-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
        }

        .mobile-overlay.active {
            display: block;
        }

        /* Show mobile menu toggle only on mobile */
        @media (max-width: 768px) {
            .mobile-menu-toggle {
                display: block;
            }
            
            .user-info {
                display: none;
            }
        }

        /* Estilos para el modal de resultados de evaluación del coachee - MISMO FORMATO QUE EL COACHEE */
        
        /* Spinner personalizado */
        .spinner-border-custom {
            width: 3rem;
            height: 3rem;
            border-width: 0.3em;
            border-color: #5A67D8;
            border-right-color: transparent;
        }

        /* Botones específicos para progreso - IDENTICAL to coachee */
        .btn-progress {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        .btn-progress:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
            color: white;
        }

        /* Variables CSS para el modal */
        :root {
            --calm-surface: #FFFFFF;
            --calm-border: #E2E8F0;
            --calm-text-primary: #2D3748;
            --calm-text-secondary: #4A5568;
            --surface-elevated: #F7FAFC;
        }

        /* Responsive radar chart container */
        .radar-chart-container {
            position: relative;
            height: 400px;
            width: 100%;
            max-width: 100%;
        }

        @media (max-width: 576px) {
            .radar-chart-container {
                height: 300px;
            }
        }

        @media (max-width: 992px) {
            .radar-chart-container {
                height: 350px;
            }
        }

        /* Modal responsiveness */
        @media (max-width: 768px) {
            .modal-xl {
                max-width: 95%;
                margin: 0.5rem auto;
            }
            
            .modal-dialog {
                margin: 0.5rem;
            }
            
            .modal-body {
                padding: 1rem;
            }
            
            .modal-header {
                padding: 1rem;
            }
            
            .card-body {
                padding: 1rem;
            }
            
            .h2 {
                font-size: 1.5rem;
            }
            
            .h4 {
                font-size: 1.2rem;
            }
            
            .h5 {
                font-size: 1.1rem;
            }
            
            .h6 {
                font-size: 1rem;
            }
        }

        /* Ensure cards stack properly on mobile */
        @media (max-width: 768px) {
            .row.mb-4 .col-12.col-lg-6 {
                margin-bottom: 1rem;
            }
            
            .row.mb-4 .col-lg-6 {
                margin-bottom: 1rem;
            }
        }
        
        /* Estilos específicos para modal de evaluación detallada */
        .dimension-scores .badge {
            min-width: 60px;
        }
        
        .accordion-button:not(.collapsed) {
            background-color: #f8f9fa;
            box-shadow: none;
        }
        
        .bg-orange {
            background-color: #fd7e14 !important;
        }
        
        .score-badge {
            font-size: 0.875rem;
            padding: 0.375rem 0.75rem;
        }
        
        .card-header.bg-primary,
        .card-header.bg-success,
        .card-header.bg-info,
        .card-header.bg-warning,
        .card-header.bg-secondary {
            border: none;
        }
        
        .alert-success.py-2,
        .alert-warning.py-2 {
            padding: 0.5rem !important;
            margin-bottom: 0.5rem !important;
        }
        
        .accordion-item {
            border: 1px solid rgba(0,0,0,.125);
            margin-bottom: 0.25rem;
        }
        
        .accordion-item:first-of-type {
            border-top-left-radius: 0.375rem;
            border-top-right-radius: 0.375rem;
        }
        
        .accordion-item:last-of-type {
            border-bottom-left-radius: 0.375rem;
            border-bottom-right-radius: 0.375rem;
        }
    </style>
</head>
<body>
    <!-- Header con Bootstrap 5 -->
    <nav class="navbar navbar-expand-lg custom-header">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="fas fa-chart-line me-2"></i>Dashboard Coach
            </a>
            
            <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" 
                    data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" 
                    aria-label="Toggle navigation">
                <i class="fas fa-bars text-white"></i>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item dropdown me-3">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" 
                           data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-user-circle me-1"></i>
                            <span id="coachName">Cargando...</span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#stats"><i class="fas fa-chart-bar me-2"></i>Estadísticas</a></li>
                            <li><a class="dropdown-item" href="#charts"><i class="fas fa-chart-pie me-2"></i>Gráficos</a></li>
                            <li><a class="dropdown-item" href="#tasks"><i class="fas fa-tasks me-2"></i>Gestión de Tareas</a></li>
                            <li><a class="dropdown-item" href="#coachees"><i class="fas fa-users me-2"></i>Mis Coachees</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt me-2"></i>Cerrar Sesión</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="btn btn-outline-light btn-sm" href="/logout">
                            <i class="fas fa-sign-out-alt me-1"></i>Cerrar Sesión
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid py-4">
        <!-- Estadísticas Generales -->
        <div id="stats" class="row mb-4">
            <div class="col-12">
                <h2 class="text-primary fw-bold mb-4">
                    <i class="fas fa-tachometer-alt me-2"></i>Panel de Control
                </h2>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-4">
                <div class="card stat-card h-100">
                    <div class="card-body text-center">
                        <div class="stat-number" id="totalCoachees">-</div>
                        <div class="stat-label">Coachees Asignados</div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-4">
                <div class="card stat-card h-100">
                    <div class="card-body text-center">
                        <div class="stat-number" id="totalAssessments">-</div>
                        <div class="stat-label">Evaluaciones Totales</div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-4">
                <div class="card stat-card h-100">
                    <div class="card-body text-center">
                        <div class="stat-number" id="avgScore">-</div>
                        <div class="stat-label">Puntuación Promedio</div>
                    </div>
                </div>
            </div>
            <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 mb-4">
                <div class="card stat-card h-100">
                    <div class="card-body text-center">
                        <div class="stat-number" id="recentActivity">-</div>
                        <div class="stat-label">Actividad Este Mes</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráficos -->
        <div id="charts" class="row mb-4">
            <div class="col-lg-6 mb-4">
                <div class="card modern-panel h-100">
                    <div class="card-header panel-header">
                        <h3 class="panel-title">
                            <i class="fas fa-chart-pie me-2 text-primary"></i>Distribución de Niveles
                        </h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-container">
                            <canvas id="distributionChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Gestión de Tareas y Resúmenes -->
        <div id="tasks" class="row mb-4">
            <!-- Pestañas para Task Management -->
            <div class="col-12">
                <div class="card modern-panel">
                    <div class="card-header panel-header">
                        <h3 class="panel-title">
                            <i class="fas fa-tasks me-2 text-primary"></i>Gestión de Tareas y Seguimiento
                        </h3>
                    </div>
                    <div class="card-body">
                        <!-- Nav Pills para las diferentes vistas -->
                        <ul class="nav nav-pills nav-fill mb-4" id="taskTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="task-summary-tab" data-bs-toggle="pill" 
                                        data-bs-target="#task-summary" type="button" role="tab" 
                                        aria-controls="task-summary" aria-selected="true">
                                    <i class="fas fa-chart-line me-2"></i>Resúmenes de Coachees
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="task-manage-tab" data-bs-toggle="pill" 
                                        data-bs-target="#task-manage" type="button" role="tab" 
                                        aria-controls="task-manage" aria-selected="false">
                                    <i class="fas fa-plus-circle me-2"></i>Crear Tareas
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="task-track-tab" data-bs-toggle="pill" 
                                        data-bs-target="#task-track" type="button" role="tab" 
                                        aria-controls="task-track" aria-selected="false">
                                    <i class="fas fa-list-check me-2"></i>Seguimiento
                                </button>
                            </li>
                        </ul>

                        <!-- Tab Content -->
                        <div class="tab-content" id="taskTabContent">
                            <!-- Resúmenes de Evaluaciones de Coachees -->
                            <div class="tab-pane fade show active" id="task-summary" role="tabpanel" 
                                 aria-labelledby="task-summary-tab">
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">
                                                <i class="fas fa-user-graduate me-2 text-info"></i>
                                                Resúmenes de Evaluaciones por Coachee
                                            </h5>
                                            <button class="btn btn-outline-primary btn-sm" onclick="loadEvaluationSummaries()">
                                                <i class="fas fa-refresh me-1"></i>Actualizar
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div id="evaluationSummariesContainer" class="row">
                                            <div class="col-12 text-center py-4">
                                                <div class="loading-spinner me-2"></div>
                                                <span class="text-muted">Cargando resúmenes de evaluaciones...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Crear Nuevas Tareas -->
                            <div class="tab-pane fade" id="task-manage" role="tabpanel" 
                                 aria-labelledby="task-manage-tab">
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-success text-white">
                                                <h5 class="mb-0">
                                                    <i class="fas fa-plus-circle me-2"></i>Crear Nueva Tarea
                                                </h5>
                                            </div>
                                            <div class="card-body">
                                                <form id="createTaskForm">
                                                    <div class="mb-3">
                                                        <label for="taskCoacheeSelect" class="form-label">Coachee</label>
                                                        <select class="form-select" id="taskCoacheeSelect" required 
                                                                onclick="ensureCoacheesLoaded()" 
                                                                onfocus="ensureCoacheesLoaded()">
                                                            <option value="">Seleccionar coachee...</option>
                                                        </select>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="taskTitle" class="form-label">Título de la tarea</label>
                                                        <input type="text" class="form-control" id="taskTitle" 
                                                               placeholder="Ej: Practicar comunicación asertiva" required>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="taskDescription" class="form-label">Descripción</label>
                                                        <textarea class="form-control" id="taskDescription" rows="3" 
                                                                  placeholder="Describe detalladamente la tarea..." required></textarea>
                                                    </div>
                                                    <div class="row">
                                                        <div class="col-md-6 mb-3">
                                                            <label for="taskCategory" class="form-label">Categoría</label>
                                                            <select class="form-select" id="taskCategory" required>
                                                                <option value="">Seleccionar categoría...</option>
                                                                <option value="comunicacion">Comunicación</option>
                                                                <option value="derechos">Derechos</option>
                                                                <option value="opiniones">Opiniones</option>
                                                                <option value="conflictos">Conflictos</option>
                                                                <option value="autoconfianza">Autoconfianza</option>
                                                            </select>
                                                        </div>
                                                        <div class="col-md-6 mb-3">
                                                            <label for="taskPriority" class="form-label">Prioridad</label>
                                                            <select class="form-select" id="taskPriority">
                                                                <option value="medium">Media</option>
                                                                <option value="low">Baja</option>
                                                                <option value="high">Alta</option>
                                                                <option value="urgent">Urgente</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="mb-3">
                                                        <label for="taskDueDate" class="form-label">Fecha de vencimiento (opcional)</label>
                                                        <input type="date" class="form-control" id="taskDueDate">
                                                    </div>
                                                    <button type="submit" class="btn btn-success w-100">
                                                        <i class="fas fa-plus me-2"></i>Crear Tarea
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-header bg-info text-white">
                                                <h5 class="mb-0">
                                                    <i class="fas fa-lightbulb me-2"></i>Sugerencias de Tareas
                                                </h5>
                                            </div>
                                            <div class="card-body">
                                                <div class="task-suggestions">
                                                    <div class="suggestion-item mb-3 p-3 border rounded">
                                                        <h6 class="text-primary">Comunicación</h6>
                                                        <ul class="list-unstyled mb-0 small">
                                                            <li>• Practicar expresión de necesidades</li>
                                                            <li>• Ejercicios de escucha activa</li>
                                                            <li>• Comunicación no verbal</li>
                                                        </ul>
                                                    </div>
                                                    <div class="suggestion-item mb-3 p-3 border rounded">
                                                        <h6 class="text-success">Autoconfianza</h6>
                                                        <ul class="list-unstyled mb-0 small">
                                                            <li>• Ejercicios de autovaloración</li>
                                                            <li>• Definir límites personales</li>
                                                            <li>• Registro de logros diarios</li>
                                                        </ul>
                                                    </div>
                                                    <div class="suggestion-item mb-3 p-3 border rounded">
                                                        <h6 class="text-warning">Resolución de Conflictos</h6>
                                                        <ul class="list-unstyled mb-0 small">
                                                            <li>• Técnicas de mediación</li>
                                                            <li>• Análisis de situaciones</li>
                                                            <li>• Práctica de diálogo constructivo</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Seguimiento de Tareas -->
                            <div class="tab-pane fade" id="task-track" role="tabpanel" 
                                 aria-labelledby="task-track-tab">
                                <div class="row">
                                    <div class="col-12 mb-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h5 class="mb-0">
                                                <i class="fas fa-list-check me-2 text-warning"></i>
                                                Tareas Asignadas
                                            </h5>
                                            <button class="btn btn-outline-primary btn-sm" onclick="loadTasks()">
                                                <i class="fas fa-refresh me-1"></i>Actualizar
                                            </button>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div id="tasksContainer" class="row">
                                            <div class="col-12 text-center py-4">
                                                <div class="loading-spinner me-2"></div>
                                                <span class="text-muted">Cargando tareas...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Mis Coachees -->
        <div id="coachees" class="row">
            <div class="col-12">
                <div class="card modern-panel">
                    <div class="card-header panel-header d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center">
                        <h3 class="panel-title mb-3 mb-md-0">
                            <i class="fas fa-users me-2 text-primary"></i>Mis Coachees
                        </h3>
                        <div class="d-flex flex-column flex-sm-row gap-2">
                            <button class="btn btn-success-gradient btn-sm" onclick="openInvitationModal()">
                                <i class="fas fa-envelope me-1"></i>Invitar Coachee
                            </button>
                            <button class="btn btn-gradient btn-sm" onclick="loadCoachees()">
                                <i class="fas fa-refresh me-1"></i>Actualizar
                            </button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="coacheesContainer" class="row">
                            <div class="col-12 text-center py-5">
                                <div class="loading-spinner me-2"></div>
                                <span class="text-muted">Cargando coachees...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container position-fixed bottom-0 end-0 p-3" style="z-index: 1055;">
        <!-- Toasts will be inserted here -->
    </div>

    <!-- Coachee Evaluation Details Modal - IDENTICAL to coachee dashboard -->
    <div class="modal fade" id="coacheeEvaluationDetailsModal" tabindex="-1" aria-labelledby="coacheeEvaluationDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header" style="background: var(--primary-gradient); color: white;">
                    <h5 class="modal-title" id="coacheeEvaluationDetailsModalLabel">
                        <i class="fas fa-chart-radar me-2"></i>
                        Detalles de Evaluación del Coachee
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="coacheeEvaluationDetailsContent">
                    <div class="loading-spinner">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Cargando detalles...</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-progress" onclick="printCoacheeEvaluationReport()">
                        <i class="fas fa-print me-2"></i>
                        Imprimir Reporte
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Invitation Modal -->
    <div class="modal fade" id="invitationModal" tabindex="-1" aria-labelledby="invitationModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="background: var(--primary-gradient); color: white;">
                    <h5 class="modal-title" id="invitationModalLabel">
                        <i class="fas fa-user-plus me-2"></i>
                        Invitar Nuevo Coachee
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="invitationForm">
                        <div class="mb-3">
                            <label for="coacheeEmail" class="form-label">
                                <i class="fas fa-envelope me-2"></i>
                                Email del Coachee
                            </label>
                            <input type="email" class="form-control invitation-input" id="coacheeEmail" placeholder="ejemplo@correo.com" required>
                            <div class="form-text">El coachee recibirá una invitación por email para registrarse en la plataforma.</div>
                        </div>
                        <div class="mb-3">
                            <label for="coacheeName" class="form-label">
                                <i class="fas fa-user me-2"></i>
                                Nombre del Coachee *
                            </label>
                            <input type="text" class="form-control invitation-input" id="coacheeName" placeholder="Nombre completo" required>
                            <div class="form-text">Este nombre aparecerá en la invitación para personalizar el mensaje.</div>
                        </div>
                        <div class="mb-3">
                            <label for="invitationMessage" class="form-label">
                                <i class="fas fa-comment me-2"></i>
                                Mensaje Personal (Opcional)
                            </label>
                            <textarea class="form-control invitation-input" id="invitationMessage" rows="3" placeholder="Escribe un mensaje personal para tu coachee..."></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>
                        Cancelar
                    </button>
                    <button type="button" class="btn btn-gradient invitation-btn" onclick="sendInvitation()">
                        <i class="fas fa-paper-plane me-2"></i>
                        Enviar Invitación
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Variables globales
        let coacheesData = [];
        let statsData = {};
        let distributionChart = null;
        let progressChart = null;       // Ya no se usará
        let questions = [];
        const API_BASE_URL = '';

        // Inicialización del dashboard
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos iniciales
            loadDashboardStats();
            loadCoachees();
            loadQuestions();
            
            // Configurar auto-refresh cada 30 segundos
            setInterval(() => {
                loadDashboardStats();
                loadCoachees();
            }, 30000);
        });

        // Cargar preguntas de la evaluación (para referencia)
        async function loadQuestions() {
            try {
                const response = await fetch('/api/questions', {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    questions = data.questions || [];
                    console.log('📋 Questions loaded:', questions.length);
                }
            } catch (error) {
                console.log('ℹ️  Questions not loaded (optional):', error.message);
                // No es crítico si no se pueden cargar las preguntas
            }
        }

        // Cargar estadísticas del dashboard
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/coach/dashboard-stats', {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('🔍 API Response from /api/coach/dashboard-stats:', data);
                
                updateStatsDisplay(data);
                updateCharts(data);
                
                // Actualizar nombre del coach
                if (data.coach_name) {
                    document.getElementById('coachName').textContent = data.coach_name;
                }
                
            } catch (error) {
                console.error('Error loading stats:', error);
                showToast('Error al cargar estadísticas', 'error');
            }
        }

        // Actualizar visualización de estadísticas
        function updateStatsDisplay(data) {
            statsData = data;
            
            document.getElementById('totalCoachees').textContent = data.total_coachees || 0;
            document.getElementById('totalAssessments').textContent = data.total_assessments || 0;
            document.getElementById('avgScore').textContent = data.avg_score ? 
                Math.round(data.avg_score) + '%' : '-';
            document.getElementById('recentActivity').textContent = data.recent_activity || 0;
        }

        // Cargar lista de coachees
        async function loadCoachees() {
            const container = document.getElementById('coacheesContainer');
            
            try {
                const response = await fetch('/api/coach/coachees', {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                coacheesData = data.coachees || [];
                displayCoachees(coacheesData);
                
            } catch (error) {
                console.error('Error loading coachees:', error);
                container.innerHTML = `
                    <div class="col-12">
                        <div class="alert alert-danger text-center" role="alert">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            Error al cargar la lista de coachees
                            <button class="btn btn-sm btn-outline-danger ms-2" onclick="loadCoachees()">
                                <i class="fas fa-refresh me-1"></i>Reintentar
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        // Mostrar lista de coachees
        function displayCoachees(coachees) {
            const container = document.getElementById('coacheesContainer');
            
            if (!coachees || coachees.length === 0) {
                container.innerHTML = `
                    <div class="col-12">
                        <div class="empty-state">
                            <div class="empty-state-icon">
                                <i class="fas fa-users"></i>
                            </div>
                            <h4>No hay coachees asignados</h4>
                            <p>Los participantes aparecerán aquí una vez que acepten tu invitación y completen su registro.</p>
                            <button class="btn btn-gradient" onclick="openInvitationModal()">
                                <i class="fas fa-envelope me-2"></i>
                                Invitar Nuevo Participante
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            const coacheesHTML = coachees.map(coachee => `
                <div class="col-lg-6 col-xl-4 mb-4">
                    <div class="card coachee-card h-100" onclick="showCoacheeDetails('${coachee.id}')">
                        <div class="card-body p-4">
                            <!-- Header Section -->
                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div class="flex-grow-1">
                                    <h5 class="coachee-name">${coachee.full_name}</h5>
                                    <p class="coachee-email">${coachee.email}</p>
                                </div>
                                <span class="status-badge ${getStatusBadgeClass(coachee.status)}">
                                    ${getStatusText(coachee.status)}
                                </span>
                            </div>
                            
                            <!-- Stats Section -->
                            <div class="coachee-stats">
                                <div class="coachee-stat">
                                    <div class="coachee-stat-number">${coachee.total_assessments || 0}</div>
                                    <div class="coachee-stat-label">Evaluaciones</div>
                                </div>
                                <div class="coachee-stat">
                                    <div class="coachee-stat-number">
                                        ${coachee.average_score ? Math.round(coachee.average_score) + '%' : 'N/A'}
                                    </div>
                                    <div class="coachee-stat-label">Promedio</div>
                                </div>
                            </div>
                            
                            <!-- Assessment Section -->
                            ${coachee.last_assessment ? `
                                <div class="last-assessment">
                                    <div class="assessment-header">
                                        <span class="assessment-title">Última Evaluación</span>
                                        <div class="assessment-icon">
                                            <i class="fas fa-chart-line"></i>
                                        </div>
                                    </div>
                                    <div class="assessment-score">
                                        <span class="score-badge ${getScoreClass(coachee.last_assessment.score)}">
                                            ${Math.round(coachee.last_assessment.score)}% - ${getAssertivityLevel(coachee.last_assessment.score)}
                                        </span>
                                    </div>
                                    <div class="assessment-date">
                                        <i class="fas fa-clock"></i>
                                        ${formatDate(coachee.last_assessment.created_at)}
                                    </div>
                                </div>
                            ` : `
                                <div class="last-assessment">
                                    <div class="assessment-header">
                                        <span class="assessment-title">Estado</span>
                                        <div class="assessment-icon">
                                            <i class="fas fa-user-clock"></i>
                                        </div>
                                    </div>
                                    <div class="assessment-score">
                                        <span class="text-muted small">Sin evaluaciones completadas</span>
                                    </div>
                                    <div class="assessment-date">
                                        <i class="fas fa-info-circle"></i>
                                        <span class="small">Pendiente primera evaluación</span>
                                    </div>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = coacheesHTML;
        }

        // Actualizar gráficos
        function updateCharts(data) {
            console.log('🎯 updateCharts called with data:', data);
            console.log('📈 Score distribution:', data.score_distribution);
            console.log('📊 Progress data:', data.progress_data);
            
            updateDistributionChart(data.score_distribution || {});
        }

        // Gráfico de distribución
        function updateDistributionChart(distribution) {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            if (distributionChart) {
                distributionChart.destroy();
            }
            
            const levels = ['Poco Asertivo', 'Moderadamente Asertivo', 'Asertivo', 'Muy Asertivo'];
            const counts = levels.map(level => distribution[level] || 0);
            const colors = ['#ef4444', '#f59e0b', '#3b82f6', '#10b981'];
            
            distributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: levels,
                    datasets: [{
                        data: counts,
                        backgroundColor: colors,
                        borderWidth: 0,
                        hoverBorderWidth: 2,
                        hoverBorderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                padding: 20,
                                font: { size: 12 }
                            }
                        }
                    }
                }
            });
        }


        // Gráfico de progreso por coachee (ya no se usa)
        function updateProgressChart(progressData) {
            const ctx = document.getElementById('progressChart').getContext('2d');
            
            // DEBUG: Log de los datos recibidos
            console.log('🔍 updateProgressChart called with:', progressData);
            console.log('📊 Progress data length:', progressData ? progressData.length : 'undefined');
            
            if (progressChart) {
                progressChart.destroy();
            }
            
            if (!progressData || progressData.length === 0) {
                // Mostrar mensaje cuando no hay datos
                console.log('❌ No progress data available');
                ctx.fillStyle = '#6b7280';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('No hay datos de progreso disponibles', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }
            
            console.log('✅ Progress data found, creating chart with', progressData.length, 'coachees');
            
            // Generar colores diferentes para cada coachee
            const colors = [
                '#667eea', '#f093fb', '#4facfe', '#43e97b', 
                '#fa709a', '#fad0c4', '#a8edea', '#ffecd2',
                '#ff9a9e', '#a8e6cf', '#ffd3a5', '#fd8085'
            ];
            
            // Crear datasets para cada coachee
            const datasets = progressData.map((coachee, index) => {
                const color = colors[index % colors.length];
                
                return {
                    label: coachee.coachee_name,
                    data: coachee.assessments.map(assessment => ({
                        x: new Date(assessment.date),
                        y: assessment.score
                    })),
                    borderColor: color,
                    backgroundColor: color + '20',
                    borderWidth: 2,
                    fill: false,
                    tension: 0.4,
                    pointBackgroundColor: color,
                    pointBorderColor: '#ffffff',
                    pointBorderWidth: 2,
                    pointRadius: 4,
                    pointHoverRadius: 6
                };
            });
            
            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'time',
                            time: {
                                unit: 'day',
                                displayFormats: {
                                    day: 'MMM DD'
                                }
                            },
                            title: {
                                display: true,
                                text: 'Fecha'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Puntuación (%)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            mode: 'point',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    return context.dataset.label + ': ' + context.parsed.y + '%';
                                }
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'point'
                    }
                }
            });
        }

        // Mostrar detalles del coachee
        function showCoacheeDetails(coacheeId) {
            const coachee = coacheesData.find(c => c.id === coacheeId);
            if (!coachee) return;
            
            const modal = new bootstrap.Modal(document.createElement('div'));
            modal._element.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                <i class="fas fa-user me-2"></i>${coachee.full_name}
                            </h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h6 class="card-title">Información General</h6>
                                            <p class="mb-1"><strong>Email:</strong> ${coachee.email}</p>
                                            <p class="mb-1"><strong>Estado:</strong> 
                                                <span class="badge ${getStatusBadgeClass(coachee.status)}">
                                                    ${getStatusText(coachee.status)}
                                                </span>
                                            </p>
                                            <p class="mb-0"><strong>Registrado:</strong> ${formatDate(coachee.created_at)}</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <h6 class="card-title">Estadísticas</h6>
                                            <p class="mb-1"><strong>Evaluaciones:</strong> ${coachee.total_assessments || 0}</p>
                                            <p class="mb-1"><strong>Promedio:</strong> 
                                                ${coachee.average_score ? Math.round(coachee.average_score) + '%' : 'N/A'}
                                            </p>
                                            ${coachee.last_assessment ? `
                                                <p class="mb-0"><strong>Última evaluación:</strong> ${formatDate(coachee.last_assessment.created_at)}</p>
                                            ` : '<p class="mb-0">Sin evaluaciones</p>'}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            ${coachee.last_assessment ? `
                                <div class="mt-3">
                                    <h6>Último Resultado de Asertividad</h6>
                                    <div class="alert alert-info">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <span><strong>Puntuación:</strong> ${Math.round(coachee.last_assessment.score)}%</span>
                                            <span class="badge ${getScoreClass(coachee.last_assessment.score)} score-badge">
                                                ${getAssertivityLevel(coachee.last_assessment.score)}
                                            </span>
                                        </div>
                                        <div class="mt-2">
                                            ${getScoreInterpretation(coachee.last_assessment.score)}
                                        </div>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            ${coachee.last_assessment ? `
                                <button type="button" class="btn btn-success" onclick="viewCoacheeEvaluationDetails('${coacheeId}')">
                                    <i class="fas fa-chart-radar me-1"></i>Ver Resultados Detallados
                                </button>
                            ` : ''}
                            <button type="button" class="btn btn-primary" onclick="sendReminder('${coacheeId}')">
                                <i class="fas fa-bell me-1"></i>Enviar Recordatorio
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal._element);
            modal.show();
            
            modal._element.addEventListener('hidden.bs.modal', function() {
                modal._element.remove();
            });
        }

        function setCoachName() {
            // Obtener el nombre del coach desde la API de estadísticas
            fetch('/api/coach/dashboard-stats', {
                method: 'GET',
                credentials: 'include',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
                .then(response => response.json())
                .then(data => {
                    if (data.coach_name) {
                        document.getElementById('coachName').textContent = data.coach_name;
                    } else {
                        document.getElementById('coachName').textContent = 'Coach';
                    }
                })
                .catch(error => {
                    console.error('Error obteniendo nombre del coach:', error);
                    document.getElementById('coachName').textContent = 'Coach';
                });
        }

        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/coach/dashboard-stats', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    
                    // Si hay error de autenticación o autorización, redirigir al login
                    if (response.status === 401 || response.status === 403) {
                        console.log('Error de autorización en stats:', response.status, errorData);
                        window.location.href = '/login?role=coach';
                        return;
                    }
                    
                    throw new Error(errorData.error || 'No se pudieron cargar las estadísticas del dashboard');
                }
                
                const stats = await response.json();
                statsData = stats;
                
                // Actualizar estadísticas
                document.getElementById('totalCoachees').textContent = stats.total_coachees || 0;
                document.getElementById('totalAssessments').textContent = stats.total_assessments || 0;
                document.getElementById('avgScore').textContent = stats.avg_score ? stats.avg_score + '%' : '-';
                document.getElementById('recentActivity').textContent = stats.recent_activity || 0;
                
                // Crear gráficos con manejo de errores
                try {
                    createDistributionChart(stats.score_distribution);
                } catch (chartError) {
                    console.error('Error creando gráfico:', chartError);
                    // Continuar sin mostrar error al usuario por el gráfico
                }
                
            } catch (error) {
                console.error('Error cargando estadísticas:', error);
                showError('No se pudieron cargar las estadísticas del dashboard. Por favor, recarga la página.');
            }
        }

        async function loadCoachees() {
            try {
                const container = document.getElementById('coacheesContainer');
                container.innerHTML = '<div class="loading">Cargando coachees...</div>';
                
                const response = await fetch('/api/coach/my-coachees', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    
                    // Si hay error de autenticación o autorización, redirigir al login
                    if (response.status === 401 || response.status === 403) {
                        console.log('Error de autorización:', response.status, errorData);
                        window.location.href = "/login?role=coach";
                        return;
                    }
                    
                    throw new Error(errorData.error || 'No se pudo cargar la lista de coachees');
                }
                
                const coachees = await response.json();
                coacheesData = coachees;
                
                if (coachees.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <h3>No tienes coachees asignados</h3>
                            <p>Los coachees aparecerán aquí una vez que sean asignados a tu supervisión.</p>
                        </div>
                    `;
                    return;
                }
                
                // Crear grid de coachees
                const coacheeGrid = document.createElement('div');
                coacheeGrid.className = 'coachee-grid';
                
                coachees.forEach(coachee => {
                    const card = createCoacheeCard(coachee);
                    coacheeGrid.appendChild(card);
                });
                
                container.innerHTML = '';
                container.appendChild(coacheeGrid);
                
            } catch (error) {
                console.error('Error cargando coachees:', error);
                const container = document.getElementById('coacheesContainer');
                container.innerHTML = `
                    <div class="error-state">
                        <h3>Error al cargar coachees</h3>
                        <p>No se pudieron cargar los coachees. <button onclick="loadCoachees()" style="
                            background: #007bff; 
                            color: white; 
                            border: none; 
                            padding: 8px 16px; 
                            border-radius: 4px; 
                            cursor: pointer;
                            margin-left: 8px;
                        ">Reintentar</button></p>
                    </div>
                `;
                showError('No se pudo cargar la lista de coachees. Verifica tu conexión.');
            }
        }

        function createCoacheeCard(coachee) {
            const card = document.createElement('div');
            card.className = 'coachee-card';
            card.onclick = () => viewCoacheeDetails(coachee.id);
            
            let lastAssessmentHtml = '';
            if (coachee.latest_assessment) {
                const score = coachee.latest_assessment.overall_score;
                const scoreClass = getScoreClass(score);
                const level = getAssertivityLevel(score);
                const date = new Date(coachee.latest_assessment.created_at).toLocaleDateString();
                
                lastAssessmentHtml = `
                    <div class="last-assessment">
                        <div class="assessment-header">
                            <span class="assessment-title">Última Evaluación</span>
                            <div class="assessment-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                        </div>
                        <div class="assessment-score">
                            <span class="score-badge ${scoreClass}">
                                ${score}% - ${level}
                            </span>
                        </div>
                        <div class="assessment-date">
                            <i class="fas fa-clock"></i>
                            ${date}
                        </div>
                    </div>
                `;
            } else {
                lastAssessmentHtml = `
                    <div class="last-assessment">
                        <div class="assessment-header">
                            <span class="assessment-title">Estado</span>
                            <div class="assessment-icon">
                                <i class="fas fa-hourglass-half"></i>
                            </div>
                        </div>
                        <div class="assessment-score">
                            <span class="text-muted">Sin evaluaciones completadas</span>
                        </div>
                        <div class="assessment-date">
                            <i class="fas fa-info-circle"></i>
                            Pendiente de primera evaluación
                        </div>
                    </div>
                `;
            }
            
            card.innerHTML = `
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start mb-3">
                        <div class="flex-grow-1">
                            <h5 class="coachee-name mb-1">${coachee.full_name}</h5>
                            <p class="coachee-email mb-0">${coachee.email}</p>
                        </div>
                    </div>
                    
                    <div class="coachee-stats">
                        <div class="coachee-stat">
                            <div class="coachee-stat-number">${coachee.total_assessments || 0}</div>
                            <div class="coachee-stat-label">Evaluaciones</div>
                        </div>
                        <div class="coachee-stat">
                            <div class="coachee-stat-number">
                                ${coachee.latest_assessment ? getAssertivityLevel(coachee.latest_assessment.overall_score) : 'N/A'}
                            </div>
                            <div class="coachee-stat-label">Nivel Actual</div>
                        </div>
                    </div>
                    
                    ${lastAssessmentHtml}
                </div>
            `;
            
            return card;
        }

        function createDistributionChart(distribution) {
            const ctx = document.getElementById('distributionChart').getContext('2d');
            
            if (distributionChart) {
                distributionChart.destroy();
            }
            
            distributionChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(distribution),
                    datasets: [{
                        data: Object.values(distribution),
                        backgroundColor: [
                            '#e53e3e',  // Poco Asertivo
                            '#d69e2e',  // Moderadamente Asertivo
                            '#3182ce',  // Asertivo
                            '#38a169'   // Muy Asertivo
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        async function viewCoacheeDetails(coacheeId) {
            try {
                // Encontrar datos del coachee en el array local
                const coachee = coacheesData.find(c => c.id === coacheeId);
                if (!coachee || !coachee.latest_assessment) {
                    showWarning('No hay evaluaciones disponibles para este participante');
                    return;
                }
                
                // Mostrar modal con la evaluación completa
                showAssessmentResultModal(coachee);
                
            } catch (error) {
                console.error('Error:', error);
                showError('Error cargando detalles del coachee');
            }
        }

        function showAssessmentResultModal(coachee) {
            const assessment = coachee.latest_assessment;
            const dimensionalScores = assessment.dimensional_scores || {};
            
            // Crear modal con el MISMO formato que el dashboard del coachee
            const modal = document.createElement('div');
            modal.id = 'assessmentModal';
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.8);
                display: flex;
                align-items: center;
                justify-content: center;
                z-index: 2000;
                overflow-y: auto;
                padding: 20px;
            `;
            
            // Usar el MISMO HTML que el dashboard del coachee
            modal.innerHTML = `
                <div style="background: white; border-radius: 20px; max-width: 900px; width: 100%; max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.3);">
                    <!-- Header igual al del coachee -->
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 2rem; border-radius: 20px 20px 0 0; text-align: center;">
                        <h1 style="margin: 0; font-size: 2rem; font-weight: 300;">¡Evaluación Completada!</h1>
                        <p style="margin: 0.5rem 0 0 0; opacity: 0.9;">Resultado para: ${coachee.full_name}</p>
                        <button onclick="closeAssessmentModal()" style="position: absolute; top: 15px; right: 20px; background: rgba(255,255,255,0.2); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; font-size: 18px;">×</button>
                    </div>
                    
                    <!-- Content igual al del coachee -->
                    <div style="padding: 2rem;">
                        <!-- Score Section igual al del coachee -->
                        <div style="text-align: center; margin-bottom: 2rem;">
                            <div class="score" style="font-size: 4rem; font-weight: bold; color: #667eea; margin: 1rem 0;">${Math.round(assessment.overall_score)}%</div>
                            <p style="font-size: 1.5rem; font-weight: bold; color: #2d3748; margin: 1rem 0;">${getAssertivityLevel(assessment.overall_score)}</p>
                            <p style="color: #718096; font-size: 1.1rem;">Evaluación completada el ${new Date(assessment.completed_at).toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' })}</p>
                        </div>
                        
                        <!-- Interpretación detallada IGUAL a la del coachee -->
                        <div class="interpretation" style="background: #f7fafc; padding: 2rem; border-radius: 15px; margin-bottom: 2rem;">
                            ${getDetailedInterpretationForCoach(assessment)}
                        </div>
                        
                        <!-- Radar Chart Section - Responsive -->
                        <div style="background: #f7fafc; padding: 1.5rem; border-radius: 15px; margin-bottom: 2rem; text-align: center;">
                            <h3 style="color: #2d3748; margin-bottom: 1.5rem;">📊 Análisis por Dimensiones</h3>
                            <!-- Responsive radar chart container -->
                            <div class="radar-chart-container w-100" style="max-width: 100%; margin: 0 auto;">
                                <canvas id="modalRadarChart"></canvas>
                            </div>
                            
                            <!-- Leyenda de Dimensiones IGUAL a la del coachee -->
                            <div class="dimensions-legend" style="margin-top: 2rem; text-align: left;">
                                <h4 style="color: #2d3748; margin-bottom: 1rem;">Dimensiones Evaluadas:</h4>
                                <ul style="list-style: none; padding: 0;">
                                    <li style="margin: 0.5rem 0; display: flex; align-items: center;">
                                        <span style="display: inline-block; width: 15px; height: 15px; background-color: #ff6384; border-radius: 50%; margin-right: 10px;"></span>
                                        <span><strong>Comunicación Directa:</strong> Capacidad para expresar ideas claramente</span>
                                    </li>
                                    <li style="margin: 0.5rem 0; display: flex; align-items: center;">
                                        <span style="display: inline-block; width: 15px; height: 15px; background-color: #36a2eb; border-radius: 50%; margin-right: 10px;"></span>
                                        <span><strong>Defensa de Derechos:</strong> Habilidad para hacer valer los propios derechos</span>
                                    </li>
                                    <li style="margin: 0.5rem 0; display: flex; align-items: center;">
                                        <span style="display: inline-block; width: 15px; height: 15px; background-color: #ffce56; border-radius: 50%; margin-right: 10px;"></span>
                                        <span><strong>Expresión de Opiniones:</strong> Facilidad para compartir puntos de vista</span>
                                    </li>
                                    <li style="margin: 0.5rem 0; display: flex; align-items: center;">
                                        <span style="display: inline-block; width: 15px; height: 15px; background-color: #4bc0c0; border-radius: 50%; margin-right: 10px;"></span>
                                        <span><strong>Manejo de Conflictos:</strong> Gestión efectiva de situaciones difíciles</span>
                                    </li>
                                    <li style="margin: 0.5rem 0; display: flex; align-items: center;">
                                        <span style="display: inline-block; width: 15px; height: 15px; background-color: #9966ff; border-radius: 50%; margin-right: 10px;"></span>
                                        <span><strong>Autoconfianza:</strong> Seguridad en las propias capacidades</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div style="text-align: center; padding-top: 1rem; border-top: 1px solid #e2e8f0;">
                            <button onclick="closeAssessmentModal()" style="background: #667eea; color: white; border: none; padding: 12px 30px; border-radius: 25px; font-size: 1rem; cursor: pointer; margin: 0 10px;">
                                ✅ Cerrar
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Crear el gráfico de radar
            setTimeout(() => {
                createModalRadarChart(dimensionalScores);
            }, 100);
            
            // Cerrar modal al hacer clic en el fondo
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeAssessmentModal();
                }
            });
        }
        
        function closeAssessmentModal() {
            const modal = document.getElementById('assessmentModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ============================================================================
        // FUNCIONES PARA MODAL DE INVITACIÓN
        // ============================================================================
        
        function openInvitationModal() {
            const modal = new bootstrap.Modal(document.getElementById('invitationModal'));
            
            // Limpiar el formulario
            document.getElementById('invitationForm').reset();
            
            modal.show();
        }
        
        async function sendInvitation() {
            const email = document.getElementById('coacheeEmail').value.trim();
            const name = document.getElementById('coacheeName').value.trim();
            const message = document.getElementById('invitationMessage').value.trim();
            
            // Validación básica
            if (!email) {
                showToast('Por favor, ingresa el email del coachee', 'error');
                return;
            }
            
            if (!name) {
                showToast('Por favor, ingresa el nombre del coachee', 'error');
                return;
            }
            
            if (!isValidEmail(email)) {
                showToast('Por favor, ingresa un email válido', 'error');
                return;
            }
            
            const inviteButton = document.querySelector('.invitation-btn');
            const originalText = inviteButton.innerHTML;
            
            try {
                // Deshabilitar botón y mostrar loading
                inviteButton.disabled = true;
                inviteButton.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Enviando...';
                
                const response = await fetch('/api/coach/create-invitation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        email: email,
                        full_name: name,
                        message: message || null
                    })
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Error al enviar la invitación');
                }
                
                // Cerrar modal de invitación
                const modal = bootstrap.Modal.getInstance(document.getElementById('invitationModal'));
                modal.hide();
                
                // Mostrar modal con credenciales generadas
                showCredentialsModal(result.coachee);
                
                // Actualizar lista de coachees después de un breve delay
                setTimeout(() => {
                    loadCoachees();
                }, 1000);
                
            } catch (error) {
                console.error('Error enviando invitación:', error);
                showToast(error.message || 'Error al enviar la invitación', 'error');
            } finally {
                // Restaurar botón
                inviteButton.disabled = false;
                inviteButton.innerHTML = originalText;
            }
        }
        
        // Función para mostrar las credenciales generadas
        function showCredentialsModal(coacheeData) {
            const credentialsModal = document.createElement('div');
            credentialsModal.className = 'modal fade';
            credentialsModal.id = 'credentialsModal';
            credentialsModal.setAttribute('tabindex', '-1');
            credentialsModal.setAttribute('aria-hidden', 'true');
            
            credentialsModal.innerHTML = `
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
                            <h5 class="modal-title">
                                <i class="fas fa-check-circle me-2"></i>
                                ¡Coachee Creado Exitosamente!
                            </h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="alert alert-success">
                                <h6 class="alert-heading">
                                    <i class="fas fa-user-plus me-2"></i>
                                    Nuevo Coachee Registrado
                                </h6>
                                <p class="mb-0">El coachee <strong>${coacheeData.full_name}</strong> ha sido creado exitosamente con credenciales de acceso.</p>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">
                                        <i class="fas fa-key me-2"></i>
                                        Credenciales de Acceso
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-sm-4"><strong>Nombre:</strong></div>
                                        <div class="col-sm-8">${coacheeData.full_name}</div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-sm-4"><strong>Email:</strong></div>
                                        <div class="col-sm-8">${coacheeData.email}</div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-sm-4"><strong>Usuario:</strong></div>
                                        <div class="col-sm-8">
                                            <code id="username-${coacheeData.id}">${coacheeData.username}</code>
                                            <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('username-${coacheeData.id}')">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-sm-4"><strong>Contraseña:</strong></div>
                                        <div class="col-sm-8">
                                            <code id="password-${coacheeData.id}">${coacheeData.password}</code>
                                            <button class="btn btn-sm btn-outline-secondary ms-2" onclick="copyToClipboard('password-${coacheeData.id}')">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="row mt-2">
                                        <div class="col-sm-4"><strong>URL de Login:</strong></div>
                                        <div class="col-sm-8">
                                            <a href="${coacheeData.login_url}" target="_blank" class="text-primary">
                                                ${coacheeData.login_url}
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="alert alert-warning mt-3">
                                <h6 class="alert-heading">
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    Importante
                                </h6>
                                <ul class="mb-0">
                                    <li>Comparte estas credenciales de forma segura con tu coachee</li>
                                    <li>El coachee puede cambiar su contraseña después del primer login</li>
                                    <li>Estas credenciales no se mostrarán nuevamente</li>
                                </ul>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                <i class="fas fa-times me-2"></i>
                                Cerrar
                            </button>
                            <button type="button" class="btn btn-primary" onclick="copyAllCredentials('${coacheeData.username}', '${coacheeData.password}', '${coacheeData.email}')">
                                <i class="fas fa-copy me-2"></i>
                                Copiar Todo
                            </button>
                            <button type="button" class="btn btn-success" onclick="sendCredentialsByEmail('${coacheeData.email}', '${coacheeData.full_name}', '${coacheeData.username}', '${coacheeData.password}')">
                                <i class="fas fa-envelope me-2"></i>
                                Enviar por Email
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(credentialsModal);
            const modal = new bootstrap.Modal(credentialsModal);
            modal.show();
            
            // Remover modal del DOM cuando se cierre
            credentialsModal.addEventListener('hidden.bs.modal', function () {
                credentialsModal.remove();
            });
            
            // Mostrar toast de éxito
            showToast('¡Coachee creado exitosamente con credenciales!', 'success');
        }
        
        // Función para copiar texto al portapapeles
        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            const text = element.textContent;
            
            navigator.clipboard.writeText(text).then(function() {
                showToast('Copiado al portapapeles', 'success');
            }).catch(function(err) {
                console.error('Error copiando al portapapeles: ', err);
                showToast('Error al copiar', 'error');
            });
        }
        
        // Función para copiar todas las credenciales
        function copyAllCredentials(username, password, email) {
            const credentials = `
Credenciales de Acceso - Plataforma de Evaluación

Nombre de Usuario: ${username}
Contraseña: ${password}
Email: ${email}
URL de Login: ${window.location.origin}/login?role=coachee

Instrucciones:
1. Ingresa a la URL de login
2. Selecciona "Coachee" si no se selecciona automáticamente
3. Usa las credenciales proporcionadas
4. Podrás cambiar tu contraseña después del primer login
            `.trim();
            
            navigator.clipboard.writeText(credentials).then(function() {
                showToast('Todas las credenciales copiadas al portapapeles', 'success');
            }).catch(function(err) {
                console.error('Error copiando credenciales: ', err);
                showToast('Error al copiar credenciales', 'error');
            });
        }
        
        // Función para enviar credenciales por email (simulado)
        function sendCredentialsByEmail(email, fullName, username, password) {
            // En una implementación real, esto llamaría a un endpoint del backend
            showToast('Funcionalidad de envío por email en desarrollo', 'info');
            
            // Por ahora, abrimos el cliente de email por defecto
            const subject = encodeURIComponent('Credenciales de Acceso - Plataforma de Evaluación');
            const body = encodeURIComponent(`
Hola ${fullName},

Te han invitado a participar en la Plataforma de Evaluación de Asertividad.

Tus credenciales de acceso son:

Usuario: ${username}
Contraseña: ${password}
URL de Login: ${window.location.origin}/login?role=coachee

Instrucciones:
1. Haz clic en la URL de login o cópiala en tu navegador
2. Selecciona "Coachee" si no se selecciona automáticamente  
3. Ingresa con las credenciales proporcionadas
4. Podrás cambiar tu contraseña después del primer login

¡Esperamos verte pronto en la plataforma!

Saludos,
Tu Coach
            `);
            
            const mailtoLink = `mailto:${email}?subject=${subject}&body=${body}`;
            window.open(mailtoLink);
        }
        
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // Función auxiliar para mostrar toasts
        function showToast(message, type = 'info') {
            const toastContainer = document.querySelector('.toast-container');
            const toastId = 'toast-' + Date.now();
            
            const toastHTML = `
                <div id="${toastId}" class="toast align-items-center text-white bg-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'primary'} border-0" role="alert" aria-live="assertive" aria-atomic="true">
                    <div class="d-flex">
                        <div class="toast-body">
                            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                            ${message}
                        </div>
                        <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
                    </div>
                </div>
            `;
            
            toastContainer.insertAdjacentHTML('beforeend', toastHTML);
            
            const toastElement = document.getElementById(toastId);
            const toast = new bootstrap.Toast(toastElement, {
                autohide: true,
                delay: type === 'error' ? 5000 : 3000
            });
            
            toast.show();
            
            // Remover el toast del DOM después de que se oculte
            toastElement.addEventListener('hidden.bs.toast', function () {
                toastElement.remove();
            });
        }
        
        // Función para ver los detalles de evaluación de un coachee usando el modal homologado
        async function viewCoacheeEvaluationDetails(coacheeId) {
            try {
                // Buscar el coachee en los datos locales
                const coachee = coacheesData.find(c => c.id === coacheeId);
                if (!coachee || !coachee.last_assessment) {
                    showToast('No hay evaluaciones disponibles para este coachee', 'error');
                    return;
                }
                
                // Cargar los detalles completos de la evaluación desde el API
                const response = await fetch(`/api/coach/coachee-evaluation-details/${coacheeId}`, {
                    credentials: 'include'
                });
                
                if (!response.ok) {
                    throw new Error('Error al cargar detalles de la evaluación');
                }
                
                const evaluationData = await response.json();
                
                // Mostrar el modal de evaluación con los datos completos
                const modal = new bootstrap.Modal(document.getElementById('coacheeEvaluationDetailsModal'));
                const modalContent = document.getElementById('coacheeEvaluationDetailsContent');
                
                // Actualizar el título del modal
                document.getElementById('coacheeEvaluationDetailsModalLabel').innerHTML = `
                    <i class="fas fa-chart-radar me-2"></i>
                    Detalles de Evaluación - ${coachee.full_name}
                `;
                
                // Mostrar loading mientras se carga el contenido
                modalContent.innerHTML = `
                    <div class="text-center py-5">
                        <div class="spinner-border spinner-border-custom" role="status">
                            <span class="visually-hidden">Cargando detalles...</span>
                        </div>
                        <p class="mt-3 text-muted">Cargando detalles de la evaluación...</p>
                    </div>
                `;
                
                modal.show();
                
                // Crear el contenido del modal con el mismo formato del coachee
                modalContent.innerHTML = createCoacheeEvaluationDetailsContent(evaluationData, coachee);
                
                // Crear el radar chart después de un pequeño delay para que el DOM esté listo
                setTimeout(() => {
                    const evaluation = evaluationData.evaluation || evaluationData;
                    const dimensionalScores = evaluation.dimensional_scores || {};
                    createCoacheeModalRadarChart(dimensionalScores);
                }, 100);
                
            } catch (error) {
                console.error('Error cargando detalles de evaluación:', error);
                showToast('Error al cargar los detalles de la evaluación', 'error');
            }
        }
        
        // Función para crear el contenido del modal de evaluación del coachee con detalles completos
        function createCoacheeEvaluationDetailsContent(evaluationResponse, coachee) {
            const evaluation = evaluationResponse.evaluation || evaluationResponse;
            const score = Math.round(evaluation.total_score || evaluation.overall_score || evaluation.score || 0);
            const level = evaluation.assertiveness_level || getAssertivityLevel(score);
            const completedDate = evaluation.completed_at || evaluation.created_at;
            const formattedDate = new Date(completedDate).toLocaleDateString('es-ES', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            
            // Obtener análisis por dimensiones
            const dimensionAnalysis = evaluation.dimension_analysis || {};
            const dimensionalScores = evaluation.dimensional_scores || {};
            const responseDetails = evaluation.response_details || [];
            const strengths = evaluation.analysis?.strengths || [];
            const improvements = evaluation.analysis?.improvements || [];
            const generalRecommendations = evaluation.analysis?.general_recommendations || [];
            
            return `
                <div class="row">
                    <!-- Header con Score Principal -->
                    <div class="col-12 mb-4">
                        <div class="text-center p-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; color: white;">
                            <div class="display-2 fw-bold mb-2">${score}%</div>
                            <h3 class="mb-2">${level}</h3>
                            <p class="mb-0 opacity-75">
                                <i class="fas fa-calendar me-2"></i>
                                Evaluación completada el ${formattedDate}
                            </p>
                        </div>
                    </div>
                    
                    <!-- Análisis por Dimensiones - Radar Chart -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-primary text-white">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-chart-radar me-2"></i>
                                    Análisis por Dimensiones
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    <canvas id="coacheeModalRadarChart" width="350" height="350"></canvas>
                                </div>
                                
                                <!-- Puntuaciones por Dimensión -->
                                <div class="dimension-scores">
                                    ${Object.keys(dimensionalScores).map(dim => {
                                        const score = Math.round(dimensionalScores[dim] || 0);
                                        const analysis = dimensionAnalysis[dim] || {};
                                        const level = analysis.level || getScoreClass(score);
                                        return `
                                            <div class="d-flex justify-content-between align-items-center mb-2">
                                                <span class="fw-bold">${formatDimensionName(dim)}:</span>
                                                <span class="badge ${getScoreClass(score)} score-badge">${score}%</span>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fortalezas y Áreas de Mejora -->
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100">
                            <div class="card-header bg-success text-white">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-star me-2"></i>
                                    Fortalezas y Oportunidades
                                </h5>
                            </div>
                            <div class="card-body">
                                <!-- Fortalezas -->
                                ${strengths.length > 0 ? `
                                    <h6 class="text-success mb-3">
                                        <i class="fas fa-thumbs-up me-2"></i>
                                        Fortalezas Identificadas
                                    </h6>
                                    <div class="mb-4">
                                        ${strengths.map(strength => `
                                            <div class="alert alert-success py-2 mb-2">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div class="flex-grow-1">
                                                        <strong>${strength.dimension}</strong>
                                                        <p class="mb-0 small">${strength.description}</p>
                                                    </div>
                                                    <span class="badge bg-success">${Math.round(strength.score)}%</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                <!-- Áreas de Mejora -->
                                ${improvements.length > 0 ? `
                                    <h6 class="text-warning mb-3">
                                        <i class="fas fa-exclamation-triangle me-2"></i>
                                        Áreas de Mejora
                                    </h6>
                                    <div>
                                        ${improvements.map(improvement => `
                                            <div class="alert alert-warning py-2 mb-2">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div class="flex-grow-1">
                                                        <strong>${improvement.dimension}</strong>
                                                        <p class="mb-0 small">${improvement.description}</p>
                                                    </div>
                                                    <span class="badge bg-warning text-dark">${Math.round(improvement.score)}%</span>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Análisis Detallado por Dimensión -->
                    <div class="col-12 mb-4">
                        <div class="card">
                            <div class="card-header bg-info text-white">
                                <h5 class="card-title mb-0">
                                    <i class="fas fa-microscope me-2"></i>
                                    Análisis Detallado por Dimensión
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    ${Object.keys(dimensionAnalysis).map(dim => {
                                        const analysis = dimensionAnalysis[dim];
                                        const score = Math.round(analysis.score || 0);
                                        return `
                                            <div class="col-md-6 mb-3">
                                                <div class="border rounded p-3 h-100">
                                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                                        <h6 class="mb-0">${formatDimensionName(dim)}</h6>
                                                        <span class="badge ${getScoreClass(score)} score-badge">${score}%</span>
                                                    </div>
                                                    <p class="small text-muted mb-2">${analysis.interpretation}</p>
                                                    <div class="small">
                                                        <strong>Nivel:</strong> <span class="text-primary">${analysis.level}</span>
                                                    </div>
                                                    ${analysis.recommendations && analysis.recommendations.length > 0 ? `
                                                        <div class="mt-2">
                                                            <strong class="small">Recomendaciones:</strong>
                                                            <ul class="small mb-0 mt-1">
                                                                ${analysis.recommendations.map(rec => `<li>${rec}</li>`).join('')}
                                                            </ul>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                        `;
                                    }).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recomendaciones Generales -->
                    ${generalRecommendations.length > 0 ? `
                        <div class="col-12 mb-4">
                            <div class="card">
                                <div class="card-header bg-warning text-dark">
                                    <h5 class="card-title mb-0">
                                        <i class="fas fa-lightbulb me-2"></i>
                                        Recomendaciones Generales para el Coach
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <ul class="mb-0">
                                        ${generalRecommendations.map(rec => `<li class="mb-1">${rec}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <!-- Detalles de Respuestas -->
                    ${responseDetails.length > 0 ? `
                        <div class="col-12 mb-4">
                            <div class="card">
                                <div class="card-header bg-secondary text-white">
                                    <h5 class="card-title mb-0">
                                        <i class="fas fa-list me-2"></i>
                                        Respuestas Detalladas (${responseDetails.length} preguntas)
                                    </h5>
                                </div>
                                <div class="card-body">
                                    <div class="accordion" id="responsesAccordion">
                                        ${responseDetails.map((response, index) => `
                                            <div class="accordion-item">
                                                <h6 class="accordion-header" id="heading${index}">
                                                    <button class="accordion-button ${index > 2 ? 'collapsed' : ''}" type="button" 
                                                            data-bs-toggle="collapse" data-bs-target="#collapse${index}" 
                                                            aria-expanded="${index <= 2 ? 'true' : 'false'}" aria-controls="collapse${index}">
                                                        <div class="d-flex justify-content-between align-items-center w-100 me-3">
                                                            <span class="fw-bold">Pregunta ${response.order}</span>
                                                            <span class="badge ${getResponseValueClass(response.response_value)} ms-2">
                                                                ${response.response_value}/5
                                                            </span>
                                                        </div>
                                                    </button>
                                                </h6>
                                                <div id="collapse${index}" class="accordion-collapse collapse ${index <= 2 ? 'show' : ''}" 
                                                     aria-labelledby="heading${index}" data-bs-parent="#responsesAccordion">
                                                    <div class="accordion-body">
                                                        <p class="mb-2"><strong>Pregunta:</strong> ${response.question_text}</p>
                                                        <p class="mb-0">
                                                            <strong>Respuesta:</strong> 
                                                            <span class="badge ${getResponseValueClass(response.response_value)} ms-1">
                                                                ${response.response_value}/5 - ${getResponseValueText(response.response_value)}
                                                            </span>
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;
        }
        
        // Funciones auxiliares para el modal de evaluación detallada
        function formatDimensionName(dimensionKey) {
            const dimensionNames = {
                'comunicacion': 'Comunicación Directa',
                'derechos': 'Defensa de Derechos',
                'opiniones': 'Expresión de Opiniones', 
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza'
            };
            return dimensionNames[dimensionKey] || dimensionKey;
        }
        
        function getResponseValueClass(value) {
            if (value >= 5) return 'bg-success';
            if (value >= 4) return 'bg-info';
            if (value >= 3) return 'bg-warning';
            if (value >= 2) return 'bg-orange';
            return 'bg-danger';
        }
        
        function getResponseValueText(value) {
            const responses = {
                5: 'Totalmente de acuerdo',
                4: 'De acuerdo', 
                3: 'Neutral',
                2: 'En desacuerdo',
                1: 'Totalmente en desacuerdo'
            };
            return responses[value] || 'Sin respuesta';
        }
        
        // Función para crear el radar chart en el modal del coachee
        function createCoacheeModalRadarChart(dimensionalScores) {
            const canvas = document.getElementById('coacheeModalRadarChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destruir chart existente si existe
            if (window.coacheeModalRadarChartInstance) {
                window.coacheeModalRadarChartInstance.destroy();
            }
            
            // Mapeo de dimensiones del backend al frontend
            const dimensionMapping = {
                'comunicacion': 'Comunicación Directa',
                'derechos': 'Defensa de Derechos', 
                'opiniones': 'Expresión de Opiniones',
                'conflictos': 'Manejo de Conflictos',
                'autoconfianza': 'Autoconfianza'
            };
            
            const dimensions = Object.values(dimensionMapping);
            const dimensionKeys = Object.keys(dimensionMapping);
            
            // Mapear las puntuaciones usando las claves correctas
            const scores = dimensionKeys.map(key => dimensionalScores[key] || 0);
            
            window.coacheeModalRadarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: dimensions,
                    datasets: [{
                        label: 'Puntuación',
                        data: scores,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                callback: function(value) {
                                    return value + '%';
                                },
                                color: '#666',
                                backdropColor: 'transparent'
                            },
                            grid: {
                                color: 'rgba(102, 126, 234, 0.2)'
                            },
                            angleLines: {
                                color: 'rgba(102, 126, 234, 0.3)'
                            },
                            pointLabels: {
                                color: '#333',
                                font: {
                                    size: 11,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed.r + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Función para imprimir reporte de evaluación del coachee
        function printCoacheeEvaluationReport() {
            window.print();
        }
        
        // Función para enviar recordatorios a coachees
        async function sendReminder(coacheeId) {
            try {
                const response = await fetch(`/api/coach/send-reminder/${coacheeId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showToast('Recordatorio enviado exitosamente', 'success');
                } else {
                    throw new Error(result.error || 'Error al enviar recordatorio');
                }
                
            } catch (error) {
                console.error('Error enviando recordatorio:', error);
                showToast(error.message || 'Error al enviar recordatorio', 'error');
            }
        }
        
        // Función para obtener interpretación detallada para el coach
        function getDetailedInterpretationForCoach(assessment) {
            const score = assessment.overall_score || assessment.score || 0;
            
            if (score >= 80) {
                return `
                    <h5 class="text-success">
                        <i class="fas fa-star me-2"></i>
                        Nivel Muy Asertivo (${Math.round(score)}%)
                    </h5>
                    <p>Este coachee demuestra un excelente nivel de asertividad. Sus fortalezas incluyen:</p>
                    <ul>
                        <li>Comunicación clara y directa</li>
                        <li>Capacidad para defender sus derechos de manera apropiada</li>
                        <li>Expresión adecuada de opiniones y sentimientos</li>
                        <li>Manejo efectivo de conflictos</li>
                        <li>Alta autoconfianza en sus habilidades</li>
                    </ul>
                    <p class="mb-0"><strong>Recomendación:</strong> Continuar fortaleciendo estas habilidades y considerar rol de mentor para otros.</p>
                `;
            } else if (score >= 60) {
                return `
                    <h5 class="text-info">
                        <i class="fas fa-check-circle me-2"></i>
                        Nivel Asertivo (${Math.round(score)}%)
                    </h5>
                    <p>Este coachee muestra un buen nivel de asertividad con algunas áreas de oportunidad:</p>
                    <ul>
                        <li>Comunicación generalmente efectiva</li>
                        <li>Capacidad adecuada para expresar necesidades</li>
                        <li>Manejo apropiado de la mayoría de situaciones</li>
                    </ul>
                    <p class="mb-0"><strong>Recomendación:</strong> Identificar áreas específicas para fortalecer y practicar técnicas de asertividad.</p>
                `;
            } else if (score >= 40) {
                return `
                    <h5 class="text-warning">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        Nivel Moderadamente Asertivo (${Math.round(score)}%)
                    </h5>
                    <p>Este coachee presenta un nivel moderado de asertividad que se beneficiaría de desarrollo:</p>
                    <ul>
                        <li>Dificultades ocasionales para expresar opiniones</li>
                        <li>Tendencia a evitar algunos conflictos</li>
                        <li>Necesidad de mayor confianza en ciertas situaciones</li>
                    </ul>
                    <p class="mb-0"><strong>Recomendación:</strong> Programa de entrenamiento en habilidades asertivas y técnicas de comunicación.</p>
                `;
            } else {
                return `
                    <h5 class="text-danger">
                        <i class="fas fa-flag me-2"></i>
                        Nivel Poco Asertivo (${Math.round(score)}%)
                    </h5>
                    <p>Este coachee requiere apoyo significativo para desarrollar habilidades asertivas:</p>
                    <ul>
                        <li>Dificultad para expresar necesidades y opiniones</li>
                        <li>Tendencia a evitar conflictos incluso cuando es necesario abordarlos</li>
                        <li>Baja autoconfianza en habilidades de comunicación</li>
                        <li>Posible dificultad para establecer límites</li>
                    </ul>
                    <p class="mb-0"><strong>Recomendación:</strong> Plan de desarrollo intensivo con enfoque en autoestima, comunicación asertiva y manejo de conflictos.</p>
                `;
            }
        }
        
        // Función para crear radar chart en el modal personalizado
        function createModalRadarChart(dimensionalScores) {
            const canvas = document.getElementById('modalRadarChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            
            // Destruir chart existente si existe
            if (window.modalRadarChartInstance) {
                window.modalRadarChartInstance.destroy();
            }
            
            const dimensions = [
                'Comunicación Directa',
                'Defensa de Derechos', 
                'Expresión de Opiniones',
                'Manejo de Conflictos',
                'Autoconfianza'
            ];
            
            const scores = dimensions.map(dim => dimensionalScores[dim] || 0);
            
            window.modalRadarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: dimensions,
                    datasets: [{
                        label: 'Puntuación',
                        data: scores,
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 3,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20,
                                callback: function(value) {
                                    return value + '%';
                                },
                                color: '#666',
                                backdropColor: 'transparent'
                            },
                            grid: {
                                color: 'rgba(102, 126, 234, 0.2)'
                            },
                            angleLines: {
                                color: 'rgba(102, 126, 234, 0.3)'
                            },
                            pointLabels: {
                                color: '#333',
                                font: {
                                    size: 12,
                                    weight: 'bold'
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.parsed.r + '%';
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // ============================================================================
        // FUNCIONES AUXILIARES PARA EL MODAL DE EVALUACIÓN (IDÉNTICAS AL COACHEE)
        // ============================================================================
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'active':
                    return 'status-active';
                case 'pending':
                    return 'status-pending';
                case 'inactive':
                    return 'status-inactive';
                default:
                    return 'status-pending';
            }
        }
        function getStatusText(status) {
            switch(status) {
                case 'active':
                    return 'Activo';
                case 'pending':
                    return 'Pendiente';
                case 'inactive':
                    return 'Inactivo';
                default:
                    return 'Pendiente';
            }
        }
        function getScoreClass(score) {
            if (score >= 80) {
                return 'score-excellent';
            } else if (score >= 60) {
                return 'score-good';
            } else if (score >= 40) {
                return 'score-average';
            } else {
                return 'score-poor';
            }
        }
        function getAssertivityLevel(score) {
            if (score >= 80) {
                return 'Muy Asertivo';
            } else if (score >= 60) {
                return 'Asertivo';
            } else if (score >= 40) {
                return 'Moderadamente Asertivo';
            } else {
                return 'Poco Asertivo';
            }
        }
        function getScoreInterpretation(score) {
            if (score >= 80) {
                return 'Excelente nivel de asertividad. Demuestra una comunicación muy efectiva.';
            } else if (score >= 60) {
                return 'Buen nivel de asertividad. Hay oportunidades de mejora en algunas áreas.';
            } else if (score >= 40) {
                return 'Nivel moderado de asertividad. Se beneficiaría de trabajar en su comunicación asertiva.';
            } else {
                return 'Oportunidad de crecimiento significativa en habilidades de asertividad.';
            }
        }
    </script>
</body>
</html>
